<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="Shaocheng.Li"><meta name=description content="查看当前系统时间：
$ timedatectl status Local time: Thu 2018-09-20 09:42:53 CST Universal time: Thu 2018-09-20 01:42:53 UTC RTC time: Thu 2018-09-20 01:42:53 Time zone: Asia/Chongqing (CST, &#43;0800) Network time on: yes NTP synchronized: yes RTC in local TZ: no RTC in local TZ: no 表示 RTC 时钟不是用本地时间，而是使用 UTC 时间，可以改成使用本地时间，但是并不推荐这么做：
$ timedatectl set-local-rtc 1 $ timedatectl Local time: Thu 2018-09-20 03:57:58 CEST Universal time: Thu 2018-09-20 01:57:58 UTC RTC time: Thu 2018-09-20 03:57:59 Time zone: Europe/Paris (CEST, &#43;0200) Network time on: yes NTP synchronized: yes RTC in local TZ: yes Warning: The system is configured to read the RTC time in the local time zone."><meta name=keywords content><meta name=robots content="noodp"><meta name=theme-color content="#252627"><link rel=canonical href=https://shaocheng.li/posts/2018/09/24/><title>用 timedatectl 管理系统时间 :: Shaocheng.Li — Hello Friends</title><link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css rel=stylesheet type=text/css><link rel=stylesheet href=https://shaocheng.li/main.min.e9b3dfcc5ffe9d55eb281ecaf47cf6179d26eec497e087299934d581c987aa0b.css><link rel=stylesheet type=text/css href=https://shaocheng.li/css/custom.css><link rel=apple-touch-icon sizes=180x180 href=https://shaocheng.li/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://shaocheng.li/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://shaocheng.li/favicon-16x16.png><link rel=manifest href=https://shaocheng.li/site.webmanifest><link rel=mask-icon href=https://shaocheng.li/safari-pinned-tab.svg color=#252627><link rel="shortcut icon" href=https://shaocheng.li/favicon.ico><meta name=msapplication-TileColor content="#252627"><meta name=theme-color content="#252627"><meta itemprop=name content="用 timedatectl 管理系统时间"><meta itemprop=description content="查看当前系统时间：
$ timedatectl status Local time: Thu 2018-09-20 09:42:53 CST Universal time: Thu 2018-09-20 01:42:53 UTC RTC time: Thu 2018-09-20 01:42:53 Time zone: Asia/Chongqing (CST, &#43;0800) Network time on: yes NTP synchronized: yes RTC in local TZ: no RTC in local TZ: no 表示 RTC 时钟不是用本地时间，而是使用 UTC 时间，可以改成使用本地时间，但是并不推荐这么做：
$ timedatectl set-local-rtc 1 $ timedatectl Local time: Thu 2018-09-20 03:57:58 CEST Universal time: Thu 2018-09-20 01:57:58 UTC RTC time: Thu 2018-09-20 03:57:59 Time zone: Europe/Paris (CEST, &#43;0200) Network time on: yes NTP synchronized: yes RTC in local TZ: yes Warning: The system is configured to read the RTC time in the local time zone."><meta itemprop=datePublished content="2018-09-24T08:00:00&#43;08:00"><meta itemprop=dateModified content="2018-09-24T08:00:00&#43;08:00"><meta itemprop=wordCount content="418"><meta itemprop=keywords content><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://shaocheng.li"><meta name=twitter:title content="用 timedatectl 管理系统时间"><meta name=twitter:description content="查看当前系统时间：
$ timedatectl status Local time: Thu 2018-09-20 09:42:53 CST Universal time: Thu 2018-09-20 01:42:53 UTC RTC time: Thu 2018-09-20 01:42:53 Time zone: Asia/Chongqing (CST, &#43;0800) Network time on: yes NTP synchronized: yes RTC in local TZ: no RTC in local TZ: no 表示 RTC 时钟不是用本地时间，而是使用 UTC 时间，可以改成使用本地时间，但是并不推荐这么做：
$ timedatectl set-local-rtc 1 $ timedatectl Local time: Thu 2018-09-20 03:57:58 CEST Universal time: Thu 2018-09-20 01:57:58 UTC RTC time: Thu 2018-09-20 03:57:59 Time zone: Europe/Paris (CEST, &#43;0200) Network time on: yes NTP synchronized: yes RTC in local TZ: yes Warning: The system is configured to read the RTC time in the local time zone."><meta property="article:published_time" content="2018-09-24 08:00:00 &#43;0800 &#43;0800"></head><body><div class=container><header class=header><span class=header__inner><a href=https://shaocheng.li/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>$ cd /home/</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=https://shaocheng.li/about/>About</a></li><li><a href=https://shaocheng.li/posts/>Posts</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41C32.4934 41 41 32.4934 41 22 41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>2 minutes</p></div><article><h1 class=post-title><a href=https://shaocheng.li/posts/2018/09/24/>用 timedatectl 管理系统时间</a></h1><div class=post-content><p>查看当前系统时间：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ timedatectl status
      Local time: Thu <span style=color:#ae81ff>2018</span>-09-20 <span style=color:#ae81ff>09</span>:42:53 CST
  Universal time: Thu <span style=color:#ae81ff>2018</span>-09-20 <span style=color:#ae81ff>01</span>:42:53 UTC
        RTC time: Thu <span style=color:#ae81ff>2018</span>-09-20 <span style=color:#ae81ff>01</span>:42:53
       Time zone: Asia/Chongqing <span style=color:#f92672>(</span>CST, +0800<span style=color:#f92672>)</span>
 Network time on: yes
NTP synchronized: yes
 RTC in local TZ: no</code></pre></div><p><code>RTC in local TZ: no</code> 表示 RTC 时钟不是用本地时间，而是使用 UTC 时间，可以改成使用本地时间，但是并不推荐这么做：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ timedatectl set-local-rtc <span style=color:#ae81ff>1</span>
$ timedatectl
      Local time: Thu <span style=color:#ae81ff>2018</span>-09-20 <span style=color:#ae81ff>03</span>:57:58 CEST
  Universal time: Thu <span style=color:#ae81ff>2018</span>-09-20 <span style=color:#ae81ff>01</span>:57:58 UTC
        RTC time: Thu <span style=color:#ae81ff>2018</span>-09-20 <span style=color:#ae81ff>03</span>:57:59
       Time zone: Europe/Paris <span style=color:#f92672>(</span>CEST, +0200<span style=color:#f92672>)</span>
 Network time on: yes
NTP synchronized: yes
 RTC in local TZ: yes

Warning: The system is configured to read the RTC time in the local time zone.
         This mode can not be fully supported. It will create various problems
         with time zone changes and daylight saving time adjustments. The RTC
         time is never updated, it relies on external facilities to maintain it.
         If at all possible, use RTC in UTC by calling
         <span style=color:#e6db74>&#39;timedatectl set-local-rtc 0&#39;</span>.</code></pre></div><p>列出所有可用的时区：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ timedatectl list-timezones</code></pre></div><p>修改时区：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ timedatectl set-timezone <span style=color:#e6db74>&#34;Europe/Paris&#34;</span>
$ timedatectl
      Local time: Thu <span style=color:#ae81ff>2018</span>-09-20 <span style=color:#ae81ff>03</span>:46:02 CEST
  Universal time: Thu <span style=color:#ae81ff>2018</span>-09-20 <span style=color:#ae81ff>01</span>:46:02 UTC
        RTC time: Thu <span style=color:#ae81ff>2018</span>-09-20 <span style=color:#ae81ff>01</span>:46:02
       Time zone: Europe/Paris <span style=color:#f92672>(</span>CEST, +0200<span style=color:#f92672>)</span>
 Network time on: yes
NTP synchronized: yes
 RTC in local TZ: no
$ cat /etc/timezone
Europe/Paris
$ date
Thu Sep <span style=color:#ae81ff>20</span> <span style=color:#ae81ff>03</span>:46:48 CEST <span style=color:#ae81ff>2018</span></code></pre></div><p>设置时间和日期：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>timedatectl set-time <span style=color:#e6db74>&#39;16:10:40 2018-11-20&#39;</span></code></pre></div><p>关闭时间同步，实际是关闭 <code>systemd-timesyncd.service</code> 服务：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ timedatectl set-ntp <span style=color:#ae81ff>0</span>
$ timedatectl
      Local time: Thu <span style=color:#ae81ff>2018</span>-09-20 <span style=color:#ae81ff>04</span>:19:41 CEST
  Universal time: Thu <span style=color:#ae81ff>2018</span>-09-20 <span style=color:#ae81ff>02</span>:19:41 UTC
        RTC time: Thu <span style=color:#ae81ff>2018</span>-09-20 <span style=color:#ae81ff>02</span>:19:41
       Time zone: Europe/Paris <span style=color:#f92672>(</span>CEST, +0200<span style=color:#f92672>)</span>
 Network time on: no
NTP synchronized: yes
 RTC in local TZ: no
$ systemctl status systemd-timesyncd.service
● systemd-timesyncd.service - Network Time Synchronization
   Loaded: loaded <span style=color:#f92672>(</span>/lib/systemd/system/systemd-timesyncd.service; disabled; vendor preset: enabled<span style=color:#f92672>)</span>
  Drop-In: /lib/systemd/system/systemd-timesyncd.service.d
           └─disable-with-time-daemon.conf
   Active: inactive <span style=color:#f92672>(</span>dead<span style=color:#f92672>)</span>
     Docs: man:systemd-timesyncd.service<span style=color:#f92672>(</span><span style=color:#ae81ff>8</span><span style=color:#f92672>)</span>

Feb <span style=color:#ae81ff>11</span> <span style=color:#ae81ff>17</span>:28:02 ubuntu systemd-timesyncd<span style=color:#f92672>[</span><span style=color:#ae81ff>472</span><span style=color:#f92672>]</span>: System clock time unset or jumped backwards, restoring from recorded timestamp:
Sep <span style=color:#ae81ff>19</span> <span style=color:#ae81ff>11</span>:36:39 ubuntu systemd<span style=color:#f92672>[</span><span style=color:#ae81ff>1</span><span style=color:#f92672>]</span>: Started Network Time Synchronization.
Sep <span style=color:#ae81ff>20</span> <span style=color:#ae81ff>03</span>:19:45 ubuntu systemd-timesyncd<span style=color:#f92672>[</span><span style=color:#ae81ff>472</span><span style=color:#f92672>]</span>: Synchronized to time server <span style=color:#ae81ff>91</span>.189.91.157:123 <span style=color:#f92672>(</span>ntp.ubuntu.com<span style=color:#f92672>)</span>.
Sep <span style=color:#ae81ff>20</span> <span style=color:#ae81ff>04</span>:19:37 ubuntu systemd<span style=color:#f92672>[</span><span style=color:#ae81ff>1</span><span style=color:#f92672>]</span>: Stopping Network Time Synchronization...
Sep <span style=color:#ae81ff>20</span> <span style=color:#ae81ff>04</span>:19:37 ubuntu systemd<span style=color:#f92672>[</span><span style=color:#ae81ff>1</span><span style=color:#f92672>]</span>: Stopped Network Time Synchronization.
Sep <span style=color:#ae81ff>20</span> <span style=color:#ae81ff>04</span>:20:27 ubuntu systemd<span style=color:#f92672>[</span><span style=color:#ae81ff>1</span><span style=color:#f92672>]</span>: Starting Network Time Synchronization...
Sep <span style=color:#ae81ff>20</span> <span style=color:#ae81ff>04</span>:20:27 ubuntu systemd<span style=color:#f92672>[</span><span style=color:#ae81ff>1</span><span style=color:#f92672>]</span>: Started Network Time Synchronization.
Sep <span style=color:#ae81ff>20</span> <span style=color:#ae81ff>04</span>:20:27 ubuntu systemd-timesyncd<span style=color:#f92672>[</span><span style=color:#ae81ff>1901</span><span style=color:#f92672>]</span>: Synchronized to time server <span style=color:#ae81ff>91</span>.189.89.198:123 <span style=color:#f92672>(</span>ntp.ubuntu.com<span style=color:#f92672>)</span>.
Sep <span style=color:#ae81ff>20</span> <span style=color:#ae81ff>04</span>:20:51 ubuntu systemd<span style=color:#f92672>[</span><span style=color:#ae81ff>1</span><span style=color:#f92672>]</span>: Stopping Network Time Synchronization...
Sep <span style=color:#ae81ff>20</span> <span style=color:#ae81ff>04</span>:20:51 ubuntu systemd<span style=color:#f92672>[</span><span style=color:#ae81ff>1</span><span style=color:#f92672>]</span>: Stopped Network Time Synchronization.</code></pre></div><p><code>systemd-timesyncd.service</code> 调用的是 <code>/lib/systemd/systemd-timesyncd</code> 守护进程执行时间同步，配置文件是 <code>/etc/systemd/timesyncd.conf</code> ，有两个选项：</p><ul><li>NTP= ，主 NTP 服务器域名或者 IP 列表，多个地址之间用空格隔开。</li><li>FallbackNTP= ，备用 NTP 服务器域名或者 IP 列表，多个地址之间用空格隔开。</li></ul><p>每次时间同步后都会更新 <code>/var/lib/systemd/clock</code> 文件：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ ll /var/lib/systemd/clock
-rw-r--r-- <span style=color:#ae81ff>1</span> systemd-timesync systemd-timesync <span style=color:#ae81ff>0</span> Spe <span style=color:#ae81ff>25</span> <span style=color:#ae81ff>14</span>:09 /var/lib/systemd/clock</code></pre></div><p>大约 20 分钟同步一次，这个时间间隔不可以设置。</p></div></article><hr><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>418 Words</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>2018-09-24 00:00 &#43;0000</p></div><div class=pagination><div class=pagination__title><span class=pagination__title-h></span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://shaocheng.li/posts/2018/12/12/><span class=button__icon>←</span>
<span class=button__text>iptables 学习笔记</span></a></span>
<span class="button next"><a href=https://shaocheng.li/posts/2018/09/21/><span class=button__text>包管理器 dnf 学习笔记</span>
<span class=button__icon>→</span></a></span></div></div><div id=comments class=thin><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"shaocheng-li"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></main></div><footer class=footer><div class=footer__inner><div class=footer__content><span>&copy; 2022</span>
<span><a href=https://shaocheng.li>Shaocheng.Li</a></span>
<span><a href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank rel=noopener>CC BY-NC 4.0</a></span>
<span><a href=https://shaocheng.li/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"/><path d="M4 4a16 16 0 0 1 16 16"/><circle cx="5" cy="19" r="1"/></svg></a></span></div></div><div class=footer__inner><div class=footer__content><span>Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>Made with &#10084; by <a href=https://github.com/rhazdon>rhazdon</a></span></div></div></footer></div><script type=text/javascript src=https://shaocheng.li/bundle.min.2d5469329143160ae2456a69c3c76dc2d0a3b212b46afe291a51bd68650ed6f8697e001dab54f1c272c77ce08092a8c55e5bb4314e0ee334aab4b927ec896638.js integrity="sha512-LVRpMpFDFgriRWppw8dtwtCjshK0av4pGlG9aGUO1vhpfgAdq1TxwnLHfOCAkqjFXlu0MU4O4zSqtLkn7IlmOA=="></script></body></html>