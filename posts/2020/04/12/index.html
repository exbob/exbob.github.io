<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="Shaocheng.Li"><meta name=description content="tcpdump 是一个帮助用户捕获、筛选和解析 TCP/IP 协议数据包的命令行工具。
1. 基本用法 下面展示了 tcpdump 的常用的选项：
:~$ tcpdump -nn -s0 -v -i en0 port 80   -i ：指定需要监听的网卡，可以是物理网卡，也可以是虚拟网卡。途径该网卡的数据包都会被捕获，然后用过滤器的规则进行筛选。如果没有指定，默认会监听本机的所有网卡。 port ：这是一个过滤器规则，表示只显示使用该端口收发的数据。 -nn ：默认情况下，tcpdump 会将 ip 和端口号解析为字符串的形式，例如 80 端口会显示为 http 。可以用 -n 表示不解析主机名，-nn 表示不解析主机名和端口号，这样可以加快速度，也方便查看。 -s0 ：设置要捕获的数据包的大小，s0 表示不限制大小。 -v ：表示粗略显示数据包的内容，-vv 可以增加显示数据包的细节。  1.1 显示控制 使用 -A 选项可以将数据包的内容以 ASCII 字符形式显示，方便阅读，另一个选项 -X 可以让数据包的内容同时以 16 进制和 ASCII 字符形式显示，例如：
:~$ tcpdump -nn -s0 -v -i en0 port 80 -X tcpdump: listening on en0, link-type EN10MB (Ethernet), capture size 262144 bytes 08:51:01."><meta name=keywords content><meta name=robots content="noodp"><meta name=theme-color content="#252627"><link rel=canonical href=https://shaocheng.li/posts/2020/04/12/><title>tcpdump 使用笔记 :: Shaocheng.Li — Hello Friends</title><link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css rel=stylesheet type=text/css><link rel=stylesheet href=https://shaocheng.li/main.min.e9b3dfcc5ffe9d55eb281ecaf47cf6179d26eec497e087299934d581c987aa0b.css><link rel=stylesheet type=text/css href=https://shaocheng.li/css/custom.css><link rel=apple-touch-icon sizes=180x180 href=https://shaocheng.li/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://shaocheng.li/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://shaocheng.li/favicon-16x16.png><link rel=manifest href=https://shaocheng.li/site.webmanifest><link rel=mask-icon href=https://shaocheng.li/safari-pinned-tab.svg color=#252627><link rel="shortcut icon" href=https://shaocheng.li/favicon.ico><meta name=msapplication-TileColor content="#252627"><meta name=theme-color content="#252627"><meta itemprop=name content="tcpdump 使用笔记"><meta itemprop=description content="tcpdump 是一个帮助用户捕获、筛选和解析 TCP/IP 协议数据包的命令行工具。
1. 基本用法 下面展示了 tcpdump 的常用的选项：
:~$ tcpdump -nn -s0 -v -i en0 port 80   -i ：指定需要监听的网卡，可以是物理网卡，也可以是虚拟网卡。途径该网卡的数据包都会被捕获，然后用过滤器的规则进行筛选。如果没有指定，默认会监听本机的所有网卡。 port ：这是一个过滤器规则，表示只显示使用该端口收发的数据。 -nn ：默认情况下，tcpdump 会将 ip 和端口号解析为字符串的形式，例如 80 端口会显示为 http 。可以用 -n 表示不解析主机名，-nn 表示不解析主机名和端口号，这样可以加快速度，也方便查看。 -s0 ：设置要捕获的数据包的大小，s0 表示不限制大小。 -v ：表示粗略显示数据包的内容，-vv 可以增加显示数据包的细节。  1.1 显示控制 使用 -A 选项可以将数据包的内容以 ASCII 字符形式显示，方便阅读，另一个选项 -X 可以让数据包的内容同时以 16 进制和 ASCII 字符形式显示，例如：
:~$ tcpdump -nn -s0 -v -i en0 port 80 -X tcpdump: listening on en0, link-type EN10MB (Ethernet), capture size 262144 bytes 08:51:01."><meta itemprop=datePublished content="2020-04-12T22:25:11&#43;08:00"><meta itemprop=dateModified content="2020-04-12T22:25:11&#43;08:00"><meta itemprop=wordCount content="260"><meta itemprop=keywords content="untagged,"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://shaocheng.li"><meta name=twitter:title content="tcpdump 使用笔记"><meta name=twitter:description content="tcpdump 是一个帮助用户捕获、筛选和解析 TCP/IP 协议数据包的命令行工具。
1. 基本用法 下面展示了 tcpdump 的常用的选项：
:~$ tcpdump -nn -s0 -v -i en0 port 80   -i ：指定需要监听的网卡，可以是物理网卡，也可以是虚拟网卡。途径该网卡的数据包都会被捕获，然后用过滤器的规则进行筛选。如果没有指定，默认会监听本机的所有网卡。 port ：这是一个过滤器规则，表示只显示使用该端口收发的数据。 -nn ：默认情况下，tcpdump 会将 ip 和端口号解析为字符串的形式，例如 80 端口会显示为 http 。可以用 -n 表示不解析主机名，-nn 表示不解析主机名和端口号，这样可以加快速度，也方便查看。 -s0 ：设置要捕获的数据包的大小，s0 表示不限制大小。 -v ：表示粗略显示数据包的内容，-vv 可以增加显示数据包的细节。  1.1 显示控制 使用 -A 选项可以将数据包的内容以 ASCII 字符形式显示，方便阅读，另一个选项 -X 可以让数据包的内容同时以 16 进制和 ASCII 字符形式显示，例如：
:~$ tcpdump -nn -s0 -v -i en0 port 80 -X tcpdump: listening on en0, link-type EN10MB (Ethernet), capture size 262144 bytes 08:51:01."><meta property="article:published_time" content="2020-04-12 22:25:11 &#43;0800 &#43;0800"></head><body><div class=container><header class=header><span class=header__inner><a href=https://shaocheng.li/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>$ cd /home/</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=https://shaocheng.li/about/>About</a></li><li><a href=https://shaocheng.li/posts/>Posts</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41C32.4934 41 41 32.4934 41 22 41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>2 minutes</p></div><article><h1 class=post-title><a href=https://shaocheng.li/posts/2020/04/12/>tcpdump 使用笔记</a></h1><hr><aside id=toc><div class=toc-title>Table of Contents</div><nav id=TableOfContents><ul><li><ul><li><a href=#1-基本用法>1. 基本用法</a><ul><li><a href=#1-1-显示控制>1.1 显示控制</a></li><li><a href=#1-3-写入文件>1.3 写入文件</a></li><li><a href=#1-4-行缓存模式>1.4 行缓存模式</a></li></ul></li><li><a href=#2-过滤器>2. 过滤器</a><ul><li><a href=#2-1-筛选-ip>2.1 筛选 IP</a></li><li><a href=#2-2-筛选端口>2.2 筛选端口</a></li><li><a href=#2-2-筛选协议>2.2 筛选协议</a></li></ul></li></ul></li></ul></nav></aside><hr><div class=post-content><p><strong>tcpdump</strong> 是一个帮助用户捕获、筛选和解析 TCP/IP 协议数据包的命令行工具。</p><h2 id=1-基本用法>1. 基本用法</h2><p>下面展示了 tcpdump 的常用的选项：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>:~$ tcpdump -nn -s0 -v -i en0  port <span style=color:#ae81ff>80</span> </code></pre></div><ul><li>-i ：指定需要监听的网卡，可以是物理网卡，也可以是虚拟网卡。途径该网卡的数据包都会被捕获，然后用过滤器的规则进行筛选。如果没有指定，默认会监听本机的所有网卡。</li><li>port ：这是一个过滤器规则，表示只显示使用该端口收发的数据。</li><li>-nn ：默认情况下，tcpdump 会将 ip 和端口号解析为字符串的形式，例如 80 端口会显示为 http 。可以用 <code>-n</code> 表示不解析主机名，<code>-nn</code> 表示不解析主机名和端口号，这样可以加快速度，也方便查看。</li><li>-s0 ：设置要捕获的数据包的大小，s0 表示不限制大小。</li><li>-v ：表示粗略显示数据包的内容，-vv 可以增加显示数据包的细节。</li></ul><h3 id=1-1-显示控制>1.1 显示控制</h3><p>使用 <code>-A</code> 选项可以将数据包的内容以 ASCII 字符形式显示，方便阅读，另一个选项 <code>-X</code> 可以让数据包的内容同时以 16 进制和 ASCII 字符形式显示，例如：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>:~$ tcpdump -nn -s0 -v -i en0  port <span style=color:#ae81ff>80</span> -X
tcpdump: listening on en0, link-type EN10MB <span style=color:#f92672>(</span>Ethernet<span style=color:#f92672>)</span>, capture size <span style=color:#ae81ff>262144</span> bytes
<span style=color:#ae81ff>08</span>:51:01.902291 IP <span style=color:#f92672>(</span>tos 0x0, ttl <span style=color:#ae81ff>64</span>, id <span style=color:#ae81ff>0</span>, offset <span style=color:#ae81ff>0</span>, flags <span style=color:#f92672>[</span>DF<span style=color:#f92672>]</span>, proto TCP <span style=color:#f92672>(</span><span style=color:#ae81ff>6</span><span style=color:#f92672>)</span>, length <span style=color:#ae81ff>40</span><span style=color:#f92672>)</span>
    <span style=color:#ae81ff>192</span>.168.50.102.53936 &gt; <span style=color:#ae81ff>120</span>.92.84.16.80: Flags <span style=color:#f92672>[</span>F.<span style=color:#f92672>]</span>, cksum 0xefc2 <span style=color:#f92672>(</span>correct<span style=color:#f92672>)</span>, seq <span style=color:#ae81ff>710116020</span>, ack <span style=color:#ae81ff>2044458673</span>, win <span style=color:#ae81ff>4096</span>, length <span style=color:#ae81ff>0</span>
	0x0000:  <span style=color:#ae81ff>4500</span> <span style=color:#ae81ff>0028</span> <span style=color:#ae81ff>0000</span> <span style=color:#ae81ff>4000</span> <span style=color:#ae81ff>4006</span> 7b55 c0a8 <span style=color:#ae81ff>3266</span>  E..<span style=color:#f92672>(</span>..@.@.<span style=color:#f92672>{</span>U..2f
	0x0010:  785c <span style=color:#ae81ff>5410</span> d2b0 <span style=color:#ae81ff>0050</span> 2a53 82b4 79db f6b1  x<span style=color:#ae81ff>\T</span>....P*S..y...
	0x0020:  <span style=color:#ae81ff>5011</span> <span style=color:#ae81ff>1000</span> efc2 <span style=color:#ae81ff>0000</span>                      P.......</code></pre></div><p>### 1.2 组合规则</p><p>多种过滤器规则可以用标准逻辑进行组合。</p><ul><li><code>and</code> 或者 <code>&amp;&amp;</code> 表示 与</li><li><code>or</code> 或者 <code>||</code> 表示或</li><li><code>not</code> 或者 <code>!</code> 表示非</li></ul><h3 id=1-3-写入文件>1.3 写入文件</h3><p>用 <code>-w [filename]</code> 选项可以将筛选解析后的数据以 <code>pcap</code> 格式写入文件，这种格式可以用 wireshark 打开显示，方便查看。例如：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>:~$ tcpdump -nn -s0 -v -i en0  port <span style=color:#ae81ff>80</span> -w test.pcap</code></pre></div><h3 id=1-4-行缓存模式>1.4 行缓存模式</h3><p>如果想实时将抓取到的数据通过管道传递给其他工具来处理，需要使用 <code>-l</code> 选项来开启行缓存模式（或使用 <code>-c</code> 选项来开启数据包缓存模式）。它可以将标准输出立即发送给其他命令，其他命令会立即响应。例如：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>:~$ tcpdump -l | tee dat</code></pre></div><h2 id=2-过滤器>2. 过滤器</h2><h3 id=2-1-筛选-ip>2.1 筛选 IP</h3><p>筛选目的 IP 或者源 IP 为特定值的数据包：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>:~$ tcpdump -i en0 host <span style=color:#ae81ff>192</span>.168.1.1</code></pre></div><p>也可用 <code>src</code> 筛选源 IP 为特定值的数据包，用 <code>dst</code> 筛选目的 IP 为特定在的数据包：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>:~$ tcpdump -i en0 dst <span style=color:#ae81ff>192</span>.168.1.1</code></pre></div><h3 id=2-2-筛选端口>2.2 筛选端口</h3><p>使用 <code>port</code> 选项可以筛选通过特定端口收发的数据包，例如：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>:~$ tcpdump -i en0 port <span style=color:#ae81ff>80</span></code></pre></div><p>也可以筛选特定范围内的端口：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>:~$ tcpdump -i en0 portrange <span style=color:#ae81ff>21</span>-23</code></pre></div><h3 id=2-2-筛选协议>2.2 筛选协议</h3><p>使用 <code>proto</code> 选项可以筛选特定协议的数据包，例如只显示 upd 数据包：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>:~$ tcpdump -i en0 proto udp</code></pre></div><p>关键字 <code>proto</code> 可以省略，直接写协议名称，支持的协议有 <code>icmp</code>, <code>igmp</code>, <code>igrp</code>, <code>pim</code>, <code>ah</code>, <code>esp</code>, <code>carp</code>, <code>vrrp</code>, <code>udp</code>和 <code>tcp</code> 。</p></div></article><hr><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83.0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://shaocheng.li/tags/untagged>untagged</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>260 Words</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>2020-04-12 14:25 &#43;0000</p></div><div class=pagination><div class=pagination__title><span class=pagination__title-h></span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://shaocheng.li/posts/2020/06/29/><span class=button__icon>←</span>
<span class=button__text>CMake 学习笔记</span></a></span>
<span class="button next"><a href=https://shaocheng.li/posts/2020/01/15/><span class=button__text>Markdown Syntax Guide</span>
<span class=button__icon>→</span></a></span></div></div><div id=comments class=thin><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"shaocheng-li"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></main></div><footer class=footer><div class=footer__inner><div class=footer__content><span>&copy; 2021</span>
<span><a href=https://shaocheng.li>Shaocheng.Li</a></span>
<span><a href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank rel=noopener>CC BY-NC 4.0</a></span>
<span><a href=https://shaocheng.li/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"/><path d="M4 4a16 16 0 0 1 16 16"/><circle cx="5" cy="19" r="1"/></svg></a></span></div></div><div class=footer__inner><div class=footer__content><span>Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>Made with &#10084; by <a href=https://github.com/rhazdon>rhazdon</a></span></div></div></footer></div><script type=text/javascript src=https://shaocheng.li/bundle.min.2d5469329143160ae2456a69c3c76dc2d0a3b212b46afe291a51bd68650ed6f8697e001dab54f1c272c77ce08092a8c55e5bb4314e0ee334aab4b927ec896638.js integrity="sha512-LVRpMpFDFgriRWppw8dtwtCjshK0av4pGlG9aGUO1vhpfgAdq1TxwnLHfOCAkqjFXlu0MU4O4zSqtLkn7IlmOA=="></script></body></html>