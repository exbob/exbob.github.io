<!doctype html><html lang=zh-Hans dir=Chinese-Simplified class=scroll-smooth data-default-appearance=dark data-auto-appearance=true><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="#FFFFFF"><title>RaspberryPi 3 使用笔记 &#183; Shaocheng.Li</title>
<meta name=title content="RaspberryPi 3 使用笔记 &#183; Shaocheng.Li"><script type=text/javascript src=/js/appearance.min.8a082f81b27f3cb2ee528df0b0bdc39787034cf2cc34d4669fbc9977c929023c.js integrity="sha256-iggvgbJ/PLLuUo3wsL3Dl4cDTPLMNNRmn7yZd8kpAjw="></script><link type=text/css rel=stylesheet href=/css/main.bundle.min.5ecb2fb7650f9b878e0041d3064dab2c9fe0fc1a753a9015d386642c941c09e1.css integrity="sha256-Xssvt2UPm4eOAEHTBk2rLJ/g/Bp1OpAV04ZkLJQcCeE="><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.af5d9722112bedac95702865c340bcd6286c4e9b2c15ce26b531ea1fba974cb8.js integrity="sha256-r12XIhEr7ayVcChlw0C81ihsTpssFc4mtTHqH7qXTLg=" data-copy=复制 data-copied=已复制></script><meta name=description content="
      
        
      
    "><link rel=canonical href=https://shaocheng.li/posts/2017/05/09/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:url" content="https://shaocheng.li/posts/2017/05/09/"><meta property="og:site_name" content="Shaocheng.Li"><meta property="og:title" content="RaspberryPi 3 使用笔记"><meta property="og:description" content="LiShaocheng's Blog"><meta property="og:locale" content="zh_Hans"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-05-09T08:00:00+08:00"><meta property="article:modified_time" content="2017-05-09T08:00:00+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="RaspberryPi 3 使用笔记"><meta name=twitter:description content="LiShaocheng's Blog"><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"RaspberryPi 3 使用笔记","headline":"RaspberryPi 3 使用笔记","inLanguage":"zh-Hans","url":"https:\/\/shaocheng.li\/posts\/2017\/05\/09\/","author":{"@type":"Person","name":"Shaocheng.Li"},"copyrightYear":"2017","dateCreated":"2017-05-09T08:00:00\u002b08:00","datePublished":"2017-05-09T08:00:00\u002b08:00","dateModified":"2017-05-09T08:00:00\u002b08:00","mainEntityOfPage":"true","wordCount":"2640"}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://shaocheng.li/","name":"Shaocheng. Li","position":1},{"@type":"ListItem","item":"https://shaocheng.li/posts/","name":"Posts","position":2},{"@type":"ListItem","name":"Raspberry Pi 3 使用笔记","position":3}]}</script><meta name=author content="Shaocheng.Li"><link href=https://github.com/exbob rel=me></head><body class="m-auto flex h-screen max-w-7xl flex-col bg-neutral px-6 text-lg leading-7 text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32"><div id=the-top class="absolute flex self-center"><a class="-translate-y-8 rounded-b-lg bg-primary-200 px-3 py-1 text-sm focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="pe-2 font-bold text-primary-600 dark:text-primary-400">&darr;</span>跳到主要内容</a></div><header class="py-6 font-semibold text-neutral-900 dark:text-neutral sm:py-10 print:hidden"><nav class="flex items-start justify-between sm:items-center"><div class="flex flex-row items-center"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" rel=me href=/>Shaocheng.Li</a></div><ul class="flex list-none flex-col text-end sm:flex-row"><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><a href=/posts/ title=Posts><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">文章列表</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><button id=search-button-1 title="搜索 (/)">
<span class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"><span class="icon relative inline-block px-1 align-text-bottom"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></span><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"></span></button></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><button id=appearance-switcher-1 type=button aria-label="appearance switcher">
<span class="group-dark:hover:text-primary-400 inline transition-colors group-hover:text-primary-600 dark:hidden" title=切换为深色模式><span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg>
</span><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"></span>
</span><span class="group-dark:hover:text-primary-400 hidden transition-colors group-hover:text-primary-600 dark:inline" title=切换为浅色模式><span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg>
</span><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"></span></span></button></li></ul></nav></header><div class="relative flex grow flex-col"><main id=main-content class=grow><article><header class=max-w-prose><h1 class="mb-8 mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">RaspberryPi 3 使用笔记</h1><div class="mb-10 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime="2017-05-09 08:00:00 +0800 +0800">2017 9 五月</time><span class="px-2 text-primary-500">&#183;</span><span>2640 字</span><span class="px-2 text-primary-500">&#183;</span><span title=预计阅读>13 分钟</span></div></div></header><section class="prose mt-0 flex max-w-full flex-col dark:prose-invert lg:flex-row"><div class="order-first px-0 lg:order-last lg:max-w-xs lg:ps-8"><div class="toc pe-5 lg:sticky lg:top-10 print:hidden"><details open class="-ms-5 mt-0 overflow-hidden rounded-lg ps-5"><summary class="block cursor-pointer bg-neutral-100 py-1 ps-5 text-lg font-semibold text-neutral-800 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">目录</summary><div class="border-s border-dotted border-neutral-300 py-2 ps-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#0-准备>0. 准备</a></li><li><a href=#1-安装系统>1. 安装系统</a></li><li><a href=#2-第一次启动>2. 第一次启动</a><ul><li><a href=#21-配置语言时区和键盘布局>2.1. 配置语言、时区和键盘布局</a></li><li><a href=#22-配置-wi-fi>2.2. 配置 Wi-Fi</a></li><li><a href=#23-开启-ssh>2.3. 开启 SSH</a></li><li><a href=#24-更换源>2.4. 更换源</a></li><li><a href=#25-替换-vim>2.5. 替换 Vim</a></li><li><a href=#26-设置-ssh-证书登录>2.6. 设置 SSH 证书登录</a></li><li><a href=#27-系统时间>2.7. 系统时间</a></li><li><a href=#28-配置以太网>2.8. 配置以太网</a></li></ul></li><li><a href=#3-硬件编程开发>3. 硬件编程开发</a><ul><li><a href=#31-下载安装>3.1. 下载安装</a></li><li><a href=#32-wiringpi-的管脚编码>3.2. WiringPi 的管脚编码</a></li><li><a href=#33-gpio>3.3. GPIO</a></li><li><a href=#34-spi>3.4. SPI</a></li><li><a href=#35-uart>3.5. UART</a></li></ul></li><li><a href=#4-搭建-nas-服务>4. 搭建 NAS 服务</a><ul><li><a href=#41-硬件配置>4.1. 硬件配置</a></li><li><a href=#42-文件共享>4.2. 文件共享</a></li><li><a href=#43-ftp-服务器>4.3. FTP 服务器</a></li></ul></li><li><a href=#5-移植-uci>5. 移植 UCI</a></li><li><a href=#6-web-开发>6. Web 开发</a><ul><li><a href=#61-安装-nginx>6.1. 安装 Nginx</a></li><li><a href=#62-安装-django>6.2. 安装 Django</a></li><li><a href=#63-安装-uwsgi>6.3. 安装 uWSGI</a></li></ul></li></ul></nav></div></details></div></div><div class="min-h-0 min-w-0 max-w-prose grow"><h2 id=0-准备 class="relative group">0. 准备 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#0-%e5%87%86%e5%a4%87 aria-label=锚点>#</a></span></h2><p><figure><img src=./pics/2017-05-09_1.jpg alt class="mx-auto my-0 rounded-md"></figure></p><ul><li>Raspberry Pi 3 Model B</li><li>32GB Class10 TF 卡（官方推荐 8GB 以上）和读卡器</li><li>5V2A USB 电源，比如 iPad 电源适配器</li><li>microUSB 电源线</li><li>HDMI 数据线</li><li>显示器</li><li>USB 键盘</li></ul><h2 id=1-安装系统 class="relative group">1. 安装系统 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#1-%e5%ae%89%e8%a3%85%e7%b3%bb%e7%bb%9f aria-label=锚点>#</a></span></h2><p>下载 <a href=https://www.raspberrypi.org/downloads/raspbian/ target=_blank rel=noreferrer>Raspbian jessie lite</a> ：2017-04-10-raspbian-jessie-lite.img ，这是一个官方支持的精简系统，基于 Debian 开发，只有文本界面。</p><p>将 TF 卡插入 MacBook ，在终端里用 df 命令可以看到 TF 卡已经被挂载：</p><pre><code>[22:16]~/ ❯ df
Filesystem    512-blocks      Used Available Capacity iused      ifree %iused  Mounted on
/dev/disk1     487830528 299357448 187961080    62% 1687373 4293279906    0%   /
devfs                377       377         0   100%     654          0  100%   /dev
map -hosts             0         0         0   100%       0          0  100%   /net
map auto_home          0         0         0   100%       0          0  100%   /home
/dev/disk3s1    60612608    226616  60385992     1%      76 4294967203    0%   /Volumes/Pi
</code></pre><p>然后卸载：</p><pre><code>[22:39]~/ ❯ diskutil unmount /dev/disk3s1
Volume Pi on disk3s1 unmounted
</code></pre><p>使用 dd 命令将系统镜像写入:</p><pre><code>[23:43]~/ ❯ sudo dd bs=4m if=2017-04-10-raspbian-jessie-lite.img of=/dev/rdisk3
Password:
309+1 records in
309+1 records out
1297862656 bytes transferred in 112.203648 secs (11567027 bytes/sec)
</code></pre><blockquote><p>/dev/disk3s1 是分区，/dev/disk3 是块设备，/dev/rdisk3 是原始字符设备</p></blockquote><p>这样就安装系统好了，再次卸载：</p><pre><code>[23:45]~/ ❯ df
Filesystem    512-blocks      Used Available Capacity iused      ifree %iused  Mounted on
/dev/disk1     487830528 299358472 187960056    62% 1687450 4293279829    0%   /
devfs                380       380         0   100%     658          0  100%   /dev
map -hosts             0         0         0   100%       0          0  100%   /net
map auto_home          0         0         0   100%       0          0  100%   /home
/dev/disk3s1       82644     41524     41120    51%       0          0  100%   /Volumes/boot
[23:49]~/ ❯ diskutil unmount /dev/disk3s1
Volume boot on disk3s1 unmounted
</code></pre><h2 id=2-第一次启动 class="relative group">2. 第一次启动 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#2-%e7%ac%ac%e4%b8%80%e6%ac%a1%e5%90%af%e5%8a%a8 aria-label=锚点>#</a></span></h2><p>将 TF 卡插入树莓派，连接电源、显示器、键盘，即可启动。启动后输入用户名 pi ，密码 raspberry 。</p><h3 id=21-配置语言时区和键盘布局 class="relative group">2.1. 配置语言、时区和键盘布局 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#21-%e9%85%8d%e7%bd%ae%e8%af%ad%e8%a8%80%e6%97%b6%e5%8c%ba%e5%92%8c%e9%94%ae%e7%9b%98%e5%b8%83%e5%b1%80 aria-label=锚点>#</a></span></h3><p>执行 <code>sudo raspi-config</code> ，进入 <code>4 Localisation Options</code> ，对系统进行本地化配置：</p><ul><li>在 <code>I1 Change Locale</code> 中设置本地语言，取消 <code>en_GB.UTF-8 UTF-8</code> ，选中 <code>en_US.UTF-8 UTF-8</code> 。</li><li>在 <code>I2 Change Timezone</code> 中设置时区为 <code>Asia</code> 下的 <code>Shanghai</code> 。</li><li>在 <code>I3 Change Keyboard Layout</code> 设置键盘布局，依次选择 <code>Generic 104-key PC</code> > <code>Other</code> > <code>English (US)</code> > <code>English (US)</code> > <code>The default for the keyboard layout</code> > <code>No compose key</code> 。</li><li>在 <code>I4 Change Wi-fi Country</code> 中设置<code>CN China</code></li><li>完成配置后，选择 <code>Finish</code> ，根据提示重启系统，如果没有提示，可以执行 <code>sudo reboot </code>重启系统。</li></ul><h3 id=22-配置-wi-fi class="relative group">2.2. 配置 Wi-Fi <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#22-%e9%85%8d%e7%bd%ae-wi-fi aria-label=锚点>#</a></span></h3><p>执行 <code>wpa_passphrase [ssid] [password]</code> 命令将 Wi-Fi 名称和密码写入配置文件：</p><pre><code>pi@raspberrypi:~ $ sudo wpa_passphrase TP-Link_30BBB8 12345678 | sudo tee -a /etc/wpa_supplicant/wpa_supplicant.conf
</code></pre><p>重启一下系统，就可以连上 Wi-Fi 了，使用 <code>iwconfig</code> 命令查看连接是否成功，已经获取的 IP ：</p><pre><code>pi@raspberrypi:~ $ iwconfig
wlan0     IEEE 802.11bgn  ESSID:&quot;TP-Link_30BBB8&quot;
          Mode:Managed  Frequency:2.412 GHz  Access Point: 8C:A6:DF:0C:7A:09
          Bit Rate=28.8 Mb/s   Tx-Power=31 dBm
          Retry short limit:7   RTS thr:off   Fragment thr:off
          Power Management:on
          Link Quality=44/70  Signal level=-66 dBm
          Rx invalid nwid:0  Rx invalid crypt:0  Rx invalid frag:0
          Tx excessive retries:2  Invalid misc:0   Missed beacon:0

lo        no wireless extensions.

eth0      no wireless extensions.
pi@raspberrypi:~ $ ifconfig
eth0      Link encap:Ethernet  HWaddr b8:27:eb:11:9b:de
          inet6 addr: fe80::3f3:df2a:426d:ab83/64 Scope:Link
          UP BROADCAST MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)

lo        Link encap:Local Loopback
          inet addr:127.0.0.1  Mask:255.0.0.0
          inet6 addr: ::1/128 Scope:Host
          UP LOOPBACK RUNNING  MTU:65536  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)

wlan0     Link encap:Ethernet  HWaddr b8:27:eb:44:ce:8b
          inet addr:192.168.1.103  Bcast:192.168.1.255  Mask:255.255.255.0
          inet6 addr: fe80::dba8:37ce:716a:a85/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:4429 errors:0 dropped:34 overruns:0 frame:0
          TX packets:160 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:327762 (320.0 KiB)  TX bytes:27347 (26.7 KiB)
</code></pre><h3 id=23-开启-ssh class="relative group">2.3. 开启 SSH <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#23-%e5%bc%80%e5%90%af-ssh aria-label=锚点>#</a></span></h3><p>系统默认没有开启 SSH ，需要在 TF 卡的根目录下新建一个空文件 SSH ，这样系统启动时就会启动 SSH ：</p><pre><code>pi@raspberrypi:~ $ sudo touch /boot/ssh
pi@raspberrypi:~ $ sudo reboot
</code></pre><p>查看 SSH 服务是否启动：</p><pre><code>pi@raspberrypi:~ $ systemctl status ssh
● ssh.service - OpenBSD Secure Shell server
   Loaded: loaded (/lib/systemd/system/ssh.service; enabled)
   Active: active (running) since Mon 2017-04-10 19:16:40 CST; 2min 2s ago
 Main PID: 697 (sshd)
   CGroup: /system.slice/ssh.service
           └─697 /usr/sbin/sshd -D
</code></pre><p>在 Mac 的终端里执行 <code>ssh pi@192.168.1.103</code> 登录树莓派。</p><blockquote><p>可以安装一个 lrzsz ，方便服务器端与客户端的文件传输：<code>sudo apt-get install lrzsz</code></p></blockquote><h3 id=24-更换源 class="relative group">2.4. 更换源 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#24-%e6%9b%b4%e6%8d%a2%e6%ba%90 aria-label=锚点>#</a></span></h3><p>编辑配置文件：</p><pre><code>pi@raspberrypi:~ $ sudo vi /etc/apt/sources.list
</code></pre><p>注释掉原地址，添加阿里云的源地址：</p><pre><code>deb http://mirrors.aliyun.com/raspbian/raspbian/ wheezy main non-free contrib
deb-src http://mirrors.aliyun.com/raspbian/raspbian/ wheezy main non-free contrib
</code></pre><p>保存文件后，更新系统软件：</p><pre><code>pi@raspberrypi:~ $ sudo apt-get update
</code></pre><p>清华的源速度也不错：</p><pre><code>deb http://mirrors.tuna.tsinghua.edu.cn/raspbian/raspbian/ jessie main non-free contrib
deb-src http://mirrors.tuna.tsinghua.edu.cn/raspbian/raspbian/ jessie main non-free contrib
</code></pre><h3 id=25-替换-vim class="relative group">2.5. 替换 Vim <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#25-%e6%9b%bf%e6%8d%a2-vim aria-label=锚点>#</a></span></h3><p>系统原装的 Vim 超难用，先卸载，再按照新的：</p><pre><code>pi@raspberrypi:~ $ sudo apt-get remove vim-common
pi@raspberrypi:~ $ sudo apt-get install vim
</code></pre><h3 id=26-设置-ssh-证书登录 class="relative group">2.6. 设置 SSH 证书登录 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#26-%e8%ae%be%e7%bd%ae-ssh-%e8%af%81%e4%b9%a6%e7%99%bb%e5%bd%95 aria-label=锚点>#</a></span></h3><p>暴露在外围的密码登录容易受到攻击，而且每次都要输密码，不够方便。真正生产环境中还是使用证书登录。配置需要如下几个步骤。</p><ol><li><p>生成一对秘钥，一路回车默认生成id_rsa和id_rsa.pub，前者是私钥，放在客户端，后者是公钥，需要放在ssh服务器：</p><pre><code> pi@raspberrypi:~ $ ssh-keygen -t rsa
 Generating public/private rsa key pair.
 Enter file in which to save the key (/home/pi/.ssh/id_rsa):
 Created directory '/home/pi/.ssh'.
 Enter passphrase (empty for no passphrase):
 Enter same passphrase again:
 Your identification has been saved in /home/pi/.ssh/id_rsa.
 Your public key has been saved in /home/pi/.ssh/id_rsa.pub.
 The key fingerprint is:
 63:c8:76:52:c1:14:bc:1b:8b:28:b2:02:7d:86:96:8f pi@raspberrypi
 The key's randomart image is:
 +---[RSA 2048]----+
 |       ++.       |
 |        o.       |
 |        ..       |
 |     . oo        |
 | . o .=.S+       |
 |o * +..+o.       |
 |.+ *             |
 |o E .            |
 |.                |
 +-----------------+
 pi@raspberrypi:~ $ cd .ssh/
 pi@raspberrypi:~/.ssh $ ls
 id_rsa  id_rsa.pub
</code></pre></li><li><p>在服务器端将 id_rsa.pub 添加到 authorized_keys ，然后配置 ssh_config</p><pre><code> pi@raspberrypi:~/.ssh $ cat id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys
 pi@raspberrypi:~ $ vim /etc/ssh/ssh_config    
 RSAAuthentication yes
 PubkeyAuthentication yes
 AuthorizedKeysFile  %h/.ssh/authorized_keys
</code></pre></li><li><p>把私钥 id_rsa 发送到客户端，由于我是 MacOS ，放在 ~/.ssh/ 目录下，更名为 raspberry_pi ，在 ~/.ssh/config 文件中添加一项配置：</p><pre><code> host pi
 HostName 192.168.1.103
 Port 22
 User pi
 IdentityFile ~/.ssh/raspberry_pi
</code></pre></li><li><p>在客户端使用 <code>ssh pi</code> 即可登录树莓派。</p></li></ol><h3 id=27-系统时间 class="relative group">2.7. 系统时间 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#27-%e7%b3%bb%e7%bb%9f%e6%97%b6%e9%97%b4 aria-label=锚点>#</a></span></h3><p>树莓派没有实时时钟，所以每次启动后要用 ntp 对时，否则时间不准。默认设置的 ntp 服务器连接较慢，可以添加一些境内的 ntp 服务器。编辑 /etc/ntp.conf 文件，找到如下两行：</p><pre><code># You do need to talk to an NTP server or two (or three).
#server ntp.your-provider.example
</code></pre><p>在这行后面添加：</p><pre><code>server ntp.fudan.edu.cn iburst
server time.asia.apple.com iburst
server asia.pool.ntp.org iburst
server ntp.nict.jp iburst
server time.nist.gov iburst
</code></pre><p>保存后重启 ntpd ：</p><pre><code>pi@raspberrypi:~ $ sudo systemctl restart ntp.service
</code></pre><h3 id=28-配置以太网 class="relative group">2.8. 配置以太网 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#28-%e9%85%8d%e7%bd%ae%e4%bb%a5%e5%a4%aa%e7%bd%91 aria-label=锚点>#</a></span></h3><p>树莓派有一个以太网卡 eth0 ，默认是 dhcp 方式自动分配 IP ，要改成静态 IP 需要编辑 /etc/network/interfaces 文件，将 eth0 的配置删除，添加如下内容：</p><pre><code>auto eth0
iface eth0 inet static
    address 192.168.5.252
    netmask 255.255.255.0
    gateway 192.168.5.50
    dns-nameservers 192.168.0.99
</code></pre><p>保存后重启 network 服务：</p><pre><code>pi@raspberrypi:~ $ sudo systemctl restart networking.service
</code></pre><h2 id=3-硬件编程开发 class="relative group">3. 硬件编程开发 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#3-%e7%a1%ac%e4%bb%b6%e7%bc%96%e7%a8%8b%e5%bc%80%e5%8f%91 aria-label=锚点>#</a></span></h2><p>树莓派通过 40 pin 排针引出 26 路 GPIO ，输出高电平 3.3V ，部分 GPIO 有复用功能，包括一个两线 I2C ，一个四线 SPI ，一个 UART ，信号定义如下：</p><p><figure><img src=./pics/2017-05-09_2.jpg alt class="mx-auto my-0 rounded-md"></figure></p><p>读写 GPIO 可以用 C 语言或者 Python ，官方推荐的 Python GPIO 是一个小型 Python 库，但是不支持 SPI 、I2C 等 GPIO 的复用功能，使用 C 语言开发的 WiringPi 更受欢迎：<a href=http://wiringpi.com/ target=_blank rel=noreferrer>http://wiringpi.com/</a> ，它提供了一个 C 语言开发库， API 风格类似 Arduino ，可以访问 GPIO 管脚的所有功能，还提供了一个命令行工具 gpio ，可以直接访问 GPIO 管脚。</p><h3 id=31-下载安装 class="relative group">3.1. 下载安装 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#31-%e4%b8%8b%e8%bd%bd%e5%ae%89%e8%a3%85 aria-label=锚点>#</a></span></h3><p>先按照 git ，然后通过 git 下载源码：</p><pre><code>pi@raspberrypi:~ $ sudo apt-get install git
pi@raspberrypi:~ $ git clone git://git.drogon.net/wiringPi
</code></pre><p>安装：</p><pre><code>pi@raspberrypi:~ $  cd ~/wiringPi
pi@raspberrypi:~ $  ./build
</code></pre><p>测试是否安装成功：</p><pre><code>pi@raspberrypi:~/wiringPi $ gpio -v
gpio version: 2.44
Copyright (c) 2012-2017 Gordon Henderson
This is free software with ABSOLUTELY NO WARRANTY.
For details type: gpio -warranty

Raspberry Pi Details:
    Type: Pi 3, Revision: 02, Memory: 1024MB, Maker: Sony
    * Device tree is enabled. 
    * --&gt; Raspberry Pi 3 Model B Rev 1.2
    * This Raspberry Pi supports user-level GPIO access.
</code></pre><h3 id=32-wiringpi-的管脚编码 class="relative group">3.2. WiringPi 的管脚编码 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#32-wiringpi-%e7%9a%84%e7%ae%a1%e8%84%9a%e7%bc%96%e7%a0%81 aria-label=锚点>#</a></span></h3><p>WiringPi 的 GPIO 管脚编号与连接器上的硬件硬件编号并不一致，获取当前树莓派的 GPIO 管脚描述的方法是使用 gpio 命令：</p><pre><code>pi@raspberrypi:~/wiringPi $ gpio readall
 +-----+-----+---------+------+---+---Pi 3---+---+------+---------+-----+-----+
 | BCM | wPi |   Name  | Mode | V | Physical | V | Mode | Name    | wPi | BCM |
 +-----+-----+---------+------+---+----++----+---+------+---------+-----+-----+
 |     |     |    3.3v |      |   |  1 || 2  |   |      | 5v      |     |     |
 |   2 |   8 |   SDA.1 |   IN | 1 |  3 || 4  |   |      | 5v      |     |     |
 |   3 |   9 |   SCL.1 |   IN | 1 |  5 || 6  |   |      | 0v      |     |     |
 |   4 |   7 | GPIO. 7 |   IN | 1 |  7 || 8  | 0 | IN   | TxD     | 15  | 14  |
 |     |     |      0v |      |   |  9 || 10 | 1 | IN   | RxD     | 16  | 15  |
 |  17 |   0 | GPIO. 0 |   IN | 0 | 11 || 12 | 0 | IN   | GPIO. 1 | 1   | 18  |
 |  27 |   2 | GPIO. 2 |   IN | 0 | 13 || 14 |   |      | 0v      |     |     |
 |  22 |   3 | GPIO. 3 |   IN | 0 | 15 || 16 | 0 | IN   | GPIO. 4 | 4   | 23  |
 |     |     |    3.3v |      |   | 17 || 18 | 0 | IN   | GPIO. 5 | 5   | 24  |
 |  10 |  12 |    MOSI |   IN | 0 | 19 || 20 |   |      | 0v      |     |     |
 |   9 |  13 |    MISO |   IN | 0 | 21 || 22 | 0 | IN   | GPIO. 6 | 6   | 25  |
 |  11 |  14 |    SCLK |   IN | 0 | 23 || 24 | 1 | IN   | CE0     | 10  | 8   |
 |     |     |      0v |      |   | 25 || 26 | 1 | IN   | CE1     | 11  | 7   |
 |   0 |  30 |   SDA.0 |   IN | 1 | 27 || 28 | 1 | IN   | SCL.0   | 31  | 1   |
 |   5 |  21 | GPIO.21 |   IN | 1 | 29 || 30 |   |      | 0v      |     |     |
 |   6 |  22 | GPIO.22 |   IN | 1 | 31 || 32 | 0 | IN   | GPIO.26 | 26  | 12  |
 |  13 |  23 | GPIO.23 |   IN | 0 | 33 || 34 |   |      | 0v      |     |     |
 |  19 |  24 | GPIO.24 |   IN | 0 | 35 || 36 | 0 | IN   | GPIO.27 | 27  | 16  |
 |  26 |  25 | GPIO.25 |   IN | 0 | 37 || 38 | 0 | IN   | GPIO.28 | 28  | 20  |
 |     |     |      0v |      |   | 39 || 40 | 0 | IN   | GPIO.29 | 29  | 21  |
 +-----+-----+---------+------+---+----++----+---+------+---------+-----+-----+
 | BCM | wPi |   Name  | Mode | V | Physical | V | Mode | Name    | wPi | BCM |
 +-----+-----+---------+------+---+---Pi 3---+---+------+---------+-----+-----+
</code></pre><p>这个命令会生成一张图片，描述当前树莓派的 GPIO 连接器管脚与 WiringPi 中的管脚编号的映射关系，上图是 Raspberry Pi 3 Model B 型的。</p><h3 id=33-gpio class="relative group">3.3. GPIO <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#33-gpio aria-label=锚点>#</a></span></h3><p>WiringPi 提供了多个初始化函数：</p><ul><li>int wiringPiSetup (void) ;</li><li>int wiringPiSetupGpio (void) ;</li><li>int wiringPiSetupPhys (void) ;</li><li>int wiringPiSetupSys (void) ;</li></ul><p>程序开始的时候，必须调用其中一个，且需要 root 权限。通常调用 wiringPiSetup(void) 即可，它的作用是初始化 WiringPi 编程环境和 GPIO 管脚映射。wiringPiSetupGpio(void) 和 wiringPiSetupPhys(void) 会用树莓派的 GPIO 编号或者连接器管脚编号替代 WiringPi 的编号，wiringPiSetupSys(void) 会用 /sys/class/gpio 接口来代替直接访问硬件，也称为 sys 模式，这三个函数都很少使用。</p><p>访问 GPIO 主要需要如下函数，这些函数在 sys 模式下都是无效的：</p><ul><li>void pinMode (int pin, int mode) ;</li></ul><p>设置某个管脚的模式为 INPUT, OUTPUT, PWM_OUTPUT 或者 GPIO_CLOCK 。只有 wiringPi pin 1 (BCM_GPIO 18) 支持 PWM 输出 ，只有 wiringPi pin 7 (BCM_GPIO 4) 支持 CLOCK 输出。</p><ul><li>void pullUpDnControl (int pin, int pud) ;</li></ul><p>设置某个输入管脚的上拉和下拉电阻，PUD_OFF 表示关闭上下拉电阻, PUD_DOWN 表示下拉到地，PUD_UP 表示上拉倒 3.3V ，上下拉电阻大约 50KΩ 。</p><ul><li>void digitalWrite (int pin, int value) ;</li></ul><p>向某个输出管脚写值，HIGH 表示高电平， LOW 表示低电平。</p><ul><li>int digitalRead (int pin) ;</li></ul><p>读取某个输入管脚的状态，返回 HIGH 表示高电平，LOW 表示低电平。</p><h3 id=34-spi class="relative group">3.4. SPI <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#34-spi aria-label=锚点>#</a></span></h3><p>编程访问 SPI 前，要用 gpio 加载 SPI 驱动：</p><pre><code>gpio load spi
</code></pre><p>编辑代码时要包含头文件：</p><pre><code>#include &lt;wiringPiSPI.h&gt;
</code></pre><p>编译时要手动链接 ： <code>-lwiringPi</code> 。</p><h3 id=35-uart class="relative group">3.5. UART <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#35-uart aria-label=锚点>#</a></span></h3><h2 id=4-搭建-nas-服务 class="relative group">4. 搭建 NAS 服务 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#4-%e6%90%ad%e5%bb%ba-nas-%e6%9c%8d%e5%8a%a1 aria-label=锚点>#</a></span></h2><h3 id=41-硬件配置 class="relative group">4.1. 硬件配置 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#41-%e7%a1%ac%e4%bb%b6%e9%85%8d%e7%bd%ae aria-label=锚点>#</a></span></h3><p>准备一块移动硬盘，因为树莓派的 USB 口驱动能力有限，最好用双 USB 口数据线，为移动硬盘独立供电，格式化为 ext4 ，我这里的分区是 sda1 ：</p><pre><code>pi@raspberrypi:~ $ sudo fdisk /dev/sda -l

Disk /dev/sda: 149.1 GiB, 160041885696 bytes, 312581808 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0x9fd95492

Device     Boot Start       End   Sectors   Size Id Type
/dev/sda1        2048 312581807 312579760 149.1G 83 Linux
</code></pre><p>为了让系统启动时自动挂在移动硬盘，需要修改 /etc/fstab 文件，添加 sda1 的配置，记得修改前先备份：</p><pre><code>pi@raspberrypi:/etc $ cat fstab
proc            /proc           proc    defaults          0       0
PARTUUID=5b2de8de-01  /boot           vfat    defaults          0       2
PARTUUID=5b2de8de-02  /               ext4    defaults,noatime  0       1
/dev/sda1             /home/pi/nas    ext4    defaults,noatime  0       0
# a swapfile is not a swap partition, no line here
#   use  dphys-swapfile swap[on|off]  for that
</code></pre><p>创建挂在目录：</p><pre><code>pi@raspberrypi:~ $ mkdir /home/pi/nas
</code></pre><p>重启后查看挂载信息：</p><pre><code>pi@raspberrypi:~ $ df
Filesystem     1K-blocks    Used Available Use% Mounted on
/dev/root       29787900 1959324  26593012   7% /
devtmpfs          469532       0    469532   0% /dev
tmpfs             473864       0    473864   0% /dev/shm
tmpfs             473864   12260    461604   3% /run
tmpfs               5120       4      5116   1% /run/lock
tmpfs             473864       0    473864   0% /sys/fs/cgroup
/dev/mmcblk0p1     41322   20763     20559  51% /boot
/dev/sda1      153705340   60864 145813600   1% /home/pi/nas
</code></pre><h3 id=42-文件共享 class="relative group">4.2. 文件共享 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#42-%e6%96%87%e4%bb%b6%e5%85%b1%e4%ba%ab aria-label=锚点>#</a></span></h3><p>Samba 可以实现树莓派上的文件在局域网内的共享。安装必要的文件：</p><pre><code>pi@raspberrypi:~ $  sudo apt-get install samba samba-common-bin -y
</code></pre><blockquote><p>如果分区是 NTFS 格式，需要安装 NTFS 支持：<code>sudo apt-get install ntfs-3g</code> 。如果是 exFAT 格式，则选用安装 exfat-utils 。</p></blockquote><p>创建共享文件夹 shares：</p><pre><code>pi@raspberrypi:~ $ sudo mkdir  /home/pi/nas/shares
</code></pre><p>编辑配置文件 /etc/samba/smb.conf ，替换成如下内容：</p><pre><code>[global]
security = user
encrypt passwords = true
guest account = nobody
map to guest = bad user

#======================= Share Definitions =======================
[share]
comment = Guest access shares
path = /home/pi/nas/shares/
browseable = yes
writable = yes
#read only = yes
guest ok = yes
public = yes

[NAS-Data]
comment = Nas data folder
path = /home/pi/nas/
browseable = yes
writable = yes
valid users = root pi
</code></pre><p>需要为 samba 添加一个 pi 账户：</p><pre><code>pi@raspberrypi:~/nas $ sudo smbpasswd -a pi
New SMB password:
Retype new SMB password:
Added user pi.
</code></pre><p>重启 samba 服务，确保启动成功：</p><pre><code>pi@raspberrypi:~/nas $ sudo systemctl restart smbd.service
pi@raspberrypi:~/nas $ sudo systemctl status smbd.service
● smbd.service - LSB: start Samba SMB/CIFS daemon (smbd)
   Loaded: loaded (/etc/init.d/smbd)
   Active: active (running) since Mon 2017-04-10 19:17:04 CST; 2s ago
  Process: 5272 ExecStop=/etc/init.d/smbd stop (code=exited, status=0/SUCCESS)
  Process: 5122 ExecReload=/etc/init.d/smbd reload (code=exited, status=0/SUCCESS)
  Process: 5313 ExecStart=/etc/init.d/smbd start (code=exited, status=0/SUCCESS)
   CGroup: /system.slice/smbd.service
           ├─5324 /usr/sbin/smbd -D
           └─5329 /usr/sbin/smbd -D

Apr 10 19:17:04 raspberrypi smbd[5313]: Starting SMB/CIFS daemon: smbd.
Apr 10 19:17:04 raspberrypi systemd[1]: Started LSB: start Samba SMB/CIFS daemon (smbd).
Apr 10 19:17:04 raspberrypi smbd[5324]: [2017/04/10 19:17:04.479386,  0] ../lib/util/become_daemon.c:124(daemon_ready)
Apr 10 19:17:04 raspberrypi smbd[5324]: STATUS=daemon 'smbd' finished starting up and ready to serve connections
</code></pre><p>在 MAC 中打开 Finder > 前往 > 网络 ，就可以看到树莓派的共享文件夹，访问 share 共享目录无需密码，而 NAS-Data 需要密码验证：</p><p><figure><img src=./pics/2017-05-09_3.png alt class="mx-auto my-0 rounded-md"></figure></p><h3 id=43-ftp-服务器 class="relative group">4.3. FTP 服务器 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#43-ftp-%e6%9c%8d%e5%8a%a1%e5%99%a8 aria-label=锚点>#</a></span></h3><p>在树莓派上安装 vsftpd ：</p><pre><code>pi@raspberrypi:~ $ sudo apt-get install vsftpd
</code></pre><p>编辑配置文件 /etc/vsftpd.conf ，修改如下选项：</p><pre><code>#禁止匿名访问
anonymous_enable=NO  
#设定本地用户可以访问
local_enable=YES
#设定可以进行写操作
write_enable=YES
#设定上传后文件的权限掩码
local_umask=022
#设定根目录
local_root=/home/pi/
</code></pre><p>用 ftp 客户端软件登录：</p><p><figure><img src=./pics/2017-05-09_4.png alt class="mx-auto my-0 rounded-md"></figure></p><h2 id=5-移植-uci class="relative group">5. 移植 UCI <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#5-%e7%a7%bb%e6%a4%8d-uci aria-label=锚点>#</a></span></h2><p>UCI 是 OpenWRT 的一个配置工具，提供 C 语言 API 和 Shell 命令接口，可以方便的自定义配置文件。uci 的编译需要 CMake ，先安装 CMake ：</p><pre><code>pi@raspberrypi:~ $ sudo apt-get install cmake
</code></pre><p>安装 libluajit-dev ，否则会出现 <code>lauxlib.h: No such file or directory</code> 这样的错误 :</p><pre><code>pi@raspberrypi:~ $ sudo apt-get install libluajit-5.1-dev
</code></pre><p>通过 git 下载 uci 的源码包：</p><pre><code>pi@raspberrypi:~ $ git clone https://github.com/jkjuopperi/uci.git
</code></pre><p>用 pkg-config 查询刚才的 libluajit-dev 的头文件目录：</p><pre><code>pi@raspberrypi:~ $ pkg-config --cflags --libs luajit
-I/usr/include/luajit-2.0 -lluajit-5.1
</code></pre><p>然后进入 uci 目录，在 CMakeLists.txt 文件中靠前位置添加如下一行，指定头文件目录，否则编译的时候找不到：</p><pre><code>INCLUDE_DIRECTORIES(&quot;/usr/include/luajit-2.0/&quot;)
</code></pre><p>保存后开始编译安装：</p><pre><code>pi@raspberrypi:~/uci $ cmake  .
pi@raspberrypi:~/uci $ make
pi@raspberrypi:~/uci $ sudo make install
[ 27%] Built target uci-static
[ 54%] Built target uci-shared
[ 63%] Built target cli
[ 72%] Built target cli-static
[ 81%] Built target ucimap
[ 90%] Built target ucimap-example
[100%] Built target uci_lua
Install the project...
-- Install configuration: &quot;&quot;
-- Installing: /usr/local/include/uci.h
-- Installing: /usr/local/include/uci_config.h
-- Installing: /usr/local/include/ucimap.h
-- Installing: /usr/local/lib/libuci.so
-- Installing: /usr/local/lib/libuci.a
-- Installing: /usr/local/bin/uci
-- Set runtime path of &quot;/usr/local/bin/uci&quot; to &quot;&quot;
-- Installing: /usr/local/bin/uci-static
-- Installing: /usr/local/lib/lua/5.1/uci.so
-- Set runtime path of &quot;/usr/local/lib/lua/5.1/uci.so&quot; to &quot;&quot;
</code></pre><p>安装后需要执行一次 <code>sudo ldconfig -v</code>，否则可能找不到新装的库文件，uci 默认将配置文件放在 /etc/config 目录下，所以新建该目录，执行 uci ，如下表示安装成功：</p><pre><code>pi@raspberrypi:~/uci $ uci
Usage: uci [&lt;options&gt;] &lt;command&gt; [&lt;arguments&gt;]

Commands:
        batch
        export     [&lt;config&gt;]
        import     [&lt;config&gt;]
        changes    [&lt;config&gt;]
        commit     [&lt;config&gt;]
        add        &lt;config&gt; &lt;section-type&gt;
        add_list   &lt;config&gt;.&lt;section&gt;.&lt;option&gt;=&lt;string&gt;
        show       [&lt;config&gt;[.&lt;section&gt;[.&lt;option&gt;]]]
        get        &lt;config&gt;.&lt;section&gt;[.&lt;option&gt;]
        set        &lt;config&gt;.&lt;section&gt;[.&lt;option&gt;]=&lt;value&gt;
        delete     &lt;config&gt;[.&lt;section[.&lt;option&gt;]]
        rename     &lt;config&gt;.&lt;section&gt;[.&lt;option&gt;]=&lt;name&gt;
        revert     &lt;config&gt;[.&lt;section&gt;[.&lt;option&gt;]]
        reorder    &lt;config&gt;.&lt;section&gt;=&lt;position&gt;

Options:
        -c &lt;path&gt;  set the search path for config files (default: /etc/config)
        -d &lt;str&gt;   set the delimiter for list values in uci show
        -f &lt;file&gt;  use &lt;file&gt; as input instead of stdin
        -L         do not load any plugins
        -m         when importing, merge data into an existing package
        -n         name unnamed sections on export (default)
        -N         don't name unnamed sections
        -p &lt;path&gt;  add a search path for config change files
        -P &lt;path&gt;  add a search path for config change files and use as default
        -q         quiet mode (don't print error messages)
        -s         force strict mode (stop on parser errors, default)
        -S         disable strict mode
        -X         do not use extended syntax on 'show'
</code></pre><h2 id=6-web-开发 class="relative group">6. Web 开发 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#6-web-%e5%bc%80%e5%8f%91 aria-label=锚点>#</a></span></h2><p>使用 Django + Nginx 搭建一个静态站点。</p><h3 id=61-安装-nginx class="relative group">6.1. 安装 Nginx <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#61-%e5%ae%89%e8%a3%85-nginx aria-label=锚点>#</a></span></h3><p>安装 nginx ，安装后会自动启动：</p><pre><code>pi@raspberrypi:~ $ sudo apt-get install nginx
pi@raspberrypi:~ $ systemctl status nginx.service 
â— nginx.service - A high performance web server and a reverse proxy server
   Loaded: loaded (/lib/systemd/system/nginx.service; enabled)
   Active: active (running) since Tue 2017-09-26 22:32:43 CST; 16h ago
 Main PID: 756 (nginx)
   CGroup: /system.slice/nginx.service
           â”œâ”€756 nginx: master process /usr/sbin/nginx -g daemon on; master_process on;
           â”œâ”€757 nginx: worker process
           â”œâ”€758 nginx: worker process
           â”œâ”€759 nginx: worker process
           â””â”€760 nginx: worker process
</code></pre><p>通过浏览器访问树莓派的 IP ，可以如下页面：</p><p><figure><img src=./pics/2017-05-09_5.png alt class="mx-auto my-0 rounded-md"></figure></p><h3 id=62-安装-django class="relative group">6.2. 安装 Django <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#62-%e5%ae%89%e8%a3%85-django aria-label=锚点>#</a></span></h3><p>先安装 pip ：</p><pre><code>pi@raspberrypi:~ $ curl  https://bootstrap.pypa.io/get-pip.py -o get-pip.py
pi@raspberrypi:~ $ sudo python  get-pip.py
</code></pre><p>然后安装 Django 框架：</p><pre><code>pi@raspberrypi:~ $ sudo pip install django
</code></pre><h3 id=63-安装-uwsgi class="relative group">6.3. 安装 uWSGI <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#63-%e5%ae%89%e8%a3%85-uwsgi aria-label=锚点>#</a></span></h3><p>安装 python-dev ，否则下一步安装 uwsgi 会失败：</p><pre><code>pi@raspberrypi:~ $ sudo apt-get install python-dev
</code></pre><p>安装 uwsgi ：</p><pre><code>pi@raspberrypi:~ $ sudo pip install uwsgi
</code></pre><p>新建一个 test.py 文件，写入如下代码：</p><pre><code># test.py
def application(env, start_response):
    start_response('200 OK', [('Content-Type','text/html')])
    return [&quot;Hello uWSGI&quot;] # python2
</code></pre><p>保存后执行：</p><pre><code>pi@raspberrypi:~ $ uwsgi --http :8000 --wsgi-file test.py
</code></pre><p>打开浏览器，访问 <code>http://localhost_ip:8000</code> ，显示 <code>Hello uWSGI</code>，说明 <code>Web client - uWSGI - Python</code> 三个环节是畅通的：</p><p><figure><img src=./pics/2017-05-09_6.png alt class="mx-auto my-0 rounded-md"></figure></p></div></section><footer class="max-w-prose pt-8 print:hidden"><div class=flex><picture class="!mb-0 !mt-0 me-4 w-24 h-auto rounded-full"><img width=568 height=568 class="!mb-0 !mt-0 me-4 w-24 h-auto rounded-full" alt=Shaocheng.Li loading=lazy decoding=async src=/img/author.png></picture><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">作者</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">Shaocheng.Li</div><div class="text-sm text-neutral-700 dark:text-neutral-400">A Linux software engineer.</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 transition-transform hover:scale-125 hover:text-primary-700 dark:hover:text-primary-400" style=will-change:transform href=https://github.com/exbob target=_blank aria-label=Github rel="me noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></a></div></div></div></div><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="group flex" href=/posts/2017/03/27/><span class="me-2 text-neutral-700 transition-transform group-hover:-translate-x-[2px] group-hover:text-primary-600 dark:text-neutral dark:group-hover:text-primary-400"><span class="ltr:inline rtl:hidden">&larr;</span><span class="ltr:hidden rtl:inline">&rarr;</span></span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Linux 串口编程笔记</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2017-03-27 08:00:00 +0800 +0800">2017 27 三月</time>
</span></span></a></span><span><a class="group flex text-right" href=/posts/2017/05/16/><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">RSA 加密算法与数字证书</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2017-05-16 08:00:00 +0800 +0800">2017 16 五月</time>
</span></span><span class="ms-2 text-neutral-700 transition-transform group-hover:-translate-x-[-2px] group-hover:text-primary-600 dark:text-neutral dark:group-hover:text-primary-400"><span class="ltr:inline rtl:hidden">&rarr;</span><span class="ltr:hidden rtl:inline">&larr;</span></span></a></span></div></div></footer></article></main><div class="pointer-events-none absolute bottom-0 end-0 top-[100vh] w-12" id=to-top hidden=true><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 backdrop-blur hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label=回到顶部 title=回到顶部>&uarr;</a></div><footer class="py-10 print:hidden"><div class="flex items-center justify-between"><div><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2025
Shaocheng.Li</p><p class="text-xs text-neutral-500 dark:text-neutral-400">由 <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://github.com/jpanther/congo target=_blank rel="noopener noreferrer">Congo</a> 强力驱动</p></div><div class="flex flex-row items-center"></div></div></footer><div id=search-wrapper class="invisible fixed inset-0 z-50 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]" data-url=https://shaocheng.li/><div id=search-modal class="top-20 mx-auto flex min-h-0 w-full max-w-3xl flex-col rounded-md border border-neutral-200 bg-neutral shadow-lg dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex flex-none items-center justify-between px-2"><form class="flex min-w-0 flex-auto items-center"><div class="flex h-8 w-8 items-center justify-center text-neutral-400"><span class="icon relative inline-block px-1 align-text-bottom"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="mx-1 flex h-12 flex-auto appearance-none bg-transparent focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=搜索 tabindex=0></form><button id=close-search-button class="flex h-8 w-8 items-center justify-center text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="关闭 (Esc)">
<span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto overflow-auto px-2"><ul id=search-results></ul></section></div></div></div></body></html>