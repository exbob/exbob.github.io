<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="Shaocheng.Li"><meta name=description content="netdevice 是 glibc 提供的访问网卡设备的低级接口，支持标准 ioctl 函数，需要的头文件是：
#include &amp;lt;sys/ioctl.h&amp;gt;#include &amp;lt;net/if.h&amp;gt; 使用方法是调用 ioctl 函数访问 socket 文件，基本语法是：
ioctl(int fd, int request, struct ifreq *); int fd 应该是一个 socket 文件描述符，主要通过 struct ifreq 结构传递数据：
struct ifreq { char ifr_name[IFNAMSIZ]; /* Interface name */ union { struct sockaddr ifr_addr; // IP 地址  struct sockaddr ifr_dstaddr; struct sockaddr ifr_broadaddr; // 广播地址  struct sockaddr ifr_netmask; // 子网掩码  struct sockaddr ifr_hwaddr; // MAC 地址  short ifr_flags; int ifr_ifindex; int ifr_metric; int ifr_mtu; struct ifmap ifr_map; char ifr_slave[IFNAMSIZ]; char ifr_newname[IFNAMSIZ]; char *ifr_data; }; }; 使用方法："><meta name=keywords content><meta name=robots content="noodp"><meta name=theme-color content="#252627"><link rel=canonical href=https://shaocheng.li/posts/2021/10/26/><title>Linux 下使用 ioctl 接口访问指定网卡 :: Shaocheng.Li — Hello Friends</title><link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css rel=stylesheet type=text/css><link rel=stylesheet href=https://shaocheng.li/main.min.e9b3dfcc5ffe9d55eb281ecaf47cf6179d26eec497e087299934d581c987aa0b.css><link rel=stylesheet type=text/css href=https://shaocheng.li/css/custom.css><link rel=apple-touch-icon sizes=180x180 href=https://shaocheng.li/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://shaocheng.li/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://shaocheng.li/favicon-16x16.png><link rel=manifest href=https://shaocheng.li/site.webmanifest><link rel=mask-icon href=https://shaocheng.li/safari-pinned-tab.svg color=#252627><link rel="shortcut icon" href=https://shaocheng.li/favicon.ico><meta name=msapplication-TileColor content="#252627"><meta name=theme-color content="#252627"><meta itemprop=name content="Linux 下使用 ioctl 接口访问指定网卡"><meta itemprop=description content="netdevice 是 glibc 提供的访问网卡设备的低级接口，支持标准 ioctl 函数，需要的头文件是：
#include &lt;sys/ioctl.h&gt;#include &lt;net/if.h&gt; 使用方法是调用 ioctl 函数访问 socket 文件，基本语法是：
ioctl(int fd, int request, struct ifreq *); int fd 应该是一个 socket 文件描述符，主要通过 struct ifreq 结构传递数据：
struct ifreq { char ifr_name[IFNAMSIZ]; /* Interface name */ union { struct sockaddr ifr_addr; // IP 地址  struct sockaddr ifr_dstaddr; struct sockaddr ifr_broadaddr; // 广播地址  struct sockaddr ifr_netmask; // 子网掩码  struct sockaddr ifr_hwaddr; // MAC 地址  short ifr_flags; int ifr_ifindex; int ifr_metric; int ifr_mtu; struct ifmap ifr_map; char ifr_slave[IFNAMSIZ]; char ifr_newname[IFNAMSIZ]; char *ifr_data; }; }; 使用方法："><meta itemprop=datePublished content="2021-10-26T20:09:49&#43;08:00"><meta itemprop=dateModified content="2021-10-26T20:09:49&#43;08:00"><meta itemprop=wordCount content="619"><meta itemprop=keywords content="untagged,"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://shaocheng.li"><meta name=twitter:title content="Linux 下使用 ioctl 接口访问指定网卡"><meta name=twitter:description content="netdevice 是 glibc 提供的访问网卡设备的低级接口，支持标准 ioctl 函数，需要的头文件是：
#include &lt;sys/ioctl.h&gt;#include &lt;net/if.h&gt; 使用方法是调用 ioctl 函数访问 socket 文件，基本语法是：
ioctl(int fd, int request, struct ifreq *); int fd 应该是一个 socket 文件描述符，主要通过 struct ifreq 结构传递数据：
struct ifreq { char ifr_name[IFNAMSIZ]; /* Interface name */ union { struct sockaddr ifr_addr; // IP 地址  struct sockaddr ifr_dstaddr; struct sockaddr ifr_broadaddr; // 广播地址  struct sockaddr ifr_netmask; // 子网掩码  struct sockaddr ifr_hwaddr; // MAC 地址  short ifr_flags; int ifr_ifindex; int ifr_metric; int ifr_mtu; struct ifmap ifr_map; char ifr_slave[IFNAMSIZ]; char ifr_newname[IFNAMSIZ]; char *ifr_data; }; }; 使用方法："><meta property="article:published_time" content="2021-10-26 20:09:49 &#43;0800 &#43;0800"></head><body><div class=container><header class=header><span class=header__inner><a href=https://shaocheng.li/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>$ cd /home/</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=https://shaocheng.li/about/>About</a></li><li><a href=https://shaocheng.li/posts/>Posts</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41C32.4934 41 41 32.4934 41 22 41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>3 minutes</p></div><article><h1 class=post-title><a href=https://shaocheng.li/posts/2021/10/26/>Linux 下使用 ioctl 接口访问指定网卡</a></h1><hr><aside id=toc><div class=toc-title>Table of Contents</div></aside><hr><div class=post-content><p><a href=https://man7.org/linux/man-pages/man7/netdevice.7.html target=_blank>netdevice</a> 是 glibc 提供的访问网卡设备的低级接口，支持标准 ioctl 函数，需要的头文件是：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;sys/ioctl.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;net/if.h&gt;</span></code></pre></div><p>使用方法是调用 ioctl 函数访问 socket 文件，基本语法是：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c>ioctl(<span style=color:#66d9ef>int</span> fd, <span style=color:#66d9ef>int</span> request, <span style=color:#66d9ef>struct</span> ifreq <span style=color:#f92672>*</span>);</code></pre></div><p><code>int fd</code> 应该是一个 socket 文件描述符，主要通过 <code>struct ifreq</code> 结构传递数据：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#66d9ef>struct</span> ifreq
{
    <span style=color:#66d9ef>char</span> ifr_name[IFNAMSIZ]; <span style=color:#75715e>/* Interface name */</span>
    <span style=color:#66d9ef>union</span>
    {
        <span style=color:#66d9ef>struct</span> sockaddr ifr_addr; <span style=color:#75715e>// IP 地址
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>struct</span> sockaddr ifr_dstaddr;
        <span style=color:#66d9ef>struct</span> sockaddr ifr_broadaddr; <span style=color:#75715e>// 广播地址
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>struct</span> sockaddr ifr_netmask;  <span style=color:#75715e>// 子网掩码
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>struct</span> sockaddr ifr_hwaddr;   <span style=color:#75715e>// MAC 地址
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>short</span> ifr_flags;
        <span style=color:#66d9ef>int</span> ifr_ifindex;
        <span style=color:#66d9ef>int</span> ifr_metric;
        <span style=color:#66d9ef>int</span> ifr_mtu;
        <span style=color:#66d9ef>struct</span> ifmap ifr_map;
        <span style=color:#66d9ef>char</span> ifr_slave[IFNAMSIZ];
        <span style=color:#66d9ef>char</span> ifr_newname[IFNAMSIZ];
        <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>ifr_data;
    };
};</code></pre></div><p>使用方法：</p><ol><li>新建一个 AF_INET 地址的 socket 文件</li><li>新建一个 <code>struct ifreq</code> 结构，并设置 <code>ifr_name</code> 为指定的网卡名称，例如 eth0</li><li>调用 <code>ioctl</code> ，通过 request 指定要访问的信息，通过 <code>struct ifreq</code> 结构传递数据</li><li>解析 <code>struct ifreq</code> 结构。</li></ol><p>支持的 request 包括：</p><ul><li><p>SIOCGIFFLAGS, SIOCSIFFLAGS ：获取、设置网卡的 Flag ，通过 <code>ifreq-&gt;ifr_flags</code> 传递数据，ifr_flags 包含一个由以下数值组成的位掩码。</p><ul><li>IFF_UP Interface is running.</li><li>IFF_BROADCAST Valid broadcast address set.</li><li>IFF_DEBUG Internal debugging flag.</li><li>IFF_LOOPBACK Interface is a loopback interface.</li><li>IFF_POINTOPOINT Interface is a point-to-point link.</li><li>IFF_RUNNING Resources allocated.</li><li>IFF_NOARP No arp protocol, L2 destination address not set.</li><li>IFF_PROMISC Interface is in promiscuous mode.</li><li>IFF_NOTRAILERS Avoid use of trailers.</li><li>IFF_ALLMULTI Receive all multicast packets.</li><li>IFF_MASTER Master of a load balancing bundle.</li><li>IFF_SLAVE Slave of a load balancing bundle.</li><li>IFF_MULTICAST Supports multicast</li><li>IFF_PORTSEL Is able to select media type via ifmap.</li><li>IFF_AUTOMEDIA Auto media selection active.</li><li>IFF_DYNAMIC The addresses are lost when the interface goes down.</li></ul></li><li><p>SIOCGIFADDR, SIOCSIFADDR, SIOCDIFADDR ：获取、设置和删除网卡的 IP ，通过 <code>ifreq-&gt;ifr_addr</code> 传递数据</p></li><li><p>SIOCGIFNETMASK, SIOCSIFNETMASK ：获取、设置子网掩码，通过 <code>ifreq-&gt;ifr_netmask</code> 传递数据</p></li><li><p>SIOCGIFBRDADDR, SIOCSIFBRDADDR ：获取、设置广播地址，通过 <code>ifreq-&gt;ifr_broadaddr</code> 传递数据</p></li><li><p>SIOCGIFHWADDR, SIOCSIFHWADDR ：获取、设置 MAC 地址，通过 <code>ifreq-&gt;ifr_hwaddr</code> 传递数据</p></li><li><p>SIOCGIFMTU, SIOCSIFMTU ：获取、设置 MTU ，通过 <code>ifreq-&gt;ifr_mtu</code> 传递数据</p></li></ul><p>例如 SIOCGIFADDR 可以获得 IP 地址：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdio.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;string.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;sys/socket.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;sys/ioctl.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;net/if.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;netinet/in.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;arpa/inet.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>()
{
    <span style=color:#66d9ef>int</span> fd;
    <span style=color:#66d9ef>struct</span> ifreq ifr;
    <span style=color:#66d9ef>struct</span> in_addr addr;
	
    <span style=color:#75715e>// 1. 新建一个 socket
</span><span style=color:#75715e></span>    fd <span style=color:#f92672>=</span> socket(AF_INET, SOCK_DGRAM, <span style=color:#ae81ff>0</span>);
    <span style=color:#75715e>// 2. 设置网卡名称
</span><span style=color:#75715e></span>    strncpy(ifr.ifr_name, <span style=color:#e6db74>&#34;enp3s0&#34;</span>, IFNAMSIZ <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>);
	<span style=color:#75715e>// 3. 读取指定网卡的 IP
</span><span style=color:#75715e></span>    ioctl(fd, SIOCGIFADDR, <span style=color:#f92672>&amp;</span>ifr);
	<span style=color:#75715e>// 4. IP 存放在 ifr.ifr_addr 里
</span><span style=color:#75715e></span>    addr <span style=color:#f92672>=</span> ((<span style=color:#66d9ef>struct</span> sockaddr_in <span style=color:#f92672>*</span>)<span style=color:#f92672>&amp;</span>ifr.ifr_addr)<span style=color:#f92672>-&gt;</span>sin_addr;
    <span style=color:#75715e>// 5. 转换格式，并打印
</span><span style=color:#75715e></span>    printf(<span style=color:#e6db74>&#34;ip address is : %s &lt;%08x&gt;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, inet_ntoa(addr), addr.s_addr);
    
    close(fd);
}</code></pre></div><p>编译和执行：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>~# gcc test.c -o test
~# ./test
ip address is : <span style=color:#ae81ff>172</span>.16.1.1 &lt;010110ac&gt;</code></pre></div><p>一个完整的例程：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdio.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;unistd.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;string.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;sys/types.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;sys/socket.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;sys/ioctl.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;netinet/in.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;net/if.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;arpa/inet.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>struct</span> ifinfo_t
{
    <span style=color:#66d9ef>struct</span> in_addr addr;  <span style=color:#75715e>// IP 地址
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>struct</span> in_addr netmask;  <span style=color:#75715e>// 子网掩码
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>struct</span> in_addr broadaddr; <span style=color:#75715e>// 广播地址
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>struct</span> in_addr net;  <span style=color:#75715e>// 网段
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>char</span>  hwaddr[<span style=color:#ae81ff>6</span>];  <span style=color:#75715e>// MAC 地址
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>int</span> netmask_len;  <span style=color:#75715e>// 十进制格式的子网掩码
</span><span style=color:#75715e></span>};

<span style=color:#75715e>// 获得指定网卡的 IP 信息
</span><span style=color:#75715e></span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>getifinfo</span>(<span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>ifname, <span style=color:#66d9ef>struct</span> ifinfo_t <span style=color:#f92672>*</span>ifinfo)
{
    <span style=color:#66d9ef>int</span> fd;
    <span style=color:#66d9ef>int</span> i;
    <span style=color:#66d9ef>int</span> len;
    <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>int</span> netmask <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
    <span style=color:#66d9ef>struct</span> ifreq ifr;

    fd <span style=color:#f92672>=</span> socket(AF_INET, SOCK_DGRAM, <span style=color:#ae81ff>0</span>);
    strncpy(ifr.ifr_name, ifname, IFNAMSIZ <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>);

    ioctl(fd, SIOCGIFADDR, <span style=color:#f92672>&amp;</span>ifr);
    ifinfo<span style=color:#f92672>-&gt;</span>addr <span style=color:#f92672>=</span> ((<span style=color:#66d9ef>struct</span> sockaddr_in <span style=color:#f92672>*</span>)<span style=color:#f92672>&amp;</span>ifr.ifr_addr)<span style=color:#f92672>-&gt;</span>sin_addr;

    ioctl(fd, SIOCGIFNETMASK, <span style=color:#f92672>&amp;</span>ifr);
    ifinfo<span style=color:#f92672>-&gt;</span>netmask <span style=color:#f92672>=</span> ((<span style=color:#66d9ef>struct</span> sockaddr_in <span style=color:#f92672>*</span>)<span style=color:#f92672>&amp;</span>ifr.ifr_netmask)<span style=color:#f92672>-&gt;</span>sin_addr;

    ioctl(fd, SIOCGIFBRDADDR, <span style=color:#f92672>&amp;</span>ifr);
    ifinfo<span style=color:#f92672>-&gt;</span>broadaddr <span style=color:#f92672>=</span> ((<span style=color:#66d9ef>struct</span> sockaddr_in <span style=color:#f92672>*</span>)<span style=color:#f92672>&amp;</span>ifr.ifr_broadaddr)<span style=color:#f92672>-&gt;</span>sin_addr;

    ioctl(fd, SIOCGIFHWADDR, <span style=color:#f92672>&amp;</span>ifr);
    memcpy(ifinfo<span style=color:#f92672>-&gt;</span>hwaddr, ifr.ifr_hwaddr.sa_data, <span style=color:#ae81ff>6</span>); 

    netmask <span style=color:#f92672>=</span> ifinfo<span style=color:#f92672>-&gt;</span>netmask.s_addr;
    len <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
    <span style=color:#66d9ef>for</span> (i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; i <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>32</span>; i<span style=color:#f92672>++</span>)
    {
        <span style=color:#66d9ef>if</span> (netmask <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>0x00000001</span>)
            len<span style=color:#f92672>++</span>;
        netmask <span style=color:#f92672>=</span> netmask <span style=color:#f92672>&gt;&gt;</span> <span style=color:#ae81ff>1</span>;
    }
    ifinfo<span style=color:#f92672>-&gt;</span>netmask_len <span style=color:#f92672>=</span> len;

    ifinfo<span style=color:#f92672>-&gt;</span>net.s_addr <span style=color:#f92672>=</span> ifinfo<span style=color:#f92672>-&gt;</span>addr.s_addr <span style=color:#f92672>&amp;</span> ifinfo<span style=color:#f92672>-&gt;</span>netmask.s_addr;

    close(fd);
    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
}

<span style=color:#75715e>//判断两个 ip 是否属于同一子网
</span><span style=color:#75715e></span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>issamenet</span>(<span style=color:#66d9ef>struct</span> in_addr <span style=color:#f92672>*</span>addr_1, <span style=color:#66d9ef>struct</span> in_addr <span style=color:#f92672>*</span>addr_2, <span style=color:#66d9ef>struct</span> in_addr <span style=color:#f92672>*</span>netmask)
{
    <span style=color:#66d9ef>return</span> (addr_1<span style=color:#f92672>-&gt;</span>s_addr <span style=color:#f92672>&amp;</span> netmask<span style=color:#f92672>-&gt;</span>s_addr) <span style=color:#f92672>==</span> (addr_2<span style=color:#f92672>-&gt;</span>s_addr <span style=color:#f92672>&amp;</span> netmask<span style=color:#f92672>-&gt;</span>s_addr);
}

<span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>()
{
    <span style=color:#66d9ef>struct</span> ifinfo_t ifinfo;
    getifinfo(<span style=color:#e6db74>&#34;enp3s0&#34;</span>, <span style=color:#f92672>&amp;</span>ifinfo);

    printf(<span style=color:#e6db74>&#34;address : &lt;%08x&gt; %s</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, ifinfo.addr.s_addr, inet_ntoa(ifinfo.addr));
    printf(<span style=color:#e6db74>&#34;netmask : &lt;%08x&gt; %s</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, ifinfo.netmask.s_addr, inet_ntoa(ifinfo.netmask));
    printf(<span style=color:#e6db74>&#34;hwaddr : %02x:%02x:%02x:%02x:%02x:%02x</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, ifinfo.hwaddr[<span style=color:#ae81ff>0</span>],ifinfo.hwaddr[<span style=color:#ae81ff>1</span>],ifinfo.hwaddr[<span style=color:#ae81ff>2</span>],ifinfo.hwaddr[<span style=color:#ae81ff>3</span>],ifinfo.hwaddr[<span style=color:#ae81ff>4</span>],ifinfo.hwaddr[<span style=color:#ae81ff>5</span>]);
    printf(<span style=color:#e6db74>&#34;broadaddr : &lt;%08x&gt; %s</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, ifinfo.broadaddr.s_addr, inet_ntoa(ifinfo.broadaddr));
    printf(<span style=color:#e6db74>&#34;net : &lt;%08x&gt; %s</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, ifinfo.net.s_addr, inet_ntoa(ifinfo.net));
    printf(<span style=color:#e6db74>&#34;netmask_len : %d</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, ifinfo.netmask_len);

    <span style=color:#75715e>// 判断两个 IP 是否属于同一个子网
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>struct</span> in_addr addr_1;
    <span style=color:#66d9ef>struct</span> in_addr addr_2;
    <span style=color:#66d9ef>struct</span> in_addr netmask;
    <span style=color:#66d9ef>int</span> ret <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;

    addr_1.s_addr <span style=color:#f92672>=</span> inet_addr(<span style=color:#e6db74>&#34;172.16.144.138&#34;</span>);
    addr_2.s_addr <span style=color:#f92672>=</span> inet_addr(<span style=color:#e6db74>&#34;172.16.144.1&#34;</span>);
    netmask.s_addr <span style=color:#f92672>=</span> inet_addr(<span style=color:#e6db74>&#34;255.255.255.240&#34;</span>);

    ret <span style=color:#f92672>=</span> issamenet(<span style=color:#f92672>&amp;</span>addr_1, <span style=color:#f92672>&amp;</span>addr_2, <span style=color:#f92672>&amp;</span>netmask);
    printf(<span style=color:#e6db74>&#34;ret is %d</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, ret);

    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
}</code></pre></div><p>编译和执行：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>~# gcc test.c -o test
~# ./test
address : &lt;010110ac&gt; <span style=color:#ae81ff>172</span>.16.1.1
netmask : &lt;00ffffff&gt; <span style=color:#ae81ff>255</span>.255.255.0
hwaddr : <span style=color:#ae81ff>00</span>:1d:f3:52:99:0c
broadaddr : &lt;ff0110ac&gt; <span style=color:#ae81ff>172</span>.16.1.255
net : &lt;000110ac&gt; <span style=color:#ae81ff>172</span>.16.1.0
netmask_len : <span style=color:#ae81ff>24</span>
ret is <span style=color:#ae81ff>0</span></code></pre></div><p>参考：</p><ul><li><p><a href=https://man7.org/linux/man-pages/man7/netdevice.7.html target=_blank>https://man7.org/linux/man-pages/man7/netdevice.7.html</a></p></li><li><p><a href=http://www.microhowto.info/howto/get_the_ip_address_of_a_network_interface_in_c_using_siocgifaddr.html target=_blank>http://www.microhowto.info/howto/get_the_ip_address_of_a_network_interface_in_c_using_siocgifaddr.html</a></p></li></ul></div></article><hr><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83.0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://shaocheng.li/tags/untagged>untagged</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>619 Words</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>2021-10-26 12:09 &#43;0000</p></div><div class=pagination><div class=pagination__title><span class=pagination__title-h></span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://shaocheng.li/posts/2022/02/01/><span class=button__icon>←</span>
<span class=button__text>在 iMX8MM 平台调试 AW-CM276MA Wi-Fi 模块</span></a></span>
<span class="button next"><a href=https://shaocheng.li/posts/2021/07/16/><span class=button__text>iMX8MM 的 Fuse/OCOPT 学习笔记</span>
<span class=button__icon>→</span></a></span></div></div><div id=comments class=thin><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"shaocheng-li"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></main></div><footer class=footer><div class=footer__inner><div class=footer__content><span>&copy; 2023</span>
<span><a href=https://shaocheng.li>Shaocheng.Li</a></span>
<span><a href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank rel=noopener>CC BY-NC 4.0</a></span>
<span><a href=https://shaocheng.li/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"/><path d="M4 4a16 16 0 0 1 16 16"/><circle cx="5" cy="19" r="1"/></svg></a></span></div></div><div class=footer__inner><div class=footer__content><span>Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>Made with &#10084; by <a href=https://github.com/rhazdon>rhazdon</a></span></div></div></footer></div><script type=text/javascript src=https://shaocheng.li/bundle.min.2d5469329143160ae2456a69c3c76dc2d0a3b212b46afe291a51bd68650ed6f8697e001dab54f1c272c77ce08092a8c55e5bb4314e0ee334aab4b927ec896638.js integrity="sha512-LVRpMpFDFgriRWppw8dtwtCjshK0av4pGlG9aGUO1vhpfgAdq1TxwnLHfOCAkqjFXlu0MU4O4zSqtLkn7IlmOA=="></script></body></html>