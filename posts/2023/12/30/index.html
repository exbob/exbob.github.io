<!doctype html><html lang=zh-Hans dir=Chinese-Simplified class=scroll-smooth data-default-appearance=dark data-auto-appearance=true><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="#FFFFFF"><title>åŸºäºè™šæ‹Ÿæœºçš„ Yocto å…¥é—¨ç¬”è®° &#183; Shaocheng.Li</title>
<meta name=title content="åŸºäºè™šæ‹Ÿæœºçš„ Yocto å…¥é—¨ç¬”è®° &#183; Shaocheng.Li"><script type=text/javascript src=/js/appearance.min.8a082f81b27f3cb2ee528df0b0bdc39787034cf2cc34d4669fbc9977c929023c.js integrity="sha256-iggvgbJ/PLLuUo3wsL3Dl4cDTPLMNNRmn7yZd8kpAjw="></script><link type=text/css rel=stylesheet href=/css/main.bundle.min.900ab2ce3e7db5eba67d1f7dae7f22410bddd4cd42fd9cd8ee95ecca31e5564e.css integrity="sha256-kAqyzj59teumfR99rn8iQQvd1M1C/ZzY7pXsyjHlVk4="><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.af5d9722112bedac95702865c340bcd6286c4e9b2c15ce26b531ea1fba974cb8.js integrity="sha256-r12XIhEr7ayVcChlw0C81ihsTpssFc4mtTHqH7qXTLg=" data-copy=å¤åˆ¶ data-copied=å·²å¤åˆ¶></script><meta name=description content="
      
        
      
    "><link rel=canonical href=https://shaocheng.li/posts/2023/12/30/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:url" content="https://shaocheng.li/posts/2023/12/30/"><meta property="og:site_name" content="Shaocheng.Li"><meta property="og:title" content="åŸºäºè™šæ‹Ÿæœºçš„ Yocto å…¥é—¨ç¬”è®°"><meta property="og:description" content="LiShaocheng's Blog"><meta property="og:locale" content="zh_Hans"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-12-30T20:34:49+08:00"><meta property="article:modified_time" content="2023-12-30T20:34:49+08:00"><meta property="article:tag" content="Untagged"><meta name=twitter:card content="summary"><meta name=twitter:title content="åŸºäºè™šæ‹Ÿæœºçš„ Yocto å…¥é—¨ç¬”è®°"><meta name=twitter:description content="LiShaocheng's Blog"><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","articleSection":"æ–‡ç« ","name":"åŸºäºè™šæ‹Ÿæœºçš„ Yocto å…¥é—¨ç¬”è®°","headline":"åŸºäºè™šæ‹Ÿæœºçš„ Yocto å…¥é—¨ç¬”è®°","inLanguage":"zh-Hans","url":"https:\/\/shaocheng.li\/posts\/2023\/12\/30\/","author":{"@type":"Person","name":"Shaocheng.Li"},"copyrightYear":"2023","dateCreated":"2023-12-30T20:34:49\u002b08:00","datePublished":"2023-12-30T20:34:49\u002b08:00","dateModified":"2023-12-30T20:34:49\u002b08:00","keywords":["untagged"],"mainEntityOfPage":"true","wordCount":"3224"}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://shaocheng.li/","name":"Shaocheng. Li","position":1},{"@type":"ListItem","item":"https://shaocheng.li/posts/","name":"æ–‡ç« ","position":2},{"@type":"ListItem","name":"åŸºäºè™šæ‹Ÿæœºçš„ Yocto å…¥é—¨ç¬”è®°","position":3}]}</script><meta name=author content="Shaocheng.Li"><link href=https://github.com/exbob rel=me></head><body class="m-auto flex h-screen max-w-7xl flex-col bg-neutral px-6 text-lg leading-7 text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32"><div id=the-top class="absolute flex self-center"><a class="-translate-y-8 rounded-b-lg bg-primary-200 px-3 py-1 text-sm focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="pe-2 font-bold text-primary-600 dark:text-primary-400">&darr;</span>è·³åˆ°ä¸»è¦å†…å®¹</a></div><header class="py-6 font-semibold text-neutral-900 dark:text-neutral sm:py-10 print:hidden"><nav class="flex items-start justify-between sm:items-center"><div class="flex flex-row items-center"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" rel=me href=/>Shaocheng.Li</a></div><ul class="flex list-none flex-col text-end sm:flex-row"><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><a href=/posts/ title=æ–‡ç« ><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">æ–‡ç« </span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><a href=/movies/ title=çœ‹è¿‡çš„ç”µå½±><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">è§‚å½±</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><a href=/exercise/ title=è¿åŠ¨è®°å½•><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">è¿åŠ¨</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><a href=/share/ title=å¥½ç‰©åˆ†äº«><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">å¥½ç‰©</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><button id=search-button-1 title="æœç´¢ (/)">
<span class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"><span class="icon relative inline-block px-1 align-text-bottom"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></span><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"></span></button></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><button id=appearance-switcher-1 type=button aria-label="appearance switcher">
<span class="group-dark:hover:text-primary-400 inline transition-colors group-hover:text-primary-600 dark:hidden" title=åˆ‡æ¢ä¸ºæ·±è‰²æ¨¡å¼><span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg>
</span><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"></span>
</span><span class="group-dark:hover:text-primary-400 hidden transition-colors group-hover:text-primary-600 dark:inline" title=åˆ‡æ¢ä¸ºæµ…è‰²æ¨¡å¼><span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg>
</span><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"></span></span></button></li></ul></nav></header><div class="relative flex grow flex-col"><main id=main-content class=grow><article><header class=max-w-prose><h1 class="mb-8 mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">åŸºäºè™šæ‹Ÿæœºçš„ Yocto å…¥é—¨ç¬”è®°</h1><div class="mb-10 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime="2023-12-30 20:34:49 +0800 +0800">2023 åäºŒæœˆ 30</time><span class="px-2 text-primary-500">&#183;</span><span>3224 å­—</span><span class="px-2 text-primary-500">&#183;</span><span title=é¢„è®¡é˜…è¯»>16 åˆ†é’Ÿ</span></div></div></header><section class="prose mt-0 flex max-w-full flex-col dark:prose-invert lg:flex-row"><div class="order-first px-0 lg:order-last lg:max-w-xs lg:ps-8"><div class="toc pe-5 lg:sticky lg:top-10 print:hidden"><details open class="-ms-5 mt-0 overflow-hidden rounded-lg ps-5"><summary class="block cursor-pointer bg-neutral-100 py-1 ps-5 text-lg font-semibold text-neutral-800 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">ç›®å½•</summary><div class="border-s border-dotted border-neutral-300 py-2 ps-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#1-å‰è¨€>1. å‰è¨€</a></li><li><a href=#2-å¿«é€Ÿå¼€å§‹>2. å¿«é€Ÿå¼€å§‹</a><ul><li><a href=#21-å®¿ä¸»æœº>2.1 å®¿ä¸»æœº</a></li><li><a href=#22-è·å–æºç >2.2 è·å–æºç </a></li><li><a href=#23-å¼€å§‹æ„å»º>2.3 å¼€å§‹æ„å»º</a></li></ul></li><li><a href=#3-è§£æå·¥ä½œæµ>3. è§£æå·¥ä½œæµ</a></li><li><a href=#4-åŸºç¡€å®šåˆ¶>4. åŸºç¡€å®šåˆ¶</a><ul><li><a href=#41-æ–°å»ºlayer>4.1 æ–°å»ºlayer</a></li><li><a href=#42-æ·»åŠ è½¯ä»¶åŒ…>4.2 æ·»åŠ è½¯ä»¶åŒ…</a></li><li><a href=#43-è®¾ç½®hostname>4.3 è®¾ç½®hostname</a></li><li><a href=#44-æ–°å»ºä¸€ä¸ªrecipe>4.4 æ–°å»ºä¸€ä¸ªrecipe</a></li><li><a href=#45-ä½¿ç”¨packagegroup>4.5 ä½¿ç”¨packagegroup</a></li><li><a href=#46-ä¿®æ”¹æ¬¢è¿ä¿¡æ¯>4.6 ä¿®æ”¹æ¬¢è¿ä¿¡æ¯</a></li><li><a href=#47-ç”Ÿæˆsdk>4.7 ç”ŸæˆSDK</a></li><li><a href=#48-åº”ç”¨å¼€å‘å’Œè°ƒè¯•>4.8 åº”ç”¨å¼€å‘å’Œè°ƒè¯•</a></li></ul></li><li><a href=#5-å†…æ ¸å¼€å‘>5. å†…æ ¸å¼€å‘</a><ul><li><a href=#51-æ·»åŠ å¤–éƒ¨æ¨¡å—>5.1 æ·»åŠ å¤–éƒ¨æ¨¡å—</a></li><li><a href=#52-ä¿®æ”¹å†…æ ¸æºç >5.2 ä¿®æ”¹å†…æ ¸æºç </a></li><li><a href=#53-ä¿®æ”¹å†…æ ¸é…ç½®>5.3 ä¿®æ”¹å†…æ ¸é…ç½®</a></li><li><a href=#54-è®¾ç½®defconfig>5.4 è®¾ç½®defconfig</a></li><li><a href=#55-ä½¿ç”¨devtool>5.5 ä½¿ç”¨devtool</a></li><li><a href=#56-ä½¿ç”¨virtual-provider>5.6 ä½¿ç”¨Virtual Provider</a></li></ul></li></ul></nav></div></details></div></div><div class="min-h-0 min-w-0 max-w-prose grow"><h2 id=1-å‰è¨€ class="relative group">1. å‰è¨€ <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#1-%e5%89%8d%e8%a8%80 aria-label=é”šç‚¹>#</a></span></h2><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸€ä¸ªåµŒå…¥å¼Linuxç³»ç»Ÿç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼š</p><ol><li>bootloaderï¼šå¯¹äºX86æ¶æ„ï¼Œå¤§éƒ¨åˆ†ç”¨GRUBï¼Œå¯¹äºARMæ¶æ„ï¼Œä»¥å‰çš„å¤„ç†å™¨ç”¨ä¸€ä¸ªu-bootå°±å¯ä»¥ï¼Œè€ŒARMv8ä¹‹åï¼Œè¿˜è¦åœ¨u-bootå‰åŠ ä¸ŠATFç­‰å›ºä»¶ã€‚</li><li>kernelï¼šå°±æ˜¯Linuxå†…æ ¸ï¼Œæœ€å¸¸è§çš„æ˜¯ä¸€ä¸ªbzImageæ–‡ä»¶ï¼Œå¦‚æœæ˜¯ARMæ¶æ„ï¼Œè¿˜éœ€è¦è®¾å¤‡æ ‘æ–‡ä»¶ï¼Œä½†æ˜¯å†…æ ¸æ¨¡å—ä¼šåŒ…å«åœ¨rootfsä¸­ã€‚</li><li>rootfsï¼šåŒ…å«äº†å†…æ ¸æ¨¡å—å’Œç”¨æˆ·ç©ºé—´çš„æ‰€æœ‰è½¯ä»¶ï¼ˆé…ç½®æ–‡ä»¶ï¼Œå¯æ‰§è¡Œæ–‡ä»¶ï¼Œè¿è¡Œåº“ç­‰ï¼‰ï¼Œä¸€äº›æç®€çš„ç³»ç»Ÿåªç”¨busyboxå°±å¯ä»¥å®ŒæˆåŸºæœ¬çš„rootfsã€‚</li></ol><blockquote><p>é™¤äº†è¿è¡Œæ—¶çš„ç³»ç»Ÿé•œåƒï¼Œé€šå¸¸è¿˜è¦æä¾›ä¸€ä¸ªç”¨äºåº”ç”¨ç¨‹åºå¼€å‘çš„SDKï¼ŒåŒ…å«äº†ç¼–è¯‘å·¥å…·é“¾å’Œå¼€å‘é“¾æ¥åº“ã€‚</p></blockquote><pre tabindex=0><code>- åµŒå…¥å¼Linuxç³»ç»Ÿé•œåƒ
  - bootloader
    - u-boot
    - atf-a
  - kernel
    - bzImage
    - devicetree
  - rootfs
    - kernel modules
    - busybox
    - glibc
    - Qt
    - etc.
</code></pre><p>æœ€å¼€å§‹çš„æ—¶å€™ï¼ŒåµŒå…¥å¼Linuxç³»ç»Ÿæ¯”è¾ƒç®€å•ï¼ŒBSPå·¥ç¨‹å¸ˆåªéœ€è¦ç¼–è¯‘u-bootï¼Œlinux kernel å’Œ busybox ï¼Œå°±å¯ä»¥æ„å»ºä¸€ä¸ªç³»ç»Ÿï¼Œç„¶åå†æ ¹æ®éœ€è¦æ·»åŠ è½¯ä»¶åŒ…ï¼Œæ•´ä¸ªæ„å»ºè¿‡ç¨‹åŸºæœ¬éƒ½æ˜¯æ‰‹åŠ¨æ“ä½œï¼Œå…ˆä¸‹è½½æºç ï¼Œç„¶åé€ä¸€ç¼–è¯‘ï¼Œå†å†™å…¥ç³»ç»Ÿç›˜ä¸­æ‰§è¡Œï¼Œæˆ–è€…ç»„åˆæˆä¸€ä¸ªå¯ä»¥å†™å…¥ç³»ç»Ÿç›˜çš„ç³»ç»Ÿæ–‡ä»¶ã€‚åæ¥ï¼Œéšç€åµŒå…¥å¼Linuxç³»ç»Ÿæ—¥æ¸å¤æ‚ï¼Œå°¤å…¶æ˜¯rootfsæ‰€éœ€çš„åŒ…è¶Šæ¥è¶Šå¤šï¼Œå½¼æ­¤ç›´æ¥çš„ä¾èµ–å…³ç³»ä¹Ÿéå¸¸å¤æ‚ï¼Œä¸ºäº†ä½¿æ„å»ºè¿‡ç¨‹æ›´åŠ ç®€ä¾¿å’Œå¯é ï¼Œä¹Ÿä¸ºäº†ä¾¿äºå¼€å‘ç»´æŠ¤ï¼Œäººä»¬å¼€å§‹åˆ›é€ ä¸€äº›è‡ªåŠ¨åŒ–çš„å·¥å…·ï¼ŒYoctoå°±æ˜¯ç°åœ¨æœ€æµè¡Œçš„æ–¹æ¡ˆä¹‹ä¸€ã€‚</p><p>åœ¨2003å¹´çš„æ—¶å€™ï¼ŒOpenEmbeddedç¤¾åŒºæˆç«‹ï¼Œå®ƒçš„ç›®çš„æ˜¯æä¾›ä¸€å¥—ç”¨äºæ„å»ºåµŒå…¥å¼Linuxç³»ç»Ÿçš„æ¡†æ¶å’Œå·¥å…·ã€‚åœ¨è¿™é‡Œï¼Œæ„å»ºLinuxç³»ç»Ÿçš„è¿‡ç¨‹å°±åƒåšä¸€æ¡Œå®´å¸­ï¼š</p><ol><li>é¦–å…ˆï¼Œç¡®å®šå®´å¸­çš„èœå•ï¼Œç”¨ä»€ä¹ˆæ¡Œæ¤…å’Œé¤å…·ã€‚å°±æ˜¯ç¡®å®šæœ‰ä¸€äº›ç³»ç»Ÿçº§çš„ç‰¹æ€§ï¼Œä¸ºæ­¤ï¼ŒOpenEmbeddedå®šä¹‰äº†åç¼€ä¸º<code>.conf/.cfg</code>çš„configureï¼ˆé…ç½®ï¼‰æ–‡ä»¶ï¼Œæ¥æè¿°ç³»ç»Ÿå†…åŒ…å«å“ªäº›è½¯ä»¶åŒ…ï¼ŒåŒ…ç®¡ç†çš„ç§ç±»ï¼ˆrpmï¼Œdpkgç­‰ï¼‰ï¼Œæ–‡ä»¶ç³»ç»Ÿçš„æ ¼å¼ï¼ˆext3ï¼Œext4ç­‰ï¼‰ï¼Œç›®æ ‡ç£ç›˜çš„å¤§å°ç­‰ã€‚</li><li>ç„¶åï¼Œæ ¹æ®èœå•ï¼Œç¡®å®šæ¯ä¸€é“èœéœ€è¦ä»€ä¹ˆé£Ÿæï¼Œå¦‚ä½•é‡‡ä¹°ï¼Œæ€ä¹ˆçƒ¹é¥ªï¼Œå¦‚ä½•è£…ç›˜ä¸Šèœï¼ŒæŠŠæ¯ä¸€é“èœåšå¥½ã€‚æ¯ä¸ªè½¯ä»¶åŒ…å°±ç›¸å½“äºä¸€é“èœï¼ŒOpenEmbeddedå®šä¹‰äº†åç¼€ä¸º<code>.bb</code>çš„recipeï¼ˆé£Ÿè°±ï¼‰é…ç½®æ–‡ä»¶ï¼Œæ¥æè¿°æ„å»ºä¸€ä¸ªè½¯ä»¶åŒ…æ‰€éœ€çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼šæºç ä¸‹è½½åœ°å€ï¼Œä¸‹è½½åæ”¾åœ¨é‚£é‡Œï¼Œå¦‚ä½•é…ç½®ç¼–è¯‘ï¼Œç”Ÿæˆçš„æ–‡ä»¶å®‰è£…åˆ°å“ªé‡Œç­‰ã€‚</li><li>æœ€åï¼Œå°±æ˜¯çƒ¹é¥ªå’Œä¸Šèœçš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬éœ€è¦åšå¥½æ¯ä¸€é“èœï¼Œæ‘†å¥½æ¡Œæ¤…é¤å…·ï¼ŒæŠŠåšå¥½çš„èœæ‘†åˆ°æ¡Œå­ä¸Šï¼Œä¸€æ¡Œå®´å¸­å°±æˆäº†ã€‚è¿™å°±æ˜¯ç¼–è¯‘å’Œæ‰“åŒ…çš„è¿‡ç¨‹ï¼Œä¸ºæ­¤ï¼ŒOpenEmbeddedæä¾›äº†bitbakeï¼Œè¿™æ˜¯ä¸€ä¸ªpythonå†™æˆçš„å·¥å…·ï¼Œå®ƒé€šè¿‡è§£ærecipeå’Œconfigureæ–‡ä»¶ï¼Œå…ˆæŠŠæ¯ä¸ªè½¯ä»¶åŒ…ç¼–è¯‘å‡ºæ¥ï¼Œå†æŠŠå®ƒä»¬æ‰“åŒ…ç»„åˆæˆä¸€ä¸ªLinuxç³»ç»Ÿé•œåƒã€‚</li></ol><p>åˆ°2010å¹´ï¼ŒLinuxåŸºé‡‘ä¼šå‘èµ·äº†Yoctoé¡¹ç›®ï¼Œå®ƒçš„ç›®æ ‡æ˜¯åˆ›é€ ä¸€å¥—æ„å»ºåµŒå…¥å¼Linuxç³»ç»Ÿå‘è¡Œç‰ˆçš„è½¯ä»¶å·¥å…·ï¼Œæ”¹å–„Linuxå‘è¡Œç‰ˆçš„æ„å»ºæµç¨‹ï¼Œäºæ˜¯å°±ä¸OpenEmbeddedåˆå¹¶äº†ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šå¼€å‘äº†ä¸€ä¸ªLinuxç³»ç»Ÿå‘è¡Œç‰ˆPokyã€‚æ•´ä¸ªé¡¹ç›®ä¸»è¦ç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼š</p><ul><li>OpenEmbedded-Coreï¼šåŒ…æ‹¬åŸºç¡€æ ¸å¿ƒçš„recipeå’Œconfigureï¼Œè¿˜é€šè¿‡classæ–‡ä»¶æä¾›äº†é€šç”¨åŠŸèƒ½çš„ç±»å’Œæ–¹æ³•ï¼Œå¯ä»¥ä¾›å¤šä¸ªrecipeå…±äº«ã€‚</li><li>BitBakeï¼šOpenEmbeddedæä¾›çš„æ„å»ºå·¥å…·å¥—ä»¶ï¼Œç”¨Python å†™æˆï¼Œæ ¸å¿ƒå°±è¡Œbitbakeå‘½ä»¤ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¤šä»»åŠ¡å¼•æ“ï¼Œå¯ä»¥å¹¶è¡Œæ‰§è¡Œ shell å’Œ Python ä»»åŠ¡ï¼Œè§£ærecipeså’Œconfç­‰é…ç½®æ–‡ä»¶ï¼Œç®¡ç†å’Œæ‰§è¡Œæºç ä¸‹è½½ã€é…ç½®ã€ç¼–è¯‘ã€æ‰“åŒ…ç­‰æ„å»ºè¿‡ç¨‹ï¼Œå¹¶æœ€ç»ˆå°†æ¯ä¸ªä»»åŠ¡ç”Ÿæˆçš„æ–‡ä»¶é›†åˆæˆä¸ºç³»ç»Ÿé•œåƒã€‚æ„å»ºLinuxç³»ç»Ÿå‘è¡Œç‰ˆæ¶‰åŠåˆ°å¾ˆå¤šæ–¹é¢çš„å·¥ä½œï¼Œå¦‚æœä½ ç©è¿‡ LFS ï¼Œå°±ä¼šäº†è§£è¿™ä¸ªè¿‡ç¨‹çš„å¤æ‚æ€§ã€‚BitBake å­˜åœ¨çš„æ„ä¹‰å°±æ˜¯æä¾›äº†ä¸€ä¸ªé«˜æ•ˆçš„å·¥å…·ï¼Œå°†è¿™ä¸ªè¿‡ç¨‹æ ‡å‡†åŒ–ã€æµç¨‹åŒ–ã€‚BitBake ä¸ GNU Make çš„å…³ç³»å°±åƒ GNU Make ä¹‹äº GCC ï¼Œè¿ä½œæ–¹å¼ä¹Ÿç±»ä¼¼ GNU Make ï¼Œåˆæœ‰å¾ˆå¤šä¸åŒã€‚</li><li>Pokyï¼šYoctoåŸºäºOpenEmbeddedå¼€å‘çš„ä¸€ä¸ªLinuxç³»ç»Ÿå‘è¡Œç‰ˆï¼ŒåŸºäºQemuè¿è¡Œï¼Œä¸å…·ä½“ç¡¬ä»¶æ— å…³ã€‚ä½œä¸ºä¸€ä¸ªå‚è€ƒï¼ŒYocto çš„å¾ˆå¤šæ–‡æ¡£ï¼Œéƒ½æ˜¯ä»¥Pokyä½œä¸ºå®ä¾‹è¿›è¡Œè®²è§£çš„ï¼Œå…¶ä»–ç¡¬ä»¶å‚å•†ä¹Ÿå¯ä»¥åŸºäºPokyå¼€å‘è‡ªå·±çš„Linuxå‘è¡Œç‰ˆã€‚</li></ul><p><figure><img src=./pics/image_kWzZiT1rl6.png alt class="mx-auto my-0 rounded-md"></figure></p><p>åœ¨è¿™é‡Œå¯ä»¥æŸ¥åˆ°Yocto å‘è¡Œç‰ˆçš„å†å²ï¼š</p><ul><li><a href=https://wiki.yoctoproject.org/wiki/Releases title=https://wiki.yoctoproject.org/wiki/Releases target=_blank rel=noreferrer>https://wiki.yoctoproject.org/wiki/Releases</a>ã€‚</li></ul><p>å…¶ä¸­ï¼Œ<a href=https://docs.yoctoproject.org/4.0.14/ title="Yocto Kirkstone 4.0" target=_blank rel=noreferrer>Yocto Kirkstone 4.0</a>æ˜¯ä¸€ä¸ªLSTç‰ˆæœ¬ï¼Œ2022å¹´å‘å¸ƒï¼Œé¢„è®¡æ”¯æŒåˆ°2026å¹´ã€‚æˆ‘ä»¬ä»¥æ­¤ä¸ºä¾‹ï¼Œå¾ªåºæ¸è¿›çš„å­¦ä¹ Yoctoã€‚è¯¥ç‰ˆæœ¬çš„è¯¦ç»†æ–‡æ¡£ï¼Œå¯ä»¥åœ¨è¿™é‡ŒæŸ¥åˆ°ï¼š</p><ul><li><a href=https://docs.yoctoproject.org/4.0.14/ title=https://docs.yoctoproject.org/4.0.14/ target=_blank rel=noreferrer>https://docs.yoctoproject.org/4.0.14/</a></li></ul><p>éœ€è¦æ³¨æ„ï¼ŒYoctoçš„å­¦ä¹ æ›²çº¿æ¯”è¾ƒé™¡å³­ï¼Œå¥½åœ¨å®˜æ–¹æ–‡æ¡£éå¸¸ä¸°å¯Œï¼Œæœ€å¥½çš„æ–¹å¼å°±æ˜¯å¾ªåºæ¸è¿›çš„åšä¸€äº›ä»»åŠ¡ï¼Œç„¶åæŸ¥è¯¢æ–‡æ¡£ç†è§£å…¶åŸç†ã€‚</p><h2 id=2-å¿«é€Ÿå¼€å§‹ class="relative group">2. å¿«é€Ÿå¼€å§‹ <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#2-%e5%bf%ab%e9%80%9f%e5%bc%80%e5%a7%8b aria-label=é”šç‚¹>#</a></span></h2><p>å…ˆæ­å»º Yocto çš„å®¿ä¸»æœºç¯å¢ƒï¼Œç„¶åæ„å»ºä¸€ä¸ªæœ€ç®€å•ç³»ç»Ÿï¼Œè¿™æ ·å¯¹Yoctoæœ‰ä¸€ä¸ªç›´è§‚çš„è®¤è¯†ã€‚åé¢æ¶‰åŠçš„ Yocto æºç å·²ç»æ¨é€åˆ° github ï¼š<a href=https://github.com/exbob/yocto-kirkstone target=_blank rel=noreferrer>https://github.com/exbob/yocto-kirkstone</a>ã€‚</p><h3 id=21-å®¿ä¸»æœº class="relative group">2.1 å®¿ä¸»æœº <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#21-%e5%ae%bf%e4%b8%bb%e6%9c%ba aria-label=é”šç‚¹>#</a></span></h3><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæ„å»ºYoctoæ˜¯ä¸ªåºå¤§çš„å·¥ç¨‹ï¼Œæ ¹æ®ç›®æ ‡æ–‡ä»¶çš„ä¸åŒï¼Œå¯èƒ½éœ€è¦æ‰§è¡Œæˆåƒä¸Šä¸‡ä¸ªä»»åŠ¡ï¼Œå¯¹å®¿ä¸»æœºçš„CPUï¼Œå†…å­˜å’Œç¡¬ç›˜ç©ºé—´æœ‰è¾ƒé«˜è¦æ±‚ã€‚è¿™é‡Œåšæœ€å°çš„ç³»ç»Ÿï¼Œå¯ä»¥ç”¨è™šæ‹Ÿæœºï¼Œæˆ–è€…WSLï¼Œåˆ†é…8æ ¸ä»¥ä¸ŠCPUï¼Œ16Gä»¥ä¸Šå†…å­˜ï¼Œ100Gä»¥ä¸Šçš„ç¡¬ç›˜ç©ºé—´ï¼Œæ“ä½œç³»ç»Ÿé€‰æ‹©Ubuntu20.04 Serverï¼Œæ„å»ºè¿‡ç¨‹ä¸­ä¼šä¸‹è½½å¤§é‡æºç åŒ…ï¼Œè¦ç¡®ä¿ç½‘ç»œç•…é€šã€‚</p><p>ç„¶åå®‰è£…å¦‚ä¸‹è½¯ä»¶ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ sudo apt install gawk wget git diffstat unzip texinfo gcc build-essential chrpath socat cpio python3 python3-pip python3-pexpect xz-utils debianutils iputils-ping python3-git python3-jinja2 libegl1-mesa libsdl1.2-dev pylint3 xterm python3-subunit mesa-common-dev zstd liblz4-tool
</span></span></code></pre></div><p>é…ç½®gitï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=err>$</span> <span class=n>git</span> <span class=n>config</span> <span class=o>--</span><span class=n>global</span> <span class=n>user</span><span class=p>.</span><span class=n>name</span> <span class=s>&#34;Your Name&#34;</span>
</span></span><span class=line><span class=cl><span class=err>$</span> <span class=n>git</span> <span class=n>config</span> <span class=o>--</span><span class=n>global</span> <span class=n>user</span><span class=p>.</span><span class=n>email</span> <span class=s>&#34;Your Email&#34;</span>
</span></span><span class=line><span class=cl><span class=err>$</span> <span class=n>git</span> <span class=n>config</span> <span class=o>--</span><span class=n>list</span>
</span></span></code></pre></div><h3 id=22-è·å–æºç  class="relative group">2.2 è·å–æºç  <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#22-%e8%8e%b7%e5%8f%96%e6%ba%90%e7%a0%81 aria-label=é”šç‚¹>#</a></span></h3><p>è¿™ä¸€æ­¥æ˜¯è·å– poky å‘è¡Œç‰ˆçš„yoctoæºç ã€‚å…ˆæ–°å»ºä¸€ä¸ªå·¥ä½œç›®å½•ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ mkdir yocto-kirkstone
</span></span><span class=line><span class=cl>$ <span class=nb>cd</span> yocto-kirkstone
</span></span></code></pre></div><p>å…‹éš† poky ï¼Œå¹¶æ£€å‡º kirkostoneåˆ†æ”¯ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ git clone git://git.yoctoproject.org/poky
</span></span><span class=line><span class=cl>$ <span class=nb>cd</span> poky
</span></span><span class=line><span class=cl>$ git checkout -t origin/kirkstone -b my-kirkstone
</span></span></code></pre></div><p>åˆ†æä¸€ä¸‹pokyæºç çš„åŒ…æ‹¬ï¼š</p><ul><li>oe-init-build-envï¼Œåˆå§‹åŒ–æ„å»ºç¯å¢ƒçš„è„šæœ¬ï¼Œä¸»è¦æ˜¯æŠŠYoctoçš„å·¥å…·è·¯å¾„æ·»åŠ åˆ°PATHä¸­ï¼Œç„¶åç”ŸæˆåŸºç¡€é…ç½®ã€‚</li><li>bitbake/ï¼Œbitbakeå·¥å…·å¥—ä»¶çš„è·¯å¾„ã€‚</li><li>scritps/ï¼ŒåŒ…å«äº†å¾ˆå¤šæ„å»ºè¿‡ç¨‹éœ€è¦çš„è„šæœ¬å·¥å…·ã€‚</li><li>meta-*/ï¼Œä»¥metaå¼€å¤´çš„æ–‡ä»¶å¤¹æ˜¯layerã€‚<a href=https://docs.yoctoproject.org/4.0.12/overview-manual/yp-intro.html#the-yocto-project-layer-model title="Layer Model" target=_blank rel=noreferrer>Layer Model</a>æ˜¯Yoctoçš„é‡è¦æ¦‚å¿µï¼Œå¯ä»¥ç®€å•çš„ç†è§£ä¸ºå¯¹recipeçš„åˆ†ç±»ï¼Œä¾‹å¦‚ï¼Œmeta-yocto-bspä¸‹åŒ…å«çš„æ˜¯ä¸ç¡¬ä»¶ç›¸å…³çš„recipeï¼Œä¾‹å¦‚bootloaderï¼Œkernelç­‰ï¼Œmeta-selfteståŒ…å«çš„æ˜¯å„ç§æµ‹è¯•ç¨‹åºã€‚</li></ul><h3 id=23-å¼€å§‹æ„å»º class="relative group">2.3 å¼€å§‹æ„å»º <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#23-%e5%bc%80%e5%a7%8b%e6%9e%84%e5%bb%ba aria-label=é”šç‚¹>#</a></span></h3><p>åˆå§‹åŒ–æ„å»ºç¯å¢ƒï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ <span class=nb>source</span> poky/oe-init-build-env x86_build
</span></span></code></pre></div><p>è¾“å‡ºå¦‚ä¸‹å†…å®¹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>You had no conf/local.conf file. This configuration file has therefore been
</span></span><span class=line><span class=cl>created <span class=k>for</span> you from /home/lsc/yocto-kirkstone/poky/meta-poky/conf/local.conf.sample
</span></span><span class=line><span class=cl>You may wish to edit it to, <span class=k>for</span> example, <span class=k>select</span> a different MACHINE <span class=o>(</span>target
</span></span><span class=line><span class=cl>hardware<span class=o>)</span>. See conf/local.conf <span class=k>for</span> more information as common configuration
</span></span><span class=line><span class=cl>options are commented.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>You had no conf/bblayers.conf file. This configuration file has therefore been
</span></span><span class=line><span class=cl>created <span class=k>for</span> you from /home/lsc/yocto-kirkstone/poky/meta-poky/conf/bblayers.conf.sample
</span></span><span class=line><span class=cl>To add additional metadata layers into your configuration please add entries
</span></span><span class=line><span class=cl>to conf/bblayers.conf.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>The Yocto Project has extensive documentation about OE including a reference
</span></span><span class=line><span class=cl>manual which can be found at:
</span></span><span class=line><span class=cl>    https://docs.yoctoproject.org
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>For more information about OpenEmbedded see the website:
</span></span><span class=line><span class=cl>    https://www.openembedded.org/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>### Shell environment set up for builds. ###</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>You can now run <span class=s1>&#39;bitbake &lt;target&gt;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Common targets are:
</span></span><span class=line><span class=cl>    core-image-minimal
</span></span><span class=line><span class=cl>    core-image-full-cmdline
</span></span><span class=line><span class=cl>    core-image-sato
</span></span><span class=line><span class=cl>    core-image-weston
</span></span><span class=line><span class=cl>    meta-toolchain
</span></span><span class=line><span class=cl>    meta-ide-support
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>You can also run generated qemu images with a <span class=nb>command</span> like <span class=s1>&#39;runqemu qemux86&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Other commonly useful commands are:
</span></span><span class=line><span class=cl> - <span class=s1>&#39;devtool&#39;</span> and <span class=s1>&#39;recipetool&#39;</span> handle common recipe tasks
</span></span><span class=line><span class=cl> - <span class=s1>&#39;bitbake-layers&#39;</span> handles common layer tasks
</span></span><span class=line><span class=cl> - <span class=s1>&#39;oe-pkgdata-util&#39;</span> handles common target package tasks
</span></span></code></pre></div><p>è¿™ä¸ªåˆå§‹åŒ–è¿‡ç¨‹ä¼šè®¾ç½®ä¸€äº›ç¯å¢ƒå˜é‡ï¼Œç„¶åæ–°å»ºä¸€ä¸ªåä¸ºx86_buildæ–‡ä»¶å¤¹ï¼Œä½œä¸ºè¯¥é¡¹ç›®çš„å·¥ä½œè·¯å¾„ã€‚è¿™ä¸ªè·¯å¾„ä¼šè®¾ç½®åˆ°<code>BUILDDIR</code>ç¯å¢ƒå˜é‡ä¸­ã€‚<code>x86_build/conf/</code>ä¸‹æœ‰ä¸‰ä¸ªé…ç½®æ–‡ä»¶ï¼š</p><ul><li>templateconf.cfgï¼šè®¾ç½®é…ç½®æ–‡ä»¶æ¨¡æ¿çš„è·¯å¾„ã€‚æ–‡ä»¶å†…å®¹é»˜è®¤ä¸º <code>meta-poky/conf</code>ï¼Œè¿™ä¸ªè·¯å¾„ä¸‹åŒ…å«äº†å¾ˆå¤šé…ç½®æ–‡ä»¶çš„æ¨¡æ¿ã€‚</li><li>bblayers.confï¼šè¯¥æ–‡ä»¶åˆ—å‡ºäº†æœ¬é¡¹ç›®ç”¨åˆ°çš„layerï¼Œbitbakeåªä¼šåœ¨è¿™äº›layerä¸‹æœç´¢recipeã€‚</li><li>local.confï¼šæœ¬åœ°é…ç½®æ–‡ä»¶ï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶é‡Œè®¾ç½®é’ˆå¯¹æœ¬é¡¹ç›®çš„å…¨å±€å˜é‡ã€‚</li></ul><p>åœ¨conf/local.conf æ–‡ä»¶æ·»åŠ é…ç½®ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>BB_NUMBER_THREADS</span> <span class=o>=</span> <span class=s2>&#34;4&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>PARALLEL_MAKE</span> <span class=o>=</span> <span class=s2>&#34;-j 4&#34;</span>
</span></span></code></pre></div><ul><li><a href="https://docs.yoctoproject.org/4.0.11/ref-manual/variables.html?highlight=bb_number_threads#term-BB_NUMBER_THREADS" title=BB_NUMBER_THREADS target=_blank rel=noreferrer>BB_NUMBER_THREADS</a> ï¼Œè®¾ç½®æœ€å¤§ä»»åŠ¡æ•°ã€‚bitbake ä¼šåŒæ—¶å¼€å¯å¤šä¸ªä»»åŠ¡ï¼Œå¹¶è¡Œå¤„ç†æ„å»ºè¿‡ç¨‹ï¼Œé»˜è®¤æœ€å¤§å€¼ä¸ºCPUçš„çº¿ç¨‹æ•°ï¼Œä¸ºäº†é¿å…å½±å“å…¶ä»–å·¥ä½œï¼Œå¯ä»¥è®¾ç½®è°ƒå°ä¸€ç‚¹ã€‚</li><li><a href="https://docs.yoctoproject.org/4.0.11/ref-manual/variables.html?highlight=bb_number_threads#term-PARALLEL_MAKE" title=PARALLEL_MAKE target=_blank rel=noreferrer>PARALLEL_MAKE</a> ï¼Œä¼ é€’ç»™makeå‘½ä»¤çš„å‚æ•°ï¼Œé€šè¿‡ bitbakeè°ƒç”¨ do_compileä»»åŠ¡æ—¶ä¼ é€’ã€‚è®¾ç½®ä¸º<code>-j 4</code> è¡¨ç¤ºç¼–è¯‘æ—¶æœ€å¤§çº¿ç¨‹æ•°ã€‚</li></ul><p>æ‰“å°ä¿¡æ¯å·²ç»å‘Šè¯‰æˆ‘ä»¬ä¸‹ä¸€æ­¥å¯ä»¥æ„å»ºå¤šç§targetï¼Œæˆ‘ä»¬é€‰æ‹©æ„å»ºä¸€ä¸ªæœ€å°çš„å‘è¡Œç‰ˆï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ bitbake core-image-minimal
</span></span></code></pre></div><p>è¿™ä¸ªå‘è¡Œç‰ˆåŒ…å«çš„è½¯ä»¶åŒ…è¾ƒå°‘ï¼Œæ„å»ºè¿‡ç¨‹åœ¨æ•°å°æ—¶å°±å¯ä»¥å®Œæˆï¼Œç®€å•çœ‹ä¸€ä¸‹buildç›®å½•ä¸‹çš„æ–‡ä»¶ï¼š</p><ul><li>confï¼ŒåŒ…å«äº†ä¸€äº›å…¨å±€é…ç½®æ–‡ä»¶ã€‚</li><li>downloadsï¼Œæ‰€æœ‰çš„æºç åŒ…éƒ½ä¸‹è½½åˆ°äº†è¿™ä¸ªè·¯å¾„ã€‚</li><li>sstate-cacheï¼Œæ„å»ºè¿‡ç¨‹ä¸­äº§ç”Ÿçš„ç¼“å­˜æ–‡ä»¶ã€‚</li><li>tmp/deploy/rpm/qemux86_64ï¼Œå®‰è£…åˆ°æœ€ç»ˆç³»ç»Ÿé•œåƒä¸­çš„æ‰€æœ‰ rpm åŒ…éƒ½åœ¨è¿™ä¸ªè·¯å¾„ä¸‹ã€‚</li><li>tmp/deploy/images/qemux86-64ï¼Œæœ€ç»ˆç”Ÿæˆçš„bootloaderï¼Œkernelå’Œrootfsç­‰ç³»ç»Ÿé•œåƒæ–‡ä»¶éƒ½åœ¨è¿™ä¸ªè·¯å¾„ä¸‹ã€‚</li></ul><p>ç„¶åè¿è¡Œqemuå¯åŠ¨è™šæ‹Ÿæœºï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ runqemu qemux86-64
</span></span></code></pre></div><p>åœ¨æ‰“å°ä¿¡æ¯ä¸­å¯ä»¥çœ‹åˆ°å®Œæ•´çš„qemué…ç½®å‚æ•°ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>runqemu - INFO - Setting up tap interface under sudo
</span></span><span class=line><span class=cl>runqemu - INFO - Network configuration: <span class=nv>ip</span><span class=o>=</span>192.168.7.2::192.168.7.1:255.255.255.0::eth0:off:8.8.8.8
</span></span><span class=line><span class=cl>runqemu - INFO - Running /home/lsc/yocto-kirkstone/x86_build/tmp/work/x86_64-linux/qemu-helper-native/1.0-r1/recipe-sysroot-native/usr/bin/qemu-system-x86_64 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-device virtio-net-pci,netdev<span class=o>=</span>net0,mac<span class=o>=</span>52:54:00:12:34:02 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-netdev tap,id<span class=o>=</span>net0,ifname<span class=o>=</span>tap0,script<span class=o>=</span>no,downscript<span class=o>=</span>no <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-object rng-random,filename<span class=o>=</span>/dev/urandom,id<span class=o>=</span>rng0 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-device virtio-rng-pci,rng<span class=o>=</span>rng0 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-drive <span class=nv>file</span><span class=o>=</span>/home/lsc/yocto-kirkstone/x86_build/tmp/deploy/images/qemux86-64/core-image-minimal-qemux86-64-20230919015802.rootfs.ext4,if<span class=o>=</span>virtio,format<span class=o>=</span>raw <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-usb -device usb-tablet   -cpu IvyBridge -machine q35 -smp <span class=m>4</span> -m <span class=m>256</span> -serial mon:vc -serial null -device virtio-vga  -display sdl,show-cursor<span class=o>=</span>on  <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-kernel /home/lsc/yocto-kirkstone/x86_build/tmp/deploy/images/qemux86-64/bzImage <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-append <span class=s1>&#39;root=/dev/vda rw  ip=192.168.7.2::192.168.7.1:255.255.255.0::eth0:off:8.8.8.8 oprofile.timer=1 tsc=reliable no_timer_check rcupdate.rcu_expedited=1 &#39;</span>
</span></span></code></pre></div><p>è™šæ‹Ÿæœºä¼šå¯åŠ¨äº†ä¸€ä¸ªæ–°çš„çª—å£ï¼Œç”¨æˆ·åæ˜¯ rootï¼Œæ²¡æœ‰å¯†ç ï¼š</p><p><figure><img src=./pics/image_AQaCHR2L0u.png alt class="mx-auto my-0 rounded-md"></figure></p><p>å…³äºqemuçš„æ›´å¤šå†…å®¹å¯ä»¥å‚è€ƒ<a href=https://docs.yoctoproject.org/4.0.12/dev-manual/qemu.html#using-the-quick-emulator-qemu title="Using the Quick EMUlator " target=_blank rel=noreferrer>Using the Quick EMUlator </a>ã€‚</p><blockquote><p>ğŸ“Œä¹Ÿå¯ä»¥å…ˆä¸‹è½½æ‰€æœ‰è½¯ä»¶åŒ…çš„æºç ï¼Œä¸‹è½½å®Œæ¯•åå†ç¼–è¯‘ï¼š<strong>bitbake core-image-minimal &ndash;runall=fetch</strong></p></blockquote><h2 id=3-è§£æå·¥ä½œæµ class="relative group">3. è§£æå·¥ä½œæµ <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#3-%e8%a7%a3%e6%9e%90%e5%b7%a5%e4%bd%9c%e6%b5%81 aria-label=é”šç‚¹>#</a></span></h2><p>ä¸‹å›¾å±•ç¤ºäº†ä½¿ç”¨Yoctoç”Ÿæˆç³»ç»Ÿé•œåƒimageå’Œåº”ç”¨å¼€å‘å·¥å…·SDKçš„å·¥ä½œæµç¨‹ï¼š</p><p><figure><img src=./pics/image_n-cNcn0oCB.png alt class="mx-auto my-0 rounded-md"></figure></p><ol><li>å¼€å‘äººå‘˜ä»ä¸Šæ¸¸å‚å®¶è·å–Upstream Sourceï¼Œä¾‹å¦‚pokyã€‚</li><li>å¼€å‘äººå‘˜å¯¹Upstream Sourceè¿›è¡Œå¿…è¦çš„é…ç½®ï¼ŒåŒ…æ‹¬å¢åˆ è½¯ä»¶åŒ…ï¼Œä¿®æ”¹è½¯ä»¶é…ç½®ï¼Œä¿®æ”¹ç³»ç»Ÿç‰¹æ€§ç­‰ã€‚</li><li>å¼€å§‹æ„å»ºï¼ŒBuild SysteamæŒ‰å¦‚ä¸‹æµç¨‹å·¥ä½œï¼š<ol><li>ä»æŒ‡å®šä½ç½®è·å–å¹¶ä¸‹è½½æºä»£ç ï¼Œè¿™ä¸ªè¿‡ç¨‹æ”¯æŒæ ‡å‡†æ–¹æ³•ï¼Œä¾‹å¦‚ftpï¼Œgitç­‰ã€‚</li><li>ä¸‹è½½æˆåŠŸåï¼Œå†å°†æºä»£ç æå–åˆ°æœ¬åœ°å·¥ä½œåŒºï¼Œåœ¨è¯¥å·¥ä½œåŒºä¸­åº”ç”¨è¡¥ä¸å¹¶è¿è¡Œé…ç½®å’Œç¼–è¯‘ç­‰è½¯ä»¶çš„å¸¸è§æ­¥éª¤ã€‚</li><li>å°†è½¯ä»¶å®‰è£…åˆ°æš‚å­˜åŒºï¼Œç„¶åä½¿ç”¨æ‚¨é€‰æ‹©çš„äºŒè¿›åˆ¶åŒ…æ ¼å¼ï¼ˆdebã€rpmæˆ– ipkï¼‰æ¥æ‰“åŒ…è½¯ä»¶ã€‚</li><li>ä¸åŒçš„ QA å’Œå¥å…¨æ€§æ£€æŸ¥è´¯ç©¿æ•´ä¸ªæ„å»ºè¿‡ç¨‹ã€‚</li><li>è½¯ä»¶åŒ…æ„å»ºå®Œæ¯•åï¼Œæ”¾åˆ°ä¸€ä¸ªPackage Feedsä¸­ï¼Œç”¨äºç”Ÿæˆimageå’ŒSDKã€‚</li><li>ç”Ÿæˆimageï¼ˆç”¨äºå†™å…¥ç£ç›˜çš„ç³»ç»Ÿé•œåƒï¼‰å’ŒSDK (åŒ…å«å·¥å…·é“¾å’Œé“¾æ¥åº“ï¼Œç”¨äºåº”ç”¨ç¨‹åºå¼€å‘ï¼‰ã€‚</li></ol></li></ol><p>æ›´å¤šè¯¦ç»†ä¿¡æ¯å¯ä»¥å‚è€ƒï¼š<a href=https://docs.yoctoproject.org/4.0.13/overview-manual/concepts.html title=https://docs.yoctoproject.org/4.0.13/overview-manual/concepts.html target=_blank rel=noreferrer>https://docs.yoctoproject.org/4.0.13/overview-manual/concepts.html</a>ï¼Œå¯ä»¥å…ˆé€šç¯‡æµè§ˆï¼Œç„¶ååœ¨é‡åˆ°é—®é¢˜æ—¶å›æº¯ï¼ŒåŠ æ·±ç†è§£ã€‚ä¸‹é¢ä»¥æ„å»º<code>core-image-minimal</code>ä¸ºä¾‹ç®€å•åˆ†æä¸€ä¸‹ã€‚</p><p>bitbakeçš„åŸºæœ¬è¯­æ³•æ˜¯<code>bitbake [options] [recipe_name/target]</code> ï¼Œå½“æˆ‘ä»¬æ‰§è¡Œbitbakeæ—¶ï¼Œå®ƒè§£æ<code>${BUILDDIR}/conf/bblayers.conf</code>æ–‡ä»¶ï¼Œç¡®å®šæœç´¢recipeçš„è·¯å¾„ï¼Œç„¶ååœ¨è¿™äº›è·¯å¾„ä¸‹æœç´¢recipceæˆ–è€…targetï¼Œ<code>core-image-minimal</code>ä½œä¸ºä¸€ä¸ªtargetï¼Œä¹Ÿæ˜¯ç”±recipeæ–‡ä»¶æè¿°çš„ï¼Œå¯ä»¥ç”¨å¦‚ä¸‹å‘½ä»¤ç¡®å®šè¯¥æ–‡ä»¶çš„è·¯å¾„ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ bitbake -e core-image-minimal <span class=p>|</span> grep ^FILE<span class=o>=</span>
</span></span><span class=line><span class=cl><span class=nv>FILE</span><span class=o>=</span><span class=s2>&#34;/home/lsc/yocto-kirkstone/poky/meta/recipes-core/images/core-image-minimal.bb&#34;</span>
</span></span></code></pre></div><p>çœ‹ä¸€ä¸‹è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>  <span class=m>1</span> <span class=nv>SUMMARY</span> <span class=o>=</span> <span class=s2>&#34;A small image just capable of allowing a device to boot.&#34;</span>
</span></span><span class=line><span class=cl>  <span class=m>2</span>
</span></span><span class=line><span class=cl>  <span class=m>3</span> <span class=nv>IMAGE_INSTALL</span> <span class=o>=</span> <span class=s2>&#34;packagegroup-core-boot </span><span class=si>${</span><span class=nv>CORE_IMAGE_EXTRA_INSTALL</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=m>4</span>
</span></span><span class=line><span class=cl>  <span class=m>5</span> <span class=nv>IMAGE_LINGUAS</span> <span class=o>=</span> <span class=s2>&#34; &#34;</span>
</span></span><span class=line><span class=cl>  <span class=m>6</span>
</span></span><span class=line><span class=cl>  <span class=m>7</span> <span class=nv>LICENSE</span> <span class=o>=</span> <span class=s2>&#34;MIT&#34;</span>
</span></span><span class=line><span class=cl>  <span class=m>8</span>
</span></span><span class=line><span class=cl>  <span class=m>9</span> inherit core-image
</span></span><span class=line><span class=cl> <span class=m>10</span>
</span></span><span class=line><span class=cl> <span class=m>11</span> IMAGE_ROOTFS_SIZE ?<span class=o>=</span> <span class=s2>&#34;8192&#34;</span>
</span></span><span class=line><span class=cl> <span class=m>12</span> IMAGE_ROOTFS_EXTRA_SPACE:append <span class=o>=</span> <span class=s2>&#34;</span><span class=si>${</span><span class=p>@bb.utils.contains(</span><span class=s2>&#34;DISTRO_FEATURES&#34;</span><span class=p>, </span><span class=s2>&#34;systemd&#34;</span><span class=p>, </span><span class=s2>&#34; + 4096&#34;</span><span class=p>,     </span><span class=s2>&#34;&#34;</span><span class=p>, d)</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span></code></pre></div><ul><li><code>SUMMARY</code>ç®€è¦çš„è¯´æ˜äº†è¿™ä¸ªtargetæ˜¯ä»€ä¹ˆã€‚</li><li><code>IMAGE_INSTALL</code>åˆ—å‡ºäº†è¯¥ç³»ç»Ÿè¦å®‰è£…çš„recipesã€‚</li><li><code>inherit core-image</code>è¡¨ç¤ºå®ƒç»§æ‰¿äº†core-imageã€‚</li></ul><p>ä»è¿™ä¸ªæ–‡ä»¶å¼€å§‹ï¼Œç»§ç»­æ·±å…¥è§£æï¼Œbitbakeå°±ä¼šå¾—åˆ°è¯¥ç³»ç»Ÿä¾èµ–çš„æ‰€æœ‰recipesï¼Œç„¶åä¾æ¬¡æ‰§è¡Œæ¯ä¸ªrecipeçš„æ„å»ºè¿‡ç¨‹ã€‚å¯ä»¥ä½¿ç”¨<code>-g</code>é€‰é¡¹è§£ætargetä¸recipeä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ bitbake -g core-image-minimal
</span></span><span class=line><span class=cl>Loading cache: 100% <span class=p>|</span><span class=c1>################################################################| Time: 0:00:00</span>
</span></span><span class=line><span class=cl>Loaded <span class=m>1644</span> entries from dependency cache.
</span></span><span class=line><span class=cl>NOTE: Resolving any missing task queue dependencies
</span></span><span class=line><span class=cl>NOTE: PN build list saved to <span class=s1>&#39;pn-buildlist&#39;</span>
</span></span><span class=line><span class=cl>NOTE: Task dependencies saved to <span class=s1>&#39;task-depends.dot&#39;</span>
</span></span></code></pre></div><p>ç”Ÿæˆäº†ä¸¤ä¸ªæ–‡ä»¶ï¼š</p><ul><li>task-depends.dot: è¿™æ˜¯ä¸€ä¸ª<a href=http://www.graphviz.org/ title=Graphviz target=_blank rel=noreferrer>Graphviz</a>æ ¼å¼çš„æ–‡ä»¶ï¼Œæ˜¾ç¤ºæ˜¯æ‰€æœ‰ä»»åŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚</li><li>pn-buildlist: æ–‡æœ¬æ–‡ä»¶ï¼Œåˆ—å‡ºäº†æ„å»ºtargetè¿‡ç¨‹ä¸­ä¾èµ–çš„æ‰€æœ‰recipeã€‚</li></ul><p>Yoctoæä¾›äº†<code>oe-depends-dot</code>å·¥å…·ï¼Œå¯ä»¥å¯¹<code>task-depends.dot</code>è¿›è¡Œç®€å•åˆ†æï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># æŸ¥è¯¢busyboxçš„ç”Ÿæˆå…³ç³»</span>
</span></span><span class=line><span class=cl>$ oe-depends-dot -k busybox -w task-depends.dot
</span></span><span class=line><span class=cl>Because: core-image-minimal packagegroup-core-boot
</span></span><span class=line><span class=cl>core-image-minimal -&gt; packagegroup-core-boot -&gt; busybox
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æŸ¥è¯¢busyboxä¾èµ–çš„åŒ…</span>
</span></span><span class=line><span class=cl>$ oe-depends-dot -k busybox -d task-depends.dot
</span></span><span class=line><span class=cl>Depends: gcc-cross-x86_64 gcc-runtime zip rpm-native opkg-utils-native pseudo-native opkg-utils libxcrypt kern-tools-native quilt-native ptest-runner update-rc initscripts patch-native glibc binutils-cross-x86_64 dwarfsrcfiles-native
</span></span></code></pre></div><p>è¿™ä¸ªæ–‡ä»¶å¾ˆå¤§ï¼Œå¯ä»¥åˆ é™¤ä¸€ä¸‹å†—ä½™ä¿¡æ¯ç¼©å°æ–‡ä»¶ä½“ç§¯ï¼Œç„¶åç”¨dotå‘½ä»¤æŠŠå®ƒè½¬æ¢ä¸ºpdfæ–‡ä»¶ï¼Œæ–¹ä¾¿æŸ¥çœ‹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ oe-depends-dot -r ./task-depends.dot
</span></span><span class=line><span class=cl>Saving reduced dot file to ./task-depends-reduced.dot
</span></span><span class=line><span class=cl>$ ls -l task-depends*
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> lsc lsc   <span class=m>23056</span> Sep <span class=m>28</span> 15:55 task-depends-reduced.dot
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> lsc lsc <span class=m>1297931</span> Sep <span class=m>12</span> 22:16 task-depends.dot
</span></span><span class=line><span class=cl>$ sudo apt install graphviz
</span></span><span class=line><span class=cl>$ dot -Tpdf task-depends-reduced.dot -o task-depends-reduced.pdf
</span></span></code></pre></div><p>ä¹Ÿå¯ä»¥æŠŠæ–‡ä»¶å†…å®¹è´Ÿè´£åˆ°åœ¨çº¿å¹³å°æŸ¥çœ‹ï¼Œä¾‹å¦‚ï¼š<a href=https://edotor.net/ title=https://edotor.net/ target=_blank rel=noreferrer>https://edotor.net/</a> ã€‚</p><p>æŸ¥çœ‹pn-buildlistæ–‡ä»¶ï¼Œä¼šå‘ç°æœ‰äº›recipeå¸¦æœ‰<code>native</code>åç¼€ï¼Œæœ‰äº›åˆ™æ²¡æœ‰ï¼Œä¾‹å¦‚ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; cat pn-buildlist <span class=p>|</span> grep unzip
</span></span><span class=line><span class=cl>unzip-native
</span></span><span class=line><span class=cl>unzip
</span></span></code></pre></div><p>å¸¦æœ‰<code>native</code>åç¼€çš„recipeæ˜¯è¿è¡Œå®¿ä¸»æœºä¸Šçš„è½¯ä»¶ï¼Œé€šå¸¸æ˜¯è¾…åŠ©æ„å»ºæ‰€éœ€çš„å·¥å…·ï¼Œæˆ–è€…äº¤å‰ç¼–è¯‘å·¥å…·é“¾ç­‰ï¼Œè€Œæ²¡æœ‰åç¼€çš„recipeæ˜¯è¿è¡Œåœ¨ç›®æ ‡æœºä¸Šçš„è½¯ä»¶ã€‚æœ€ç»ˆä¼šå‘ç°ï¼Œå®‰è£…åˆ°ç›®æ ‡æœºä¸Šçš„è½¯ä»¶åªæœ‰ä¸€ç™¾å¤šä¸ªï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ cat pn-buildlist <span class=p>|</span> wc -l
</span></span><span class=line><span class=cl><span class=m>295</span>
</span></span><span class=line><span class=cl>$ cat pn-buildlist <span class=p>|</span> grep native <span class=p>|</span> wc -l
</span></span><span class=line><span class=cl><span class=m>149</span>
</span></span></code></pre></div><p>æ‰§è¡Œ<code>bitbake -e &lt;recipe_name></code> å¯ä»¥å°†ä¸€ä¸ªrecipeçš„æ‰€æœ‰å†…å®¹å…¨éƒ¨è§£æå‡ºæ¥ï¼Œè¿˜åŒ…å«å¤§é‡çš„æ³¨é‡Šï¼Œè¿™ä¸ªéå¸¸é‡è¦ï¼Œåé¢çš„å„ç§å·¥ä½œéƒ½å¯ä»¥ä»ä¸­è·å¾—çº¿ç´¢ã€‚ä»¥busyboxä¸ºä¾‹ï¼Œæˆ‘ä»¬æŠŠå®ƒè§£æåçš„å†…å®¹ä¿å­˜åˆ°ä¸€ä¸ªæ–‡ä»¶ï¼Œç®€å•åˆ†æä¸€ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ bitbake -e busybox &gt; busybox-bb.log
</span></span></code></pre></div><p>é¦–å…ˆï¼Œ<code>FILE</code>å˜é‡è®°å½•äº†recipeæ–‡ä»¶çš„ä½ç½®ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ cat busybox-bb.log <span class=p>|</span> grep ^FILE<span class=o>=</span>
</span></span><span class=line><span class=cl><span class=nv>FILE</span><span class=o>=</span><span class=s2>&#34;/home/lsc/yocto-kirkstone/poky/meta/recipes-core/busybox/busybox_1.35.0.bb&#34;</span>
</span></span></code></pre></div><p>é€šè¿‡<code>WORKDIR</code>å¯ä»¥å®šä½bitbakeæ„å»ºè¿™ä¸ªåŒ…æ—¶çš„å·¥ä½œç›®å½•ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ cat busybox-bb.log <span class=p>|</span> grep ^WORKDIR<span class=o>=</span>
</span></span><span class=line><span class=cl><span class=nv>WORKDIR</span><span class=o>=</span><span class=s2>&#34;/home/lsc/yocto-kirkstone/x86_build/tmp/work/core2-64-poky-linux/busybox/1.35.0-r0&#34;</span>
</span></span></code></pre></div><p>æ„å»ºè¿‡ç¨‹ä¼šæ‰§è¡Œå¾ˆå¤šä»»åŠ¡ï¼Œæ¯ä¸ªåŒ…ä¼šç•¥æœ‰ä¸åŒï¼Œæ‰§è¡Œä»»åŠ¡çš„é¡ºåºç”±å…¶ä»»åŠ¡è°ƒåº¦å™¨æ§åˆ¶ã€‚åœ¨<code>${WORKDIR}/temp/</code> ç›®å½•ä¸‹ï¼Œä»¥ <code>run.do_</code> å¼€å¤´çš„æ–‡ä»¶è®°å½•äº†æ¯ä¸ªä»»åŠ¡æ‰§è¡Œçš„python/shellç¨‹åºæºç ï¼Œä»¥ <code>log.do_</code> å¼€å¤´çš„æ–‡ä»¶è®°å½•ä»»åŠ¡æ‰§è¡Œæ—¶çš„æ—¥å¿—ï¼Œ<code>log.task_order</code> æ–‡ä»¶æŒ‰é¡ºåºè®°å½•äº†å½“å‰ç›®æ ‡æ‰§è¡Œäº†å“ªäº›ä»»åŠ¡ã€‚çœ‹ä¸€ä¸‹busybox_1.35.0.bbæ‰§è¡Œäº†å“ªäº›ä»»åŠ¡ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ cat log.task_order
</span></span><span class=line><span class=cl>do_fetch <span class=o>(</span>1564520<span class=o>)</span>: log.do_fetch.1564520
</span></span><span class=line><span class=cl>do_unpack <span class=o>(</span>1605094<span class=o>)</span>: log.do_unpack.1605094
</span></span><span class=line><span class=cl>do_patch <span class=o>(</span>1653034<span class=o>)</span>: log.do_patch.1653034
</span></span><span class=line><span class=cl>do_deploy_source_date_epoch <span class=o>(</span>1707365<span class=o>)</span>: log.do_deploy_source_date_epoch.1707365
</span></span><span class=line><span class=cl>do_prepare_recipe_sysroot <span class=o>(</span>1707727<span class=o>)</span>: log.do_prepare_recipe_sysroot.1707727
</span></span><span class=line><span class=cl>do_configure <span class=o>(</span>1707736<span class=o>)</span>: log.do_configure.1707736
</span></span><span class=line><span class=cl>do_configure_ptest_base <span class=o>(</span>1781759<span class=o>)</span>: log.do_configure_ptest_base.1781759
</span></span><span class=line><span class=cl>do_compile <span class=o>(</span>1781797<span class=o>)</span>: log.do_compile.1781797
</span></span><span class=line><span class=cl>do_compile_ptest_base <span class=o>(</span>1949513<span class=o>)</span>: log.do_compile_ptest_base.1949513
</span></span><span class=line><span class=cl>do_install <span class=o>(</span>1949868<span class=o>)</span>: log.do_install.1949868
</span></span><span class=line><span class=cl>do_install_ptest_base <span class=o>(</span>2060604<span class=o>)</span>: log.do_install_ptest_base.2060604
</span></span><span class=line><span class=cl>do_package <span class=o>(</span>2064697<span class=o>)</span>: log.do_package.2064697
</span></span><span class=line><span class=cl>do_packagedata <span class=o>(</span>2173119<span class=o>)</span>: log.do_packagedata.2173119
</span></span><span class=line><span class=cl>do_populate_lic <span class=o>(</span>2262819<span class=o>)</span>: log.do_populate_lic.2262819
</span></span><span class=line><span class=cl>do_package_write_rpm <span class=o>(</span>2374209<span class=o>)</span>: log.do_package_write_rpm.2374209
</span></span><span class=line><span class=cl>do_package_qa <span class=o>(</span>2374261<span class=o>)</span>: log.do_package_qa.2374261
</span></span></code></pre></div><p>ä¸»è¦çš„ä»»åŠ¡æœ‰ï¼š</p><ol><li><a href="https://docs.yoctoproject.org/4.0.12/ref-manual/tasks.html?highlight=oe_runmake#do-fetch" title=fetch target=_blank rel=noreferrer>fetch</a> ï¼šä»è¿œç¨‹æˆ–è€…æœ¬åœ°è·å–æºç ï¼Œå¹¶æ”¾åˆ°<code>${DL_DIR}</code>è·¯å¾„ä¸‹</li><li><a href="https://docs.yoctoproject.org/4.0.12/ref-manual/tasks.html?highlight=oe_runmake#do-unpack" title=unpack target=_blank rel=noreferrer>unpack</a> ï¼šå°†æºç ä»<code>${DL_DIR}</code>é‡Šæ”¾åˆ°<code>${WORKDIR}</code>ä¸‹çš„ç›¸åº”è·¯å¾„ä¸‹ï¼Œå¹¶ç”¨<code>${S}</code>æŒ‡å‘è¿™ä¸ªè·¯å¾„ã€‚</li><li><a href="https://docs.yoctoproject.org/4.0.12/ref-manual/tasks.html?highlight=oe_runmake#do-patch" title=patch target=_blank rel=noreferrer>patch</a> ï¼š å°†è¡¥ä¸æ–‡ä»¶åº”ç”¨åˆ°<code>${S}</code>è·¯å¾„ä¸‹çš„æºç ä¸­</li><li><a href="https://docs.yoctoproject.org/4.0.12/ref-manual/tasks.html?highlight=oe_runmake#do-configure" title=configure target=_blank rel=noreferrer>configure</a> ï¼šåœ¨<code>${S}</code>è·¯å¾„ä¸‹æ‰§è¡Œé…ç½®</li><li><a href="https://docs.yoctoproject.org/4.0.12/ref-manual/tasks.html?highlight=oe_runmake#do-compile" title=compile target=_blank rel=noreferrer>compile</a> ï¼šåœ¨<code>${S}</code>è·¯å¾„ä¸‹æ‰§è¡Œç¼–è¯‘ï¼Œç¼–è¯‘ç”Ÿæˆçš„æ–‡ä»¶ä¼šæ”¾åœ¨<code>${B}</code>ä¸‹ï¼Œé»˜è®¤ä¸<code>${S}</code>ç›¸åŒã€‚</li><li><a href="https://docs.yoctoproject.org/4.0.12/ref-manual/tasks.html?highlight=oe_runmake#do-install" title=install target=_blank rel=noreferrer>install</a> ï¼šä»<code>${B}</code>æŠŠæ–‡ä»¶å¤åˆ¶åˆ°<code>${D}</code>è·¯å¾„ä¸‹ã€‚</li><li><a href="https://docs.yoctoproject.org/4.0.12/ref-manual/tasks.html?highlight=oe_runmake#do-package" title=package target=_blank rel=noreferrer>package</a> ï¼šåˆ†æ<code>${D}</code>è·¯å¾„ä¸‹çš„æ–‡ä»¶ï¼ŒæŒ‰ç…§<code>${PACKAGES}</code>å’Œ<code>${FILES}</code>çš„è®¾ç½®ï¼ŒæŠŠä»–ä»¬åˆ†ç±»æ”¾å…¥<code>${PKGDEST}</code>ä¸‹çš„æ–‡ä»¶å¤¹ï¼Œæœ€åæ‰“åŒ…ç”Ÿæˆ<code>${WORKDIR}/deploy/</code>å’Œ<code>${TMPDIR}/deploy</code>è·¯å¾„ä¸‹è½¯ä»¶å®‰è£…åŒ…ï¼Œè½¯ä»¶å®‰è£…åŒ…çš„æ•°æ®ä¼šè®°å½•åˆ°<code>${PKGDATA_DIR}</code>ä¸‹çš„ç›¸åº”æ–‡ä»¶ã€‚</li><li><a href="https://docs.yoctoproject.org/4.0.12/ref-manual/tasks.html?highlight=oe_runmake#do-clean" title=clean target=_blank rel=noreferrer>clean</a> ï¼šåˆ é™¤<code>${B}</code>è·¯å¾„ä¸‹ç¼–è¯‘ç”Ÿæˆçš„æ–‡ä»¶</li><li><a href="https://docs.yoctoproject.org/4.0.12/ref-manual/tasks.html?highlight=oe_runmake#do-cleansstate" title=clearsstate target=_blank rel=noreferrer>clearsstate</a> ï¼šåˆ é™¤ç¼–è¯‘è¿‡ç¨‹äº§ç”Ÿçš„æ‰€æœ‰æ–‡ä»¶å’Œç¼“å­˜æ–‡ä»¶</li><li><a href="https://docs.yoctoproject.org/4.0.12/ref-manual/tasks.html?highlight=oe_runmake#do-cleanall" title=cleanall target=_blank rel=noreferrer>cleanall</a> ï¼šåˆ é™¤æ‰€æœ‰æ–‡ä»¶ï¼ŒåŒ…æ‹¬<code>${DL_DIR}</code>è·¯å¾„ä¸‹çš„æºç å’Œ<code>${WORKDIR}</code>ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ã€‚</li></ol><p>å¯ä»¥çœ‹åˆ°busyboxçš„æºç è·¯å¾„å’Œç¼–è¯‘è·¯å¾„æ˜¯ä¸€æ ·çš„ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ cat busybox-bb.log <span class=p>|</span> grep ^S<span class=o>=</span>
</span></span><span class=line><span class=cl><span class=nv>S</span><span class=o>=</span><span class=s2>&#34;/home/lsc/yocto-kirkstone/x86_build/tmp/work/core2-64-poky-linux/busybox/1.35.0-r0/busybox-1.35.0&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ cat busybox-bb.log <span class=p>|</span> grep ^B<span class=o>=</span>
</span></span><span class=line><span class=cl><span class=nv>B</span><span class=o>=</span><span class=s2>&#34;/home/lsc/yocto-kirkstone/x86_build/tmp/work/core2-64-poky-linux/busybox/1.35.0-r0/busybox-1.35.0&#34;</span>
</span></span></code></pre></div><p>å„ç§ä»»åŠ¡çš„å…·ä½“å†…å®¹ä¹Ÿå¯ä»¥æŸ¥åˆ°ï¼Œä¾‹å¦‚do_compileä»»åŠ¡ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ cat busybox-bb.log <span class=p>|</span> grep -C <span class=m>2</span> <span class=s2>&#34;^do_compile&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># line: 147, file: /home/lsc/yocto-kirkstone/poky/meta/recipes-core/busybox/busybox.inc</span>
</span></span><span class=line><span class=cl>do_compile<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=nb>unset</span> CFLAGS CPPFLAGS CXXFLAGS LDFLAGS
</span></span><span class=line><span class=cl>        <span class=nb>export</span> <span class=nv>KCONFIG_NOTIMESTAMP</span><span class=o>=</span><span class=m>1</span>
</span></span><span class=line><span class=cl>--
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># line: 33, file: /home/lsc/yocto-kirkstone/poky/meta/classes/ptest.bbclass</span>
</span></span><span class=line><span class=cl>do_compile_ptest<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    :
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># line: 37, file: /home/lsc/yocto-kirkstone/poky/meta/classes/ptest.bbclass</span>
</span></span><span class=line><span class=cl>do_compile_ptest_base<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    do_compile_ptest
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>è¿™äº›ä»»åŠ¡å¯ä»¥é€šè¿‡ <code>-c</code> å‚æ•°å•ç‹¬æ‰§è¡Œï¼Œä¾‹å¦‚åªä¸‹è½½æºç å¯ä»¥æ‰§è¡Œ <code>bitbake &lt;recipe_name> -c fetch</code> ã€‚æ‰§è¡Œ <code>listtasks</code> ä»»åŠ¡å¯ä»¥æŸ¥çœ‹æ‰€æœ‰å¯ç”¨ä»»åŠ¡çš„è§£é‡Šï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>bitbake linux-imx -c listtasks
</span></span></code></pre></div><p>æ›´è¯¦ç»†çš„ä»»åŠ¡è§£é‡Šå¯ä»¥åœ¨å®˜æ–¹æ–‡æ¡£æŸ¥çœ‹ï¼š<a href=https://docs.yoctoproject.org/4.0.14/ref-manual/tasks.html title=https://docs.yoctoproject.org/4.0.14/ref-manual/tasks.htm target=_blank rel=noreferrer>https://docs.yoctoproject.org/4.0.14/ref-manual/tasks.htm</a>ã€‚</p><p>ä¾èµ–çš„recipeéƒ½æ„å»ºå®Œæ¯•åï¼Œ<code>core-image-minimal</code>ä¼šæ‰§è¡Œdo_rootfsä»»åŠ¡ï¼Œå®ƒæ ¹æ®<code>${IMAGE_ROOTFS}</code>çš„å€¼æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼ŒæŠŠimageéœ€è¦å®‰è£…çš„rpmå®‰è£…åŒ…éƒ½å®‰è£…åˆ°è¿™é‡Œï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ bitbake -e core-image-minimal <span class=p>|</span> grep <span class=nv>IMAGE_ROOTFS</span><span class=o>=</span>
</span></span><span class=line><span class=cl><span class=nv>IMAGE_ROOTFS</span><span class=o>=</span><span class=s2>&#34;/home/lsc/yocto-kirkstone/x86_build/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/rootfs&#34;</span>
</span></span><span class=line><span class=cl>$ ls tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/rootfs
</span></span><span class=line><span class=cl>bin  boot  dev  etc  home  lib  media  mnt  proc  run  sbin  sys  tmp  usr  var
</span></span></code></pre></div><p>è¿˜ä¼šæ ¹æ®<code>${IMAGE_MANIFEST}</code>çš„å€¼ç”Ÿæˆä¸€ä¸ªæ–‡ä»¶ï¼Œåœ¨é‡Œé¢é€è¡Œåˆ—å‡ºäº†æ‰€æœ‰å®‰è£…åˆ°imageçš„rpmå®‰è£…åŒ…ï¼Œæ¯è¡Œåˆ†ä¸‰åˆ—ï¼Œåˆ†åˆ«æ˜¯åç§°ï¼Œæ¶æ„å’Œç‰ˆæœ¬ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ bitbake -e core-image-minimal <span class=p>|</span> grep <span class=nv>IMAGE_MANIFEST</span><span class=o>=</span>
</span></span><span class=line><span class=cl><span class=nv>IMAGE_MANIFEST</span><span class=o>=</span><span class=s2>&#34;/home/lsc/yocto-kirkstone/x86_build/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/deploy-core-image-minimal-image-complete/core-image-minimal-qemux86-64-20230914042751.rootfs.manifest&#34;</span>
</span></span><span class=line><span class=cl>$ cat tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/deploy-core-image-minimal-image-complete/core-image-minimal-qemux86-64-20230914042751.rootfs.manifest
</span></span><span class=line><span class=cl>base-files qemux86_64 3.0.14
</span></span><span class=line><span class=cl>base-passwd core2_64 3.5.29
</span></span><span class=line><span class=cl>busybox core2_64 1.35.0
</span></span><span class=line><span class=cl>busybox-hwclock core2_64 1.35.0
</span></span><span class=line><span class=cl>busybox-syslog core2_64 1.35.0
</span></span><span class=line><span class=cl>busybox-udhcpc core2_64 1.35.0
</span></span><span class=line><span class=cl>eudev core2_64 3.2.10
</span></span><span class=line><span class=cl>init-ifupdown qemux86_64 1.0
</span></span><span class=line><span class=cl>init-system-helpers-service core2_64 1.62
</span></span><span class=line><span class=cl>initscripts core2_64 1.0
</span></span><span class=line><span class=cl>initscripts-functions core2_64 1.0
</span></span><span class=line><span class=cl>kernel-5.15.120-yocto-standard qemux86_64 5.15.120+git0+820b9bdb19_74c80e559b
</span></span><span class=line><span class=cl>kernel-image-5.15.120-yocto-standard qemux86_64 5.15.120+git0+820b9bdb19_74c80e559b
</span></span><span class=line><span class=cl>kernel-image-bzimage-5.15.120-yocto-standard qemux86_64 5.15.120+git0+820b9bdb19_74c80e559b
</span></span><span class=line><span class=cl>kernel-module-uvesafb-5.15.120-yocto-standard qemux86_64 5.15.120+git0+820b9bdb19_74c80e559b
</span></span><span class=line><span class=cl>ldconfig core2_64 2.35
</span></span><span class=line><span class=cl>libblkid1 core2_64 2.37.4
</span></span><span class=line><span class=cl>libc6 core2_64 2.35
</span></span><span class=line><span class=cl>libkmod2 core2_64 <span class=m>29</span>
</span></span><span class=line><span class=cl>liblzma5 core2_64 5.2.6
</span></span><span class=line><span class=cl>libz1 core2_64 1.2.11
</span></span><span class=line><span class=cl>modutils-initscripts core2_64 1.0
</span></span><span class=line><span class=cl>netbase noarch 6.3
</span></span><span class=line><span class=cl>packagegroup-core-boot qemux86_64 1.0
</span></span><span class=line><span class=cl>sysvinit core2_64 3.01
</span></span><span class=line><span class=cl>sysvinit-inittab qemux86_64 2.88dsf
</span></span><span class=line><span class=cl>sysvinit-pidof core2_64 3.01
</span></span><span class=line><span class=cl>update-alternatives-opkg core2_64 0.5.0
</span></span><span class=line><span class=cl>update-rc.d noarch 0.8
</span></span><span class=line><span class=cl>v86d qemux86_64 0.1.10
</span></span></code></pre></div><p>æœ€åæ‰§è¡Œdo_imageä»»åŠ¡ï¼Œå°†kernelï¼Œrootfsç­‰imageç»„ä»¶æ”¾åˆ°<code>${DEPLOY_DIR_IMAGE}</code>è·¯å¾„ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ cat core-image-minimal-bb.log <span class=p>|</span> grep ^DEPLOY_DIR
</span></span><span class=line><span class=cl><span class=nv>DEPLOY_DIR</span><span class=o>=</span><span class=s2>&#34;/home/lsc/yocto-kirkstone/x86_build/tmp/deploy&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>DEPLOY_DIR_DEB</span><span class=o>=</span><span class=s2>&#34;/home/lsc/yocto-kirkstone/x86_build/tmp/deploy/deb&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>DEPLOY_DIR_IMAGE</span><span class=o>=</span><span class=s2>&#34;/home/lsc/yocto-kirkstone/x86_build/tmp/deploy/images/qemux86-64&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>DEPLOY_DIR_IPK</span><span class=o>=</span><span class=s2>&#34;/home/lsc/yocto-kirkstone/x86_build/tmp/deploy/ipk&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>DEPLOY_DIR_RPM</span><span class=o>=</span><span class=s2>&#34;/home/lsc/yocto-kirkstone/x86_build/tmp/deploy/rpm&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>DEPLOY_DIR_TAR</span><span class=o>=</span><span class=s2>&#34;/home/lsc/yocto-kirkstone/x86_build/tmp/deploy/tar&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>DEPLOY_DIR_TOOLS</span><span class=o>=</span><span class=s2>&#34;/home/lsc/yocto-kirkstone/x86_build/tmp/deploy/tools&#34;</span>
</span></span><span class=line><span class=cl>$ ls tmp/deploy/images/qemux86-64/
</span></span><span class=line><span class=cl>bzImage
</span></span><span class=line><span class=cl>bzImage--5.15.120+git0+820b9bdb19_74c80e559b-r0-qemux86-64-20230912081542.bin
</span></span><span class=line><span class=cl>bzImage-qemux86-64.bin
</span></span><span class=line><span class=cl>core-image-minimal-qemux86-64-20230914081917.rootfs.manifest
</span></span><span class=line><span class=cl>core-image-minimal-qemux86-64-20230914081917.testdata.json
</span></span><span class=line><span class=cl>core-image-minimal-qemux86-64-20230914083045.qemuboot.conf
</span></span><span class=line><span class=cl>core-image-minimal-qemux86-64-20230914083045.rootfs.ext4
</span></span><span class=line><span class=cl>core-image-minimal-qemux86-64-20230914083045.rootfs.tar.bz2
</span></span><span class=line><span class=cl>core-image-minimal-qemux86-64.ext4
</span></span><span class=line><span class=cl>core-image-minimal-qemux86-64.manifest
</span></span><span class=line><span class=cl>core-image-minimal-qemux86-64.qemuboot.conf
</span></span><span class=line><span class=cl>core-image-minimal-qemux86-64.tar.bz2
</span></span><span class=line><span class=cl>core-image-minimal-qemux86-64.testdata.json
</span></span><span class=line><span class=cl>modules--5.15.120+git0+820b9bdb19_74c80e559b-r0-qemux86-64-20230912081542.tgz
</span></span><span class=line><span class=cl>modules-qemux86-64.tgz
</span></span></code></pre></div><p>å…³äºBitBakeçš„è¯¦ç»†å†…å®¹å¯ä»¥å‚è€ƒæ‰‹å†Œï¼š<a href=https://docs.yoctoproject.org/bitbake/2.0/index.html title=https://docs.yoctoproject.org/bitbake/2.0/index.html target=_blank rel=noreferrer>https://docs.yoctoproject.org/bitbake/2.0/index.html</a>ã€‚</p><h2 id=4-åŸºç¡€å®šåˆ¶ class="relative group">4. åŸºç¡€å®šåˆ¶ <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#4-%e5%9f%ba%e7%a1%80%e5%ae%9a%e5%88%b6 aria-label=é”šç‚¹>#</a></span></h2><p>æœ¬ç« å¯¹<code>core-image-minimal</code>åšä¸€äº›åŸºæœ¬çš„å®šåˆ¶å·¥ä½œï¼Œå¾ªåºæ¸è¿›çš„ç†è§£Yoctoã€‚éœ€è¦æ³¨æ„ï¼Œé‡å¯Linuxä¼šè¯åï¼Œéƒ½è¦æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤åˆå§‹åŒ–Yoctoç¯å¢ƒï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ <span class=nb>source</span> poky/oe-init-build-env x86_build
</span></span></code></pre></div><h3 id=41-æ–°å»ºlayer class="relative group">4.1 æ–°å»ºlayer <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#41-%e6%96%b0%e5%bb%balayer aria-label=é”šç‚¹>#</a></span></h3><p>åœ¨Yoctoä¸­ï¼Œrecipeä¸æ˜¯ç‹¬ç«‹å­˜åœ¨çš„ï¼Œå¿…é¡»é€šè¿‡ä¸åŒlayeråˆ†ç±»å­˜æ”¾ï¼Œå®˜æ–¹å’Œç¤¾åŒºéƒ½å‘å¸ƒäº†å¾ˆå¤šlayerï¼Œä¾‹å¦‚ï¼š</p><ul><li>OpenEmedded Layer ï¼š<a href=https://layers.openembedded.org/layerindex/branch/master/layers/ title=https://layers.openembedded.org/layerindex/branch/master/layers/ target=_blank rel=noreferrer>https://layers.openembedded.org/layerindex/branch/master/layers/</a></li><li>Yocto Layer ï¼š<a href=https://www.yoctoproject.org/software-overview/layers/ title=https://www.yoctoproject.org/software-overview/layers/ target=_blank rel=noreferrer>https://www.yoctoproject.org/software-overview/layers/</a></li></ul><p>å½“æˆ‘ä»¬è¦å¯¹pokyè¿›ä¸€æ­¥å®šåˆ¶çš„æ—¶å€™ï¼Œå¯ä»¥å…ˆç°åœ¨ç¤¾åŒºæ‰¾ä¸€æ‰¾ï¼Œæœ‰æ²¡æœ‰åˆ«äººå·²ç»å†™å¥½layeræˆ–è€…recipeï¼Œå¦‚æœæ²¡æ‰¾åˆ°ï¼Œå°±åº”è¯¥æ–°å»ºè‡ªå·±çš„layer ï¼Œå­˜æ”¾è‡ªå®šä¹‰çš„recipeã€‚layeræœ¬è´¨æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹å’Œä¸€äº›ç‰¹å®šé…ç½®æ–‡ä»¶ï¼Œè¿™äº›å¯ä»¥æ‰‹åŠ¨é€ä¸ªæ–°å»ºï¼Œè¯¦ç»†æƒ…å†µå¯ä»¥å‚è€ƒ<a href=https://docs.yoctoproject.org/4.0.12/dev-manual/common-tasks.html#understanding-and-creating-layers title="Understand and Creating Layers" target=_blank rel=noreferrer>Understand and Creating Layers</a>ã€‚</p><p>åŒæ—¶ï¼Œbitbakeå¥—ä»¶æä¾›bitbake-layerså·¥å…·ï¼Œç®€åŒ–äº†ç®¡ç†layer çš„æ“ä½œï¼Œå®ƒçš„<code>create-layer</code>å­å‘½ä»¤ç”¨äºæ–°å»ºlayerï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ bitbake-layers create-layer meta-mylayer
</span></span><span class=line><span class=cl>NOTE: Starting bitbake server...
</span></span><span class=line><span class=cl>Add your new layer with <span class=s1>&#39;bitbake-layers add-layer meta-mylayer&#39;</span>
</span></span></code></pre></div><p>è¿™æ¡å‘½ä»¤æ–°å»ºäº†ä¸€ä¸ªåä¸º meta-mylayer çš„æ–‡ä»¶å¤¹ï¼Œå†…éƒ¨åŒ…å«å¦‚ä¸‹æ–‡ä»¶ï¼š</p><ul><li>COPYING.MITæ–‡ä»¶ï¼Œè¿™æ˜¯layerçš„ç‰ˆæƒå£°æ˜æ–‡ä»¶ã€‚</li><li>README æ–‡ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ªæè¿°layerå†…å®¹çš„æ–‡ä»¶ã€‚</li><li>åŒ…å« layer.conf æ–‡ä»¶çš„ conf å­ç›®å½•ï¼Œæ˜¯layerçš„é»˜è®¤é…ç½®æ–‡ä»¶ã€‚</li><li>ä¸€ä¸ª recipes-example å­ç›®å½•ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªåä¸º example çš„å­ç›®å½•ï¼Œè¯¥å­ç›®å½•åŒ…å«ä¸€ä¸ª example.bb æ–‡ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ªrecipeçš„ä¾‹å­ã€‚</li></ul><p>ç„¶åéœ€è¦æŠŠè¿™ä¸ªlayeræ·»åŠ åˆ°é¡¹ç›®ä¸­ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ bitbake-layers add-layer meta-mylayer
</span></span></code></pre></div><p>è¿™æ¡å‘½ä»¤ä¼šæŠŠmeta-mylayerçš„è·¯å¾„æ·»åŠ åˆ°<code>${BUILDDIR}/conf/bblayers.conf</code>æ–‡ä»¶çš„<code>BBLAYERS</code>å˜é‡ä¸­ï¼Œè¿™æ ·bitbakeåœ¨æ‰§è¡Œæ—¶æ‰èƒ½æ‰¾åˆ°è¿™ä¸ªlayerä¸‹çš„recipeï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; cat conf/bblayers.conf
</span></span><span class=line><span class=cl><span class=c1># POKY_BBLAYERS_CONF_VERSION is increased each time build/conf/bblayers.conf</span>
</span></span><span class=line><span class=cl><span class=c1># changes incompatibly</span>
</span></span><span class=line><span class=cl><span class=nv>POKY_BBLAYERS_CONF_VERSION</span> <span class=o>=</span> <span class=s2>&#34;2&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>BBPATH</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>TOPDIR</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>BBFILES ?<span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>BBLAYERS ?<span class=o>=</span> <span class=s2>&#34; \
</span></span></span><span class=line><span class=cl><span class=s2>  /home/lsc/yocto-kirkstone/poky/meta \
</span></span></span><span class=line><span class=cl><span class=s2>  /home/lsc/yocto-kirkstone/poky/meta-poky \
</span></span></span><span class=line><span class=cl><span class=s2>  /home/lsc/yocto-kirkstone/poky/meta-yocto-bsp \
</span></span></span><span class=line><span class=cl><span class=s2>  /home/lsc/yocto-kirkstone/x86_build/meta-mylayer \
</span></span></span><span class=line><span class=cl><span class=s2>  &#34;</span>
</span></span></code></pre></div><p>æŸ¥çœ‹ä¸€ä¸‹å½“å‰é¡¹ç›®åŒ…å«çš„layer ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ bitbake-layers show-layers
</span></span><span class=line><span class=cl>NOTE: Starting bitbake server...
</span></span><span class=line><span class=cl>layer                 path                                      <span class=nv>priority</span>
</span></span><span class=line><span class=cl><span class=o>==========================================================================</span>
</span></span><span class=line><span class=cl>meta                  /home/lsc/yocto-kirkstone/poky/meta       <span class=m>5</span>
</span></span><span class=line><span class=cl>meta-poky             /home/lsc/yocto-kirkstone/poky/meta-poky  <span class=m>5</span>
</span></span><span class=line><span class=cl>meta-yocto-bsp        /home/lsc/yocto-kirkstone/poky/meta-yocto-bsp  <span class=m>5</span>
</span></span><span class=line><span class=cl>meta-mylayer          /home/lsc/yocto-kirkstone/x86_build/meta-mylayer  <span class=m>6</span>
</span></span></code></pre></div><p>å‡ ä¸ªlayeråŒ…å«ä¸åŒçš„å†…å®¹ï¼š</p><ul><li>mateæºäºOpenEmbeddedé¡¹ç›®ï¼Œæ˜¯Yoctoé¡¹ç›®çš„æ ¸å¿ƒå†…å®¹ï¼ŒåŒ…æ‹¬å„ç§æ ¸å¿ƒrecipeï¼Œå…±äº«åº“å’Œå·¥å…·ç­‰ã€‚ä¾‹å¦‚å†…æ ¸çš„recipeå°±åœ¨<code>meta/recipes-kernel/linux/</code>ä¸‹ã€‚</li><li>meta-yocto-bspåŒ…å«ç¡¬ä»¶ç›¸å…³çš„å†…å®¹ï¼Œä¾‹å¦‚ï¼Œ<code>meta-yocto-bsp/conf/machine</code>ä¸‹æ˜¯ç›®æ ‡ç¡¬ä»¶çš„é…ç½®æ–‡ä»¶ï¼Œ<code>meta-yocto-bsp/recipes-kernel/linux</code>ä¸‹é¢æ˜¯ç¡¬ä»¶ç›¸å…³çš„å†…æ ¸è¡¥ä¸ã€‚</li><li>meta-pokyæ˜¯pokyè¿™ä¸ªå‘è¡Œç‰ˆçš„æ ¸å¿ƒå†…å®¹ï¼Œ<code>meta-poky/conf/distro</code>ä¸‹é¢æ˜¯å‘è¡Œç‰ˆçš„é…ç½®æ–‡ä»¶ï¼Œä»é¡¶å±‚å†³å®šäº†å‘è¡Œç‰ˆåŒ…å«çš„å†…å®¹ã€‚</li><li>meta-mylayerå°±æ˜¯æˆ‘ä»¬åœ¨pokyå‘è¡Œç‰ˆåŸºç¡€ä¸Šæ·»åŠ çš„è‡ªå®šä¹‰å†…å®¹ã€‚</li></ul><p>æ³¨æ„æœ€åä¸€åˆ—è¡¨ç¤ºä¼˜å…ˆçº§ï¼ˆpriorityï¼‰ï¼Œå®ƒåœ¨<code>${LAYERDIR}/conf/layer.conf</code>æ–‡ä»¶çš„<a href=https://docs.yoctoproject.org/4.0.12/ref-manual/variables.html#term-BBFILE_PRIORITY title=BBFILE_PRIORITY target=_blank rel=noreferrer>BBFILE_PRIORITY</a>å˜é‡ä¸­å®šä¹‰ï¼Œæ•°å­—è¶Šå¤§è¡¨ç¤ºä¼˜å…ˆçº§è¶Šé«˜ã€‚bitbakeä¼šä»ä½åˆ°é«˜è¯»å–è§£æå„layerä¸­çš„é…ç½®ï¼Œè¿™æ ·ï¼Œå¯¹åº”åŒåçš„é…ç½®é€‰é¡¹ï¼Œé«˜ä¼˜å…ˆçº§ä¸­çš„é…ç½®å°±ä¼šæŠŠä½ä¼˜å…ˆçº§ä¸­çš„è¦†ç›–ã€‚å¦‚æœè¦ä»bblayers.confæ–‡ä»¶åˆ é™¤ä¸€ä¸ªlayerå¯ä»¥æ‰§è¡Œremove-layerå­å‘½ä»¤ã€‚</p><h3 id=42-æ·»åŠ è½¯ä»¶åŒ… class="relative group">4.2 æ·»åŠ è½¯ä»¶åŒ… <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#42-%e6%b7%bb%e5%8a%a0%e8%bd%af%e4%bb%b6%e5%8c%85 aria-label=é”šç‚¹>#</a></span></h3><p>å› ä¸º<code>core-image-minimal</code> çš„imageåªå®‰è£…äº†å°‘é‡çš„è½¯ä»¶ï¼Œå¤§éƒ¨åˆ†å‘½ä»¤æ˜¯ç”±busyboxç”Ÿæˆçš„ï¼Œæ•°é‡è¾ƒå°‘ï¼ŒåŠŸèƒ½ä¹Ÿæ¯”è¾ƒç®€é™‹ï¼Œä¾‹å¦‚æ²¡æœ‰å¯ä»¥è¿½è¸ªç³»ç»Ÿè°ƒç”¨straceå‘½ä»¤ï¼Œæˆ‘ä»¬è¦å®‰è£…ä¸€ä¸ªã€‚</p><p>é¦–å…ˆè¦ç¡®å®šç°æœ‰çš„layerä¸­ï¼Œæœ‰æ²¡æœ‰åŒ…å«straceçš„recipeã€‚å¯ä»¥ç”¨bitbakeçš„<code>-s</code>é€‰é¡¹åˆ—å‡ºå½“å‰layerä¸­çš„æ‰€æœ‰recipeï¼Œä»ä¸­æ£€ç´¢ä¸€ä¸‹å³å¯ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ bitbake -s <span class=p>|</span> grep strace
</span></span><span class=line><span class=cl>strace                                               :5.16-r0
</span></span><span class=line><span class=cl>strace-native                                        :5.16-r0
</span></span></code></pre></div><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“å‰é¡¹ç›®çš„<code>${BBLAYERS}</code>å¹¶æ²¡æœ‰åŒ…å«pokyçš„æ‰€æœ‰layerï¼Œå¦‚æœbitbakeå‘½ä»¤æ²¡æ‰¾åˆ°ï¼Œè¿˜æ˜¯è¦å»pokyä¸‹æœç´¢ä¸€ä¸‹ã€‚</p><p>å‘imageæ·»åŠ è½¯ä»¶åŒ…çš„æ–¹æ³•æœ‰å¾ˆå¤šç§ï¼Œæœ€å¸¸ç”¨çš„æ˜¯å‘<a href=https://docs.yoctoproject.org/4.0.12/ref-manual/variables.html#term-IMAGE_INSTALL title=IMAGE_INSTALL target=_blank rel=noreferrer>IMAGE_INSTALL</a>å˜é‡è¿½åŠ recpieï¼ŒIMAGE_INSTALLçš„å€¼æ˜¯ç”±ç©ºæ ¼åˆ†éš”çš„recipeåç§°ï¼Œbitbakeä¼šå‘imageå®‰è£…è¿™ä¸ªå˜é‡è®¾ç½®çš„recipeã€‚æˆ‘ä»¬åœ¨meta-mylayerä¸‹é¢æ–°å»º<code>recipes-core/images/core-image-minimal.bbappend</code>æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>IMAGE_INSTALL:append <span class=o>=</span> <span class=s2>&#34; strace&#34;</span>
</span></span></code></pre></div><p>å®ƒçš„å«ä¹‰æ˜¯å‘<a href=https://docs.yoctoproject.org/4.0.12/ref-manual/variables.html#term-IMAGE_INSTALL title=IMAGE_INSTALL target=_blank rel=noreferrer>IMAGE_INSTALL</a>å˜é‡çš„å°¾éƒ¨è¿½åŠ ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¦‚æœè¦åœ¨å‰é¢æ·»åŠ ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¯ä»¥ç”¨<code>:prepend</code>è¯­æ³•ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸¤ä¸ªè¯­æ³•ä¸ä¼šè‡ªåŠ¨æ·»åŠ ç©ºæ ¼ï¼Œæ‰€ä»¥è¦åœ¨recipeåçš„å‰ååŠ ä¸€ä¸ªç©ºæ ¼ï¼Œå¦‚æœè¦åˆ é™¤ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¯ä»¥ç”¨<code>:remove</code>è¯­æ³•ã€‚bitbakeä¿®æ”¹å˜é‡çš„è¯­æ³•æœ‰å¾ˆå¤šç§ï¼Œæœ‰å¾ˆå¤šæ³¨æ„äº‹é¡¹ï¼Œå¯ä»¥å‚è€ƒ<a href=https://docs.yoctoproject.org/bitbake/2.0/bitbake-user-manual/bitbake-user-manual-metadata.html#basic-syntax title="Basic Syntax" target=_blank rel=noreferrer>Basic Syntax</a>æ¢ç´¢ä¸€ä¸‹ã€‚</p><p>æ¯ä¸ªrecipeå¯ä»¥ç”±ä¸€ä¸ª<code>.bb</code>æ–‡ä»¶å’Œå¤šä¸ª<code>.bbappend</code>æ–‡ä»¶ç»„æˆï¼Œbitbakeä¼šå…ˆè¯»å–<code>.bb</code>æ–‡ä»¶ï¼Œç„¶åæŒ‰ç…§layerçš„ä¼˜å…ˆçº§ç”±ä½åˆ°é«˜ï¼Œé€ä¸ªè¯»å–<code>.bbappend</code>æ–‡ä»¶ï¼Œç„¶åæ·±å…¥è§£æã€‚ç°åœ¨æ£€æŸ¥ä¸€ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°straceå·²ç»åŠ ä¸Šï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ bitbake -e core-image-minimal <span class=p>|</span> grep ^IMAGE_INSTALL<span class=o>=</span>
</span></span><span class=line><span class=cl><span class=nv>IMAGE_INSTALL</span><span class=o>=</span><span class=s2>&#34;packagegroup-core-boot  strace&#34;</span>
</span></span></code></pre></div><p>é‡æ–°ç¼–è¯‘imageï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ bitbake core-image-minimal -c cleanall
</span></span><span class=line><span class=cl>$ bitbake core-image-minimal
</span></span></code></pre></div><p>æŸ¥çœ‹<code>${IMAGE_ROOTFS}</code>å’Œ<code>${IMAGE_MANIFEST}</code>ä¸­çš„å†…å®¹ï¼Œç¡®è®¤å®‰è£…æˆåŠŸï¼Œå°±å¯ä»¥å¯åŠ¨è™šæ‹Ÿæœºä½¿ç”¨äº†ï¼š</p><p><figure><img src=./pics/image_U7CtPI7Uku.png alt class="mx-auto my-0 rounded-md"></figure></p><p>è¿™æ˜¯æ·»åŠ è½¯ä»¶åŒ…æœ€ç›´æ¥çš„æ–¹å¼ï¼Œä½†æ˜¯å½±å“imageåŒ…å«å“ªäº›è½¯ä»¶åŒ…çš„å› ç´ è¿˜æœ‰å¾ˆå¤šï¼Œåé¢ä¼šé€æ¸é‡åˆ°ã€‚</p><h3 id=43-è®¾ç½®hostname class="relative group">4.3 è®¾ç½®hostname <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#43-%e8%ae%be%e7%bd%aehostname aria-label=é”šç‚¹>#</a></span></h3><p>åœ¨Linuxç³»ç»Ÿä¸­ï¼Œé€šè¿‡<code>/etc/hostname</code>æ–‡ä»¶è®¾ç½®ä¸»æœºåï¼š</p><p><figure><img src=./pics/image_v8eUrr5C6T.png alt class="mx-auto my-0 rounded-md"></figure></p><p>å¦‚æœè¦ä¿®æ”¹è¿™ä¸ªæ–‡ä»¶ï¼Œé¦–å…ˆè¦ç¡®å®šå®ƒæ˜¯ç”±å“ªä¸ªrecipeå®‰è£…åˆ°imageçš„ã€‚æ¯ä¸ªrecipeç”Ÿæˆäº†å“ªäº›å®‰è£…åŒ…éƒ½è®°å½•åœ¨<code>${PKGDATA_DIR}</code>è·¯å¾„ä¸‹çš„åŒåæ–‡ä»¶ä¸­ã€‚ä»¥busyboxä¸ºä¾‹ï¼Œ<code>${PKGDATA_DIR}/busybox</code>æ–‡ä»¶åˆ—å‡ºæ¥busyboxç”Ÿæˆçš„æ‰€æœ‰å®‰è£…åŒ…ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ cat busybox
</span></span><span class=line><span class=cl>PACKAGES: busybox-src busybox-dbg busybox-ptest busybox-httpd busybox-udhcpd busybox-udhcpc busybox-syslog busybox-mdev busybox-hwclock busybox-staticdev busybox-dev busybox-doc busybox-locale busybox
</span></span></code></pre></div><p>æŸ¥çœ‹<code>${IMAGE_MANIFEST}</code>æ–‡ä»¶çš„å†…å®¹å¯ä»¥ç¡®å®šï¼Œimageåªå®‰è£…äº†å¦‚ä¸‹å‡ ä¸ªå®‰è£…åŒ…ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>busybox core2_64 1.35.0
</span></span><span class=line><span class=cl>busybox-hwclock core2_64 1.35.0
</span></span><span class=line><span class=cl>busybox-syslog core2_64 1.35.0
</span></span><span class=line><span class=cl>busybox-udhcpc core2_64 1.35.0
</span></span></code></pre></div><p>æ¯ä¸ªå®‰è£…åŒ…å‘imageå®‰è£…çš„æ–‡ä»¶ï¼Œéƒ½å­˜æ”¾åœ¨<code>${PKGDEST}</code>è·¯å¾„ä¸‹çš„åŒåæ–‡ä»¶å¤¹é‡Œï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ cat busybox-bb.log <span class=p>|</span> grep ^PKGDEST<span class=o>=</span>
</span></span><span class=line><span class=cl><span class=nv>PKGDEST</span><span class=o>=</span><span class=s2>&#34;/home/lsc/yocto-kirkstone/x86_build/tmp/work/core2-64-poky-linux/busybox/1.35.0-r0/packages-split&#34;</span>
</span></span><span class=line><span class=cl>$ ls tmp/work/core2-64-poky-linux/busybox/1.35.0-r0/packages-split
</span></span><span class=line><span class=cl>busybox      busybox-doc      busybox-locale  busybox-src        busybox-udhcpc
</span></span><span class=line><span class=cl>busybox-dbg  busybox-httpd    busybox-mdev    busybox-staticdev  busybox-udhcpd
</span></span><span class=line><span class=cl>busybox-dev  busybox-hwclock  busybox-ptest   busybox-syslog     busybox.shlibdeps
</span></span></code></pre></div><p>ä¾‹å¦‚busybox-hwclockåªå®‰è£…äº†ä¸€ä¸ªhwclock.shè„šæœ¬ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ tree tmp/work/core2-64-poky-linux/busybox/1.35.0-r0/packages-split/busybox-hwclock
</span></span><span class=line><span class=cl>tmp/work/core2-64-poky-linux/busybox/1.35.0-r0/packages-split/busybox-hwclock
</span></span><span class=line><span class=cl>â””â”€â”€ etc
</span></span><span class=line><span class=cl>    â””â”€â”€ init.d
</span></span><span class=line><span class=cl>        â””â”€â”€ hwclock.sh
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=m>2</span> directories, <span class=m>1</span> file
</span></span></code></pre></div><p>é€šè¿‡ä¸Šé¢è¿™ä¸ªæŸ¥è¯¢æ¬¡åºï¼Œå¯ä»¥ç¡®å®šimageå®‰è£…å“ªäº›è½¯ä»¶åŒ…ï¼Œæ¯ä¸ªè½¯ä»¶åŒ…éƒ½å®‰è£…äº†ä»€ä¹ˆæ–‡ä»¶ï¼Œåè¿‡æ¥ä¹Ÿå°±å¯ä»¥ç¡®å®šimageä¸­çš„æŸä¸ªæ–‡ä»¶æ¥è‡ªäºå“ªä¸ªrecipe ã€‚OpenEmbeddedä¸ºæ­¤æä¾›äº†oe-pkgdata-utilå·¥å…·ï¼Œå®ƒä¼šè§£æ<code>${PKGDATA_DIR}</code>ä¸‹çš„æ–‡ä»¶ï¼Œç„¶åæ‰¾å‡ºæˆ‘ä»¬æƒ³è¦çš„æ•°æ®ã€‚å…¶ä¸­find-pathå­å‘½ä»¤ç”¨æˆ·æ‰¾åˆ°imageä¸­çš„æŸä¸ªæ–‡ä»¶æ¥è‡ªäºå“ªä¸ªå®‰è£…åŒ…ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ oe-pkgdata-util find-path /etc/hostname
</span></span><span class=line><span class=cl>base-files: /etc/hostname
</span></span></code></pre></div><p>å› ä¸ºä¸€ä¸ªrecipeå¯èƒ½ä¼šç”Ÿæˆå¤šä¸ªè½¯ä»¶å®‰è£…åŒ…ï¼Œæ‰€ä»¥ï¼Œè¦è¿›ä¸€æ­¥ä½¿ç”¨lookup-recipeå­å‘½ä»¤æ‰¾åˆ°base-filesè¿™ä¸ªè½¯ä»¶åŒ…æ˜¯å“ªä¸ªrecipeç”Ÿæˆçš„ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ oe-pkgdata-util lookup-recipe base-files
</span></span><span class=line><span class=cl>base-files
</span></span></code></pre></div><p>è‡³æ­¤ï¼Œå¯ä»¥ç¡®å®š<code>/etc/hostname</code>æ˜¯ç”±<code>base-files_*.bb</code>æ„å»ºçš„base-filesè½¯ä»¶åŒ…å®‰è£…çš„ï¼Œæ‰¾åˆ°å®ƒï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ bitbake -e base-files <span class=p>|</span> grep ^PKGDEST<span class=o>=</span>
</span></span><span class=line><span class=cl><span class=nv>PKGDEST</span><span class=o>=</span><span class=s2>&#34;/home/lsc/yocto-kirkstone/x86_build/tmp/work/qemux86_64-poky-linux/base-files/3.0.14-r89/packages-split&#34;</span>
</span></span><span class=line><span class=cl>$ ls tmp/work/qemux86_64-poky-linux/base-files/3.0.14-r89/packages-split
</span></span><span class=line><span class=cl>base-files  base-files-dbg  base-files-dev  base-files-doc  base-files-src
</span></span><span class=line><span class=cl>$ cat tmp/work/qemux86_64-poky-linux/base-files/3.0.14-r89/packages-split/base-files/etc/hostname
</span></span><span class=line><span class=cl>qemux86-64
</span></span></code></pre></div><p>æ‰¾åˆ°å®ƒçš„recipeæ–‡ä»¶ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ bitbake -e base-files <span class=p>|</span> grep ^FILE<span class=o>=</span>
</span></span><span class=line><span class=cl><span class=nv>FILE</span><span class=o>=</span><span class=s2>&#34;/home/lsc/yocto-kirkstone/poky/meta/recipes-core/base-files/base-files_3.0.14.bb&#34;</span>
</span></span></code></pre></div><p>åœ¨<code>base-files_3.0.14.bb</code>æ–‡ä»¶å¯ä»¥çœ‹åˆ°å¦‚ä¸‹å†…å®¹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>hostname</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>MACHINE</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>do_install <span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>[</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>hostname</span><span class=si>}</span><span class=s2>&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> <span class=si>${</span><span class=nv>hostname</span><span class=si>}</span> &gt; <span class=si>${</span><span class=nv>D</span><span class=si>}${</span><span class=nv>sysconfdir</span><span class=si>}</span>/hostname
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> <span class=s2>&#34;127.0.1.1 </span><span class=si>${</span><span class=nv>hostname</span><span class=si>}</span><span class=s2>&#34;</span> &gt;&gt; <span class=si>${</span><span class=nv>D</span><span class=si>}${</span><span class=nv>sysconfdir</span><span class=si>}</span>/hosts
</span></span><span class=line><span class=cl>    <span class=k>fi</span>
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>é¦–å…ˆç”¨<code>${MACHINE}</code>çš„å€¼è®¾ç½®äº†hostnameå˜é‡ï¼Œç„¶åæŠŠå®ƒå†™å…¥äº†<code>${D}${sysconfdir}/hostname</code>æ–‡ä»¶ã€‚<a href=https://docs.yoctoproject.org/4.0.12/ref-manual/variables.html#term-MACHINE title=MACHINE target=_blank rel=noreferrer>MACHINE</a>å®šä¹‰åœ¨<code>${BUILDDIR}/conf/local.conf</code>æ–‡ä»¶ä¸­ï¼Œè¿™å°±æ˜¯hostnameçš„é»˜è®¤å€¼ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ cat conf/local.conf <span class=p>|</span> grep ^MACHINE
</span></span><span class=line><span class=cl>MACHINE ??<span class=o>=</span> <span class=s2>&#34;qemux86-64&#34;</span>
</span></span></code></pre></div><p>å½“ç„¶å¯ä»¥åœ¨<code>base-files_3.0.14.bb</code>æ–‡ä»¶ä¸­çš„ä¿®æ”¹hostname å˜é‡ï¼Œä½†æ˜¯è¿™æ ·ä¸åˆ©äºç³»ç»Ÿç»´æŠ¤ï¼Œæ›´å¥½çš„åšæ³•æ˜¯åœ¨meta-mylayerä¸‹é¢æ–°å»º<code>recipes-core/base-files/base-files_3.0.14.bbappend</code>æ–‡ä»¶ï¼Œé‡æ–°è®¾ç½®hostnameï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>hostname</span> <span class=o>=</span> <span class=s2>&#34;localhost&#34;</span>
</span></span></code></pre></div><p>é‡æ–°æ„å»ºæ—¶ï¼Œbitbakeä¼šå…ˆæ‰¾åˆ°<code>base-files_3.0.14.bb</code>ï¼Œç„¶åæ‰¾åˆ°åŒåçš„<code>.bbappend</code>æ–‡ä»¶ï¼Œä¾æ®layerçš„ä¼˜å…ˆçº§åˆå¹¶è§£æè¿™äº›æ–‡ä»¶ã€‚å¾ˆå¤šæ—¶å€™ä¼šæœ‰æœ‰å¤šä¸ª<code>.bbappend</code>æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨bitbake-layerçš„show-appendså­å‘½ä»¤åˆ—å‡ºæŸä¸ªrecipeä¾èµ–çš„æ‰€æœ‰<code>.bb</code>å’Œ<code>.bbappend</code>æ–‡ä»¶ï¼Œä»¥base-filesä¸ºä¾‹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; bitbake-layers show-appends base-files
</span></span><span class=line><span class=cl>NOTE: Starting bitbake server...
</span></span><span class=line><span class=cl>Loading cache: 100% <span class=p>|</span><span class=c1>################################################################| Time: 0:00:00</span>
</span></span><span class=line><span class=cl>Loaded <span class=m>1645</span> entries from dependency cache.
</span></span><span class=line><span class=cl>Parsing recipes: 100% <span class=p>|</span><span class=c1>##############################################################| Time: 0:00:00</span>
</span></span><span class=line><span class=cl>Parsing of <span class=m>884</span> .bb files <span class=nb>complete</span> <span class=o>(</span><span class=m>883</span> cached, <span class=m>1</span> parsed<span class=o>)</span>. <span class=m>1645</span> targets, <span class=m>45</span> skipped, <span class=m>0</span> masked, <span class=m>0</span> errors.
</span></span><span class=line><span class=cl><span class=o>===</span> Matched appended <span class=nv>recipes</span> <span class=o>===</span>
</span></span><span class=line><span class=cl>base-files_3.0.14.bb:
</span></span><span class=line><span class=cl>  /home/lsc/yocto-kirkstone/x86_build/meta-mylayer/recipes-core/base-files/base-files_3.0.14.bbappend
</span></span></code></pre></div><p>æ‰€ä»¥ï¼Œbase-files_3.0.14.bbappendå¯¹hostnameçš„é‡æ–°èµ‹å€¼ä¼šæŠŠbase-files_3.0.14.bbä¸­çš„ç›¸åº”é…ç½®è¦†ç›–æ‰ã€‚æˆ‘ä»¬é‡æ–°æ„å»ºä¸€ä¸‹å°±å¯ä»¥ç¡®è®¤ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ bitbake base-files -c cleansstate
</span></span><span class=line><span class=cl>$ bitbake base-files 
</span></span><span class=line><span class=cl>$ cat tmp/work/qemux86_64-poky-linux/base-files/3.0.14-r89/packages-split/base-files/etc/hostname
</span></span><span class=line><span class=cl>localhost
</span></span></code></pre></div><h3 id=44-æ–°å»ºä¸€ä¸ªrecipe class="relative group">4.4 æ–°å»ºä¸€ä¸ªrecipe <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#44-%e6%96%b0%e5%bb%ba%e4%b8%80%e4%b8%aarecipe aria-label=é”šç‚¹>#</a></span></h3><p>å…¶å®ï¼ŒYoctoé€šè¿‡<code>poky/meta-skeleton</code>æä¾›äº†å¤šç§reciepå’Œconfigureçš„ä¾‹å­ï¼Œå…¶ä¸­çš„recipes-<code>skeleton/hello-single</code>æ˜¯ä¸€ä¸ªæ·»åŠ åº”ç”¨ç¨‹åºçš„ç®€å•å®ä¾‹ï¼Œæˆ‘ä»¬å‚è€ƒè¿™ä¸ªä¾‹å­æ”¹é€ ä¸€ä¸‹ï¼Œå‘imageæ·»åŠ ä¸€ä¸ªCè¯­è¨€çš„ä¸²å£æµ‹è¯•ç¨‹åºcomperfã€‚</p><p>é¦–å…ˆåœ¨meta-mylayerä¸‹æ–°å»º<code>recipes-app</code>æ–‡ä»¶å¤¹ï¼Œä¹‹æ‰€ä»¥ç”¨<code>recipes-</code>å¼€å¤´ï¼Œæ˜¯å› ä¸º<code>conf/layer.conf</code>æ–‡ä»¶ä¸­é»˜è®¤é…ç½®çš„<a href=https://docs.yoctoproject.org/4.0.12/ref-manual/variables.html#term-BBFILES title=BBFILES target=_blank rel=noreferrer>BBFILES</a>å˜é‡ï¼Œè§„å®šäº†åªä¼šæ£€ç´¢<code>recipes-*</code>æ–‡ä»¶å¤¹ä¸‹çš„<code>.bb</code>å’Œ <code>.bbappend</code>æ–‡ä»¶ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>BBFILES</span> <span class=o>+=</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>LAYERDIR</span><span class=si>}</span><span class=s2>/recipes-*/*/*.bb \
</span></span></span><span class=line><span class=cl><span class=s2>            </span><span class=si>${</span><span class=nv>LAYERDIR</span><span class=si>}</span><span class=s2>/recipes-*/*/*.bbappend&#34;</span>
</span></span></code></pre></div><p>ç„¶ååœ¨æ­¤ç›®å½•ä¸‹æ–°å»ºcomperfæ–‡ä»¶å¤¹ï¼ŒåŒ…å«å¦‚ä¸‹æ–‡ä»¶ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; tree comperf/
</span></span><span class=line><span class=cl>comperf/
</span></span><span class=line><span class=cl>â”œâ”€â”€ comperf_1.0.bb
</span></span><span class=line><span class=cl>â””â”€â”€ files
</span></span><span class=line><span class=cl>    â”œâ”€â”€ Makefile
</span></span><span class=line><span class=cl>    â”œâ”€â”€ README.md
</span></span><span class=line><span class=cl>    â””â”€â”€ comperf.c
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=m>1</span> directory, <span class=m>4</span> files
</span></span></code></pre></div><p>Makefile çš„å†…å®¹æ˜¯ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>comperf:comperf.c
</span></span><span class=line><span class=cl>  <span class=k>$(</span>CC<span class=k>)</span> <span class=si>${</span><span class=nv>CFLAGS</span><span class=si>}</span> $&lt; -o <span class=nv>$@</span> -lrt <span class=k>$(</span>LDFLAGS<span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>install:
</span></span><span class=line><span class=cl>  install -d <span class=k>$(</span>DESTDIR<span class=k>)</span>
</span></span><span class=line><span class=cl>  install -m <span class=m>0755</span> comperf <span class=k>$(</span>DESTDIR<span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>clean:
</span></span><span class=line><span class=cl>  rm -rf comperf
</span></span></code></pre></div><p>æŒ‰ç…§bitbakeçš„è§„å®šï¼Œrecipeæ–‡ä»¶helloworld_1.0.bbçš„æ–‡ä»¶åæœ‰ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼š</p><ul><li>ç¬¬ä¸€ä¸ªéƒ¨åˆ†æ˜¯recipeçš„åå­—ï¼Œbitbakeä¼šæŠŠå®ƒè§£æåˆ°<a href="https://docs.yoctoproject.org/4.0.12/ref-manual/variables.html?highlight=section#term-PN" title=PN target=_blank rel=noreferrer>PN</a>å˜é‡ä¸­ï¼Œè¿™é‡ŒPN=helloworldã€‚</li><li>ä¸‹åˆ’çº¿åé¢æ˜¯æºç çš„ç‰ˆæœ¬å·ï¼Œbitbakeä¼šæŠŠå®ƒè§£æåˆ°<a href="https://docs.yoctoproject.org/4.0.12/ref-manual/variables.html?highlight=section#term-PV" title=PV target=_blank rel=noreferrer>PV</a>å˜é‡ä¸­ï¼Œè¿™é‡ŒPV=1.0ã€‚</li><li>åç¼€å¿…é¡»æ˜¯<code>.bb</code>ã€‚</li></ul><p>å†…å®¹å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>DESCRIPTION</span> <span class=o>=</span> <span class=s2>&#34;Linux UART Serial test application&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>SECTION</span> <span class=o>=</span> <span class=s2>&#34;application&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>LICENSE</span> <span class=o>=</span> <span class=s2>&#34;MIT&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>LIC_FILES_CHKSUM</span> <span class=o>=</span> <span class=s2>&#34;file://</span><span class=si>${</span><span class=nv>COMMON_LICENSE_DIR</span><span class=si>}</span><span class=s2>/MIT;md5=0835ade698e0bcf8506ecda2f7b4f302&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>SRC_URI</span> <span class=o>=</span> <span class=s2>&#34;file://comperf.c \
</span></span></span><span class=line><span class=cl><span class=s2>           file://Makefile \
</span></span></span><span class=line><span class=cl><span class=s2>           file://README.md \
</span></span></span><span class=line><span class=cl><span class=s2>           &#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>S</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>WORKDIR</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>EXTRA_OEMAKE</span> <span class=o>=</span> <span class=s2>&#34;CC=&#39;</span><span class=si>${</span><span class=nv>CC</span><span class=si>}</span><span class=s2>&#39; CFLAGS=&#39;</span><span class=si>${</span><span class=nv>CFLAGS</span><span class=si>}</span><span class=s2>&#39; LDCFLAGS=&#39;</span><span class=si>${</span><span class=nv>LDFLAGS</span><span class=si>}</span><span class=s2>&#39; DESTDIR=&#39;</span><span class=si>${</span><span class=nv>D</span><span class=si>}${</span><span class=nv>bindir</span><span class=si>}</span><span class=s2>&#39;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>do_install<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    oe_runmake install
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>FILES:<span class=si>${</span><span class=nv>PN</span><span class=si>}</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>bindir</span><span class=si>}</span><span class=s2>/comperf&#34;</span> 
</span></span></code></pre></div><p>DESCRIPTIONæ˜¯å¯¹è¿™ä¸ªrecipeçš„æ•´ä½“æè¿°ï¼ŒSECTIONçš„å€¼ç”¨äºè½¯ä»¶å®‰è£…åŒ…åˆ†ç±»ï¼Œrpmç­‰åŒ…ç®¡ç†å™¨ä¼šç”¨å®ƒçš„å€¼å¡«å……è½¯ä»¶åŒ…çš„ä¿¡æ¯ï¼Œä¸æ˜¯å¿…é¡»çš„ã€‚</p><p>LICENSEæ ‡è¯†è¿™ä¸ªrecipeä½¿ç”¨çš„Licenseï¼Œè¿™é‡Œç”¨çš„æ˜¯MITã€‚<a href="https://docs.yoctoproject.org/4.0.12/ref-manual/variables.html?spm=wolai.workspace.0.0.5d1f23abMglYzs#term-LIC_FILES_CHKSUM" title=LIC_FILES_CHKSUM target=_blank rel=noreferrer>LIC_FILES_CHKSUM</a>æ˜¯Licenseæ–‡ä»¶çš„è·¯å¾„å’Œæ ¡éªŒå’Œã€‚Yoctoåœ¨<code>${COMMON_LICENSE_DIR}</code>è·¯å¾„ä¸‹æä¾›äº†å¤§é‡å¸¸ç”¨çš„Licesenæ–‡ä»¶ï¼Œé€šå¸¸ç›´æ¥ç”¨è¿™äº›å°±å¤Ÿäº†ï¼Œå¦‚æœè¦ä½¿ç”¨å…¶ä»–çš„Licesenæ–‡ä»¶ï¼Œå¯ä»¥æ”¾åˆ°<code>${SRC_URI}</code>ä¸­ï¼Œç„¶åå¡«å†™ç›¸å¯¹è·¯å¾„å³å¯ã€‚<code>md5=</code>è¡¨ç¤ºåé¢è·Ÿç€Licenseæ–‡ä»¶çš„md5æ ¡éªŒå’Œã€‚bitbakeå¼€å§‹æ„å»ºå‰ä¼šæ£€æŸ¥è¿™ä¸ªï¼Œå¦‚æœæ ¡éªŒå¤±è´¥ä¼šæŠ¥é”™ã€‚</p><p>æ‰§è¡Œdo_fetchä»»åŠ¡æ—¶ï¼Œbibakeä¼šä»<code>${SRC_URI}</code>è·å–æºç ï¼Œç„¶åé€šè¿‡do_unpackä»»åŠ¡æ”¾åˆ°<code>${WORKDIR}</code>è·¯å¾„ä¸‹ã€‚SRC_URIè®¾ç½®äº†æºç çš„è·¯å¾„ï¼Œ<code>file://</code> åè®®è¡¨ç¤ºè¿™äº›æ–‡ä»¶åœ¨æœ¬åœ°ï¼Œç„¶åæ˜¯æºç æ–‡ä»¶çš„è·¯å¾„ï¼Œè¿™ä¸ªè·¯å¾„æ˜¯åŸºäº <code>${FILESPATH}</code> çš„ç›¸å¯¹è·¯å¾„ï¼Œå¯ä»¥è®¾ç½®å•ä¸ªæ–‡ä»¶ï¼Œå‹ç¼©åŒ…æˆ–è€…æ•´ä¸ªç›®å½•ï¼Œé€šå¸¸æ˜¯æ”¾åœ¨recipeæ–‡ä»¶åŒä¸€å±‚çš„<code>files</code>æˆ–è€…<code>${PN}</code>æ–‡ä»¶å¤¹ä¸‹ã€‚</p><p>åé¢çš„ç¼–è¯‘å·¥ä½œè¦åœ¨<code>${S}</code>è®¾ç½®çš„è·¯å¾„ä¸‹è¿›è¡Œï¼Œä½†æ˜¯<a href=https://docs.yoctoproject.org/4.0.12/ref-manual/variables.html#term-S title=S target=_blank rel=noreferrer>S</a>çš„é»˜è®¤å€¼æ˜¯<code>${WORKDIR}/${BPN}-${PV}</code>ï¼Œæ‰€ä»¥è¦é‡è®¾<code>S = "${WORKDIR}"</code>ã€‚éœ€è¦æ³¨æ„ï¼Œå¦‚æœSRC_URIè®¾ç½®çš„æ˜¯å‹ç¼©åŒ…ï¼Œæ–‡ä»¶å¤¹æˆ–è€…å…¶ä»–åè®®ï¼Œè¿™ä¸ªè·¯å¾„æ˜¯ä¸ä¸€æ ·çš„ã€‚</p><p>å› ä¸ºæœ‰Makefileï¼Œbitbakeä¼šè‡ªåŠ¨æ‰§è¡ŒåŸºäºmakeçš„do_compileä»»åŠ¡ï¼Œä¸ç”¨æˆ‘ä»¬é‡å†™ï¼Œå¯ä»¥ç”¨<a href=https://docs.yoctoproject.org/4.0.12/ref-manual/variables.html#term-EXTRA_OEMAKE title=EXTRA_OEMAKE target=_blank rel=noreferrer>EXTRA_OEMAKE</a>å‘Makefileä¼ é€’ä¸€äº›éœ€è¦çš„å‚æ•°ã€‚<a href=https://docs.yoctoproject.org/4.0.12/ref-manual/variables.html#term-LDFLAGS title=LDFLAGS target=_blank rel=noreferrer>LDFLAGS</a>æ˜¯å‘é“¾æ¥å™¨ä¼ é€’çš„å‚æ•°ï¼Œä½¿ç›®æ ‡æ–‡ä»¶ä¸æ„å»ºç³»ç»Ÿçš„é“¾æ¥èµ·æ¥ã€‚<code>${bindir}</code>è¡¨ç¤ºimageä¸­å¯æ‰§è¡Œæ–‡ä»¶çš„å®‰è£…è·¯å¾„ï¼Œé»˜è®¤å€¼æ˜¯<code>/usr/bin</code>ã€‚è¿™äº›å‚æ•°éƒ½å®šä¹‰åœ¨<code>poky/meta/conf/bitbake.conf</code>æ–‡ä»¶ï¼Œå¸¸ç”¨çš„è¿˜æœ‰ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>base_prefix</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>prefix</span> <span class=o>=</span> <span class=s2>&#34;/usr&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>exec_prefix</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>prefix</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>sysconfdir</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>base_prefix</span><span class=si>}</span><span class=s2>/etc&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>bindir</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>exec_prefix</span><span class=si>}</span><span class=s2>/bin&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>sbindir</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>exec_prefix</span><span class=si>}</span><span class=s2>/sbin&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>CC</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>CCACHE</span><span class=si>}${</span><span class=nv>HOST_PREFIX</span><span class=si>}</span><span class=s2>gcc </span><span class=si>${</span><span class=nv>HOST_CC_ARCH</span><span class=si>}${</span><span class=nv>TOOLCHAIN_OPTIONS</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>CXX</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>CCACHE</span><span class=si>}${</span><span class=nv>HOST_PREFIX</span><span class=si>}</span><span class=s2>g++ </span><span class=si>${</span><span class=nv>HOST_CC_ARCH</span><span class=si>}${</span><span class=nv>TOOLCHAIN_OPTIONS</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>CPP</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>HOST_PREFIX</span><span class=si>}</span><span class=s2>gcc -E</span><span class=si>${</span><span class=nv>TOOLCHAIN_OPTIONS</span><span class=si>}</span><span class=s2> </span><span class=si>${</span><span class=nv>HOST_CC_ARCH</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>LD</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>HOST_PREFIX</span><span class=si>}</span><span class=s2>ld</span><span class=si>${</span><span class=nv>TOOLCHAIN_OPTIONS</span><span class=si>}</span><span class=s2> </span><span class=si>${</span><span class=nv>HOST_LD_ARCH</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>TARGET_CFLAGS</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>TARGET_CPPFLAGS</span><span class=si>}</span><span class=s2> </span><span class=si>${</span><span class=nv>SELECTED_OPTIMIZATION</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>CFLAGS</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>TARGET_CFLAGS</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>TARGET_LDFLAGS</span> <span class=o>=</span> <span class=s2>&#34;-Wl,-O1 </span><span class=si>${</span><span class=nv>TARGET_LINK_HASH_STYLE</span><span class=si>}</span><span class=s2> </span><span class=si>${</span><span class=nv>ASNEEDED</span><span class=si>}</span><span class=s2> </span><span class=si>${</span><span class=nv>DEBUG_PREFIX_MAP</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>LDFLAGS</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>TARGET_LDFLAGS</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span></code></pre></div><p>ä½†æ˜¯do_installä»»åŠ¡é»˜è®¤æ˜¯ç©ºçš„ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå®šä¹‰ï¼Œè¿™é‡Œæ˜¯è°ƒç”¨äº†Yoctoæä¾›çš„oe_runmakeå‡½æ•°æ‰§è¡ŒMakefileçš„installç›®æ ‡ï¼Œè¿™æ˜¯ç”±<a href=https://docs.yoctoproject.org/4.0.12/ref-manual/classes.html#base-bbclass title=base.bbclass target=_blank rel=noreferrer>base.bbclass</a>æ–‡ä»¶æä¾›çš„å‡½æ•°ï¼Œå¯ä»¥åœ¨<code>poky/meta/classes/</code> ä¸‹æ‰¾åˆ°ã€‚å¦‚æœMakefileæ²¡æœ‰installç›®æ ‡ï¼Œå¯ä»¥åœ¨do_installä¸­ç›´æ¥æ·»åŠ å®‰è£…å‘½ä»¤ï¼Œä¾‹å¦‚ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>do_install<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    install -d <span class=si>${</span><span class=nv>D</span><span class=si>}</span>/usr/bin
</span></span><span class=line><span class=cl>    install -m <span class=m>0755</span> comperf <span class=si>${</span><span class=nv>D</span><span class=si>}</span>/usr/bin
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>ç¼–è¯‘å’Œå®‰è£…å®Œæ¯•åï¼Œä¸‹ä¸€æ­¥è¦å¤„ç†do_packageä»»åŠ¡ã€‚å®ƒå…ˆæ ¹æ®<a href=https://docs.yoctoproject.org/4.0.12/ref-manual/variables.html#term-PACKAGES title=PACKAGES target=_blank rel=noreferrer>PACKAGES</a>å˜é‡æ¥ç¡®å®šè¦æ–°å»ºå‡ ä¸ªåŒ…ï¼Œä»¥ç©ºæ ¼åˆ†éš”ï¼Œé»˜è®¤å€¼æ˜¯ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=si>${</span><span class=nv>PN</span><span class=si>}</span>-src <span class=si>${</span><span class=nv>PN</span><span class=si>}</span>-dbg <span class=si>${</span><span class=nv>PN</span><span class=si>}</span>-staticdev <span class=si>${</span><span class=nv>PN</span><span class=si>}</span>-dev <span class=si>${</span><span class=nv>PN</span><span class=si>}</span>-doc <span class=si>${</span><span class=nv>PN</span><span class=si>}</span>-locale <span class=si>${</span><span class=nv>PACKAGE_BEFORE_PN</span><span class=si>}</span> <span class=si>${</span><span class=nv>PN</span><span class=si>}</span>
</span></span></code></pre></div><p>æˆ‘ä»¬æ²¡æœ‰ä¿®æ”¹ï¼Œæ‰€ä»¥<code>${PKGDEST}</code>è·¯å¾„ä¸‹æœ‰å¦‚ä¸‹æ–‡ä»¶å¤¹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>comperf      comperf-dev  comperf-locale  comperf-staticdev
</span></span><span class=line><span class=cl>comperf-dbg  comperf-doc  comperf-src
</span></span></code></pre></div><p>ç„¶åéå†<code>${PACKAGES}</code>ï¼Œæ ¹æ®ä¸æ¯ä¸ªè½¯ä»¶åŒ…å¯¹åº”çš„<a href=https://docs.yoctoproject.org/4.0.12/ref-manual/variables.html#term-FILES title=FILES target=_blank rel=noreferrer>FILES</a> å˜é‡ï¼Œå°†æ–‡ä»¶åˆ†é…ç»™è¿™äº›è½¯ä»¶åŒ…ã€‚ä¾‹å¦‚<code>FILES:${PN}</code>å°±æ˜¯å‘comperfè½¯ä»¶åŒ…æ·»åŠ çš„æ–‡ä»¶ã€‚å¦‚æœè¦å‘comperf-docè½¯ä»¶åŒ…æ·»åŠ æ–‡ä»¶ï¼Œåº”è¯¥è®¾ç½®<code>FILES:${PN}-doc</code>ã€‚å¦‚æœä¸€ä¸ªæ–‡ä»¶ä¸ <code>${PACKAGES}</code> ä¸­å¤šä¸ªè½¯ä»¶åŒ…çš„ <code>${FILES}</code> åŒ¹é…ï¼Œå®ƒå°†è¢«åˆ†é…åˆ°æœ€æ—©ï¼ˆæœ€å·¦ï¼‰åŒ¹é…çš„è½¯ä»¶åŒ…ã€‚ä¹‹åä¼šæ‰§è¡Œdo_package_write_rpmä»»åŠ¡ï¼ŒæŠŠè¿™äº›æ–‡ä»¶å¤¹æ‰“åŒ…æˆrpmè½¯ä»¶åŒ…ï¼Œæ”¾åˆ°<code>${WORKDIR}/deploy-rpms</code>è·¯å¾„ä¸‹ã€‚æœ€åè¿˜è¦æ‰§è¡Œ<a href=https://docs.yoctoproject.org/4.0.12/ref-manual/tasks.html#do-package-qa title=do_package_qa target=_blank rel=noreferrer>do_package_qa</a>ä»»åŠ¡ï¼Œå¯¹ç”Ÿæˆçš„è½¯ä»¶åŒ…è¿›è¡Œè´¨é‡æ£€æŸ¥ï¼Œç¡®ä¿æ„å»ºæ­£ç¡®ï¼Œå¦‚æœæœ‰â€œQA Issueâ€é”™è¯¯ï¼Œå¯ä»¥åœ¨<a href=https://docs.yoctoproject.org/4.0.12/ref-manual/qa-checks.html title="QA Error and Warning Messages" target=_blank rel=noreferrer>QA Error and Warning Messages</a>æŸ¥è¯¢é”™è¯¯ä¿¡æ¯çš„å«ä¹‰å’Œè§£å†³æ–¹æ³•ã€‚</p><p>å†™å¥½recipeåï¼Œæ„å»ºè°ƒè¯•æ²¡æœ‰é—®é¢˜ï¼Œå°±å¯ä»¥æŠŠéœ€è¦çš„è½¯ä»¶åŒ…æ·»åŠ åˆ°imageï¼Œåœ¨<code>meta-mylayer/recipes-core/images/core-image-minimal.bbappend</code>æ–‡ä»¶ä¸­æ·»åŠ ä¸€è¡Œï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>IMAGE_INSTALL:append <span class=o>=</span> <span class=s2>&#34; comperf&#34;</span>
</span></span></code></pre></div><h3 id=45-ä½¿ç”¨packagegroup class="relative group">4.5 ä½¿ç”¨packagegroup <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#45-%e4%bd%bf%e7%94%a8packagegroup aria-label=é”šç‚¹>#</a></span></h3><p>è§£æimageçš„IMAGE_INSTALLå˜é‡ï¼Œä¼šå‘ç°ä¸€ä¸ªåä¸º<code>packagegroup-core-boot</code>çš„è½¯ä»¶åŒ…ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ bitbake -e core-image-minimal <span class=p>|</span> grep ^IMAGE_INSTALL<span class=o>=</span>
</span></span><span class=line><span class=cl><span class=nv>IMAGE_INSTALL</span><span class=o>=</span><span class=s2>&#34;packagegroup-core-boot  strace comperf&#34;</span>
</span></span></code></pre></div><p>è¿™ç§ä»¥<code>packagegroup</code>å¼€å¤´çš„å¯ä»¥å«åšåŒ…ç»„ï¼Œå°±æ˜¯æŒ‰ç‰¹å®šéœ€æ±‚æŠŠå¤šä¸ªè½¯ä»¶åŒ…é›†åˆåˆ°ä¸€èµ·ï¼Œæœ¬è´¨ä¹Ÿæ˜¯recipeï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ oe-pkgdata-util lookup-recipe packagegroup-core-boot
</span></span><span class=line><span class=cl>packagegroup-core-boot
</span></span><span class=line><span class=cl>$ bitbake -e packagegroup-core-boot <span class=p>|</span> grep ^FILE<span class=o>=</span>
</span></span><span class=line><span class=cl><span class=nv>FILE</span><span class=o>=</span><span class=s2>&#34;/home/lsc/yocto-kirkstone/poky/meta/recipes-core/packagegroups/packagegroup-core-boot.bb&#34;</span>
</span></span></code></pre></div><p>å› ä¸ºåŒ…ç»„æœ¬èº«æ²¡æœ‰æºç ï¼Œæ‰€ä»¥æ–‡ä»¶åé‡Œæ²¡æœ‰è®¾ç½®PVï¼Œé»˜è®¤å€¼æ˜¯â€œ1.0â€ï¼Œåˆ†æä¸€ä¸‹è¿™ä¸ªæ–‡ä»¶ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>SUMMARY</span> <span class=o>=</span> <span class=s2>&#34;Minimal boot requirements&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>DESCRIPTION</span> <span class=o>=</span> <span class=s2>&#34;The minimal set of packages required to boot the system&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>PR</span> <span class=o>=</span> <span class=s2>&#34;r17&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>PACKAGE_ARCH</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>MACHINE_ARCH</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>inherit packagegroup
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Distro can override the following VIRTUAL-RUNTIME providers:</span>
</span></span><span class=line><span class=cl>VIRTUAL-RUNTIME_dev_manager ?<span class=o>=</span> <span class=s2>&#34;udev&#34;</span>
</span></span><span class=line><span class=cl>VIRTUAL-RUNTIME_keymaps ?<span class=o>=</span> <span class=s2>&#34;keymaps&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>EFI_PROVIDER ??<span class=o>=</span> <span class=s2>&#34;grub-efi&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>SYSVINIT_SCRIPTS</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>${</span><span class=p>@bb.utils.contains(</span><span class=s1>&#39;MACHINE_FEATURES&#39;</span><span class=p>, </span><span class=s1>&#39;rtc&#39;</span><span class=p>, </span><span class=s1>&#39;${VIRTUAL-RUNTIME_base-utils-hwclock}&#39;</span><span class=p>, </span><span class=s1>&#39;&#39;</span><span class=p>, d)</span><span class=si>}</span><span class=s2> \
</span></span></span><span class=line><span class=cl><span class=s2>                    modutils-initscripts \
</span></span></span><span class=line><span class=cl><span class=s2>                    init-ifupdown \
</span></span></span><span class=line><span class=cl><span class=s2>                    </span><span class=si>${</span><span class=nv>VIRTUAL</span><span class=p>-RUNTIME_initscripts</span><span class=si>}</span><span class=s2> \
</span></span></span><span class=line><span class=cl><span class=s2>                   &#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>RDEPENDS:<span class=si>${</span><span class=nv>PN</span><span class=si>}</span> <span class=o>=</span> <span class=s2>&#34;\
</span></span></span><span class=line><span class=cl><span class=s2>    base-files \
</span></span></span><span class=line><span class=cl><span class=s2>    base-passwd \
</span></span></span><span class=line><span class=cl><span class=s2>    </span><span class=si>${</span><span class=nv>VIRTUAL</span><span class=p>-RUNTIME_base-utils</span><span class=si>}</span><span class=s2> \
</span></span></span><span class=line><span class=cl><span class=s2>    </span><span class=si>${</span><span class=p>@bb.utils.contains(</span><span class=s2>&#34;DISTRO_FEATURES&#34;</span><span class=p>, </span><span class=s2>&#34;sysvinit&#34;</span><span class=p>, </span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>SYSVINIT_SCRIPTS</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>, </span><span class=s2>&#34;&#34;</span><span class=p>, d)</span><span class=si>}</span><span class=s2> \
</span></span></span><span class=line><span class=cl><span class=s2>    </span><span class=si>${</span><span class=p>@bb.utils.contains(</span><span class=s2>&#34;MACHINE_FEATURES&#34;</span><span class=p>, </span><span class=s2>&#34;keyboard&#34;</span><span class=p>, </span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>VIRTUAL</span><span class=p>-RUNTIME_keymaps</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>, </span><span class=s2>&#34;&#34;</span><span class=p>, d)</span><span class=si>}</span><span class=s2> \
</span></span></span><span class=line><span class=cl><span class=s2>    </span><span class=si>${</span><span class=p>@bb.utils.contains(</span><span class=s2>&#34;MACHINE_FEATURES&#34;</span><span class=p>, </span><span class=s2>&#34;efi&#34;</span><span class=p>, </span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>EFI_PROVIDER</span><span class=si>}</span><span class=s2> kernel&#34;</span><span class=p>, </span><span class=s2>&#34;&#34;</span><span class=p>, d)</span><span class=si>}</span><span class=s2> \
</span></span></span><span class=line><span class=cl><span class=s2>    netbase \
</span></span></span><span class=line><span class=cl><span class=s2>    </span><span class=si>${</span><span class=nv>VIRTUAL</span><span class=p>-RUNTIME_login_manager</span><span class=si>}</span><span class=s2> \
</span></span></span><span class=line><span class=cl><span class=s2>    </span><span class=si>${</span><span class=nv>VIRTUAL</span><span class=p>-RUNTIME_init_manager</span><span class=si>}</span><span class=s2> \
</span></span></span><span class=line><span class=cl><span class=s2>    </span><span class=si>${</span><span class=nv>VIRTUAL</span><span class=p>-RUNTIME_dev_manager</span><span class=si>}</span><span class=s2> \
</span></span></span><span class=line><span class=cl><span class=s2>    </span><span class=si>${</span><span class=nv>VIRTUAL</span><span class=p>-RUNTIME_update-alternatives</span><span class=si>}</span><span class=s2> \
</span></span></span><span class=line><span class=cl><span class=s2>    </span><span class=si>${</span><span class=nv>MACHINE_ESSENTIAL_EXTRA_RDEPENDS</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>RRECOMMENDS:<span class=si>${</span><span class=nv>PN</span><span class=si>}</span> <span class=o>=</span> <span class=s2>&#34;\
</span></span></span><span class=line><span class=cl><span class=s2>    </span><span class=si>${</span><span class=nv>VIRTUAL</span><span class=p>-RUNTIME_base-utils-syslog</span><span class=si>}</span><span class=s2> \
</span></span></span><span class=line><span class=cl><span class=s2>    </span><span class=si>${</span><span class=nv>MACHINE_ESSENTIAL_EXTRA_RRECOMMENDS</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span></code></pre></div><p>å¼€å¤´çš„<a href="https://docs.yoctoproject.org/4.0.12/ref-manual/variables.html?spm=wolai.workspace.0.0.5d1f23abPcawC8#term-PR" title=PR target=_blank rel=noreferrer>PR</a>æ˜¯recipeæ–‡ä»¶æœ¬èº«çš„ç‰ˆæœ¬å·ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œé»˜è®¤å€¼å°±æ˜¯â€œr0â€ã€‚<code>inherit packagegroup</code>è¡¨ç¤ºç»§æ‰¿<a href=https://docs.yoctoproject.org/4.0.12/ref-manual/classes.html#packagegroup-bbclass title=packagegroup.bbclass target=_blank rel=noreferrer>packagegroup.bbclass</a>ä¸­çš„æ–¹æ³•ï¼Œbitbake ä¼šåœ¨<a href="https://docs.yoctoproject.org/bitbake/2.0/bitbake-user-manual/bitbake-user-manual-ref-variables.html?highlight=bbpath#term-BBPATH" title=BBPATH target=_blank rel=noreferrer>BBPATH</a>æŒ‡å®šçš„è·¯å¾„ä¸­å¯»æ‰¾ <code>packagegroup.bbclass</code>æ–‡ä»¶ï¼Œ<code>inherit</code>æ˜¯ç”¨äºç»§æ‰¿<code>.bb</code>å’Œ<code>.bbclass</code>æ–‡ä»¶çš„è¯­æ³•ï¼Œæ”¯æŒç»§æ‰¿å¤šä¸ªæ–‡ä»¶å’Œä½¿ç”¨å˜é‡ã€‚å¦‚æœè¦ç»§æ‰¿å…¶ä»–ç±»å‹çš„æ–‡ä»¶ï¼Œæ¨èç”¨<code>include</code>æˆ–<code>require</code>è¯­æ³•ï¼ŒäºŒè€…çš„ä½œç”¨ç±»ä¼¼ï¼Œä¸»è¦åŒºåˆ«æ˜¯ï¼Œå¦‚æœæ‰¾ä¸åˆ°æŒ‡å®šæ–‡ä»¶ï¼Œ<code>require</code>ä¼šæŠ¥é”™ï¼Œè€Œ<code>include</code>ä¸ä¼šã€‚æ›´å¤šå…±äº«é€šç”¨åŠŸèƒ½çš„æ–¹æ³•å¯ä»¥å‚è€ƒ<a href=https://docs.yoctoproject.org/bitbake/2.0/bitbake-user-manual/bitbake-user-manual-metadata.html#sharing-functionality title="Sharing Functionality" target=_blank rel=noreferrer>Sharing Functionality</a>ã€‚</p><p>æ–‡ä»¶é‡Œæ²¡æœ‰è®¾ç½®SRC_URIæˆ–è€…FILESç­‰å˜é‡ï¼Œä¹Ÿæ²¡æœ‰å®šä¹‰do_compileç­‰ä»»åŠ¡ï¼Œæ‰€ä»¥å®ƒä¸ä¼šæ‰§è¡Œç¼–è¯‘ï¼Œå®‰è£…å’Œæ‰“åŒ…ç­‰ä»»åŠ¡ã€‚å…³é”®æ˜¯<a href=https://docs.yoctoproject.org/4.0.12/ref-manual/variables.html#term-RDEPENDS title=RDEPENDS target=_blank rel=noreferrer>RDEPENDS</a> å’Œ<a href=https://docs.yoctoproject.org/4.0.12/ref-manual/variables.html#term-RRECOMMENDS title=RRECOMMENDS target=_blank rel=noreferrer>RRECOMMENDS</a>å˜é‡ï¼š</p><ul><li><a href=https://docs.yoctoproject.org/4.0.12/ref-manual/variables.html#term-RDEPENDS title=RDEPENDS target=_blank rel=noreferrer>RDEPENDS</a>çš„ä½œç”¨æ˜¯åˆ—å‡ºè½¯ä»¶åŒ…çš„è¿è¡Œæ—¶ä¾èµ–é¡¹ï¼Œè¿™é‡Œåˆ—å‡ºçš„è½¯ä»¶åŒ…ä¹Ÿä¼šå®‰è£…åˆ°imageï¼Œå¦‚æœè¿™äº›ä¾èµ–é¡¹å‡ºé”™ï¼Œä¼šå½±å“æ•´ä¸ªæ„å»ºæµç¨‹ã€‚ä¾‹å¦‚<code>RDEPENDS:foo = "bar baz"</code>è¡¨ç¤ºè½¯ä»¶åŒ…fooéœ€è¦å®‰è£…è½¯ä»¶åŒ…barå’Œbazã€‚bitbakeä¼šè‡ªåŠ¨æ£€æµ‹å’Œæ·»åŠ å¸¸è§çš„è½¯ä»¶åŒ…ä¾èµ–å…³ç³»ï¼Œæ‰€ä»¥ï¼Œå¤šæ•°recipeä¸éœ€è¦è®¾ç½® RDEPENDSã€‚æ›´å¤šä¿¡æ¯è¯·å‚è€ƒ<a href=https://docs.yoctoproject.org/4.0.12/overview-manual/concepts.html#automatically-added-runtime-dependencies title="Automatically Added Runtime Dependencies" target=_blank rel=noreferrer>Automatically Added Runtime Dependencies</a>ã€‚</li><li><a href=https://docs.yoctoproject.org/4.0.12/ref-manual/variables.html#term-RRECOMMENDS title=RRECOMMENDS target=_blank rel=noreferrer>RRECOMMENDS</a>çš„ä½œç”¨æ˜¯åˆ—å‡ºè½¯ä»¶åŒ…çš„è¿è¡Œæ—¶åŠŸèƒ½æ‰©å±•é¡¹ï¼Œå®ƒä»¬ä¸æœ¬è½¯ä»¶åŒ…æ˜¯è½¯æ€§ä¾èµ–å…³ç³»ï¼Œå¯ä»¥æ‰©å±•æœ¬è½¯ä»¶åŒ…çš„å¯ç”¨æ€§ï¼Œä½†ä¸æ˜¯æ„å»ºçš„å¿…è¦æ¡ä»¶ã€‚å¦‚æœå­˜åœ¨å°±ç¼–è¯‘å®‰è£…ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œä¹Ÿä¸ä¼šå½±å“æœ¬è½¯ä»¶çš„æ„å»ºè¿‡ç¨‹ã€‚</li></ul><p>é€šè¿‡<a href=https://docs.yoctoproject.org/4.0.12/ref-manual/variables.html#term-RDEPENDS title=RDEPENDS target=_blank rel=noreferrer>RDEPENDS</a> å’Œ<a href=https://docs.yoctoproject.org/4.0.12/ref-manual/variables.html#term-RRECOMMENDS title=RRECOMMENDS target=_blank rel=noreferrer>RRECOMMENDS</a>å˜é‡å®‰è£…çš„è½¯ä»¶åŒ…ï¼Œä¸èƒ½ç›´æ¥åœ¨IMAGE_INSTALLå˜é‡ä¸­æ¸…é™¤ï¼Œå¯ä»¥ä½¿ç”¨<code>.bbappend</code>æ–‡ä»¶ä¿®æ”¹ç›¸åº”å˜é‡ï¼Œæˆ–è€…åœ¨<a href=https://docs.yoctoproject.org/4.0.12/ref-manual/variables.html?#term-PACKAGE_EXCLUDE title=PACKAGE_EXCLUDE target=_blank rel=noreferrer>PACKAGE_EXCLUDE</a>å˜é‡ä¸­åˆ—å‡ºç¦æ­¢å®‰è£…åˆ°imageçš„è½¯ä»¶åŒ…ï¼Œéœ€è¦æ³¨æ„å¤„ç†ç ´åä¾èµ–å…³ç³»è€Œå¯¼è‡´çš„é”™è¯¯ã€‚</p><p>è¿™é‡Œæ¶‰åŠåˆ°ä¸€ä¸ªé‡è¦çš„å‡½æ•°<code>bb.utils.contains()</code>ï¼Œç”±<a href=https://docs.yoctoproject.org/4.0.12/ref-manual/classes.html?#utils-bbclass title=utils.bbclass target=_blank rel=noreferrer>utils.bbclass</a>æä¾›ï¼Œè¯­æ³•æ˜¯ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>V</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>${</span><span class=p>@bb.utils.contains(</span><span class=s1>&#39;val&#39;</span><span class=p>, </span><span class=s1>&#39;a&#39;</span><span class=p>, </span><span class=s1>&#39;1&#39;</span><span class=p>, </span><span class=s1>&#39;2&#39;</span><span class=p>, d)</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span></code></pre></div><p>å®ƒçš„ä½œç”¨æ˜¯ï¼Œå¦‚æœå˜é‡ val ä¸­åŒ…å«äº† a ï¼Œå°±è¿”å› 1 ï¼Œå¦åˆ™è¿”å› 2 ã€‚ä¾‹å¦‚ä¸Šé¢çš„ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=si>${</span><span class=p>@bb.utils.contains(</span><span class=s2>&#34;DISTRO_FEATURES&#34;</span><span class=p>, </span><span class=s2>&#34;sysvinit&#34;</span><span class=p>, </span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>SYSVINIT_SCRIPTS</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>, </span><span class=s2>&#34;&#34;</span><span class=p>, d)</span><span class=si>}</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span><span class=si>${</span><span class=p>@bb.utils.contains(</span><span class=s2>&#34;MACHINE_FEATURES&#34;</span><span class=p>, </span><span class=s2>&#34;keyboard&#34;</span><span class=p>, </span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>VIRTUAL</span><span class=p>-RUNTIME_keymaps</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>, </span><span class=s2>&#34;&#34;</span><span class=p>, d)</span><span class=si>}</span> <span class=se>\
</span></span></span></code></pre></div><p>å¦‚æœ<a href=https://docs.yoctoproject.org/4.0.12/ref-manual/variables.html#term-DISTRO_FEATURES title=DISTRO_FEATURES target=_blank rel=noreferrer>DISTRO_FEATURES</a>ä¸­åŒ…å«äº†sysvinit ï¼Œå°±è¿”å›<code>${SYSVINIT_SCRIPTS}</code>ã€‚ç±»ä¼¼çš„<code>*_FEATURES</code>è¿˜æœ‰<a href=https://docs.yoctoproject.org/4.0.12/ref-manual/variables.html#term-MACHINE_FEATURES title=MACHINE_FEATURES target=_blank rel=noreferrer>MACHINE_FEATURES</a>ï¼Œ<a href=https://docs.yoctoproject.org/4.0.12/ref-manual/variables.html#term-IMAGE_FEATURES title=IMAGE_FEATURES target=_blank rel=noreferrer>IMAGE_FEATURES</a>ï¼Œ<a href=https://docs.yoctoproject.org/4.0.12/ref-manual/variables.html#term-EXTRA_IMAGE_FEATURES title=EXTRA_IMAGE_FEATURES target=_blank rel=noreferrer>EXTRA_IMAGE_FEATURES</a>ç­‰ï¼Œå®ƒä»¬çš„å€¼éƒ½ä¼šé€šè¿‡è¿™ç§æ–¹å¼å½±å“å®‰è£…åˆ°imageçš„è½¯ä»¶åŒ…ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨<code>conf/local.conf</code>æˆ–è€…<code>&lt;image>.bbappend</code>æ–‡ä»¶ä¸­ä¿®æ”¹è¿™äº›å˜é‡ã€‚æ›´å¤šä¿¡æ¯å¯ä»¥å‚è€ƒ<a href=https://docs.yoctoproject.org/4.0.14/ref-manual/features.html? title=Features target=_blank rel=noreferrer>Features</a>ã€‚</p><p>è¦ç¡®å®šå“ªäº›recipeä¼šæ£€æŸ¥æŸä¸ªç‰¹æ€§ï¼Œå¯ä»¥ç”¨grepå‘½ä»¤æŸ¥æ‰¾ï¼Œä¾‹å¦‚æŸ¥æ‰¾bluetoothçš„ç›¸å…³ç‰¹æ€§ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ <span class=nb>cd</span> poky/
</span></span><span class=line><span class=cl>$ grep -rn <span class=s1>&#39;contains.*MACHINE_FEATURES.*bluetooth&#39;</span> ./*
</span></span><span class=line><span class=cl>$ grep -rn <span class=s1>&#39;contains.*DISTRO_FEATURES.*bluetooth&#39;</span> ./*
</span></span></code></pre></div><h3 id=46-ä¿®æ”¹æ¬¢è¿ä¿¡æ¯ class="relative group">4.6 ä¿®æ”¹æ¬¢è¿ä¿¡æ¯ <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#46-%e4%bf%ae%e6%94%b9%e6%ac%a2%e8%bf%8e%e4%bf%a1%e6%81%af aria-label=é”šç‚¹>#</a></span></h3><p>Linux ç³»ç»Ÿå¯åŠ¨æ—¶ï¼Œä¼šæ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯æ¥è‡ª<code>/etc/issue*</code>æ–‡ä»¶ï¼š</p><p><figure><img src=./pics/image_20240315144905.png alt class="mx-auto my-0 rounded-md"></figure></p><p>å¯ä»¥æŸ¥åˆ°è¿™ä¸ªæ–‡ä»¶æ˜¯<code>base-files</code>è½¯ä»¶åŒ…å®‰è£…çš„</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ oe-pkgdata-util find-path /etc/issue
</span></span><span class=line><span class=cl>base-files: /etc/issue
</span></span></code></pre></div><p>åˆ†æè¿™ä¸ªè½¯ä»¶åŒ…çš„recipesæ–‡ä»¶å’Œä»»åŠ¡æ—¥å¿—ï¼Œå¯ä»¥ç¡®å®š<code>issue</code>å’Œ<code>issue.net</code>æ˜¯base-filesçš„æºæ–‡ä»¶ï¼Œè€Œä¸”æ˜¯ç©ºæ–‡ä»¶ï¼Œç”±<code>do_install()</code>ä»»åŠ¡å®‰è£…åˆ°imageå¹¶å‘æ–‡ä»¶è¿½åŠ äº†å†…å®¹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>SRC_URI</span> <span class=o>=</span> <span class=s2>&#34;file://rotation \
</span></span></span><span class=line><span class=cl><span class=s2>...
</span></span></span><span class=line><span class=cl><span class=s2>            file://issue.net \
</span></span></span><span class=line><span class=cl><span class=s2>            file://issue \
</span></span></span><span class=line><span class=cl><span class=s2>...
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>do_install () {
</span></span></span><span class=line><span class=cl><span class=s2>...
</span></span></span><span class=line><span class=cl><span class=s2>    </span><span class=si>${</span><span class=nv>BASEFILESISSUEINSTALL</span><span class=si>}</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>...
</span></span></span><span class=line><span class=cl><span class=s2>}
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>BASEFILESISSUEINSTALL ?= &#34;</span>do_install_basefilesissue<span class=s2>&#34;
</span></span></span><span class=line><span class=cl><span class=s2>...
</span></span></span><span class=line><span class=cl><span class=s2>do_install_basefilesissue () {
</span></span></span><span class=line><span class=cl><span class=s2>    install -m 644 </span><span class=si>${</span><span class=nv>WORKDIR</span><span class=si>}</span><span class=s2>/issue*  </span><span class=si>${</span><span class=nv>D</span><span class=si>}${</span><span class=nv>sysconfdir</span><span class=si>}</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>        if [ -n &#34;</span><span class=si>${</span><span class=nv>DISTRO_NAME</span><span class=si>}</span><span class=s2>&#34; ]; then
</span></span></span><span class=line><span class=cl><span class=s2>            printf &#34;</span><span class=si>${</span><span class=nv>DISTRO_NAME</span><span class=si>}</span> <span class=s2>&#34; &gt;&gt; </span><span class=si>${</span><span class=nv>D</span><span class=si>}${</span><span class=nv>sysconfdir</span><span class=si>}</span><span class=s2>/issue
</span></span></span><span class=line><span class=cl><span class=s2>            printf &#34;</span><span class=si>${</span><span class=nv>DISTRO_NAME</span><span class=si>}</span> <span class=s2>&#34; &gt;&gt; </span><span class=si>${</span><span class=nv>D</span><span class=si>}${</span><span class=nv>sysconfdir</span><span class=si>}</span><span class=s2>/issue.net
</span></span></span><span class=line><span class=cl><span class=s2>            if [ -n &#34;</span><span class=si>${</span><span class=nv>DISTRO_VERSION</span><span class=si>}</span><span class=s2>&#34; ]; then
</span></span></span><span class=line><span class=cl><span class=s2>                distro_version_nodate=&#34;</span><span class=si>${</span><span class=p>@d.getVar(</span><span class=s1>&#39;DISTRO_VERSION&#39;</span><span class=p>).replace(</span><span class=s1>&#39;snapshot-${DATE}    &#39;</span><span class=p>,</span><span class=s1>&#39;snapshot&#39;</span><span class=p>).replace(</span><span class=s1>&#39;${DATE}&#39;</span><span class=p>,</span><span class=s1>&#39;&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;
</span></span></span><span class=line><span class=cl><span class=s2>                printf &#34;</span>%s <span class=s2>&#34; </span><span class=nv>$distro_version_nodate</span><span class=s2> &gt;&gt; </span><span class=si>${</span><span class=nv>D</span><span class=si>}${</span><span class=nv>sysconfdir</span><span class=si>}</span><span class=s2>/issue
</span></span></span><span class=line><span class=cl><span class=s2>                printf &#34;</span>%s <span class=s2>&#34; </span><span class=nv>$distro_version_nodate</span><span class=s2> &gt;&gt; </span><span class=si>${</span><span class=nv>D</span><span class=si>}${</span><span class=nv>sysconfdir</span><span class=si>}</span><span class=s2>/issue.net
</span></span></span><span class=line><span class=cl><span class=s2>            fi
</span></span></span><span class=line><span class=cl><span class=s2>            printf &#34;</span><span class=se>\\\n</span> <span class=se>\\\l\n</span><span class=s2>&#34; &gt;&gt; </span><span class=si>${</span><span class=nv>D</span><span class=si>}${</span><span class=nv>sysconfdir</span><span class=si>}</span><span class=s2>/issue
</span></span></span><span class=line><span class=cl><span class=s2>            echo &gt;&gt; </span><span class=si>${</span><span class=nv>D</span><span class=si>}${</span><span class=nv>sysconfdir</span><span class=si>}</span><span class=s2>/issue
</span></span></span><span class=line><span class=cl><span class=s2>            echo &#34;</span>%h<span class=s2>&#34;    &gt;&gt; </span><span class=si>${</span><span class=nv>D</span><span class=si>}${</span><span class=nv>sysconfdir</span><span class=si>}</span><span class=s2>/issue.net
</span></span></span><span class=line><span class=cl><span class=s2>            echo &gt;&gt; </span><span class=si>${</span><span class=nv>D</span><span class=si>}${</span><span class=nv>sysconfdir</span><span class=si>}</span><span class=s2>/issue.net
</span></span></span><span class=line><span class=cl><span class=s2>        fi
</span></span></span><span class=line><span class=cl><span class=s2>}
</span></span></span></code></pre></div><p>æˆ‘ä»¬å¯ä»¥åœ¨<code>do_configure()</code>ä»»åŠ¡ä¸­æ·»åŠ è¯­å¥ï¼Œä¿®æ”¹<code>issue</code>å’Œ<code>issue.net</code>æºæ–‡ä»¶çš„å†…å®¹ã€‚åœ¨<code>meta-mylayer/recipes-core/base-files/base-files_3.0.14.bbappend</code>æ–‡ä»¶ä¸­æ·»åŠ ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>do_configure:append<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>system</span><span class=o>=</span><span class=s2>&#34;MyPoky&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nv>version</span><span class=o>=</span><span class=k>$(</span>date <span class=s2>&#34;+%Y%m%d&#34;</span><span class=k>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>system</span><span class=si>}</span><span class=s2> </span><span class=si>${</span><span class=nv>version</span><span class=si>}</span><span class=s2>&#34;</span> &gt; <span class=si>${</span><span class=nv>WORKDIR</span><span class=si>}</span>/issue
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>system</span><span class=si>}</span><span class=s2> </span><span class=si>${</span><span class=nv>version</span><span class=si>}</span><span class=s2>&#34;</span> &gt; <span class=si>${</span><span class=nv>WORKDIR</span><span class=si>}</span>/issue.net
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p><code>do_configure:append</code>è¡¨ç¤ºå‘<code>do_configure()</code>ä»»åŠ¡è¿½åŠ å†…å®¹ï¼Œè¿™é‡Œè®¾ç½®äº†ç”¨å½“å‰æ—¥æœŸä½œä¸ºç‰ˆæœ¬å·ï¼Œæ¯æ¬¡æ„å»ºæ—¶éƒ½ä¼šè‡ªåŠ¨æ›´æ–°ã€‚é‡æ–°æ„å»ºbase-filesï¼Œå¯ä»¥çœ‹åˆ°ç‰ˆæœ¬å·å·²ç»æ·»åŠ åˆ°æ–‡ä»¶ï¼Œè€Œ<code>${WORKDIR}/issue</code>å’Œ<code>${WORKDIR}/image/etc/issue</code>æ–‡ä»¶çš„å†…å®¹æœ‰æ‰€ä¸é€šï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ ls tmp/work/qemux86_64-poky-linux/base-files/3.0.14-r89
</span></span><span class=line><span class=cl>base-files.spec           issue            patches                rotation
</span></span><span class=line><span class=cl>configure.sstate          issue.net        pkgdata                share
</span></span><span class=line><span class=cl>deploy-rpms               license-destdir  pkgdata-pdata-input    shells
</span></span><span class=line><span class=cl>deploy-source-date-epoch  licenses         pkgdata-sysroot        source-date-epoch
</span></span><span class=line><span class=cl>fstab                     motd             profile                sysroot-destdir
</span></span><span class=line><span class=cl>host.conf                 nsswitch.conf    pseudo                 temp
</span></span><span class=line><span class=cl>hosts                     package          recipe-sysroot
</span></span><span class=line><span class=cl>image                     packages-split   recipe-sysroot-native
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ cat tmp/work/qemux86_64-poky-linux/base-files/3.0.14-r89/issue
</span></span><span class=line><span class=cl>MyPoky <span class=m>20240315</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ cat tmp/work/qemux86_64-poky-linux/base-files/3.0.14-r89/image/etc/issue
</span></span><span class=line><span class=cl>MyPoky <span class=m>20240315</span>
</span></span><span class=line><span class=cl>Poky <span class=o>(</span>Yocto Project Reference Distro<span class=o>)</span> 4.0.12 <span class=se>\n</span> <span class=se>\l</span>
</span></span></code></pre></div><p>è¿™æ˜¯å› ä¸º<code>do_install()</code>åœ¨<code>do_configure()</code>åé¢æ‰§è¡Œï¼Œåˆè¿½åŠ äº†å†…å®¹ï¼Œå¦‚æœè¦é‡æ–°è®¾ç½®æ¬¢è¿ä¿¡æ¯ï¼Œå¯ä»¥åœ¨<code>base-files_3.0.14.bbappend</code>æ–‡ä»¶ä¸­é‡å†™<code>do_install()</code>ä»»åŠ¡ã€‚</p><h3 id=47-ç”Ÿæˆsdk class="relative group">4.7 ç”ŸæˆSDK <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#47-%e7%94%9f%e6%88%90sdk aria-label=é”šç‚¹>#</a></span></h3><p>æ‰§è¡Œ<code>bitbake [image] -c do_populate_sdk</code>å¯ä»¥ç”Ÿæˆç›¸åº”imageçš„SDKï¼ŒåŒ…å«äº†å·¥å…·é“¾å’Œç¼–è¯‘åº“ç­‰ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ bitbake core-image-minimal -c do_populate_sdk
</span></span></code></pre></div><p>ç”Ÿæˆçš„SDKå®‰è£…è„šæœ¬ä½äº<code>tmp/deploy/sdk</code>è·¯å¾„ä¸‹ï¼Œæ‰§è¡Œåé»˜è®¤å®‰è£…åˆ°<code>/opt/poky/4.0.12</code>è·¯å¾„ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ ls
</span></span><span class=line><span class=cl>poky-glibc-x86_64-core-image-minimal-core2-64-qemux86-64-toolchain-4.0.12.host.manifest
</span></span><span class=line><span class=cl>poky-glibc-x86_64-core-image-minimal-core2-64-qemux86-64-toolchain-4.0.12.sh
</span></span><span class=line><span class=cl>poky-glibc-x86_64-core-image-minimal-core2-64-qemux86-64-toolchain-4.0.12.target.manifest
</span></span><span class=line><span class=cl>poky-glibc-x86_64-core-image-minimal-core2-64-qemux86-64-toolchain-4.0.12.testdata.json
</span></span><span class=line><span class=cl>$ ./poky-glibc-x86_64-core-image-minimal-core2-64-qemux86-64-toolchain-4.0.12.sh
</span></span><span class=line><span class=cl>Poky <span class=o>(</span>Yocto Project Reference Distro<span class=o>)</span> SDK installer version 4.0.12
</span></span><span class=line><span class=cl><span class=o>==================================================================</span>
</span></span><span class=line><span class=cl>Enter target directory <span class=k>for</span> SDK <span class=o>(</span>default: /opt/poky/4.0.12<span class=o>)</span>:
</span></span><span class=line><span class=cl>You are about to install the SDK to <span class=s2>&#34;/opt/poky/4.0.12&#34;</span>. Proceed <span class=o>[</span>Y/n<span class=o>]</span>?
</span></span><span class=line><span class=cl><span class=o>[</span>sudo<span class=o>]</span> password <span class=k>for</span> lsc:
</span></span><span class=line><span class=cl>Extracting SDK........................................................done
</span></span><span class=line><span class=cl>Setting it up...done
</span></span><span class=line><span class=cl>SDK has been successfully <span class=nb>set</span> up and is ready to be used.
</span></span><span class=line><span class=cl>Each <span class=nb>time</span> you wish to use the SDK in a new shell session, you need to <span class=nb>source</span> the environment setup script e.g.
</span></span><span class=line><span class=cl> $ . /opt/poky/4.0.12/environment-setup-core2-64-poky-linux
</span></span></code></pre></div><p>ä¸»è¦åŒ…æ‹¬å¦‚ä¸‹æ–‡ä»¶ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ tree -L <span class=m>2</span>
</span></span><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>â”œâ”€â”€ environment-setup-core2-64-poky-linux
</span></span><span class=line><span class=cl>â”œâ”€â”€ site-config-core2-64-poky-linux
</span></span><span class=line><span class=cl>â”œâ”€â”€ sysroots
</span></span><span class=line><span class=cl>â”‚   â”œâ”€â”€ core2-64-poky-linux
</span></span><span class=line><span class=cl>â”‚   â””â”€â”€ x86_64-pokysdk-linux
</span></span><span class=line><span class=cl>â””â”€â”€ version-core2-64-poky-linux
</span></span></code></pre></div><ul><li>environment-setup-core2-64-poky-linux æ˜¯åˆå§‹åŒ–SDKç¯å¢ƒçš„è„šæœ¬</li><li>x86_64-pokysdk-linuxæ˜¯å®¿ä¸»æœºçš„å¼€å‘ç¯å¢ƒï¼ŒåŒ…å«äº†äº¤å‰ç¼–è¯‘å·¥å…·é“¾ï¼Œå’Œè¿è¡ŒSDKéœ€è¦çš„å„ç§åº“ã€‚</li><li>core2-64-poky-linuxæ˜¯ç›®æ ‡æœºçš„è¿è¡Œç¯å¢ƒï¼ŒåŒ…å«äº†ç¼–è¯‘é“¾æ¥çš„åº“å’Œå¤´æ–‡ä»¶ç­‰ã€‚</li></ul><p>ä½¿ç”¨æ—¶ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤åˆå§‹åŒ–SDKä½¿ç”¨ç¯å¢ƒï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ . /opt/poky/4.0.12/environment-setup-core2-64-poky-linux
</span></span><span class=line><span class=cl>$ <span class=nb>echo</span> <span class=si>${</span><span class=nv>CC</span><span class=si>}</span>
</span></span><span class=line><span class=cl>x86_64-poky-linux-gcc -m64 -march<span class=o>=</span>core2 -mtune<span class=o>=</span>core2 -msse3 -mfpmath<span class=o>=</span>sse -fstack-protector-strong -O2 -D_FORTIFY_SOURCE<span class=o>=</span><span class=m>2</span> -Wformat -Wformat-security -Werror<span class=o>=</span>format-security --sysroot<span class=o>=</span>/opt/poky/4.0.12/sysroots/core2-64-poky-linux
</span></span></code></pre></div><p>ä¸€äº›å…³é”®çš„å˜é‡ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>CC</span><span class=o>=</span>x86_64-poky-linux-gcc  -m64 -march<span class=o>=</span>core2 -mtune<span class=o>=</span>core2 -msse3 -mfpmath<span class=o>=</span>sse -fstack-protector-strong  -O2 -D_FORTIFY_SOURCE<span class=o>=</span><span class=m>2</span> -Wformat -Wformat-security -Werror<span class=o>=</span>format-security --sysroot<span class=o>=</span>/opt/poky/4.0.12/sysroots/core2-64-poky-linux
</span></span><span class=line><span class=cl><span class=nv>CFLAGS</span><span class=o>=</span> -O2 -pipe -g -feliminate-unused-debug-types
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>CXX</span><span class=o>=</span>x86_64-poky-linux-g++  -m64 -march<span class=o>=</span>core2 -mtune<span class=o>=</span>core2 -msse3 -mfpmath<span class=o>=</span>sse -fstack-protector-strong  -O2 -D_FORTIFY_SOURCE<span class=o>=</span><span class=m>2</span> -Wformat -Wformat-security -Werror<span class=o>=</span>format-security --sysroot<span class=o>=</span>/opt/poky/4.0.12/sysroots/core2-64-poky-linux
</span></span><span class=line><span class=cl><span class=nv>CXXFLAGS</span><span class=o>=</span> -O2 -pipe -g -feliminate-unused-debug-types
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>LD</span><span class=o>=</span>x86_64-poky-linux-ld   --sysroot<span class=o>=</span>/opt/poky/4.0.12/sysroots/core2-64-poky-linux
</span></span><span class=line><span class=cl><span class=nv>LDFLAGS</span><span class=o>=</span>-Wl,-O1 -Wl,--hash-style<span class=o>=</span>gnu -Wl,--as-needed  -Wl,-z,relro,-z,now
</span></span></code></pre></div><p>ç„¶åç¼–è¯‘ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ <span class=si>${</span><span class=nv>CC</span><span class=si>}</span> hello.c -o helle
</span></span></code></pre></div><h3 id=48-åº”ç”¨å¼€å‘å’Œè°ƒè¯• class="relative group">4.8 åº”ç”¨å¼€å‘å’Œè°ƒè¯• <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#48-%e5%ba%94%e7%94%a8%e5%bc%80%e5%8f%91%e5%92%8c%e8%b0%83%e8%af%95 aria-label=é”šç‚¹>#</a></span></h3><p>å‚è€ƒ<a href=https://docs.yoctoproject.org/4.0.14/dev-manual/debugging.html#debugging-with-the-gnu-project-debugger-gdb-remotely title="Debugging With the GNU Project Debugger (GDB) Remotely" target=_blank rel=noreferrer>Debugging With the GNU Project Debugger (GDB) Remotely</a>ã€‚</p><p>ç³»ç»Ÿçš„DISTRO_FEATURESå˜é‡é»˜è®¤å·²ç»åŒ…å«äº†<code>debuginfod</code>ç‰¹æ€§ï¼Œè¿™ä¸ªç‰¹æ€§ä¼šä½¿gdbä½¿èƒ½debuginfodç‰¹æ€§ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># recipes-devtools/gdb/gdb-common.inc</span>
</span></span><span class=line><span class=cl>PACKAGECONFIG ??<span class=o>=</span> <span class=s2>&#34;readline </span><span class=si>${</span><span class=p>@bb.utils.filter(</span><span class=s1>&#39;DISTRO_FEATURES&#39;</span><span class=p>, </span><span class=s1>&#39;debuginfod&#39;</span><span class=p>, d)</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>PACKAGECONFIG<span class=o>[</span>debuginfod<span class=o>]</span> <span class=o>=</span> <span class=s2>&#34;--with-debuginfod, --without-debuginfod, elfutils&#34;</span>
</span></span></code></pre></div><p>è¿™é‡Œæ¶‰åŠåˆ°ä¸€ä¸ªé‡è¦çš„å‡½æ•°<code>bb.utils.filter()</code>ï¼Œç”±<a href=https://docs.yoctoproject.org/4.0.14/ref-manual/classes.html?#utils-bbclass title=utils.bbclass target=_blank rel=noreferrer>utils.bbclass</a>æä¾›ï¼Œè¯­æ³•æ˜¯ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>bb.utils.filter<span class=o>(</span><span class=s1>&#39;variable&#39;</span>, <span class=s1>&#39;checkvalue&#39;</span>, d<span class=o>)}</span>
</span></span></code></pre></div><p>å®ƒçš„ä½œç”¨æ˜¯æ£€æŸ¥<code>${variable}</code>ä¸­æ˜¯å¦åŒ…å«å­—ç¬¦ä¸²<code>'checkvalue'</code>ï¼ŒæˆåŠŸåˆ™è¿”å›<code>'checkvalue'</code>ï¼Œå¦åˆ™è¿”å›ç©ºã€‚æ‰€ä»¥ï¼Œç¬¬ä¸€è¡Œ<a href=https://docs.yoctoproject.org/4.0.14/ref-manual/variables.html#term-PACKAGECONFIG title=PACKAGECONFIG target=_blank rel=noreferrer>PACKAGECONFIG</a>å˜é‡çš„å€¼æ˜¯<code>readline debuginfod</code>ã€‚ç¬¬äºŒè¡Œåˆ©ç”¨äº†bitbakeçš„<a href=https://docs.yoctoproject.org/bitbake/2.0/bitbake-user-manual/bitbake-user-manual-metadata.html#variable-flag-syntax title="Variable Flag" target=_blank rel=noreferrer>Variable Flag</a>è¯­æ³•ï¼Œå¯ä»¥å½±å“<a href=https://docs.yoctoproject.org/4.0.14/ref-manual/variables.html#term-PACKAGECONFIG_CONFARGS title=PACKAGECONFIG_CONFARGS target=_blank rel=noreferrer>PACKAGECONFIG_CONFARGS</a>å’Œ<a href=https://docs.yoctoproject.org/4.0.14/ref-manual/variables.html#term-DEPENDS title=DEPENDS target=_blank rel=noreferrer>DEPENDS</a>å˜é‡çš„å€¼ï¼Œè¿™é‡Œçš„å«ä¹‰æ˜¯ï¼š</p><ol><li>å¦‚æœPACKAGECONFIGä¸­å®šä¹‰äº†debuginfodï¼Œåˆ™å‘PACKAGECONFIG_CONFARGSæ·»åŠ <code>--with-debuginfod</code>ã€‚</li><li>å¦‚æœPACKAGECONFIGæ²¡æœ‰å®šä¹‰debuginfodï¼Œåˆ™å‘PACKAGECONFIG_CONFARGSæ·»åŠ <code>--without-debuginfod</code>ã€‚</li><li>å¦‚æœPACKAGECONFIGä¸­å®šä¹‰äº†debuginfodï¼Œåˆ™å‘DEPENDSä¸­æ·»åŠ <code>elfutils</code>ã€‚</li></ol><p>ä½¿ç”¨æ–¹æ³•å°±å¾ˆç®€å•äº†ï¼Œåœ¨å®¿ä¸»æœºä¸Šæ‰§è¡Œ<code>oe-debuginfod</code>å‘½ä»¤å¯åŠ¨debuginfod serverï¼Œåœ¨ç›®æ ‡æœºä¸Šè®¾ç½®æœåŠ¡å™¨åœ°å€ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>root@qemux86-64:~# <span class=nb>export</span> <span class=nv>DEBUGINFOD_URLS</span><span class=o>=</span><span class=s2>&#34;http://192.168.7.1:8002/&#34;</span>
</span></span></code></pre></div><p>ç„¶åå¯ä»¥ç”¨<code>gdb</code>, <code>readelf</code> æˆ–è€… <code>objdump</code>ä¸debuginfod serverå»ºç«‹è¿æ¥ï¼Œè·å–è°ƒè¯•ä¿¡æ¯ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>root@qemux86-64:~# gdb /bin/cat
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>Reading symbols from /bin/cat...
</span></span><span class=line><span class=cl>Downloading separate debug info <span class=k>for</span> /bin/cat...
</span></span><span class=line><span class=cl>Reading symbols from /home/root/.cache/debuginfod_client/923dc4780cfbc545850c616bffa884b6b5eaf322/debuginfo...
</span></span></code></pre></div><h2 id=5-å†…æ ¸å¼€å‘ class="relative group">5. å†…æ ¸å¼€å‘ <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#5-%e5%86%85%e6%a0%b8%e5%bc%80%e5%8f%91 aria-label=é”šç‚¹>#</a></span></h2><p>å†…æ ¸å¼€å‘çš„è¯¦ç»†å†…å®¹å¯ä»¥å‚è€ƒ <a href=https://docs.yoctoproject.org/4.0.14/kernel-dev/index.html title="Yocto Project Linux Kernel Development Manual" target=_blank rel=noreferrer>Yocto Project Linux Kernel Development Manual</a>ã€‚pokyçš„å†…æ ¸recipeæ–‡ä»¶æ˜¯<code>meta/recipes-kernel/linux/linux-yocto_5.15.bb</code>ã€‚</p><h3 id=51-æ·»åŠ å¤–éƒ¨æ¨¡å— class="relative group">5.1 æ·»åŠ å¤–éƒ¨æ¨¡å— <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#51-%e6%b7%bb%e5%8a%a0%e5%a4%96%e9%83%a8%e6%a8%a1%e5%9d%97 aria-label=é”šç‚¹>#</a></span></h3><p>è„±ç¦»å†…æ ¸æºç æ ‘ï¼Œç‹¬ç«‹å­˜åœ¨çš„å†…æ ¸æ¨¡å—ï¼Œå¯ä»¥åƒè½¯ä»¶åŒ…ä¸€æ ·æ·»åŠ åˆ°imageä¸­ï¼Œ<code>poky/meta-skeleton/recipes-kernel/hello-mod</code>æ˜¯ä¸€ä¸ªç®€å•å®ä¾‹ï¼Œæˆ‘ä»¬å‚è€ƒè¿™ä¸ªå‘ç³»ç»Ÿæ·»åŠ ä¸€ä¸ªå†…æ ¸æ¨¡å—ã€‚</p><p>åœ¨<code>meta-mylayer</code>æ–°å»º<code>recipes-kernel/hello-mod</code>æ–‡ä»¶å¤¹ï¼Œæ·»åŠ å¦‚ä¸‹æ–‡ä»¶ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ tree hello-mod
</span></span><span class=line><span class=cl>hello-mod
</span></span><span class=line><span class=cl>â”œâ”€â”€ files
</span></span><span class=line><span class=cl>â”‚   â””â”€â”€ hello-mod
</span></span><span class=line><span class=cl>â”‚       â”œâ”€â”€ COPYING
</span></span><span class=line><span class=cl>â”‚       â”œâ”€â”€ Makefile
</span></span><span class=line><span class=cl>â”‚       â””â”€â”€ hello.c
</span></span><span class=line><span class=cl>â””â”€â”€ hello-mod_0.1.bb
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=m>2</span> directories, <span class=m>4</span> files
</span></span></code></pre></div><p><code>files/hello-mod</code>è·¯å¾„ä¸‹å°±æ˜¯å†…æ ¸æ¨¡å—çš„æºç ï¼Œéœ€è¦æ³¨æ„Makefileçš„å†™æ³•ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>obj-m :<span class=o>=</span> hello.o
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>SRC :<span class=o>=</span> <span class=k>$(</span>shell <span class=nb>pwd</span><span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>all:
</span></span><span class=line><span class=cl>  <span class=k>$(</span>MAKE<span class=k>)</span> -C <span class=k>$(</span>KERNEL_SRC<span class=k>)</span> <span class=nv>M</span><span class=o>=</span><span class=k>$(</span>SRC<span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>modules_install:
</span></span><span class=line><span class=cl>  <span class=k>$(</span>MAKE<span class=k>)</span> -C <span class=k>$(</span>KERNEL_SRC<span class=k>)</span> <span class=nv>M</span><span class=o>=</span><span class=k>$(</span>SRC<span class=k>)</span> modules_install
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>clean:
</span></span><span class=line><span class=cl>  rm -f *.o *~ core .depend .*.cmd *.ko *.mod.c
</span></span><span class=line><span class=cl>  rm -f Module.markers Module.symvers modules.order
</span></span><span class=line><span class=cl>  rm -rf .tmp_versions Modules.symvers
</span></span></code></pre></div><p><code>hello-mod_0.1.bb</code>çš„å†…å®¹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>SUMMARY</span> <span class=o>=</span> <span class=s2>&#34;Example of how to build an external Linux kernel module&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>DESCRIPTION</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>SUMMARY</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>LICENSE</span> <span class=o>=</span> <span class=s2>&#34;GPL-2.0-only&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>LIC_FILES_CHKSUM</span> <span class=o>=</span> <span class=s2>&#34;file://COPYING;md5=12f884d2ae1ff87c09e5b7ccc2c4ca7e&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>inherit module
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>SRC_URI</span> <span class=o>=</span> <span class=s2>&#34;file://hello-mod&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>S</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>WORKDIR</span><span class=si>}</span><span class=s2>/hello-mod&#34;</span>
</span></span></code></pre></div><p><code>LIC_FILES_CHKSUM</code>æ˜¯Licenseæ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„å’Œæ ¡éªŒå’Œï¼Œéœ€è¦æ³¨æ„ç›¸å¯¹è·¯å¾„æ˜¯æŒ‡ç›¸å¯¹<code>${S}</code>ã€‚<code>SRC_URI</code>è®¾ç½®äº†æºç è·¯å¾„ï¼Œå› ä¸ºæºç æ”¾åœ¨æœ¬åœ°çš„<code>files/hello-mod</code>è·¯å¾„ä¸‹ï¼Œæ‰€ä»¥æŒ‡è®¾ç½®ä¸€ä¸ªæ–‡ä»¶å¤¹åç§°å³å¯ã€‚<code>inherit module</code>è¡¨ç¤ºç»§æ‰¿module.bbclassçš„ç›¸å…³ä»»åŠ¡ï¼Œå®ƒä¼šè‡ªåŠ¨ä½¿ç”¨<code>kernel-module-</code>å‰ç¼€å‘½åè½¯ä»¶å®‰è£…åŒ…ï¼Œç”Ÿæˆçš„è½¯ä»¶åŒ…æ˜¯<code>kernel-module-hello-5.15.120-yocto-standard-0.1-r0.qemux86_64.rpm</code>ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ ls deploy-rpms/qemux86_64/
</span></span><span class=line><span class=cl>hello-mod-0.1-r0.qemux86_64.rpm
</span></span><span class=line><span class=cl>hello-mod-dbg-0.1-r0.qemux86_64.rpm
</span></span><span class=line><span class=cl>hello-mod-dev-0.1-r0.qemux86_64.rpm
</span></span><span class=line><span class=cl>kernel-module-hello-5.15.120-yocto-standard-0.1-r0.qemux86_64.rpm
</span></span></code></pre></div><p>ç„¶ååœ¨<code>core-image-minimal.bbappend</code>ä¸­å°†æ¨¡å—æ·»åŠ åˆ°imageï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>IMAGE_INSTALL:append <span class=o>=</span> <span class=s2>&#34; hello-mod&#34;</span>
</span></span></code></pre></div><p>æ¨¡å—å®‰è£…åœ¨<code>/lib/modules/5.15.120-yocto-standard/extra/</code>è·¯å¾„ä¸‹ã€‚å¯åŠ¨è™šæ‹ŸæœºåéªŒè¯åŠ è½½å¸è½½ï¼š</p><p><figure><img src=./pics/image_zIKc9Pbda5.png alt class="mx-auto my-0 rounded-md"></figure></p><h3 id=52-ä¿®æ”¹å†…æ ¸æºç  class="relative group">5.2 ä¿®æ”¹å†…æ ¸æºç  <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#52-%e4%bf%ae%e6%94%b9%e5%86%85%e6%a0%b8%e6%ba%90%e7%a0%81 aria-label=é”šç‚¹>#</a></span></h3><p>ä¿®æ”¹å†…æ ¸æºç æ ‘çš„æ–¹æ³•æœ‰å¾ˆå¤šï¼Œè¿™é‡Œæ¨èç”¨gitç”Ÿäº§æºç è¡¥ä¸ï¼Œå†æ·»åŠ éƒ½recipeä¸­ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ã€‚</p><p>æ‰¾åˆ°å†…æ ¸æºç çš„è·¯å¾„<code>${S}</code>ï¼Œä¿®æ”¹<code>init/calibrate.c</code>æ–‡ä»¶ï¼Œåœ¨<code>calibrate_delay()</code>å‡½æ•°æ·»åŠ å‡ è¡Œæ‰“å°å¯åŠ¨ä¿¡æ¯ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>void</span> <span class=nf>calibrate_delay</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>unsigned</span> <span class=kt>long</span> <span class=n>lpj</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=kt>bool</span> <span class=n>printed</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>this_cpu</span> <span class=o>=</span> <span class=nf>smp_processor_id</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nf>printk</span><span class=p>(</span><span class=s>&#34;*************************************</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>printk</span><span class=p>(</span><span class=s>&#34;*                                   *</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>printk</span><span class=p>(</span><span class=s>&#34;*        HELLO YOCTO KERNEL         *</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>printk</span><span class=p>(</span><span class=s>&#34;*                                   *</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>printk</span><span class=p>(</span><span class=s>&#34;*************************************</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nf>per_cpu</span><span class=p>(</span><span class=n>cpu_loops_per_jiffy</span><span class=p>,</span> <span class=n>this_cpu</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>ä¿å­˜åä½¿ç”¨gitæäº¤ï¼Œå¹¶å¯¹æ­¤æ¬¡ä¿®æ”¹ç”Ÿäº§ä¸€ä¸ªè¡¥ä¸ï¼Œè¡¥ä¸æ–‡ä»¶è‡ªåŠ¨å‘½åä¸º<code>0001-feat-add-boot-message.patch</code>ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ git add init/calibrate.c
</span></span><span class=line><span class=cl>$ git commit -m <span class=s2>&#34;feat:add boot message&#34;</span>
</span></span><span class=line><span class=cl>$ git format-patch -1
</span></span><span class=line><span class=cl>0001-feat-add-boot-message.patch
</span></span></code></pre></div><p>åœ¨<code>meta-mylayer/recipes-kernel</code>ä¸‹æ–°å»º<code>linux</code>æ–‡ä»¶å¤¹ï¼Œå‡†å¤‡å¦‚ä¸‹æ–‡ä»¶ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ tree linux/
</span></span><span class=line><span class=cl>linux/
</span></span><span class=line><span class=cl>â”œâ”€â”€ linux-yocto
</span></span><span class=line><span class=cl>â”‚   â””â”€â”€ 0001-feat-add-boot-message.patch
</span></span><span class=line><span class=cl>â””â”€â”€ linux-yocto_%.bbappend
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=m>1</span> directory, <span class=m>2</span> files
</span></span></code></pre></div><p>æŠŠå‰é¢ç”Ÿæˆçš„è¡¥ä¸æ–‡ä»¶æ”¾åˆ°äº†<code>linux-yocto</code>ç›®å½•ä¸‹ï¼Œ<code>linux-yocto_%.bbappend</code>æ–‡ä»¶åä¸­çš„ç™¾åˆ†å·<code>%</code>æ˜¯é€šé…ç¬¦ï¼Œè¡¨ç¤ºè¿™ä¸ª<a href=https://docs.yoctoproject.org/bitbake/2.0/bitbake-user-manual/bitbake-user-manual-intro.html#append-files title=appendæ–‡ä»¶ target=_blank rel=noreferrer>appendæ–‡ä»¶</a>å¯ä»¥åŒ¹é…ä»»ä½•å‰ç¼€<code>linux-yocto_</code>çš„recipeæ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>FILESEXTRAPATHS:prepend :<span class=o>=</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>THISDIR</span><span class=si>}</span><span class=s2>/</span><span class=si>${</span><span class=nv>PN</span><span class=si>}</span><span class=s2>:&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>SRC_URI:append <span class=o>=</span> <span class=s2>&#34; file://0001-feat-add-boot-message.patch&#34;</span>
</span></span></code></pre></div><p><a href=https://docs.yoctoproject.org/4.0.14/ref-manual/variables.html#term-FILESEXTRAPATHS title=FILESEXTRAPATHS target=_blank rel=noreferrer>FILESEXTRAPATHS</a>å˜é‡æ˜¯å‘Šè¯‰bitbakeæŸ¥æ‰¾æ–‡ä»¶å’Œè¡¥ä¸çš„æœç´¢è·¯å¾„ï¼Œè¿™é‡ŒæŠŠ<code>./linux-yocto</code>ä¹ŸåŠ è¿›å»ï¼Œå› ä¸ºè¡¥ä¸æ–‡ä»¶å­˜æ”¾åœ¨è¿™é‡Œï¼Œä¸‹é¢å‘SRC_URIæ·»åŠ è¡¥ä¸æ–‡ä»¶æ˜¯ï¼Œå°±æ˜¯ç›¸å¯¹è¿™é‡Œçš„è·¯å¾„ã€‚bitbakeåœ¨æ‰§è¡Œpatchä»»åŠ¡æ—¶ï¼Œä¼šè‡ªåŠ¨åˆ¤æ–­æ–‡ä»¶ç±»å‹ï¼Œç„¶åæŠŠè¡¥ä¸åˆå¹¶åˆ°æºç ä¸­ï¼Œå¯ä»¥å•ç‹¬æ‰§è¡Œpatchä»»åŠ¡ï¼Œç¡®è®¤è¡¥ä¸æ˜¯å¦åˆå¹¶æˆåŠŸã€‚æœ€åä¾æ¬¡æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ç”Ÿäº§æ–°çš„å†…æ ¸å’Œç³»ç»Ÿé•œåƒï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ bitbake linux-yocto -c cleansstate
</span></span><span class=line><span class=cl>$ bitbake linux-yocto 
</span></span><span class=line><span class=cl>$ bitbake core-image-minimal -c cleanall
</span></span><span class=line><span class=cl>$ bitbake core-image-minimal 
</span></span></code></pre></div><p>å¯åŠ¨è™šæ‹Ÿæœºå¯ä»¥çœ‹åˆ°æ·»åŠ çš„å¯åŠ¨ä¿¡æ¯ï¼š</p><p><figure><img src=./pics/image_EIC7tEk9Vl.png alt class="mx-auto my-0 rounded-md"></figure></p><h3 id=53-ä¿®æ”¹å†…æ ¸é…ç½® class="relative group">5.3 ä¿®æ”¹å†…æ ¸é…ç½® <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#53-%e4%bf%ae%e6%94%b9%e5%86%85%e6%a0%b8%e9%85%8d%e7%bd%ae aria-label=é”šç‚¹>#</a></span></h3><p>å•ç‹¬ç¼–è¯‘å†…æ ¸æ—¶ï¼Œæ ‡å‡†åšæ³•æ˜¯æ‰§è¡Œ<code>make menuconfig</code>å‘½ä»¤ä¿®æ”¹é…ç½®ï¼Œbitbakeä¹Ÿå¯ä»¥æ‰§è¡Œç›¸åº”çš„<code>do_menuconfig</code>ä»»åŠ¡ï¼Œæ‰“å¼€å†…æ ¸çš„é…ç½®ç•Œé¢ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ bitbake linux-yocto -c menuconfig
</span></span></code></pre></div><p>è¿™é‡Œçš„é…ç½®æ¥è‡ªäº<code>${B}/.config</code>æ–‡ä»¶ï¼Œå®ƒæ˜¯ç”±ä¸Šä¸€ä¸ªä»»åŠ¡<code>do_kernel_configme</code>é›†åˆå¤šä¸ªé…ç½®ç‰‡æ®µè€Œæˆçš„ï¼Œè¯¦ç»†æƒ…å†µç¨åå†è®²ã€‚è¿™é‡Œæˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹<code>CONFIG_DEFAULT_HOSTNAME</code>é…ç½®ï¼š</p><p><figure><img src=./pics/image_hEiUWCSk3X.png alt class="mx-auto my-0 rounded-md"></figure></p><p>ç„¶åä¿å­˜å¹¶é€€å‡ºã€‚åœ¨ç¼–è¯‘ç›®å½•<code>${B}</code>ä¸‹é¢ä¼šç”Ÿæˆæ›´æ–°åçš„ <code>.config</code> æ–‡ä»¶ï¼ŒåŸæœ‰çš„ <code>.config</code> è¢«é‡å‘½åä¸º <code>.config.old</code> ï¼Œå¯¹æ¯”ä¸€ä¸‹äºŒè€…çš„å·®å¼‚ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>$ diff -u .config.old .config
</span></span><span class=line><span class=cl><span class=gd>--- .config.old 2023-11-20 16:46:10.061458785 +0800
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+++ .config     2023-11-20 17:01:28.021316267 +0800
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gu>@@ -16,7 +16,7 @@
</span></span></span><span class=line><span class=cl><span class=gu></span> CONFIG_CC_HAS_ASM_GOTO_TIED_OUTPUT=y
</span></span><span class=line><span class=cl> CONFIG_CC_HAS_ASM_INLINE=y
</span></span><span class=line><span class=cl> CONFIG_CC_HAS_NO_PROFILE_FN_ATTR=y
</span></span><span class=line><span class=cl><span class=gd>-CONFIG_PAHOLE_VERSION=0
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+CONFIG_PAHOLE_VERSION=121
</span></span></span><span class=line><span class=cl><span class=gi></span> CONFIG_IRQ_WORK=y
</span></span><span class=line><span class=cl> CONFIG_BUILDTIME_TABLE_SORT=y
</span></span><span class=line><span class=cl> CONFIG_THREAD_INFO_IN_TASK=y
</span></span><span class=line><span class=cl><span class=gu>@@ -45,7 +45,7 @@
</span></span></span><span class=line><span class=cl><span class=gu></span> # CONFIG_KERNEL_LZ4 is not set
</span></span><span class=line><span class=cl> # CONFIG_KERNEL_ZSTD is not set
</span></span><span class=line><span class=cl> CONFIG_DEFAULT_INIT=&#34;&#34;
</span></span><span class=line><span class=cl><span class=gd>-CONFIG_DEFAULT_HOSTNAME=&#34;(none)&#34;
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+CONFIG_DEFAULT_HOSTNAME=&#34;lsc-yocto&#34;
</span></span></span><span class=line><span class=cl><span class=gi></span> CONFIG_SWAP=y
</span></span><span class=line><span class=cl> CONFIG_SYSVIPC=y
</span></span><span class=line><span class=cl> CONFIG_SYSVIPC_SYSCTL=y
</span></span></code></pre></div><p>ç„¶åè°ƒç”¨ diffconfigä»»åŠ¡ï¼Œå®ƒä¼šå¯¹æ¯” <code>.config</code> å’Œ <code>.config.old</code> ï¼Œç¡®å®šä¿®æ”¹çš„å†…å®¹ï¼Œç”Ÿæˆä¸€ä¸ªè¡¥ä¸æ–‡ä»¶ï¼Œç§°ä¹‹ä¸ºé…ç½®ç‰‡æ®µï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ bitbake linux-yocto -c diffconfig
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>Config fragment has been dumped into:
</span></span><span class=line><span class=cl> /home/lsc/yocto-kirkstone/x86_build/tmp/work/qemux86_64-poky-linux/linux-yocto/5.15.120+gitAUTOINC+820b9bdb19_74c80e559b-r0/fragment.cfg
</span></span></code></pre></div><p>ç”Ÿæˆçš„é…ç½®ç‰‡æ®µæ–‡ä»¶æ˜¯ä½äº<code>${WORKDIR}</code>ç›®å½•ä¸‹çš„ <code>fragment.cfg</code> ã€‚æŠŠè¿™ä¸ªæ–‡ä»¶å¤åˆ¶åˆ° <code>meta-mylayer/recipes-kernel/linux/linux-yocto</code> ç›®å½•ä¸‹ï¼Œç„¶ååœ¨ <code>linux-yocto_%.bbappend</code> æ–‡ä»¶ä¸­æ·»åŠ ä¸€è¡Œï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>SRC_URI:append <span class=o>=</span> <span class=s2>&#34; file://fragment.cfg&#34;</span>
</span></span></code></pre></div><p>å¯ä»¥ä¸º<code>fragment.cfg</code>æ›´æ”¹ä¸€ä¸ªæœ‰æ„ä¹‰çš„æ–‡ä»¶åï¼Œå› ä¸ºé€šå¸¸ä¼šä½¿ç”¨å¤šä¸ªé…ç½®ç‰‡æ®µæ¥æ·»åŠ ä¸åŒç±»å‹çš„ä¿®æ”¹å†…å®¹ï¼Œæ¸…é™¤åé‡æ–°ç¼–è¯‘ï¼Œå¯ä»¥è°ƒç”¨ <code>kernel_configcheck</code> ä»»åŠ¡æ£€æŸ¥å†…æ ¸é…ç½®æ˜¯å¦æ­£ç¡®ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ bitbake linux-yocto -c cleansstate
</span></span><span class=line><span class=cl>$ bitbake linux-yocto -c kernel_configcheck
</span></span><span class=line><span class=cl>$ bitbake linux-yocto
</span></span></code></pre></div><p>è¿™é‡Œè¦æ³¨æ„å‡ ä¸ªä»»åŠ¡çš„æ‰§è¡Œé¡ºåºï¼š</p><ol><li><code>do_patch</code>ä»»åŠ¡ä¼šæŠŠ<code>.patch</code>æ–‡ä»¶åº”ç”¨åˆ°æºç ä¸Šã€‚</li><li><code>do_kernel_configme</code>ä»»åŠ¡è´Ÿè´£å°†defconfigå’Œå„ç§é…ç½®ç‰‡æ®µåˆå¹¶ä¸º<code>.config</code>ã€‚</li><li><code>do_configure</code>ä»»åŠ¡æ˜¯æ‰§è¡Œå†…æ ¸é…ç½®å·¥ä½œï¼Œ<code>do_menuconfig</code>ä¹Ÿæ˜¯åœ¨è¿™ä¸ªä»»åŠ¡ä¹‹åã€‚</li></ol><p>åœ¨menuconfigä¸­ä¿®æ”¹å®Œé…ç½®ï¼Œå¦‚æœæ²¡æœ‰æ¸…é™¤ç›´æ¥ç¼–è¯‘ï¼Œåé¢çš„ä»»åŠ¡æ˜¯ç»§ç»­è¿›è¡Œï¼Œè€Œä¸æ˜¯ä»å¤´å¼€å§‹ï¼Œä¸ä¼šåº”ç”¨recipesæ–‡ä»¶ä¸­æ·»åŠ çš„é…ç½®ç‰‡æ®µï¼Œè¿™æ ·è°ƒè¯•æ²¡æœ‰é—®é¢˜ï¼Œå¦‚æœæƒ³è¦ä½¿é…ç½®ç‰‡æ®µç”Ÿæ•ˆï¼Œè¿˜æ˜¯è¦æ‰§è¡Œ<code>do_cleansstate</code>ä»»åŠ¡åé‡æ–°å¼€å§‹ã€‚</p><p><code>do_kernel_configme</code>ä»»åŠ¡å®šä¹‰åœ¨<code>poky/meta/classes/kernel-yocto.bbclass</code>æ–‡ä»¶ä¸­ï¼Œå®ƒåˆ©ç”¨äº†Linux å†…æ ¸æºç çš„<code>/scripts/kconfig/merge_config.sh</code> è„šæœ¬æ¥å®Œæˆåˆå¹¶é…ç½®ï¼Œè„šæœ¬çš„è¯­æ³•å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ ./merge_config.sh -h
</span></span><span class=line><span class=cl>Usage: ./merge_config.sh <span class=o>[</span>OPTIONS<span class=o>]</span> <span class=o>[</span>CONFIG <span class=o>[</span>...<span class=o>]]</span>
</span></span><span class=line><span class=cl>  -h    display this <span class=nb>help</span> text
</span></span><span class=line><span class=cl>  -m    only merge the fragments, <span class=k>do</span> not execute the make <span class=nb>command</span>
</span></span><span class=line><span class=cl>  -n    use allnoconfig instead of alldefconfig
</span></span><span class=line><span class=cl>  -r    list redundant entries when merging fragments
</span></span><span class=line><span class=cl>  -y    make <span class=nb>builtin</span> have precedence over modules
</span></span><span class=line><span class=cl>  -O    dir to put generated output files.  Consider setting <span class=nv>$KCONFIG_CONFIG</span> instead.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Used prefix: <span class=s1>&#39;CONFIG_&#39;</span>. You can redefine it with <span class=nv>$CONFIG_</span> environment variable.
</span></span></code></pre></div><p>å¾ˆå¤šæƒ…å†µä¸‹ï¼Œç¬¬ä¸‰æ–¹å‘å¸ƒçš„BSPä¼šé‡å†™è¿™ä¸ªä»»åŠ¡ï¼Œä½†æ˜¯åŸºæœ¬åŸç†æ˜¯ä¸€æ ·çš„ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨å†…æ ¸çš„ <code>.bbappend</code> æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ªç±»ä¼¼çš„ä»»åŠ¡ï¼Œè®©å®ƒåœ¨ç¼–è¯‘å‰åˆ©ç”¨ <code>merge_config.sh</code> è„šæœ¬åˆå¹¶é…ç½®ç‰‡æ®µï¼Œä¾‹å¦‚ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>do_merge_fragment<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=o>[</span> -f <span class=si>${</span><span class=nv>WORKDIR</span><span class=si>}</span>/fragment.cfg <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>        <span class=si>${</span><span class=nv>S</span><span class=si>}</span>/scripts/kconfig/merge_config.sh -m <span class=si>${</span><span class=nv>B</span><span class=si>}</span>/.config <span class=si>${</span><span class=nv>WORKDIR</span><span class=si>}</span>/fragment.cfg
</span></span><span class=line><span class=cl>        mv .config <span class=si>${</span><span class=nv>B</span><span class=si>}</span>/.config
</span></span><span class=line><span class=cl>    <span class=k>fi</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>addtask merge_fragment before do_compile after do_configure
</span></span></code></pre></div><h3 id=54-è®¾ç½®defconfig class="relative group">5.4 è®¾ç½®defconfig <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#54-%e8%ae%be%e7%bd%aedefconfig aria-label=é”šç‚¹>#</a></span></h3><p>æˆ‘ä»¬å•ç‹¬ç¼–è¯‘x86æ¶æ„çš„å†…æ ¸æ—¶ï¼Œé€šå¸¸æ˜¯ç›´æ¥æ‰§è¡Œ<code>make defconfig</code>ï¼Œå†…æ ¸çš„Makefileä¼šæ ¹æ®ä¸»æœºçš„<code>uname -m</code>ä¿¡æ¯ï¼Œåœ¨<code>arch/x86/configs/</code>ä¸‹æ‰¾åˆ°ç›¸åº”çš„é…ç½®æ–‡ä»¶ã€‚å¦‚æœæ˜¯armæ¶æ„ï¼Œé€šå¸¸è¦æŒ‡å®šä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼ŒMakefileä¼šåœ¨<code>arch/${ARCH}/configs/</code>è·¯å¾„ä¸‹çš„æœç´¢ï¼Œä¾‹å¦‚ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ make imx_v8_defconfig
</span></span></code></pre></div><p>åœ¨yoctoä¸­ï¼Œå¯ä»¥é€šè¿‡<a href=https://docs.yoctoproject.org/4.0.14/ref-manual/variables.html#term-KBUILD_DEFCONFIG title=KBUILD_DEFCONFIG target=_blank rel=noreferrer>KBUILD_DEFCONFIG</a>å˜é‡è®¾ç½®defconfigï¼Œbitbakeä¼šæŠŠ<code>${KBUILD_DEFCONFIG}</code>å’Œå…¶ä»–é…ç½®ç‰‡æ®µåˆå¹¶ä¸º<code>.config</code>æ–‡ä»¶ã€‚æˆ‘ä»¬åœ¨ <code>linux-yocto_%.bbappend</code> æ–‡ä»¶ä¸­æ·»åŠ ä¸€è¡Œï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>KBUILD_DEFCONFIG</span> <span class=o>=</span> <span class=s2>&#34;x86_64_defconfig&#34;</span>
</span></span></code></pre></div><p>é‡æ–°ç¼–è¯‘å†…æ ¸ï¼Œä¼šå‘ç°<code>${WORKDIR}</code>ç›®å½•ä¸‹å¤šäº†ä¸€ä¸ª<code>defconfig</code>æ–‡ä»¶ï¼Œè¿™æ˜¯</p><p><code>arch/x86/configs/x86_64_defconfig</code>æ–‡ä»¶çš„æ‹·è´ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ›å»ºè‡ªå·±çš„defconfigï¼Œåœ¨<code>linux-yocto_%.bbappend </code>æ–‡ä»¶ä¸­é€šè¿‡SRC_URIæ·»åŠ ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>SRC_URI</span> <span class=o>+=</span> <span class=s2>&#34;file://defconfig&#34;</span>
</span></span></code></pre></div><p>é€šè¿‡SRC_URIæ·»åŠ çš„defconfigæ¯”<code>${KBUILD_DEFCONFIG}</code>çš„ä¼˜å…ˆçº§é«˜ï¼Œåœ¨<code>do_kernel_configme</code>ä»»åŠ¡ä¸­å¯ä»¥çœ‹åˆ°ç›¸å…³ä»£ç ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>   <span class=c1># å¦‚æœå®šä¹‰äº†${KBUILD_DEFCONFIG}</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=o>[</span> -n <span class=s2>&#34;</span><span class=si>${</span><span class=nv>KBUILD_DEFCONFIG</span><span class=si>}</span><span class=s2>&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>[</span> -f <span class=s2>&#34;</span><span class=si>${</span><span class=nv>S</span><span class=si>}</span><span class=s2>/arch/</span><span class=si>${</span><span class=nv>ARCH</span><span class=si>}</span><span class=s2>/configs/</span><span class=si>${</span><span class=nv>KBUILD_DEFCONFIG</span><span class=si>}</span><span class=s2>&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>      <span class=c1># ä¼˜å…ˆä½¿ç”¨${WORKDIR}/defconfig</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=o>[</span> -f <span class=s2>&#34;</span><span class=si>${</span><span class=nv>WORKDIR</span><span class=si>}</span><span class=s2>/defconfig&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>        cmp <span class=s2>&#34;</span><span class=si>${</span><span class=nv>WORKDIR</span><span class=si>}</span><span class=s2>/defconfig&#34;</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>S</span><span class=si>}</span><span class=s2>/arch/</span><span class=si>${</span><span class=nv>ARCH</span><span class=si>}</span><span class=s2>/configs/</span><span class=si>${</span><span class=nv>KBUILD_DEFCONFIG</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>[</span> <span class=nv>$?</span> -ne <span class=m>0</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>          bbdebug <span class=m>1</span> <span class=s2>&#34;detected SRC_URI or unpatched defconfig in WORKDIR. </span><span class=si>${</span><span class=nv>KBUILD_DEFCONFIG</span><span class=si>}</span><span class=s2> copied over it&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>fi</span>
</span></span><span class=line><span class=cl>        cp -f <span class=si>${</span><span class=nv>S</span><span class=si>}</span>/arch/<span class=si>${</span><span class=nv>ARCH</span><span class=si>}</span>/configs/<span class=si>${</span><span class=nv>KBUILD_DEFCONFIG</span><span class=si>}</span> <span class=si>${</span><span class=nv>WORKDIR</span><span class=si>}</span>/defconfig
</span></span><span class=line><span class=cl>      <span class=c1># å¦‚æœ${WORKDIR}/defconfigä¸å­˜åœ¨ï¼Œå°±ç”¨${KBUILD_DEFCONFIG}</span>
</span></span><span class=line><span class=cl>      <span class=k>else</span>
</span></span><span class=line><span class=cl>        cp -f <span class=si>${</span><span class=nv>S</span><span class=si>}</span>/arch/<span class=si>${</span><span class=nv>ARCH</span><span class=si>}</span>/configs/<span class=si>${</span><span class=nv>KBUILD_DEFCONFIG</span><span class=si>}</span> <span class=si>${</span><span class=nv>WORKDIR</span><span class=si>}</span>/defconfig
</span></span><span class=line><span class=cl>      <span class=k>fi</span>
</span></span><span class=line><span class=cl>      <span class=nv>in_tree_defconfig</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>WORKDIR</span><span class=si>}</span><span class=s2>/defconfig&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>      bbfatal <span class=s2>&#34;A KBUILD_DEFCONFIG &#39;</span><span class=si>${</span><span class=nv>KBUILD_DEFCONFIG</span><span class=si>}</span><span class=s2>&#39; was specified, but not present in the source tree (</span><span class=si>${</span><span class=nv>S</span><span class=si>}</span><span class=s2>/arch/</span><span class=si>${</span><span class=nv>ARCH</span><span class=si>}</span><span class=s2>/configs/)&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>fi</span>
</span></span><span class=line><span class=cl>  <span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1># å¦‚æœ${KBUILD_DEFCONFIG}æ²¡æœ‰å®šä¹‰ï¼Œå°±ç”¨${WORKDIR}/defconfig</span>
</span></span><span class=line><span class=cl>  <span class=nv>sccs_from_src_uri</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=p>@</span><span class=s2>&#34; &#34;</span><span class=p>.join(find_sccs(d))</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=nv>src_uri_defconfig</span><span class=o>=</span><span class=k>$(</span><span class=nb>echo</span> <span class=nv>$sccs_from_src_uri</span> <span class=p>|</span> awk <span class=s1>&#39;(match($0, &#34;defconfig&#34;) != 0) { print $0 }&#39;</span> <span class=nv>RS</span><span class=o>=</span><span class=s1>&#39; &#39;</span><span class=k>)</span>
</span></span></code></pre></div><p>ä¸Šé¢çš„å†™æ³•<code>KBUILD_DEFCONFIG = "x86_64_defconfig"</code>è™½ç„¶æœ‰æ•ˆï¼Œä½†æ˜¯å…¼å®¹æ€§ä¸å¥½ï¼Œå¸¸è§çš„ä½œæ³•æ˜¯ç”¨æ¡ä»¶è¯­æ³•<a href=https://docs.yoctoproject.org/bitbake/2.0/bitbake-user-manual/bitbake-user-manual-metadata.html#conditional-syntax-overrides title="Conditional Syntax (Overrides)" target=_blank rel=noreferrer>Conditional Syntax (Overrides)</a>ï¼Œè®©defconfigè·Ÿç¡¬ä»¶æ¶æ„å…³è”èµ·æ¥ï¼Œä¾‹å¦‚ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>KBUILD_DEFCONFIG</span> <span class=o>=</span> <span class=s2>&#34;i386_defconfig&#34;</span>
</span></span><span class=line><span class=cl>KBUILD_DEFCONFIG:qemux86-64 <span class=o>=</span> <span class=s2>&#34;x86_64_defconfig&#34;</span>
</span></span><span class=line><span class=cl>KBUILD_DEFCONFIG:beaglebone <span class=o>=</span> <span class=s2>&#34;beaglebone_defconfig&#34;</span>
</span></span></code></pre></div><p>å®ƒçš„å«ä¹‰æ˜¯KBUILD_DEFCONFIGçš„é»˜è®¤å€¼æ˜¯i386_defconfigï¼Œå¦‚æœ<code>${OVERRIDES}</code>ä¸­åŒ…å«qemux86-64ï¼Œå°±ç”¨x86_64_defconfigè¦†ç›–ï¼Œå¦‚æœ<code>${OVERRIDES}</code>ä¸­åŒ…å«beagleboneï¼Œå°±ç”¨beaglebone_defconfigè¦†ç›–ã€‚æ‰§è¡Œ<code>bitbake -e linux-yocto > linux-yocto.bb.log</code>ï¼Œåœ¨å¯¼å‡ºçš„æ—¥å¿—æ–‡ä»¶ä¸­æœç´¢KBUILD_DEFCONFIGï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªè§£æè¿‡ç¨‹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># $KBUILD_DEFCONFIG [3 operations]</span>
</span></span><span class=line><span class=cl><span class=c1>#   set /home/lsc/yocto-kirkstone/x86_build/meta-mylayer/recipes-kernel/linux/linux-yocto_%.bbappend:3</span>
</span></span><span class=line><span class=cl><span class=c1>#     &#34;i386_defconfig&#34;</span>
</span></span><span class=line><span class=cl><span class=c1>#   override[qemux86-64]:set /home/lsc/yocto-kirkstone/x86_build/meta-mylayer/recipes-kernel/linux/linux-yocto_%.bbappend:4</span>
</span></span><span class=line><span class=cl><span class=c1>#     &#34;x86_64_defconfig&#34;</span>
</span></span><span class=line><span class=cl><span class=c1>#   override[beaglebone]:set /home/lsc/yocto-kirkstone/x86_build/meta-mylayer/recipes-kernel/linux/linux-yocto_%.bbappend:5</span>
</span></span><span class=line><span class=cl><span class=c1>#     &#34;beaglebone_defconfig&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># pre-expansion value:</span>
</span></span><span class=line><span class=cl><span class=c1>#   &#34;x86_64_defconfig&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>KBUILD_DEFCONFIG</span><span class=o>=</span><span class=s2>&#34;x86_64_defconfig&#34;</span>
</span></span></code></pre></div><p>è¿™é‡Œæ˜¾ç¤ºè§£æç»“æœæ˜¯<code>KBUILD_DEFCONFIG="x86_64_defconfig"</code>ï¼Œæ˜¯å› ä¸ºOVERRIDESå˜é‡çš„å€¼æ˜¯è¿™æ ·çš„ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>OVERRIDES</span><span class=o>=</span><span class=s2>&#34;linux:x86-64:pn-linux-yocto:qemuall:qemux86-64:poky:class-target:libc-glibc:forcevariable&#34;</span>
</span></span></code></pre></div><p>bitbakeè§£æKBUILD_DEFCONFIGå˜é‡çš„æ—¶å€™ï¼Œæ ¹æ®å†’å·åé¢çš„æ¡ä»¶ï¼Œåœ¨<code>${OVERRIDES}</code>ä¸­åŒ¹é…åˆ°äº†qemux86-64ã€‚<a href=https://docs.yoctoproject.org/bitbake/2.0/bitbake-user-manual/bitbake-user-manual-ref-variables.html#term-OVERRIDES title=OVERRIDES target=_blank rel=noreferrer>OVERRIDES</a>å«åšæ¡ä»¶æ§åˆ¶å˜é‡ï¼Œè¿™æ˜¯ä¸€ä¸ªä»¥å†’å·å­—ç¬¦åˆ†éš”çš„å­—ç¬¦ä¸²åˆ—è¡¨ï¼Œæ¯ä¸ªå­—ç¬¦ä¸²å°±æ˜¯ä¸€ä¸ªæ¡ä»¶ï¼Œå®šä¹‰åœ¨ <code>poky/meta/conf/bitbake.conf</code> æ–‡ä»¶ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>OVERRIDES</span> <span class=o>=</span> <span class=s>&#34;${TARGET_OS}:${TRANSLATED_TARGET_ARCH}:pn-${PN}:${MACHINEOVERRIDES}:${DISTROOVERRIDES}:${CLASSOVERRIDE}${LIBCOVERRIDE}:forcevariable&#34;</span>
</span></span><span class=line><span class=cl><span class=n>LIBCOVERRIDE</span> <span class=o>?=</span> <span class=s>&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>CLASSOVERRIDE</span> <span class=o>?=</span> <span class=s>&#34;class-target&#34;</span>
</span></span><span class=line><span class=cl><span class=n>DISTROOVERRIDES</span> <span class=o>?=</span> <span class=s>&#34;${@d.getVar(&#39;DISTRO&#39;) or &#39;&#39;}&#34;</span>
</span></span><span class=line><span class=cl><span class=n>MACHINEOVERRIDES</span> <span class=o>?=</span> <span class=s>&#34;${MACHINE}&#34;</span>
</span></span></code></pre></div><p>ä¸»è¦é›†åˆåˆ—ä¸¾äº†å½“å‰é¡¹ç›®çš„ä¸€äº›ç³»ç»Ÿç‰¹æ€§ï¼Œå…¶ä¸­MACHINEOVERRIDESæ˜¯æŒ‡ç¡¬ä»¶ç‰¹æ€§ï¼Œé»˜è®¤ä½¿ç”¨MACHINEçš„å€¼ï¼Œå°±æ˜¯qemux86-64ã€‚è¿™æ ·ï¼Œdefconfigå°±è·Ÿç¡¬ä»¶æ¶æ„å…³è”èµ·æ¥äº†ã€‚</p><h3 id=55-ä½¿ç”¨devtool class="relative group">5.5 ä½¿ç”¨devtool <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#55-%e4%bd%bf%e7%94%a8devtool aria-label=é”šç‚¹>#</a></span></h3><p>ä¸Šé¢æ˜¯å†…æ ¸å¼€å‘çš„åŸºæœ¬æ–¹æ³•ï¼Œä½†æ˜¯ï¼Œå®é™…æƒ…å†µä¸ä¼šè¿™ä¹ˆç®€å•ï¼Œé€šå¸¸éœ€è¦åå¤ä¿®æ”¹éªŒè¯ï¼Œå¦‚æœæ¯æ¬¡éƒ½è¦ä¿®æ”¹åéƒ½è¦ç”Ÿæˆè¡¥ä¸é‡æ–°æ„å»ºç³»ç»Ÿï¼Œæ•ˆç‡å°±å¾ˆä½ã€‚æœ€å¥½æ˜¯ä¿®æ”¹åç›´æ¥ç¼–è¯‘éªŒè¯ï¼Œå®Œæˆæ‰€æœ‰å†…æ ¸å¼€å‘åï¼Œå†æ„å»ºç³»ç»Ÿé•œåƒï¼Œè¿™ä¸ªè¿‡ç¨‹æ›´æ¨èç”¨devtoolå®Œæˆã€‚è¿™æ˜¯Yoctoæä¾›çš„è¾…åŠ©å¼€å‘å·¥å…·ï¼Œä¸æ­¢ç”¨äºå†…æ ¸å¼€å‘ï¼Œå®ƒçš„åŸºæœ¬åŸç†æ˜¯æ–°å»ºä¸€ä¸ªåä¸ºworkspaceçš„ä¸´æ—¶layerè¿›è¡Œå¼€å‘ï¼Œå¼€å‘å®Œæ¯•åå†åˆå¹¶æ¸…é™¤ã€‚è¯¦ç»†å†…å®¹å¯ä»¥å‚è€ƒï¼š</p><ul><li><a href=https://docs.yoctoproject.org/4.0.14/kernel-dev/common.html#using-devtool-to-patch-the-kernel title="Using devtool to Patch the Kernel" target=_blank rel=noreferrer>Using devtool to Patch the Kernel</a></li><li><a href=https://docs.yoctoproject.org/4.0.14/ref-manual/devtool-reference.html# title="devtool Quick Reference" target=_blank rel=noreferrer>devtool Quick Reference</a></li></ul><p>é¦–å…ˆä½¿ç”¨ <code>devtool modify</code> å‘½ä»¤å°† linux-yocto çš„æºç é‡Šæ”¾åˆ° devtool çš„ç¯å¢ƒä¸‹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ devtool modify linux-yocto
</span></span><span class=line><span class=cl>... ...
</span></span><span class=line><span class=cl>INFO: Adding <span class=nb>local</span> <span class=nb>source</span> files to srctree...
</span></span><span class=line><span class=cl>INFO: Copying kernel config to srctree
</span></span><span class=line><span class=cl>INFO: Source tree extracted to /home/lsc/yocto-kirkstone/x86_build/workspace/sources/linux-yocto
</span></span><span class=line><span class=cl>INFO: Recipe linux-yocto now <span class=nb>set</span> up to build from /home/lsc/yocto-kirkstone/x86_build/workspace/sources/linux-yocto
</span></span></code></pre></div><p>è¿™ä¸€æ­¥å®Œæˆäº†å‡ é¡¹å·¥ä½œï¼š</p><ol><li>æ–°å»ºäº†ä¸€ä¸ªåä¸ºworkspaceçš„layerã€‚</li><li>å°†workspaceçš„è·¯å¾„æ·»åŠ åˆ°<code>conf/bblayers.conf</code>æ–‡ä»¶çš„BBLAYERSå˜é‡ä¸­ã€‚</li><li>å°†linux-yoctoçš„æºç checkoutåˆ°<code>workspace/sources/linux-yocto</code>è·¯å¾„ä¸‹ã€‚</li></ol><p>æ­¤æ—¶ï¼ŒSå˜é‡ä¹ŸæŒ‡å‘äº†è¿™ä¸ªè·¯å¾„ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ bitbake -e linux-yocto <span class=p>|</span> grep ^S<span class=o>=</span>
</span></span><span class=line><span class=cl><span class=nv>S</span><span class=o>=</span><span class=s2>&#34;/home/lsc/yocto-kirkstone/x86_build/workspace/sources/linux-yocto&#34;</span>
</span></span></code></pre></div><p>è¿™é‡Œçš„å†…æ ¸æºç å·²ç»åº”ç”¨äº†recipeä¸­è®¾ç½®çš„æ‰€æœ‰è¡¥ä¸å’Œé…ç½®ç‰‡æ®µï¼Œåˆå¹¶åçš„é…ç½®æ–‡ä»¶å°±æ˜¯æºç è·¯å¾„ä¸‹çš„<code>.config</code>ï¼Œæ‰§è¡Œ<code>git log</code>å¯ä»¥çœ‹åˆ°å·²ç»æäº¤çš„è¡¥ä¸ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ <span class=nb>cd</span> workspace/sources/linux-yocto
</span></span><span class=line><span class=cl>$ ls -la
</span></span><span class=line><span class=cl>total <span class=m>1120</span>
</span></span><span class=line><span class=cl>drwxr-xr-x  <span class=m>28</span> lsc lsc   <span class=m>4096</span> Nov <span class=m>23</span> 15:51 .
</span></span><span class=line><span class=cl>drwxr-xr-x   <span class=m>3</span> lsc lsc   <span class=m>4096</span> Nov <span class=m>23</span> 15:51 ..
</span></span><span class=line><span class=cl>-rw-r--r--   <span class=m>2</span> lsc lsc  <span class=m>17019</span> Nov <span class=m>23</span> 14:14 .clang-format
</span></span><span class=line><span class=cl>-rw-r--r--   <span class=m>2</span> lsc lsc     <span class=m>59</span> Nov <span class=m>23</span> 14:14 .cocciconfig
</span></span><span class=line><span class=cl>-rw-r--r--   <span class=m>1</span> lsc lsc <span class=m>147545</span> Nov <span class=m>23</span> 14:15 .config
</span></span><span class=line><span class=cl>$ git log
</span></span><span class=line><span class=cl>commit 9f62d786ef4e9c4ad2b85aa34d3ec8036ec107f2 <span class=o>(</span>HEAD -&gt; v5.15/standard/base<span class=o>)</span>
</span></span><span class=line><span class=cl>Author: lishaocheng &lt;gexbob@gmail.com&gt;
</span></span><span class=line><span class=cl>Date:   Fri Nov <span class=m>17</span> 15:32:14 <span class=m>2023</span> +0800
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    feat:add boot message
</span></span></code></pre></div><p>ä¹‹åæˆ‘ä»¬å°±åœ¨è¿™ä¸ªå†…æ ¸æºç ä¸Šè¿›è¡Œå¼€å‘ï¼Œä¾‹å¦‚ä¿®æ”¹<code>init/calibrate.c</code>æ–‡ä»¶ï¼Œæ·»åŠ å‡ è¡Œå¯åŠ¨ä¿¡æ¯ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>void calibrate_delay<span class=o>(</span>void<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>    unsigned long lpj<span class=p>;</span>
</span></span><span class=line><span class=cl>    static bool printed<span class=p>;</span>
</span></span><span class=line><span class=cl>    int <span class=nv>this_cpu</span> <span class=o>=</span> smp_processor_id<span class=o>()</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    printk<span class=o>(</span><span class=s2>&#34;*************************************\n&#34;</span><span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    printk<span class=o>(</span><span class=s2>&#34;*                                   *\n&#34;</span><span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    printk<span class=o>(</span><span class=s2>&#34;*        HELLO YOCTO KERNEL         *\n&#34;</span><span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    printk<span class=o>(</span><span class=s2>&#34;*                                   *\n&#34;</span><span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    printk<span class=o>(</span><span class=s2>&#34;*************************************\n&#34;</span><span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(</span>per_cpu<span class=o>(</span>cpu_loops_per_jiffy, this_cpu<span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>          .
</span></span><span class=line><span class=cl>          .
</span></span></code></pre></div><p>ä½¿ç”¨devtoolè¿›è¡Œç¼–è¯‘ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ devtool build linux-yocto
</span></span><span class=line><span class=cl>$ devtool build-image core-image-minimal
</span></span></code></pre></div><p>ä¹Ÿå¯ä»¥è„±ç¦»devtoolï¼Œä½¿ç”¨å¤–éƒ¨å·¥å…·é“¾è¿›è¡Œç¼–è¯‘ï¼Œé¦–å…ˆåˆå§‹åŒ–å¼€å‘ç¯å¢ƒï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ <span class=nb>source</span> /opt/poky/4.0.12/environment-setup-core2-64-poky-linux
</span></span></code></pre></div><p>æ‰“å¼€é…ç½®ç•Œé¢ä¿®æ”¹é…ç½®ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ make menuconfig
</span></span></code></pre></div><p>æ¸…é™¤ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ make clean
</span></span></code></pre></div><ul><li><code>make clean</code>ï¼Œåˆ é™¤å¤§å¤šæ•°çš„ç¼–è¯‘ç”Ÿæˆæ–‡ä»¶ï¼Œä½†æ˜¯ä¼šä¿ç•™å†…æ ¸çš„<code>.config</code>ï¼Œ è¿˜æœ‰è¶³å¤Ÿçš„ç¼–è¯‘æ”¯æŒæ¥å»ºç«‹æ‰©å±•æ¨¡å—ï¼Œæ¯”è¾ƒå¸¸ç”¨ã€‚</li><li><code>make mrproper</code> ï¼Œåˆ é™¤æ‰€æœ‰çš„ç¼–è¯‘ç”Ÿæˆæ–‡ä»¶ï¼Œ è¿˜æœ‰å†…æ ¸é…ç½®æ–‡ä»¶ï¼Œ å†åŠ ä¸Šå„ç§å¤‡ä»½æ–‡ä»¶ï¼Œæ…ç”¨ã€‚</li><li><code>make distclean</code>ï¼Œmrproper åˆ é™¤çš„æ–‡ä»¶ï¼ŒåŠ ä¸Šç¼–è¾‘å¤‡ä»½æ–‡ä»¶å’Œä¸€äº›è¡¥ä¸æ–‡ä»¶ï¼ŒåŒ…æ‹¬ <code>.scmversion</code> ç­‰ï¼Œå‡ ä¹ä¸ç”¨ã€‚</li></ul><p>ç¼–è¯‘ ï¼Œç”Ÿæˆçš„å†…æ ¸ä½äº<code>./arch/${ARCH}/boot/</code>è·¯å¾„ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ make -j4
</span></span></code></pre></div><p>æ‰“åŒ…æ¨¡å—ï¼Œæ‰€æœ‰ç¼–è¯‘å‡ºçš„æ¨¡å—éƒ½å®‰è£…åˆ° <code>./modules/</code> è·¯å¾„ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ make modules_install <span class=nv>INSTALL_MOD_PATH</span><span class=o>=</span>./modules/
</span></span></code></pre></div><p>ç”Ÿæˆçš„å†…æ ¸å’Œæ¨¡å—éƒ½å¯ä»¥å¤åˆ¶åˆ°ç›®æ ‡ç¡¬ä»¶ä¸Šæµ‹è¯•éªŒè¯ã€‚é˜¶æ®µæ€§å¼€å‘å®Œæ¯•åï¼Œå¯ä»¥å‘ git æäº¤ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git status
</span></span><span class=line><span class=cl>git add &lt;files&gt;
</span></span><span class=line><span class=cl>git commit -m &lt;message&gt;
</span></span></code></pre></div><p>ä¸€æ¬¡æˆ–è€…å¤šæ¬¡ commit åï¼Œå¯ä»¥ä½¿ç”¨<code>devtool finish</code>å‘½ä»¤ç»“æŸå¼€å‘ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ devtool finish linux-yocto ~/yocto-kirkstone/x86_build/meta-mylayer
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>NOTE: Writing append file /home/lsc/yocto-kirkstone/x86_build/meta-mylayer/recipes-kernel/linux/linux-yocto_%.bbappend
</span></span><span class=line><span class=cl>NOTE: Copying 0001-calibrate-Add-printk-example.patch to /home/lsc/yocto-kirkstone/x86_build/meta-mylayer/recipes-kernel/linux/linux-yocto/0001-calibrate-Add-printk-example.patch
</span></span><span class=line><span class=cl>INFO: Cleaning sysroot <span class=k>for</span> recipe linux-yocto...
</span></span><span class=line><span class=cl>INFO: Leaving <span class=nb>source</span> tree /home/lsc/yocto-kirkstone/x86_build/workspace/sources/linux-yocto as-is<span class=p>;</span> <span class=k>if</span> you no longer need it <span class=k>then</span> please delete it manually
</span></span></code></pre></div><p>è¿™ä¸ªå‘½ä»¤è‡ªåŠ¨æ‰§è¡Œäº†å‡ ä¸ªæ­¥éª¤ï¼š</p><ol><li>æ£€æŸ¥gitæ—¥å¿—ï¼Œå°†æœ€è¿‘çš„å‡ æ¬¡commitç”Ÿæˆè¡¥ä¸ï¼Œå¹¶æ”¾åˆ°<code>meta-mylayer/recipes-kernel/linux/linux-yocto</code>è·¯å¾„ä¸‹ã€‚</li><li>ä¿®æ”¹<code>linux-yocto_%.bbappend</code>æ–‡ä»¶ï¼Œå°†è¡¥ä¸æ–‡ä»¶æ·»åŠ åˆ°SRC_URIã€‚</li><li>å°†<code>workspace/sources/linux-yocto</code> ä»yoctoå¼€å‘ç¯å¢ƒä¸­æ¸…é™¤ã€‚</li></ol><p>ä¹Ÿå¯ä»¥æ‰‹åŠ¨å®Œæˆè¿™äº›æ“ä½œï¼Œæ‰§è¡Œ <code>git format-patch &lt;-n></code> å°†å‰é¢å‡ æ¬¡ commit ç”Ÿæˆè¡¥ä¸ï¼Œnæ˜¯ commit çš„æ¬¡æ•°ï¼Œç„¶åå°†è¿™äº›è¡¥ä¸æ–‡ä»¶å¤åˆ¶åˆ°<code>meta-mylayer/recipes-kernel/linux/linux-yocto</code>ï¼Œä¿®æ”¹å¹¶æ·»åŠ åˆ°SRC_URIã€‚æœ€åæ‰§è¡Œ <code>devtool reset linux-yocto</code> å°† <code>workspace/sources/linux-yocto</code> ä»yoctoå¼€å‘ç¯å¢ƒä¸­æ¸…é™¤ï¼Œä¹‹åæ‰§è¡Œbitbakeæ—¶ï¼Œæ‰ä¼šä½¿ç”¨ <code>meta-mylayer</code> ä¸‹çš„é…ç½®ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>devtool reset</code>å’Œ<code>devtool finish</code>å¹¶ä¸ä¼šåˆ é™¤æºç ï¼Œæ‰€æœ‰ï¼Œ<code>workspace/source/linux-yocto</code> ä¸‹çš„æºç éœ€è¦æ‰‹åŠ¨åˆ é™¤ã€‚</p><p>ä¸Šé¢çš„æ–¹æ³•ä¸»è¦é’ˆå¯¹å†…æ ¸æºç çš„å¼€å‘ï¼Œå¯¹äºå†…æ ¸é…ç½®ï¼Œæ¨èæ‰§è¡Œ<code>make savedefconfig</code>ï¼Œä½¿ç”¨ç”Ÿæˆçš„<code>defconfig</code>æ–‡ä»¶ï¼Œè€Œä¸æ˜¯é…ç½®ç‰‡æ®µã€‚</p><h3 id=56-ä½¿ç”¨virtual-provider class="relative group">5.6 ä½¿ç”¨Virtual Provider <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#56-%e4%bd%bf%e7%94%a8virtual-provider aria-label=é”šç‚¹>#</a></span></h3><p>åœ¨æ„å»ºä¹‹å‰ï¼Œå¦‚æœçŸ¥é“æœ‰å‡ ä¸ªä¸åŒçš„recipeæä¾›ç›¸åŒçš„åŠŸèƒ½ï¼Œå¯ä»¥ä½¿ç”¨Virtual Providerï¼ˆå³ virtual/*ï¼‰ä½œä¸ºå®é™…æä¾›ç¨‹åºçš„å ä½ç¬¦ï¼Œå®é™…æä¾›ç¨‹åºå°†åœ¨æ„å»ºæ—¶ç¡®å®šã€‚å‚è€ƒï¼š<a href=https://docs.yoctoproject.org/4.0.14/dev-manual/new-recipe.html#using-virtual-providers title="Using Virtual Providers" target=_blank rel=noreferrer>Using Virtual Providers</a>ã€‚</p><p>ä¾‹å¦‚ï¼ŒpokyåŒ…å«äº†å¤šä¸ªä¸åŒçš„å†…æ ¸recipeï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; ls poky/meta/recipes-kernel/linux
</span></span><span class=line><span class=cl>cve-exclusion.inc  linux-dummy.bb          linux-yocto-rt_5.15.bb    linux-yocto.inc
</span></span><span class=line><span class=cl>kernel-devsrc.bb   linux-yocto-dev.bb      linux-yocto-tiny_5.10.bb  linux-yocto_5.10.bb
</span></span><span class=line><span class=cl>linux-dummy        linux-yocto-rt_5.10.bb  linux-yocto-tiny_5.15.bb  linux-yocto_5.15.bb
</span></span></code></pre></div><p>æ¯ä¸ªrecipeéƒ½æœ‰å­—èŠ‚çš„<a href=https://docs.yoctoproject.org/4.0.14/ref-manual/variables.html#term-PROVIDES title=PROVIDES target=_blank rel=noreferrer>PROVIDES</a>å˜é‡ï¼Œå®ƒçš„å€¼æ˜¯recpieçš„åˆ«ååˆ—è¡¨ï¼Œé»˜è®¤åªåŒ…å«äº†<code>${PN}</code>ï¼Œè€Œè¿™äº›å†…æ ¸recipeéƒ½ç»§æ‰¿äº†<code>poky/meta/classes/kernel.bbclass</code>ï¼Œè¿™é‡Œå‘PROVIDESè¿½åŠ äº†<code>virtual/kernel</code>ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>PROVIDES</span> <span class=o>+=</span> <span class=s2>&#34;virtual/kernel&#34;</span>
</span></span></code></pre></div><p>æ‰€ä»¥ï¼Œæ¯ä¸ªå†…æ ¸recipeå°±æœ‰äº†<code>${PN}</code>å’Œ<code>virtual/kernel</code>ä¸¤ä¸ªåç§°ã€‚ç„¶åé€šè¿‡<a href=https://docs.yoctoproject.org/4.0.14/ref-manual/variables.html#term-PREFERRED_PROVIDER title=PREFERRED_PROVIDER target=_blank rel=noreferrer>PREFERRED_PROVIDER</a>å’Œ<a href=https://docs.yoctoproject.org/4.0.14/ref-manual/variables.html#term-PREFERRED_VERSION title=PREFERRED_VERSION target=_blank rel=noreferrer>PREFERRED_VERSION</a>å˜é‡è®¾ç½®<code>virtual/kernel</code>è§£æä¸ºå“ªä¸ªrecipeï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># poky/meta/conf/machine/include/qemu.inc</span>
</span></span><span class=line><span class=cl>PREFERRED_PROVIDER_virtual/kernel ??<span class=o>=</span> <span class=s2>&#34;linux-yocto&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># poky/meta-poky/conf/distro/poky.conf</span>
</span></span><span class=line><span class=cl>PREFERRED_VERSION_linux-yocto ?<span class=o>=</span> <span class=s2>&#34;5.15%&#34;</span>
</span></span></code></pre></div><p>è¿™æ ·ï¼Œå¼€å‘å†…æ ¸æ—¶ï¼Œå¯ä»¥ä¸ç”¨å†…æ ¸çš„recipeåŸåï¼Œè€Œæ˜¯ä½¿ç”¨<code>virtual/kernel</code>ï¼Œä¾‹å¦‚<code>bitbake virtual/kernel</code>ï¼Œbitbakeä¼šè‡ªåŠ¨è§£æPREFERRED_PROVIDERå˜é‡ï¼Œç¡®å®šä½¿ç”¨çš„å†…æ ¸recipeã€‚</p></div></section><footer class="max-w-prose pt-8 print:hidden"><div class=flex><picture class="!mb-0 !mt-0 me-4 w-24 h-auto rounded-full"><img width=568 height=568 class="!mb-0 !mt-0 me-4 w-24 h-auto rounded-full" alt=Shaocheng.Li loading=lazy decoding=async src=/img/author.png></picture><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">ä½œè€…</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">Shaocheng.Li</div><div class="text-sm text-neutral-700 dark:text-neutral-400">A Linux software engineer.</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 transition-transform hover:scale-125 hover:text-primary-700 dark:hover:text-primary-400" style=will-change:transform href=https://github.com/exbob target=_blank aria-label=Github rel="me noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></a></div></div></div></div><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="group flex" href=/posts/2022/05/07/><span class="me-2 text-neutral-700 transition-transform group-hover:-translate-x-[2px] group-hover:text-primary-600 dark:text-neutral dark:group-hover:text-primary-400"><span class="ltr:inline rtl:hidden">&larr;</span><span class="ltr:hidden rtl:inline">&rarr;</span></span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Linux è¿›ç¨‹è°ƒåº¦çš„å­¦ä¹ ç¬”è®°</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2022-05-07 18:34:49 +0800 +0800">2022 äº”æœˆ 7</time>
</span></span></a></span><span><a class="group flex text-right" href=/posts/2025/05/04/><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">å°†è±†ç“£ç”µå½±è®°å½•æ·»åŠ åœ¨ Hugo åšå®¢</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2025-05-04 21:44:37 +0800 +0800">2025 äº”æœˆ 4</time>
</span></span><span class="ms-2 text-neutral-700 transition-transform group-hover:-translate-x-[-2px] group-hover:text-primary-600 dark:text-neutral dark:group-hover:text-primary-400"><span class="ltr:inline rtl:hidden">&rarr;</span><span class="ltr:hidden rtl:inline">&larr;</span></span></a></span></div></div></footer></article></main><div class="pointer-events-none absolute bottom-0 end-0 top-[100vh] w-12" id=to-top hidden=true><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 backdrop-blur hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label=å›åˆ°é¡¶éƒ¨ title=å›åˆ°é¡¶éƒ¨>&uarr;</a></div><footer class="py-10 print:hidden"><div class="flex items-center justify-between"><div><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2025
Shaocheng.Li</p><p class="text-xs text-neutral-500 dark:text-neutral-400">ç”± <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://github.com/jpanther/congo target=_blank rel="noopener noreferrer">Congo</a> å¼ºåŠ›é©±åŠ¨</p></div><div class="flex flex-row items-center"></div></div></footer><div id=search-wrapper class="invisible fixed inset-0 z-50 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]" data-url=https://shaocheng.li/><div id=search-modal class="top-20 mx-auto flex min-h-0 w-full max-w-3xl flex-col rounded-md border border-neutral-200 bg-neutral shadow-lg dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex flex-none items-center justify-between px-2"><form class="flex min-w-0 flex-auto items-center"><div class="flex h-8 w-8 items-center justify-center text-neutral-400"><span class="icon relative inline-block px-1 align-text-bottom"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="mx-1 flex h-12 flex-auto appearance-none bg-transparent focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=æœç´¢ tabindex=0></form><button id=close-search-button class="flex h-8 w-8 items-center justify-center text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="å…³é—­ (Esc)">
<span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto overflow-auto px-2"><ul id=search-results></ul></section></div></div></div></body></html>