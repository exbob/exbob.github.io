[{"content":"","date":null,"permalink":"/posts/","section":"Posts","summary":"","title":"Posts"},{"content":"","date":null,"permalink":"/","section":"Shaocheng.Li","summary":"","title":"Shaocheng.Li"},{"content":"","date":null,"permalink":"/tags/","section":"Tags","summary":"","title":"Tags"},{"content":"","date":null,"permalink":"/tags/untagged/","section":"Tags","summary":"","title":"untagged"},{"content":"1. å‰è¨€ #é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸€ä¸ªåµŒå…¥å¼Linuxç³»ç»Ÿç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼š\nbootloaderï¼šå¯¹äºX86æ¶æ„ï¼Œå¤§éƒ¨åˆ†ç”¨GRUBï¼Œå¯¹äºARMæ¶æ„ï¼Œä»¥å‰çš„å¤„ç†å™¨ç”¨ä¸€ä¸ªu-bootå°±å¯ä»¥ï¼Œè€ŒARMv8ä¹‹åï¼Œè¿˜è¦åœ¨u-bootå‰åŠ ä¸ŠATFç­‰å›ºä»¶ã€‚ kernelï¼šå°±æ˜¯Linuxå†…æ ¸ï¼Œæœ€å¸¸è§çš„æ˜¯ä¸€ä¸ªbzImageæ–‡ä»¶ï¼Œå¦‚æœæ˜¯ARMæ¶æ„ï¼Œè¿˜éœ€è¦è®¾å¤‡æ ‘æ–‡ä»¶ï¼Œä½†æ˜¯å†…æ ¸æ¨¡å—ä¼šåŒ…å«åœ¨rootfsä¸­ã€‚ rootfsï¼šåŒ…å«äº†å†…æ ¸æ¨¡å—å’Œç”¨æˆ·ç©ºé—´çš„æ‰€æœ‰è½¯ä»¶ï¼ˆé…ç½®æ–‡ä»¶ï¼Œå¯æ‰§è¡Œæ–‡ä»¶ï¼Œè¿è¡Œåº“ç­‰ï¼‰ï¼Œä¸€äº›æç®€çš„ç³»ç»Ÿåªç”¨busyboxå°±å¯ä»¥å®ŒæˆåŸºæœ¬çš„rootfsã€‚ é™¤äº†è¿è¡Œæ—¶çš„ç³»ç»Ÿé•œåƒï¼Œé€šå¸¸è¿˜è¦æä¾›ä¸€ä¸ªç”¨äºåº”ç”¨ç¨‹åºå¼€å‘çš„SDKï¼ŒåŒ…å«äº†ç¼–è¯‘å·¥å…·é“¾å’Œå¼€å‘é“¾æ¥åº“ã€‚\n- åµŒå…¥å¼Linuxç³»ç»Ÿé•œåƒ - bootloader - u-boot - atf-a - kernel - bzImage - devicetree - rootfs - kernel modules - busybox - glibc - Qt - etc. æœ€å¼€å§‹çš„æ—¶å€™ï¼ŒåµŒå…¥å¼Linuxç³»ç»Ÿæ¯”è¾ƒç®€å•ï¼ŒBSPå·¥ç¨‹å¸ˆåªéœ€è¦ç¼–è¯‘u-bootï¼Œlinux kernel å’Œ busybox ï¼Œå°±å¯ä»¥æ„å»ºä¸€ä¸ªç³»ç»Ÿï¼Œç„¶åå†æ ¹æ®éœ€è¦æ·»åŠ è½¯ä»¶åŒ…ï¼Œæ•´ä¸ªæ„å»ºè¿‡ç¨‹åŸºæœ¬éƒ½æ˜¯æ‰‹åŠ¨æ“ä½œï¼Œå…ˆä¸‹è½½æºç ï¼Œç„¶åé€ä¸€ç¼–è¯‘ï¼Œå†å†™å…¥ç³»ç»Ÿç›˜ä¸­æ‰§è¡Œï¼Œæˆ–è€…ç»„åˆæˆä¸€ä¸ªå¯ä»¥å†™å…¥ç³»ç»Ÿç›˜çš„ç³»ç»Ÿæ–‡ä»¶ã€‚åæ¥ï¼Œéšç€åµŒå…¥å¼Linuxç³»ç»Ÿæ—¥æ¸å¤æ‚ï¼Œå°¤å…¶æ˜¯rootfsæ‰€éœ€çš„åŒ…è¶Šæ¥è¶Šå¤šï¼Œå½¼æ­¤ç›´æ¥çš„ä¾èµ–å…³ç³»ä¹Ÿéå¸¸å¤æ‚ï¼Œä¸ºäº†ä½¿æ„å»ºè¿‡ç¨‹æ›´åŠ ç®€ä¾¿å’Œå¯é ï¼Œä¹Ÿä¸ºäº†ä¾¿äºå¼€å‘ç»´æŠ¤ï¼Œäººä»¬å¼€å§‹åˆ›é€ ä¸€äº›è‡ªåŠ¨åŒ–çš„å·¥å…·ï¼ŒYoctoå°±æ˜¯ç°åœ¨æœ€æµè¡Œçš„æ–¹æ¡ˆä¹‹ä¸€ã€‚\nåœ¨2003å¹´çš„æ—¶å€™ï¼ŒOpenEmbeddedç¤¾åŒºæˆç«‹ï¼Œå®ƒçš„ç›®çš„æ˜¯æä¾›ä¸€å¥—ç”¨äºæ„å»ºåµŒå…¥å¼Linuxç³»ç»Ÿçš„æ¡†æ¶å’Œå·¥å…·ã€‚åœ¨è¿™é‡Œï¼Œæ„å»ºLinuxç³»ç»Ÿçš„è¿‡ç¨‹å°±åƒåšä¸€æ¡Œå®´å¸­ï¼š\né¦–å…ˆï¼Œç¡®å®šå®´å¸­çš„èœå•ï¼Œç”¨ä»€ä¹ˆæ¡Œæ¤…å’Œé¤å…·ã€‚å°±æ˜¯ç¡®å®šæœ‰ä¸€äº›ç³»ç»Ÿçº§çš„ç‰¹æ€§ï¼Œä¸ºæ­¤ï¼ŒOpenEmbeddedå®šä¹‰äº†åç¼€ä¸º.conf/.cfgçš„configureï¼ˆé…ç½®ï¼‰æ–‡ä»¶ï¼Œæ¥æè¿°ç³»ç»Ÿå†…åŒ…å«å“ªäº›è½¯ä»¶åŒ…ï¼ŒåŒ…ç®¡ç†çš„ç§ç±»ï¼ˆrpmï¼Œdpkgç­‰ï¼‰ï¼Œæ–‡ä»¶ç³»ç»Ÿçš„æ ¼å¼ï¼ˆext3ï¼Œext4ç­‰ï¼‰ï¼Œç›®æ ‡ç£ç›˜çš„å¤§å°ç­‰ã€‚ ç„¶åï¼Œæ ¹æ®èœå•ï¼Œç¡®å®šæ¯ä¸€é“èœéœ€è¦ä»€ä¹ˆé£Ÿæï¼Œå¦‚ä½•é‡‡ä¹°ï¼Œæ€ä¹ˆçƒ¹é¥ªï¼Œå¦‚ä½•è£…ç›˜ä¸Šèœï¼ŒæŠŠæ¯ä¸€é“èœåšå¥½ã€‚æ¯ä¸ªè½¯ä»¶åŒ…å°±ç›¸å½“äºä¸€é“èœï¼ŒOpenEmbeddedå®šä¹‰äº†åç¼€ä¸º.bbçš„recipeï¼ˆé£Ÿè°±ï¼‰é…ç½®æ–‡ä»¶ï¼Œæ¥æè¿°æ„å»ºä¸€ä¸ªè½¯ä»¶åŒ…æ‰€éœ€çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼šæºç ä¸‹è½½åœ°å€ï¼Œä¸‹è½½åæ”¾åœ¨é‚£é‡Œï¼Œå¦‚ä½•é…ç½®ç¼–è¯‘ï¼Œç”Ÿæˆçš„æ–‡ä»¶å®‰è£…åˆ°å“ªé‡Œç­‰ã€‚ æœ€åï¼Œå°±æ˜¯çƒ¹é¥ªå’Œä¸Šèœçš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬éœ€è¦åšå¥½æ¯ä¸€é“èœï¼Œæ‘†å¥½æ¡Œæ¤…é¤å…·ï¼ŒæŠŠåšå¥½çš„èœæ‘†åˆ°æ¡Œå­ä¸Šï¼Œä¸€æ¡Œå®´å¸­å°±æˆäº†ã€‚è¿™å°±æ˜¯ç¼–è¯‘å’Œæ‰“åŒ…çš„è¿‡ç¨‹ï¼Œä¸ºæ­¤ï¼ŒOpenEmbeddedæä¾›äº†bitbakeï¼Œè¿™æ˜¯ä¸€ä¸ªpythonå†™æˆçš„å·¥å…·ï¼Œå®ƒé€šè¿‡è§£ærecipeå’Œconfigureæ–‡ä»¶ï¼Œå…ˆæŠŠæ¯ä¸ªè½¯ä»¶åŒ…ç¼–è¯‘å‡ºæ¥ï¼Œå†æŠŠå®ƒä»¬æ‰“åŒ…ç»„åˆæˆä¸€ä¸ªLinuxç³»ç»Ÿé•œåƒã€‚ åˆ°2010å¹´ï¼ŒLinuxåŸºé‡‘ä¼šå‘èµ·äº†Yoctoé¡¹ç›®ï¼Œå®ƒçš„ç›®æ ‡æ˜¯åˆ›é€ ä¸€å¥—æ„å»ºåµŒå…¥å¼Linuxç³»ç»Ÿå‘è¡Œç‰ˆçš„è½¯ä»¶å·¥å…·ï¼Œæ”¹å–„Linuxå‘è¡Œç‰ˆçš„æ„å»ºæµç¨‹ï¼Œäºæ˜¯å°±ä¸OpenEmbeddedåˆå¹¶äº†ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šå¼€å‘äº†ä¸€ä¸ªLinuxç³»ç»Ÿå‘è¡Œç‰ˆPokyã€‚æ•´ä¸ªé¡¹ç›®ä¸»è¦ç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼š\nOpenEmbedded-Coreï¼šåŒ…æ‹¬åŸºç¡€æ ¸å¿ƒçš„recipeå’Œconfigureï¼Œè¿˜é€šè¿‡classæ–‡ä»¶æä¾›äº†é€šç”¨åŠŸèƒ½çš„ç±»å’Œæ–¹æ³•ï¼Œå¯ä»¥ä¾›å¤šä¸ªrecipeå…±äº«ã€‚ BitBakeï¼šOpenEmbeddedæä¾›çš„æ„å»ºå·¥å…·å¥—ä»¶ï¼Œç”¨Python å†™æˆï¼Œæ ¸å¿ƒå°±è¡Œbitbakeå‘½ä»¤ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¤šä»»åŠ¡å¼•æ“ï¼Œå¯ä»¥å¹¶è¡Œæ‰§è¡Œ shell å’Œ Python ä»»åŠ¡ï¼Œè§£ærecipeså’Œconfç­‰é…ç½®æ–‡ä»¶ï¼Œç®¡ç†å’Œæ‰§è¡Œæºç ä¸‹è½½ã€é…ç½®ã€ç¼–è¯‘ã€æ‰“åŒ…ç­‰æ„å»ºè¿‡ç¨‹ï¼Œå¹¶æœ€ç»ˆå°†æ¯ä¸ªä»»åŠ¡ç”Ÿæˆçš„æ–‡ä»¶é›†åˆæˆä¸ºç³»ç»Ÿé•œåƒã€‚æ„å»ºLinuxç³»ç»Ÿå‘è¡Œç‰ˆæ¶‰åŠåˆ°å¾ˆå¤šæ–¹é¢çš„å·¥ä½œï¼Œå¦‚æœä½ ç©è¿‡ LFS ï¼Œå°±ä¼šäº†è§£è¿™ä¸ªè¿‡ç¨‹çš„å¤æ‚æ€§ã€‚BitBake å­˜åœ¨çš„æ„ä¹‰å°±æ˜¯æä¾›äº†ä¸€ä¸ªé«˜æ•ˆçš„å·¥å…·ï¼Œå°†è¿™ä¸ªè¿‡ç¨‹æ ‡å‡†åŒ–ã€æµç¨‹åŒ–ã€‚BitBake ä¸ GNU Make çš„å…³ç³»å°±åƒ GNU Make ä¹‹äº GCC ï¼Œè¿ä½œæ–¹å¼ä¹Ÿç±»ä¼¼ GNU Make ï¼Œåˆæœ‰å¾ˆå¤šä¸åŒã€‚ Pokyï¼šYoctoåŸºäºOpenEmbeddedå¼€å‘çš„ä¸€ä¸ªLinuxç³»ç»Ÿå‘è¡Œç‰ˆï¼ŒåŸºäºQemuè¿è¡Œï¼Œä¸å…·ä½“ç¡¬ä»¶æ— å…³ã€‚ä½œä¸ºä¸€ä¸ªå‚è€ƒï¼ŒYocto çš„å¾ˆå¤šæ–‡æ¡£ï¼Œéƒ½æ˜¯ä»¥Pokyä½œä¸ºå®ä¾‹è¿›è¡Œè®²è§£çš„ï¼Œå…¶ä»–ç¡¬ä»¶å‚å•†ä¹Ÿå¯ä»¥åŸºäºPokyå¼€å‘è‡ªå·±çš„Linuxå‘è¡Œç‰ˆã€‚ åœ¨è¿™é‡Œå¯ä»¥æŸ¥åˆ°Yocto å‘è¡Œç‰ˆçš„å†å²ï¼š\nhttps://wiki.yoctoproject.org/wiki/Releasesã€‚ å…¶ä¸­ï¼ŒYocto Kirkstone 4.0æ˜¯ä¸€ä¸ªLSTç‰ˆæœ¬ï¼Œ2022å¹´å‘å¸ƒï¼Œé¢„è®¡æ”¯æŒåˆ°2026å¹´ã€‚æˆ‘ä»¬ä»¥æ­¤ä¸ºä¾‹ï¼Œå¾ªåºæ¸è¿›çš„å­¦ä¹ Yoctoã€‚è¯¥ç‰ˆæœ¬çš„è¯¦ç»†æ–‡æ¡£ï¼Œå¯ä»¥åœ¨è¿™é‡ŒæŸ¥åˆ°ï¼š\nhttps://docs.yoctoproject.org/4.0.14/ éœ€è¦æ³¨æ„ï¼ŒYoctoçš„å­¦ä¹ æ›²çº¿æ¯”è¾ƒé™¡å³­ï¼Œå¥½åœ¨å®˜æ–¹æ–‡æ¡£éå¸¸ä¸°å¯Œï¼Œæœ€å¥½çš„æ–¹å¼å°±æ˜¯å¾ªåºæ¸è¿›çš„åšä¸€äº›ä»»åŠ¡ï¼Œç„¶åæŸ¥è¯¢æ–‡æ¡£ç†è§£å…¶åŸç†ã€‚\n2. å¿«é€Ÿå¼€å§‹ #å…ˆæ­å»º Yocto çš„å®¿ä¸»æœºç¯å¢ƒï¼Œç„¶åæ„å»ºä¸€ä¸ªæœ€ç®€å•ç³»ç»Ÿï¼Œè¿™æ ·å¯¹Yoctoæœ‰ä¸€ä¸ªç›´è§‚çš„è®¤è¯†ã€‚åé¢æ¶‰åŠçš„ Yocto æºç å·²ç»æ¨é€åˆ° github ï¼šhttps://github.com/exbob/yocto-kirkstoneã€‚\n2.1 å®¿ä¸»æœº #é€šå¸¸æƒ…å†µä¸‹ï¼Œæ„å»ºYoctoæ˜¯ä¸ªåºå¤§çš„å·¥ç¨‹ï¼Œæ ¹æ®ç›®æ ‡æ–‡ä»¶çš„ä¸åŒï¼Œå¯èƒ½éœ€è¦æ‰§è¡Œæˆåƒä¸Šä¸‡ä¸ªä»»åŠ¡ï¼Œå¯¹å®¿ä¸»æœºçš„CPUï¼Œå†…å­˜å’Œç¡¬ç›˜ç©ºé—´æœ‰è¾ƒé«˜è¦æ±‚ã€‚è¿™é‡Œåšæœ€å°çš„ç³»ç»Ÿï¼Œå¯ä»¥ç”¨è™šæ‹Ÿæœºï¼Œæˆ–è€…WSLï¼Œåˆ†é…8æ ¸ä»¥ä¸ŠCPUï¼Œ16Gä»¥ä¸Šå†…å­˜ï¼Œ100Gä»¥ä¸Šçš„ç¡¬ç›˜ç©ºé—´ï¼Œæ“ä½œç³»ç»Ÿé€‰æ‹©Ubuntu20.04 Serverï¼Œæ„å»ºè¿‡ç¨‹ä¸­ä¼šä¸‹è½½å¤§é‡æºç åŒ…ï¼Œè¦ç¡®ä¿ç½‘ç»œç•…é€šã€‚\nç„¶åå®‰è£…å¦‚ä¸‹è½¯ä»¶ï¼š\n$ sudo apt install gawk wget git diffstat unzip texinfo gcc build-essential chrpath socat cpio python3 python3-pip python3-pexpect xz-utils debianutils iputils-ping python3-git python3-jinja2 libegl1-mesa libsdl1.2-dev pylint3 xterm python3-subunit mesa-common-dev zstd liblz4-tool é…ç½®gitï¼š\n$ git config --global user.name \u0026#34;Your Name\u0026#34; $ git config --global user.email \u0026#34;Your Email\u0026#34; $ git config --list 2.2 è·å–æºç  #è¿™ä¸€æ­¥æ˜¯è·å– poky å‘è¡Œç‰ˆçš„yoctoæºç ã€‚å…ˆæ–°å»ºä¸€ä¸ªå·¥ä½œç›®å½•ï¼š\n$ mkdir yocto-kirkstone $ cd yocto-kirkstone å…‹éš† poky ï¼Œå¹¶æ£€å‡º kirkostoneåˆ†æ”¯ï¼š\n$ git clone git://git.yoctoproject.org/poky $ cd poky $ git checkout -t origin/kirkstone -b my-kirkstone åˆ†æä¸€ä¸‹pokyæºç çš„åŒ…æ‹¬ï¼š\noe-init-build-envï¼Œåˆå§‹åŒ–æ„å»ºç¯å¢ƒçš„è„šæœ¬ï¼Œä¸»è¦æ˜¯æŠŠYoctoçš„å·¥å…·è·¯å¾„æ·»åŠ åˆ°PATHä¸­ï¼Œç„¶åç”ŸæˆåŸºç¡€é…ç½®ã€‚ bitbake/ï¼Œbitbakeå·¥å…·å¥—ä»¶çš„è·¯å¾„ã€‚ scritps/ï¼ŒåŒ…å«äº†å¾ˆå¤šæ„å»ºè¿‡ç¨‹éœ€è¦çš„è„šæœ¬å·¥å…·ã€‚ meta-*/ï¼Œä»¥metaå¼€å¤´çš„æ–‡ä»¶å¤¹æ˜¯layerã€‚Layer Modelæ˜¯Yoctoçš„é‡è¦æ¦‚å¿µï¼Œå¯ä»¥ç®€å•çš„ç†è§£ä¸ºå¯¹recipeçš„åˆ†ç±»ï¼Œä¾‹å¦‚ï¼Œmeta-yocto-bspä¸‹åŒ…å«çš„æ˜¯ä¸ç¡¬ä»¶ç›¸å…³çš„recipeï¼Œä¾‹å¦‚bootloaderï¼Œkernelç­‰ï¼Œmeta-selfteståŒ…å«çš„æ˜¯å„ç§æµ‹è¯•ç¨‹åºã€‚ 2.3 å¼€å§‹æ„å»º #åˆå§‹åŒ–æ„å»ºç¯å¢ƒï¼š\n$ source poky/oe-init-build-env x86_build è¾“å‡ºå¦‚ä¸‹å†…å®¹ï¼š\nYou had no conf/local.conf file. This configuration file has therefore been created for you from /home/lsc/yocto-kirkstone/poky/meta-poky/conf/local.conf.sample You may wish to edit it to, for example, select a different MACHINE (target hardware). See conf/local.conf for more information as common configuration options are commented. You had no conf/bblayers.conf file. This configuration file has therefore been created for you from /home/lsc/yocto-kirkstone/poky/meta-poky/conf/bblayers.conf.sample To add additional metadata layers into your configuration please add entries to conf/bblayers.conf. The Yocto Project has extensive documentation about OE including a reference manual which can be found at: https://docs.yoctoproject.org For more information about OpenEmbedded see the website: https://www.openembedded.org/ ### Shell environment set up for builds. ### You can now run \u0026#39;bitbake \u0026lt;target\u0026gt;\u0026#39; Common targets are: core-image-minimal core-image-full-cmdline core-image-sato core-image-weston meta-toolchain meta-ide-support You can also run generated qemu images with a command like \u0026#39;runqemu qemux86\u0026#39; Other commonly useful commands are: - \u0026#39;devtool\u0026#39; and \u0026#39;recipetool\u0026#39; handle common recipe tasks - \u0026#39;bitbake-layers\u0026#39; handles common layer tasks - \u0026#39;oe-pkgdata-util\u0026#39; handles common target package tasks è¿™ä¸ªåˆå§‹åŒ–è¿‡ç¨‹ä¼šè®¾ç½®ä¸€äº›ç¯å¢ƒå˜é‡ï¼Œç„¶åæ–°å»ºä¸€ä¸ªåä¸ºx86_buildæ–‡ä»¶å¤¹ï¼Œä½œä¸ºè¯¥é¡¹ç›®çš„å·¥ä½œè·¯å¾„ã€‚è¿™ä¸ªè·¯å¾„ä¼šè®¾ç½®åˆ°BUILDDIRç¯å¢ƒå˜é‡ä¸­ã€‚x86_build/conf/ä¸‹æœ‰ä¸‰ä¸ªé…ç½®æ–‡ä»¶ï¼š\ntemplateconf.cfgï¼šè®¾ç½®é…ç½®æ–‡ä»¶æ¨¡æ¿çš„è·¯å¾„ã€‚æ–‡ä»¶å†…å®¹é»˜è®¤ä¸º meta-poky/confï¼Œè¿™ä¸ªè·¯å¾„ä¸‹åŒ…å«äº†å¾ˆå¤šé…ç½®æ–‡ä»¶çš„æ¨¡æ¿ã€‚ bblayers.confï¼šè¯¥æ–‡ä»¶åˆ—å‡ºäº†æœ¬é¡¹ç›®ç”¨åˆ°çš„layerï¼Œbitbakeåªä¼šåœ¨è¿™äº›layerä¸‹æœç´¢recipeã€‚ local.confï¼šæœ¬åœ°é…ç½®æ–‡ä»¶ï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶é‡Œè®¾ç½®é’ˆå¯¹æœ¬é¡¹ç›®çš„å…¨å±€å˜é‡ã€‚ åœ¨conf/local.conf æ–‡ä»¶æ·»åŠ é…ç½®ï¼š\nBB_NUMBER_THREADS = \u0026#34;4\u0026#34; PARALLEL_MAKE = \u0026#34;-j 4\u0026#34; BB_NUMBER_THREADS ï¼Œè®¾ç½®æœ€å¤§ä»»åŠ¡æ•°ã€‚bitbake ä¼šåŒæ—¶å¼€å¯å¤šä¸ªä»»åŠ¡ï¼Œå¹¶è¡Œå¤„ç†æ„å»ºè¿‡ç¨‹ï¼Œé»˜è®¤æœ€å¤§å€¼ä¸ºCPUçš„çº¿ç¨‹æ•°ï¼Œä¸ºäº†é¿å…å½±å“å…¶ä»–å·¥ä½œï¼Œå¯ä»¥è®¾ç½®è°ƒå°ä¸€ç‚¹ã€‚ PARALLEL_MAKE ï¼Œä¼ é€’ç»™makeå‘½ä»¤çš„å‚æ•°ï¼Œé€šè¿‡ bitbakeè°ƒç”¨ do_compileä»»åŠ¡æ—¶ä¼ é€’ã€‚è®¾ç½®ä¸º-j 4 è¡¨ç¤ºç¼–è¯‘æ—¶æœ€å¤§çº¿ç¨‹æ•°ã€‚ æ‰“å°ä¿¡æ¯å·²ç»å‘Šè¯‰æˆ‘ä»¬ä¸‹ä¸€æ­¥å¯ä»¥æ„å»ºå¤šç§targetï¼Œæˆ‘ä»¬é€‰æ‹©æ„å»ºä¸€ä¸ªæœ€å°çš„å‘è¡Œç‰ˆï¼š\n$ bitbake core-image-minimal è¿™ä¸ªå‘è¡Œç‰ˆåŒ…å«çš„è½¯ä»¶åŒ…è¾ƒå°‘ï¼Œæ„å»ºè¿‡ç¨‹åœ¨æ•°å°æ—¶å°±å¯ä»¥å®Œæˆï¼Œç®€å•çœ‹ä¸€ä¸‹buildç›®å½•ä¸‹çš„æ–‡ä»¶ï¼š\nconfï¼ŒåŒ…å«äº†ä¸€äº›å…¨å±€é…ç½®æ–‡ä»¶ã€‚ downloadsï¼Œæ‰€æœ‰çš„æºç åŒ…éƒ½ä¸‹è½½åˆ°äº†è¿™ä¸ªè·¯å¾„ã€‚ sstate-cacheï¼Œæ„å»ºè¿‡ç¨‹ä¸­äº§ç”Ÿçš„ç¼“å­˜æ–‡ä»¶ã€‚ tmp/deploy/rpm/qemux86_64ï¼Œå®‰è£…åˆ°æœ€ç»ˆç³»ç»Ÿé•œåƒä¸­çš„æ‰€æœ‰ rpm åŒ…éƒ½åœ¨è¿™ä¸ªè·¯å¾„ä¸‹ã€‚ tmp/deploy/images/qemux86-64ï¼Œæœ€ç»ˆç”Ÿæˆçš„bootloaderï¼Œkernelå’Œrootfsç­‰ç³»ç»Ÿé•œåƒæ–‡ä»¶éƒ½åœ¨è¿™ä¸ªè·¯å¾„ä¸‹ã€‚ ç„¶åè¿è¡Œqemuå¯åŠ¨è™šæ‹Ÿæœºï¼š\n$ runqemu qemux86-64 åœ¨æ‰“å°ä¿¡æ¯ä¸­å¯ä»¥çœ‹åˆ°å®Œæ•´çš„qemué…ç½®å‚æ•°ï¼š\nrunqemu - INFO - Setting up tap interface under sudo runqemu - INFO - Network configuration: ip=192.168.7.2::192.168.7.1:255.255.255.0::eth0:off:8.8.8.8 runqemu - INFO - Running /home/lsc/yocto-kirkstone/x86_build/tmp/work/x86_64-linux/qemu-helper-native/1.0-r1/recipe-sysroot-native/usr/bin/qemu-system-x86_64 \\ -device virtio-net-pci,netdev=net0,mac=52:54:00:12:34:02 \\ -netdev tap,id=net0,ifname=tap0,script=no,downscript=no \\ -object rng-random,filename=/dev/urandom,id=rng0 \\ -device virtio-rng-pci,rng=rng0 \\ -drive file=/home/lsc/yocto-kirkstone/x86_build/tmp/deploy/images/qemux86-64/core-image-minimal-qemux86-64-20230919015802.rootfs.ext4,if=virtio,format=raw \\ -usb -device usb-tablet -cpu IvyBridge -machine q35 -smp 4 -m 256 -serial mon:vc -serial null -device virtio-vga -display sdl,show-cursor=on \\ -kernel /home/lsc/yocto-kirkstone/x86_build/tmp/deploy/images/qemux86-64/bzImage \\ -append \u0026#39;root=/dev/vda rw ip=192.168.7.2::192.168.7.1:255.255.255.0::eth0:off:8.8.8.8 oprofile.timer=1 tsc=reliable no_timer_check rcupdate.rcu_expedited=1 \u0026#39; è™šæ‹Ÿæœºä¼šå¯åŠ¨äº†ä¸€ä¸ªæ–°çš„çª—å£ï¼Œç”¨æˆ·åæ˜¯ rootï¼Œæ²¡æœ‰å¯†ç ï¼š\nå…³äºqemuçš„æ›´å¤šå†…å®¹å¯ä»¥å‚è€ƒUsing the Quick EMUlator ã€‚\nğŸ“Œä¹Ÿå¯ä»¥å…ˆä¸‹è½½æ‰€æœ‰è½¯ä»¶åŒ…çš„æºç ï¼Œä¸‹è½½å®Œæ¯•åå†ç¼–è¯‘ï¼šbitbake core-image-minimal \u0026ndash;runall=fetch\n3. è§£æå·¥ä½œæµ #ä¸‹å›¾å±•ç¤ºäº†ä½¿ç”¨Yoctoç”Ÿæˆç³»ç»Ÿé•œåƒimageå’Œåº”ç”¨å¼€å‘å·¥å…·SDKçš„å·¥ä½œæµç¨‹ï¼š\nå¼€å‘äººå‘˜ä»ä¸Šæ¸¸å‚å®¶è·å–Upstream Sourceï¼Œä¾‹å¦‚pokyã€‚ å¼€å‘äººå‘˜å¯¹Upstream Sourceè¿›è¡Œå¿…è¦çš„é…ç½®ï¼ŒåŒ…æ‹¬å¢åˆ è½¯ä»¶åŒ…ï¼Œä¿®æ”¹è½¯ä»¶é…ç½®ï¼Œä¿®æ”¹ç³»ç»Ÿç‰¹æ€§ç­‰ã€‚ å¼€å§‹æ„å»ºï¼ŒBuild SysteamæŒ‰å¦‚ä¸‹æµç¨‹å·¥ä½œï¼š ä»æŒ‡å®šä½ç½®è·å–å¹¶ä¸‹è½½æºä»£ç ï¼Œè¿™ä¸ªè¿‡ç¨‹æ”¯æŒæ ‡å‡†æ–¹æ³•ï¼Œä¾‹å¦‚ftpï¼Œgitç­‰ã€‚ ä¸‹è½½æˆåŠŸåï¼Œå†å°†æºä»£ç æå–åˆ°æœ¬åœ°å·¥ä½œåŒºï¼Œåœ¨è¯¥å·¥ä½œåŒºä¸­åº”ç”¨è¡¥ä¸å¹¶è¿è¡Œé…ç½®å’Œç¼–è¯‘ç­‰è½¯ä»¶çš„å¸¸è§æ­¥éª¤ã€‚ å°†è½¯ä»¶å®‰è£…åˆ°æš‚å­˜åŒºï¼Œç„¶åä½¿ç”¨æ‚¨é€‰æ‹©çš„äºŒè¿›åˆ¶åŒ…æ ¼å¼ï¼ˆdebã€rpmæˆ– ipkï¼‰æ¥æ‰“åŒ…è½¯ä»¶ã€‚ ä¸åŒçš„ QA å’Œå¥å…¨æ€§æ£€æŸ¥è´¯ç©¿æ•´ä¸ªæ„å»ºè¿‡ç¨‹ã€‚ è½¯ä»¶åŒ…æ„å»ºå®Œæ¯•åï¼Œæ”¾åˆ°ä¸€ä¸ªPackage Feedsä¸­ï¼Œç”¨äºç”Ÿæˆimageå’ŒSDKã€‚ ç”Ÿæˆimageï¼ˆç”¨äºå†™å…¥ç£ç›˜çš„ç³»ç»Ÿé•œåƒï¼‰å’ŒSDK (åŒ…å«å·¥å…·é“¾å’Œé“¾æ¥åº“ï¼Œç”¨äºåº”ç”¨ç¨‹åºå¼€å‘ï¼‰ã€‚ æ›´å¤šè¯¦ç»†ä¿¡æ¯å¯ä»¥å‚è€ƒï¼šhttps://docs.yoctoproject.org/4.0.13/overview-manual/concepts.htmlï¼Œå¯ä»¥å…ˆé€šç¯‡æµè§ˆï¼Œç„¶ååœ¨é‡åˆ°é—®é¢˜æ—¶å›æº¯ï¼ŒåŠ æ·±ç†è§£ã€‚ä¸‹é¢ä»¥æ„å»ºcore-image-minimalä¸ºä¾‹ç®€å•åˆ†æä¸€ä¸‹ã€‚\nbitbakeçš„åŸºæœ¬è¯­æ³•æ˜¯bitbake [options] [recipe_name/target] ï¼Œå½“æˆ‘ä»¬æ‰§è¡Œbitbakeæ—¶ï¼Œå®ƒè§£æ${BUILDDIR}/conf/bblayers.confæ–‡ä»¶ï¼Œç¡®å®šæœç´¢recipeçš„è·¯å¾„ï¼Œç„¶ååœ¨è¿™äº›è·¯å¾„ä¸‹æœç´¢recipceæˆ–è€…targetï¼Œcore-image-minimalä½œä¸ºä¸€ä¸ªtargetï¼Œä¹Ÿæ˜¯ç”±recipeæ–‡ä»¶æè¿°çš„ï¼Œå¯ä»¥ç”¨å¦‚ä¸‹å‘½ä»¤ç¡®å®šè¯¥æ–‡ä»¶çš„è·¯å¾„ï¼š\n$ bitbake -e core-image-minimal | grep ^FILE= FILE=\u0026#34;/home/lsc/yocto-kirkstone/poky/meta/recipes-core/images/core-image-minimal.bb\u0026#34; çœ‹ä¸€ä¸‹è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼š\n1 SUMMARY = \u0026#34;A small image just capable of allowing a device to boot.\u0026#34; 2 3 IMAGE_INSTALL = \u0026#34;packagegroup-core-boot ${CORE_IMAGE_EXTRA_INSTALL}\u0026#34; 4 5 IMAGE_LINGUAS = \u0026#34; \u0026#34; 6 7 LICENSE = \u0026#34;MIT\u0026#34; 8 9 inherit core-image 10 11 IMAGE_ROOTFS_SIZE ?= \u0026#34;8192\u0026#34; 12 IMAGE_ROOTFS_EXTRA_SPACE:append = \u0026#34;${@bb.utils.contains(\u0026#34;DISTRO_FEATURES\u0026#34;, \u0026#34;systemd\u0026#34;, \u0026#34; + 4096\u0026#34;, \u0026#34;\u0026#34;, d)}\u0026#34; SUMMARYç®€è¦çš„è¯´æ˜äº†è¿™ä¸ªtargetæ˜¯ä»€ä¹ˆã€‚ IMAGE_INSTALLåˆ—å‡ºäº†è¯¥ç³»ç»Ÿè¦å®‰è£…çš„recipesã€‚ inherit core-imageè¡¨ç¤ºå®ƒç»§æ‰¿äº†core-imageã€‚ ä»è¿™ä¸ªæ–‡ä»¶å¼€å§‹ï¼Œç»§ç»­æ·±å…¥è§£æï¼Œbitbakeå°±ä¼šå¾—åˆ°è¯¥ç³»ç»Ÿä¾èµ–çš„æ‰€æœ‰recipesï¼Œç„¶åä¾æ¬¡æ‰§è¡Œæ¯ä¸ªrecipeçš„æ„å»ºè¿‡ç¨‹ã€‚å¯ä»¥ä½¿ç”¨-gé€‰é¡¹è§£ætargetä¸recipeä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼š\n$ bitbake -g core-image-minimal Loading cache: 100% |################################################################| Time: 0:00:00 Loaded 1644 entries from dependency cache. NOTE: Resolving any missing task queue dependencies NOTE: PN build list saved to \u0026#39;pn-buildlist\u0026#39; NOTE: Task dependencies saved to \u0026#39;task-depends.dot\u0026#39; ç”Ÿæˆäº†ä¸¤ä¸ªæ–‡ä»¶ï¼š\ntask-depends.dot: è¿™æ˜¯ä¸€ä¸ªGraphvizæ ¼å¼çš„æ–‡ä»¶ï¼Œæ˜¾ç¤ºæ˜¯æ‰€æœ‰ä»»åŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚ pn-buildlist: æ–‡æœ¬æ–‡ä»¶ï¼Œåˆ—å‡ºäº†æ„å»ºtargetè¿‡ç¨‹ä¸­ä¾èµ–çš„æ‰€æœ‰recipeã€‚ Yoctoæä¾›äº†oe-depends-dotå·¥å…·ï¼Œå¯ä»¥å¯¹task-depends.dotè¿›è¡Œç®€å•åˆ†æï¼š\n# æŸ¥è¯¢busyboxçš„ç”Ÿæˆå…³ç³» $ oe-depends-dot -k busybox -w task-depends.dot Because: core-image-minimal packagegroup-core-boot core-image-minimal -\u0026gt; packagegroup-core-boot -\u0026gt; busybox # æŸ¥è¯¢busyboxä¾èµ–çš„åŒ… $ oe-depends-dot -k busybox -d task-depends.dot Depends: gcc-cross-x86_64 gcc-runtime zip rpm-native opkg-utils-native pseudo-native opkg-utils libxcrypt kern-tools-native quilt-native ptest-runner update-rc initscripts patch-native glibc binutils-cross-x86_64 dwarfsrcfiles-native è¿™ä¸ªæ–‡ä»¶å¾ˆå¤§ï¼Œå¯ä»¥åˆ é™¤ä¸€ä¸‹å†—ä½™ä¿¡æ¯ç¼©å°æ–‡ä»¶ä½“ç§¯ï¼Œç„¶åç”¨dotå‘½ä»¤æŠŠå®ƒè½¬æ¢ä¸ºpdfæ–‡ä»¶ï¼Œæ–¹ä¾¿æŸ¥çœ‹ï¼š\n$ oe-depends-dot -r ./task-depends.dot Saving reduced dot file to ./task-depends-reduced.dot $ ls -l task-depends* -rw-r--r-- 1 lsc lsc 23056 Sep 28 15:55 task-depends-reduced.dot -rw-r--r-- 1 lsc lsc 1297931 Sep 12 22:16 task-depends.dot $ sudo apt install graphviz $ dot -Tpdf task-depends-reduced.dot -o task-depends-reduced.pdf ä¹Ÿå¯ä»¥æŠŠæ–‡ä»¶å†…å®¹è´Ÿè´£åˆ°åœ¨çº¿å¹³å°æŸ¥çœ‹ï¼Œä¾‹å¦‚ï¼šhttps://edotor.net/ ã€‚\næŸ¥çœ‹pn-buildlistæ–‡ä»¶ï¼Œä¼šå‘ç°æœ‰äº›recipeå¸¦æœ‰nativeåç¼€ï¼Œæœ‰äº›åˆ™æ²¡æœ‰ï¼Œä¾‹å¦‚ï¼š\n\u0026gt; cat pn-buildlist | grep unzip unzip-native unzip å¸¦æœ‰nativeåç¼€çš„recipeæ˜¯è¿è¡Œå®¿ä¸»æœºä¸Šçš„è½¯ä»¶ï¼Œé€šå¸¸æ˜¯è¾…åŠ©æ„å»ºæ‰€éœ€çš„å·¥å…·ï¼Œæˆ–è€…äº¤å‰ç¼–è¯‘å·¥å…·é“¾ç­‰ï¼Œè€Œæ²¡æœ‰åç¼€çš„recipeæ˜¯è¿è¡Œåœ¨ç›®æ ‡æœºä¸Šçš„è½¯ä»¶ã€‚æœ€ç»ˆä¼šå‘ç°ï¼Œå®‰è£…åˆ°ç›®æ ‡æœºä¸Šçš„è½¯ä»¶åªæœ‰ä¸€ç™¾å¤šä¸ªï¼š\n$ cat pn-buildlist | wc -l 295 $ cat pn-buildlist | grep native | wc -l 149 æ‰§è¡Œbitbake -e \u0026lt;recipe_name\u0026gt; å¯ä»¥å°†ä¸€ä¸ªrecipeçš„æ‰€æœ‰å†…å®¹å…¨éƒ¨è§£æå‡ºæ¥ï¼Œè¿˜åŒ…å«å¤§é‡çš„æ³¨é‡Šï¼Œè¿™ä¸ªéå¸¸é‡è¦ï¼Œåé¢çš„å„ç§å·¥ä½œéƒ½å¯ä»¥ä»ä¸­è·å¾—çº¿ç´¢ã€‚ä»¥busyboxä¸ºä¾‹ï¼Œæˆ‘ä»¬æŠŠå®ƒè§£æåçš„å†…å®¹ä¿å­˜åˆ°ä¸€ä¸ªæ–‡ä»¶ï¼Œç®€å•åˆ†æä¸€ä¸‹ï¼š\n$ bitbake -e busybox \u0026gt; busybox-bb.log é¦–å…ˆï¼ŒFILEå˜é‡è®°å½•äº†recipeæ–‡ä»¶çš„ä½ç½®ï¼š\n$ cat busybox-bb.log | grep ^FILE= FILE=\u0026#34;/home/lsc/yocto-kirkstone/poky/meta/recipes-core/busybox/busybox_1.35.0.bb\u0026#34; é€šè¿‡WORKDIRå¯ä»¥å®šä½bitbakeæ„å»ºè¿™ä¸ªåŒ…æ—¶çš„å·¥ä½œç›®å½•ï¼š\n$ cat busybox-bb.log | grep ^WORKDIR= WORKDIR=\u0026#34;/home/lsc/yocto-kirkstone/x86_build/tmp/work/core2-64-poky-linux/busybox/1.35.0-r0\u0026#34; æ„å»ºè¿‡ç¨‹ä¼šæ‰§è¡Œå¾ˆå¤šä»»åŠ¡ï¼Œæ¯ä¸ªåŒ…ä¼šç•¥æœ‰ä¸åŒï¼Œæ‰§è¡Œä»»åŠ¡çš„é¡ºåºç”±å…¶ä»»åŠ¡è°ƒåº¦å™¨æ§åˆ¶ã€‚åœ¨${WORKDIR}/temp/ ç›®å½•ä¸‹ï¼Œä»¥ run.do_ å¼€å¤´çš„æ–‡ä»¶è®°å½•äº†æ¯ä¸ªä»»åŠ¡æ‰§è¡Œçš„python/shellç¨‹åºæºç ï¼Œä»¥ log.do_ å¼€å¤´çš„æ–‡ä»¶è®°å½•ä»»åŠ¡æ‰§è¡Œæ—¶çš„æ—¥å¿—ï¼Œlog.task_order æ–‡ä»¶æŒ‰é¡ºåºè®°å½•äº†å½“å‰ç›®æ ‡æ‰§è¡Œäº†å“ªäº›ä»»åŠ¡ã€‚çœ‹ä¸€ä¸‹busybox_1.35.0.bbæ‰§è¡Œäº†å“ªäº›ä»»åŠ¡ï¼š\n$ cat log.task_order do_fetch (1564520): log.do_fetch.1564520 do_unpack (1605094): log.do_unpack.1605094 do_patch (1653034): log.do_patch.1653034 do_deploy_source_date_epoch (1707365): log.do_deploy_source_date_epoch.1707365 do_prepare_recipe_sysroot (1707727): log.do_prepare_recipe_sysroot.1707727 do_configure (1707736): log.do_configure.1707736 do_configure_ptest_base (1781759): log.do_configure_ptest_base.1781759 do_compile (1781797): log.do_compile.1781797 do_compile_ptest_base (1949513): log.do_compile_ptest_base.1949513 do_install (1949868): log.do_install.1949868 do_install_ptest_base (2060604): log.do_install_ptest_base.2060604 do_package (2064697): log.do_package.2064697 do_packagedata (2173119): log.do_packagedata.2173119 do_populate_lic (2262819): log.do_populate_lic.2262819 do_package_write_rpm (2374209): log.do_package_write_rpm.2374209 do_package_qa (2374261): log.do_package_qa.2374261 ä¸»è¦çš„ä»»åŠ¡æœ‰ï¼š\nfetch ï¼šä»è¿œç¨‹æˆ–è€…æœ¬åœ°è·å–æºç ï¼Œå¹¶æ”¾åˆ°${DL_DIR}è·¯å¾„ä¸‹ unpack ï¼šå°†æºç ä»${DL_DIR}é‡Šæ”¾åˆ°${WORKDIR}ä¸‹çš„ç›¸åº”è·¯å¾„ä¸‹ï¼Œå¹¶ç”¨${S}æŒ‡å‘è¿™ä¸ªè·¯å¾„ã€‚ patch ï¼š å°†è¡¥ä¸æ–‡ä»¶åº”ç”¨åˆ°${S}è·¯å¾„ä¸‹çš„æºç ä¸­ configure ï¼šåœ¨${S}è·¯å¾„ä¸‹æ‰§è¡Œé…ç½® compile ï¼šåœ¨${S}è·¯å¾„ä¸‹æ‰§è¡Œç¼–è¯‘ï¼Œç¼–è¯‘ç”Ÿæˆçš„æ–‡ä»¶ä¼šæ”¾åœ¨${B}ä¸‹ï¼Œé»˜è®¤ä¸${S}ç›¸åŒã€‚ install ï¼šä»${B}æŠŠæ–‡ä»¶å¤åˆ¶åˆ°${D}è·¯å¾„ä¸‹ã€‚ package ï¼šåˆ†æ${D}è·¯å¾„ä¸‹çš„æ–‡ä»¶ï¼ŒæŒ‰ç…§${PACKAGES}å’Œ${FILES}çš„è®¾ç½®ï¼ŒæŠŠä»–ä»¬åˆ†ç±»æ”¾å…¥${PKGDEST}ä¸‹çš„æ–‡ä»¶å¤¹ï¼Œæœ€åæ‰“åŒ…ç”Ÿæˆ${WORKDIR}/deploy/å’Œ${TMPDIR}/deployè·¯å¾„ä¸‹è½¯ä»¶å®‰è£…åŒ…ï¼Œè½¯ä»¶å®‰è£…åŒ…çš„æ•°æ®ä¼šè®°å½•åˆ°${PKGDATA_DIR}ä¸‹çš„ç›¸åº”æ–‡ä»¶ã€‚ clean ï¼šåˆ é™¤${B}è·¯å¾„ä¸‹ç¼–è¯‘ç”Ÿæˆçš„æ–‡ä»¶ clearsstate ï¼šåˆ é™¤ç¼–è¯‘è¿‡ç¨‹äº§ç”Ÿçš„æ‰€æœ‰æ–‡ä»¶å’Œç¼“å­˜æ–‡ä»¶ cleanall ï¼šåˆ é™¤æ‰€æœ‰æ–‡ä»¶ï¼ŒåŒ…æ‹¬${DL_DIR}è·¯å¾„ä¸‹çš„æºç å’Œ${WORKDIR}ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ã€‚ å¯ä»¥çœ‹åˆ°busyboxçš„æºç è·¯å¾„å’Œç¼–è¯‘è·¯å¾„æ˜¯ä¸€æ ·çš„ï¼š\n$ cat busybox-bb.log | grep ^S= S=\u0026#34;/home/lsc/yocto-kirkstone/x86_build/tmp/work/core2-64-poky-linux/busybox/1.35.0-r0/busybox-1.35.0\u0026#34; $ cat busybox-bb.log | grep ^B= B=\u0026#34;/home/lsc/yocto-kirkstone/x86_build/tmp/work/core2-64-poky-linux/busybox/1.35.0-r0/busybox-1.35.0\u0026#34; å„ç§ä»»åŠ¡çš„å…·ä½“å†…å®¹ä¹Ÿå¯ä»¥æŸ¥åˆ°ï¼Œä¾‹å¦‚do_compileä»»åŠ¡ï¼š\n$ cat busybox-bb.log | grep -C 2 \u0026#34;^do_compile\u0026#34; # line: 147, file: /home/lsc/yocto-kirkstone/poky/meta/recipes-core/busybox/busybox.inc do_compile() { unset CFLAGS CPPFLAGS CXXFLAGS LDFLAGS export KCONFIG_NOTIMESTAMP=1 -- # line: 33, file: /home/lsc/yocto-kirkstone/poky/meta/classes/ptest.bbclass do_compile_ptest() { : } # line: 37, file: /home/lsc/yocto-kirkstone/poky/meta/classes/ptest.bbclass do_compile_ptest_base() { do_compile_ptest } è¿™äº›ä»»åŠ¡å¯ä»¥é€šè¿‡ -c å‚æ•°å•ç‹¬æ‰§è¡Œï¼Œä¾‹å¦‚åªä¸‹è½½æºç å¯ä»¥æ‰§è¡Œ bitbake \u0026lt;recipe_name\u0026gt; -c fetch ã€‚æ‰§è¡Œ listtasks ä»»åŠ¡å¯ä»¥æŸ¥çœ‹æ‰€æœ‰å¯ç”¨ä»»åŠ¡çš„è§£é‡Šï¼š\nbitbake linux-imx -c listtasks æ›´è¯¦ç»†çš„ä»»åŠ¡è§£é‡Šå¯ä»¥åœ¨å®˜æ–¹æ–‡æ¡£æŸ¥çœ‹ï¼šhttps://docs.yoctoproject.org/4.0.14/ref-manual/tasks.htmã€‚\nä¾èµ–çš„recipeéƒ½æ„å»ºå®Œæ¯•åï¼Œcore-image-minimalä¼šæ‰§è¡Œdo_rootfsä»»åŠ¡ï¼Œå®ƒæ ¹æ®${IMAGE_ROOTFS}çš„å€¼æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼ŒæŠŠimageéœ€è¦å®‰è£…çš„rpmå®‰è£…åŒ…éƒ½å®‰è£…åˆ°è¿™é‡Œï¼š\n$ bitbake -e core-image-minimal | grep IMAGE_ROOTFS= IMAGE_ROOTFS=\u0026#34;/home/lsc/yocto-kirkstone/x86_build/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/rootfs\u0026#34; $ ls tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/rootfs bin boot dev etc home lib media mnt proc run sbin sys tmp usr var è¿˜ä¼šæ ¹æ®${IMAGE_MANIFEST}çš„å€¼ç”Ÿæˆä¸€ä¸ªæ–‡ä»¶ï¼Œåœ¨é‡Œé¢é€è¡Œåˆ—å‡ºäº†æ‰€æœ‰å®‰è£…åˆ°imageçš„rpmå®‰è£…åŒ…ï¼Œæ¯è¡Œåˆ†ä¸‰åˆ—ï¼Œåˆ†åˆ«æ˜¯åç§°ï¼Œæ¶æ„å’Œç‰ˆæœ¬ï¼š\n$ bitbake -e core-image-minimal | grep IMAGE_MANIFEST= IMAGE_MANIFEST=\u0026#34;/home/lsc/yocto-kirkstone/x86_build/tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/deploy-core-image-minimal-image-complete/core-image-minimal-qemux86-64-20230914042751.rootfs.manifest\u0026#34; $ cat tmp/work/qemux86_64-poky-linux/core-image-minimal/1.0-r0/deploy-core-image-minimal-image-complete/core-image-minimal-qemux86-64-20230914042751.rootfs.manifest base-files qemux86_64 3.0.14 base-passwd core2_64 3.5.29 busybox core2_64 1.35.0 busybox-hwclock core2_64 1.35.0 busybox-syslog core2_64 1.35.0 busybox-udhcpc core2_64 1.35.0 eudev core2_64 3.2.10 init-ifupdown qemux86_64 1.0 init-system-helpers-service core2_64 1.62 initscripts core2_64 1.0 initscripts-functions core2_64 1.0 kernel-5.15.120-yocto-standard qemux86_64 5.15.120+git0+820b9bdb19_74c80e559b kernel-image-5.15.120-yocto-standard qemux86_64 5.15.120+git0+820b9bdb19_74c80e559b kernel-image-bzimage-5.15.120-yocto-standard qemux86_64 5.15.120+git0+820b9bdb19_74c80e559b kernel-module-uvesafb-5.15.120-yocto-standard qemux86_64 5.15.120+git0+820b9bdb19_74c80e559b ldconfig core2_64 2.35 libblkid1 core2_64 2.37.4 libc6 core2_64 2.35 libkmod2 core2_64 29 liblzma5 core2_64 5.2.6 libz1 core2_64 1.2.11 modutils-initscripts core2_64 1.0 netbase noarch 6.3 packagegroup-core-boot qemux86_64 1.0 sysvinit core2_64 3.01 sysvinit-inittab qemux86_64 2.88dsf sysvinit-pidof core2_64 3.01 update-alternatives-opkg core2_64 0.5.0 update-rc.d noarch 0.8 v86d qemux86_64 0.1.10 æœ€åæ‰§è¡Œdo_imageä»»åŠ¡ï¼Œå°†kernelï¼Œrootfsç­‰imageç»„ä»¶æ”¾åˆ°${DEPLOY_DIR_IMAGE}è·¯å¾„ä¸‹ï¼š\n$ cat core-image-minimal-bb.log | grep ^DEPLOY_DIR DEPLOY_DIR=\u0026#34;/home/lsc/yocto-kirkstone/x86_build/tmp/deploy\u0026#34; DEPLOY_DIR_DEB=\u0026#34;/home/lsc/yocto-kirkstone/x86_build/tmp/deploy/deb\u0026#34; DEPLOY_DIR_IMAGE=\u0026#34;/home/lsc/yocto-kirkstone/x86_build/tmp/deploy/images/qemux86-64\u0026#34; DEPLOY_DIR_IPK=\u0026#34;/home/lsc/yocto-kirkstone/x86_build/tmp/deploy/ipk\u0026#34; DEPLOY_DIR_RPM=\u0026#34;/home/lsc/yocto-kirkstone/x86_build/tmp/deploy/rpm\u0026#34; DEPLOY_DIR_TAR=\u0026#34;/home/lsc/yocto-kirkstone/x86_build/tmp/deploy/tar\u0026#34; DEPLOY_DIR_TOOLS=\u0026#34;/home/lsc/yocto-kirkstone/x86_build/tmp/deploy/tools\u0026#34; $ ls tmp/deploy/images/qemux86-64/ bzImage bzImage--5.15.120+git0+820b9bdb19_74c80e559b-r0-qemux86-64-20230912081542.bin bzImage-qemux86-64.bin core-image-minimal-qemux86-64-20230914081917.rootfs.manifest core-image-minimal-qemux86-64-20230914081917.testdata.json core-image-minimal-qemux86-64-20230914083045.qemuboot.conf core-image-minimal-qemux86-64-20230914083045.rootfs.ext4 core-image-minimal-qemux86-64-20230914083045.rootfs.tar.bz2 core-image-minimal-qemux86-64.ext4 core-image-minimal-qemux86-64.manifest core-image-minimal-qemux86-64.qemuboot.conf core-image-minimal-qemux86-64.tar.bz2 core-image-minimal-qemux86-64.testdata.json modules--5.15.120+git0+820b9bdb19_74c80e559b-r0-qemux86-64-20230912081542.tgz modules-qemux86-64.tgz å…³äºBitBakeçš„è¯¦ç»†å†…å®¹å¯ä»¥å‚è€ƒæ‰‹å†Œï¼šhttps://docs.yoctoproject.org/bitbake/2.0/index.htmlã€‚\n4. åŸºç¡€å®šåˆ¶ #æœ¬ç« å¯¹core-image-minimalåšä¸€äº›åŸºæœ¬çš„å®šåˆ¶å·¥ä½œï¼Œå¾ªåºæ¸è¿›çš„ç†è§£Yoctoã€‚éœ€è¦æ³¨æ„ï¼Œé‡å¯Linuxä¼šè¯åï¼Œéƒ½è¦æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤åˆå§‹åŒ–Yoctoç¯å¢ƒï¼š\n$ source poky/oe-init-build-env x86_build 4.1 æ–°å»ºlayer #åœ¨Yoctoä¸­ï¼Œrecipeä¸æ˜¯ç‹¬ç«‹å­˜åœ¨çš„ï¼Œå¿…é¡»é€šè¿‡ä¸åŒlayeråˆ†ç±»å­˜æ”¾ï¼Œå®˜æ–¹å’Œç¤¾åŒºéƒ½å‘å¸ƒäº†å¾ˆå¤šlayerï¼Œä¾‹å¦‚ï¼š\nOpenEmedded Layer ï¼šhttps://layers.openembedded.org/layerindex/branch/master/layers/ Yocto Layer ï¼šhttps://www.yoctoproject.org/software-overview/layers/ å½“æˆ‘ä»¬è¦å¯¹pokyè¿›ä¸€æ­¥å®šåˆ¶çš„æ—¶å€™ï¼Œå¯ä»¥å…ˆç°åœ¨ç¤¾åŒºæ‰¾ä¸€æ‰¾ï¼Œæœ‰æ²¡æœ‰åˆ«äººå·²ç»å†™å¥½layeræˆ–è€…recipeï¼Œå¦‚æœæ²¡æ‰¾åˆ°ï¼Œå°±åº”è¯¥æ–°å»ºè‡ªå·±çš„layer ï¼Œå­˜æ”¾è‡ªå®šä¹‰çš„recipeã€‚layeræœ¬è´¨æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹å’Œä¸€äº›ç‰¹å®šé…ç½®æ–‡ä»¶ï¼Œè¿™äº›å¯ä»¥æ‰‹åŠ¨é€ä¸ªæ–°å»ºï¼Œè¯¦ç»†æƒ…å†µå¯ä»¥å‚è€ƒUnderstand and Creating Layersã€‚\nåŒæ—¶ï¼Œbitbakeå¥—ä»¶æä¾›bitbake-layerså·¥å…·ï¼Œç®€åŒ–äº†ç®¡ç†layer çš„æ“ä½œï¼Œå®ƒçš„create-layerå­å‘½ä»¤ç”¨äºæ–°å»ºlayerï¼š\n$ bitbake-layers create-layer meta-mylayer NOTE: Starting bitbake server... Add your new layer with \u0026#39;bitbake-layers add-layer meta-mylayer\u0026#39; è¿™æ¡å‘½ä»¤æ–°å»ºäº†ä¸€ä¸ªåä¸º meta-mylayer çš„æ–‡ä»¶å¤¹ï¼Œå†…éƒ¨åŒ…å«å¦‚ä¸‹æ–‡ä»¶ï¼š\nCOPYING.MITæ–‡ä»¶ï¼Œè¿™æ˜¯layerçš„ç‰ˆæƒå£°æ˜æ–‡ä»¶ã€‚ README æ–‡ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ªæè¿°layerå†…å®¹çš„æ–‡ä»¶ã€‚ åŒ…å« layer.conf æ–‡ä»¶çš„ conf å­ç›®å½•ï¼Œæ˜¯layerçš„é»˜è®¤é…ç½®æ–‡ä»¶ã€‚ ä¸€ä¸ª recipes-example å­ç›®å½•ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªåä¸º example çš„å­ç›®å½•ï¼Œè¯¥å­ç›®å½•åŒ…å«ä¸€ä¸ª example.bb æ–‡ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ªrecipeçš„ä¾‹å­ã€‚ ç„¶åéœ€è¦æŠŠè¿™ä¸ªlayeræ·»åŠ åˆ°é¡¹ç›®ä¸­ï¼š\n$ bitbake-layers add-layer meta-mylayer è¿™æ¡å‘½ä»¤ä¼šæŠŠmeta-mylayerçš„è·¯å¾„æ·»åŠ åˆ°${BUILDDIR}/conf/bblayers.confæ–‡ä»¶çš„BBLAYERSå˜é‡ä¸­ï¼Œè¿™æ ·bitbakeåœ¨æ‰§è¡Œæ—¶æ‰èƒ½æ‰¾åˆ°è¿™ä¸ªlayerä¸‹çš„recipeï¼š\n\u0026gt; cat conf/bblayers.conf # POKY_BBLAYERS_CONF_VERSION is increased each time build/conf/bblayers.conf # changes incompatibly POKY_BBLAYERS_CONF_VERSION = \u0026#34;2\u0026#34; BBPATH = \u0026#34;${TOPDIR}\u0026#34; BBFILES ?= \u0026#34;\u0026#34; BBLAYERS ?= \u0026#34; \\ /home/lsc/yocto-kirkstone/poky/meta \\ /home/lsc/yocto-kirkstone/poky/meta-poky \\ /home/lsc/yocto-kirkstone/poky/meta-yocto-bsp \\ /home/lsc/yocto-kirkstone/x86_build/meta-mylayer \\ \u0026#34; æŸ¥çœ‹ä¸€ä¸‹å½“å‰é¡¹ç›®åŒ…å«çš„layer ï¼š\n$ bitbake-layers show-layers NOTE: Starting bitbake server... layer path priority ========================================================================== meta /home/lsc/yocto-kirkstone/poky/meta 5 meta-poky /home/lsc/yocto-kirkstone/poky/meta-poky 5 meta-yocto-bsp /home/lsc/yocto-kirkstone/poky/meta-yocto-bsp 5 meta-mylayer /home/lsc/yocto-kirkstone/x86_build/meta-mylayer 6 å‡ ä¸ªlayeråŒ…å«ä¸åŒçš„å†…å®¹ï¼š\nmateæºäºOpenEmbeddedé¡¹ç›®ï¼Œæ˜¯Yoctoé¡¹ç›®çš„æ ¸å¿ƒå†…å®¹ï¼ŒåŒ…æ‹¬å„ç§æ ¸å¿ƒrecipeï¼Œå…±äº«åº“å’Œå·¥å…·ç­‰ã€‚ä¾‹å¦‚å†…æ ¸çš„recipeå°±åœ¨meta/recipes-kernel/linux/ä¸‹ã€‚ meta-yocto-bspåŒ…å«ç¡¬ä»¶ç›¸å…³çš„å†…å®¹ï¼Œä¾‹å¦‚ï¼Œmeta-yocto-bsp/conf/machineä¸‹æ˜¯ç›®æ ‡ç¡¬ä»¶çš„é…ç½®æ–‡ä»¶ï¼Œmeta-yocto-bsp/recipes-kernel/linuxä¸‹é¢æ˜¯ç¡¬ä»¶ç›¸å…³çš„å†…æ ¸è¡¥ä¸ã€‚ meta-pokyæ˜¯pokyè¿™ä¸ªå‘è¡Œç‰ˆçš„æ ¸å¿ƒå†…å®¹ï¼Œmeta-poky/conf/distroä¸‹é¢æ˜¯å‘è¡Œç‰ˆçš„é…ç½®æ–‡ä»¶ï¼Œä»é¡¶å±‚å†³å®šäº†å‘è¡Œç‰ˆåŒ…å«çš„å†…å®¹ã€‚ meta-mylayerå°±æ˜¯æˆ‘ä»¬åœ¨pokyå‘è¡Œç‰ˆåŸºç¡€ä¸Šæ·»åŠ çš„è‡ªå®šä¹‰å†…å®¹ã€‚ æ³¨æ„æœ€åä¸€åˆ—è¡¨ç¤ºä¼˜å…ˆçº§ï¼ˆpriorityï¼‰ï¼Œå®ƒåœ¨${LAYERDIR}/conf/layer.confæ–‡ä»¶çš„BBFILE_PRIORITYå˜é‡ä¸­å®šä¹‰ï¼Œæ•°å­—è¶Šå¤§è¡¨ç¤ºä¼˜å…ˆçº§è¶Šé«˜ã€‚bitbakeä¼šä»ä½åˆ°é«˜è¯»å–è§£æå„layerä¸­çš„é…ç½®ï¼Œè¿™æ ·ï¼Œå¯¹åº”åŒåçš„é…ç½®é€‰é¡¹ï¼Œé«˜ä¼˜å…ˆçº§ä¸­çš„é…ç½®å°±ä¼šæŠŠä½ä¼˜å…ˆçº§ä¸­çš„è¦†ç›–ã€‚å¦‚æœè¦ä»bblayers.confæ–‡ä»¶åˆ é™¤ä¸€ä¸ªlayerå¯ä»¥æ‰§è¡Œremove-layerå­å‘½ä»¤ã€‚\n4.2 æ·»åŠ è½¯ä»¶åŒ… #å› ä¸ºcore-image-minimal çš„imageåªå®‰è£…äº†å°‘é‡çš„è½¯ä»¶ï¼Œå¤§éƒ¨åˆ†å‘½ä»¤æ˜¯ç”±busyboxç”Ÿæˆçš„ï¼Œæ•°é‡è¾ƒå°‘ï¼ŒåŠŸèƒ½ä¹Ÿæ¯”è¾ƒç®€é™‹ï¼Œä¾‹å¦‚æ²¡æœ‰å¯ä»¥è¿½è¸ªç³»ç»Ÿè°ƒç”¨straceå‘½ä»¤ï¼Œæˆ‘ä»¬è¦å®‰è£…ä¸€ä¸ªã€‚\né¦–å…ˆè¦ç¡®å®šç°æœ‰çš„layerä¸­ï¼Œæœ‰æ²¡æœ‰åŒ…å«straceçš„recipeã€‚å¯ä»¥ç”¨bitbakeçš„-sé€‰é¡¹åˆ—å‡ºå½“å‰layerä¸­çš„æ‰€æœ‰recipeï¼Œä»ä¸­æ£€ç´¢ä¸€ä¸‹å³å¯ï¼š\n$ bitbake -s | grep strace strace :5.16-r0 strace-native :5.16-r0 éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“å‰é¡¹ç›®çš„${BBLAYERS}å¹¶æ²¡æœ‰åŒ…å«pokyçš„æ‰€æœ‰layerï¼Œå¦‚æœbitbakeå‘½ä»¤æ²¡æ‰¾åˆ°ï¼Œè¿˜æ˜¯è¦å»pokyä¸‹æœç´¢ä¸€ä¸‹ã€‚\nå‘imageæ·»åŠ è½¯ä»¶åŒ…çš„æ–¹æ³•æœ‰å¾ˆå¤šç§ï¼Œæœ€å¸¸ç”¨çš„æ˜¯å‘IMAGE_INSTALLå˜é‡è¿½åŠ recpieï¼ŒIMAGE_INSTALLçš„å€¼æ˜¯ç”±ç©ºæ ¼åˆ†éš”çš„recipeåç§°ï¼Œbitbakeä¼šå‘imageå®‰è£…è¿™ä¸ªå˜é‡è®¾ç½®çš„recipeã€‚æˆ‘ä»¬åœ¨meta-mylayerä¸‹é¢æ–°å»ºrecipes-core/images/core-image-minimal.bbappendæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\nIMAGE_INSTALL:append = \u0026#34; strace\u0026#34; å®ƒçš„å«ä¹‰æ˜¯å‘IMAGE_INSTALLå˜é‡çš„å°¾éƒ¨è¿½åŠ ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¦‚æœè¦åœ¨å‰é¢æ·»åŠ ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¯ä»¥ç”¨:prependè¯­æ³•ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸¤ä¸ªè¯­æ³•ä¸ä¼šè‡ªåŠ¨æ·»åŠ ç©ºæ ¼ï¼Œæ‰€ä»¥è¦åœ¨recipeåçš„å‰ååŠ ä¸€ä¸ªç©ºæ ¼ï¼Œå¦‚æœè¦åˆ é™¤ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¯ä»¥ç”¨:removeè¯­æ³•ã€‚bitbakeä¿®æ”¹å˜é‡çš„è¯­æ³•æœ‰å¾ˆå¤šç§ï¼Œæœ‰å¾ˆå¤šæ³¨æ„äº‹é¡¹ï¼Œå¯ä»¥å‚è€ƒBasic Syntaxæ¢ç´¢ä¸€ä¸‹ã€‚\næ¯ä¸ªrecipeå¯ä»¥ç”±ä¸€ä¸ª.bbæ–‡ä»¶å’Œå¤šä¸ª.bbappendæ–‡ä»¶ç»„æˆï¼Œbitbakeä¼šå…ˆè¯»å–.bbæ–‡ä»¶ï¼Œç„¶åæŒ‰ç…§layerçš„ä¼˜å…ˆçº§ç”±ä½åˆ°é«˜ï¼Œé€ä¸ªè¯»å–.bbappendæ–‡ä»¶ï¼Œç„¶åæ·±å…¥è§£æã€‚ç°åœ¨æ£€æŸ¥ä¸€ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°straceå·²ç»åŠ ä¸Šï¼š\n$ bitbake -e core-image-minimal | grep ^IMAGE_INSTALL= IMAGE_INSTALL=\u0026#34;packagegroup-core-boot strace\u0026#34; é‡æ–°ç¼–è¯‘imageï¼š\n$ bitbake core-image-minimal -c cleanall $ bitbake core-image-minimal æŸ¥çœ‹${IMAGE_ROOTFS}å’Œ${IMAGE_MANIFEST}ä¸­çš„å†…å®¹ï¼Œç¡®è®¤å®‰è£…æˆåŠŸï¼Œå°±å¯ä»¥å¯åŠ¨è™šæ‹Ÿæœºä½¿ç”¨äº†ï¼š\nè¿™æ˜¯æ·»åŠ è½¯ä»¶åŒ…æœ€ç›´æ¥çš„æ–¹å¼ï¼Œä½†æ˜¯å½±å“imageåŒ…å«å“ªäº›è½¯ä»¶åŒ…çš„å› ç´ è¿˜æœ‰å¾ˆå¤šï¼Œåé¢ä¼šé€æ¸é‡åˆ°ã€‚\n4.3 è®¾ç½®hostname #åœ¨Linuxç³»ç»Ÿä¸­ï¼Œé€šè¿‡/etc/hostnameæ–‡ä»¶è®¾ç½®ä¸»æœºåï¼š\nå¦‚æœè¦ä¿®æ”¹è¿™ä¸ªæ–‡ä»¶ï¼Œé¦–å…ˆè¦ç¡®å®šå®ƒæ˜¯ç”±å“ªä¸ªrecipeå®‰è£…åˆ°imageçš„ã€‚æ¯ä¸ªrecipeç”Ÿæˆäº†å“ªäº›å®‰è£…åŒ…éƒ½è®°å½•åœ¨${PKGDATA_DIR}è·¯å¾„ä¸‹çš„åŒåæ–‡ä»¶ä¸­ã€‚ä»¥busyboxä¸ºä¾‹ï¼Œ${PKGDATA_DIR}/busyboxæ–‡ä»¶åˆ—å‡ºæ¥busyboxç”Ÿæˆçš„æ‰€æœ‰å®‰è£…åŒ…ï¼š\n$ cat busybox PACKAGES: busybox-src busybox-dbg busybox-ptest busybox-httpd busybox-udhcpd busybox-udhcpc busybox-syslog busybox-mdev busybox-hwclock busybox-staticdev busybox-dev busybox-doc busybox-locale busybox æŸ¥çœ‹${IMAGE_MANIFEST}æ–‡ä»¶çš„å†…å®¹å¯ä»¥ç¡®å®šï¼Œimageåªå®‰è£…äº†å¦‚ä¸‹å‡ ä¸ªå®‰è£…åŒ…ï¼š\nbusybox core2_64 1.35.0 busybox-hwclock core2_64 1.35.0 busybox-syslog core2_64 1.35.0 busybox-udhcpc core2_64 1.35.0 æ¯ä¸ªå®‰è£…åŒ…å‘imageå®‰è£…çš„æ–‡ä»¶ï¼Œéƒ½å­˜æ”¾åœ¨${PKGDEST}è·¯å¾„ä¸‹çš„åŒåæ–‡ä»¶å¤¹é‡Œï¼š\n$ cat busybox-bb.log | grep ^PKGDEST= PKGDEST=\u0026#34;/home/lsc/yocto-kirkstone/x86_build/tmp/work/core2-64-poky-linux/busybox/1.35.0-r0/packages-split\u0026#34; $ ls tmp/work/core2-64-poky-linux/busybox/1.35.0-r0/packages-split busybox busybox-doc busybox-locale busybox-src busybox-udhcpc busybox-dbg busybox-httpd busybox-mdev busybox-staticdev busybox-udhcpd busybox-dev busybox-hwclock busybox-ptest busybox-syslog busybox.shlibdeps ä¾‹å¦‚busybox-hwclockåªå®‰è£…äº†ä¸€ä¸ªhwclock.shè„šæœ¬ï¼š\n$ tree tmp/work/core2-64-poky-linux/busybox/1.35.0-r0/packages-split/busybox-hwclock tmp/work/core2-64-poky-linux/busybox/1.35.0-r0/packages-split/busybox-hwclock â””â”€â”€ etc â””â”€â”€ init.d â””â”€â”€ hwclock.sh 2 directories, 1 file é€šè¿‡ä¸Šé¢è¿™ä¸ªæŸ¥è¯¢æ¬¡åºï¼Œå¯ä»¥ç¡®å®šimageå®‰è£…å“ªäº›è½¯ä»¶åŒ…ï¼Œæ¯ä¸ªè½¯ä»¶åŒ…éƒ½å®‰è£…äº†ä»€ä¹ˆæ–‡ä»¶ï¼Œåè¿‡æ¥ä¹Ÿå°±å¯ä»¥ç¡®å®šimageä¸­çš„æŸä¸ªæ–‡ä»¶æ¥è‡ªäºå“ªä¸ªrecipe ã€‚OpenEmbeddedä¸ºæ­¤æä¾›äº†oe-pkgdata-utilå·¥å…·ï¼Œå®ƒä¼šè§£æ${PKGDATA_DIR}ä¸‹çš„æ–‡ä»¶ï¼Œç„¶åæ‰¾å‡ºæˆ‘ä»¬æƒ³è¦çš„æ•°æ®ã€‚å…¶ä¸­find-pathå­å‘½ä»¤ç”¨æˆ·æ‰¾åˆ°imageä¸­çš„æŸä¸ªæ–‡ä»¶æ¥è‡ªäºå“ªä¸ªå®‰è£…åŒ…ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š\n$ oe-pkgdata-util find-path /etc/hostname base-files: /etc/hostname å› ä¸ºä¸€ä¸ªrecipeå¯èƒ½ä¼šç”Ÿæˆå¤šä¸ªè½¯ä»¶å®‰è£…åŒ…ï¼Œæ‰€ä»¥ï¼Œè¦è¿›ä¸€æ­¥ä½¿ç”¨lookup-recipeå­å‘½ä»¤æ‰¾åˆ°base-filesè¿™ä¸ªè½¯ä»¶åŒ…æ˜¯å“ªä¸ªrecipeç”Ÿæˆçš„ï¼š\n$ oe-pkgdata-util lookup-recipe base-files base-files è‡³æ­¤ï¼Œå¯ä»¥ç¡®å®š/etc/hostnameæ˜¯ç”±base-files_*.bbæ„å»ºçš„base-filesè½¯ä»¶åŒ…å®‰è£…çš„ï¼Œæ‰¾åˆ°å®ƒï¼š\n$ bitbake -e base-files | grep ^PKGDEST= PKGDEST=\u0026#34;/home/lsc/yocto-kirkstone/x86_build/tmp/work/qemux86_64-poky-linux/base-files/3.0.14-r89/packages-split\u0026#34; $ ls tmp/work/qemux86_64-poky-linux/base-files/3.0.14-r89/packages-split base-files base-files-dbg base-files-dev base-files-doc base-files-src $ cat tmp/work/qemux86_64-poky-linux/base-files/3.0.14-r89/packages-split/base-files/etc/hostname qemux86-64 æ‰¾åˆ°å®ƒçš„recipeæ–‡ä»¶ï¼š\n$ bitbake -e base-files | grep ^FILE= FILE=\u0026#34;/home/lsc/yocto-kirkstone/poky/meta/recipes-core/base-files/base-files_3.0.14.bb\u0026#34; åœ¨base-files_3.0.14.bbæ–‡ä»¶å¯ä»¥çœ‹åˆ°å¦‚ä¸‹å†…å®¹ï¼š\nhostname = \u0026#34;${MACHINE}\u0026#34; do_install () { ... if [ \u0026#34;${hostname}\u0026#34; ]; then echo ${hostname} \u0026gt; ${D}${sysconfdir}/hostname echo \u0026#34;127.0.1.1 ${hostname}\u0026#34; \u0026gt;\u0026gt; ${D}${sysconfdir}/hosts fi ... } é¦–å…ˆç”¨${MACHINE}çš„å€¼è®¾ç½®äº†hostnameå˜é‡ï¼Œç„¶åæŠŠå®ƒå†™å…¥äº†${D}${sysconfdir}/hostnameæ–‡ä»¶ã€‚MACHINEå®šä¹‰åœ¨${BUILDDIR}/conf/local.confæ–‡ä»¶ä¸­ï¼Œè¿™å°±æ˜¯hostnameçš„é»˜è®¤å€¼ï¼š\n$ cat conf/local.conf | grep ^MACHINE MACHINE ??= \u0026#34;qemux86-64\u0026#34; å½“ç„¶å¯ä»¥åœ¨base-files_3.0.14.bbæ–‡ä»¶ä¸­çš„ä¿®æ”¹hostname å˜é‡ï¼Œä½†æ˜¯è¿™æ ·ä¸åˆ©äºç³»ç»Ÿç»´æŠ¤ï¼Œæ›´å¥½çš„åšæ³•æ˜¯åœ¨meta-mylayerä¸‹é¢æ–°å»ºrecipes-core/base-files/base-files_3.0.14.bbappendæ–‡ä»¶ï¼Œé‡æ–°è®¾ç½®hostnameï¼š\nhostname = \u0026#34;localhost\u0026#34; é‡æ–°æ„å»ºæ—¶ï¼Œbitbakeä¼šå…ˆæ‰¾åˆ°base-files_3.0.14.bbï¼Œç„¶åæ‰¾åˆ°åŒåçš„.bbappendæ–‡ä»¶ï¼Œä¾æ®layerçš„ä¼˜å…ˆçº§åˆå¹¶è§£æè¿™äº›æ–‡ä»¶ã€‚å¾ˆå¤šæ—¶å€™ä¼šæœ‰æœ‰å¤šä¸ª.bbappendæ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨bitbake-layerçš„show-appendså­å‘½ä»¤åˆ—å‡ºæŸä¸ªrecipeä¾èµ–çš„æ‰€æœ‰.bbå’Œ.bbappendæ–‡ä»¶ï¼Œä»¥base-filesä¸ºä¾‹ï¼š\n\u0026gt; bitbake-layers show-appends base-files NOTE: Starting bitbake server... Loading cache: 100% |################################################################| Time: 0:00:00 Loaded 1645 entries from dependency cache. Parsing recipes: 100% |##############################################################| Time: 0:00:00 Parsing of 884 .bb files complete (883 cached, 1 parsed). 1645 targets, 45 skipped, 0 masked, 0 errors. === Matched appended recipes === base-files_3.0.14.bb: /home/lsc/yocto-kirkstone/x86_build/meta-mylayer/recipes-core/base-files/base-files_3.0.14.bbappend æ‰€ä»¥ï¼Œbase-files_3.0.14.bbappendå¯¹hostnameçš„é‡æ–°èµ‹å€¼ä¼šæŠŠbase-files_3.0.14.bbä¸­çš„ç›¸åº”é…ç½®è¦†ç›–æ‰ã€‚æˆ‘ä»¬é‡æ–°æ„å»ºä¸€ä¸‹å°±å¯ä»¥ç¡®è®¤ï¼š\n$ bitbake base-files -c cleansstate $ bitbake base-files $ cat tmp/work/qemux86_64-poky-linux/base-files/3.0.14-r89/packages-split/base-files/etc/hostname localhost 4.4 æ–°å»ºä¸€ä¸ªrecipe #å…¶å®ï¼ŒYoctoé€šè¿‡poky/meta-skeletonæä¾›äº†å¤šç§reciepå’Œconfigureçš„ä¾‹å­ï¼Œå…¶ä¸­çš„recipes-skeleton/hello-singleæ˜¯ä¸€ä¸ªæ·»åŠ åº”ç”¨ç¨‹åºçš„ç®€å•å®ä¾‹ï¼Œæˆ‘ä»¬å‚è€ƒè¿™ä¸ªä¾‹å­æ”¹é€ ä¸€ä¸‹ï¼Œå‘imageæ·»åŠ ä¸€ä¸ªCè¯­è¨€çš„ä¸²å£æµ‹è¯•ç¨‹åºcomperfã€‚\né¦–å…ˆåœ¨meta-mylayerä¸‹æ–°å»ºrecipes-appæ–‡ä»¶å¤¹ï¼Œä¹‹æ‰€ä»¥ç”¨recipes-å¼€å¤´ï¼Œæ˜¯å› ä¸ºconf/layer.confæ–‡ä»¶ä¸­é»˜è®¤é…ç½®çš„BBFILESå˜é‡ï¼Œè§„å®šäº†åªä¼šæ£€ç´¢recipes-*æ–‡ä»¶å¤¹ä¸‹çš„.bbå’Œ .bbappendæ–‡ä»¶ï¼š\nBBFILES += \u0026#34;${LAYERDIR}/recipes-*/*/*.bb \\ ${LAYERDIR}/recipes-*/*/*.bbappend\u0026#34; ç„¶ååœ¨æ­¤ç›®å½•ä¸‹æ–°å»ºcomperfæ–‡ä»¶å¤¹ï¼ŒåŒ…å«å¦‚ä¸‹æ–‡ä»¶ï¼š\n\u0026gt; tree comperf/ comperf/ â”œâ”€â”€ comperf_1.0.bb â””â”€â”€ files â”œâ”€â”€ Makefile â”œâ”€â”€ README.md â””â”€â”€ comperf.c 1 directory, 4 files Makefile çš„å†…å®¹æ˜¯ï¼š\ncomperf:comperf.c $(CC) ${CFLAGS} $\u0026lt; -o $@ -lrt $(LDFLAGS) install: install -d $(DESTDIR) install -m 0755 comperf $(DESTDIR) clean: rm -rf comperf æŒ‰ç…§bitbakeçš„è§„å®šï¼Œrecipeæ–‡ä»¶helloworld_1.0.bbçš„æ–‡ä»¶åæœ‰ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼š\nç¬¬ä¸€ä¸ªéƒ¨åˆ†æ˜¯recipeçš„åå­—ï¼Œbitbakeä¼šæŠŠå®ƒè§£æåˆ°PNå˜é‡ä¸­ï¼Œè¿™é‡ŒPN=helloworldã€‚ ä¸‹åˆ’çº¿åé¢æ˜¯æºç çš„ç‰ˆæœ¬å·ï¼Œbitbakeä¼šæŠŠå®ƒè§£æåˆ°PVå˜é‡ä¸­ï¼Œè¿™é‡ŒPV=1.0ã€‚ åç¼€å¿…é¡»æ˜¯.bbã€‚ å†…å®¹å¦‚ä¸‹ï¼š\nDESCRIPTION = \u0026#34;Linux UART Serial test application\u0026#34; SECTION = \u0026#34;application\u0026#34; LICENSE = \u0026#34;MIT\u0026#34; LIC_FILES_CHKSUM = \u0026#34;file://${COMMON_LICENSE_DIR}/MIT;md5=0835ade698e0bcf8506ecda2f7b4f302\u0026#34; SRC_URI = \u0026#34;file://comperf.c \\ file://Makefile \\ file://README.md \\ \u0026#34; S = \u0026#34;${WORKDIR}\u0026#34; EXTRA_OEMAKE = \u0026#34;CC=\u0026#39;${CC}\u0026#39; CFLAGS=\u0026#39;${CFLAGS}\u0026#39; LDCFLAGS=\u0026#39;${LDFLAGS}\u0026#39; DESTDIR=\u0026#39;${D}${bindir}\u0026#39;\u0026#34; do_install() { oe_runmake install } FILES:${PN} = \u0026#34;${bindir}/comperf\u0026#34; DESCRIPTIONæ˜¯å¯¹è¿™ä¸ªrecipeçš„æ•´ä½“æè¿°ï¼ŒSECTIONçš„å€¼ç”¨äºè½¯ä»¶å®‰è£…åŒ…åˆ†ç±»ï¼Œrpmç­‰åŒ…ç®¡ç†å™¨ä¼šç”¨å®ƒçš„å€¼å¡«å……è½¯ä»¶åŒ…çš„ä¿¡æ¯ï¼Œä¸æ˜¯å¿…é¡»çš„ã€‚\nLICENSEæ ‡è¯†è¿™ä¸ªrecipeä½¿ç”¨çš„Licenseï¼Œè¿™é‡Œç”¨çš„æ˜¯MITã€‚LIC_FILES_CHKSUMæ˜¯Licenseæ–‡ä»¶çš„è·¯å¾„å’Œæ ¡éªŒå’Œã€‚Yoctoåœ¨${COMMON_LICENSE_DIR}è·¯å¾„ä¸‹æä¾›äº†å¤§é‡å¸¸ç”¨çš„Licesenæ–‡ä»¶ï¼Œé€šå¸¸ç›´æ¥ç”¨è¿™äº›å°±å¤Ÿäº†ï¼Œå¦‚æœè¦ä½¿ç”¨å…¶ä»–çš„Licesenæ–‡ä»¶ï¼Œå¯ä»¥æ”¾åˆ°${SRC_URI}ä¸­ï¼Œç„¶åå¡«å†™ç›¸å¯¹è·¯å¾„å³å¯ã€‚md5=è¡¨ç¤ºåé¢è·Ÿç€Licenseæ–‡ä»¶çš„md5æ ¡éªŒå’Œã€‚bitbakeå¼€å§‹æ„å»ºå‰ä¼šæ£€æŸ¥è¿™ä¸ªï¼Œå¦‚æœæ ¡éªŒå¤±è´¥ä¼šæŠ¥é”™ã€‚\næ‰§è¡Œdo_fetchä»»åŠ¡æ—¶ï¼Œbibakeä¼šä»${SRC_URI}è·å–æºç ï¼Œç„¶åé€šè¿‡do_unpackä»»åŠ¡æ”¾åˆ°${WORKDIR}è·¯å¾„ä¸‹ã€‚SRC_URIè®¾ç½®äº†æºç çš„è·¯å¾„ï¼Œfile:// åè®®è¡¨ç¤ºè¿™äº›æ–‡ä»¶åœ¨æœ¬åœ°ï¼Œç„¶åæ˜¯æºç æ–‡ä»¶çš„è·¯å¾„ï¼Œè¿™ä¸ªè·¯å¾„æ˜¯åŸºäº ${FILESPATH} çš„ç›¸å¯¹è·¯å¾„ï¼Œå¯ä»¥è®¾ç½®å•ä¸ªæ–‡ä»¶ï¼Œå‹ç¼©åŒ…æˆ–è€…æ•´ä¸ªç›®å½•ï¼Œé€šå¸¸æ˜¯æ”¾åœ¨recipeæ–‡ä»¶åŒä¸€å±‚çš„filesæˆ–è€…${PN}æ–‡ä»¶å¤¹ä¸‹ã€‚\nåé¢çš„ç¼–è¯‘å·¥ä½œè¦åœ¨${S}è®¾ç½®çš„è·¯å¾„ä¸‹è¿›è¡Œï¼Œä½†æ˜¯Sçš„é»˜è®¤å€¼æ˜¯${WORKDIR}/${BPN}-${PV}ï¼Œæ‰€ä»¥è¦é‡è®¾S = \u0026quot;${WORKDIR}\u0026quot;ã€‚éœ€è¦æ³¨æ„ï¼Œå¦‚æœSRC_URIè®¾ç½®çš„æ˜¯å‹ç¼©åŒ…ï¼Œæ–‡ä»¶å¤¹æˆ–è€…å…¶ä»–åè®®ï¼Œè¿™ä¸ªè·¯å¾„æ˜¯ä¸ä¸€æ ·çš„ã€‚\nå› ä¸ºæœ‰Makefileï¼Œbitbakeä¼šè‡ªåŠ¨æ‰§è¡ŒåŸºäºmakeçš„do_compileä»»åŠ¡ï¼Œä¸ç”¨æˆ‘ä»¬é‡å†™ï¼Œå¯ä»¥ç”¨EXTRA_OEMAKEå‘Makefileä¼ é€’ä¸€äº›éœ€è¦çš„å‚æ•°ã€‚LDFLAGSæ˜¯å‘é“¾æ¥å™¨ä¼ é€’çš„å‚æ•°ï¼Œä½¿ç›®æ ‡æ–‡ä»¶ä¸æ„å»ºç³»ç»Ÿçš„é“¾æ¥èµ·æ¥ã€‚${bindir}è¡¨ç¤ºimageä¸­å¯æ‰§è¡Œæ–‡ä»¶çš„å®‰è£…è·¯å¾„ï¼Œé»˜è®¤å€¼æ˜¯/usr/binã€‚è¿™äº›å‚æ•°éƒ½å®šä¹‰åœ¨poky/meta/conf/bitbake.confæ–‡ä»¶ï¼Œå¸¸ç”¨çš„è¿˜æœ‰ï¼š\nexport base_prefix = \u0026#34;\u0026#34; export prefix = \u0026#34;/usr\u0026#34; export exec_prefix = \u0026#34;${prefix}\u0026#34; export sysconfdir = \u0026#34;${base_prefix}/etc\u0026#34; export bindir = \u0026#34;${exec_prefix}/bin\u0026#34; export sbindir = \u0026#34;${exec_prefix}/sbin\u0026#34; export CC = \u0026#34;${CCACHE}${HOST_PREFIX}gcc ${HOST_CC_ARCH}${TOOLCHAIN_OPTIONS}\u0026#34; export CXX = \u0026#34;${CCACHE}${HOST_PREFIX}g++ ${HOST_CC_ARCH}${TOOLCHAIN_OPTIONS}\u0026#34; export CPP = \u0026#34;${HOST_PREFIX}gcc -E${TOOLCHAIN_OPTIONS} ${HOST_CC_ARCH}\u0026#34; export LD = \u0026#34;${HOST_PREFIX}ld${TOOLCHAIN_OPTIONS} ${HOST_LD_ARCH}\u0026#34; TARGET_CFLAGS = \u0026#34;${TARGET_CPPFLAGS} ${SELECTED_OPTIMIZATION}\u0026#34; export CFLAGS = \u0026#34;${TARGET_CFLAGS}\u0026#34; TARGET_LDFLAGS = \u0026#34;-Wl,-O1 ${TARGET_LINK_HASH_STYLE} ${ASNEEDED} ${DEBUG_PREFIX_MAP}\u0026#34; export LDFLAGS = \u0026#34;${TARGET_LDFLAGS}\u0026#34; ä½†æ˜¯do_installä»»åŠ¡é»˜è®¤æ˜¯ç©ºçš„ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå®šä¹‰ï¼Œè¿™é‡Œæ˜¯è°ƒç”¨äº†Yoctoæä¾›çš„oe_runmakeå‡½æ•°æ‰§è¡ŒMakefileçš„installç›®æ ‡ï¼Œè¿™æ˜¯ç”±base.bbclassæ–‡ä»¶æä¾›çš„å‡½æ•°ï¼Œå¯ä»¥åœ¨poky/meta/classes/ ä¸‹æ‰¾åˆ°ã€‚å¦‚æœMakefileæ²¡æœ‰installç›®æ ‡ï¼Œå¯ä»¥åœ¨do_installä¸­ç›´æ¥æ·»åŠ å®‰è£…å‘½ä»¤ï¼Œä¾‹å¦‚ï¼š\ndo_install() { install -d ${D}/usr/bin install -m 0755 comperf ${D}/usr/bin } ç¼–è¯‘å’Œå®‰è£…å®Œæ¯•åï¼Œä¸‹ä¸€æ­¥è¦å¤„ç†do_packageä»»åŠ¡ã€‚å®ƒå…ˆæ ¹æ®PACKAGESå˜é‡æ¥ç¡®å®šè¦æ–°å»ºå‡ ä¸ªåŒ…ï¼Œä»¥ç©ºæ ¼åˆ†éš”ï¼Œé»˜è®¤å€¼æ˜¯ï¼š\n${PN}-src ${PN}-dbg ${PN}-staticdev ${PN}-dev ${PN}-doc ${PN}-locale ${PACKAGE_BEFORE_PN} ${PN} æˆ‘ä»¬æ²¡æœ‰ä¿®æ”¹ï¼Œæ‰€ä»¥${PKGDEST}è·¯å¾„ä¸‹æœ‰å¦‚ä¸‹æ–‡ä»¶å¤¹ï¼š\ncomperf comperf-dev comperf-locale comperf-staticdev comperf-dbg comperf-doc comperf-src ç„¶åéå†${PACKAGES}ï¼Œæ ¹æ®ä¸æ¯ä¸ªè½¯ä»¶åŒ…å¯¹åº”çš„FILES å˜é‡ï¼Œå°†æ–‡ä»¶åˆ†é…ç»™è¿™äº›è½¯ä»¶åŒ…ã€‚ä¾‹å¦‚FILES:${PN}å°±æ˜¯å‘comperfè½¯ä»¶åŒ…æ·»åŠ çš„æ–‡ä»¶ã€‚å¦‚æœè¦å‘comperf-docè½¯ä»¶åŒ…æ·»åŠ æ–‡ä»¶ï¼Œåº”è¯¥è®¾ç½®FILES:${PN}-docã€‚å¦‚æœä¸€ä¸ªæ–‡ä»¶ä¸ ${PACKAGES} ä¸­å¤šä¸ªè½¯ä»¶åŒ…çš„ ${FILES} åŒ¹é…ï¼Œå®ƒå°†è¢«åˆ†é…åˆ°æœ€æ—©ï¼ˆæœ€å·¦ï¼‰åŒ¹é…çš„è½¯ä»¶åŒ…ã€‚ä¹‹åä¼šæ‰§è¡Œdo_package_write_rpmä»»åŠ¡ï¼ŒæŠŠè¿™äº›æ–‡ä»¶å¤¹æ‰“åŒ…æˆrpmè½¯ä»¶åŒ…ï¼Œæ”¾åˆ°${WORKDIR}/deploy-rpmsè·¯å¾„ä¸‹ã€‚æœ€åè¿˜è¦æ‰§è¡Œdo_package_qaä»»åŠ¡ï¼Œå¯¹ç”Ÿæˆçš„è½¯ä»¶åŒ…è¿›è¡Œè´¨é‡æ£€æŸ¥ï¼Œç¡®ä¿æ„å»ºæ­£ç¡®ï¼Œå¦‚æœæœ‰â€œQA Issueâ€é”™è¯¯ï¼Œå¯ä»¥åœ¨QA Error and Warning MessagesæŸ¥è¯¢é”™è¯¯ä¿¡æ¯çš„å«ä¹‰å’Œè§£å†³æ–¹æ³•ã€‚\nå†™å¥½recipeåï¼Œæ„å»ºè°ƒè¯•æ²¡æœ‰é—®é¢˜ï¼Œå°±å¯ä»¥æŠŠéœ€è¦çš„è½¯ä»¶åŒ…æ·»åŠ åˆ°imageï¼Œåœ¨meta-mylayer/recipes-core/images/core-image-minimal.bbappendæ–‡ä»¶ä¸­æ·»åŠ ä¸€è¡Œï¼š\nIMAGE_INSTALL:append = \u0026#34; comperf\u0026#34; 4.5 ä½¿ç”¨packagegroup #è§£æimageçš„IMAGE_INSTALLå˜é‡ï¼Œä¼šå‘ç°ä¸€ä¸ªåä¸ºpackagegroup-core-bootçš„è½¯ä»¶åŒ…ï¼š\n$ bitbake -e core-image-minimal | grep ^IMAGE_INSTALL= IMAGE_INSTALL=\u0026#34;packagegroup-core-boot strace comperf\u0026#34; è¿™ç§ä»¥packagegroupå¼€å¤´çš„å¯ä»¥å«åšåŒ…ç»„ï¼Œå°±æ˜¯æŒ‰ç‰¹å®šéœ€æ±‚æŠŠå¤šä¸ªè½¯ä»¶åŒ…é›†åˆåˆ°ä¸€èµ·ï¼Œæœ¬è´¨ä¹Ÿæ˜¯recipeï¼š\n$ oe-pkgdata-util lookup-recipe packagegroup-core-boot packagegroup-core-boot $ bitbake -e packagegroup-core-boot | grep ^FILE= FILE=\u0026#34;/home/lsc/yocto-kirkstone/poky/meta/recipes-core/packagegroups/packagegroup-core-boot.bb\u0026#34; å› ä¸ºåŒ…ç»„æœ¬èº«æ²¡æœ‰æºç ï¼Œæ‰€ä»¥æ–‡ä»¶åé‡Œæ²¡æœ‰è®¾ç½®PVï¼Œé»˜è®¤å€¼æ˜¯â€œ1.0â€ï¼Œåˆ†æä¸€ä¸‹è¿™ä¸ªæ–‡ä»¶ï¼š\nSUMMARY = \u0026#34;Minimal boot requirements\u0026#34; DESCRIPTION = \u0026#34;The minimal set of packages required to boot the system\u0026#34; PR = \u0026#34;r17\u0026#34; PACKAGE_ARCH = \u0026#34;${MACHINE_ARCH}\u0026#34; inherit packagegroup # Distro can override the following VIRTUAL-RUNTIME providers: VIRTUAL-RUNTIME_dev_manager ?= \u0026#34;udev\u0026#34; VIRTUAL-RUNTIME_keymaps ?= \u0026#34;keymaps\u0026#34; EFI_PROVIDER ??= \u0026#34;grub-efi\u0026#34; SYSVINIT_SCRIPTS = \u0026#34;${@bb.utils.contains(\u0026#39;MACHINE_FEATURES\u0026#39;, \u0026#39;rtc\u0026#39;, \u0026#39;${VIRTUAL-RUNTIME_base-utils-hwclock}\u0026#39;, \u0026#39;\u0026#39;, d)} \\ modutils-initscripts \\ init-ifupdown \\ ${VIRTUAL-RUNTIME_initscripts} \\ \u0026#34; RDEPENDS:${PN} = \u0026#34;\\ base-files \\ base-passwd \\ ${VIRTUAL-RUNTIME_base-utils} \\ ${@bb.utils.contains(\u0026#34;DISTRO_FEATURES\u0026#34;, \u0026#34;sysvinit\u0026#34;, \u0026#34;${SYSVINIT_SCRIPTS}\u0026#34;, \u0026#34;\u0026#34;, d)} \\ ${@bb.utils.contains(\u0026#34;MACHINE_FEATURES\u0026#34;, \u0026#34;keyboard\u0026#34;, \u0026#34;${VIRTUAL-RUNTIME_keymaps}\u0026#34;, \u0026#34;\u0026#34;, d)} \\ ${@bb.utils.contains(\u0026#34;MACHINE_FEATURES\u0026#34;, \u0026#34;efi\u0026#34;, \u0026#34;${EFI_PROVIDER} kernel\u0026#34;, \u0026#34;\u0026#34;, d)} \\ netbase \\ ${VIRTUAL-RUNTIME_login_manager} \\ ${VIRTUAL-RUNTIME_init_manager} \\ ${VIRTUAL-RUNTIME_dev_manager} \\ ${VIRTUAL-RUNTIME_update-alternatives} \\ ${MACHINE_ESSENTIAL_EXTRA_RDEPENDS}\u0026#34; RRECOMMENDS:${PN} = \u0026#34;\\ ${VIRTUAL-RUNTIME_base-utils-syslog} \\ ${MACHINE_ESSENTIAL_EXTRA_RRECOMMENDS}\u0026#34; å¼€å¤´çš„PRæ˜¯recipeæ–‡ä»¶æœ¬èº«çš„ç‰ˆæœ¬å·ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œé»˜è®¤å€¼å°±æ˜¯â€œr0â€ã€‚inherit packagegroupè¡¨ç¤ºç»§æ‰¿packagegroup.bbclassä¸­çš„æ–¹æ³•ï¼Œbitbake ä¼šåœ¨BBPATHæŒ‡å®šçš„è·¯å¾„ä¸­å¯»æ‰¾ packagegroup.bbclassæ–‡ä»¶ï¼Œinheritæ˜¯ç”¨äºç»§æ‰¿.bbå’Œ.bbclassæ–‡ä»¶çš„è¯­æ³•ï¼Œæ”¯æŒç»§æ‰¿å¤šä¸ªæ–‡ä»¶å’Œä½¿ç”¨å˜é‡ã€‚å¦‚æœè¦ç»§æ‰¿å…¶ä»–ç±»å‹çš„æ–‡ä»¶ï¼Œæ¨èç”¨includeæˆ–requireè¯­æ³•ï¼ŒäºŒè€…çš„ä½œç”¨ç±»ä¼¼ï¼Œä¸»è¦åŒºåˆ«æ˜¯ï¼Œå¦‚æœæ‰¾ä¸åˆ°æŒ‡å®šæ–‡ä»¶ï¼Œrequireä¼šæŠ¥é”™ï¼Œè€Œincludeä¸ä¼šã€‚æ›´å¤šå…±äº«é€šç”¨åŠŸèƒ½çš„æ–¹æ³•å¯ä»¥å‚è€ƒSharing Functionalityã€‚\næ–‡ä»¶é‡Œæ²¡æœ‰è®¾ç½®SRC_URIæˆ–è€…FILESç­‰å˜é‡ï¼Œä¹Ÿæ²¡æœ‰å®šä¹‰do_compileç­‰ä»»åŠ¡ï¼Œæ‰€ä»¥å®ƒä¸ä¼šæ‰§è¡Œç¼–è¯‘ï¼Œå®‰è£…å’Œæ‰“åŒ…ç­‰ä»»åŠ¡ã€‚å…³é”®æ˜¯RDEPENDS å’ŒRRECOMMENDSå˜é‡ï¼š\nRDEPENDSçš„ä½œç”¨æ˜¯åˆ—å‡ºè½¯ä»¶åŒ…çš„è¿è¡Œæ—¶ä¾èµ–é¡¹ï¼Œè¿™é‡Œåˆ—å‡ºçš„è½¯ä»¶åŒ…ä¹Ÿä¼šå®‰è£…åˆ°imageï¼Œå¦‚æœè¿™äº›ä¾èµ–é¡¹å‡ºé”™ï¼Œä¼šå½±å“æ•´ä¸ªæ„å»ºæµç¨‹ã€‚ä¾‹å¦‚RDEPENDS:foo = \u0026quot;bar baz\u0026quot;è¡¨ç¤ºè½¯ä»¶åŒ…fooéœ€è¦å®‰è£…è½¯ä»¶åŒ…barå’Œbazã€‚bitbakeä¼šè‡ªåŠ¨æ£€æµ‹å’Œæ·»åŠ å¸¸è§çš„è½¯ä»¶åŒ…ä¾èµ–å…³ç³»ï¼Œæ‰€ä»¥ï¼Œå¤šæ•°recipeä¸éœ€è¦è®¾ç½® RDEPENDSã€‚æ›´å¤šä¿¡æ¯è¯·å‚è€ƒAutomatically Added Runtime Dependenciesã€‚ RRECOMMENDSçš„ä½œç”¨æ˜¯åˆ—å‡ºè½¯ä»¶åŒ…çš„è¿è¡Œæ—¶åŠŸèƒ½æ‰©å±•é¡¹ï¼Œå®ƒä»¬ä¸æœ¬è½¯ä»¶åŒ…æ˜¯è½¯æ€§ä¾èµ–å…³ç³»ï¼Œå¯ä»¥æ‰©å±•æœ¬è½¯ä»¶åŒ…çš„å¯ç”¨æ€§ï¼Œä½†ä¸æ˜¯æ„å»ºçš„å¿…è¦æ¡ä»¶ã€‚å¦‚æœå­˜åœ¨å°±ç¼–è¯‘å®‰è£…ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œä¹Ÿä¸ä¼šå½±å“æœ¬è½¯ä»¶çš„æ„å»ºè¿‡ç¨‹ã€‚ é€šè¿‡RDEPENDS å’ŒRRECOMMENDSå˜é‡å®‰è£…çš„è½¯ä»¶åŒ…ï¼Œä¸èƒ½ç›´æ¥åœ¨IMAGE_INSTALLå˜é‡ä¸­æ¸…é™¤ï¼Œå¯ä»¥ä½¿ç”¨.bbappendæ–‡ä»¶ä¿®æ”¹ç›¸åº”å˜é‡ï¼Œæˆ–è€…åœ¨PACKAGE_EXCLUDEå˜é‡ä¸­åˆ—å‡ºç¦æ­¢å®‰è£…åˆ°imageçš„è½¯ä»¶åŒ…ï¼Œéœ€è¦æ³¨æ„å¤„ç†ç ´åä¾èµ–å…³ç³»è€Œå¯¼è‡´çš„é”™è¯¯ã€‚\nè¿™é‡Œæ¶‰åŠåˆ°ä¸€ä¸ªé‡è¦çš„å‡½æ•°bb.utils.contains()ï¼Œç”±utils.bbclassæä¾›ï¼Œè¯­æ³•æ˜¯ï¼š\nV = \u0026#34;${@bb.utils.contains(\u0026#39;val\u0026#39;, \u0026#39;a\u0026#39;, \u0026#39;1\u0026#39;, \u0026#39;2\u0026#39;, d)}\u0026#34; å®ƒçš„ä½œç”¨æ˜¯ï¼Œå¦‚æœå˜é‡ val ä¸­åŒ…å«äº† a ï¼Œå°±è¿”å› 1 ï¼Œå¦åˆ™è¿”å› 2 ã€‚ä¾‹å¦‚ä¸Šé¢çš„ï¼š\n${@bb.utils.contains(\u0026#34;DISTRO_FEATURES\u0026#34;, \u0026#34;sysvinit\u0026#34;, \u0026#34;${SYSVINIT_SCRIPTS}\u0026#34;, \u0026#34;\u0026#34;, d)} \\ ${@bb.utils.contains(\u0026#34;MACHINE_FEATURES\u0026#34;, \u0026#34;keyboard\u0026#34;, \u0026#34;${VIRTUAL-RUNTIME_keymaps}\u0026#34;, \u0026#34;\u0026#34;, d)} \\ å¦‚æœDISTRO_FEATURESä¸­åŒ…å«äº†sysvinit ï¼Œå°±è¿”å›${SYSVINIT_SCRIPTS}ã€‚ç±»ä¼¼çš„*_FEATURESè¿˜æœ‰MACHINE_FEATURESï¼ŒIMAGE_FEATURESï¼ŒEXTRA_IMAGE_FEATURESç­‰ï¼Œå®ƒä»¬çš„å€¼éƒ½ä¼šé€šè¿‡è¿™ç§æ–¹å¼å½±å“å®‰è£…åˆ°imageçš„è½¯ä»¶åŒ…ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨conf/local.confæˆ–è€…\u0026lt;image\u0026gt;.bbappendæ–‡ä»¶ä¸­ä¿®æ”¹è¿™äº›å˜é‡ã€‚æ›´å¤šä¿¡æ¯å¯ä»¥å‚è€ƒFeaturesã€‚\nè¦ç¡®å®šå“ªäº›recipeä¼šæ£€æŸ¥æŸä¸ªç‰¹æ€§ï¼Œå¯ä»¥ç”¨grepå‘½ä»¤æŸ¥æ‰¾ï¼Œä¾‹å¦‚æŸ¥æ‰¾bluetoothçš„ç›¸å…³ç‰¹æ€§ï¼š\n$ cd poky/ $ grep -rn \u0026#39;contains.*MACHINE_FEATURES.*bluetooth\u0026#39; ./* $ grep -rn \u0026#39;contains.*DISTRO_FEATURES.*bluetooth\u0026#39; ./* 4.6 ç”ŸæˆSDK #æ‰§è¡Œbitbake [image] -c do_populate_sdkå¯ä»¥ç”Ÿæˆç›¸åº”imageçš„SDKï¼ŒåŒ…å«äº†å·¥å…·é“¾å’Œç¼–è¯‘åº“ç­‰ï¼š\n$ bitbake core-image-minimal -c do_populate_sdk ç”Ÿæˆçš„SDKå®‰è£…è„šæœ¬ä½äºtmp/deploy/sdkè·¯å¾„ä¸‹ï¼Œæ‰§è¡Œåé»˜è®¤å®‰è£…åˆ°/opt/poky/4.0.12è·¯å¾„ï¼š\n$ ls poky-glibc-x86_64-core-image-minimal-core2-64-qemux86-64-toolchain-4.0.12.host.manifest poky-glibc-x86_64-core-image-minimal-core2-64-qemux86-64-toolchain-4.0.12.sh poky-glibc-x86_64-core-image-minimal-core2-64-qemux86-64-toolchain-4.0.12.target.manifest poky-glibc-x86_64-core-image-minimal-core2-64-qemux86-64-toolchain-4.0.12.testdata.json $ ./poky-glibc-x86_64-core-image-minimal-core2-64-qemux86-64-toolchain-4.0.12.sh Poky (Yocto Project Reference Distro) SDK installer version 4.0.12 ================================================================== Enter target directory for SDK (default: /opt/poky/4.0.12): You are about to install the SDK to \u0026#34;/opt/poky/4.0.12\u0026#34;. Proceed [Y/n]? [sudo] password for lsc: Extracting SDK........................................................done Setting it up...done SDK has been successfully set up and is ready to be used. Each time you wish to use the SDK in a new shell session, you need to source the environment setup script e.g. $ . /opt/poky/4.0.12/environment-setup-core2-64-poky-linux ä¸»è¦åŒ…æ‹¬å¦‚ä¸‹æ–‡ä»¶ï¼š\n$ tree -L 2 . â”œâ”€â”€ environment-setup-core2-64-poky-linux â”œâ”€â”€ site-config-core2-64-poky-linux â”œâ”€â”€ sysroots â”‚ â”œâ”€â”€ core2-64-poky-linux â”‚ â””â”€â”€ x86_64-pokysdk-linux â””â”€â”€ version-core2-64-poky-linux environment-setup-core2-64-poky-linux æ˜¯åˆå§‹åŒ–SDKç¯å¢ƒçš„è„šæœ¬ x86_64-pokysdk-linuxæ˜¯å®¿ä¸»æœºçš„å¼€å‘ç¯å¢ƒï¼ŒåŒ…å«äº†äº¤å‰ç¼–è¯‘å·¥å…·é“¾ï¼Œå’Œè¿è¡ŒSDKéœ€è¦çš„å„ç§åº“ã€‚ core2-64-poky-linuxæ˜¯ç›®æ ‡æœºçš„è¿è¡Œç¯å¢ƒï¼ŒåŒ…å«äº†ç¼–è¯‘é“¾æ¥çš„åº“å’Œå¤´æ–‡ä»¶ç­‰ã€‚ ä½¿ç”¨æ—¶ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤åˆå§‹åŒ–SDKä½¿ç”¨ç¯å¢ƒï¼š\n$ . /opt/poky/4.0.12/environment-setup-core2-64-poky-linux $ echo ${CC} x86_64-poky-linux-gcc -m64 -march=core2 -mtune=core2 -msse3 -mfpmath=sse -fstack-protector-strong -O2 -D_FORTIFY_SOURCE=2 -Wformat -Wformat-security -Werror=format-security --sysroot=/opt/poky/4.0.12/sysroots/core2-64-poky-linux ä¸€äº›å…³é”®çš„å˜é‡ï¼š\nCC=x86_64-poky-linux-gcc -m64 -march=core2 -mtune=core2 -msse3 -mfpmath=sse -fstack-protector-strong -O2 -D_FORTIFY_SOURCE=2 -Wformat -Wformat-security -Werror=format-security --sysroot=/opt/poky/4.0.12/sysroots/core2-64-poky-linux CFLAGS= -O2 -pipe -g -feliminate-unused-debug-types CXX=x86_64-poky-linux-g++ -m64 -march=core2 -mtune=core2 -msse3 -mfpmath=sse -fstack-protector-strong -O2 -D_FORTIFY_SOURCE=2 -Wformat -Wformat-security -Werror=format-security --sysroot=/opt/poky/4.0.12/sysroots/core2-64-poky-linux CXXFLAGS= -O2 -pipe -g -feliminate-unused-debug-types LD=x86_64-poky-linux-ld --sysroot=/opt/poky/4.0.12/sysroots/core2-64-poky-linux LDFLAGS=-Wl,-O1 -Wl,--hash-style=gnu -Wl,--as-needed -Wl,-z,relro,-z,now ç„¶åç¼–è¯‘ï¼š\n$ ${CC} hello.c -o helle 4.7 åº”ç”¨å¼€å‘å’Œè°ƒè¯• #å‚è€ƒDebugging With the GNU Project Debugger (GDB) Remotelyã€‚\nç³»ç»Ÿçš„DISTRO_FEATURESå˜é‡é»˜è®¤å·²ç»åŒ…å«äº†debuginfodç‰¹æ€§ï¼Œè¿™ä¸ªç‰¹æ€§ä¼šä½¿gdbä½¿èƒ½debuginfodç‰¹æ€§ï¼š\n# recipes-devtools/gdb/gdb-common.inc PACKAGECONFIG ??= \u0026#34;readline ${@bb.utils.filter(\u0026#39;DISTRO_FEATURES\u0026#39;, \u0026#39;debuginfod\u0026#39;, d)}\u0026#34; PACKAGECONFIG[debuginfod] = \u0026#34;--with-debuginfod, --without-debuginfod, elfutils\u0026#34; è¿™é‡Œæ¶‰åŠåˆ°ä¸€ä¸ªé‡è¦çš„å‡½æ•°bb.utils.filter()ï¼Œç”±utils.bbclassæä¾›ï¼Œè¯­æ³•æ˜¯ï¼š\nbb.utils.filter(\u0026#39;variable\u0026#39;, \u0026#39;checkvalue\u0026#39;, d)} å®ƒçš„ä½œç”¨æ˜¯æ£€æŸ¥${variable}ä¸­æ˜¯å¦åŒ…å«å­—ç¬¦ä¸²'checkvalue'ï¼ŒæˆåŠŸåˆ™è¿”å›'checkvalue'ï¼Œå¦åˆ™è¿”å›ç©ºã€‚æ‰€ä»¥ï¼Œç¬¬ä¸€è¡ŒPACKAGECONFIGå˜é‡çš„å€¼æ˜¯readline debuginfodã€‚ç¬¬äºŒè¡Œåˆ©ç”¨äº†bitbakeçš„Variable Flagè¯­æ³•ï¼Œå¯ä»¥å½±å“PACKAGECONFIG_CONFARGSå’ŒDEPENDSå˜é‡çš„å€¼ï¼Œè¿™é‡Œçš„å«ä¹‰æ˜¯ï¼š\nå¦‚æœPACKAGECONFIGä¸­å®šä¹‰äº†debuginfodï¼Œåˆ™å‘PACKAGECONFIG_CONFARGSæ·»åŠ --with-debuginfodã€‚ å¦‚æœPACKAGECONFIGæ²¡æœ‰å®šä¹‰debuginfodï¼Œåˆ™å‘PACKAGECONFIG_CONFARGSæ·»åŠ --without-debuginfodã€‚ å¦‚æœPACKAGECONFIGä¸­å®šä¹‰äº†debuginfodï¼Œåˆ™å‘DEPENDSä¸­æ·»åŠ elfutilsã€‚ ä½¿ç”¨æ–¹æ³•å°±å¾ˆç®€å•äº†ï¼Œåœ¨å®¿ä¸»æœºä¸Šæ‰§è¡Œoe-debuginfodå‘½ä»¤å¯åŠ¨debuginfod serverï¼Œåœ¨ç›®æ ‡æœºä¸Šè®¾ç½®æœåŠ¡å™¨åœ°å€ï¼š\nroot@qemux86-64:~# export DEBUGINFOD_URLS=\u0026#34;http://192.168.7.1:8002/\u0026#34; ç„¶åå¯ä»¥ç”¨gdb, readelf æˆ–è€… objdumpä¸debuginfod serverå»ºç«‹è¿æ¥ï¼Œè·å–è°ƒè¯•ä¿¡æ¯ï¼š\nroot@qemux86-64:~# gdb /bin/cat ... Reading symbols from /bin/cat... Downloading separate debug info for /bin/cat... Reading symbols from /home/root/.cache/debuginfod_client/923dc4780cfbc545850c616bffa884b6b5eaf322/debuginfo... 5. å†…æ ¸å¼€å‘ #å†…æ ¸å¼€å‘çš„è¯¦ç»†å†…å®¹å¯ä»¥å‚è€ƒ Yocto Project Linux Kernel Development Manualã€‚pokyçš„å†…æ ¸recipeæ–‡ä»¶æ˜¯meta/recipes-kernel/linux/linux-yocto_5.15.bbã€‚\n5.1 æ·»åŠ å¤–éƒ¨æ¨¡å— #è„±ç¦»å†…æ ¸æºç æ ‘ï¼Œç‹¬ç«‹å­˜åœ¨çš„å†…æ ¸æ¨¡å—ï¼Œå¯ä»¥åƒè½¯ä»¶åŒ…ä¸€æ ·æ·»åŠ åˆ°imageä¸­ï¼Œpoky/meta-skeleton/recipes-kernel/hello-modæ˜¯ä¸€ä¸ªç®€å•å®ä¾‹ï¼Œæˆ‘ä»¬å‚è€ƒè¿™ä¸ªå‘ç³»ç»Ÿæ·»åŠ ä¸€ä¸ªå†…æ ¸æ¨¡å—ã€‚\nåœ¨meta-mylayeræ–°å»ºrecipes-kernel/hello-modæ–‡ä»¶å¤¹ï¼Œæ·»åŠ å¦‚ä¸‹æ–‡ä»¶ï¼š\n$ tree hello-mod hello-mod â”œâ”€â”€ files â”‚ â””â”€â”€ hello-mod â”‚ â”œâ”€â”€ COPYING â”‚ â”œâ”€â”€ Makefile â”‚ â””â”€â”€ hello.c â””â”€â”€ hello-mod_0.1.bb 2 directories, 4 files files/hello-modè·¯å¾„ä¸‹å°±æ˜¯å†…æ ¸æ¨¡å—çš„æºç ï¼Œéœ€è¦æ³¨æ„Makefileçš„å†™æ³•ï¼š\nobj-m := hello.o SRC := $(shell pwd) all: $(MAKE) -C $(KERNEL_SRC) M=$(SRC) modules_install: $(MAKE) -C $(KERNEL_SRC) M=$(SRC) modules_install clean: rm -f *.o *~ core .depend .*.cmd *.ko *.mod.c rm -f Module.markers Module.symvers modules.order rm -rf .tmp_versions Modules.symvers hello-mod_0.1.bbçš„å†…å®¹ï¼š\nSUMMARY = \u0026#34;Example of how to build an external Linux kernel module\u0026#34; DESCRIPTION = \u0026#34;${SUMMARY}\u0026#34; LICENSE = \u0026#34;GPL-2.0-only\u0026#34; LIC_FILES_CHKSUM = \u0026#34;file://COPYING;md5=12f884d2ae1ff87c09e5b7ccc2c4ca7e\u0026#34; inherit module SRC_URI = \u0026#34;file://hello-mod\u0026#34; S = \u0026#34;${WORKDIR}/hello-mod\u0026#34; LIC_FILES_CHKSUMæ˜¯Licenseæ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„å’Œæ ¡éªŒå’Œï¼Œéœ€è¦æ³¨æ„ç›¸å¯¹è·¯å¾„æ˜¯æŒ‡ç›¸å¯¹${S}ã€‚SRC_URIè®¾ç½®äº†æºç è·¯å¾„ï¼Œå› ä¸ºæºç æ”¾åœ¨æœ¬åœ°çš„files/hello-modè·¯å¾„ä¸‹ï¼Œæ‰€ä»¥æŒ‡è®¾ç½®ä¸€ä¸ªæ–‡ä»¶å¤¹åç§°å³å¯ã€‚inherit moduleè¡¨ç¤ºç»§æ‰¿module.bbclassçš„ç›¸å…³ä»»åŠ¡ï¼Œå®ƒä¼šè‡ªåŠ¨ä½¿ç”¨kernel-module-å‰ç¼€å‘½åè½¯ä»¶å®‰è£…åŒ…ï¼Œç”Ÿæˆçš„è½¯ä»¶åŒ…æ˜¯kernel-module-hello-5.15.120-yocto-standard-0.1-r0.qemux86_64.rpmï¼š\n$ ls deploy-rpms/qemux86_64/ hello-mod-0.1-r0.qemux86_64.rpm hello-mod-dbg-0.1-r0.qemux86_64.rpm hello-mod-dev-0.1-r0.qemux86_64.rpm kernel-module-hello-5.15.120-yocto-standard-0.1-r0.qemux86_64.rpm ç„¶ååœ¨core-image-minimal.bbappendä¸­å°†æ¨¡å—æ·»åŠ åˆ°imageï¼š\nIMAGE_INSTALL:append = \u0026#34; hello-mod\u0026#34; æ¨¡å—å®‰è£…åœ¨/lib/modules/5.15.120-yocto-standard/extra/è·¯å¾„ä¸‹ã€‚å¯åŠ¨è™šæ‹ŸæœºåéªŒè¯åŠ è½½å¸è½½ï¼š\n5.2 ä¿®æ”¹å†…æ ¸æºç  #ä¿®æ”¹å†…æ ¸æºç æ ‘çš„æ–¹æ³•æœ‰å¾ˆå¤šï¼Œè¿™é‡Œæ¨èç”¨gitç”Ÿäº§æºç è¡¥ä¸ï¼Œå†æ·»åŠ éƒ½recipeä¸­ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ã€‚\næ‰¾åˆ°å†…æ ¸æºç çš„è·¯å¾„${S}ï¼Œä¿®æ”¹init/calibrate.cæ–‡ä»¶ï¼Œåœ¨calibrate_delay()å‡½æ•°æ·»åŠ å‡ è¡Œæ‰“å°å¯åŠ¨ä¿¡æ¯ï¼š\nvoid calibrate_delay(void) { unsigned long lpj; static bool printed; int this_cpu = smp_processor_id(); printk(\u0026#34;*************************************\\n\u0026#34;); printk(\u0026#34;* *\\n\u0026#34;); printk(\u0026#34;* HELLO YOCTO KERNEL *\\n\u0026#34;); printk(\u0026#34;* *\\n\u0026#34;); printk(\u0026#34;*************************************\\n\u0026#34;); if (per_cpu(cpu_loops_per_jiffy, this_cpu)) { ... } ä¿å­˜åä½¿ç”¨gitæäº¤ï¼Œå¹¶å¯¹æ­¤æ¬¡ä¿®æ”¹ç”Ÿäº§ä¸€ä¸ªè¡¥ä¸ï¼Œè¡¥ä¸æ–‡ä»¶è‡ªåŠ¨å‘½åä¸º0001-feat-add-boot-message.patchï¼š\n$ git add init/calibrate.c $ git commit -m \u0026#34;feat:add boot message\u0026#34; $ git format-patch -1 0001-feat-add-boot-message.patch åœ¨meta-mylayer/recipes-kernelä¸‹æ–°å»ºlinuxæ–‡ä»¶å¤¹ï¼Œå‡†å¤‡å¦‚ä¸‹æ–‡ä»¶ï¼š\n$ tree linux/ linux/ â”œâ”€â”€ linux-yocto â”‚ â””â”€â”€ 0001-feat-add-boot-message.patch â””â”€â”€ linux-yocto_%.bbappend 1 directory, 2 files æŠŠå‰é¢ç”Ÿæˆçš„è¡¥ä¸æ–‡ä»¶æ”¾åˆ°äº†linux-yoctoç›®å½•ä¸‹ï¼Œlinux-yocto_%.bbappendæ–‡ä»¶åä¸­çš„ç™¾åˆ†å·%æ˜¯é€šé…ç¬¦ï¼Œè¡¨ç¤ºè¿™ä¸ªappendæ–‡ä»¶å¯ä»¥åŒ¹é…ä»»ä½•å‰ç¼€linux-yocto_çš„recipeæ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\nFILESEXTRAPATHS:prepend := \u0026#34;${THISDIR}/${PN}:\u0026#34; SRC_URI:append = \u0026#34; file://0001-feat-add-boot-message.patch\u0026#34; FILESEXTRAPATHSå˜é‡æ˜¯å‘Šè¯‰bitbakeæŸ¥æ‰¾æ–‡ä»¶å’Œè¡¥ä¸çš„æœç´¢è·¯å¾„ï¼Œè¿™é‡ŒæŠŠ./linux-yoctoä¹ŸåŠ è¿›å»ï¼Œå› ä¸ºè¡¥ä¸æ–‡ä»¶å­˜æ”¾åœ¨è¿™é‡Œï¼Œä¸‹é¢å‘SRC_URIæ·»åŠ è¡¥ä¸æ–‡ä»¶æ˜¯ï¼Œå°±æ˜¯ç›¸å¯¹è¿™é‡Œçš„è·¯å¾„ã€‚bitbakeåœ¨æ‰§è¡Œpatchä»»åŠ¡æ—¶ï¼Œä¼šè‡ªåŠ¨åˆ¤æ–­æ–‡ä»¶ç±»å‹ï¼Œç„¶åæŠŠè¡¥ä¸åˆå¹¶åˆ°æºç ä¸­ï¼Œå¯ä»¥å•ç‹¬æ‰§è¡Œpatchä»»åŠ¡ï¼Œç¡®è®¤è¡¥ä¸æ˜¯å¦åˆå¹¶æˆåŠŸã€‚æœ€åä¾æ¬¡æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ç”Ÿäº§æ–°çš„å†…æ ¸å’Œç³»ç»Ÿé•œåƒï¼š\n$ bitbake linux-yocto -c cleansstate $ bitbake linux-yocto $ bitbake core-image-minimal -c cleanall $ bitbake core-image-minimal å¯åŠ¨è™šæ‹Ÿæœºå¯ä»¥çœ‹åˆ°æ·»åŠ çš„å¯åŠ¨ä¿¡æ¯ï¼š\n5.3 ä¿®æ”¹å†…æ ¸é…ç½® #å•ç‹¬ç¼–è¯‘å†…æ ¸æ—¶ï¼Œæ ‡å‡†åšæ³•æ˜¯æ‰§è¡Œmake menuconfigå‘½ä»¤ä¿®æ”¹é…ç½®ï¼Œbitbakeä¹Ÿå¯ä»¥æ‰§è¡Œç›¸åº”çš„do_menuconfigä»»åŠ¡ï¼Œæ‰“å¼€å†…æ ¸çš„é…ç½®ç•Œé¢ï¼š\n$ bitbake linux-yocto -c menuconfig è¿™é‡Œçš„é…ç½®æ¥è‡ªäº${B}/.configæ–‡ä»¶ï¼Œå®ƒæ˜¯ç”±ä¸Šä¸€ä¸ªä»»åŠ¡do_kernel_configmeé›†åˆå¤šä¸ªé…ç½®ç‰‡æ®µè€Œæˆçš„ï¼Œè¯¦ç»†æƒ…å†µç¨åå†è®²ã€‚è¿™é‡Œæˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹CONFIG_DEFAULT_HOSTNAMEé…ç½®ï¼š\nç„¶åä¿å­˜å¹¶é€€å‡ºã€‚åœ¨ç¼–è¯‘ç›®å½•${B}ä¸‹é¢ä¼šç”Ÿæˆæ›´æ–°åçš„ .config æ–‡ä»¶ï¼ŒåŸæœ‰çš„ .config è¢«é‡å‘½åä¸º .config.old ï¼Œå¯¹æ¯”ä¸€ä¸‹äºŒè€…çš„å·®å¼‚ï¼š\n$ diff -u .config.old .config --- .config.old 2023-11-20 16:46:10.061458785 +0800 +++ .config 2023-11-20 17:01:28.021316267 +0800 @@ -16,7 +16,7 @@ CONFIG_CC_HAS_ASM_GOTO_TIED_OUTPUT=y CONFIG_CC_HAS_ASM_INLINE=y CONFIG_CC_HAS_NO_PROFILE_FN_ATTR=y -CONFIG_PAHOLE_VERSION=0 +CONFIG_PAHOLE_VERSION=121 CONFIG_IRQ_WORK=y CONFIG_BUILDTIME_TABLE_SORT=y CONFIG_THREAD_INFO_IN_TASK=y @@ -45,7 +45,7 @@ # CONFIG_KERNEL_LZ4 is not set # CONFIG_KERNEL_ZSTD is not set CONFIG_DEFAULT_INIT=\u0026#34;\u0026#34; -CONFIG_DEFAULT_HOSTNAME=\u0026#34;(none)\u0026#34; +CONFIG_DEFAULT_HOSTNAME=\u0026#34;lsc-yocto\u0026#34; CONFIG_SWAP=y CONFIG_SYSVIPC=y CONFIG_SYSVIPC_SYSCTL=y ç„¶åè°ƒç”¨ diffconfigä»»åŠ¡ï¼Œå®ƒä¼šå¯¹æ¯” .config å’Œ .config.old ï¼Œç¡®å®šä¿®æ”¹çš„å†…å®¹ï¼Œç”Ÿæˆä¸€ä¸ªè¡¥ä¸æ–‡ä»¶ï¼Œç§°ä¹‹ä¸ºé…ç½®ç‰‡æ®µï¼š\n$ bitbake linux-yocto -c diffconfig ... Config fragment has been dumped into: /home/lsc/yocto-kirkstone/x86_build/tmp/work/qemux86_64-poky-linux/linux-yocto/5.15.120+gitAUTOINC+820b9bdb19_74c80e559b-r0/fragment.cfg ç”Ÿæˆçš„é…ç½®ç‰‡æ®µæ–‡ä»¶æ˜¯ä½äº${WORKDIR}ç›®å½•ä¸‹çš„ fragment.cfg ã€‚æŠŠè¿™ä¸ªæ–‡ä»¶å¤åˆ¶åˆ° meta-mylayer/recipes-kernel/linux/linux-yocto ç›®å½•ä¸‹ï¼Œç„¶ååœ¨ linux-yocto_%.bbappend æ–‡ä»¶ä¸­æ·»åŠ ä¸€è¡Œï¼š\nSRC_URI:append = \u0026#34; file://fragment.cfg\u0026#34; å¯ä»¥ä¸ºfragment.cfgæ›´æ”¹ä¸€ä¸ªæœ‰æ„ä¹‰çš„æ–‡ä»¶åï¼Œå› ä¸ºé€šå¸¸ä¼šä½¿ç”¨å¤šä¸ªé…ç½®ç‰‡æ®µæ¥æ·»åŠ ä¸åŒç±»å‹çš„ä¿®æ”¹å†…å®¹ï¼Œæ¸…é™¤åé‡æ–°ç¼–è¯‘ï¼Œå¯ä»¥è°ƒç”¨ kernel_configcheck ä»»åŠ¡æ£€æŸ¥å†…æ ¸é…ç½®æ˜¯å¦æ­£ç¡®ï¼š\n$ bitbake linux-yocto -c cleansstate $ bitbake linux-yocto -c kernel_configcheck $ bitbake linux-yocto è¿™é‡Œè¦æ³¨æ„å‡ ä¸ªä»»åŠ¡çš„æ‰§è¡Œé¡ºåºï¼š\ndo_patchä»»åŠ¡ä¼šæŠŠ.patchæ–‡ä»¶åº”ç”¨åˆ°æºç ä¸Šã€‚ do_kernel_configmeä»»åŠ¡è´Ÿè´£å°†defconfigå’Œå„ç§é…ç½®ç‰‡æ®µåˆå¹¶ä¸º.configã€‚ do_configureä»»åŠ¡æ˜¯æ‰§è¡Œå†…æ ¸é…ç½®å·¥ä½œï¼Œdo_menuconfigä¹Ÿæ˜¯åœ¨è¿™ä¸ªä»»åŠ¡ä¹‹åã€‚ åœ¨menuconfigä¸­ä¿®æ”¹å®Œé…ç½®ï¼Œå¦‚æœæ²¡æœ‰æ¸…é™¤ç›´æ¥ç¼–è¯‘ï¼Œåé¢çš„ä»»åŠ¡æ˜¯ç»§ç»­è¿›è¡Œï¼Œè€Œä¸æ˜¯ä»å¤´å¼€å§‹ï¼Œä¸ä¼šåº”ç”¨recipesæ–‡ä»¶ä¸­æ·»åŠ çš„é…ç½®ç‰‡æ®µï¼Œè¿™æ ·è°ƒè¯•æ²¡æœ‰é—®é¢˜ï¼Œå¦‚æœæƒ³è¦ä½¿é…ç½®ç‰‡æ®µç”Ÿæ•ˆï¼Œè¿˜æ˜¯è¦æ‰§è¡Œdo_cleansstateä»»åŠ¡åé‡æ–°å¼€å§‹ã€‚\ndo_kernel_configmeä»»åŠ¡å®šä¹‰åœ¨poky/meta/classes/kernel-yocto.bbclassæ–‡ä»¶ä¸­ï¼Œå®ƒåˆ©ç”¨äº†Linux å†…æ ¸æºç çš„/scripts/kconfig/merge_config.sh è„šæœ¬æ¥å®Œæˆåˆå¹¶é…ç½®ï¼Œè„šæœ¬çš„è¯­æ³•å¦‚ä¸‹ï¼š\n$ ./merge_config.sh -h Usage: ./merge_config.sh [OPTIONS] [CONFIG [...]] -h display this help text -m only merge the fragments, do not execute the make command -n use allnoconfig instead of alldefconfig -r list redundant entries when merging fragments -y make builtin have precedence over modules -O dir to put generated output files. Consider setting $KCONFIG_CONFIG instead. Used prefix: \u0026#39;CONFIG_\u0026#39;. You can redefine it with $CONFIG_ environment variable. å¾ˆå¤šæƒ…å†µä¸‹ï¼Œç¬¬ä¸‰æ–¹å‘å¸ƒçš„BSPä¼šé‡å†™è¿™ä¸ªä»»åŠ¡ï¼Œä½†æ˜¯åŸºæœ¬åŸç†æ˜¯ä¸€æ ·çš„ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨å†…æ ¸çš„ .bbappend æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ªç±»ä¼¼çš„ä»»åŠ¡ï¼Œè®©å®ƒåœ¨ç¼–è¯‘å‰åˆ©ç”¨ merge_config.sh è„šæœ¬åˆå¹¶é…ç½®ç‰‡æ®µï¼Œä¾‹å¦‚ï¼š\ndo_merge_fragment() { if [ -f ${WORKDIR}/fragment.cfg ]; then ${S}/scripts/kconfig/merge_config.sh -m ${B}/.config ${WORKDIR}/fragment.cfg mv .config ${B}/.config fi } addtask merge_fragment before do_compile after do_configure 5.4 è®¾ç½®defconfig #æˆ‘ä»¬å•ç‹¬ç¼–è¯‘x86æ¶æ„çš„å†…æ ¸æ—¶ï¼Œé€šå¸¸æ˜¯ç›´æ¥æ‰§è¡Œmake defconfigï¼Œå†…æ ¸çš„Makefileä¼šæ ¹æ®ä¸»æœºçš„uname -mä¿¡æ¯ï¼Œåœ¨arch/x86/configs/ä¸‹æ‰¾åˆ°ç›¸åº”çš„é…ç½®æ–‡ä»¶ã€‚å¦‚æœæ˜¯armæ¶æ„ï¼Œé€šå¸¸è¦æŒ‡å®šä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼ŒMakefileä¼šåœ¨arch/${ARCH}/configs/è·¯å¾„ä¸‹çš„æœç´¢ï¼Œä¾‹å¦‚ï¼š\n$ make imx_v8_defconfig åœ¨yoctoä¸­ï¼Œå¯ä»¥é€šè¿‡KBUILD_DEFCONFIGå˜é‡è®¾ç½®defconfigï¼Œbitbakeä¼šæŠŠ${KBUILD_DEFCONFIG}å’Œå…¶ä»–é…ç½®ç‰‡æ®µåˆå¹¶ä¸º.configæ–‡ä»¶ã€‚æˆ‘ä»¬åœ¨ linux-yocto_%.bbappend æ–‡ä»¶ä¸­æ·»åŠ ä¸€è¡Œï¼š\nKBUILD_DEFCONFIG = \u0026#34;x86_64_defconfig\u0026#34; é‡æ–°ç¼–è¯‘å†…æ ¸ï¼Œä¼šå‘ç°${WORKDIR}ç›®å½•ä¸‹å¤šäº†ä¸€ä¸ªdefconfigæ–‡ä»¶ï¼Œè¿™æ˜¯\narch/x86/configs/x86_64_defconfigæ–‡ä»¶çš„æ‹·è´ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ›å»ºè‡ªå·±çš„defconfigï¼Œåœ¨linux-yocto_%.bbappend æ–‡ä»¶ä¸­é€šè¿‡SRC_URIæ·»åŠ ï¼š\nSRC_URI += \u0026#34;file://defconfig\u0026#34; é€šè¿‡SRC_URIæ·»åŠ çš„defconfigæ¯”${KBUILD_DEFCONFIG}çš„ä¼˜å…ˆçº§é«˜ï¼Œåœ¨do_kernel_configmeä»»åŠ¡ä¸­å¯ä»¥çœ‹åˆ°ç›¸å…³ä»£ç ï¼š\n# å¦‚æœå®šä¹‰äº†${KBUILD_DEFCONFIG} if [ -n \u0026#34;${KBUILD_DEFCONFIG}\u0026#34; ]; then if [ -f \u0026#34;${S}/arch/${ARCH}/configs/${KBUILD_DEFCONFIG}\u0026#34; ]; then # ä¼˜å…ˆä½¿ç”¨${WORKDIR}/defconfig if [ -f \u0026#34;${WORKDIR}/defconfig\u0026#34; ]; then cmp \u0026#34;${WORKDIR}/defconfig\u0026#34; \u0026#34;${S}/arch/${ARCH}/configs/${KBUILD_DEFCONFIG}\u0026#34; if [ $? -ne 0 ]; then bbdebug 1 \u0026#34;detected SRC_URI or unpatched defconfig in WORKDIR. ${KBUILD_DEFCONFIG} copied over it\u0026#34; fi cp -f ${S}/arch/${ARCH}/configs/${KBUILD_DEFCONFIG} ${WORKDIR}/defconfig # å¦‚æœ${WORKDIR}/defconfigä¸å­˜åœ¨ï¼Œå°±ç”¨${KBUILD_DEFCONFIG} else cp -f ${S}/arch/${ARCH}/configs/${KBUILD_DEFCONFIG} ${WORKDIR}/defconfig fi in_tree_defconfig=\u0026#34;${WORKDIR}/defconfig\u0026#34; else bbfatal \u0026#34;A KBUILD_DEFCONFIG \u0026#39;${KBUILD_DEFCONFIG}\u0026#39; was specified, but not present in the source tree (${S}/arch/${ARCH}/configs/)\u0026#34; fi fi # å¦‚æœ${KBUILD_DEFCONFIG}æ²¡æœ‰å®šä¹‰ï¼Œå°±ç”¨${WORKDIR}/defconfig sccs_from_src_uri=\u0026#34;${@\u0026#34; \u0026#34;.join(find_sccs(d))}\u0026#34; src_uri_defconfig=$(echo $sccs_from_src_uri | awk \u0026#39;(match($0, \u0026#34;defconfig\u0026#34;) != 0) { print $0 }\u0026#39; RS=\u0026#39; \u0026#39;) ä¸Šé¢çš„å†™æ³•KBUILD_DEFCONFIG = \u0026quot;x86_64_defconfig\u0026quot;è™½ç„¶æœ‰æ•ˆï¼Œä½†æ˜¯å…¼å®¹æ€§ä¸å¥½ï¼Œå¸¸è§çš„ä½œæ³•æ˜¯ç”¨æ¡ä»¶è¯­æ³•Conditional Syntax (Overrides)ï¼Œè®©defconfigè·Ÿç¡¬ä»¶æ¶æ„å…³è”èµ·æ¥ï¼Œä¾‹å¦‚ï¼š\nKBUILD_DEFCONFIG = \u0026#34;i386_defconfig\u0026#34; KBUILD_DEFCONFIG:qemux86-64 = \u0026#34;x86_64_defconfig\u0026#34; KBUILD_DEFCONFIG:beaglebone = \u0026#34;beaglebone_defconfig\u0026#34; å®ƒçš„å«ä¹‰æ˜¯KBUILD_DEFCONFIGçš„é»˜è®¤å€¼æ˜¯i386_defconfigï¼Œå¦‚æœ${OVERRIDES}ä¸­åŒ…å«qemux86-64ï¼Œå°±ç”¨x86_64_defconfigè¦†ç›–ï¼Œå¦‚æœ${OVERRIDES}ä¸­åŒ…å«beagleboneï¼Œå°±ç”¨beaglebone_defconfigè¦†ç›–ã€‚æ‰§è¡Œbitbake -e linux-yocto \u0026gt; linux-yocto.bb.logï¼Œåœ¨å¯¼å‡ºçš„æ—¥å¿—æ–‡ä»¶ä¸­æœç´¢KBUILD_DEFCONFIGï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªè§£æè¿‡ç¨‹ï¼š\n# $KBUILD_DEFCONFIG [3 operations] # set /home/lsc/yocto-kirkstone/x86_build/meta-mylayer/recipes-kernel/linux/linux-yocto_%.bbappend:3 # \u0026#34;i386_defconfig\u0026#34; # override[qemux86-64]:set /home/lsc/yocto-kirkstone/x86_build/meta-mylayer/recipes-kernel/linux/linux-yocto_%.bbappend:4 # \u0026#34;x86_64_defconfig\u0026#34; # override[beaglebone]:set /home/lsc/yocto-kirkstone/x86_build/meta-mylayer/recipes-kernel/linux/linux-yocto_%.bbappend:5 # \u0026#34;beaglebone_defconfig\u0026#34; # pre-expansion value: # \u0026#34;x86_64_defconfig\u0026#34; KBUILD_DEFCONFIG=\u0026#34;x86_64_defconfig\u0026#34; è¿™é‡Œæ˜¾ç¤ºè§£æç»“æœæ˜¯KBUILD_DEFCONFIG=\u0026quot;x86_64_defconfig\u0026quot;ï¼Œæ˜¯å› ä¸ºOVERRIDESå˜é‡çš„å€¼æ˜¯è¿™æ ·çš„ï¼š\nOVERRIDES=\u0026#34;linux:x86-64:pn-linux-yocto:qemuall:qemux86-64:poky:class-target:libc-glibc:forcevariable\u0026#34; bitbakeè§£æKBUILD_DEFCONFIGå˜é‡çš„æ—¶å€™ï¼Œæ ¹æ®å†’å·åé¢çš„æ¡ä»¶ï¼Œåœ¨${OVERRIDES}ä¸­åŒ¹é…åˆ°äº†qemux86-64ã€‚OVERRIDESå«åšæ¡ä»¶æ§åˆ¶å˜é‡ï¼Œè¿™æ˜¯ä¸€ä¸ªä»¥å†’å·å­—ç¬¦åˆ†éš”çš„å­—ç¬¦ä¸²åˆ—è¡¨ï¼Œæ¯ä¸ªå­—ç¬¦ä¸²å°±æ˜¯ä¸€ä¸ªæ¡ä»¶ï¼Œå®šä¹‰åœ¨ poky/meta/conf/bitbake.conf æ–‡ä»¶ï¼š\nOVERRIDES = \u0026#34;${TARGET_OS}:${TRANSLATED_TARGET_ARCH}:pn-${PN}:${MACHINEOVERRIDES}:${DISTROOVERRIDES}:${CLASSOVERRIDE}${LIBCOVERRIDE}:forcevariable\u0026#34; LIBCOVERRIDE ?= \u0026#34;\u0026#34; CLASSOVERRIDE ?= \u0026#34;class-target\u0026#34; DISTROOVERRIDES ?= \u0026#34;${@d.getVar(\u0026#39;DISTRO\u0026#39;) or \u0026#39;\u0026#39;}\u0026#34; MACHINEOVERRIDES ?= \u0026#34;${MACHINE}\u0026#34; ä¸»è¦é›†åˆåˆ—ä¸¾äº†å½“å‰é¡¹ç›®çš„ä¸€äº›ç³»ç»Ÿç‰¹æ€§ï¼Œå…¶ä¸­MACHINEOVERRIDESæ˜¯æŒ‡ç¡¬ä»¶ç‰¹æ€§ï¼Œé»˜è®¤ä½¿ç”¨MACHINEçš„å€¼ï¼Œå°±æ˜¯qemux86-64ã€‚è¿™æ ·ï¼Œdefconfigå°±è·Ÿç¡¬ä»¶æ¶æ„å…³è”èµ·æ¥äº†ã€‚\n5.5 ä½¿ç”¨devtool #ä¸Šé¢æ˜¯å†…æ ¸å¼€å‘çš„åŸºæœ¬æ–¹æ³•ï¼Œä½†æ˜¯ï¼Œå®é™…æƒ…å†µä¸ä¼šè¿™ä¹ˆç®€å•ï¼Œé€šå¸¸éœ€è¦åå¤ä¿®æ”¹éªŒè¯ï¼Œå¦‚æœæ¯æ¬¡éƒ½è¦ä¿®æ”¹åéƒ½è¦ç”Ÿæˆè¡¥ä¸é‡æ–°æ„å»ºç³»ç»Ÿï¼Œæ•ˆç‡å°±å¾ˆä½ã€‚æœ€å¥½æ˜¯ä¿®æ”¹åç›´æ¥ç¼–è¯‘éªŒè¯ï¼Œå®Œæˆæ‰€æœ‰å†…æ ¸å¼€å‘åï¼Œå†æ„å»ºç³»ç»Ÿé•œåƒï¼Œè¿™ä¸ªè¿‡ç¨‹æ›´æ¨èç”¨devtoolå®Œæˆã€‚è¿™æ˜¯Yoctoæä¾›çš„è¾…åŠ©å¼€å‘å·¥å…·ï¼Œä¸æ­¢ç”¨äºå†…æ ¸å¼€å‘ï¼Œå®ƒçš„åŸºæœ¬åŸç†æ˜¯æ–°å»ºä¸€ä¸ªåä¸ºworkspaceçš„ä¸´æ—¶layerè¿›è¡Œå¼€å‘ï¼Œå¼€å‘å®Œæ¯•åå†åˆå¹¶æ¸…é™¤ã€‚è¯¦ç»†å†…å®¹å¯ä»¥å‚è€ƒï¼š\nUsing devtool to Patch the Kernel devtool Quick Reference é¦–å…ˆä½¿ç”¨ devtool modify å‘½ä»¤å°† linux-yocto çš„æºç é‡Šæ”¾åˆ° devtool çš„ç¯å¢ƒä¸‹ï¼š\n$ devtool modify linux-yocto ... ... INFO: Adding local source files to srctree... INFO: Copying kernel config to srctree INFO: Source tree extracted to /home/lsc/yocto-kirkstone/x86_build/workspace/sources/linux-yocto INFO: Recipe linux-yocto now set up to build from /home/lsc/yocto-kirkstone/x86_build/workspace/sources/linux-yocto è¿™ä¸€æ­¥å®Œæˆäº†å‡ é¡¹å·¥ä½œï¼š\næ–°å»ºäº†ä¸€ä¸ªåä¸ºworkspaceçš„layerã€‚ å°†workspaceçš„è·¯å¾„æ·»åŠ åˆ°conf/bblayers.confæ–‡ä»¶çš„BBLAYERSå˜é‡ä¸­ã€‚ å°†linux-yoctoçš„æºç checkoutåˆ°workspace/sources/linux-yoctoè·¯å¾„ä¸‹ã€‚ æ­¤æ—¶ï¼ŒSå˜é‡ä¹ŸæŒ‡å‘äº†è¿™ä¸ªè·¯å¾„ï¼š\n$ bitbake -e linux-yocto | grep ^S= S=\u0026#34;/home/lsc/yocto-kirkstone/x86_build/workspace/sources/linux-yocto\u0026#34; è¿™é‡Œçš„å†…æ ¸æºç å·²ç»åº”ç”¨äº†recipeä¸­è®¾ç½®çš„æ‰€æœ‰è¡¥ä¸å’Œé…ç½®ç‰‡æ®µï¼Œåˆå¹¶åçš„é…ç½®æ–‡ä»¶å°±æ˜¯æºç è·¯å¾„ä¸‹çš„.configï¼Œæ‰§è¡Œgit logå¯ä»¥çœ‹åˆ°å·²ç»æäº¤çš„è¡¥ä¸ï¼š\n$ cd workspace/sources/linux-yocto $ ls -la total 1120 drwxr-xr-x 28 lsc lsc 4096 Nov 23 15:51 . drwxr-xr-x 3 lsc lsc 4096 Nov 23 15:51 .. -rw-r--r-- 2 lsc lsc 17019 Nov 23 14:14 .clang-format -rw-r--r-- 2 lsc lsc 59 Nov 23 14:14 .cocciconfig -rw-r--r-- 1 lsc lsc 147545 Nov 23 14:15 .config $ git log commit 9f62d786ef4e9c4ad2b85aa34d3ec8036ec107f2 (HEAD -\u0026gt; v5.15/standard/base) Author: lishaocheng \u0026lt;gexbob@gmail.com\u0026gt; Date: Fri Nov 17 15:32:14 2023 +0800 feat:add boot message ä¹‹åæˆ‘ä»¬å°±åœ¨è¿™ä¸ªå†…æ ¸æºç ä¸Šè¿›è¡Œå¼€å‘ï¼Œä¾‹å¦‚ä¿®æ”¹init/calibrate.cæ–‡ä»¶ï¼Œæ·»åŠ å‡ è¡Œå¯åŠ¨ä¿¡æ¯ï¼š\nvoid calibrate_delay(void) { unsigned long lpj; static bool printed; int this_cpu = smp_processor_id(); printk(\u0026#34;*************************************\\n\u0026#34;); printk(\u0026#34;* *\\n\u0026#34;); printk(\u0026#34;* HELLO YOCTO KERNEL *\\n\u0026#34;); printk(\u0026#34;* *\\n\u0026#34;); printk(\u0026#34;*************************************\\n\u0026#34;); if (per_cpu(cpu_loops_per_jiffy, this_cpu)) { . . ä½¿ç”¨devtoolè¿›è¡Œç¼–è¯‘ï¼š\n$ devtool build linux-yocto $ devtool build-image core-image-minimal ä¹Ÿå¯ä»¥è„±ç¦»devtoolï¼Œä½¿ç”¨å¤–éƒ¨å·¥å…·é“¾è¿›è¡Œç¼–è¯‘ï¼Œé¦–å…ˆåˆå§‹åŒ–å¼€å‘ç¯å¢ƒï¼š\n$ source /opt/poky/4.0.12/environment-setup-core2-64-poky-linux æ‰“å¼€é…ç½®ç•Œé¢ä¿®æ”¹é…ç½®ï¼š\n$ make menuconfig æ¸…é™¤ï¼š\n$ make clean make cleanï¼Œåˆ é™¤å¤§å¤šæ•°çš„ç¼–è¯‘ç”Ÿæˆæ–‡ä»¶ï¼Œä½†æ˜¯ä¼šä¿ç•™å†…æ ¸çš„.configï¼Œ è¿˜æœ‰è¶³å¤Ÿçš„ç¼–è¯‘æ”¯æŒæ¥å»ºç«‹æ‰©å±•æ¨¡å—ï¼Œæ¯”è¾ƒå¸¸ç”¨ã€‚ make mrproper ï¼Œåˆ é™¤æ‰€æœ‰çš„ç¼–è¯‘ç”Ÿæˆæ–‡ä»¶ï¼Œ è¿˜æœ‰å†…æ ¸é…ç½®æ–‡ä»¶ï¼Œ å†åŠ ä¸Šå„ç§å¤‡ä»½æ–‡ä»¶ï¼Œæ…ç”¨ã€‚ make distcleanï¼Œmrproper åˆ é™¤çš„æ–‡ä»¶ï¼ŒåŠ ä¸Šç¼–è¾‘å¤‡ä»½æ–‡ä»¶å’Œä¸€äº›è¡¥ä¸æ–‡ä»¶ï¼ŒåŒ…æ‹¬ .scmversion ç­‰ï¼Œå‡ ä¹ä¸ç”¨ã€‚ ç¼–è¯‘ ï¼Œç”Ÿæˆçš„å†…æ ¸ä½äº./arch/${ARCH}/boot/è·¯å¾„ä¸‹ï¼š\n$ make -j4 æ‰“åŒ…æ¨¡å—ï¼Œæ‰€æœ‰ç¼–è¯‘å‡ºçš„æ¨¡å—éƒ½å®‰è£…åˆ° ./modules/ è·¯å¾„ä¸‹ï¼š\n$ make modules_install INSTALL_MOD_PATH=./modules/ ç”Ÿæˆçš„å†…æ ¸å’Œæ¨¡å—éƒ½å¯ä»¥å¤åˆ¶åˆ°ç›®æ ‡ç¡¬ä»¶ä¸Šæµ‹è¯•éªŒè¯ã€‚é˜¶æ®µæ€§å¼€å‘å®Œæ¯•åï¼Œå¯ä»¥å‘ git æäº¤ï¼š\ngit status git add \u0026lt;files\u0026gt; git commit -m \u0026lt;message\u0026gt; ä¸€æ¬¡æˆ–è€…å¤šæ¬¡ commit åï¼Œå¯ä»¥ä½¿ç”¨devtool finishå‘½ä»¤ç»“æŸå¼€å‘ï¼š\n$ devtool finish linux-yocto ~/yocto-kirkstone/x86_build/meta-mylayer ... NOTE: Writing append file /home/lsc/yocto-kirkstone/x86_build/meta-mylayer/recipes-kernel/linux/linux-yocto_%.bbappend NOTE: Copying 0001-calibrate-Add-printk-example.patch to /home/lsc/yocto-kirkstone/x86_build/meta-mylayer/recipes-kernel/linux/linux-yocto/0001-calibrate-Add-printk-example.patch INFO: Cleaning sysroot for recipe linux-yocto... INFO: Leaving source tree /home/lsc/yocto-kirkstone/x86_build/workspace/sources/linux-yocto as-is; if you no longer need it then please delete it manually è¿™ä¸ªå‘½ä»¤è‡ªåŠ¨æ‰§è¡Œäº†å‡ ä¸ªæ­¥éª¤ï¼š\næ£€æŸ¥gitæ—¥å¿—ï¼Œå°†æœ€è¿‘çš„å‡ æ¬¡commitç”Ÿæˆè¡¥ä¸ï¼Œå¹¶æ”¾åˆ°meta-mylayer/recipes-kernel/linux/linux-yoctoè·¯å¾„ä¸‹ã€‚ ä¿®æ”¹linux-yocto_%.bbappendæ–‡ä»¶ï¼Œå°†è¡¥ä¸æ–‡ä»¶æ·»åŠ åˆ°SRC_URIã€‚ å°†workspace/sources/linux-yocto ä»yoctoå¼€å‘ç¯å¢ƒä¸­æ¸…é™¤ã€‚ ä¹Ÿå¯ä»¥æ‰‹åŠ¨å®Œæˆè¿™äº›æ“ä½œï¼Œæ‰§è¡Œ git format-patch \u0026lt;-n\u0026gt; å°†å‰é¢å‡ æ¬¡ commit ç”Ÿæˆè¡¥ä¸ï¼Œnæ˜¯ commit çš„æ¬¡æ•°ï¼Œç„¶åå°†è¿™äº›è¡¥ä¸æ–‡ä»¶å¤åˆ¶åˆ°meta-mylayer/recipes-kernel/linux/linux-yoctoï¼Œä¿®æ”¹å¹¶æ·»åŠ åˆ°SRC_URIã€‚æœ€åæ‰§è¡Œ devtool reset linux-yocto å°† workspace/sources/linux-yocto ä»yoctoå¼€å‘ç¯å¢ƒä¸­æ¸…é™¤ï¼Œä¹‹åæ‰§è¡Œbitbakeæ—¶ï¼Œæ‰ä¼šä½¿ç”¨ meta-mylayer ä¸‹çš„é…ç½®ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œdevtool resetå’Œdevtool finishå¹¶ä¸ä¼šåˆ é™¤æºç ï¼Œæ‰€æœ‰ï¼Œworkspace/source/linux-yocto ä¸‹çš„æºç éœ€è¦æ‰‹åŠ¨åˆ é™¤ã€‚\nä¸Šé¢çš„æ–¹æ³•ä¸»è¦é’ˆå¯¹å†…æ ¸æºç çš„å¼€å‘ï¼Œå¯¹äºå†…æ ¸é…ç½®ï¼Œæ¨èæ‰§è¡Œmake savedefconfigï¼Œä½¿ç”¨ç”Ÿæˆçš„defconfigæ–‡ä»¶ï¼Œè€Œä¸æ˜¯é…ç½®ç‰‡æ®µã€‚\n5.6 ä½¿ç”¨Virtual Provider #åœ¨æ„å»ºä¹‹å‰ï¼Œå¦‚æœçŸ¥é“æœ‰å‡ ä¸ªä¸åŒçš„recipeæä¾›ç›¸åŒçš„åŠŸèƒ½ï¼Œå¯ä»¥ä½¿ç”¨Virtual Providerï¼ˆå³ virtual/*ï¼‰ä½œä¸ºå®é™…æä¾›ç¨‹åºçš„å ä½ç¬¦ï¼Œå®é™…æä¾›ç¨‹åºå°†åœ¨æ„å»ºæ—¶ç¡®å®šã€‚å‚è€ƒï¼šUsing Virtual Providersã€‚\nä¾‹å¦‚ï¼ŒpokyåŒ…å«äº†å¤šä¸ªä¸åŒçš„å†…æ ¸recipeï¼š\n\u0026gt; ls poky/meta/recipes-kernel/linux cve-exclusion.inc linux-dummy.bb linux-yocto-rt_5.15.bb linux-yocto.inc kernel-devsrc.bb linux-yocto-dev.bb linux-yocto-tiny_5.10.bb linux-yocto_5.10.bb linux-dummy linux-yocto-rt_5.10.bb linux-yocto-tiny_5.15.bb linux-yocto_5.15.bb æ¯ä¸ªrecipeéƒ½æœ‰å­—èŠ‚çš„PROVIDESå˜é‡ï¼Œå®ƒçš„å€¼æ˜¯recpieçš„åˆ«ååˆ—è¡¨ï¼Œé»˜è®¤åªåŒ…å«äº†${PN}ï¼Œè€Œè¿™äº›å†…æ ¸recipeéƒ½ç»§æ‰¿äº†poky/meta/classes/kernel.bbclassï¼Œè¿™é‡Œå‘PROVIDESè¿½åŠ äº†virtual/kernelï¼š\nPROVIDES += \u0026#34;virtual/kernel\u0026#34; æ‰€ä»¥ï¼Œæ¯ä¸ªå†…æ ¸recipeå°±æœ‰äº†${PN}å’Œvirtual/kernelä¸¤ä¸ªåç§°ã€‚ç„¶åé€šè¿‡PREFERRED_PROVIDERå’ŒPREFERRED_VERSIONå˜é‡è®¾ç½®virtual/kernelè§£æä¸ºå“ªä¸ªrecipeï¼š\n# poky/meta/conf/machine/include/qemu.inc PREFERRED_PROVIDER_virtual/kernel ??= \u0026#34;linux-yocto\u0026#34; # poky/meta-poky/conf/distro/poky.conf PREFERRED_VERSION_linux-yocto ?= \u0026#34;5.15%\u0026#34; è¿™æ ·ï¼Œå¼€å‘å†…æ ¸æ—¶ï¼Œå¯ä»¥ä¸ç”¨å†…æ ¸çš„recipeåŸåï¼Œè€Œæ˜¯ä½¿ç”¨virtual/kernelï¼Œä¾‹å¦‚bitbake virtual/kernelï¼Œbitbakeä¼šè‡ªåŠ¨è§£æPREFERRED_PROVIDERå˜é‡ï¼Œç¡®å®šä½¿ç”¨çš„å†…æ ¸recipeã€‚\n","date":"2023 December 30","permalink":"/posts/2023/12/30/","section":"Posts","summary":"1. å‰è¨€ #é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸€ä¸ªåµŒå…¥å¼Linuxç³»ç»Ÿç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼š","title":"åŸºäºè™šæ‹Ÿæœºçš„ Yocto å…¥é—¨ç¬”è®°"},{"content":"è¿›ç¨‹è°ƒåº¦çš„æ¦‚å¿µæ¯”è¾ƒç®€å•ã€‚å‡è®¾åœ¨åªæœ‰å•æ ¸å¤„ç†å™¨çš„ç³»ç»Ÿä¸­ï¼ŒåŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªè¿›ç¨‹å¯ä»¥æ‹¥æœ‰å¤„ç†å™¨èµ„æºï¼Œé‚£ä¹ˆå…¶ä»–çš„è¿›ç¨‹åªèƒ½åœ¨å°±ç»ªé˜Ÿåˆ—ï¼ˆrunqueueï¼‰ä¸­ç­‰å¾…ï¼Œç­‰åˆ°å¤„ç†å™¨ç©ºé—²ä¹‹åæ‰æœ‰æœºä¼šè·å–å¤„ç†å™¨èµ„æºå¹¶è¿è¡Œã€‚åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œæ“ä½œç³»ç»Ÿå°±éœ€è¦ä»ä¼—å¤šçš„å°±ç»ªè¿›ç¨‹ä¸­é€‰æ‹©ä¸€ä¸ªæœ€åˆé€‚çš„è¿›ç¨‹æ¥è¿è¡Œï¼Œè¿™å°±æ˜¯è¿›ç¨‹è°ƒåº¦å™¨ï¼ˆschedulerï¼‰ã€‚è¿›ç¨‹è°ƒåº¦å™¨äº§ç”Ÿçš„æœ€å¤§åŸå› æ˜¯ä¸ºäº†æé«˜å¤„ç†å™¨çš„åˆ©ç”¨ç‡ã€‚ä¸€ä¸ªè¿›ç¨‹åœ¨è¿è¡Œçš„è¿‡ç¨‹ä¸­æœ‰å¯èƒ½éœ€è¦ç­‰å¾…æŸäº›èµ„æºï¼Œæ¯”å¦‚ç­‰å¾…ç£ç›˜æ“ä½œçš„å®Œæˆã€ç­‰å¾…é”®ç›˜è¾“å…¥ã€ç­‰å¾…ç‰©ç†é¡µé¢çš„åˆ†é…ç­‰ã€‚å¦‚æœå¤„ç†å™¨å’Œè¿›ç¨‹ä¸€èµ·ç­‰å¾…ï¼Œé‚£ä¹ˆæ˜æ˜¾ä¼šæµªè´¹å¤„ç†å™¨èµ„æºï¼Œæ‰€ä»¥ä¸€ä¸ªè¿›ç¨‹åœ¨ç¡çœ ç­‰å¾…æ—¶ï¼Œè°ƒåº¦å™¨å¯ä»¥è°ƒåº¦å…¶ä»–è¿›ç¨‹æ¥è¿è¡Œï¼Œè¿™æ ·å°±æé«˜äº†å¤„ç†å™¨çš„åˆ©ç”¨ç‡ã€‚\n1. è¿›ç¨‹çš„åˆ†ç±» #ç«™åœ¨å¤„ç†å™¨çš„è§’åº¦çœ‹è¿›ç¨‹çš„è¡Œä¸ºï¼Œä½ ä¼šå‘ç°æœ‰çš„è¿›ç¨‹ä¸€ç›´å ç”¨å¤„ç†å™¨ï¼Œæœ‰çš„è¿›ç¨‹åªéœ€è¦å¤„ç†å™¨çš„ä¸€éƒ¨åˆ†è®¡ç®—èµ„æºå³å¯ã€‚æ‰€ä»¥è¿›ç¨‹æŒ‰ç…§è¿™ä¸ªæ ‡å‡†å¯ä»¥åˆ†æˆä¸¤ç±»ï¼šä¸€ç±»æ˜¯ CPU æ¶ˆè€—å‹ï¼ˆCPU-Boundï¼‰ï¼Œå¦å¤–ä¸€ç±»æ˜¯ I/O æ¶ˆè€—å‹ï¼ˆI/O-Boundï¼‰ã€‚ CPUæ¶ˆè€—å‹çš„è¿›ç¨‹ä¼šæŠŠå¤§éƒ¨åˆ†æ—¶é—´ç”¨åœ¨æ‰§è¡Œä»£ç ä¸Šï¼Œä¹Ÿå°±æ˜¯ä¸€ç›´å ç”¨CPUã€‚æ¯”å¦‚ä¸€ä¸ªwhileæ­»å¾ªç¯ã€‚å®é™…ä¸Šï¼Œå¸¸ç”¨çš„ä¾‹å­å°±æ˜¯æ‰§è¡Œå¤§é‡æ•°å­¦è®¡ç®—çš„ç¨‹åºï¼Œæ¯”å¦‚MATLABç­‰ã€‚ I/Oæ¶ˆè€—å‹çš„è¿›ç¨‹å¤§éƒ¨åˆ†æ—¶é—´åœ¨æäº¤ I/O è¯·æ±‚æˆ–è€…ç­‰å¾… I/O è¯·æ±‚ï¼Œæ‰€ä»¥è¿™ç±»è¿›ç¨‹é€šå¸¸åªéœ€è¦å¾ˆå°‘çš„å¤„ç†å™¨è®¡ç®—èµ„æºå³å¯ï¼Œæ¯”å¦‚éœ€è¦é”®ç›˜è¾“å…¥çš„è¿›ç¨‹æˆ–è€…ç­‰å¾…ç½‘ç»œ I/O çš„è¿›ç¨‹ã€‚\næœ‰æ—¶å€™ï¼Œé‰´åˆ«ä¸€ä¸ªè¿›ç¨‹æ˜¯ CPU æ¶ˆè€—å‹è¿˜æ˜¯ I/O æ¶ˆè€—å‹å…¶å®æŒºå›°éš¾çš„ï¼Œä¸€ä¸ªå…¸å‹çš„ä¾‹å­å°±æ˜¯Linuxå›¾å½¢æœåŠ¡å™¨X-windowè¿›ç¨‹ï¼Œå®ƒæ—¢æ˜¯I/Oæ¶ˆè€—å‹ä¹Ÿæ˜¯CPUæ¶ˆè€—å‹ã€‚æ‰€ä»¥ï¼Œè°ƒåº¦å™¨æœ‰å¿…è¦åœ¨ç³»ç»Ÿååç‡å’Œç³»ç»Ÿå“åº”æ€§æ–¹é¢åšå‡ºä¸€äº›å¦¥åå’Œå¹³è¡¡ã€‚Linuxå†…æ ¸çš„è°ƒåº¦å™¨é€šå¸¸å€¾å‘äºæé«˜ç³»ç»Ÿçš„å“åº”æ€§ã€‚\n2. è¿›ç¨‹çš„çŠ¶æ€ #åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªè¿›ç¨‹å°±æ˜¯ä¸€ä¸ªæ­£åœ¨æ‰§è¡Œçš„ç¨‹åºå®ä¾‹ï¼Œå½“è¿›ç¨‹è¢«åˆ›å»ºåï¼Œå®ƒå¯èƒ½å¤„äºäº”ç§çŠ¶æ€ä¹‹ä¸€ï¼š\nRunning or Runnable (R)ï¼Œè¿è¡Œæˆ–è€…å‡†å¤‡å°±ç»ªçš„çŠ¶æ€\nUninterruptible Sleep (D)ï¼Œä¸å¯ä¸­æ–­çš„ç¡çœ çŠ¶æ€\nInterruptable Sleep (S)ï¼Œå¯ä¸­æ–­çš„ç¡çœ çŠ¶æ€\nStopped (T)ï¼Œæš‚åœçŠ¶æ€\nZombie (Z)ï¼Œåƒµå°¸çŠ¶æ€\nä¸‹é¢ç”¨ä¸€å¼ çŠ¶æ€å›¾å±•ç¤ºä¸€ä¸ªè¿›ç¨‹çš„ç”Ÿå‘½å‘¨æœŸï¼š\nå¯¹äºä»»ä½• Linux è¿›ç¨‹æ¥è¯´ï¼Œå®ƒä»¬çš„èµ·ç‚¹å°±æ˜¯è¢«åˆ›å»ºçš„é‚£ä¸€åˆ»ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªçˆ¶è¿›ç¨‹å¯ä»¥ä½¿ç”¨ fork() ç³»ç»Ÿè°ƒç”¨æ¥å¯åŠ¨ä¸€ä¸ªå­è¿›ç¨‹ã€‚ä¸€æ—¦å¯åŠ¨ï¼Œè¯¥è¿›ç¨‹å°±è¿›å…¥è¿è¡Œæˆ–å‡†å¤‡å°±ç»ªçš„çŠ¶æ€ï¼Œå½“è¿›ç¨‹è¿è¡Œæ—¶ï¼Œå®ƒå¯èƒ½ä¼šè¿›å…¥ä¸€ä¸ªä»£ç è·¯å¾„ï¼Œè¦æ±‚å®ƒåœ¨ç»§ç»­è¿è¡Œå‰ç­‰å¾…ç‰¹å®šçš„èµ„æºæˆ–ä¿¡å·ã€‚åœ¨ç­‰å¾…èµ„æºæ—¶ï¼Œè¿›ç¨‹å°†è‡ªæ„¿æ”¾å¼ƒ CPU å‘¨æœŸï¼Œè¿›å…¥ä¸¤ç§ç¡çœ çŠ¶æ€ä¹‹ä¸€ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å¯ä»¥å‘è¿›ç¨‹å‘é€SIGSTOP ä¿¡å·æ¥è®©å®ƒè¿›å…¥æš‚åœçŠ¶æ€ï¼Œå¤„äºè¿™ç§çŠ¶æ€çš„è¿›ç¨‹å°†ç»§ç»­å­˜åœ¨ï¼Œç›´åˆ°å®ƒè¢«æ€æ­»æˆ–ç”¨ SIGCONT æ¢å¤ã€‚æœ€åï¼Œå½“è¿›ç¨‹è¢«ç»ˆæ­¢å¹¶è¿›å…¥åƒµå°¸çŠ¶æ€æ—¶ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸå°±ç»“æŸäº†ï¼Œç„¶åï¼Œç›´åˆ°å®ƒçš„çˆ¶è¿›ç¨‹ä¼šå°†å®ƒä»è¿›ç¨‹è¡¨ä¸­æ¸…é™¤ã€‚å¦‚æœå®ƒçš„çˆ¶è¿›ç¨‹å…ˆé€€å‡ºäº†ï¼Œå®ƒä¼šæˆä¸ºå­¤å„¿è¿›ç¨‹ï¼Œä¸€ç›´å¤„äºåƒµå°¸çŠ¶æ€ã€‚\næœ‰å¾ˆå¤šå·¥å…·å¯ä»¥æŸ¥çœ‹è¿›ç¨‹çŠ¶æ€ï¼Œä»–ä»¬éƒ½æ˜¯æ˜¯åˆ©ç”¨äº† /proc æ–‡ä»¶ç³»ç»Ÿï¼ˆå¯ä»¥æ‰§è¡Œ man proc æŸ¥çœ‹ /proc æ–‡ä»¶ç³»ç»Ÿçš„è¯¦ç»†è¯´æ˜ï¼‰ï¼Œæ¯ä¸ªè¿›ç¨‹çš„ä¿¡æ¯éƒ½æ”¾åœ¨ä»¥ PID å‘½åçš„å­æ–‡ä»¶å¤¹ä¸‹ï¼Œä¾‹å¦‚ï¼ŒæŸ¥çœ‹ PID ä¸º 2780 çš„è¿›ç¨‹çŠ¶æ€ï¼š\n$ cat /proc/2780/status | grep State State: S (sleeping) 2.1 Running or Runnable (R) #å½“ä¸€ä¸ªè¿›ç¨‹å¯åŠ¨åï¼Œä¸ºäº†ç¡®ä¿æ¯ä¸ªè¿›ç¨‹å¯ä»¥å…¬å¹³åœ°åˆ†äº« CPU èµ„æºï¼Œå†…æ ¸ä¼šå°†å…¶æ”¾å…¥å°±ç»ªé˜Ÿåˆ—ï¼Œæ­¤æ—¶ï¼Œè¿›ç¨‹å¤„äºå‡†å¤‡å°±ç»ªçš„çŠ¶æ€ç­‰å¾…è°ƒåº¦ï¼Œå†…æ ¸ä¾æ®è¿›ç¨‹è°ƒåº¦ç®—æ³•ï¼Œä¾æ¬¡è°ƒåº¦é˜Ÿåˆ—ä¸­çš„è¿›ç¨‹ä½¿ç”¨ CPU æ‰§è¡Œä»£ç ï¼Œæ­¤æ—¶è¿›ç¨‹å¤„äºè¿è¡ŒçŠ¶æ€ã€‚\nå°½ç®¡è¿è¡Œå’Œå‡†å¤‡å°±ç»ªçš„çŠ¶æ€æ˜¯ä¸åŒçš„ï¼Œä½†å®ƒä»¬è¢«ç»Ÿç»Ÿå½’å…¥ä¸€ä¸ªç”±å­—ç¬¦ R è¡¨ç¤ºçš„çŠ¶æ€ã€‚\n2.2 Sleeping State: Interruptible (S) and Uninterruptible (D) #åœ¨è¿›ç¨‹æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå®ƒå¯èƒ½ä¼šé‡åˆ°å…¶ä»£ç ä¸­éœ€è¦è¯·æ±‚å¤–éƒ¨èµ„æºçš„éƒ¨åˆ†ã€‚é€šå¸¸æ¥è¯´ï¼Œå¯¹è¿™äº›èµ„æºçš„è¯·æ±‚æ˜¯åŸºäº IO çš„ï¼Œå¦‚ä»ç£ç›˜ä¸Šè¯»å–æ–‡ä»¶æˆ–è¿›è¡Œç½‘ç»œè¯·æ±‚ï¼Œæˆ–è€…æ˜¯å•çº¯çš„ sleep ã€‚ç”±äºè¿›ç¨‹åœ¨æ²¡æœ‰èµ„æºçš„æƒ…å†µä¸‹æ— æ³•è¿›è¡Œï¼Œå®ƒå°±ä¼šåœæ»ä¸å‰ä»€ä¹ˆä¹Ÿä¸åšã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œä¸ºä¾‹æŠŠ CPU èµ„æºè®©ç»™å…¶ä»–å¯è¿è¡Œçš„è¿›ç¨‹ï¼Œå†…æ ¸ä¼šæŠŠè¿›ç¨‹ä»å°±ç»ªé˜Ÿåˆ—ä¸­ç§»å‡ºï¼Œè¿›å…¥ç¡è§‰çŠ¶æ€ï¼Œç­‰å¾…è¢«å”¤é†’ã€‚\næœ‰ä¸¤ç§ä¸åŒçš„ç¡çœ çŠ¶æ€ï¼šä¸å¯ä¸­æ–­çš„ç¡çœ çŠ¶æ€ï¼ˆDï¼‰å’Œå¯ä¸­æ–­çš„ç¡çœ çŠ¶æ€ï¼ˆSï¼‰ã€‚ä¸å¯ä¸­æ–­çš„ç¡çœ çŠ¶æ€åªç­‰å¾…èµ„æºçš„å¯ç”¨æ€§ï¼Œç„¶åå†è½¬å…¥å¯è¿è¡ŒçŠ¶æ€ï¼Œå®ƒå¯¹ä»»ä½•ä¿¡å·éƒ½æ²¡æœ‰ååº”ã€‚å¦ä¸€æ–¹é¢ï¼Œå¯ä¸­æ–­çš„ç¡çœ çŠ¶æ€ï¼ˆSï¼‰å°†å¯¹ä¿¡å·å’Œèµ„æºçš„å¯ç”¨æ€§åšå‡ºååº”ã€‚\n2.3 Stopped State (T) #ä» R çŠ¶æ€ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ SIGSTOP æˆ– SIGTSTP ä¿¡å·å°†ä¸€ä¸ªè¿›ç¨‹æ”¾å…¥æš‚åœçŠ¶æ€ï¼ˆTï¼‰ã€‚è¿™ä¸¤ä¸ªä¿¡å·çš„åŒºåˆ«åœ¨äºï¼Œæˆ‘ä»¬å‘é€ SIGSTOP æ˜¯ç¨‹åºåŒ–çš„ï¼Œæ¯”å¦‚è¿è¡Œ kill -STOP {pid}ï¼Œè¿›ç¨‹ä¸èƒ½å¿½ç•¥è¿™ä¸ªä¿¡å·ï¼Œå°†è¿›å…¥åœæ­¢çŠ¶æ€ã€‚å¦‚æœæˆ‘ä»¬ç”¨é”®ç›˜ CTRL+Z å‘é€ SIGTSTP ä¿¡å·ï¼Œè¿›ç¨‹å¯ä»¥é€‰æ‹©å¿½ç•¥è¿™ä¸ªä¿¡å·ï¼Œåœ¨æ”¶åˆ° SIGTSTP åç»§ç»­æ‰§è¡Œã€‚\nåœ¨æš‚åœçŠ¶æ€ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å‘é€ SIGCONT ä¿¡å·ä½¿è¿›ç¨‹é‡æ–°è¿›å…¥è¿è¡Œæˆ–å¯è¿è¡ŒçŠ¶æ€ã€‚\n2.4 Zombie State (Z) #å½“ä¸€ä¸ªè¿›ç¨‹å®Œæˆå…¶æ‰§è¡Œæˆ–è¢«ç»ˆæ­¢æ—¶ï¼Œå®ƒå°†å‘çˆ¶è¿›ç¨‹å‘é€ SIGCHLD ä¿¡å·å¹¶è¿›å…¥åƒµå°¸çŠ¶æ€ã€‚åƒµå°¸è¿›ç¨‹ï¼Œä¹Ÿè¢«ç§°ä¸ºå¤±æ•ˆè¿›ç¨‹ï¼Œå°†ä¸€ç›´å¤„äºè¿™ç§çŠ¶æ€ï¼Œç›´åˆ°çˆ¶è¿›ç¨‹å°†å…¶ä»è¿›ç¨‹è¡¨ä¸­æ¸…é™¤ã€‚ä¸ºäº†ä»è¿›ç¨‹è¡¨ä¸­æ¸…é™¤å·²ç»ˆæ­¢çš„å­è¿›ç¨‹ï¼Œçˆ¶è¿›ç¨‹å¿…é¡»ä½¿ç”¨ wait() æˆ– waitpid() ç³»ç»Ÿè°ƒç”¨è¯»å–å­è¿›ç¨‹çš„é€€å‡ºå€¼ã€‚\n3. CPU ä½¿ç”¨ç‡ #å•ä¸ªè¿›ç¨‹çš„ CPU ä½¿ç”¨ç‡ï¼Œæ˜¯æŒ‡åœ¨ä¸€æ®µæ—¶é—´å†…ï¼Œè¿›ç¨‹å ç”¨ CPU ï¼ˆå³è¿è¡ŒçŠ¶æ€ï¼‰çš„æ—¶é•¿å æ€»æ—¶é•¿çš„ç™¾åˆ†æ¯”ï¼Œå› ä¸ºè¿›ç¨‹åœ¨è¿™æ®µæ—¶é—´å†…ä¼šåœ¨ä¸‰ç§çŠ¶æ€ä¹‹é—´åˆ‡æ¢ï¼Œä¹Ÿå¯ä»¥è¡¨ç¤ºä¸º:\nCPU ä½¿ç”¨ç‡ = è¿è¡ŒçŠ¶æ€/(è¿è¡ŒçŠ¶æ€+å°±ç»ªçŠ¶æ€+ç¡çœ çŠ¶æ€) 3.1 å®éªŒ #ä¸‹é¢åšä¸€ä¸ªå®éªŒï¼Œåœ¨ä¸€ä¸ª 2.3GHz ä¸»é¢‘çš„å››æ ¸ CPU ä¸Šï¼Œå¦‚æœæ²¡æœ‰å…¶ä»–è¿›ç¨‹å½±å“ï¼Œä¸‹é¢è¿™æ®µä»£ç ä¼šè®© CPU ä½¿ç”¨ç‡ç»´æŒåœ¨ 50% å·¦å³ï¼š\n//cpu_test.c #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;unistd.h\u0026gt; int main() { for(;;) { for(int i=0;i\u0026lt;=(2.3*100000000)/2;i++) //busy ; usleep(100000); //idle } return 0; } å…¶ä¸­ï¼Œ usleep(100000) ä¼šè®©è¿›ç¨‹å¤„äº S çŠ¶æ€ 100msï¼Œç„¶åè¿›ç¨‹ä¼šè¿›å…¥ R çŠ¶æ€ï¼Œbusy éƒ¨åˆ†çš„å¾ªç¯æ‰§è¡Œæ—¶é—´å¤§çº¦æ˜¯ 100ms ï¼Œå› ä¸ºæ²¡æœ‰å…¶ä»–è¿›ç¨‹å½±å“ï¼Œå¯ä»¥è®¤ä¸ºå°±ç»ªçŠ¶æ€æŒç»­çš„æ—¶é—´ä¸ºé›¶ï¼Œè¿™æ · CPU çš„ä½¿ç”¨ç‡å¯ä»¥ä¼°ç®—ï¼š\n100ms/(100ms+0+100ms) = 50% å¦‚æœæŠŠå»¶æ—¶ç¼©çŸ­åˆ° 50msï¼ŒCPU çš„ä½¿ç”¨ç‡ä¼šä¸Šå‡åˆ° 70% å·¦å³ï¼š\nå¦‚æœå†å¼€å¯ä¸€ä¸ªåŒæ ·çš„è¿›ç¨‹ï¼Œç”¨ taskset å‘½ä»¤è®©ä¸¤ä¸ªè¿›ç¨‹éƒ½é”å®šå† Cpu0 ä¸Šè¿è¡Œï¼Œæ¯ä¸ªè¿›ç¨‹çš„ CPU ä½¿ç”¨ç‡ä¼šä¸‹é™åˆ° 40 å·¦å³ï¼Œè¿™æ˜¯å› ä¸ºè¿›ç¨‹åœ¨å°±ç»ªé˜Ÿåˆ—é‡Œçš„ç­‰å¾…æ—¶é—´å˜é•¿äº†ï¼š\n3.2 è®¡ç®—å•ä¸ªè¿›ç¨‹çš„ CPU ä½¿ç”¨ç‡ #å¾ˆå¤šå·¥å…·å¯ä»¥æŸ¥çœ‹ CPU ä½¿ç”¨ç‡ï¼Œä»–ä»¬éƒ½æ˜¯ä¾èµ– /proc ä¸‹çš„æ–‡ä»¶è®¡ç®—å¾—åˆ°çš„ã€‚åœ¨ /proc/{pid}/stat æ–‡ä»¶ä¸­ï¼Œè®°å½•äº†è¿›ç¨‹çš„å¾ˆå¤šä¿¡æ¯ï¼Œä»¥ gnome-shell è¿›ç¨‹ä¸ºä¾‹ï¼š\n$ cat /proc/1751/stat 1751 (gnome-shell) S 1673 1669 1669 1026 1669 4194304 123945 69225 28 178 2801 623 244 90 20 0 13 0 26476 4092280832 48528 18446744073709551615 93953806516224 93953806530024 140723185486304 0 0 0 0 16781312 33637616 0 0 0 17 2 0 0 4 0 0 93953808628368 93953808630032 93953822617600 140723185490640 140723185490661 140723185490661 140723185491939 0 æ¯ä¸€é¡¹æ•°æ®éƒ½ç”¨ç©ºæ ¼éš”å¼€ï¼Œå‡ ä¸ªå…³é”®é¡¹çš„å«ä¹‰ï¼ˆå‚è€ƒ man procï¼‰ï¼š\n(3) state %c ï¼Œæ•°æ®ç±»å‹æ˜¯å­—ç¬¦ï¼Œæ˜¾ç¤ºäº†è¿›ç¨‹çš„çŠ¶æ€ï¼Œå¸¸è§çš„çŠ¶æ€æœ‰ï¼š\nR Running\nS Sleeping in an interruptible wait\nD Waiting in uninterruptible disk sleep\nZ Zombie\nT Stopped (on a signal) or (before Linux 2.6.33) trace stopped\n(14) utime %lu ï¼Œæ— ç¬¦å·é•¿æ•´å½¢æ•°æ®ï¼Œæ˜¾ç¤ºäº†è¯¥è¿›ç¨‹å¯åŠ¨ä»¥æ¥ï¼Œç”¨æˆ·æ€ä»£ç æ‰§è¡Œçš„æ—¶é•¿ï¼Œå•ä½æ˜¯ clock tick\n(15) stime %lu ï¼Œæ— ç¬¦å·é•¿æ•´å½¢æ•°æ®ï¼Œæ˜¾ç¤ºäº†è¯¥è¿›ç¨‹å¯åŠ¨ä»¥æ¥ï¼Œå†…æ ¸æ€ä»£ç æ‰§è¡Œçš„æ—¶é•¿ï¼Œå•ä½æ˜¯ clock tick\nå¯ä»¥é€šè¿‡sysconf(_SC_CLK_TCK)è·å– 1 ç§’å†…æœ‰å¤šå°‘ä¸ª clock tick ï¼Œå¤§éƒ¨åˆ†ç³»ç»Ÿä¸Šæ˜¯ 100 .\né‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥æ¯éš” n ç§’è¯»å–ä¸€æ¬¡ /proc/{pid}/stat æ–‡ä»¶ï¼Œè§£æå…¶ä¸­çš„ utime å’Œ stime ï¼Œç›¸åŠ åï¼ˆutime+stimeï¼‰å‡å»ä¸Šä¸€æ¬¡é‡‡æ ·å¾—åˆ°çš„ä¸¤é¡¹å’Œï¼ˆprev_utime+prev_stimeï¼‰ï¼Œè¿™å°±æ˜¯ n ç§’å†…è¯¥è¿›ç¨‹å ç”¨ CPU çš„æ—¶é—´ï¼Œå•ä½æ˜¯ clock tickï¼Œå†é™¤ä»¥æ€»æ—¶é•¿å°±æ˜¯ CPU ä½¿ç”¨ç‡ï¼Œç”¨å…¬å¼å¯ä»¥è¡¨è¾¾ä¸ºï¼š\næŸè¿›ç¨‹ CPU ä½¿ç”¨ç‡ = ((utime+stime) - (prev_utime + prev_stime)) / (n * sysconf(_SC_CLK_TCK)) 3.3 è®¡ç®—æ¯ä¸ª CPU æ ¸çš„ä½¿ç”¨ç‡ #åœ¨ /proc/stat æ–‡ä»¶ä¸­è®°å½•äº†æ¯ä¸ªCPUæ ¸å¿ƒæ‰€å¤„ä¸åŒçŠ¶æ€çš„ç´¯è®¡æ—¶é—´ã€‚ä»¥ä¸€ä¸ªå››æ ¸ CPU ç³»ç»Ÿä¸ºä¾‹ï¼š\n$ head -n 5 /proc/stat cpu 389079 306 24073 16922376 8047 0 2427 0 0 0 cpu0 160840 80 7066 4165808 1429 0 648 0 0 0 cpu1 109391 11 6220 4215843 2778 0 894 0 0 0 cpu2 13407 26 4699 4317280 1604 0 326 0 0 0 cpu3 105440 187 6088 4223444 2234 0 557 0 0 0 å‰äº”è¡Œè®°å½•äº†æ•´ä¸ª CPUï¼ˆcpu è¡Œï¼‰å’Œæ¯ä¸ª CPU æ ¸ï¼ˆcpu[n] è¡Œï¼‰åœ¨å„ç§çŠ¶æ€ä¸‹èŠ±è´¹çš„æ—¶é—´ï¼Œå•ä½æ˜¯ USER_HZ ï¼ˆé€šå¸¸æ˜¯ç™¾åˆ†ä¹‹ä¸€ç§’ï¼Œå¯ä»¥ç”¨ sysconf(_SC_CLK_TCK) è·å¾—æ­£ç¡®çš„å€¼ï¼‰ã€‚æ¯ä¸€è¡Œæœ‰åä¸ªæ•°æ®ï¼Œæ¯ä¸€åˆ—çš„å«ä¹‰å¦‚ä¸‹ï¼š\nuser nice system idle iowait irq softirq steal guest guest_nice cpu 389079 306 24073 16922376 8047 0 2427 0 0 0 cpu0 160840 80 7066 4165808 1429 0 648 0 0 0 cpu1 109391 11 6220 4215843 2778 0 894 0 0 0 cpu2 13407 26 4699 4317280 1604 0 326 0 0 0 cpu3 105440 187 6088 4223444 2234 0 557 0 0 0 userï¼Œæ‰§è¡Œç”¨æˆ·æ€è¿›ç¨‹æ¶ˆè€—çš„æ—¶é—´\nniceï¼Œæ‰§è¡Œä½ä¼˜å…ˆçº§ç”¨æˆ·æ€è¿›ç¨‹èŠ±è´¹çš„æ—¶é—´\nsystemï¼Œæ‰§è¡Œå†…æ ¸æ€è¿›ç¨‹æ¶ˆè€—çš„æ—¶é—´\nidleï¼Œç©ºé—²çš„æ—¶é—´\niowait, ç­‰å¾… I/O çš„æ—¶é—´\næˆ‘ä»¬å¯ä»¥å®šæ—¶é‡‡é›†è¯¥æ–‡ä»¶çš„æ•°æ®ï¼Œé€šè¿‡è®¡ç®—ä¸¤æ¬¡é‡‡æ ·æ•°æ®ï¼Œå¾—å‡ºè¿™æ®µæ—¶é—´å†…çš„ CPU ä½¿ç”¨ç‡ ã€‚è¿™æ˜¯ top å·¥å…·é»˜è®¤çš„è®¡ç®—æ–¹æ³•ï¼Œä¹Ÿæ˜¯æœ€å¸¸è§CPUä½¿ç”¨ç‡ç»Ÿè®¡æ–¹æ³•ã€‚\n4. ç³»ç»Ÿè´Ÿè½½å¹³å‡å€¼ #æ‰§è¡Œ top æˆ–è€… uptime å‘½ä»¤ï¼Œå¯ä»¥æŸ¥çœ‹ç³»ç»Ÿè´Ÿè½½å¹³å‡å€¼ï¼ˆload averageï¼‰ï¼Œè¿™ä¸‰ä¸ªæ•°å€¼åˆ†åˆ«è¡¨ç¤ºè¿‡å»ä¸€åˆ†é’Ÿï¼Œäº”åˆ†é’Ÿå’Œåäº”åˆ†é’Ÿå†…çš„ç³»ç»Ÿè´Ÿè½½å¹³å‡å€¼ ï¼š\n$ uptime 14:38:23 up 4 min, 1 user, load average: 0.09, 0.53, 0.30 ç³»ç»Ÿè´Ÿè½½å¹³å‡å€¼æ˜¯æŒ‡å¤„äº R çŠ¶æ€å’Œ D çŠ¶æ€çš„è¿›ç¨‹çš„å¹³å‡æ•°é‡ã€‚ å¤„äº R çŠ¶æ€çš„è¿›ç¨‹è¦ä¹ˆæ­£åœ¨ä½¿ç”¨ CPUï¼Œè¦ä¹ˆæ­£åœ¨ç­‰å¾…ä½¿ç”¨ CPUã€‚ å¤„äº D çŠ¶æ€çš„è¿›ç¨‹æ­£åœ¨ç­‰å¾…ä¸€äº› I/O è®¿é—®ï¼Œä¾‹å¦‚ç­‰å¾…ç£ç›˜ã€‚ å–ä¸‰ä¸ªæ—¶é—´é—´éš”çš„å¹³å‡å€¼ã€‚ è´Ÿè½½å¹³å‡å€¼æœªé’ˆå¯¹ç³»ç»Ÿä¸­çš„ CPU æ•°é‡è¿›è¡Œæ ‡å‡†åŒ–ï¼Œå› æ­¤è´Ÿè½½å¹³å‡å€¼ä¸º 1 æ„å‘³ç€å•ä¸ª CPU ç³»ç»Ÿä¸€ç›´åœ¨åŠ è½½ï¼Œè€Œåœ¨ 4 CPU ç³»ç»Ÿä¸Šåˆ™æ„å‘³ç€å®ƒæœ‰ 75% çš„æ—¶é—´å¤„äºç©ºé—²çŠ¶æ€ã€‚\nå¦‚æœå¯åŠ¨ä¸€ä¸ª CPU ä½¿ç”¨ç‡ 100% çš„è¿›ç¨‹ï¼ŒæŒç»­è¿è¡Œä¸€åˆ†é’Ÿåï¼Œä¸€åˆ†é’Ÿçš„ç³»ç»Ÿè´Ÿè½½å¹³å‡å€¼å°±ä¼šå˜ä¸º 1.00 å·¦å³ã€‚å¯ä»¥åšä¸ªå®éªŒï¼Œæ‰§è¡Œ stress å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹ï¼š\n~$ stress -c 1 ç„¶åæ‰§è¡Œ uptime æŸ¥çœ‹ã€‚\n$ uptime 15:27:57 up 53 min, 2 users, load average: 0.18, 0.38, 0.30 $ uptime 15:30:02 up 55 min, 2 users, load average: 0.98, 0.62, 0.40 $ uptime 15:33:55 up 59 min, 2 users, load average: 1.01, 0.85, 0.55 5. è¿›ç¨‹çš„ä¼˜å…ˆçº§ #æ“ä½œç³»ç»Ÿçš„è¿›ç¨‹è°ƒåº¦ç­–ç•¥æœ‰å¾ˆå¤šç§ï¼Œæœ€ç»å…¸æ˜¯åŸºäºä¼˜å…ˆçº§è°ƒåº¦ã€‚å°±æ˜¯è¯´åœ¨åŒä¸€ä¸ªè°ƒåº¦å‘¨æœŸä¸­ï¼Œä¼˜å…ˆçº§é«˜çš„è¿›ç¨‹å ç”¨ CPU çš„æ—¶é—´é•¿äº›ï¼Œè€Œä¼˜å…ˆçº§ä½çš„è¿›ç¨‹å ç”¨ CPU çš„æ—¶é—´çŸ­äº›ã€‚\nåœ¨å†…æ ¸ä¸­ï¼Œè¿›ç¨‹ä¼˜å…ˆçº§çš„ç›¸å…³å®å®šä¹‰ï¼š\n/* include/linux/sched/prio.h */ #define MAX_NICE 19 #define MIN_NICE -20 #define NICE_WIDTH (MAX_NICE - MIN_NICE + 1) #define MAX_USER_RT_PRIO 100 #define MAX_RT_PRIO MAX_USER_RT_PRIO #define MAX_PRIO (MAX_RT_PRIO + NICE_WIDTH) #define DEFAULT_PRIO (MAX_RT_PRIO + NICE_WIDTH / 2) è¿›ç¨‹ä¼˜å…ˆçº§çš„å–å€¼èŒƒå›´æ˜¯ MAX_PRIO å®šä¹‰çš„ï¼Œå®ƒçš„å€¼ä¸º140 ï¼Œå°±æ˜¯è¯´ï¼ŒLinux å†…æ ¸å®ç°äº† 140 ä¸ªä¼˜å…ˆçº§èŒƒå›´ï¼ˆ 0~139ï¼‰ ï¼Œæ•°å€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ã€‚å…¶ä¸­ ï¼Œ0~99 æ˜¯å®æ—¶è¿›ç¨‹çš„ä¼˜å…ˆçº§èŒƒå›´ï¼Œ100~139 æ˜¯éå®æ—¶è¿›ç¨‹çš„ä¼˜å…ˆçº§èŒƒå›´ã€‚å¯¹äºéå®æ—¶è¿›ç¨‹ï¼Œå½“æˆ‘ä»¬æ–°å»ºä¸€ä¸ªéå®æ—¶è¿›ç¨‹æ—¶ï¼Œå†…æ ¸ä¸ºå®ƒåˆ†é…çš„é»˜è®¤ä¼˜å…ˆçº§æ˜¯ DEFAULT_PRIO å®šä¹‰çš„ï¼Œå°±æ˜¯ 120 ï¼Œä¹Ÿå°±æ˜¯ nice ä¸º 0 æ—¶çš„å€¼ï¼Œå¯ä»¥åœ¨ç”¨æˆ·ç©ºé—´é€šè¿‡ nice å€¼ï¼ˆå–å€¼ -20~19ï¼‰è°ƒæ•´è¿›ç¨‹çš„ä¼˜å…ˆçº§ã€‚\nåœ¨ top å‘½ä»¤ä¸­ï¼Œä½¿ç”¨ PR å’Œ NI åˆ†åˆ«è¡¨ç¤ºç”¨æˆ·è§†è§’çš„ä¼˜å…ˆçº§å’Œ nice å€¼ï¼ŒäºŒè€…ç›¸å·® 20 ï¼š\nå¯ä»¥çœ‹å‡ºï¼Œåœ¨ top å‘½ä»¤ä¸­æ˜¾ç¤ºçš„è¿›ç¨‹ä¼˜å…ˆçº§ä¸å†…æ ¸ä¸­çš„ä¼˜å…ˆçº§æ˜¯ä¸ä¸€è‡´çš„ï¼Œå­˜åœ¨çš„æ˜ å°„å…³ç³»å¦‚ä¸‹ï¼š\nå®æ—¶è¿›ç¨‹ä¼˜å…ˆçº§æ˜¯è´Ÿå€¼ï¼ŒèŒƒå›´åœ¨ -100 åˆ° -2 ä¹‹é—´ï¼Œå¯¹åº”å†…æ ¸ä¸­çš„ 0~99ï¼Œå…¶ä¸­æœ€é«˜ä¼˜å…ˆçº§ -100 æ˜¾ç¤ºä¸ºRTï¼› éå®æ—¶è¿›ç¨‹ä¼˜å…ˆçº§èŒƒå›´æ˜¯ 0~39ï¼Œå¯¹åº”ç”¨æˆ·è®¾ç½®çš„niceå€¼æ˜¯ -20~19ï¼Œå¯¹åº”å†…æ ¸ä¸­çš„ 100~139 ã€‚\nå¦‚æœç”¨ ps å‘½ä»¤æŸ¥çœ‹è¿›ç¨‹çš„ä¼˜å…ˆçº§ä¿¡æ¯ï¼Œæ˜¾ç¤ºç»“æœæ ¹ top å‘½ä»¤æ˜¯ä¸ä¸€æ ·çš„ï¼š\n$ ps -l F S UID PID PPID C PRI NI ADDR SZ WCHAN TTY TIME CMD 0 S 1000 15399 15386 0 80 0 - 5771 wait pts/1 00:00:00 bash 0 R 1000 15488 15399 0 80 0 - 7229 - pts/1 00:00:00 ps å…¶ä¸­ï¼ŒPRI è¡¨ç¤ºä¼˜å…ˆçº§ï¼Œå–å€¼èŒƒå›´æ˜¯ -40 åˆ° 100 ï¼Œå¯¹åº”å†…æ ¸ä¸­çš„ 0~139 ï¼Œå½“ nice å€¼ä¸º 0 æ—¶ï¼Œå°±ä¼šæ˜¾ç¤º 80 ã€‚\nå¯ä»¥ç”¨ nice å‘½ä»¤è®¾ç½®è¿›ç¨‹å¯åŠ¨æ—¶çš„ä¼˜å…ˆçº§ï¼Œä¾‹å¦‚ï¼š\n$ nice -n 10 stress -c 1 ç„¶åæŸ¥çœ‹è¿™ä¸ªè¿›ç¨‹ä¼˜å…ˆçº§ï¼š\n$ ps -efl | grep stress 0 S sbs 3288 2819 0 90 10 - 2061 wait 17:07 pts/1 00:00:00 stress -c 1 1 R sbs 3289 3288 99 90 10 - 2061 - 17:07 pts/1 00:00:08 stress -c 1 è¿˜å¯ä»¥ç”¨ renice å‘½ä»¤ä¿®æ”¹æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹çš„ä¼˜å…ˆçº§ï¼Œä¾‹å¦‚ï¼š\n$ sudo renice -n 0 -p 3289 3289 (process ID) old priority 10, new priority 0 $ ps -lfp 3289 F S UID PID PPID C PRI NI ADDR SZ WCHAN STIME TTY TIME CMD 1 R sbs 3289 3288 99 80 0 - 2061 - 17:07 pts/1 00:06:48 stress -c 1 6. CFS è°ƒåº¦å™¨ #è¿›ç¨‹è°ƒåº¦ä¾èµ–äºè°ƒåº¦ç­–ç•¥ï¼ŒLinux å†…æ ¸æŠŠç›¸åŒçš„è°ƒåº¦ç­–ç•¥æŠ½è±¡æˆäº†è°ƒåº¦ç±»ï¼ˆschedule classï¼‰ã€‚ä¸åŒç±»å‹çš„è¿›ç¨‹é‡‡ç”¨ä¸åŒçš„è°ƒåº¦ç­–ç•¥ï¼Œç›®å‰ Linux å†…æ ¸ä¸­é»˜è®¤å®ç°äº† 5 ä¸ªè°ƒåº¦ç±»ï¼Œåˆ†åˆ«æ˜¯ stopã€ deadlineã€realtimeã€CFS å’Œ idleï¼Œå®ƒä»¬åˆ†åˆ«ä½¿ç”¨ sched_class æ¥å®šä¹‰ï¼Œå¹¶ä¸”é€šè¿‡ next æŒ‡é’ˆä¸²è”åœ¨ä¸€èµ·ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š\nstop\næœ€é«˜ä¼˜å…ˆçº§ï¼Œæ¯”deadlineè¿›ç¨‹çš„ä¼˜å…ˆçº§é«˜ã€‚\nå¯ä»¥æŠ¢å ä»»ä½•è¿›ç¨‹ã€‚\nåœ¨æ¯ä¸ªCPUä¸Šå®ç°ä¸€ä¸ªåä¸ºâ€œmigration/Nâ€çš„å†…æ ¸çº¿ç¨‹ï¼ŒNè¡¨ç¤ºCPUçš„ç¼–å·ã€‚è¯¥å†…æ ¸çº¿ç¨‹çš„ä¼˜å…ˆçº§æœ€é«˜ï¼Œå¯ä»¥æŠ¢å ä»»ä½•è¿›ç¨‹çš„æ‰§è¡Œï¼Œä¸€èˆ¬ç”¨æ¥æ‰§è¡Œç‰¹æ®Šçš„åŠŸèƒ½ã€‚\nç”¨äºè´Ÿè½½å‡è¡¡æœºåˆ¶ä¸­çš„è¿›ç¨‹è¿ç§»ã€softlockupæ£€æµ‹ã€CPUçƒ­æ’æ‹”ã€RCUç­‰ã€‚\ndeadline(SCHED_DEADLINE )\næœ€é«˜ä¼˜å…ˆçº§çš„å®æ—¶è¿›ç¨‹ï¼Œä¼˜å…ˆçº§ä¸º-1ã€‚\nç”¨äºè°ƒåº¦æœ‰ä¸¥æ ¼æ—¶é—´è¦æ±‚çš„å®æ—¶è¿›ç¨‹ï¼Œå¦‚è§†é¢‘ç¼–è§£ç ç­‰ã€‚\nrealtime(SCHED_FIFOã€SCHED_RR)\næ™®é€šå®æ—¶è¿›ç¨‹ï¼Œä¼˜å…ˆçº§ä¸º0~99ã€‚\nç”¨äºæ™®é€šçš„å®æ—¶è¿›ç¨‹ï¼Œæ¯”å¦‚IROçº¿ç¨‹åŒ–ã€‚\nCFS(SCHED_NORMALã€SCHED_BATCHã€SCHED_IDLE)\næ™®é€šè¿›ç¨‹ï¼Œä¼˜å…ˆçº§ä¸º100~139ï¼Œç”±CFSæ¥è°ƒåº¦ã€‚ idle\næœ€ä½ä¼˜å…ˆçº§çš„è¿›ç¨‹ã€‚\nå½“å°±ç»ªé˜Ÿåˆ—ä¸­æ²¡æœ‰å…¶ä»–è¿›ç¨‹æ—¶è¿›å…¥idleè°ƒåº¦ç±»ï¼Œidleè°ƒåº¦ç±»ä¼šè®©CPUè¿›å…¥ä½åŠŸè€—æ¨¡å¼ã€‚\nä¸€èˆ¬çš„éå®æ—¶è¿›ç¨‹æ˜¯ç”±å®Œå…¨å…¬å¹³è°ƒåº¦å™¨ CFS(Completely Fair Scheduler) è°ƒåº¦æ‰§è¡Œçš„ï¼Œæ ¸å¿ƒä»£ç åœ¨å†…æ ¸çš„ kernel/sched ç›®å½•ä¸‹ï¼Œå®ƒçš„ç›®çš„æ˜¯è®©æ¯ä¸ªè¿›ç¨‹å°½å¯èƒ½â€œå…¬å¹³â€åœ°è·å¾—è¿è¡Œæ—¶é—´ã€‚\nå¦‚æœå½“å‰æœ‰ n ä¸ªè¿›ç¨‹éœ€è¦è°ƒåº¦æ‰§è¡Œï¼Œé‚£ä¹ˆè°ƒåº¦å™¨åº”è¯¥åœ¨ä¸€ä¸ªæ¯”è¾ƒå°çš„æ—¶é—´èŒƒå›´å†…ï¼ŒæŠŠè¿™ n ä¸ªè¿›ç¨‹å…¨éƒ½è°ƒåº¦æ‰§è¡Œä¸€éï¼Œå°½é‡å…¬å¹³çš„åˆ†é…æ‰§è¡Œæ—¶é•¿ï¼Œè¿™ä¸ªæ—¶é—´èŒƒå›´ä¹Ÿå«åšè°ƒåº¦å‘¨æœŸã€‚è¿›ç¨‹è¶Šå¤šï¼Œæ¯ä¸ªè¿›ç¨‹åœ¨å‘¨æœŸå†…è¢«æ‰§è¡Œçš„æ—¶é—´å°±ä¼šè¢«åˆ†çš„è¶Šå°ã€‚åœ¨ä¸€ä¸ªè°ƒåº¦å‘¨æœŸé‡Œï¼Œä¸€ä¸ªè¿›ç¨‹åˆ†é…çš„æ—¶é—´æ˜¯ç”±è¿›ç¨‹çš„æƒé‡å†³å®šçš„ï¼Œå¯ä»¥è¡¨ç¤ºä¸ºï¼š\nè¿è¡Œæ—¶é—´tn=è°ƒåº¦å‘¨æœŸT * è¿›ç¨‹æƒé‡w / è¿è¡Œé˜Ÿåˆ—ä¸­å…¨éƒ¨è¿›ç¨‹çš„æƒé‡ä¹‹å’ŒS æƒé‡è·Ÿè¿›ç¨‹çš„ nice å€¼æœ‰å…³ï¼Œåœ¨å†…æ ¸çš„ kernel/sched/core.c æ–‡ä»¶å®šä¹‰äº† nice å€¼è½¬æ¢ä¸ºæƒé‡çš„æ˜ å°„è¡¨ï¼š\nconst int sched_prio_to_weight[40] = { /* -20 */ 88761, 71755, 56483, 46273, 36291, /* -15 */ 29154, 23254, 18705, 14949, 11916, /* -10 */ 9548, 7620, 6100, 4904, 3906, /* -5 */ 3121, 2501, 1991, 1586, 1277, /* 0 */ 1024, 820, 655, 526, 423, /* 5 */ 335, 272, 215, 172, 137, /* 10 */ 110, 87, 70, 56, 45, /* 15 */ 36, 29, 23, 18, 15, }; å…¶ä¸­ï¼Œnice å€¼ä¸º 0 çš„æƒé‡æ˜¯ 1024ï¼Œniceå€¼æ¯å·®1ï¼Œæƒé‡å¤§çº¦å·®1.25å€ï¼Œè¿è¡Œæ—¶é—´ç›¸å·®10% ã€‚\nç¡®å®šäº†æ¯ä¸ªè¿›ç¨‹åˆ†é…çš„æ—¶é—´åï¼Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜éœ€è¦è§£å†³ï¼Œå°±æ˜¯ä¸‹ä¸€ä¸ªè¿è¡Œçš„è¿›ç¨‹æ˜¯è°ï¼ŸCFS ä¼šå¯¹æ‰€æœ‰è¿›ç¨‹ç»´æŠ¤ä¸€ä¸ªç´¯ç§¯å ç”¨ CPU æ—¶é—´æ•°ï¼Œå¯ä»¥è¡¡é‡å‡ºæ¯ä¸ªè¿›ç¨‹ç›®å‰å ç”¨çš„CPUæ—¶é—´æ€»é‡æ˜¯ä¸æ˜¯è¿‡å¤§æˆ–è€…è¿‡å°ï¼Œè¿™ä¸ªæ•°å­—è®°å½•åœ¨æ¯ä¸ªè¿›ç¨‹çš„ vruntime ä¸­ã€‚æ‰€æœ‰å¾…æ‰§è¡Œè¿›ç¨‹éƒ½ä»¥ vruntime ä¸ºkeyæ”¾åˆ°ä¸€ä¸ªç”±çº¢é»‘æ ‘ç»„æˆçš„é˜Ÿåˆ—ä¸­ï¼Œæ¯æ¬¡è¢«è°ƒåº¦æ‰§è¡Œçš„è¿›ç¨‹ï¼Œéƒ½æ˜¯è¿™ä¸ªçº¢é»‘æ ‘çš„æœ€å·¦å­æ ‘ä¸Šçš„é‚£ä¸ªè¿›ç¨‹ï¼Œå³ vruntime æ—¶é—´æœ€å°‘çš„è¿›ç¨‹ï¼Œè¿™æ ·å°±ä¿è¯äº†æ‰€æœ‰è¿›ç¨‹çš„ç›¸å¯¹å…¬å¹³ã€‚è¿›ç¨‹æ¯æ¬¡è¿è¡Œå®Œæ¯•åå°±ä¼šæ›´æ–°vruntimeå˜é‡ï¼Œè‡³äºå¦‚ä½•æŒ‘é€‰å‡ºvruntimeæœ€å°‘çš„è¿›ç¨‹ï¼Œè¿™å°†ç”±çº¢é»‘æ ‘å®Œæˆã€‚\næ€»çš„æ¥è¯´ï¼Œä¼˜å…ˆçº§é«˜çš„è¿›ç¨‹ï¼Œæ¯æ¬¡è¢«è°ƒåº¦åæ‰§è¡Œçš„æ—¶é—´æ›´é•¿ï¼Œæ€»æ‰§è¡Œæ—¶é—´æœ€çŸ­çš„è¿›ç¨‹ä¼šè¢«ä¼˜å…ˆè°ƒåº¦ã€‚\nä¸ºäº†é¿å…è¿‡åº¦é¢‘ç¹çš„æŠ¢å å‘ç”Ÿï¼ŒLinuxå†…æ ¸è¿˜è®¾ç½®äº†æ¯ä¸ªTaskï¼ˆè¿›ç¨‹ï¼‰çš„æœ€å°è¿è¡Œæ—¶é—´ï¼ˆæˆ–ç§°è¿è¡Œæ—¶é—´ç²’åº¦ï¼‰ï¼Œåœ¨è¿™ä¸ªæ—¶é—´å†…ï¼Œè¿™ä¸ªè¿›ç¨‹çš„ CPU èµ„æºæ˜¯ä¸å¯è¢«æŠ¢å çš„ã€‚é™¤éè¿›ç¨‹ä¸»åŠ¨è®©å‡ºCPUæˆ–è€…æ‰§è¡Œäº†é˜»å¡çš„ç³»ç»Ÿè°ƒç”¨ï¼Œä¸€èˆ¬è€Œè¨€è¿›ç¨‹éƒ½å¯ä»¥æ‰§è¡Œè¿™ä¸ªæœ€å°æ—¶é—´ã€‚è¿™ä¸ªæ—¶é—´å¯ä»¥é€šè¿‡å†…æ ¸å‚æ•°sched_min_granularity_nsæ¥æŸ¥çœ‹ï¼š\n$ cat /proc/sys/kernel/sched_min_granularity_ns 2250000 7. å®æ—¶è¿›ç¨‹çš„è°ƒåº¦ #ä¼˜å…ˆçº§åœ¨ 0~99 èŒƒå›´å†…çš„éƒ½æ˜¯å®æ—¶è¿›ç¨‹ã€‚\n8. top å‘½ä»¤ #top å‘½ä»¤æ˜¯ç”¨äºæ˜¾ç¤º Linux ç³»ç»Ÿç»å¸¸ä¿¡æ¯çš„å·¥å…·ï¼Œæ‰§è¡Œ top å‘½ä»¤åï¼Œå³å¯è¿›å…¥ä¸€ä¸ªåŸºæœ¬çš„äº¤äº’ç•Œé¢ï¼š\nè¿™ä¸ªç•Œé¢æ˜¯åŠ¨æ€æ›´æ–°çš„ï¼Œé»˜è®¤æ˜¯ 1.5 ç§’åˆ·æ–°ä¸€æ¬¡ï¼Œæ˜¾ç¤ºçš„å†…å®¹åˆ†ä¸ºä¸¤ä¸ªåŒºåŸŸï¼š\nä¸ŠåŠéƒ¨åˆ†æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ‰€æœ‰è¿›ç¨‹å¯¹ CPU å’Œ Memery çš„æ€»ä½“ä½¿ç”¨æƒ…å†µã€‚\nä¸‹åŠéƒ¨åˆ†æ˜¾ç¤ºè¿›ç¨‹åˆ—è¡¨ï¼Œå¦‚æœè¿›ç¨‹æ¯”è¾ƒå¤šï¼Œæ²¡æœ‰æ˜¾ç¤ºå…¨ï¼Œå¯ä»¥æŒ‰ Up/Down æˆ–è€… PageUp/PageDown é”®ä¸Šä¸‹ç¿»é¡µã€‚\næŒ‰ q é”®å¯ä»¥é€€å‡ºã€‚\næ‰§è¡Œ top å‘½ä»¤æ—¶ï¼Œå¯ä»¥è®¾ç½®ä¸€äº›é€‰é¡¹ï¼š\n-d [secs.tenths]ï¼Œåˆ·æ–°çš„é—´éš”æ—¶é—´ï¼Œå•ä½æ˜¯ç§’ï¼Œæ”¯æŒå°æ•°ï¼Œå¿…é¡»å¤§äºé»˜è®¤å€¼ï¼ˆ1.5sï¼‰ã€‚\n-n [X]ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œtop ä¼šä¸€ç›´ä¿æŒè¿è¡Œï¼Œç”¨ -n é€‰é¡¹å¯ä»¥æŒ‡å®šä¸€ä¸ªæ•´æ•° X ï¼Œè¡¨ç¤º top å‘½ä»¤ä¼šåœ¨åˆ·æ–° X æ¬¡åé€€å‡ºã€‚\n-u [user name]ï¼Œåªæ˜¾ç¤ºæŸä¸ªç”¨æˆ·çš„è¿›ç¨‹åˆ—è¡¨ï¼Œä¹Ÿå¯ä»¥å¯åŠ¨åæŒ‰ä¸‹ u é”®ï¼Œé€‰æ‹©ç”¨æˆ·ã€‚\n8.1 ç»Ÿè®¡ä¿¡æ¯è§£æ #ä»¥å¦‚ä¸‹ä¿¡æ¯ä¸ºä¾‹ï¼š\ntop - 14:12:35 up 3:33, 2 users, load average: 0.06, 0.06, 0.01 Tasks: 343 total, 1 running, 257 sleeping, 0 stopped, 0 zombie %Cpu(s): 0.1 us, 0.1 sy, 0.0 ni, 99.8 id, 0.0 wa, 0.0 hi, 0.0 si, 0.0 st KiB Mem : 16362568 total, 14239488 free, 1374568 used, 748512 buff/cache KiB Swap: 2097148 total, 2097148 free, 0 used. 14697252 avail Mem ç¬¬ä¸€è¡Œï¼š\n14:12:35 ï¼Œç³»ç»Ÿå½“å‰æ—¶é—´\nup 3:33 ï¼Œç³»ç»Ÿå¼€æœºåˆ°ç°åœ¨ç»è¿‡çš„æ—¶é—´\n2 users ï¼Œå½“å‰æœ‰ä¸¤ä¸ªç”¨æˆ·åœ¨çº¿\nload average: 0.06, 0.06, 0.01ï¼Œè¿‡å» 1 åˆ†é’Ÿï¼Œ5 åˆ†é’Ÿå’Œ 15 åˆ†é’Ÿçš„ CPU å¹³å‡è´Ÿè½½ã€‚\nç¬¬äºŒè¡Œï¼š\nTasks ï¼Œè¿›ç¨‹ä¿¡æ¯\n343 total ï¼Œå½“å‰ç³»ç»Ÿæœ‰ 343 ç»™è¿›ç¨‹\n1 running ï¼Œæœ‰ 1 ä¸ªè¿›ç¨‹å¤„äºè¿è¡ŒçŠ¶æ€ï¼ˆRï¼‰\n257 sleeping ï¼Œæœ‰ 257 ä¸ªè¿›ç¨‹å¤„äºç¡çœ çŠ¶æ€ï¼ˆSï¼‰\n0 stopped ï¼Œæœ‰ 0 ä¸ªè¿›ç¨‹è¿›ç¨‹å¤„äºåœæ­¢çŠ¶æ€ï¼ˆTï¼‰\n0 zombie ï¼Œæœ‰ 0 ä¸ªè¿›ç¨‹å¤„äºåƒµå°¸çŠ¶æ€ï¼ˆZï¼‰\nç¬¬ä¸‰è¡Œï¼š\n%Cpu(s) ï¼ŒCPU ä½¿ç”¨ç‡çš„ä¿¡æ¯ï¼Œå¯¹äºå¤šæ ¸ CPU ï¼Œè¿™é‡Œæ˜¾ç¤ºçš„æ˜¯æ‰€æœ‰æ ¸å¿ƒçš„å¹³å‡å€¼ï¼Œå¯ä»¥æŒ‰ 1 é”®ï¼Œæ˜¾ç¤ºæ¯ä¸ª CPU æ ¸çš„çŠ¶æ€ã€‚\n0.1 us ï¼ŒCPU æ‰§è¡Œç”¨æˆ·ç©ºé—´è¿›ç¨‹çš„æ—¶é—´ç™¾åˆ†æ¯”\n0.1 sy ï¼ŒCPU æ‰§è¡Œå†…æ ¸ç©ºé—´ä»»åŠ¡çš„æ—¶é—´ç™¾åˆ†æ¯”\n0.0 ni ï¼Œæ‰‹åŠ¨è®¾ç½®è¿‡ \u0026ldquo;nice\u0026rdquo; å€¼çš„è¿›ç¨‹çš„æ‰§è¡Œæ—¶é—´ç™¾åˆ†æ¯”ã€‚Linux ä½¿ç”¨ä¸€ä¸ª \u0026ldquo;nice\u0026rdquo; å€¼æ¥å†³å®šä¸€ä¸ªè¿›ç¨‹çš„ä¼˜å…ˆçº§ã€‚\u0026ldquo;nice\u0026rdquo; å€¼è¶Šå°çš„è¿›ç¨‹ä¼˜å…ˆçº§è¶Šé«˜ï¼Œ\u0026ldquo;nice\u0026rdquo; å€¼å¯ä»¥æ‰‹åŠ¨è®¾ç½®ã€‚\n99.8 id ï¼ŒCPU ç©ºé—²çš„æ—¶é—´ç™¾åˆ†æ¯”\nä¸­æ–­æ˜¯å‘å¤„ç†å™¨å‘å‡ºçš„å…³äºä¸€ä¸ªéœ€è¦ç«‹å³æ³¨æ„çš„äº‹ä»¶çš„ä¿¡å·ã€‚ç¡¬ä»¶ä¸­æ–­é€šå¸¸è¢«å¤–è®¾ç”¨æ¥å‘Šè¯‰ç³»ç»Ÿæœ‰å…³äº‹ä»¶ï¼Œå¦‚é”®ç›˜ä¸Šçš„æŒ‰é”®ã€‚å¦ä¸€æ–¹é¢ï¼Œè½¯ä»¶ä¸­æ–­æ˜¯ç”±äºåœ¨å¤„ç†å™¨ä¸Šæ‰§è¡Œç‰¹å®šæŒ‡ä»¤è€Œäº§ç”Ÿçš„ã€‚åœ¨ä»»ä½•ä¸€ç§æƒ…å†µä¸‹ï¼Œæ“ä½œç³»ç»Ÿéƒ½ä¼šå¤„ç†å®ƒä»¬ï¼Œå¤„ç†ç¡¬ä»¶å’Œè½¯ä»¶ä¸­æ–­çš„æ—¶é—´åˆ†åˆ«ç”±hiå’Œsiç»™å‡ºã€‚\nåœ¨è™šæ‹ŸåŒ–ç¯å¢ƒä¸­ï¼ŒCPUçš„ä¸€éƒ¨åˆ†èµ„æºè¢«èµ‹äºˆæ¯ä¸ªè™šæ‹Ÿæœºï¼ˆVMï¼‰ã€‚æ“ä½œç³»ç»Ÿæ£€æµ‹åˆ°å®ƒæœ‰å·¥ä½œè¦åšï¼Œä½†å®ƒä¸èƒ½æ‰§è¡Œè¿™äº›å·¥ä½œï¼Œå› ä¸ºCPUåœ¨å…¶ä»–è™šæ‹Ÿæœºä¸Šå¾ˆå¿™ã€‚ä»¥è¿™ç§æ–¹å¼æŸå¤±çš„æ—¶é—´æ˜¯ \u0026ldquo;å· \u0026ldquo;çš„æ—¶é—´ï¼Œæ˜¾ç¤ºä¸ºstã€‚\n8.2 è¿›ç¨‹åˆ—è¡¨è§£æ #é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿›ç¨‹åˆ—è¡¨æ˜¾ç¤ºçš„ä¿¡æ¯åŒ…æ‹¬å¦‚ä¸‹å†…å®¹ï¼š\nPIDï¼šè¿›ç¨‹çš„ID\nUSERï¼šè¿›ç¨‹æ‰€æœ‰è€…\nPRï¼šè¿›ç¨‹çš„ä¼˜å…ˆçº§\nNIï¼šnice å€¼\nVIRTï¼šè¿›ç¨‹å ç”¨çš„è™šæ‹Ÿå†…å­˜\nRESï¼šè¿›ç¨‹å ç”¨çš„ç‰©ç†å†…å­˜\nSHRï¼šè¿›ç¨‹ä½¿ç”¨çš„å…±äº«å†…å­˜\nSï¼šè¿›ç¨‹çš„çŠ¶æ€ã€‚Sè¡¨ç¤ºä¼‘çœ ï¼ŒRè¡¨ç¤ºæ­£åœ¨è¿è¡Œï¼ŒZè¡¨ç¤ºåƒµæ­»çŠ¶æ€ï¼ŒNè¡¨ç¤ºè¯¥è¿›ç¨‹ä¼˜å…ˆå€¼ä¸ºè´Ÿæ•°\n%CPUï¼šè¿›ç¨‹çš„CPUä½¿ç”¨ç‡\n%MEMï¼šè¿›ç¨‹ä½¿ç”¨çš„ç‰©ç†å†…å­˜å’Œæ€»å†…å­˜çš„ç™¾åˆ†æ¯”\nTIME+ï¼šè¯¥è¿›ç¨‹å¯åŠ¨åå ç”¨çš„æ€»çš„CPUæ—¶é—´ï¼Œå³å ç”¨CPUä½¿ç”¨æ—¶é—´çš„ç´¯åŠ å€¼ã€‚\nCOMMANDï¼šè¿›ç¨‹å¯åŠ¨å‘½ä»¤åç§°\nè¿˜æœ‰å¾ˆå¤šä¿¡æ¯æ²¡æœ‰æ˜¾ç¤ºå‡ºæ¥ï¼Œå¯ä»¥æŒ‰ f é”®æ‰“å¼€ Fields Management çª—å£ï¼Œè¿™é‡Œåˆ—å‡ºäº†æ‰€æœ‰å¯é€‰çš„è¿›ç¨‹ä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡ä¸Šä¸‹é”®ç§»åŠ¨å…‰æ ‡ï¼ŒæŒ‰ä¸‹ç©ºæ ¼é”®é€‰ä¸­ç›¸åº”é€‰é¡¹ã€‚\n8.3 åº”ç”¨å®ä¾‹ #8.3.1 è¿›ç¨‹æ’åº #é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿›ç¨‹åˆ—è¡¨æŒ‰ %CPU åˆ—çš„å€¼ï¼Œç”±å¤§åˆ°å°æ’åºï¼Œå¯ä»¥é€šè¿‡æŒ‰é”®æ”¹å˜æ’åºä¾æ®ï¼š\nMï¼ŒæŒ‰ %MEM æ’åº\nNï¼ŒæŒ‰ PID æ’åº\nTï¼ŒæŒ‰ TIME+ æ’åº\nPï¼ŒæŒ‰ %CPU æ’åº\n8.3.2 æŒ‰ç”¨æˆ·ç­›é€‰ #æŒ‰ä¸‹ u é”®åï¼Œæ ¹æ®æç¤ºè¾“å…¥ç”¨æˆ·åæˆ–è€…ç”¨æˆ· ID ï¼Œå¯ä»¥åœ¨è¿›ç¨‹åˆ—è¡¨ä¸­ç­›é€‰å‡ºç‰¹å®šç”¨æˆ·çš„è¿›ç¨‹ï¼Œä¾‹å¦‚ï¼Œåªåˆ—å‡º root ç”¨æˆ·çš„è¿›ç¨‹ï¼š\n8.3.3 æ”¹å˜æ˜¾ç¤ºå•ä½ #æŒ‰ä¸‹ E é”®ï¼Œå¯ä»¥æ”¹å˜ç³»ç»Ÿä¿¡æ¯éƒ¨åˆ†æ˜¾ç¤ºçš„å†…å­˜å¤§å°å•ä½ï¼ŒæŒ‰ä¸‹ e é”®ï¼Œå¯ä»¥æ”¹å˜è¿›ç¨‹ä¿¡æ¯éƒ¨åˆ†æ˜¾ç¤ºçš„å†…å­˜å¤§å°å•ä½ã€‚æ”¯æŒçš„å•ä½æœ‰ï¼š\nkibibytes (KiB)\nmebibytes (MiB)\ngibibytes (GiB)\ntebibytes (TiB)\npebibytes (PiB)\nexbibytes (EiB - applies only for memory values)\nä¾‹å¦‚ï¼š\n8.3.5 æŸ¥çœ‹è¿›ç¨‹è¿è¡Œåœ¨å“ªä¸ª CPU æ ¸ #é»˜è®¤æƒ…å†µä¸‹ï¼Œæ˜¾ç¤ºçš„è¿›ç¨‹ä¿¡æ¯æœ‰é™ï¼Œå¯ä»¥æŒ‰ f é”®æ‰“å¼€ Fields Management çª—å£ï¼Œè¿™é‡Œåˆ—å‡ºäº†æ‰€æœ‰å¯é€‰çš„è¿›ç¨‹ä¿¡æ¯ï¼Œç„¶åé€šè¿‡ä¸Šä¸‹é”®å°†å…‰æ ‡ç§»åŠ¨åˆ° P = Last Use CPU ï¼ŒæŒ‰ä¸‹ç©ºæ ¼é”®é€‰ä¸­è¿™ä¸ªé€‰é¡¹ï¼Œå‰é¢ä¼šå‡ºç°ä¸€ä¸ªæ˜Ÿå·ï¼š\nç„¶åæŒ‰ q é”®é€€å‡ºï¼Œå›åˆ°ä¸»ç•Œé¢ï¼Œå°±ä¼šåœ¨å·¦å³è¾¹æ˜¾ç¤ºæ¯ä¸ªè¿›ç¨‹æœ€è¿‘ä½¿ç”¨çš„ CPU æ ¸ï¼š\nå‚è€ƒ # https://phoenixnap.com/kb/top-command-in-linux#change-display-units\nhttps://www.booleanworld.com/guide-linux-top-command/#CPU_usage\nhttps://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/top.html\nhttps://www.howtogeek.com/668986/how-to-use-the-linux-top-command-and-understand-its-output/\nhttp://blog.foool.net/2020/09/åˆ©ç”¨-procç²¾ç¡®è®¡ç®—linuxç³»ç»Ÿçš„cpuåˆ©ç”¨ç‡/\nhttps://scoutapm.com/blog/understanding-load-averages\nhttps://www.baeldung.com/linux/process-states\nhttps://carlyleliu.github.io/2021/Linuxè¿›ç¨‹ç®¡ç†ï¼ˆä¸ƒï¼‰å¤šæ ¸è°ƒåº¦/\nhttps://linux.cn/article-7325-1.html\nhttps://scoutapm.com/blog/understanding-load-averages\n","date":"2022 May 7","permalink":"/posts/2022/05/07/","section":"Posts","summary":"è¿›ç¨‹è°ƒåº¦çš„æ¦‚å¿µæ¯”è¾ƒç®€å•ã€‚å‡è®¾åœ¨åªæœ‰å•æ ¸å¤„ç†å™¨çš„ç³»ç»Ÿä¸­ï¼ŒåŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªè¿›ç¨‹å¯ä»¥æ‹¥æœ‰å¤„ç†å™¨èµ„æºï¼Œé‚£ä¹ˆå…¶ä»–çš„è¿›ç¨‹åªèƒ½åœ¨å°±ç»ªé˜Ÿåˆ—ï¼ˆrunqueueï¼‰ä¸­ç­‰å¾…ï¼Œç­‰åˆ°å¤„ç†å™¨ç©ºé—²ä¹‹åæ‰æœ‰æœºä¼šè·å–å¤„ç†å™¨èµ„æºå¹¶è¿è¡Œã€‚åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œæ“ä½œç³»ç»Ÿå°±éœ€è¦ä»ä¼—å¤šçš„å°±ç»ªè¿›ç¨‹ä¸­é€‰æ‹©ä¸€ä¸ªæœ€åˆé€‚çš„è¿›ç¨‹æ¥è¿è¡Œï¼Œè¿™å°±æ˜¯è¿›ç¨‹è°ƒåº¦å™¨ï¼ˆschedulerï¼‰ã€‚è¿›ç¨‹è°ƒåº¦å™¨äº§ç”Ÿçš„æœ€å¤§åŸå› æ˜¯ä¸ºäº†æé«˜å¤„ç†å™¨çš„åˆ©ç”¨ç‡ã€‚ä¸€ä¸ªè¿›ç¨‹åœ¨è¿è¡Œçš„è¿‡ç¨‹ä¸­æœ‰å¯èƒ½éœ€è¦ç­‰å¾…æŸäº›èµ„æºï¼Œæ¯”å¦‚ç­‰å¾…ç£ç›˜æ“ä½œçš„å®Œæˆã€ç­‰å¾…é”®ç›˜è¾“å…¥ã€ç­‰å¾…ç‰©ç†é¡µé¢çš„åˆ†é…ç­‰ã€‚å¦‚æœå¤„ç†å™¨å’Œè¿›ç¨‹ä¸€èµ·ç­‰å¾…ï¼Œé‚£ä¹ˆæ˜æ˜¾ä¼šæµªè´¹å¤„ç†å™¨èµ„æºï¼Œæ‰€ä»¥ä¸€ä¸ªè¿›ç¨‹åœ¨ç¡çœ ç­‰å¾…æ—¶ï¼Œè°ƒåº¦å™¨å¯ä»¥è°ƒåº¦å…¶ä»–è¿›ç¨‹æ¥è¿è¡Œï¼Œè¿™æ ·å°±æé«˜äº†å¤„ç†å™¨çš„åˆ©ç”¨ç‡ã€‚","title":"Linux è¿›ç¨‹è°ƒåº¦çš„å­¦ä¹ ç¬”è®°"},{"content":"Linux å†…æ ¸å®ç°äº†ä¸€ä¸ªå¾ªç¯åŒå‘é“¾è¡¨ï¼Œè€Œä¸”æ˜¯ä¾µå…¥å¼é“¾è¡¨ï¼Œæ ¸å¿ƒæ•°æ®ç»“æ„å®šä¹‰åœ¨ include/linux/types.h æ–‡ä»¶ï¼š\nstruct list_head { struct list_head *next, *prev; }; å®ç°æ–¹æ³•éƒ½å®šä¹‰åœ¨ include/linux/list.h æ–‡ä»¶ã€‚\n1. åˆå§‹åŒ–é“¾è¡¨ #å†…æ ¸æä¾›äº†ä¸¤ç§åˆå§‹åŒ–é“¾è¡¨èŠ‚ç‚¹çš„æ–¹æ³•ã€‚\nä¸€ç§æ˜¯åˆå§‹åŒ–å®ï¼š\n#define LIST_HEAD_INIT(name) { \u0026amp;(name), \u0026amp;(name) } #define LIST_HEAD(name) \\ struct list_head name = LIST_HEAD_INIT(name) å±•å¼€åå°±æ˜¯ï¼š\n#define LIST_HEAD(name) \\ struct list_head name = { \u0026amp;(name), \u0026amp;(name) } å®ƒçš„ä½œç”¨æ˜¯æ–°å»ºä¸€ä¸ª struct list_head å˜é‡ name ï¼Œè®©ä¸¤ä¸ªæŒ‡é’ˆæŒ‡å‘è‡ªå·±ï¼Œé€šå¸¸ç”¨æˆ·æ–°å»ºä¸€ä¸ªé“¾è¡¨çš„ head ï¼š\nå¦ä¸€ç§æ˜¯åˆå§‹åŒ–å‡½æ•° ï¼š\nstatic inline void INIT_LIST_HEAD(struct list_head *list) { WRITE_ONCE(list-\u0026gt;next, list); list-\u0026gt;prev = list; } å®ƒçš„ä½œç”¨æ˜¯è®©èŠ‚ç‚¹ struct list_head *list çš„ä¸¤ä¸ªæŒ‡é’ˆæŒ‡å‘è‡ªå·±ï¼Œé€šå¸¸ç”¨äºåˆå§‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚\nå†…æ ¸çš„ struct list_head ä¿æŒäº†æœ€ç®€çš„ç»“æ„ï¼Œå…¶ä»–æ•°æ®ç»“æ„è¦è¡¨ç¤ºä¸ºé“¾è¡¨æ—¶ï¼Œéœ€è¦å°† struct list_head å…ƒç´ åµŒå…¥åˆ°è‡ªå·±çš„æ•°æ®ç»“æ„ä¸­ï¼Œä¾‹å¦‚ï¼š\n// æ–°å»ºä¸€ä¸ªé“¾è¡¨ï¼Œhead å°±æ˜¯ students_list LIST_HEAD(students_list); // æ–°å»ºä¸¤ä¸ªèŠ‚ç‚¹ï¼Œå¹¶åˆå§‹åŒ– struct student *student_1 = kmalloc(sizeof(struct student), GFP_KERNEL); struct student *student_2 = kmalloc(sizeof(struct student), GFP_KERNEL); student_1-\u0026gt;id = 1; strcpy(student_1-\u0026gt;name, \u0026#34;Bob\u0026#34;); INIT_LIST_HEAD(\u0026amp;student_1-\u0026gt;list); student_2-\u0026gt;id = 2; strcpy(student_2-\u0026gt;name, \u0026#34;Alice\u0026#34;); INIT_LIST_HEAD(\u0026amp;student_2-\u0026gt;list); // å°†ä¸¤ä¸ªèŠ‚ç‚¹ä¾æ¬¡æ’å…¥é˜Ÿå°¾ list_add_tail(\u0026amp;student_1-\u0026gt;list, \u0026amp;students_list); list_add_tail(\u0026amp;student_2-\u0026gt;list, \u0026amp;students_list); å®é™…æ„é€ çš„é“¾è¡¨ç»“æ„å¦‚ä¸‹ï¼š\n2. æ·»åŠ èŠ‚ç‚¹ #åœ¨ head åé¢ï¼ˆä¹Ÿå°±æ˜¯é˜Ÿå¤´ï¼‰æ·»åŠ ä¸€ä¸ª new èŠ‚ç‚¹ï¼š\nvoid list_add(struct list_head *new, struct list_head *head) åœ¨ head å‰é¢ï¼ˆä¹Ÿå°±æ˜¯é˜Ÿå°¾ï¼‰æ·»åŠ ä¸€ä¸ª new èŠ‚ç‚¹ï¼š\nvoid list_add_tail(struct list_head *new, struct list_head *head) ä¾‹å¦‚ï¼š\nlist_add(\u0026amp;student_1-\u0026gt;list, \u0026amp;students_list); 3. åˆ é™¤èŠ‚ç‚¹ #åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹ï¼š\nvoid list_del(struct list_head *entry) ä¾‹å¦‚ï¼š\nlist_del(\u0026amp;student_1-\u0026gt;list); 4. åˆ¤æ–­èŠ‚ç‚¹çš„ä½ç½® #åˆ¤æ–­ list èŠ‚ç‚¹æ˜¯å¦æ˜¯ head é“¾è¡¨çš„ firts/last èŠ‚ç‚¹ï¼Œå¦‚æœæ­£ç¡®ä¼šè¿”å› 1 ï¼Œé”™è¯¯è¿”å› 0 ï¼š\nint list_is_first(const struct list_head *list, const struct list_head *head) int list_is_last(const struct list_head *list, const struct list_head *head) åˆ¤æ–­ä¸€ä¸ªé“¾è¡¨æ˜¯å¦ä¸ºç©ºæ ¼ï¼Œå¦‚æœä¸ºç©ºä¼šè¿”å› 1 ï¼š\nint list_empty(const struct list_head *head) 5. æŸ¥æ‰¾èŠ‚ç‚¹ #ä½œä¸ºä¾µå…¥å¼é“¾è¡¨ï¼Œéœ€è¦é€šè¿‡ struct list_head ç»“æ„çš„èŠ‚ç‚¹åœ°å€è·å¾—çœŸæ­£çš„æ•°æ®èŠ‚ç‚¹ï¼Œå†…æ ¸æä¾›äº† container_of çš„é‡æ–°å°è£…ï¼š\n#define list_entry(ptr, type, member) container_of(ptr, type, member) ä¸‰ä¸ªå‚æ•°åˆ†åˆ«è¡¨ç¤ºï¼š\nptr ï¼šç»“æ„ä½“æˆå‘˜å˜é‡ member çš„åœ°å€ï¼Œå°±æ˜¯ struct list_head æˆå‘˜çš„åœ°å€ï¼Œ\ntype ï¼šæ•°æ®èŠ‚ç‚¹çš„ç»“æ„ä½“ç±»å‹çš„åç§°\nmember ï¼šç»“æ„ä½“æˆå‘˜å˜é‡çš„åç§°\nä¾‹å¦‚ï¼š\nlist_entry(\u0026amp;student_1-\u0026gt;list, struct student, list) è¿”å›é˜Ÿå¤´/é˜Ÿå°¾çš„èŠ‚ç‚¹ï¼š\nlist_first_entry(head, type, member) list_last_entry(head, type, member) ä¸‰ä¸ªå‚æ•°åˆ†åˆ«è¡¨ç¤ºï¼š\nhead ï¼šé“¾è¡¨å¤´çš„åœ°å€ï¼Œ\ntype ï¼šç»“æ„ä½“ç±»å‹çš„åç§°\nmember ï¼šç»“æ„ä½“ä¸­çš„æˆå‘˜å˜é‡çš„åç§°\nä¾‹å¦‚ï¼š\nstruct student *entry; entry = list_first_entry(\u0026amp;students_list, struct student, list); è·å–ä¸‹ä¸€ä¸ª/ä¸Šä¸€ä¸ªèŠ‚ç‚¹ï¼š\nlist_next_entry(pos, member) list_prev_entry(pos, member) ä¸¤ä¸ªå‚æ•°çš„å«ä¹‰ï¼š\npos ï¼šæ•°æ®èŠ‚ç‚¹çš„åœ°å€\nmemberï¼šæ•°æ®èŠ‚ç‚¹å†… sturct list_head æˆå‘˜çš„åç§°\nä¾‹å¦‚ï¼š\nstruct student *entry; entry = list_first_entry(\u0026amp;students_list, struct student, list); entry = list_next_entry(entry, list); 6. éå†é“¾è¡¨ #å†…æ ¸å®šä¹‰äº†ä¸€ä¸ªå®ï¼Œç”¨äºä»é˜Ÿå¤´å¼€å§‹éå†é“¾è¡¨ï¼š\n#define list_for_each_entry(pos, head, member) \\ for (pos = list_first_entry(head, typeof(*pos), member); \\ \u0026amp;pos-\u0026gt;member != (head); \\ pos = list_next_entry(pos, member)) ä¸‰ä¸ªå‚æ•°çš„å«ä¹‰ï¼š\npos ï¼šä¸€ä¸ªæ•°æ®èŠ‚ç‚¹ç±»å‹çš„æŒ‡é’ˆï¼Œç”¨äºéå†é“¾è¡¨ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹\nhead ï¼šé“¾è¡¨çš„ head member ï¼šæ•°æ®èŠ‚ç‚¹å†… sturct list_head æˆå‘˜çš„åç§°\nä¾‹å¦‚ï¼š\nlist_for_each_entry(entry, \u0026amp;students_list, list) { printk(\u0026#34;entry %d:%s\\n\u0026#34;, entry-\u0026gt;id, entry-\u0026gt;name); } 7. ä¾‹ç¨‹ #hellomod.c ï¼š\n#include \u0026lt;linux/init.h\u0026gt; #include \u0026lt;linux/module.h\u0026gt; #include \u0026lt;linux/slab.h\u0026gt; #include \u0026lt;linux/string.h\u0026gt; struct student { int id; char name[10]; struct list_head list; }; static int __init hellomod_init(void) { struct student *entry; // æ–°å»ºä¸€ä¸ªé“¾è¡¨ LIST_HEAD(students_list); // æ–°å»ºä¸¤ä¸ªèŠ‚ç‚¹ï¼Œå¹¶åˆå§‹åŒ– struct student *student_1 = kmalloc(sizeof(struct student), GFP_KERNEL); struct student *student_2 = kmalloc(sizeof(struct student), GFP_KERNEL); student_1-\u0026gt;id = 1; strcpy(student_1-\u0026gt;name, \u0026#34;Bob\u0026#34;); INIT_LIST_HEAD(\u0026amp;student_1-\u0026gt;list); student_2-\u0026gt;id = 2; strcpy(student_2-\u0026gt;name, \u0026#34;Alice\u0026#34;); INIT_LIST_HEAD(\u0026amp;student_2-\u0026gt;list); // å°†ä¸¤ä¸ªèŠ‚ç‚¹ä¾æ¬¡æ’å…¥é˜Ÿå°¾ list_add_tail(\u0026amp;student_1-\u0026gt;list, \u0026amp;students_list); list_add_tail(\u0026amp;student_2-\u0026gt;list, \u0026amp;students_list); entry = list_first_entry(\u0026amp;students_list, struct student, list); printk(\u0026#34;first entry is %d:%s\\n\u0026#34;, entry-\u0026gt;id, entry-\u0026gt;name); entry = list_next_entry(entry, list); printk(\u0026#34;next entry of first entry is %d:%s\\n\u0026#34;, entry-\u0026gt;id, entry-\u0026gt;name); list_for_each_entry(entry, \u0026amp;students_list, list) { printk(\u0026#34;entry %d:%s\\n\u0026#34;, entry-\u0026gt;id, entry-\u0026gt;name); } printk(\u0026#34;hellomod init\\n\u0026#34;); return 0; } static void __exit hellomod_exit(void) { printk(\u0026#34;hellomod exit\\n\u0026#34;); } module_init(hellomod_init); module_exit(hellomod_exit); MODULE_LICENSE(\u0026#34;GPL\u0026#34;); Makefile ï¼š\nKERDIR=/lib/modules/$(shell uname -r)/build PWD=$(shell pwd) obj-m:=hellomod.o default: make -C ${KERDIR} M=${PWD} modules clean: make -C ${KERDIR} M=${PWD} clean ç¼–è¯‘ååŠ è½½é©±åŠ¨ï¼š\n$ make $ sudo insmod hellomod.ko $ dmesg [35509.579609] first entry is 1:Bob [35509.579610] next entry of first entry is 2:Alice [35509.579611] entry 1:Bob [35509.579611] entry 2:Alice [35509.579611] hellomod init ","date":"2022 April 20","permalink":"/posts/2022/04/20/","section":"Posts","summary":"Linux å†…æ ¸å®ç°äº†ä¸€ä¸ªå¾ªç¯åŒå‘é“¾è¡¨ï¼Œè€Œä¸”æ˜¯ä¾µå…¥å¼é“¾è¡¨ï¼Œæ ¸å¿ƒæ•°æ®ç»“æ„å®šä¹‰åœ¨ include/linux/types.","title":"Linux å†…æ ¸æ•°æ®ç»“æ„-é“¾è¡¨"},{"content":"åŸæ–‡ï¼šhttps://ineclabs.com/image-zimage-uimage-vmlinuz-linux-kernel/\nLinux å†…æ ¸æ˜¯å®å†…æ ¸ã€‚åœ¨å»ºç«‹å†…æ ¸é•œåƒæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©å¤šç§æ ¼å¼çš„å†…æ ¸é•œåƒã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œåˆå­¦è€…ä¼šå› ä¸ºè¿™äº›ä¸åŒçš„åç§°å’Œæ ¼å¼è€Œæ„Ÿåˆ°ç–‘æƒ‘ã€‚åœ¨ Ubuntu ä¸­ï¼Œå†…æ ¸æ–‡ä»¶å­˜å‚¨åœ¨ /boot æ–‡ä»¶å¤¹ä¸­ï¼Œè¢«ç§°ä¸º vmlinuz-version ï¼Œä»¥ ubuntu 18 ä¸ºä¾‹ï¼š\nsbs@ubuntu:~$ ls /boot/ config-5.4.0-100-generic initrd.img-5.4.0-104-generic System.map-5.4.0-100-generic config-5.4.0-104-generic memtest86+.bin System.map-5.4.0-104-generic grub memtest86+.elf vmlinuz-5.4.0-100-generic initrd.img-5.4.0-100-generic memtest86+_multiboot.bin vmlinuz-5.4.0-104-generic vmlinuz è¿™ä¸ªåå­—æ¥è‡ªäº Unix ä¸–ç•Œï¼Œåœ¨ 60 å¹´ä»£ï¼Œä»–ä»¬æ›¾ç»æŠŠå†…æ ¸ç®€å•åœ°ç§°ä¸º \u0026ldquo;Unix\u0026rdquo;ï¼Œæ‰€ä»¥ Linux åœ¨90å¹´ä»£é¦–æ¬¡å¼€å‘æ—¶å¼€å§‹æŠŠä»–ä»¬çš„å†…æ ¸ç§°ä¸º \u0026ldquo;Linux\u0026rdquo;ã€‚å½“è™šæ‹Ÿå†…å­˜è¢«å¼€å‘å‡ºæ¥ä»¥æé«˜å¤šä»»åŠ¡å¤„ç†èƒ½åŠ›æ—¶ï¼Œ\u0026ldquo;vm \u0026ldquo;è¢«æ”¾åœ¨æ–‡ä»¶çš„å‰é¢ä»¥è¡¨æ˜å†…æ ¸æ”¯æŒè™šæ‹Ÿå†…å­˜ã€‚æœ‰ä¸€æ®µæ—¶é—´ï¼ŒLinux å†…æ ¸è¢«ç§°ä¸º vmlinux ï¼Œä½†æ˜¯å†…æ ¸è¶Šæ¥è¶Šå¤§ï¼Œæ— æ³•å®¹çº³åœ¨å¯ç”¨çš„å¯åŠ¨å†…å­˜ä¸­ï¼Œæ‰€ä»¥å†…æ ¸å›¾åƒè¢«å‹ç¼©ï¼Œç»“å°¾çš„ x è¢«æ”¹æˆäº† z ï¼Œä»¥æ˜¾ç¤ºå®ƒæ˜¯ç”¨ zlib å‹ç¼©çš„ã€‚åœ¨åµŒå…¥å¼ç³»ç»Ÿä¸­ï¼Œæ›´å¸¸ç”¨çš„æ˜¯ LZMA å’Œ BZIP2 æ ¼å¼ï¼Œæœ‰äº›å†…æ ¸å¹²è„†è¢«ç§°ä¸º zImage ã€‚åœ¨å†…æ ¸é…ç½®é€‰é¡¹ä¸­ï¼Œå¯ä»¥é€‰æ‹©æ‰€éœ€çš„æ ¼å¼ã€‚\nåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å„ç§å†…æ ¸å›¾åƒæœ‰ä¸€ä¸ªç®€å•çš„æ¦‚è¿°ï¼š\nImage ï¼Œé€šç”¨çš„ Linux å†…æ ¸äºŒè¿›åˆ¶é•œåƒæ–‡ä»¶ã€‚\nvmlinux ï¼Œè¿™æ˜¯ä¸€ä¸ªé™æ€é“¾æ¥çš„å¯æ‰§è¡Œæ–‡ä»¶æ ¼å¼çš„ Linux å†…æ ¸ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä½ ä¸éœ€è¦æ‹…å¿ƒè¿™ä¸ªæ–‡ä»¶ï¼Œå®ƒåªæ˜¯å¯åŠ¨è¿‡ç¨‹ä¸­çš„ä¸€ä¸ªä¸­é—´æ­¥éª¤ã€‚åŸå§‹çš„ vmlinux æ–‡ä»¶å¯èƒ½å¯¹è°ƒè¯•æœ‰ç”¨ã€‚\nvmlinux.bin ï¼Œä¸ vmlinux ç›¸åŒï¼Œä½†é‡‡ç”¨å¯å¯åŠ¨çš„åŸå§‹äºŒè¿›åˆ¶æ–‡ä»¶æ ¼å¼ã€‚æ‰€æœ‰çš„ç¬¦å·å’Œé‡å®šä½ä¿¡æ¯éƒ½è¢«ä¸¢å¼ƒäº†ã€‚é€šè¿‡ objcopy -O binary vmlinux vmlinux.bin ä» vmlinux ç”Ÿæˆã€‚\nvmlinuzï¼Œvmlinux æ–‡ä»¶é€šå¸¸ç”¨ zlib è¿›è¡Œå‹ç¼©ã€‚ä» 2.6.30 å¼€å§‹ï¼ŒLZMA å’Œ bzip2 ä¹Ÿå¯ç”¨ã€‚ç”Ÿæˆ zImage æˆ– bzImage æ—¶ï¼Œä¹Ÿæ˜¯å¯¹vmlinux çš„å‹ç¼©ã€‚é€šè¿‡ç»™ vmlinuz æ·»åŠ è¿›ä¸€æ­¥çš„å¯åŠ¨å’Œè§£å‹ç¼©åŠŸèƒ½ï¼Œå¯ä»¥ç”¨æ¥å¯åŠ¨å¸¦æœ‰ vmlinux å†…æ ¸çš„ç³»ç»Ÿã€‚å†…æ ¸å‡½æ•° decompress_kernel() åœ¨å¯åŠ¨æ—¶å¤„ç† vmlinuz çš„è§£å‹è¿‡ç¨‹ï¼Œä¼šæ‰“å°å¦‚ä¸‹ä¿¡æ¯ï¼š\nDecompressing Linux... done Booting the kernel. zImage ï¼Œæ‰§è¡Œ make zImage æ—¶ç”Ÿæˆçš„å†…æ ¸ï¼Œè¿™æ˜¯å°å†…æ ¸çš„æ—§æ ¼å¼ï¼ˆå‹ç¼©çš„ï¼Œä½äº512KBï¼‰ã€‚åœ¨å¯åŠ¨æ—¶ï¼Œè¿™ä¸ªé•œåƒä¼šè¢«åŠ è½½åˆ°å†…å­˜çš„ä½ä½ï¼ˆRAM çš„å‰ 640KBï¼‰ã€‚\nbzImageï¼Œæ‰§è¡Œ make bzImage æ—¶ç”Ÿæˆçš„å†…æ ¸ï¼Œå¤§çš„ zImageï¼ˆè¿™ä¸ bzip2 æ— å…³ï¼‰ï¼Œå¦‚æœå†…æ ¸é•œåƒè¶…è¿‡ 512KB ï¼Œå°±åº”è¯¥ç”¨è¿™ä¸ªæ ¼å¼ã€‚è¯¥é•œåƒåœ¨å†…å­˜ä¸­è¢«åŠ è½½å¾—å¾ˆé«˜ï¼ˆè¶…è¿‡1MB RAMï¼‰ã€‚ç”±äºä»Šå¤©çš„å†…æ ¸å·²ç»è¿œè¿œè¶…è¿‡ 512KBï¼Œè¿™é€šå¸¸æ˜¯é¦–é€‰çš„æ–¹å¼ã€‚\nuImageï¼šä¸€ä¸ªå…·æœ‰ U-Boot åŒ…è£…å™¨ï¼ˆç”± mkimage å·¥å…·å®‰è£…ï¼‰çš„é•œåƒæ–‡ä»¶ï¼ŒåŒ…æ‹¬æ“ä½œç³»ç»Ÿç±»å‹å’Œå¼•å¯¼ç¨‹åºçš„ä¿¡æ¯ã€‚\nå¸¸ç”¨çš„åšæ³•ï¼ˆä¾‹å¦‚å…¸å‹çš„ Linux Kernel Makefileï¼‰æ˜¯ä½¿ç”¨ zImage æ–‡ä»¶ã€‚ ç”±äº zImage æ–‡ä»¶æ˜¯è‡ªè§£å‹çš„ï¼ˆå³ä¸éœ€è¦å¤–éƒ¨è§£å‹ç¼©å™¨ï¼‰ï¼Œå› æ­¤åŒ…è£…å™¨ä¼šæŒ‡ç¤ºè¯¥å†…æ ¸â€œæœªå‹ç¼©â€ï¼Œå³ä½¿å®ƒå®é™…ä¸Šå·²ç»å‹ç¼©äº†ã€‚\nå†…æ ¸å¯åŠ¨è¿‡ç¨‹å¦‚ä¸‹ï¼š\næ€»ç»“\n","date":"2022 March 13","permalink":"/posts/2022/03/13/","section":"Posts","summary":"åŸæ–‡ï¼šhttps://ineclabs.com/image-zimage-uimage-vmlinuz-linux-kernel/","title":"Linux å†…æ ¸é•œåƒçš„ç±»å‹å’ŒåŒºåˆ«"},{"content":"1. åœ¨å®¢æˆ·ç«¯ç”µè„‘ç”Ÿæˆå¯†é’¥å¯¹ #åœ¨å®¢æˆ·ç«¯ç”µè„‘ä¸Šæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œç”Ÿæˆä¸€ä¸ªå¯†é’¥å¯¹ï¼š\nssh-keygen -t ed25519 -C \u0026#34;lishaocheng_20220201\u0026#34; -t é€‰é¡¹æŒ‡å®šäº†åŠ å¯†ç±»å‹ï¼Œæˆ‘ä»¬é€‰æ‹© ed25519 ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©å…¶ä»–ç±»å‹ã€‚ -C é€‰é¡¹æ˜¯è®¾ç½®å¯†é’¥å¯¹çš„æ³¨é‡Šï¼Œæˆ‘ä¹ æƒ¯è®¾ç½®ç”¨æˆ·åå’Œæ—¥æœŸã€‚ è®¾ç½®ä¸€ä¸ªä¾¿äºè®°å¿†çš„æ–‡ä»¶åï¼Œå¯†ç å¯ä»¥è·³è¿‡ï¼Œç”Ÿæˆçš„å¯†é’¥å¯¹æ–‡ä»¶ä½äºå½“å‰ç›®å½•ä¸‹ã€‚åç¼€ä¸º .pub çš„æ–‡ä»¶æ˜¯å…¬é’¥ï¼Œå¦ä¸€ä¸ªæ˜¯ç§é’¥ï¼ŒæŠŠä¸¤ä¸ªæ–‡ä»¶å¤åˆ¶åˆ° ~/.ssh/ ç›®å½•ä¸‹ã€‚\nå¦‚æœåœ¨ Linux ä¸‹ä½¿ç”¨ï¼Œéœ€è¦è®¾ç½®å¯†é’¥æ–‡ä»¶çš„æƒé™ï¼Œå¦åˆ™æ·»åŠ æ—¶ä¼šæŠ¥é”™ï¼š\nchmod 600 ~/.ssh/lishaocheng_20220201 2. å°†å…¬é’¥æ·»åŠ åˆ° SSH æœåŠ¡å™¨ #åœ¨å®¢æˆ·ç”µè„‘çš„åœ¨ ~/.ssh/ ç›®å½•ä¸‹æ‰§è¡Œ ssh-copy-id -i [public key] username@[server ip] ï¼Œå°†å…¬é’¥æ·»åŠ åˆ°æœåŠ¡å™¨ä¸Šï¼Œä¾‹å¦‚ï¼š\n~/.ssh $ ssh-copy-id -i lishaocheng_20220201.pub sbs@192.168.42.131 /usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: \u0026#34;lishaocheng_20220201.pub\u0026#34; /usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed /usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys sbs@192.168.42.131\u0026#39;s password: Number of key(s) added: 1 Now try logging into the machine, with: \u0026#34;ssh \u0026#39;sbs@192.168.42.131\u0026#39;\u0026#34; and check to make sure that only the key(s) you wanted were added. æ‰§è¡ŒæˆåŠŸåï¼Œå…¬é’¥ä¼šå¤åˆ¶åˆ°æœåŠ¡å™¨çš„ ~/.ssh ç›®å½•ä¸‹çš„ authorized_keys æ–‡ä»¶ä¸­ã€‚\n3. ä¿®æ”¹å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ #åœ¨å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ ~/.ssh/config ä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š\nHost vm_ubuntu18 HostName 192.168.42.131 Port 22 User sbs PreferredAuthentications publickey IdentityFile ~/.ssh/lishaocheng_20220201 Host è®¾ç½®ä¸ºæœåŠ¡å™¨ IP Hostname è®¾ç½®ä¸ºæœåŠ¡å™¨åç§° Port æ˜¯æœåŠ¡å™¨ SSH çš„ç«¯å£ User æ˜¯ç”¨æˆ·å PreferredAuthentications è®¾ä¸ºå…¬é’¥éªŒè¯ IdentityFile è®¾ç½®ç§é’¥æ–‡ä»¶çš„è·¯å¾„ ä¿å­˜åï¼Œåœ¨å®¢æˆ·ç«¯æ‰§è¡Œ ssh vm_ubuntu18 å³å¯ç™»å½•ã€‚\n","date":"2022 March 11","permalink":"/posts/2022/03/11/","section":"Posts","summary":"1. åœ¨å®¢æˆ·ç«¯ç”µè„‘ç”Ÿæˆå¯†é’¥å¯¹ #åœ¨å®¢æˆ·ç«¯ç”µè„‘ä¸Šæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œç”Ÿæˆä¸€ä¸ªå¯†é’¥å¯¹ï¼š","title":"é…ç½® SSH å¯†é’¥ç™»å½•"},{"content":"1. æ¦‚è¿° #ç¡¬ä»¶å¹³å°ä½¿ç”¨ iMX8MM å‚è€ƒå¼€å‘æ¿ï¼Œå¸¦æœ‰ M.2 æ¥å£ï¼Œè½¯ä»¶å¹³å°æ˜¯ iMX Yocto Linux 5.4.47 ã€‚è°ƒè¯•æµ·åçš„ AW-CM276MA æ¨¡å—ï¼Œè¯¥æ¨¡å—åŸºäº NXP 88W8997ï¼ŒPCIe 2.0 æ¥å£ï¼ŒM.2 2230 å°è£…ï¼Œå¤–è§‚å¦‚ä¸‹ï¼š\næ¨¡å—ç»“æ„ï¼š\nå…·æœ‰å¦‚ä¸‹ç‰¹æ€§ï¼š\nåŸºäº 88W8997 IEEE 802.11ac (wave2)ï¼ŒBlueTooth 5.2 Wi-Fi PCIe æ¥å£ï¼ŒBlueTooth UART æ¥å£ Wi-Fi 2.4/5 GHz åŒé¢‘ï¼Œ2x2 åŒå¤©çº¿ æ”¯æŒ 20/40/80Mhz å¸¦å®½ï¼Œ80MHz 2x2æ—¶æœ€é«˜é€Ÿç‡ 866.7Mbps WPA/WPA2 å’Œ WEP 64/128 bit åŠ å¯† æ”¯æŒSTAï¼ˆWi-Fiç«™ç‚¹ï¼‰, APï¼ˆWi-Fiçƒ­ç‚¹ï¼‰å’Œ P2Pï¼ˆWi-Fiç›´è¿ï¼‰ä¸‰ç§æ¨¡å¼ å…¶ä»–å‚è€ƒï¼š\nNXP çš„ Wi-Fi äº§å“åˆ—è¡¨ï¼šhttps://www.nxp.com/products/wireless/wi-fi-plus-bluetooth:WIFI-BLUETOOTH 88W8997 ï¼šhttps://www.nxp.com/products/wireless/wi-fi-plus-bluetooth/2-4-5-ghz-dual-band-2x2-wi-fi-5-802-11ac-plus-bluetooth-5-3-solution:88W8997 2. é©±åŠ¨å’Œå›ºä»¶ #æ¨¡å—ä½¿ç”¨çš„é©±åŠ¨æ˜¯ mxm_wifiex ï¼Œä½äºå†…æ ¸çš„drivers/net/wireless/nxp/mxm_wifiex ç›®å½•ä¸‹ã€‚è¿™ä¸ªé©±åŠ¨æ˜¯ NXP å¼€å‘å¹¶ç»´æŠ¤ï¼Œæ”¯æŒ NXP çš„å¤šç§æ— çº¿æ¨¡å—ï¼Œé€šå¸¸ï¼Œæ–°çš„æ¨¡å—éœ€è¦æ–°çš„é©±åŠ¨ç‰ˆæœ¬æ”¯æŒï¼Œå¯ä»¥åœ¨ https://source.codeaurora.org/external/imx/mwifiex ä¸‹è½½æºç ã€‚æ­¤å¤–ï¼Œè¿˜éœ€è¦æä¾›ç›¸åº”æ¨¡å—çš„å›ºä»¶ï¼ŒNXP çš„å›ºä»¶é€šè¿‡ https://github.com/NXP/imx-firmware å‘å¸ƒï¼Œä¹Ÿåˆ†ä¸åŒçš„ç‰ˆæœ¬ï¼Œéœ€è¦ä¸é©±åŠ¨ç‰ˆæœ¬åŒ¹é…ã€‚\nåŠ è½½é©±åŠ¨æ—¶ï¼Œé€šè¿‡æ¨¡å—å‚æ•°æŒ‡å®šå›ºä»¶çš„è·¯å¾„ï¼Œå½“ SDIO/PCIe æ€»çº¿é©±åŠ¨æ£€æµ‹åˆ°æ¨¡å—çš„ SDIO/PCIe æ¥å£æ—¶ï¼ŒMLAN æ¨¡å—å°†å›ºä»¶äºŒè¿›åˆ¶æ–‡ä»¶ä¸‹è½½åˆ° SD8987/PCIE8997 ä¸­ã€‚æ¨¡å—é©±åŠ¨ç¨‹åºæ”¯æŒå¤šç§æ¥å£å‘ç”¨æˆ·æä¾›æ§åˆ¶å’Œé…ç½®æ¨¡å—çš„é€šé“ï¼Œå¯ä»¥é€šè¿‡ CFG80211 å­ç³»ç»Ÿä¸ç½‘ç»œåè®®æ ˆç›¸è¿ï¼Œå‘ iw ã€hostapt å’Œ wpa_supplicant(nl80211) æä¾›ç¼–ç¨‹æ¥å£ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ IOCTL å‘ iwconfigã€iwpriv å’Œ wpa_supplicant(wext) æä¾›ç¼–ç¨‹æ¥å£ã€‚å¦‚ä¸‹æ˜¯æ•´ä¸ªè½¯ä»¶æ ˆçš„å›¾å¼ï¼š\nä½¿ç”¨ git ä¸‹è½½é©±åŠ¨æºç ï¼š\n$ git clone https://source.codeaurora.org/external/imx/mwifiex æºç æœ‰å¤šä¸ªåˆ†æ”¯ï¼š\n$ git branch -a * master remotes/origin/HEAD -\u0026gt; origin/master remotes/origin/imx_5.4.70_2.3.0 remotes/origin/lf-5.10.52_2.1.0 remotes/origin/lf-5.10.72_2.2.0 remotes/origin/lf-5.10.y_1.0.0 remotes/origin/lf-5.10.y_2.0.0 remotes/origin/master ç›´æ¥ä½¿ç”¨ master åˆ†æ”¯ï¼Œå¯¹åº”çš„æ ‡ç­¾ lf-5.10.35-2.0.0 è¡¨ç¤ºè¿™ä¸ªç‰ˆæœ¬å·²ç»é›†æˆåˆ°äº† iMX Yocto L5.10.35 çš„å†…æ ¸é‡Œï¼š\nä» git è®°å½•å¯ä»¥çœ‹åˆ°å½“å‰çš„é©±åŠ¨ç‰ˆæœ¬æ˜¯ mxm5x17247.p5 ï¼š\ncommit a63cac065978149d9c4c1064eddcdc1f11dda57c Author: Sherry Sun \u0026lt;sherry.sun@nxp.com\u0026gt; Date: Wed Jun 2 09:47:10 2021 +0800 mxm_wifiex: update to mxm5x17247.p5 release 5X - Linux 5.x Kernel 17 - card type 247 - Release version p5 - Patch Number ç„¶åå°†é©±åŠ¨æºç ä¸­ wlan_src ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å¤åˆ¶åˆ° iMX Yocto L5.4.47 å†…æ ¸æºç çš„ drivers/net/wireless/nxp/mxm_wifiex/wlan_src/ ç›®å½•ä¸‹ã€‚ç¼–è¯‘å‡ºçš„å†…æ ¸æ¨¡å—æ˜¯ mlan.ko å’Œ moal.ko ï¼Œå¤åˆ¶åˆ°ç›®æ ‡æ¿çš„å¦‚ä¸‹ç›®å½•ï¼Œè¦†ç›–åŸæ–‡ä»¶ï¼š\n/lib/modules/5.4.47-2.2.0+g5ec03d06f54e/kernel/drivers/net/wireless/nxp/mxm_wifiex/wlan_src/ æ‰“å¼€ https://github.com/NXP/imx-firmware é¡µé¢ï¼Œåœ¨ tag ä¸­æ‰¾åˆ°å¯¹åº”çš„ç‰ˆæœ¬ lf-5.10.35-2.0.0 ï¼š\nå¯¹åº”çš„å›ºä»¶ç‰ˆæœ¬æ˜¯ PCIE-UART W8997 Firmware version 16.92.10.p213 :\n16 - Major revision 92 - Feature pack 10 - Release version p213 - Patch number ä¸‹è½½åè§£å‹ï¼Œåœ¨ nxp ç›®å½•ä¸‹æœ‰å¤šç§æ¨¡å—çš„å›ºä»¶ï¼š\nå…¶ä¸­ï¼ŒFwImage_8997 ä¸‹æ˜¯ PCIe æ¥å£çš„ 88W8997 æ¨¡å—çš„å›ºä»¶ï¼Œwifi_mod_para.conf æ˜¯ä¼ é€’æ¨¡å—å‚æ•°çš„é…ç½®æ–‡ä»¶ã€‚å°†è¿™ä¸‰ä¸ªå¤åˆ¶åˆ°ç›®æ ‡æ¿çš„ /lib/firmware/nxp/ ç›®å½•ä¸‹ï¼Œä¿®æ”¹ wifi_mod_para.conf ä¸­ PCIE8997 çš„ fw_name å‚æ•°ï¼Œè®¾ç½®æ­£ç¡®çš„å›ºä»¶è·¯å¾„ï¼š\nPCIE8997 = { cfg80211_wext=0xf wfd_name=p2p max_vir_bss=1 cal_data_cfg=none drv_mode=7 ps_mode=2 auto_ds=2 fw_name=nxp/FwImage_8997/pcieuart8997_combo_v4.bin } å…³äºè¿™äº›æ¨¡å—å‚æ•°çš„å«ä¹‰ï¼Œåœ¨é©±åŠ¨æºç çš„ READM_MLAN æ–‡ä»¶é‡Œæœ‰è¯¦ç»†è¯´æ˜ã€‚å¸¸ç”¨çš„å‚æ•°æœ‰ï¼š\ndrv_modeï¼šè®¾ç½®é©±åŠ¨æ”¯æŒæ¨¡å¼ï¼Œä½ä¸‰ä½æœ‰æ•ˆï¼Œè®¾ä¸º 7 è¡¨ç¤ºæ”¯æŒä¸‰ç§æ¨¡å¼ï¼š Bit 0 : STA Bit 1 : AP Bit 2 : P2P sta_nameï¼šSTA æ¨¡å¼çš„æ¥å£åç§° (default: \u0026ldquo;mlan\u0026rdquo;) uap_nameï¼šAP æ¨¡å¼çš„æ¥å£åç§° (default: \u0026ldquo;uap\u0026rdquo;) wfd_nameï¼šP2P æ¨¡å¼çš„æ¥å£åç§° (default: \u0026ldquo;wfd\u0026rdquo;) cfg80211_wext= Bit 0: STA WEXT Bit 1: AP WEXT Bit 2: STA CFG80211 Bit 3: AP CFG80211 auto_ds=0|1|2 \u0026lt;use MLAN default | enable auto deepsleep | disable auto deepsleep\u0026gt; ps_mode=0|1|2 \u0026lt;use MLAN default | enable IEEE PS mode | disable IEEE PS mode\u0026gt; fw_name = ï¼Œå›ºä»¶çš„ç›¸å¯¹è·¯å¾„ï¼ˆ/lib/firmware/ ç›®å½•ä¸‹ï¼‰ ç¡®ä¿æ’å…¥æ¨¡å—åï¼Œå¯ä»¥çœ‹åˆ° PCIe è®¾å¤‡ï¼š\n~# lspci -v 00:00.0 PCI bridge: Synopsys, Inc. DWC_usb3 (rev 01) (prog-if 00 [Normal decode]) Flags: bus master, fast devsel, latency 0, IRQ 232 Memory at 18000000 (32-bit, non-prefetchable) [size=1M] Bus: primary=00, secondary=01, subordinate=ff, sec-latency=0 I/O behind bridge: None Memory behind bridge: None Prefetchable memory behind bridge: 18100000-182fffff [size=2M] [virtual] Expansion ROM at 18300000 [disabled] [size=64K] Capabilities: [40] Power Management version 3 Capabilities: [50] MSI: Enable- Count=1/1 Maskable+ 64bit- Capabilities: [70] Express Root Port (Slot-), MSI 00 Capabilities: [100] Advanced Error Reporting Capabilities: [148] L1 PM Substates Kernel driver in use: pcieport 01:00.0 Ethernet controller: Marvell Technology Group Ltd. Device 2b42 (rev 11) Flags: bus master, fast devsel, latency 0, IRQ 232 Memory at 18100000 (64-bit, prefetchable) [size=1M] Memory at 18200000 (64-bit, prefetchable) [size=1M] Capabilities: [40] Power Management version 3 Capabilities: [50] MSI: Enable- Count=1/32 Maskable+ 64bit+ Capabilities: [70] Express Endpoint, MSI 00 Capabilities: [b0] MSI-X: Enable- Count=32 Masked- Capabilities: [100] Advanced Error Reporting Capabilities: [148] Device Serial Number 00-00-00-00-00-00-00-00 Capabilities: [158] Power Budgeting \u0026lt;?\u0026gt; Capabilities: [168] Latency Tolerance Reporting Capabilities: [170] L1 PM Substates Kernel driver in use: wlan_pcie ç„¶ååŠ è½½é©±åŠ¨ï¼š\n~# modprobe moal mod_para=nxp/wifi_mod_para.conf é©±åŠ¨åŠ è½½æˆåŠŸåï¼Œå†…æ ¸ä¼šæ‰“å°å¦‚ä¸‹ä¿¡æ¯ï¼š\n[ 232.184958] wlan: Loading MWLAN driver [ 232.189377] wlan_pcie 0000:01:00.0: enabling device (0000 -\u0026gt; 0002) [ 232.195726] Attach moal handle ops, card interface type: 0x204 [ 232.205187] PCIE8997: init module param from usr cfg [ 232.210209] card_type: PCIE8997, config block: 0 [ 232.214848] cfg80211_wext=0xf [ 232.217837] wfd_name=p2p [ 232.220381] max_vir_bss=1 [ 232.223001] cal_data_cfg=none [ 232.225986] drv_mode = 7 [ 232.228546] ps_mode = 2 [ 232.230991] auto_ds = 2 [ 232.233455] fw_name=nxp/FwImage_8997/pcieuart8997_combo_v4.bin [ 232.239350] rx_work=1 cpu_num=4 [ 232.242530] Attach mlan adapter operations.card_type is 0x204. [ 232.256329] Request firmware: nxp/FwImage_8997/pcieuart8997_combo_v4.bin [ 233.115916] FW download over, size 553604 bytes [ 233.984767] WLAN FW is active [ 233.987752] on_time is 233983459875 [ 234.031562] fw_cap_info=0x181c3fa3, dev_cap_mask=0xffffffff [ 234.037181] max_p2p_conn = 8, max_sta_conn = 8 [ 234.068698] wlan: version = PCIE8997--16.92.10.p213-MM5X16247.p5-GPL-(FP92) [ 234.078130] wlan: Driver loaded successfully å¯ä»¥çœ‹åˆ°ä¸‰ä¸ªç½‘ç»œæ¥å£ï¼š\n~# ifconfig -a eth0 Link encap:Ethernet HWaddr 7a:ac:85:59:55:fb BROADCAST MULTICAST MTU:1500 Metric:1 RX packets:0 errors:0 dropped:0 overruns:0 frame:0 TX packets:0 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:0 (0.0 B) TX bytes:0 (0.0 B) lo Link encap:Local Loopback inet addr:127.0.0.1 Mask:255.0.0.0 inet6 addr: ::1/128 Scope:Host UP LOOPBACK RUNNING MTU:65536 Metric:1 RX packets:82 errors:0 dropped:0 overruns:0 frame:0 TX packets:82 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:6220 (6.0 KiB) TX bytes:6220 (6.0 KiB) mlan0 Link encap:Ethernet HWaddr d8:c0:a6:6e:8f:7d BROADCAST MULTICAST MTU:1500 Metric:1 RX packets:0 errors:0 dropped:0 overruns:0 frame:0 TX packets:0 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:0 (0.0 B) TX bytes:0 (0.0 B) p2p0 Link encap:Ethernet HWaddr da:c0:a6:6e:8f:7d BROADCAST MULTICAST MTU:1500 Metric:1 RX packets:0 errors:0 dropped:0 overruns:0 frame:0 TX packets:0 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:0 (0.0 B) TX bytes:0 (0.0 B) uap0 Link encap:Ethernet HWaddr d8:c0:a6:6e:90:7d BROADCAST MULTICAST MTU:1500 Metric:1 RX packets:0 errors:0 dropped:0 overruns:0 frame:0 TX packets:0 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:0 (0.0 B) TX bytes:0 (0.0 B) mlan0 æ˜¯ STA æ¨¡å¼çš„æ¥å£ï¼Œp2p0 æ˜¯ P2P æ¨¡å¼çš„æ¥å£ï¼Œuap0 æ˜¯ AP æ¨¡å¼çš„æ¥å£ã€‚\næŸ¥çœ‹é©±åŠ¨ä¿¡æ¯ï¼š\n~# cat /proc/mwlan/adapter0/mlan0/info driver_name = \u0026#34;wlan\u0026#34; driver_version = PCIE8997--16.92.10.p213-MM5X16247.p5-GPL-(FP92) interface_name=\u0026#34;mlan0\u0026#34; firmware_major_version=16.92.10 bss_mode =\u0026#34;Managed\u0026#34; media_state=\u0026#34;Disconnected\u0026#34; mac_address=\u0026#34;d8:c0:a6:6e:8f:7d\u0026#34; é©±åŠ¨æºç é‡Œæœ‰å¤§é‡çš„è°ƒè¯•ä¿¡æ¯ï¼Œæ˜¯é€šè¿‡ PRINTM å‡½æ•°æ‰“å°çš„ï¼Œåˆ†ä¸ºå¤šç§ç±»å‹ï¼Œä¸‹è¡¨åˆ—å‡ºäº†æ‰€æœ‰çš„è°ƒè¯•ä¿¡æ¯ç±»å‹ï¼š\nBit Message type Log format Description Bit 0 MMSG PRINTM(MMSG,\u0026hellip;) Set bit 0 to enable all driver logs with log level MMSG. Bit 1 MFATAL PRINTM(MFATAL,\u0026hellip;) Set bit 1 to enable all driver logs with log level MFATAL. Bit 2 MERROR PRINTM(MERROR,\u0026hellip;) Set bit 2 to enable all driver logs with log level MERROR. Bit 3 MDATA PRINTM(MDATA,\u0026hellip;) Set bit 3 to enable all driver logs with log level MDATA. Bit 4 MCMND PRINTM(MCMND,\u0026hellip;) Set bit 4 to enable all driver logs with log level MCMND. Bit 5 MEVENT PRINTM(MEVENT,\u0026hellip;) Set bit 5 to enable all driver logs with log level MEVENT. Bit 6 MINTR PRINTM(MINTR,\u0026hellip;) Set bit 6 to enable all driver logs with log level MINTR. Bit 7 MIOCTL PRINTM(MIOCTL,\u0026hellip;) Set bit 7 to enable all driver logs with log level MIOCTL. Bit 16 MDAT_D PRINTM(MDAT_D,\u0026hellip;), DBG_HEXDUMP(MDAT_D,\u0026hellip;) Set bit 16 to enable all driver logs with log level MDAT_D and provide the corresponding hexdump in dmesg logs. Bit 17 MCMD_D PRINTM(MCMD_D,\u0026hellip;), DBG_HEXDUMP(MCMD_D,\u0026hellip;) Set bit 17 to enable all driver logs with log level MCMD_D and provide the corresponding hexdump in dmesg logs. Bit 18 MEVT_D PRINTM(MEVT_D,\u0026hellip;), DBG_HEXDUMP(MEVT_D,\u0026hellip;) Set bit 18 to enable all driver logs with log level MEVT_D and provide the corresponding hexdump in dmesg logs. Bit 19 MFW_D PRINTM(MFW_D,\u0026hellip;), DBG_HEXDUMP(MFW_D,\u0026hellip;) Set bit 19 to enable all driver logs with log level MFW_D and provide the corresponding hexdump in dmesg logs. Bit 20 MIF_D PRINTM(MIF_D,\u0026hellip;), DBG_HEXDUMP(MIF_D,\u0026hellip;) Set bit 20 to enable all driver logs with log level MIF_D and provide the corresponding hexdump in dmesg logs. Bit 28 MENTRY PRINTM(MENTRY,\u0026hellip;), ENTER(), LEAVE() Set bit 28 to enable all driver logs with API entry and exit. Bit 29 MWARN PRINTM(MWARN,\u0026hellip;) Set bit 29 to enable all driver logs with log level MWARN. Bit 30 MINFO PRINTM(MINFO,\u0026hellip;) Set bit 30 to enable all driver logs with log level MINFO. æ¨¡å—å‚æ•° drvdbg ï¼ŒæŒ‰ä½ä½¿èƒ½æˆ–è€…å…³é—­ç‰¹å®šçš„ä¿¡æ¯ç±»å‹ï¼Œä¾‹å¦‚ drvdbg=0x6 ï¼Œè¡¨ç¤ºåªæ‰“å¼€ MFATAL å’Œ MERROR ç±»å‹çš„è°ƒè¯•ä¿¡æ¯ã€‚åŠ è½½é©±åŠ¨åï¼Œå¯ä»¥åœ¨ /sys/ æ–‡ä»¶ç³»ç»Ÿä¸­æŸ¥çœ‹è¿™ä¸ªå‚æ•°çš„å€¼ï¼š\n~# cat /sys/module/moal/parameters/drvdbg 519 è¿™ä¸ªå‚æ•°ä¸èƒ½åœ¨é©±åŠ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®ï¼Œåªèƒ½é€šè¿‡ /proc æ–‡ä»¶ç³»ç»Ÿä¿®æ”¹ï¼Œä¾‹å¦‚å…³é—­ MMSG ä¿¡æ¯ï¼š\n~# echo \u0026#34;drvdbg=518\u0026#34; \u0026gt;\u0026gt; /proc/mwlan/adapter0/uap0/debug ~# cat /sys/module/moal/parameters/drvdbg 518 3. STA æ¨¡å¼ #ä½¿ç”¨ STA æ¨¡å¼å¯ä»¥è®© Wi-Fi æ¨¡å—è¿æ¥ Wi-Fi çƒ­ç‚¹ã€‚\n3.1 è¿æ¥ #é¦–å…ˆä½¿ç”¨ iw æ‰«æçƒ­ç‚¹ï¼š\n~# iw dev mlan0 scan BSS 60:3a:7c:63:c2:86(on mlan0) TSF: 1394835875 usec (0d, 00:23:14) freq: 2412 beacon interval: 100 TUs capability: ESS Privacy ShortSlotTime RadioMeasure (0x1411) signal: -29.00 dBm last seen: 4 ms ago SSID: TP-LINK_5G_C286 Supported rates: 1.0* 2.0* 5.5* 11.0* 9.0 18.0 36.0 54.0 DS Parameter set: channel 1 ERP: Use_Protection Barker_Preamble_Mode Extended supported rates: 6.0 12.0 24.0 48.0 WPA: * Version: 1 * Group cipher: CCMP * Pairwise ciphers: CCMP * Authentication suites: PSK RSN: * Version: 1 * Group cipher: CCMP * Pairwise ciphers: CCMP * Authentication suites: PSK * Capabilities: 1-PTKSA-RC 1-GTKSA-RC (0x0000) æ–°å»ºä¸€ä¸ª wpa_supplicant çš„é…ç½®æ–‡ä»¶ /etc/wpa_supplicant/wpa_supplicant-mlan0.confï¼Œå†…å®¹å¦‚ä¸‹ï¼š\nctrl_interface=/var/run/wpa_supplicant ctrl_interface_group=wheel update_config=1 è®¾ç½® Wi-Fi çƒ­ç‚¹çš„åç§°å’Œå¯†ç ï¼š\nwpa_passphrase \u0026lt;ESSID\u0026gt; \u0026lt;PASSWORD\u0026gt; \u0026gt;\u0026gt; /etc/wpa_supplicant/wpa_supplicant-mlan0.conf æ‰‹åŠ¨æ‰§è¡Œ wpa_supplicant ï¼š\n~# wpa_supplicant -i mlan0 -Dnl80211 -c /etc/wpa_supplicant/wpa_supplicant-mlan0.conf -B æˆ–è€…ä½¿ç”¨ systemd è¿æ¥ï¼š\n~# systemctl start wpa_supplicant@mlan0 å¦‚æœè¿æ¥æˆåŠŸï¼Œå†…æ ¸ä¼šæ‰“å°å¦‚ä¸‹ä¿¡æ¯ï¼š\n[ 1657.514313] wlan: mlan0 START SCAN [ 1661.922914] wlan: SCAN COMPLETED: scanned AP count=17 [ 1661.957185] wlan: Connected to bssid 60:XX:XX:XX:c2:88 successfully [ 1662.062877] mlan0: [ 1662.062888] wlan: Send EAPOL pkt to 60:XX:XX:XX:c2:88 [ 1662.072089] mlan0: [ 1662.072092] wlan: Send EAPOL pkt to 60:XX:XX:XX:c2:88 [ 1662.080127] IPv6: ADDRCONF(NETDEV_CHANGE): mlan0: link becomes ready [ 1662.087172] woal_cfg80211_set_rekey_data return: gtk_rekey_offload is DISABLE é©±åŠ¨ä¿¡æ¯é‡Œå¯ä»¥çœ‹åˆ°è¿æ¥æˆåŠŸï¼š\n~# more /proc/mwlan/adapter0/mlan0/info driver_name = \u0026#34;wlan\u0026#34; driver_version = PCIE8997--16.92.10.p213-MM5X16247.p5-GPL-(FP92) interface_name=\u0026#34;mlan0\u0026#34; firmware_major_version=16.92.10 bss_mode =\u0026#34;Managed\u0026#34; media_state=\u0026#34;Connected\u0026#34; mac_address=\u0026#34;d8:c0:a6:6e:8f:7d\u0026#34; multicast_count=\u0026#34;10\u0026#34; essid=\u0026#34;TP-LINK_5G_C286\u0026#34; bssid=\u0026#34;60:3a:7c:63:c2:88\u0026#34; channel=\u0026#34;157\u0026#34; å¯åŠ¨ wpa_supplicant åï¼Œå¯ä»¥ç”¨ wpa_cli å‘½ä»¤è°ƒè¯• Wi-Fi è¿æ¥ï¼Œæ¯”å¦‚æŸ¥çœ‹è¿æ¥çŠ¶æ€ï¼š\n~# wpa_cli -i mlan0 status bssid=60:3a:7c:63:c2:88 freq=5785 ssid=TP-LINK_5G_C286 id=1 mode=station pairwise_cipher=CCMP group_cipher=CCMP key_mgmt=WPA2-PSK wpa_state=COMPLETED p2p_device_address=d8:c0:a6:6e:8f:7d address=d8:c0:a6:6e:8f:7d uuid=15f39fc6-08ec-59cd-82d8-8991c864b6c3 ieee80211ac=1 ä½¿ç”¨ iw å¯ä»¥çœ‹åˆ°æ›´åº•å±‚çš„çŠ¶æ€æ•°æ®ï¼š\n~# iw dev mlan0 info Interface mlan0 ifindex 3 wdev 0x1 addr d8:c0:a6:6e:8f:7d ssid TP-LINK_5G_C286 type managed wiphy 0 channel 157 (5785 MHz), width: 80 MHz, center1: 5775 MHz txpower 24.00 dBm ~# iw dev mlan0 link Connected to 60:3a:7c:63:c2:88 (on mlan0) SSID: TP-LINK_5G_C286 freq: 5785 RX: 111781 bytes (1487 packets) TX: 44737 bytes (734 packets) signal: -37 dBm rx bitrate: 6.0 MBit/s tx bitrate: 702.0 MBit/s VHT-MCS 8 80MHz VHT-NSS 2 bss flags: dtim period: 1 beacon int: 100 3.2 è·å– IP #è¿æ¥æˆæˆåŠŸåï¼Œè¿˜éœ€è¦é€šè¿‡ DHCP è·å¾— IP ã€‚å¯ä»¥ç”¨ udhcpc å‘½ä»¤è·å– IP ï¼š\n~# udhcpc -i mlan0 -b udhcpc: started, v1.31.0 udhcpc: sending discover udhcpc: sending select for 192.168.1.103 udhcpc: lease of 192.168.1.103 obtained, lease time 7200 /etc/udhcpc.d/50default: Adding DNS 192.168.0.99 /etc/udhcpc.d/50default: Adding DNS 223.5.5.5 å¦‚æœç³»ç»Ÿæ”¯æŒ systemd-networkd æœåŠ¡ç®¡ç†ç½‘å¡ï¼Œä¹Ÿå¯ä»¥åœ¨ /etc/systemd/network/ ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªç½‘å¡çš„é…ç½®æ–‡ä»¶ 12-mlan0.network ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\n[Match] Name=mlan0 [Network] DHCP=yes ç„¶åé‡å¯æœåŠ¡ï¼š\n~# systemctl restart systemd-networkd å¯ä»¥çœ‹åˆ°ç½‘å¡æˆåŠŸè·å– IP ï¼š\n~# ifconfig lo Link encap:Local Loopback inet addr:127.0.0.1 Mask:255.0.0.0 inet6 addr: ::1/128 Scope:Host UP LOOPBACK RUNNING MTU:65536 Metric:1 RX packets:82 errors:0 dropped:0 overruns:0 frame:0 TX packets:82 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:6220 (6.0 KiB) TX bytes:6220 (6.0 KiB) mlan0 Link encap:Ethernet HWaddr d8:c0:a6:6e:8f:7d inet addr:192.168.1.103 Bcast:192.168.1.255 Mask:255.255.255.0 inet6 addr: fe80::dac0:a6ff:fe6e:8f7d/64 Scope:Link UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:17 errors:0 dropped:0 overruns:0 frame:0 TX packets:45 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:3261 (3.1 KiB) TX bytes:5822 (5.6 KiB) 3.3 ä½¿ç”¨ wpa_cli #é…ç½®æ–‡ä»¶çš„ ctrl_interface é€‰é¡¹æŒ‡å®šäº† socket æ–‡ä»¶ï¼ˆ/var/run/wpa_supplicantï¼‰ï¼Œwpa_supplicant å¯åŠ¨åï¼Œå¯ä»¥ä½¿ç”¨ wpa_cli ä¸ wpa_supplicant é€šè®¯ï¼Œè°ƒè¯•å’Œç»´æŠ¤ Wi-Fi è¿æ¥ã€‚\næ‰«æçƒ­ç‚¹ï¼Œç„¶åæ‰“å°æ‰«æç»“æœï¼š\n~# wpa_cli -i mlan0 scan ~# wpa_cli -i mlan0 scan_result æ•ˆæœå¦‚ä¸‹ï¼š\nå‘ wpa_supplicant æ·»åŠ ä¸€ä¸ªç½‘ç»œè¿æ¥ï¼š\n~# wpa_cli -i mlan0 add_network 2 è¯¥å‘½ä»¤ä¼šè¿”å›ä¸€ä¸ªæ–°çš„ç½‘ç»œ ID å·ï¼Œå¦‚æœ wpa_supplicant.conf æ–‡ä»¶ä¸ºç©ºï¼Œåˆ™è¿”å› 0 ï¼Œè¡¨ç¤ºç¬¬ä¸€ä¸ªç½‘ç»œè¿æ¥ã€‚å› ä¸ºå·²ç»æœ‰ä¸¤ä¸ªè¿æ¥ï¼Œæ‰€ä»¥è¿”å›äº† 2 ï¼š\n~# wpa_cli -i mlan0 list_network network id / ssid / bssid / flags 0 TP-LINK_C286 any 1 TP-LINK_5G_C286 any [CURRENT] 2 any [DISABLED] ç„¶åå‘è¿™ä¸ªç½‘ç»œè¿æ¥æ·»åŠ ä¸€ä¸ª Wi-Fi çƒ­ç‚¹çš„é…ç½®ï¼š\n~# wpa_cli -i mlan0 set_network 2 ssid \u0026#39;\u0026#34;Shaocheng\u0026#34;\u0026#39; OK ~# wpa_cli -i mlan0 set_network 2 psk \u0026#39;\u0026#34;1234567890\u0026#34;\u0026#39; OK å¦‚æœæ˜¯æ²¡æœ‰å¯†ç çš„ Wi-Fi çƒ­ç‚¹ï¼ŒæŒ‰å¦‚ä¸‹è®¾ç½®ï¼š\nwpa_cli -i mlan0 set_network 2 key_mgmt NONE å¦‚æœè¦ä¿®æ”¹å¯†ç å¯ä»¥æ‰§è¡Œï¼š\nwpa_cli -i mlan0 set_network 2 key_mgmt NONE è®¾ç½®ç½‘ç»œä¼˜å…ˆçº§ï¼Œæ•°å€¼è¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼š\n~# wpa_cli -i mlan0 set_network 2 priority 2 OK è®¾ç½® scan_ssid ä¸º 1 ï¼Œè¡¨ç¤ºæ‰«æè¿™ä¸ª SSID ï¼Œå¦‚æœä¸º 0 ï¼Œè¡¨ç¤ºå¿½ç•¥è¿™ä¸ª SSIDï¼š\n~# wpa_cli -i mlan0 set_network 2 scan_ssid 1 OK ä½¿èƒ½è¿™ä¸ªç½‘ç»œï¼š\n~# wpa_cli -i mlan0 enable_network 2 OK é€‰ä¸­è¿™ä¸ªç½‘ç»œè¿æ¥åï¼Œå¼€å§‹è¿æ¥ï¼š\n~# wpa_cli -i mlan0 select_network 2 OK å½“å‰è¿æ¥çš„ç½‘ç»œå˜ä¸º ID 2 ï¼š\n~# wpa_cli -i mlan0 list_network network id / ssid / bssid / flags 0 TP-LINK_C286 any [DISABLED] 1 TP-LINK_5G_C286 any [DISABLED] 2 Shaocheng any [CURRENT] è¿æ¥æˆåŠŸåï¼Œè¿˜éœ€è¦é‡æ–°è·å– IP :\n~# udhcpc -i mlan0 -b -q udhcpc: started, v1.31.0 udhcpc: sending discover udhcpc: sending select for 172.20.10.9 udhcpc: lease of 172.20.10.9 obtained, lease time 86400 /etc/udhcpc.d/50default: Adding DNS 172.20.10.1 è°ƒè¯•æˆåŠŸåï¼Œå¯ä»¥å°†å½“å‰çš„ç½‘ç»œé…ç½®ä¿å­˜åˆ°é…ç½®æ–‡ä»¶ï¼š\n~# wpa_cli -i mlan0 save_config OK æƒ³è¦æ–­å¼€çƒ­ç‚¹æ—¶å¯ä»¥æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š\nwpa_cli -i mlan0 disable_network 2 //ä¸ ID 2 çš„ç½‘ç»œè¿›è¡Œæ–­å¼€ wpa_cli -i mlan0 remove_network 2 //å°† ID 2 çš„ç½‘ç»œç§»é™¤æ‰,å¿…é¡»å…ˆæ–­å¼€æ‰è¡Œ wpa_cli -i mlan0 save_config //æ›´æ–°é…ç½®æ–‡ä»¶ å¦‚æœç›´æ¥æ‰§è¡Œ wpa_cli ï¼Œä¸å¸¦å‚æ•°ï¼Œä¼šè¿›å…¥äº¤äº’æ¨¡å¼ï¼Œæ‰§è¡Œ help æŸ¥çœ‹æ‰€æœ‰æŒ‡ä»¤ï¼Œæ–¹ä¾¿è°ƒè¯•ã€‚\n4. AP æ¨¡å¼ #ä½¿ç”¨ AP æ¨¡å¼å¯ä»¥å°† Wi-Fi æ¨¡å—ä½œä¸ºçƒ­ç‚¹ï¼ŒAP æ¨¡å¼çš„æ¥å£æ˜¯ uap0 ï¼Œéœ€è¦å…ˆè®¾ç½®ä¸€ä¸ªé™æ€ IP ï¼š\nifconfig uap0 172.31.255.1 netmask 255.255.255.0 up 4.1 å¯åŠ¨ hostapd #æ–°å»º /etc/hostapd-uap0.conf æ–‡ä»¶ï¼Œæ·»åŠ  WPA/WPA2-PSK è®¤è¯æ–¹å¼çš„é…ç½®é€‰é¡¹ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\nctrl_interface=/var/run/hostapd interface=uap0 driver=nl80211 ieee80211n=1 country_code=CN ssid=NXP_AP hw_mode=a channel=0 macaddr_acl=0 auth_algs=1 ignore_broadcast_ssid=0 wpa=3 wpa_passphrase=12345678 wpa_key_mgmt=WPA-PSK wpa_pairwise=TKIP rsn_pairwise=CCMP å¯åŠ¨ hostapd ï¼š\n~# hostapd /etc/hostapd-uap0.conf -B å¯åŠ¨è¿‡ç¨‹ä¸­ï¼Œå†…æ ¸ä¼šæ‰“å°å¦‚ä¸‹ä¿¡æ¯ï¼š\n[ 100.479639] wlan: SCAN COMPLETED: scanned AP count=5 [ 100.872225] wlan: SCAN COMPLETED: scanned AP count=6 [ 101.264337] wlan: SCAN COMPLETED: scanned AP count=3 [ 101.661716] wlan: SCAN COMPLETED: scanned AP count=1 [ 102.056751] wlan: SCAN COMPLETED: scanned AP count=4 [ 102.093045] wlan: Starting AP [ 102.096548] Get ht_cap from beacon ies: 0xc [ 102.101107] fw doesn\u0026#39;t support 11ax [ 102.114610] wlan: AP started [ 102.117540] IPv6: ADDRCONF(NETDEV_CHANGE): uap0: link becomes ready [ 102.125433] Set AC=3, txop=47 cwmin=3, cwmax=7 aifs=1 [ 102.132663] Set AC=2, txop=94 cwmin=7, cwmax=15 aifs=1 [ 102.139977] Set AC=0, txop=0 cwmin=15, cwmax=63 aifs=3 [ 102.147327] Set AC=1, txop=0 cwmin=15, cwmax=1023 aifs=7 å¯åŠ¨æˆåŠŸåï¼Œç”¨ hostapd_cli æŸ¥çœ‹çŠ¶æ€ï¼š\n~# hostapd_cli -i uap0 status state=ENABLED phy=mwiphy0 freq=5180 num_sta_non_erp=0 num_sta_no_short_slot_time=0 num_sta_no_short_preamble=0 olbc=0 num_sta_ht_no_gf=0 num_sta_no_ht=0 num_sta_ht_20_mhz=0 num_sta_ht40_intolerant=0 olbc_ht=0 ht_op_mode=0x0 cac_time_seconds=0 cac_time_left_seconds=N/A channel=36 secondary_channel=0 ieee80211n=1 ieee80211ac=0 ieee80211ax=0 beacon_int=100 dtim_period=2 ht_caps_info=000c ht_mcs_bitmask=ffff0000010000000000 supported_rates=0c 12 18 24 30 48 60 6c max_txpower=23 bss[0]=uap0 bssid[0]=d8:c0:a6:6e:90:7d ssid[0]=NXP_AP num_sta[0]=0 æ­¤æ—¶ï¼Œç”¨æ‰‹æœºå¯ä»¥æœåˆ°åä¸º NXP_AP çš„çƒ­ç‚¹ï¼Œå¯†ç  12345678ï¼Œå¯ä»¥è¿æ¥ï¼Œä½†æ˜¯æ— æ³•è·å– IP ï¼Œå› ä¸ºæœ¬æœºæ²¡æœ‰æä¾› DHCP æœåŠ¡ã€‚\n4.2 åˆ†é… IP #å¯ä»¥ä½¿ç”¨ udhcpd å¯åŠ¨ DHCP æœåŠ¡ï¼Œæƒ³ Wi-Fi ç»ˆç«¯åˆ†é… IPã€‚æ–°å»ºé…ç½®æ–‡ä»¶ /etc/udhcpd-uap0.conf ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\ninterface uap0 start 192.168.1.100 end 192.168.1.199 remaining yes lease_file\t/var/lib/misc/udhcpd.leases å¯åŠ¨ udhcpd ï¼š\n~# udhcpd /etc/udhcpd-uap0.conf ç”¨æ‰‹æœºé‡æ–°è¿æ¥ï¼Œå¯ä»¥è·å¾— IP ã€‚ç”¨ hostapd_cli å¯ä»¥åˆ—å‡ºå·²è¿æ¥çš„ STA è®¾å¤‡ï¼š\n~# hostapd_cli -i uap0 list_sta ce:53:7d:79:65:a5 udhcpd æ˜¯ busybox æä¾›çš„ DHCP Server ï¼Œå¦‚æœå¯¹åŠŸèƒ½å’Œç¨³å®šæ€§æœ‰è¦æ±‚ï¼Œå¯ä»¥ä½¿ç”¨ dnsmasq ã€‚\n4.3 ä½¿ç”¨ hostapd_cli #é…ç½®æ–‡ä»¶çš„ ctrl_interface é€‰é¡¹æŒ‡å®šäº† socket æ–‡ä»¶ï¼ˆ/var/run/hostapdï¼‰ï¼Œhostapd å¯åŠ¨åï¼Œå¯ä»¥ä½¿ç”¨ hostapd_cli ä¸ hostapd é€šè®¯ï¼Œè°ƒè¯•å’Œç»´æŠ¤ hostapd ã€‚\nåˆ—å‡ºæ‰€æœ‰ STA çš„è¯¦ç»†ä¿¡æ¯ï¼š\n~# hostapd_cli -i uap0 all_sta ce:53:7d:79:65:a5 flags=[AUTH][ASSOC][AUTHORIZED] aid=0 capability=0x0 listen_interval=0 supported_rates=0c 18 30 timeout_next=NULLFUNC POLL dot11RSNAStatsSTAAddress=ce:53:7d:79:65:a5 dot11RSNAStatsVersion=1 dot11RSNAStatsSelectedPairwiseCipher=00-0f-ac-4 dot11RSNAStatsTKIPLocalMICFailures=0 dot11RSNAStatsTKIPRemoteMICFailures=0 wpa=2 AKMSuiteSelector=00-0f-ac-2 hostapdWPAPTKState=11 hostapdWPAPTKGroupState=0 rx_packets=83 tx_packets=18 rx_bytes=9712 tx_bytes=2031 inactive_msec=0 signal=-56 rx_rate_info=0 tx_rate_info=0 connected_time=515 4.4 udhcpd.leases #å› ä¸ºé…ç½®æ–‡ä»¶ä¸­è®¾ç½®äº† lease_file é€‰é¡¹ï¼Œæœ‰ STA è®¾å¤‡æ¥å…¥çƒ­ç‚¹åï¼Œåœ¨ /var/lib/misc/ ç›®å½•ä¸‹å°±ä¼šç”Ÿæˆä¸€ä¸ª udhcpd.leases æ–‡ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè®°å½•äº†æ‰€æœ‰æ¥å…¥è®¾å¤‡çš„ä¿¡æ¯ï¼š\n~# hexdump -C /var/lib/misc/udhcpd.leases 00000000 00 00 00 00 60 e3 d2 49 00 0d 2e cc ac 1f ff 64 |....`..I.......d| 00000010 ce 53 7d 79 65 a5 00 00 00 00 00 00 00 00 00 00 |.S}ye...........| 00000020 00 00 00 00 00 00 00 00 00 00 00 00 |............| 0000002c æ–‡ä»¶çš„å‰ 8 ä¸ªå­—èŠ‚ä¸ºæœ¬æ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´ï¼Œ0x60e3d249 è½¬æ¢ä¸ºæ•´æ•°æ˜¯1,625,543,241ï¼Œå°±æ˜¯ 2021-07-06 11:47:21 ï¼Œæ¯å½“æœ‰æ–°çš„ sta æ¥å…¥ï¼Œæˆ–è€… auto_time åˆ°æ—¶ï¼ˆé»˜è®¤ 7200 ç§’ï¼‰ï¼Œè¯¥æ–‡ä»¶å°±ä¼šæ›´æ–°ã€‚ä»ç¬¬9ä¸ªå­—èŠ‚å¼€å§‹å°±æ˜¯ struct dyn_lease çš„å†…å®¹:\ntypedef uint32_t leasetime_t; struct dyn_lease { /* \u0026#34;nip\u0026#34;: IP in network order */ /* Unix time when lease expires. Kept in memory in host order. * When written to file, converted to network order * and adjusted (current time subtracted) */ leasetime_t expires; uint32_t lease_nip; /* We use lease_mac[6], since e.g. ARP probing uses * only 6 first bytes anyway. We check received dhcp packets * that their hlen == 6 and thus chaddr has only 6 significant bytes * (dhcp packet has chaddr[16], not [6]) */ uint8_t lease_mac[6]; char hostname[20]; uint8_t pad[2]; /* total size is a multiply of 4 */ }ï¼› è¯¥ç»“æ„ä½“çš„å¤§å°ä¸º 36 ä¸ªå­—èŠ‚ï¼Œå½“æœ‰æ–°çš„ sta æ¥å…¥çƒ­ç‚¹æ—¶ï¼Œä¼šå‘ udhcpd.leases å¢åŠ  36 å­—èŠ‚çš„ä¿¡æ¯ï¼Œåé¢æ¥å…¥çš„ sta ä¼šæ”¾åœ¨æ–‡ä»¶çš„å‰é¢ï¼Œä½†æ˜¯å½“ sta ç¦»å¼€æ—¶ï¼Œä¸ä¼šæŠŠè¯¥ sta çš„ä¿¡æ¯åˆ é™¤ã€‚\næ³¨æ„ï¼Œè¿™ä¸ªæ–‡ä»¶å¹¶ä¸ç¨³å®šï¼Œä¸èƒ½ä¿è¯åŠæ—¶æ›´æ–°ã€‚\n5. å‚è€ƒ #wpa_supplicant ï¼š\nå®˜ç½‘ï¼šhttps://w1.fi/wpa_supplicant/\né…ç½®æ–‡ä»¶ï¼šhttps://w1.fi/cgit/hostap/plain/wpa_supplicant/wpa_supplicant.conf\nhostapdï¼š\nå®˜ç½‘ï¼šhttps://w1.fi/hostapd/\né…ç½®æ–‡ä»¶ï¼šhttps://w1.fi/cgit/hostap/plain/hostapd/hostapd.conf\nudhcpï¼š\nå®˜ç½‘ï¼šhttps://udhcp.busybox.net/ udhcpdï¼šhttps://udhcp.busybox.net/README.udhcpd udhcpd.confï¼šhttps://udhcp.busybox.net/udhcpd.conf udhcpcï¼šhttps://udhcp.busybox.net/README.udhcpc ","date":"2022 February 1","permalink":"/posts/2022/02/01/","section":"Posts","summary":"1. æ¦‚è¿° #ç¡¬ä»¶å¹³å°ä½¿ç”¨ iMX8MM å‚è€ƒå¼€å‘æ¿ï¼Œå¸¦æœ‰ M.","title":"åœ¨ iMX8MM å¹³å°è°ƒè¯• AW-CM276MA Wi-Fi æ¨¡å—"},{"content":"netdevice æ˜¯ glibc æä¾›çš„è®¿é—®ç½‘å¡è®¾å¤‡çš„ä½çº§æ¥å£ï¼Œæ”¯æŒæ ‡å‡† ioctl å‡½æ•°ï¼Œéœ€è¦çš„å¤´æ–‡ä»¶æ˜¯ï¼š\n#include \u0026lt;sys/ioctl.h\u0026gt; #include \u0026lt;net/if.h\u0026gt; ä½¿ç”¨æ–¹æ³•æ˜¯è°ƒç”¨ ioctl å‡½æ•°è®¿é—® socket æ–‡ä»¶ï¼ŒåŸºæœ¬è¯­æ³•æ˜¯ï¼š\nioctl(int fd, int request, struct ifreq *); int fd åº”è¯¥æ˜¯ä¸€ä¸ª socket æ–‡ä»¶æè¿°ç¬¦ï¼Œä¸»è¦é€šè¿‡ struct ifreq ç»“æ„ä¼ é€’æ•°æ®ï¼š\nstruct ifreq { char ifr_name[IFNAMSIZ]; /* Interface name */ union { struct sockaddr ifr_addr; // IP åœ°å€ struct sockaddr ifr_dstaddr; struct sockaddr ifr_broadaddr; // å¹¿æ’­åœ°å€ struct sockaddr ifr_netmask; // å­ç½‘æ©ç  struct sockaddr ifr_hwaddr; // MAC åœ°å€ short ifr_flags; int ifr_ifindex; int ifr_metric; int ifr_mtu; struct ifmap ifr_map; char ifr_slave[IFNAMSIZ]; char ifr_newname[IFNAMSIZ]; char *ifr_data; }; }; ä½¿ç”¨æ–¹æ³•ï¼š\næ–°å»ºä¸€ä¸ª AF_INET åœ°å€çš„ socket æ–‡ä»¶ æ–°å»ºä¸€ä¸ª struct ifreq ç»“æ„ï¼Œå¹¶è®¾ç½® ifr_name ä¸ºæŒ‡å®šçš„ç½‘å¡åç§°ï¼Œä¾‹å¦‚ eth0 è°ƒç”¨ ioctl ï¼Œé€šè¿‡ request æŒ‡å®šè¦è®¿é—®çš„ä¿¡æ¯ï¼Œé€šè¿‡ struct ifreq ç»“æ„ä¼ é€’æ•°æ® è§£æ struct ifreq ç»“æ„ã€‚ æ”¯æŒçš„ request åŒ…æ‹¬ï¼š\nSIOCGIFFLAGS, SIOCSIFFLAGS ï¼šè·å–ã€è®¾ç½®ç½‘å¡çš„ Flag ï¼Œé€šè¿‡ ifreq-\u0026gt;ifr_flags ä¼ é€’æ•°æ®ï¼Œifr_flags åŒ…å«ä¸€ä¸ªç”±ä»¥ä¸‹æ•°å€¼ç»„æˆçš„ä½æ©ç ã€‚\nIFF_UP Interface is running. IFF_BROADCAST Valid broadcast address set. IFF_DEBUG Internal debugging flag. IFF_LOOPBACK Interface is a loopback interface. IFF_POINTOPOINT Interface is a point-to-point link. IFF_RUNNING Resources allocated. IFF_NOARP No arp protocol, L2 destination address not set. IFF_PROMISC Interface is in promiscuous mode. IFF_NOTRAILERS Avoid use of trailers. IFF_ALLMULTI Receive all multicast packets. IFF_MASTER Master of a load balancing bundle. IFF_SLAVE Slave of a load balancing bundle. IFF_MULTICAST Supports multicast IFF_PORTSEL Is able to select media type via ifmap. IFF_AUTOMEDIA Auto media selection active. IFF_DYNAMIC The addresses are lost when the interface goes down. SIOCGIFADDR, SIOCSIFADDR, SIOCDIFADDR ï¼šè·å–ã€è®¾ç½®å’Œåˆ é™¤ç½‘å¡çš„ IP ï¼Œé€šè¿‡ ifreq-\u0026gt;ifr_addr ä¼ é€’æ•°æ®\nSIOCGIFNETMASK, SIOCSIFNETMASK ï¼šè·å–ã€è®¾ç½®å­ç½‘æ©ç ï¼Œé€šè¿‡ ifreq-\u0026gt;ifr_netmask ä¼ é€’æ•°æ®\nSIOCGIFBRDADDR, SIOCSIFBRDADDR ï¼šè·å–ã€è®¾ç½®å¹¿æ’­åœ°å€ï¼Œé€šè¿‡ ifreq-\u0026gt;ifr_broadaddr ä¼ é€’æ•°æ®\nSIOCGIFHWADDR, SIOCSIFHWADDR ï¼šè·å–ã€è®¾ç½® MAC åœ°å€ï¼Œé€šè¿‡ ifreq-\u0026gt;ifr_hwaddr ä¼ é€’æ•°æ®\nSIOCGIFMTU, SIOCSIFMTU ï¼šè·å–ã€è®¾ç½® MTU ï¼Œé€šè¿‡ ifreq-\u0026gt;ifr_mtu ä¼ é€’æ•°æ®\nä¾‹å¦‚ SIOCGIFADDR å¯ä»¥è·å¾— IP åœ°å€ï¼š\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;string.h\u0026gt; #include \u0026lt;sys/socket.h\u0026gt; #include \u0026lt;sys/ioctl.h\u0026gt; #include \u0026lt;net/if.h\u0026gt; #include \u0026lt;netinet/in.h\u0026gt; #include \u0026lt;arpa/inet.h\u0026gt; int main() { int fd; struct ifreq ifr; struct in_addr addr; // 1. æ–°å»ºä¸€ä¸ª socket fd = socket(AF_INET, SOCK_DGRAM, 0); // 2. è®¾ç½®ç½‘å¡åç§° strncpy(ifr.ifr_name, \u0026#34;enp3s0\u0026#34;, IFNAMSIZ - 1); // 3. è¯»å–æŒ‡å®šç½‘å¡çš„ IP ioctl(fd, SIOCGIFADDR, \u0026amp;ifr); // 4. IP å­˜æ”¾åœ¨ ifr.ifr_addr é‡Œ addr = ((struct sockaddr_in *)\u0026amp;ifr.ifr_addr)-\u0026gt;sin_addr; // 5. è½¬æ¢æ ¼å¼ï¼Œå¹¶æ‰“å° printf(\u0026#34;ip address is : %s \u0026lt;%08x\u0026gt;\\n\u0026#34;, inet_ntoa(addr), addr.s_addr); close(fd); } ç¼–è¯‘å’Œæ‰§è¡Œï¼š\n~# gcc test.c -o test ~# ./test ip address is : 172.16.1.1 \u0026lt;010110ac\u0026gt; ä¸€ä¸ªå®Œæ•´çš„ä¾‹ç¨‹ï¼š\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;unistd.h\u0026gt; #include \u0026lt;string.h\u0026gt; #include \u0026lt;sys/types.h\u0026gt; #include \u0026lt;sys/socket.h\u0026gt; #include \u0026lt;sys/ioctl.h\u0026gt; #include \u0026lt;netinet/in.h\u0026gt; #include \u0026lt;net/if.h\u0026gt; #include \u0026lt;arpa/inet.h\u0026gt; struct ifinfo_t { struct in_addr addr; // IP åœ°å€ struct in_addr netmask; // å­ç½‘æ©ç  struct in_addr broadaddr; // å¹¿æ’­åœ°å€ struct in_addr net; // ç½‘æ®µ unsigned char hwaddr[6]; // MAC åœ°å€ int netmask_len; // åè¿›åˆ¶æ ¼å¼çš„å­ç½‘æ©ç  }; // è·å¾—æŒ‡å®šç½‘å¡çš„ IP ä¿¡æ¯ int getifinfo(const char *ifname, struct ifinfo_t *ifinfo) { int fd; int i; int len; unsigned int netmask = 0; struct ifreq ifr; fd = socket(AF_INET, SOCK_DGRAM, 0); strncpy(ifr.ifr_name, ifname, IFNAMSIZ - 1); ioctl(fd, SIOCGIFADDR, \u0026amp;ifr); ifinfo-\u0026gt;addr = ((struct sockaddr_in *)\u0026amp;ifr.ifr_addr)-\u0026gt;sin_addr; ioctl(fd, SIOCGIFNETMASK, \u0026amp;ifr); ifinfo-\u0026gt;netmask = ((struct sockaddr_in *)\u0026amp;ifr.ifr_netmask)-\u0026gt;sin_addr; ioctl(fd, SIOCGIFBRDADDR, \u0026amp;ifr); ifinfo-\u0026gt;broadaddr = ((struct sockaddr_in *)\u0026amp;ifr.ifr_broadaddr)-\u0026gt;sin_addr; ioctl(fd, SIOCGIFHWADDR, \u0026amp;ifr); memcpy(ifinfo-\u0026gt;hwaddr, ifr.ifr_hwaddr.sa_data, 6); netmask = ifinfo-\u0026gt;netmask.s_addr; len = 0; for (i = 0; i \u0026lt; 32; i++) { if (netmask \u0026amp; 0x00000001) len++; netmask = netmask \u0026gt;\u0026gt; 1; } ifinfo-\u0026gt;netmask_len = len; ifinfo-\u0026gt;net.s_addr = ifinfo-\u0026gt;addr.s_addr \u0026amp; ifinfo-\u0026gt;netmask.s_addr; close(fd); return 0; } //åˆ¤æ–­ä¸¤ä¸ª ip æ˜¯å¦å±äºåŒä¸€å­ç½‘ int issamenet(struct in_addr *addr_1, struct in_addr *addr_2, struct in_addr *netmask) { return (addr_1-\u0026gt;s_addr \u0026amp; netmask-\u0026gt;s_addr) == (addr_2-\u0026gt;s_addr \u0026amp; netmask-\u0026gt;s_addr); } int main() { struct ifinfo_t ifinfo; getifinfo(\u0026#34;enp3s0\u0026#34;, \u0026amp;ifinfo); printf(\u0026#34;address : \u0026lt;%08x\u0026gt; %s\\n\u0026#34;, ifinfo.addr.s_addr, inet_ntoa(ifinfo.addr)); printf(\u0026#34;netmask : \u0026lt;%08x\u0026gt; %s\\n\u0026#34;, ifinfo.netmask.s_addr, inet_ntoa(ifinfo.netmask)); printf(\u0026#34;hwaddr : %02x:%02x:%02x:%02x:%02x:%02x\\n\u0026#34;, ifinfo.hwaddr[0],ifinfo.hwaddr[1],ifinfo.hwaddr[2],ifinfo.hwaddr[3],ifinfo.hwaddr[4],ifinfo.hwaddr[5]); printf(\u0026#34;broadaddr : \u0026lt;%08x\u0026gt; %s\\n\u0026#34;, ifinfo.broadaddr.s_addr, inet_ntoa(ifinfo.broadaddr)); printf(\u0026#34;net : \u0026lt;%08x\u0026gt; %s\\n\u0026#34;, ifinfo.net.s_addr, inet_ntoa(ifinfo.net)); printf(\u0026#34;netmask_len : %d\\n\u0026#34;, ifinfo.netmask_len); // åˆ¤æ–­ä¸¤ä¸ª IP æ˜¯å¦å±äºåŒä¸€ä¸ªå­ç½‘ struct in_addr addr_1; struct in_addr addr_2; struct in_addr netmask; int ret = 0; addr_1.s_addr = inet_addr(\u0026#34;172.16.144.138\u0026#34;); addr_2.s_addr = inet_addr(\u0026#34;172.16.144.1\u0026#34;); netmask.s_addr = inet_addr(\u0026#34;255.255.255.240\u0026#34;); ret = issamenet(\u0026amp;addr_1, \u0026amp;addr_2, \u0026amp;netmask); printf(\u0026#34;ret is %d\\n\u0026#34;, ret); return 0; } ç¼–è¯‘å’Œæ‰§è¡Œï¼š\n~# gcc test.c -o test ~# ./test address : \u0026lt;010110ac\u0026gt; 172.16.1.1 netmask : \u0026lt;00ffffff\u0026gt; 255.255.255.0 hwaddr : 00:1d:f3:52:99:0c broadaddr : \u0026lt;ff0110ac\u0026gt; 172.16.1.255 net : \u0026lt;000110ac\u0026gt; 172.16.1.0 netmask_len : 24 ret is 0 å‚è€ƒï¼š\nhttps://man7.org/linux/man-pages/man7/netdevice.7.html\nhttp://www.microhowto.info/howto/get_the_ip_address_of_a_network_interface_in_c_using_siocgifaddr.html\n","date":"2021 October 26","permalink":"/posts/2021/10/26/","section":"Posts","summary":"netdevice æ˜¯ glibc æä¾›çš„è®¿é—®ç½‘å¡è®¾å¤‡çš„ä½çº§æ¥å£ï¼Œæ”¯æŒæ ‡å‡† ioctl å‡½æ•°ï¼Œéœ€è¦çš„å¤´æ–‡ä»¶æ˜¯ï¼š","title":"Linux ä¸‹ä½¿ç”¨ ioctl æ¥å£è®¿é—®æŒ‡å®šç½‘å¡"},{"content":"Fuse å°±æ˜¯ç†”ä¸ä½ï¼Œæ˜¯ä¸€ç§åªèƒ½å†™å…¥ä¸€æ¬¡çš„å¯„å­˜å™¨ï¼Œå†™å…¥åä¸å¯æ›´æ”¹ï¼Œæ‰€ä»¥å†™å…¥æ“ä½œä¹Ÿå«åšçƒ§æ¯ï¼ˆburnedï¼‰ã€‚iMX8MM çš„ Fuse ç”± on-chip eFuse OTP æ§åˆ¶è¯»å†™ï¼Œç®€ç§° OCOPT ï¼Œç»“æ„æ¡†å›¾å¦‚ä¸‹ï¼š\nå¯ä»¥é€šè¿‡ APB æ¥å£è¯»å†™ OCOTP çš„å¯„å­˜å™¨ï¼Œå¯„å­˜å™¨çš„å¸ƒå±€å¯ä»¥åœ¨èŠ¯ç‰‡æ‰‹å†Œçš„ ã€Š6.3.4 OCOTP Memory Map/Register Definitionã€‹ä¸­æŸ¥çœ‹ï¼Œèµ·å§‹åœ°å€æ˜¯ 0x30350000ï¼Œåˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼Œå‰åŠéƒ¨åˆ† 0x30350000~0x3035009C æ˜¯ OCOTP Control Register ï¼Œæ˜¯é…ç½® OCOTP æœ¬èº«çš„å¯„å­˜å™¨ï¼š\nä» 0x30350400 åˆ° 0x303507B0 æ˜¯ Shadow Regs å¯„å­˜å™¨ï¼š\nåœ¨ç¡¬ä»¶ä¸Šï¼ŒShadow Regs å’Œ Fuse æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„å­˜å‚¨è®¾å¤‡ï¼Œä½†æ˜¯ OCOTP çš„å†…éƒ¨æœºåˆ¶å®ç°äº†äºŒè€…ä¹‹é—´çš„æ˜ å°„ï¼ŒFuse çš„æ‰€æœ‰å†…å®¹éƒ½è¢«æ˜ å°„åˆ°äº†è¿™æ®µå¯„å­˜å™¨ä¸­ï¼Œå®Œæ•´çš„æ˜ å°„å¦‚ä¸‹ï¼š\næ€»å¤§å°æ˜¯ 4x256 bytesï¼Œå¤§éƒ¨åˆ†æ˜¯ä¿ç•™çŠ¶æ€ï¼Œä¸å¯è¯»å†™ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ Fuse ä¸­ï¼Œ32bits ç»„æˆä¸€ä¸ª Word ï¼Œ4Words ç»„æˆä¸€ä¸ª Bank ï¼Œè¯»å†™æ—¶ä¹Ÿè¦ç”¨ Bank:Word çš„æ ¼å¼å¯»å€ã€‚å¯ä»¥åœ¨ u-boot ä¸­æ‰§è¡Œ fuse å‘½ä»¤è¯»å†™ fuse ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š\nfuse - Fuse sub-system Usage: fuse read \u0026lt;bank\u0026gt; \u0026lt;word\u0026gt; [\u0026lt;cnt\u0026gt;] - read 1 or \u0026#39;cnt\u0026#39; fuse words, starting at \u0026#39;word\u0026#39; fuse sense \u0026lt;bank\u0026gt; \u0026lt;word\u0026gt; [\u0026lt;cnt\u0026gt;] - sense 1 or \u0026#39;cnt\u0026#39; fuse words, starting at \u0026#39;word\u0026#39; fuse prog [-y] \u0026lt;bank\u0026gt; \u0026lt;word\u0026gt; \u0026lt;hexval\u0026gt; [\u0026lt;hexval\u0026gt;...] - program 1 or several fuse words, starting at \u0026#39;word\u0026#39; (PERMANENT) fuse override \u0026lt;bank\u0026gt; \u0026lt;word\u0026gt; \u0026lt;hexval\u0026gt; [\u0026lt;hexval\u0026gt;...] - override 1 or several fuse words, starting at \u0026#39;word\u0026#39; read - è¯»å–ï¼Œè¡¨ç¤ºä» Shadow Regs ä¸­è¯»å–ã€‚ sense - æ„Ÿåº”ï¼Œè¡¨ç¤ºè·³è¿‡ Shadow Regs ï¼Œç›´æ¥ä» Fuse ä¸­è¯»å–ã€‚ prog - çƒ§æ¯ï¼Œè¡¨ç¤ºç›´æ¥çƒ§å†™ Fuse ï¼Œå†™å…¥ä¸€æ¬¡åå°±æ— æ³•æ›´æ”¹ã€‚ override - æ”¹å†™ï¼Œè¡¨ç¤ºä¿®æ”¹ Shadow Regs ä¸­çš„å€¼ï¼Œä¸ä¼šå½±å“åˆ° Fuse ï¼Œæ‰€ä»¥ï¼Œåœ¨è¿™ä¸ªæ“ä½œä¹‹åï¼ŒShadow Regs å¯èƒ½ä¸ Fuse ä¸­çš„å€¼ä¸åŒã€‚ ç¬¬ä¸€ä¸ªå¯„å­˜å™¨ï¼ˆBank0ï¼ŒWord0ï¼‰æ˜¯ OCOTP_LOCK ï¼š\nå®ƒçš„ä½œç”¨æ˜¯è®¾ç½®å…¶ä»– fuse å¯„å­˜å™¨çš„é”å®šçŠ¶æ€ï¼Œä¾‹å¦‚ï¼ŒBit[1:0] ç”¨äºè®¾ç½® Tester å¯„å­˜å™¨çš„é”å®šçŠ¶æ€ï¼ŒBit[10] ç”¨äºè®¾ç½® SJC å¯„å­˜å™¨çš„é”å®šçŠ¶æ€ï¼š\næ”¯æŒäº”ç§é”å®šçŠ¶æ€ï¼š\nUnlock - å—æ§å­—æ®µå¯ä»¥åœ¨ Shadow Regs ä¸­è¢«è¯»å–ã€æ„Ÿåº”ã€çƒ§æ¯æˆ–æ”¹å†™ã€‚ Lock - å—æ§å­—æ®µä¸èƒ½è¢«è¯»å–ã€çƒ§æ¯æˆ–æ”¹å†™ã€‚ OP - override protectï¼Œå—æ§å­—æ®µå¯ä»¥åœ¨ Shadow Regs ä¸­è¢«è¯»å–ã€æ„Ÿåº”æˆ–çƒ§æ¯ã€‚ WP - write protectï¼Œå—æ§å­—æ®µå¯ä»¥åœ¨ Shadow Regs ä¸­è¢«è¯»å–ã€æ„Ÿåº”æˆ–æ”¹å†™ã€‚ OP+WP - å—æ§å­—æ®µåªèƒ½åœ¨ Shadow Regs ä¸­è¢«è¯»å–æˆ–æ„Ÿåº”åˆ°ï¼Œä½†æ˜¯ä¸èƒ½è¢«çƒ§æ¯æˆ–æ”¹å†™ã€‚ è¿™ä¸ªå¯„å­˜å™¨åœ¨èŠ¯ç‰‡å‡ºå‚æ—¶å·²ç»è¢«å†™å…¥äº†ç‰¹å®šçš„å€¼ï¼Œæ— æ³•æ›´æ”¹ï¼Œå¯ä»¥è¯»å–æŸ¥çœ‹ï¼š\nu-boot=\u0026gt; fuse sense 0 0 Sensing bank 0: Word 0x00000000: feafa9eb å‡ ä¸ªå…³é”®çš„å­—æ®µï¼š\nBit[1:0] TESTER_LOCK = 11ï¼Œæ‰€æœ‰ TESTER å¯„å­˜å™¨åªè¯» Bit[3:2] BOOT_CFG_LOCK = 10ï¼Œæ‰€æœ‰ BOOT_CFG å¯„å­˜å™¨å¯è¯»å¯çƒ§æ¯ï¼Œä¸å¯æ”¹å†™ã€‚ Bit[15:14] MAC_ADDR_LOCK= 10ï¼Œæ‰€æœ‰ MAC_ADDR å¯„å­˜å™¨å¯è¯»å¯çƒ§æ¯ï¼Œä¸å¯æ”¹å†™ã€‚ å­˜å‚¨ MAC åœ°å€æ˜¯ Fuse çš„é‡è¦ç”¨é€”ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œä»¥å¤ªç½‘é©±åŠ¨è·å¾— MAC åœ°å€çš„é¡ºåºæ˜¯ï¼š\nä»è®¾å¤‡æ ‘çš„ä»¥å¤ªç½‘èŠ‚ç‚¹å±æ€§ \u0026ldquo;local-mac-address\u0026rdquo; ä¸­è·å– MAC åœ°å€ã€‚ å¦‚æœè®¾å¤‡æ ‘æ²¡æœ‰è¿™ä¸ªå±æ€§ï¼Œé©±åŠ¨å°±ä» fuse ä¸­è·å– MAC åœ°å€ã€‚ å¦‚æœ fuse æ²¡æœ‰çƒ§å†™ MAC åœ°å€ï¼Œé©±åŠ¨ä» u-boot è®¾ç½®çš„ç¯å¢ƒå˜é‡ä¸­è·å¾—MACåœ°å€ã€‚ å¦‚æœä¸å­˜åœ¨åˆæ³•çš„MACåœ°å€ï¼Œä¼šå‘ç”Ÿé”™è¯¯ã€‚ Fuse ç”¨äº†ä¸‰ä¸ª Wordï¼ˆBank9 Word0~2ï¼‰å­˜å‚¨ä»¥å¤ªç½‘å¡çš„ MAC åœ°å€ï¼Œå¯ä»¥å­˜å‚¨ä¸¤ä¸ª MAC åœ°å€ï¼š\niMX8MM æœ¬èº«åªè¦ä¸€ä¸ªä»¥å¤ªç½‘å¡ï¼Œå ç”¨äº† FEC1_MAC çš„ä½ç½®ï¼Œä¾‹å¦‚ MAC åœ°å€ä¸º 00-04-9F-05-FB-39 æ—¶ï¼š\nu-boot=\u0026gt; fuse read 9 0 4 Reading bank 9: Word 0x00000000: 9f05fb39 00000004 00000000 00000000 å› ä¸º Fuse åªèƒ½çƒ§å†™ä¸€æ¬¡ï¼Œæ‰€æœ‰æœ€å¥½ä¸€æ¬¡çƒ§å†™ä¸¤ä¸ª MAC åœ°å€ï¼Œé˜²æ­¢æ—¥åå¢åŠ ç½‘å¡æ—¶æ— æ³•çƒ§å†™ã€‚å‡è®¾è¦çƒ§å†™çš„ä¸¤ä¸ªåœ°å€æ˜¯ï¼š\nFEC1: 001DF3513075 FEC2: 001DF3513089 åœ¨u-boot ä¸­æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š\nfuse prog 9 2 001DF351 fuse prog 9 1 3089001D fuse prog 9 0 F3513075 å¯åŠ¨åï¼š\nroot@imx8mmevk:~# ifconfig eth0 Link encap:Ethernet HWaddr 00:1d:f3:51:30:75 UP BROADCAST MULTICAST MTU:1500 Metric:1 RX packets:0 errors:0 dropped:0 overruns:0 frame:0 TX packets:0 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:0 (0.0 B) TX bytes:0 (0.0 B) æ‰¹é‡ç”Ÿäº§æ—¶ï¼Œç”¨ uuu çƒ§å†™æ›´æ–¹ä¾¿ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªè„šæœ¬çš„å®ä¾‹ï¼š\nSDP: boot -f imx-boot FB: ucmd fuse prog 9 2 -y 001DF351 FB: ucmd fuse prog 9 1 -y 3089001D FB: ucmd fuse prog 9 0 -y F3513075 å‚è€ƒï¼š\nUnderstanding how to burn eFuses on i.MX8 and i.MX8x families i.MX8 uuu ","date":"2021 July 16","permalink":"/posts/2021/07/16/","section":"Posts","summary":"Fuse å°±æ˜¯ç†”ä¸ä½ï¼Œæ˜¯ä¸€ç§åªèƒ½å†™å…¥ä¸€æ¬¡çš„å¯„å­˜å™¨ï¼Œå†™å…¥åä¸å¯æ›´æ”¹ï¼Œæ‰€ä»¥å†™å…¥æ“ä½œä¹Ÿå«åšçƒ§æ¯ï¼ˆburnedï¼‰ã€‚iMX8MM çš„ Fuse ç”± on-chip eFuse OTP æ§åˆ¶è¯»å†™ï¼Œç®€ç§° OCOPT ï¼Œç»“æ„æ¡†å›¾å¦‚ä¸‹ï¼š","title":"iMX8MM çš„ Fuse/OCOPT å­¦ä¹ ç¬”è®°"},{"content":"1. iMX8MM çš„å¯åŠ¨æµç¨‹ # iMX8MM ç³»ç»Ÿå¯åŠ¨çš„è¯¦ç»†æµç¨‹å¯ä»¥å‚è€ƒ IMX8MMRM.pdf\nä¸Šç”µå¤ä½åï¼Œç¡¬ä»¶å¤ä½é€»è¾‘è¿«ä½¿ SoC ä»ç‰‡ä¸Šçš„ Boot ROM å¼€å§‹æ‰§è¡Œï¼ŒBoot ROM ä½¿ç”¨ BOOT_MODE å’Œ eFUSEs çš„çŠ¶æ€æ¥å†³å®šå¯åŠ¨è®¾å¤‡ã€‚åœ¨ POR_B ä¿¡å·çš„ä¸Šå‡æ²¿é‡‡é›†ä¸¤ä¸ªå¤–éƒ¨è¾“å…¥å¼•è„š BOOT_MODE0 å’Œ BOOT_MODE1 çš„ç”µå¹³ï¼Œç”¨äºè®¾ç½®å¯åŠ¨æ¨¡å¼ï¼š\nBOOT_MODE çš„å€¼å¯ä»¥åœ¨ SRC_SBMR2 å¯„å­˜å™¨çš„ IPP_BOOT_MODE[1:0] ä¸­è¯»åˆ°ã€‚åœ¨ Boot From Fuses æ¨¡å¼ä¸‹ï¼Œå¯åŠ¨æµç¨‹å®Œå…¨ç”± Fuse æ§åˆ¶ï¼ŒGPIO boot overrides å¼•è„šçš„çŠ¶æ€ä¼šè¢«å¿½ç•¥ã€‚åœ¨ internal Boot æ¨¡å¼ä¸‹ï¼Œä½¿ç”¨ Fuse ä¸­çš„å¯åŠ¨é…ç½®ï¼Œä½†æ˜¯ä¸ºäº†å¼€å‘æ–¹ä¾¿ï¼Œç”¨äºç¡®å®šå¯åŠ¨è®¾å¤‡çš„ Fuse å¯ä»¥é€šè¿‡ GPIO boot overrides å¼•è„šçš„è¾“å…¥è¢«è¦†ç›–ï¼Œè¿™æ—¶å¯åŠ¨æµç¨‹ç”± Fuse æˆ–è€… GPIO æ§åˆ¶çš„ BOOT_CFG å¯„å­˜å™¨å†³å®šã€‚é¦–å…ˆä¼šè¯»å– BOOT_CFG[14:12] ï¼Œå†³å®šå¯åŠ¨è®¾å¤‡çš„ç±»å‹ï¼š\nå¦‚æœæ˜¯ä» eMMC/SD å¯åŠ¨ï¼Œå®ƒä»¬éƒ½ä½¿ç”¨ USDHC æ¥å£ä¸ SoC è¿æ¥ï¼ŒBoot ROM ä¼šè¯»å– BOOT_CFG[11:10] çš„å€¼ï¼Œç¡®å®šä»å“ªä¸ªæ¥å£ä¸Šçš„è®¾å¤‡å¯åŠ¨ï¼š\nå¯¹äº eMMC è®¾å¤‡ï¼ŒBoot ROM ä¼šè¯»å– ECSD[179]:PARTITION_CONFIG å¯„å­˜å™¨çš„ BOOT_PARTITION_ENABLE å­—æ®µæ¥ç¡®å®šä» eMMC çš„å“ªä¸ªä½ç½®è·å¾—ç”¨æˆ·ç¨‹åºï¼Œä¾‹å¦‚ BootLoader ä»£ç ï¼Œç„¶åå°†ç”¨æˆ·ç¨‹åºä» eMMC è¯»åˆ°å†…å­˜ï¼Œç”±ç”¨æˆ·ç¨‹åºå¼•å¯¼ç³»ç»Ÿå¯åŠ¨ã€‚\n2. eMMC #eMMC æ˜¯ä¸€ç§å¯ä»¥ç®¡ç†çš„å­˜å‚¨è®¾å¤‡ï¼Œä¸ SD å¡ç±»ä¼¼ï¼Œå®ƒè¿˜æ”¯æŒå•ç‹¬çš„å¯åŠ¨åˆ†åŒºæ¥å­˜å‚¨ BootLoader ç¨‹åºã€‚ä»¥ eMMC5.0 ä¸ºä¾‹ï¼Œå‚è€ƒæ ‡å‡†æ–‡ä»¶ JESD84-B50(eMMC-Spec-V5.0).pdf ï¼ŒeMMC çš„æ•´ä½“æ¶æ„å¦‚ä¸‹ï¼š\nSoC ä½œä¸ºä¸»è®¾å¤‡ï¼Œé€šè¿‡ eMMC æ§åˆ¶æ¨¡å—å‘ eMMC çš„è®¾å¤‡ç®¡ç†æ¥å£å‘é€æŒ‡ä»¤å’Œæ•°æ®ï¼Œå„ä¸ªä¿¡å·çš„ä½œç”¨å¦‚ä¸‹ï¼š\nCLKï¼Œç”¨äºåŒæ­¥çš„æ—¶é’Ÿä¿¡å·ã€‚ Data Strobeï¼Œä» Device ç«¯è¾“å‡ºçš„æ—¶é’Ÿä¿¡å·ï¼Œé¢‘ç‡å¿…é¡»å’Œ CLK ç›¸åŒï¼Œç”¨äºåŒæ­¥ä» Device ç«¯è¾“å‡ºçš„æ•°æ®ã€‚ eMMC 5.0 ä¸­å¼•å…¥ã€‚ CMDï¼Œæ­¤ä¿¡å·ç”¨äºå‘é€ Host çš„ command å’Œ Device çš„ responseã€‚ DATA0-7ï¼Œç”¨äºä¼ è¾“æ•°æ®çš„ 8bit æ€»çº¿ã€‚ eMMC çš„è®¾å¤‡ç®¡ç†å™¨å®šä¹‰äº†å…­ç§å¯„å­˜å™¨ï¼šOCRã€CIDã€CSDã€ECSDã€RCA å’Œ DSRï¼Œåªèƒ½é€šè¿‡ç›¸åº”çš„å‘½ä»¤è®¿é—®ï¼ŒOCRã€CID å’Œ CSD å¯„å­˜å™¨æºå¸¦æœ‰è®¾å¤‡/å†…å®¹çš„å…·ä½“ä¿¡æ¯ï¼Œè€Œ RCA å’Œ DSR å¯„å­˜å™¨æ˜¯å­˜å‚¨å®é™…é…ç½®å‚æ•°çš„é…ç½®å¯„å­˜å™¨ï¼ŒEXT_CSD å¯„å­˜å™¨åŒæ—¶æºå¸¦è®¾å¤‡ç‰¹å®šä¿¡æ¯å’Œå®é™…é…ç½®å‚æ•°ï¼Œè®¾å¤‡æ§åˆ¶å™¨è¿˜é›†æˆäº† Flash è¯»å†™ï¼Œåå—ç®¡ç†ï¼ŒECC æ ¡éªŒç­‰åŠŸèƒ½ï¼Œä¸‹é¢æ˜¯ Micron 8GB eMMC MTFC8GAKAJCN-1M WT æ•°æ®æ‰‹å†Œä¸­çš„æè¿°ï¼š\nFlash Memory çš„æœ€å°è¯»å†™å•ä½æ˜¯å—ï¼ˆblockï¼‰ï¼Œ1 block = 512 Bytes ã€‚eMMC å†…éƒ¨å¯¹ Flash Memory åˆ’åˆ†äº†å‡ ä¸ªç¡¬ä»¶åˆ†åŒºï¼š\nu-boot å’Œ Linux éƒ½æä¾›äº†ç›¸åº”çš„ mmc å‘½ä»¤æ¥è¯»å†™ eMMC ã€‚åœ¨ u-boot é˜¶æ®µï¼Œå¯ä»¥æŸ¥çœ‹ eMMC çš„ä¿¡æ¯ï¼š\nu-boot=\u0026gt; mmc list # åˆ—å‡ºå½“å‰ç³»ç»Ÿçš„ MMC è®¾å¤‡ FSL_SDHC: 1 FSL_SDHC: 2 (eMMC) u-boot=\u0026gt; mmc dev 2 # åˆ‡æ¢åˆ° 2 å· eMMC è®¾å¤‡ u-boot=\u0026gt; mmc info # æ‰“å°å½“å‰ MMC è®¾å¤‡çš„ä¿¡æ¯ Device: FSL_SDHC Manufacturer ID: 13 # å‚å•† ID OEM: 14e Name: Q2J55 Bus Speed: 200000000 # æ€»çº¿é€Ÿç‡ Mode: HS400 (200MHz) # é€Ÿç‡æ¨¡å¼ Rd Block Len: 512 # block çš„å¤§å°ï¼Œå•ä½æ˜¯å­—èŠ‚ MMC version 5.0 # eMMC ç‰ˆæœ¬ High Capacity: Yes Capacity: 7.1 GiB # å®¹é‡ Bus Width: 8-bit DDR # æ€»çº¿å®½åº¦ Erase Group Size: 512 KiB HC WP Group Size: 8 MiB User Capacity: 7.1 GiB WRREL # User Data Area Boot Capacity: 2 MiB ENH # Boot Area Partition RPMB Capacity: 4 MiB ENH # RPMB Partition Linux ç³»ç»Ÿå¯åŠ¨åï¼Œå¯ä»¥çœ‹åˆ°ï¼š\nroot@imx8mmevk:~# ls -l /dev/mmcblk2* brw-rw---- 1 root disk 179, 0 Jul 6 03:33 /dev/mmcblk2 # User Data Area ï¼Œç”¨æˆ·å¯ä»¥æ­¤åŸºç¡€ä¸Šæ–°å»ºé€»è¾‘åˆ†åŒº brw-rw---- 1 root disk 179, 32 Jul 6 03:33 /dev/mmcblk2boot0 # Boot Area Partition 1 brw-rw---- 1 root disk 179, 64 Jul 6 03:33 /dev/mmcblk2boot1 # Boot Area Partition 2 brw-rw---- 1 root disk 179, 1 Jul 6 03:33 /dev/mmcblk2p1 # UDA åŒºåŸŸçš„é€»è¾‘åˆ†åŒºï¼Œç”¨äºå­˜æ”¾å†…æ ¸é•œåƒå’Œè®¾å¤‡æ ‘ brw-rw---- 1 root disk 179, 2 Jul 6 03:33 /dev/mmcblk2p2 # UDA åŒºåŸŸçš„é€»è¾‘åˆ†åŒºï¼Œç”¨äºå­˜æ”¾æ ¹æ–‡ä»¶ç³»ç»Ÿ crw------- 1 root root 237, 0 Jul 6 03:33 /dev/mmcblk2rpmb # RPMB Partition å†…æ ¸å¯åŠ¨ä¿¡æ¯ä¸­ä¹Ÿä¼šæ‰“å°å„åˆ†åŒºçš„å¤§å°ï¼š\nroot@imx8mmevk:~# dmesg | grep mmcblk2 [ 0.000000] Kernel command line: console=ttymxc1,115200 root=/dev/mmcblk2p2 rootwait rw [ 1.986681] mmcblk2: mmc2:0001 Q2J55L 7.13 GiB [ 1.992485] mmcblk2boot0: mmc2:0001 Q2J55L partition 1 2.00 MiB [ 2.002296] mmcblk2boot1: mmc2:0001 Q2J55L partition 2 2.00 MiB [ 2.011031] mmcblk2rpmb: mmc2:0001 Q2J55L partition 3 4.00 MiB, chardev (237:0) ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒBoot Area Partitions çš„å¤§å°éƒ½ä¸º 2MB æˆ–è€… 4MBï¼Œéƒ¨åˆ†èŠ¯ç‰‡å‚å®¶ä¹Ÿä¼šæä¾›é…ç½®çš„æœºä¼šã€‚RPMB é€šå¸¸ä¹Ÿæ˜¯ 4M ï¼Œç”¨äºä¿å­˜å®‰å…¨ç›¸å…³çš„æ•°æ®ã€‚General Purpose Partitions (GPP) åˆ™åœ¨å‡ºå‚æ—¶é»˜è®¤ä¸è¢«æ”¯æŒï¼Œå³ä¸å­˜åœ¨è¿™äº›åˆ†åŒºï¼Œéœ€è¦ç”¨æˆ·ä¸»åŠ¨ä½¿èƒ½ï¼Œå¹¶é…ç½®å…¶æ‰€è¦ä½¿ç”¨çš„ GPP çš„å®¹é‡å¤§å°ï¼ŒGPP çš„æ•°é‡å¯ä»¥ä¸º 1 - 4 ä¸ªï¼Œå„ä¸ª GPP çš„å®¹é‡å¤§å°å¯ä»¥ä¸ä¸€æ ·ã€‚User Data Area (UDA) çš„å®¹é‡å¤§å°åˆ™ä¸ºæ€»å®¹é‡å¤§å°å‡å»å…¶ä»–åˆ†åŒºæ‰€å ç”¨çš„å®¹é‡ã€‚æ¯ä¸€ä¸ªç¡¬ä»¶åˆ†åŒºçš„å­˜å‚¨ç©ºé—´éƒ½æ˜¯ç‹¬ç«‹ç¼–å€çš„ï¼Œå³è®¿é—®åœ°å€ä¸º 0 - partition sizeã€‚å…·ä½“çš„æ•°æ®è¯»å†™æ“ä½œå®é™…è®¿é—®å“ªä¸€ä¸ªç¡¬ä»¶åˆ†åŒºï¼Œæ˜¯ç”± ECSD[179] çš„ PARTITION_CONFIG[2:0]:PARTITION_ACCESS å†³å®šçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç”¨æˆ·åœ¨è®¿é—®ç‰¹å®šçš„åˆ†åŒºå‰ï¼Œéœ€è¦å…ˆå‘é€å‘½ä»¤ï¼Œé…ç½® PARTITION_ACCESSï¼Œç„¶åå†å‘é€ç›¸å…³çš„æ•°æ®è®¿é—®è¯·æ±‚ã€‚PARTITION_CONFIG å¯„å­˜å™¨çš„å®šä¹‰å¦‚ä¸‹ï¼š\nBit 7: Reserved Bit 6: BOOT_ACK (R/W/E) 0x0 : No boot acknowledge sent (default) 0x1 : Boot acknowledge sent during boot operation Bit[5:3] : BOOT_PARTITION_ENABLE (R/W/E), User selects boot data that will be sent to master 0x0 : Device not boot enabled (default) 0x1 : Boot partition 1 enabled for boot 0x2 : Boot partition 2 enabled for boot 0x3â€“0x6 : Reserved 0x7 : User area enabled for boot Bit[2:0] : PARTITION_ACCESS (before BOOT_PARTITION_ACCESS, R/W/E_P), User selects partitions to access 0x0 : No access to boot partition (default) 0x1 : R/W boot partition 1 0x2 : R/W boot partition 2 0x3 : R/W Replay Protected Memory Block (RPMB) 0x4 : Access to General Purpose partition 1 0x5 : Access to General Purpose partition 2 0x6 : Access to General Purpose partition 3 0x7 : Access to General Purpose partition 4 å¦‚æœè¦æ“¦é™¤ Boot Area Partition 1 å¯ä»¥æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤\nu-boot=\u0026gt; mmc partconf 2 0 0 1 # è®¾ç½®è®¿é—® boot partition 1 u-boot=\u0026gt; mmc erase 0 10 # æ“¦é™¤ boot åˆ†åŒºçš„å‰åä¸ª block u-boot=\u0026gt; mmc partconf 2 0 0 0 # è®¾ç½®ä¼šé»˜è®¤å€¼ è¿™ä¸ªå¯„å­˜å™¨çš„å€¼ä¹Ÿå¯ä»¥åœ¨ Linux ç³»ç»Ÿä¸­è¯»å–ï¼š\nroot@imx8mmevk:~# mmc extcsd read /dev/mmcblk2 | grep PARTITION_CONFIG Boot configuration bytes [PARTITION_CONFIG: 0x08] 3. å¯åŠ¨å’Œçƒ§å†™ #BOOT Area Partition ä¸»è¦æ˜¯ä¸ºäº†æ”¯æŒä» eMMC å¯åŠ¨ç³»ç»Ÿè€Œè®¾è®¡çš„ã€‚è¯¥åˆ†åŒºçš„æ•°æ®ï¼Œåœ¨ eMMC ä¸Šç”µåï¼Œå¯ä»¥é€šè¿‡å¾ˆç®€å•çš„åè®®å°±å¯ä»¥è¯»å–å‡ºæ¥ã€‚åŒæ—¶ï¼Œå¤§éƒ¨åˆ†çš„ SoC éƒ½å¯ä»¥é€šè¿‡ GPIO æˆ–è€… Fuse çš„é…ç½®ï¼Œè®© Boot ROM ä»£ç åœ¨ä¸Šç”µåï¼Œå°† BOOT Area Partition åˆ†åŒºçš„å†…å®¹åŠ è½½åˆ° SoC çš„å†…å­˜ä¸­æ‰§è¡Œã€‚Boot Area Partition æœ‰ä¸¤ä¸ªï¼Œå¤§å°æ˜¯å®Œå…¨ä¸€è‡´çš„ï¼Œå¤§å°ç”± ECSD çš„ BOOT_SIZE_MULT å†³å®šï¼š\nå¤§å°çš„è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š\nSize = 128Kbytes x BOOT_SIZE_MULT å¯ä»¥åœ¨ Linux ä¸‹è¯»å–è¿™ä¸ªå¯„å­˜å™¨çš„å€¼ï¼š\nroot@imx8mmevk:~# mmc extcsd read /dev/mmcblk2 | grep BOOT_SIZE Boot partition size [BOOT_SIZE_MULTI: 0x10] # 0x10 è¡¨ç¤º 2MB ä½¿ç”¨ NXP æä¾›çš„ uuu å·¥å…·ï¼Œæ‰§è¡Œ uuu -b emmc imx-boot å‘ eMMC çƒ§å†™ BootLoader æ—¶ï¼Œå°±æ˜¯å°† imx-boot å†™å…¥ BOOT Area Partition 1 ï¼Œå¹¶å°† BOOT_PARTITION_ENABLE è®¾ä¸º 1 ï¼Œè¿™æ ·ä¸Šç”µå¤ä½åï¼ŒBoot ROM ä»£ç å°±ä¼šæŠŠ BOOT Area Partition 1 ä¸­çš„ä»£ç åŠ è½½çš„å†…å­˜æ‰§è¡Œã€‚\nè¿™é‡Œéœ€è¦æ³¨æ„ï¼Œå¦‚æœ BootLoader æ–‡ä»¶çš„å¤§å°è¶…å‡ºäº† BOOT Area Partition çš„å¤§å°ï¼Œçƒ§å†™æ—¶è°ƒè¯•ä¸²å£è¾“å‡ºçš„ä¿¡æ¯ä¿¡æ¯ï¼š\nMMC write: dev # 2, block # 66, count 6550 ... MMC: block number 0x19d8 exceeds max(0x1000) 0 blocks written: ERROR Writing \u0026#39;bootloader\u0026#39; FAILED! è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæœ‰ä¸¤ç§æ–¹æ³•ï¼š\næ›´æ¢ Boot Area Partition æ›´å¤§çš„ eMMC å°† BootLoader æ–‡ä»¶å†™å…¥ User Data Area åˆ†åŒºï¼Œè®¾ç½®ä» User Data Area åˆ†åŒºå¯åŠ¨ã€‚ ä»ä½¿ç”¨çš„è§’åº¦ï¼Œå¦‚æœ eMMC ä¸ä½¿ç”¨ Boot Area Partition ï¼Œé‚£ä¹ˆå®ƒå°±å’Œ SD å¡åŸºæœ¬ä¸€æ ·ï¼ŒSD å¡æ²¡æœ‰ç‹¬ç«‹çš„å¯åŠ¨åˆ†åŒºï¼Œéœ€è¦åœ¨ SoC è§„å®šçš„åœ°å€æ”¾å…¥ç”¨æˆ·ç¨‹åºï¼ŒSoC ä»è¿™ä¸ªåœ°å€å»åŠ è½½å¯åŠ¨ã€‚æ ¹æ® iMX8MM çš„è¦æ±‚ï¼Œç”¨æˆ·ç¨‹åºçš„ç¬¬ä¸€ä¸ªéƒ¨åˆ†å¿…é¡»æ˜¯ä¸€ä¸ªé•œåƒå‘é‡è¡¨ (IVTï¼Œä½äº BootLoader æ–‡ä»¶çš„å¤´éƒ¨) æ•°æ®ç»“æ„ï¼ŒIVT åŒ…å«äº†æ‰§è¡ŒæˆåŠŸå¯åŠ¨æ‰€éœ€çš„æ•°æ®æˆåˆ†ï¼ŒåŒ…æ‹¬ç¨‹åºé•œåƒçš„å…¥å£ç‚¹ï¼Œè®¾å¤‡é…ç½®æ•°æ®ï¼ˆDCDï¼‰çš„æŒ‡é’ˆä»¥åŠå¯åŠ¨è¿‡ç¨‹ä¸­ä½¿ç”¨çš„å…¶ä»–æŒ‡é’ˆã€‚ä¸‹é¢æ˜¯å¯¹äºä¸åŒå­˜å‚¨ä»‹è´¨çš„åœ°å€è¦æ±‚ï¼š\nå¯¹äº eMMC ï¼Œå¿…é¡»æ”¾ UDA åˆ†åŒºåœ¨ 0x8400 åœ°å€ï¼Œç„¶åå°† IVT ä» eMMC è¯»åˆ°å†…å­˜ï¼Œæ ¹æ® IVT ä¸­è®¾ç½®æ‰§è¡Œ BootLoader çš„å…¶ä»–ä»£ç ã€‚IVT çš„å­˜å‚¨åœ°å€æ˜¯ç”¨æˆ·ç¨‹åºä¸­å”¯ä¸€è¦æ±‚å›ºå®šåœ°å€çš„éƒ¨åˆ†ï¼Œç”¨æˆ·ç¨‹åºçš„å…¶ä½™éƒ¨åˆ†å¯ä»¥çµæ´»å¸ƒå±€ï¼Œç”± IVT çš„å†…å®¹å†³å®šã€‚æ¨èå¦‚ä¸‹å¸ƒå±€ï¼ŒBootLoader æ–‡ä»¶æ”¾ç½®åœ¨ 0x8400 åœ°å€ï¼Œä» 0xa00000 å¼€å§‹æ–°å»º FAT å’Œ Ext3 åˆ†åŒºï¼Œæ”¾ç½®å†…æ ¸ã€è®¾å¤‡æ ‘å’Œæ ¹æ–‡ä»¶ç³»ç»Ÿï¼š\nå¯ä»¥ä» SD å¡å¯åŠ¨ä¸€ä¸ª Linux ç³»ç»Ÿï¼Œç„¶åå¯¹ eMMC è¿›è¡Œçƒ§å†™ã€‚ç”¨ dd å‘½ä»¤çƒ§å†™ BootLoader ï¼š\nroot@imx8mmevk:~# dd if=./imx-boot of=/dev/mmcblk2 bs=1k seek=33 conv=fsync # dd å‘½ä»¤åªä¼šä» UDA åˆ†åŒºå¼€å§‹å¯»å€ï¼Œä¸ä¼šçƒ§å†™åˆ°å…¶ä»–åˆ†åŒº å¦‚æœç¼–è¯‘ u-boot æ—¶é€‰æ‹©äº† CONFIG_ENV_IS_IN_MMC ï¼Œu-boot çš„ç¯å¢ƒå˜é‡ä¼šä¿å­˜åˆ° eMMC ï¼Œå­˜å‚¨çš„ä½ç½®ç”±å¦‚ä¸‹ä¸¤ä¸ªé€‰é¡¹å†³å®šï¼š\nCONFIG_ENV_OFFSET , Offset from the start of the device (or partition) CONFIG_ENV_SIZE , Size of the environment storage area . çƒ§å†™ u-boot æ—¶ï¼Œå¦‚æœæ²¡æœ‰æ“¦é™¤è¿™ä¸ªåŒºåŸŸï¼Œé‡å¯åçš„ u-boot è¿˜ä¼šä½¿ç”¨åŸæ¥ä¿å­˜çš„ç¯å¢ƒå˜é‡ã€‚\nFAT å’Œ Ext3 åˆ†åŒºå¯ä»¥ç”¨ fdisk å‘½ä»¤æ–°å»ºï¼Œç„¶åå°†ç›¸å…³æ–‡ä»¶å¤¹æ‹·è´åˆ°åˆ†åŒºä¸­ï¼Œæœ€åå°† BOOT_PARTITION_ENABLE è®¾ä¸º 0 æˆ–è€… 7 ï¼ŒBoot ROM å°±ä¼šä» UDA åˆ†åŒºå¯åŠ¨ï¼š\nroot@imx8mmevk:~# mmc bootpart enable 7 0 /dev/mmcblk2 ä¹Ÿå¯ä»¥åœ¨ u-boot ä¸­è®¾ç½®ï¼š\nu-boot=\u0026gt; mmc partconf 2 0 7 0 å†™å…¥åå¯ä»¥è¯»å‡ºæ¥ç¡®è®¤ä¸€ä¸‹ï¼š\nroot@imx8mmevk:~# mmc extcsd read /dev/mmcblk2 | grep PARTITION_CONFIG Boot configuration bytes [PARTITION_CONFIG: 0x38] ä¸Šé¢æ˜¯æ‰‹åŠ¨å†™å…¥ç³»ç»Ÿé•œåƒçš„æ­¥éª¤ï¼ŒNXP æä¾›çš„ UUU å·¥å…·å¯ä»¥ä½¿ç”¨ä¸²è¡Œä¸‹è½½æ¨¡å¼ï¼Œé€šè¿‡ USB OTG æ¥å£ä»ä¸Šä½æœºæ‰§è¡Œè‡ªå®šä¹‰è„šæœ¬å¯¹ eMMC è¿›è¡Œçƒ§å†™ï¼Œæ‰§è¡Œè¯­æ³•æ˜¯ uuu \u0026lt;script file name\u0026gt; ï¼ŒåŸºæœ¬çš„åŸç†å’Œæ­¥éª¤æ˜¯ï¼š\nä½¿ç”¨ SDP åè®®æŠŠä¸€ä¸ª BootLoader æ–‡ä»¶å†™å…¥å†…å­˜å¹¶å¯åŠ¨ã€‚ å†…å­˜ä¸­çš„ BootLoader ä½¿ç”¨ FB åè®®æŠŠä¸€ä¸ªä¸´æ—¶ Linux ç³»ç»Ÿï¼ˆåŒ…æ‹¬å†…æ ¸ã€è®¾å¤‡æ ‘å’Œæ ¹æ–‡ä»¶ç³»ç»Ÿï¼‰å†™å…¥å†…å­˜å¹¶å¯åŠ¨ã€‚ å†…å­˜ä¸­çš„ä¸´æ—¶ç³»ç»Ÿé€šè¿‡ FBK åè®®æ‰§è¡ŒæŒ‡ä»¤ï¼Œçƒ§å†™ BootLoader ï¼Œå¯¹ eMMC æ ¼å¼åŒ–ï¼Œç„¶åæŠŠæœ€ç»ˆè¦è¿è¡Œçš„ç³»ç»Ÿæ–‡ä»¶ï¼ˆåŒ…æ‹¬å†…æ ¸ã€è®¾å¤‡æ ‘å’Œæ ¹æ–‡ä»¶ç³»ç»Ÿç­‰ï¼‰å¤åˆ¶åˆ°ç›¸åº”çš„åˆ†åŒº ã€‚ è®¾ç½® BOOT_PARTITION_ENABLE çš„å€¼ã€‚ UUU çš„ä½¿ç”¨æ–¹æ³•å¯ä»¥åœ¨ https://github.com/NXPmicro/mfgtools/wiki æŸ¥çœ‹ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªè„šæœ¬å®ä¾‹ï¼š\nuuu_version 1.4.72 # ç”¨äºçƒ§å†™ iMX8MM çš„ eMMC ï¼Œä» User data area å¯åŠ¨ # tools ä¸‹çš„æ–‡ä»¶æ˜¯ä¸´æ—¶ç³»ç»Ÿ # imx-boot\t| BootLoader # Image-imx8mmevk.bin | kernel image, arm64 is Image, arm32 it is zImage # imx8mm-evk.dtb | board dtb file # fsl-image-mfgtool-initramfs-imx_mfgtools.cpio.gz.u-boot\t| mfgtool init ramfs # image ä¸‹çš„æ–‡ä»¶ç”¨äºçƒ§å†™åˆ° eMMC # imx-boot\t| BootLoader # Image\t| kernel image, arm64 is Image, arm32 it is zImage # imx8mm-evk.dtb\t| board dtb file # rootfs.tar.bz2\t| rootfs # tee.bin\t| optee image, put dummy _uTee.tar file here if platform is not MX6/MX7* # å°† BootLoader åŠ è½½åˆ°å†…å­˜å¹¶å¯åŠ¨ # This command will be run when i.MX6/7 i.MX8MM, i.MX8MQ SDP: boot -f tools/imx-boot # This command will be run when ROM support stream mode # i.MX8QXP, i.MX8QM SDPS: boot -f tools/imx-boot # These commands will be run when use SPL and will be skipped if no spl # SDPU will be deprecated. please use SDPV instead of SDPU # { SDPU: delay 1000 SDPU: write -f tools/imx-boot -offset 0x57c00 SDPU: jump # } # These commands will be run when use SPL and will be skipped if no spl # if (SPL support SDPV) # { SDPV: delay 1000 SDPV: write -f tools/imx-boot -skipspl SDPV: jump SDPV: delay 1000 # } # åˆ‡æ¢åˆ° eMMC è®¾å¤‡ FB: ucmd setenv fastboot_dev mmc FB: ucmd setenv mmcdev ${emmc_dev} FB: ucmd mmc dev ${emmc_dev} # é…ç½®åœ¨ eMMC ä»ç”¨æˆ·åˆ†åŒºå¯åŠ¨ FB: ucmd if env exists emmc_ack; then ; else setenv emmc_ack 0; fi; FB: ucmd setenv emmc_cmd mmc partconf ${emmc_dev} ${emmc_ack} 7 0 FB: ucmd if test \u0026#34;${emmc_skip_fb}\u0026#34; != \u0026#34;yes\u0026#34;; then run emmc_cmd; fi # åŠ è½½å†…æ ¸ã€è®¾å¤‡æ ‘ã€rootfs åˆ°å†…å­˜ä¸Šï¼Œå¹¶å¯åŠ¨ FB: ucmd setenv fastboot_buffer ${loadaddr} FB: download -f tools/Image FB: ucmd setenv fastboot_buffer ${fdt_addr} FB: download -f tools/imx8mm-evk.dtb FB: ucmd setenv fastboot_buffer ${initrd_addr} FB: download -f tools/fsl-image-mfgtool-initramfs-imx_mfgtools.cpio.gz.u-boot # FB: ucmd setenv bootargs console=${console},${baudrate} earlycon=${earlycon},${baudrate} FB: acmd ${kboot} ${loadaddr} ${initrd_addr} ${fdt_addr} # get mmc dev number from kernel command line # ç­‰å¾…å¯åŠ¨å®Œæ¯• FBK: ucmd while [ ! -e /dev/mmcblk*boot0 ]; do sleep 1; echo \u0026#34;wait for /dev/mmcblk*boot* appear\u0026#34;; done; # serach emmc device number, if your platform have more than two emmc chip, please echo dev number \u0026gt;/tmp/mmcdev FBK: ucmd dev=`ls /dev/mmcblk*boot*`; dev=($dev); dev=${dev[0]}; dev=${dev#/dev/mmcblk}; dev=${dev%boot*}; echo $dev \u0026gt; /tmp/mmcdev; # dd to clear the possible MBR FBK: ucmd mmc=`cat /tmp/mmcdev`; dd if=/dev/zero of=/dev/mmcblk${mmc} bs=512 count=1 # æ–°å»ºåˆ†åŒº # å‰é¢ 10M ç•™ç»™ BootLoader ï¼Œä» 0xa00000Bytes å¼€å§‹æ–°å»ºä¸€ä¸ª 500M çš„ FAT åˆ†åŒºï¼Œä» 600M å¼€å§‹æ–°å»ºä¸€ä¸ª ext3 åˆ†åŒº FBK: ucmd mmc=`cat /tmp/mmcdev`; PARTSTR=$\u0026#39;10M,500M,0c\\n600M,,83\\n\u0026#39;; echo \u0026#34;$PARTSTR\u0026#34; | sfdisk --force /dev/mmcblk${mmc} # æ ¼å¼åŒ– fat åˆ†åŒºå¹¶æŒ‚è½½ FBK: ucmd mmc=`cat /tmp/mmcdev`; while [ ! -e /dev/mmcblk${mmc}p1 ]; do sleep 1; done FBK: ucmd mmc=`cat /tmp/mmcdev`; mkfs.vfat /dev/mmcblk${mmc}p1 FBK: ucmd mmc=`cat /tmp/mmcdev`; mkdir -p /mnt/fat FBK: ucmd mmc=`cat /tmp/mmcdev`; mount -t vfat /dev/mmcblk${mmc}p1 /mnt/fat # å°† BootLoader å¤åˆ¶åˆ° fat åˆ†åŒºï¼Œå¹¶å†™å…¥ eMMC FBK: ucp image/imx-boot t:/mnt/fat FBK: ucmd mmc=`cat /tmp/mmcdev`; dd if=/mnt/fat/imx-boot of=/dev/mmcblk${mmc} bs=1k seek=33 conv=fsync # å°†å†…æ ¸ã€è®¾å¤‡æ ‘å¤åˆ¶åˆ° fat åˆ†åŒº FBK: ucp image/fat/Image t:/mnt/fat FBK: ucp image/fat/imx8mm-evk.dtb t:/mnt/fat FBK: ucp image/fat/tee.bin t:/tmp/fat FBK: ucmd umount /mnt/fat # æ ¼å¼åŒ– ext3 åˆ†åŒº FBK: ucmd mmc=`cat /tmp/mmcdev`; mkfs.ext3 -F -E nodiscard /dev/mmcblk${mmc}p2 FBK: ucmd mkdir -p /mnt/ext3 FBK: ucmd mmc=`cat /tmp/mmcdev`; mount /dev/mmcblk${mmc}p2 /mnt/ext3 FBK: acmd export EXTRACT_UNSAFE_SYMLINKS=1; tar -jx -C /mnt/ext3 FBK: ucp image/rootfs.tar.bz2 t:- FBK: Sync FBK: ucmd umount /mnt/ext3 FBK: DONE å¦‚æœè¦ä» boot partitions 1 å¯åŠ¨ï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„è„šæœ¬ï¼š\nuuu_version 1.4.72 # ç”¨äºçƒ§å†™ iMX8MM çš„ eMMC ï¼Œä» boot åˆ†åŒºå¯åŠ¨ # tools ä¸‹çš„æ–‡ä»¶æ˜¯ä¸´æ—¶ç³»ç»Ÿ # imx-boot\t| BootLoader # Image-imx8mmevk.bin | kernel image, arm64 is Image, arm32 it is zImage # imx8mm-evk.dtb | board dtb file # fsl-image-mfgtool-initramfs-imx_mfgtools.cpio.gz.u-boot\t| mfgtool init ramfs # image ä¸‹çš„æ–‡ä»¶ç”¨äºçƒ§å†™åˆ° eMMC # imx-boot\t| BootLoader # Image\t| kernel image, arm64 is Image, arm32 it is zImage # imx8mm-evk.dtb\t| board dtb file # rootfs.tar.bz2\t| rootfs # tee.bin\t| optee image, put dummy _uTee.tar file here if platform is not MX6/MX7* # å°† BootLoader åŠ è½½åˆ°å†…å­˜å¹¶å¯åŠ¨ # This command will be run when i.MX6/7 i.MX8MM, i.MX8MQ SDP: boot -f tools/imx-boot # This command will be run when ROM support stream mode # i.MX8QXP, i.MX8QM SDPS: boot -f tools/imx-boot # These commands will be run when use SPL and will be skipped if no spl # SDPU will be deprecated. please use SDPV instead of SDPU # { SDPU: delay 1000 SDPU: write -f tools/imx-boot -offset 0x57c00 SDPU: jump # } # These commands will be run when use SPL and will be skipped if no spl # if (SPL support SDPV) # { SDPV: delay 1000 SDPV: write -f tools/imx-boot -skipspl SDPV: jump SDPV: delay 1000 # } # å°† BootLoader çƒ§å…¥åˆ° eMMC FB: ucmd setenv fastboot_dev mmc FB: ucmd setenv mmcdev ${emmc_dev} FB: flash bootloader image/imx-boot # é…ç½®åœ¨ eMMC å¼•å¯¼åˆ†åŒº 1 å¯åŠ¨ FB: ucmd if env exists emmc_ack; then ; else setenv emmc_ack 0; fi; FB: ucmd setenv emmc_cmd mmc partconf ${emmc_dev} ${emmc_ack} 1 0 FB: ucmd if test \u0026#34;${emmc_skip_fb}\u0026#34; != \u0026#34;yes\u0026#34;; then run emmc_cmd; fi # åŠ è½½å†…æ ¸ã€è®¾å¤‡æ ‘ã€rootfs åˆ°å†…å­˜ä¸Š FB: ucmd setenv fastboot_buffer ${loadaddr} FB: download -f tools/Image FB: ucmd setenv fastboot_buffer ${fdt_addr} FB: download -f tools/imx8mm-evk.dtb FB: ucmd setenv fastboot_buffer ${initrd_addr} FB: download -f tools/fsl-image-mfgtool-initramfs-imx_mfgtools.cpio.gz.u-boot #FB: ucmd setenv bootargs console=${console},${baudrate} earlycon=${earlycon},${baudrate} FB: acmd ${kboot} ${loadaddr} ${initrd_addr} ${fdt_addr} # get mmc dev number from kernel command line # Wait for emmc FBK: ucmd while [ ! -e /dev/mmcblk*boot0 ]; do sleep 1; echo \u0026#34;wait for /dev/mmcblk*boot* appear\u0026#34;; done; # serach emmc device number, if your platform have more than two emmc chip, please echo dev number \u0026gt;/tmp/mmcdev FBK: ucmd dev=`ls /dev/mmcblk*boot*`; dev=($dev); dev=${dev[0]}; dev=${dev#/dev/mmcblk}; dev=${dev%boot*}; echo $dev \u0026gt; /tmp/mmcdev; # dd to clear the possible MBR FBK: ucmd mmc=`cat /tmp/mmcdev`; dd if=/dev/zero of=/dev/mmcblk${mmc} bs=512 count=1 # æ–°å»ºåˆ†åŒº # å‰é¢ 10M ç•™ç»™ BootLoader ï¼Œä» 0xa00000Bytes å¼€å§‹æ–°å»ºä¸€ä¸ª 500M çš„ FAT åˆ†åŒºï¼Œä» 600M å¼€å§‹æ–°å»ºä¸€ä¸ª ext3 åˆ†åŒº FBK: ucmd mmc=`cat /tmp/mmcdev`; PARTSTR=$\u0026#39;10M,500M,0c\\n600M,,83\\n\u0026#39;; echo \u0026#34;$PARTSTR\u0026#34; | sfdisk --force /dev/mmcblk${mmc} # æ ¼å¼åŒ– fat åˆ†åŒºå¹¶æŒ‚è½½ FBK: ucmd mmc=`cat /tmp/mmcdev`; while [ ! -e /dev/mmcblk${mmc}p1 ]; do sleep 1; done FBK: ucmd mmc=`cat /tmp/mmcdev`; mkfs.vfat /dev/mmcblk${mmc}p1 FBK: ucmd mmc=`cat /tmp/mmcdev`; mkdir -p /mnt/fat FBK: ucmd mmc=`cat /tmp/mmcdev`; mount -t vfat /dev/mmcblk${mmc}p1 /mnt/fat # å°†å†…æ ¸ã€è®¾å¤‡æ ‘å¤åˆ¶åˆ° fat åˆ†åŒº FBK: ucp image/fat/Image t:/mnt/fat FBK: ucp image/fat/imx8mm-evk.dtb t:/mnt/fat FBK: ucp image/fat/tee.bin t:/tmp/fat FBK: ucmd umount /mnt/fat # æ ¼å¼åŒ– ext3 åˆ†åŒº FBK: ucmd mmc=`cat /tmp/mmcdev`; mkfs.ext3 -F -E nodiscard /dev/mmcblk${mmc}p2 FBK: ucmd mkdir -p /mnt/ext3 FBK: ucmd mmc=`cat /tmp/mmcdev`; mount /dev/mmcblk${mmc}p2 /mnt/ext3 FBK: acmd export EXTRACT_UNSAFE_SYMLINKS=1; tar -jx -C /mnt/ext3 FBK: ucp image/rootfs.tar.bz2 t:- FBK: Sync FBK: ucmd umount /mnt/ext3 FBK: DONE 4. u-boot mmc #u-boot æä¾›äº†è¯»å†™ eMMC çš„å‘½ä»¤ mmc ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š\nu-boot=\u0026gt; mmc mmc - MMC sub system Usage: mmc info - display info of the current MMC device mmc read addr blk# cnt mmc write addr blk# cnt mmc erase blk# cnt mmc rescan mmc part - lists available partition on current mmc device mmc dev [dev] [part] - show or set current mmc device [partition] mmc list - lists available devices mmc hwpartition [args...] - does hardware partitioning arguments (sizes in 512-byte blocks): [user [enh start cnt] [wrrel {on|off}]] - sets user data area attributes [gp1|gp2|gp3|gp4 cnt [enh] [wrrel {on|off}]] - general purpose partition [check|set|complete] - mode, complete set partitioning completed WARNING: Partitioning is a write-once setting once it is set to complete. Power cycling is required to initialize partitions after set to complete. mmc bootbus dev boot_bus_width reset_boot_bus_width boot_mode - Set the BOOT_BUS_WIDTH field of the specified device mmc bootpart-resize \u0026lt;dev\u0026gt; \u0026lt;boot part size MB\u0026gt; \u0026lt;RPMB part size MB\u0026gt; - Change sizes of boot and RPMB partitions of specified device mmc partconf dev [boot_ack boot_partition partition_access] - Show or change the bits of the PARTITION_CONFIG field of the specified device mmc rst-function dev value - Change the RST_n_FUNCTION field of the specified device WARNING: This is a write-once field and 0 / 1 / 2 are the only valid values. mmc setdsr \u0026lt;value\u0026gt; - set DSR register value 5. Linux mmc #Linux æä¾›çœ‹å¼€æºçš„ eMMC è¯»å†™å·¥å…· mmc-utils ã€‚è¯­æ³•å¦‚ä¸‹ï¼š\nroot@imx8mmevk:~# mmc Usage: mmc extcsd read \u0026lt;device\u0026gt; Print extcsd data from \u0026lt;device\u0026gt;. mmc writeprotect boot get \u0026lt;device\u0026gt; Print the boot partitions write protect status for \u0026lt;device\u0026gt;. mmc writeprotect boot set \u0026lt;device\u0026gt; Set the boot partitions write protect status for \u0026lt;device\u0026gt;. This sets the eMMC boot partitions to be write-protected until the next boot. mmc writeprotect user set \u0026lt;type\u0026gt;\u0026lt;start block\u0026gt;\u0026lt;blocks\u0026gt;\u0026lt;device\u0026gt; Set the write protect configuration for the specified region of the user area for \u0026lt;device\u0026gt;. \u0026lt;type\u0026gt; must be \u0026#34;none|temp|pwron\u0026#34;. \u0026#34;none\u0026#34; - Clear temporary write protection. \u0026#34;temp\u0026#34; - Set temporary write protection. \u0026#34;pwron\u0026#34; - Set write protection until the next poweron. \u0026lt;start block\u0026gt; specifies the first block of the protected area. \u0026lt;blocks\u0026gt; specifies the size of the protected area in blocks. NOTE! The area must start and end on Write Protect Group boundries, Use the \u0026#34;writeprotect user get\u0026#34; command to get the Write Protect Group size. mmc writeprotect user get \u0026lt;device\u0026gt; Print the user areas write protect configuration for \u0026lt;device\u0026gt;. mmc disable 512B emulation \u0026lt;device\u0026gt; Set the eMMC data sector size to 4KB by disabling emulation on \u0026lt;device\u0026gt;. mmc gp create \u0026lt;-y|-n|-c\u0026gt; \u0026lt;length KiB\u0026gt; \u0026lt;partition\u0026gt; \u0026lt;enh_attr\u0026gt; \u0026lt;ext_attr\u0026gt; \u0026lt;device\u0026gt; Create general purpose partition for the \u0026lt;device\u0026gt;. Dry-run only unless -y or -c is passed. Use -c if more partitioning settings are still to come. NOTE! This is a one-time programmable (unreversible) change. To set enhanced attribute to general partition being created set \u0026lt;enh_attr\u0026gt; to 1 else set it to 0. To set extended attribute to general partition set \u0026lt;ext_attr\u0026gt; to 1,2 else set it to 0 mmc enh_area set \u0026lt;-y|-n|-c\u0026gt; \u0026lt;start KiB\u0026gt; \u0026lt;length KiB\u0026gt; \u0026lt;device\u0026gt; Enable the enhanced user area for the \u0026lt;device\u0026gt;. Dry-run only unless -y or -c is passed. Use -c if more partitioning settings are still to come. NOTE! This is a one-time programmable (unreversible) change. mmc write_reliability set \u0026lt;-y|-n|-c\u0026gt; \u0026lt;partition\u0026gt; \u0026lt;device\u0026gt; Enable write reliability per partition for the \u0026lt;device\u0026gt;. Dry-run only unless -y or -c is passed. Use -c if more partitioning settings are still to come. NOTE! This is a one-time programmable (unreversible) change. mmc status get \u0026lt;device\u0026gt; Print the response to STATUS_SEND (CMD13). mmc bootpart enable \u0026lt;boot_partition\u0026gt; \u0026lt;send_ack\u0026gt; \u0026lt;device\u0026gt; Enable the boot partition for the \u0026lt;device\u0026gt;. Disable the boot partition for the \u0026lt;device\u0026gt; if \u0026lt;boot_partition\u0026gt; is set to 0. To receive acknowledgment of boot from the card set \u0026lt;send_ack\u0026gt; to 1, else set it to 0. mmc bootbus set \u0026lt;boot_mode\u0026gt; \u0026lt;reset_boot_bus_conditions\u0026gt; \u0026lt;boot_bus_width\u0026gt; \u0026lt;device\u0026gt; Set Boot Bus Conditions. \u0026lt;boot_mode\u0026gt; must be \u0026#34;single_backward|single_hs|dual\u0026#34; \u0026lt;reset_boot_bus_conditions\u0026gt; must be \u0026#34;x1|retain\u0026#34; \u0026lt;boot_bus_width\u0026gt; must be \u0026#34;x1|x4|x8\u0026#34; mmc bkops enable \u0026lt;device\u0026gt; Enable the eMMC BKOPS feature on \u0026lt;device\u0026gt;. NOTE! This is a one-time programmable (unreversible) change. mmc hwreset enable \u0026lt;device\u0026gt; Permanently enable the eMMC H/W Reset feature on \u0026lt;device\u0026gt;. NOTE! This is a one-time programmable (unreversible) change. mmc hwreset disable \u0026lt;device\u0026gt; Permanently disable the eMMC H/W Reset feature on \u0026lt;device\u0026gt;. NOTE! This is a one-time programmable (unreversible) change. mmc sanitize \u0026lt;device\u0026gt; Send Sanitize command to the \u0026lt;device\u0026gt;. This will delete the unmapped memory region of the device. mmc rpmb write-key \u0026lt;rpmb device\u0026gt; \u0026lt;key file\u0026gt; Program authentication key which is 32 bytes length and stored in the specified file. Also you can specify \u0026#39;-\u0026#39; instead of key file path to read the key from stdin. NOTE! This is a one-time programmable (unreversible) change. Example: $ echo -n AAAABBBBCCCCDDDDEEEEFFFFGGGGHHHH | \\ mmc rpmb write-key /dev/mmcblk0rpmb - mmc rpmb read-counter \u0026lt;rpmb device\u0026gt; Counter value for the \u0026lt;rpmb device\u0026gt; will be read to stdout. mmc rpmb read-block \u0026lt;rpmb device\u0026gt; \u0026lt;address\u0026gt; \u0026lt;blocks count\u0026gt; \u0026lt;output file\u0026gt; [key file] Blocks of 256 bytes will be read from \u0026lt;rpmb device\u0026gt; to output file or stdout if \u0026#39;-\u0026#39; is specified. If key is specified - read data will be verified. Instead of regular path you can specify \u0026#39;-\u0026#39; to read key from stdin. Example: $ echo -n AAAABBBBCCCCDDDDEEEEFFFFGGGGHHHH | \\ mmc rpmb read-block /dev/mmcblk0rpmb 0x02 2 /tmp/block - or read two blocks without verification $ mmc rpmb read-block /dev/mmcblk0rpmb 0x02 2 /tmp/block mmc rpmb write-block \u0026lt;rpmb device\u0026gt; \u0026lt;address\u0026gt; \u0026lt;256 byte data file\u0026gt; \u0026lt;key file\u0026gt; Block of 256 bytes will be written from data file to \u0026lt;rpmb device\u0026gt;. Also you can specify \u0026#39;-\u0026#39; instead of key file path or data file to read the data from stdin. Example: $ (awk \u0026#39;BEGIN {while (c++\u0026lt;256) printf \u0026#34;a\u0026#34;}\u0026#39; | \\ echo -n AAAABBBBCCCCDDDDEEEEFFFFGGGGHHHH) | \\ mmc rpmb write-block /dev/mmcblk0rpmb 0x02 - - mmc cache enable \u0026lt;device\u0026gt; Enable the eMMC cache feature on \u0026lt;device\u0026gt;. NOTE! The cache is an optional feature on devices \u0026gt;= eMMC4.5. mmc cache disable \u0026lt;device\u0026gt; Disable the eMMC cache feature on \u0026lt;device\u0026gt;. NOTE! The cache is an optional feature on devices \u0026gt;= eMMC4.5. mmc csd read \u0026lt;device path\u0026gt; Print CSD data from \u0026lt;device path\u0026gt;. The device path should specify the csd file directory. mmc cid read \u0026lt;device path\u0026gt; Print CID data from \u0026lt;device path\u0026gt;. The device path should specify the cid file directory. mmc scr read \u0026lt;device path\u0026gt; Print SCR data from \u0026lt;device path\u0026gt;. The device path should specify the scr file directory. mmc ffu \u0026lt;image name\u0026gt; \u0026lt;device\u0026gt; Run Field Firmware Update with \u0026lt;image name\u0026gt; on \u0026lt;device\u0026gt;. mmc help|--help|-h Show the help. mmc \u0026lt;cmd\u0026gt; --help Show detailed help for a command or subset of commands. 0.1 ","date":"2021 July 15","permalink":"/posts/2021/07/15/","section":"Posts","summary":"1. iMX8MM çš„å¯åŠ¨æµç¨‹ # iMX8MM ç³»ç»Ÿå¯åŠ¨çš„è¯¦ç»†æµç¨‹å¯ä»¥å‚è€ƒ IMX8MMRM.","title":"iMX8MM ä» eMMC å¯åŠ¨ç³»ç»Ÿå’Œçƒ§å†™çš„ç¬”è®°"},{"content":"åœ¨ VSCode ä¸­å®‰è£… Waveform Render æ’ä»¶ï¼š\nå®ƒå¯ä»¥è§£æ WaveJSON è¯­æ³•çš„ json æ–‡ä»¶ï¼Œç»˜åˆ¶ä¸€å¹…æ•°å­—ç”µè·¯æ—¶åºå›¾ã€‚å®˜ç½‘æä¾›äº†ä¸€ä¸ªå®Œæ•´æ•™ç¨‹ï¼šhttps://wavedrom.com/tutorial.html ï¼Œè¿˜æœ‰ä¸€ä¸ªåœ¨çº¿çš„ç¼–è¾‘å™¨ï¼šhttps://wavedrom.com/editor.html ã€‚\nå¼€å§‹ #åœ¨ vscode ä¸­æ–°å»ºä¸€ä¸ªåä¸º demo.json çš„æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\n{ \u0026#34;signal\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;clk\u0026#34;, \u0026#34;wave\u0026#34;: \u0026#34;p.......\u0026#34; }, { \u0026#34;name\u0026#34;: \u0026#34;data\u0026#34;, \u0026#34;wave\u0026#34;: \u0026#34;01010101\u0026#34; } ] } ä¿å­˜åç”¨ Command+Shift+P ç»„åˆé”®æ‰“å¼€å‘½ä»¤é¢æ¿ï¼Œé€‰æ‹©æ‰§è¡Œ Waveform Render:Draw ï¼Œå°±å¯ä»¥çœ‹åˆ°æ¸²æŸ“åçš„æ—¶åºå›¾ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©æ‰§è¡Œ Waveform Render:Toggle Live Preview ï¼Œå®æ—¶æŸ¥çœ‹æ¸²æŸ“ç»“æœï¼š\nè¿™ä¸ªä¾‹å­å±•ç¤ºäº†åŸºæœ¬çš„ WaveJSON è¯­æ³•ï¼š\nsignal æ˜¯å¿…é¡»çš„å…³é”®è¯ï¼Œå®ƒç”¨ä¸€ä¸ªæ•°ç»„è¡¨ç¤ºä¸€å¹…æ—¶åºå›¾ã€‚ æ•°ç»„å†…æ¯ä¸ªå…ƒç´ æè¿°ä¸€ä¸ªä¿¡å·ã€‚ æ¯ä¸ªå…ƒç´ è‡³å°‘è¦åŒ…å« name å’Œ wave ä¸¤ä¸ªå˜é‡ï¼š name å®šä¹‰äº†ä¿¡å·çš„åç§°ã€‚ wave ç”¨æ¥æè¿°ä¿¡å·çš„æ ·å­ã€‚ wave å®šä¹‰çš„å­—ç¬¦ä¸²ä¸­ï¼Œæ¯ä¸ªå­—ç¬¦ä»£è¡¨ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸï¼ˆ1bitï¼‰ï¼Œé€šè¿‡ä¸åŒçš„å­—ç¬¦æ¥æè¿°ä¿¡å·çš„æ ·å­ï¼š\n0 è¡¨ç¤ºä½ç”µå¹³ï¼Œ1 è¡¨ç¤ºé«˜ç”µå¹³ã€‚ p è¡¨ç¤ºä¸Šå‡æ²¿å¼€å§‹çš„ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸã€‚ . è¡¨ç¤ºä¸ä¸Šä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸç›¸åŒã€‚ è¯­æ³• #å¯¹äºæ—¶é’Ÿä¿¡å·ï¼Œ WaveJSON æ”¯æŒçš„è¯­æ³•æœ‰ï¼š\np è¡¨ç¤ºä¸Šå‡æ²¿å¼€å§‹çš„æ–¹æ³¢ã€‚ n è¡¨ç¤ºä¸‹é™æ²¿å¼€å§‹çš„æ–¹æ³¢ã€‚ l è¡¨ç¤ºä½ç”µå¹³ã€‚ h è¡¨ç¤ºé«˜ç”µå¹³ã€‚ å¦‚æœç”¨å¤§å†™å­—æ¯ï¼Œä¼šåœ¨èµ·å§‹è¾¹æ²¿ç»˜åˆ¶ä¸€ä¸ªç®­å¤´ã€‚ ä¾‹å¦‚ï¼š\n{ \u0026#34;signal\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;pclk\u0026#34;, \u0026#34;wave\u0026#34;: \u0026#34;p.......\u0026#34; }, { \u0026#34;name\u0026#34;: \u0026#34;nclk\u0026#34;, \u0026#34;wave\u0026#34;: \u0026#34;n.......\u0026#34; }, { \u0026#34;name\u0026#34;: \u0026#34;clk0\u0026#34;, \u0026#34;wave\u0026#34;: \u0026#34;lhlhlhlh\u0026#34; }, { \u0026#34;name\u0026#34;: \u0026#34;clk1\u0026#34;, \u0026#34;wave\u0026#34;: \u0026#34;LHLHLHLH\u0026#34; } ] } å¯¹äºæ•°æ®ä¿¡å·ï¼Œé™¤äº† 0 å’Œ 1 ï¼Œè¿˜æ”¯æŒå…¶ä»–è¯­æ³•ï¼š\nx è¡¨ç¤ºæœªçŸ¥çš„æ— æ•ˆçŠ¶æ€ã€‚ = è¡¨ç¤ºæœ‰æ•ˆæ•°æ®ï¼Œä¹Ÿå¯ä»¥å†™æˆ 2~9 ï¼Œä¼šç”¨ä¸åŒçš„é¢œè‰²æ˜¾ç¤ºã€‚ å¯¹äºæœ‰æ•ˆæ•°æ®ï¼Œå¯ä»¥ç”¨ data å˜é‡åŠ ä¸Šæ–‡æœ¬æ ‡ç­¾ã€‚ ä¾‹å¦‚ï¼š\n{ \u0026#34;signal\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;pclk\u0026#34;, \u0026#34;wave\u0026#34;: \u0026#34;p.......\u0026#34; }, { \u0026#34;name\u0026#34;: \u0026#34;data\u0026#34;, \u0026#34;wave\u0026#34;: \u0026#34;01010101\u0026#34; }, { \u0026#34;name\u0026#34;: \u0026#34;data\u0026#34;, \u0026#34;wave\u0026#34;: \u0026#34;x234789x\u0026#34;, \u0026#34;data\u0026#34;: [\u0026#34;head\u0026#34;,\u0026#34;2\u0026#34;,\u0026#34;\u0026#34;,\u0026#34;3\u0026#34;] } ] } è¿˜å¯ä»¥ç”¨ | ç¬¦å·è¡¨ç¤ºä¸€æ®µç©ºç™½ï¼Œä¾‹å¦‚ï¼š\n{ \u0026#34;signal\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;pclk\u0026#34;, \u0026#34;wave\u0026#34;: \u0026#34;p...|...\u0026#34; }, { \u0026#34;name\u0026#34;: \u0026#34;data\u0026#34;, \u0026#34;wave\u0026#34;: \u0026#34;1222|.==\u0026#34; } ] } period å’Œ phase å˜é‡ç”¨äºè°ƒæ•´æ—¶åºï¼š\nperiod çš„å€¼åº”è¯¥æ˜¯ä¸€ä¸ªæ•°å­— n ï¼Œè¡¨ç¤ºæ¨ªå‘ç­‰æ¯”ä¾‹æ”¾å¤§æˆ–ç¼©å°ã€‚ phase çš„å€¼åº”è¯¥æ˜¯ä¸€ä¸ªæ•°å­— n ï¼Œè¡¨ç¤ºæ¨ªå‘çš„ä½ç½®è°ƒæ•´ï¼Œå•ä½æ˜¯ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸï¼š å¦‚æœæ˜¯æ­£æ•°ï¼Œè¡¨ç¤ºå‘å·¦ç§»åŠ¨ n ä¸ªæ—¶é’Ÿå‘¨æœŸã€‚ å¦‚æœæ˜¯è´Ÿæ•°ï¼Œè¡¨ç¤ºå‘å³ç§»åŠ¨ n ä¸ªæ—¶é’Ÿå‘¨æœŸã€‚ ä¾‹å¦‚ï¼š\n{ \u0026#34;signal\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;pclk\u0026#34;, \u0026#34;wave\u0026#34;: \u0026#34;p.......\u0026#34; }, { \u0026#34;name\u0026#34;: \u0026#34;pclk\u0026#34;, \u0026#34;wave\u0026#34;: \u0026#34;p...\u0026#34;, \u0026#34;period\u0026#34;: 2}, { \u0026#34;name\u0026#34;: \u0026#34;data\u0026#34;, \u0026#34;wave\u0026#34;: \u0026#34;01010101\u0026#34; }, { \u0026#34;name\u0026#34;: \u0026#34;data\u0026#34;, \u0026#34;wave\u0026#34;: \u0026#34;01010101\u0026#34;, \u0026#34;phase\u0026#34;: 0.5}, { \u0026#34;name\u0026#34;: \u0026#34;data\u0026#34;, \u0026#34;wave\u0026#34;: \u0026#34;01010101\u0026#34;, \u0026#34;phase\u0026#34;: -1} ] } å¤šä¸ªä¿¡å·å¯ä»¥ç”¨ ['group name', {...}, {...}, ...] è¯­æ³•ç¼–æˆä¸€ç»„ï¼Œè€Œä¸”æ”¯æŒåµŒå¥—ï¼Œä¾‹å¦‚ï¼š\n{ \u0026#34;signal\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;clk\u0026#34;, \u0026#34;wave\u0026#34;: \u0026#34;p..Pp..P\u0026#34; }, [ \u0026#34;Master\u0026#34;, [ \u0026#34;ctrl\u0026#34;, { \u0026#34;name\u0026#34;: \u0026#34;write\u0026#34;, \u0026#34;wave\u0026#34;: \u0026#34;01.0....\u0026#34; }, { \u0026#34;name\u0026#34;: \u0026#34;read\u0026#34;, \u0026#34;wave\u0026#34;: \u0026#34;0...1..0\u0026#34; } ], { \u0026#34;name\u0026#34;: \u0026#34;addr\u0026#34;, \u0026#34;wave\u0026#34;: \u0026#34;x3.x4..x\u0026#34;, \u0026#34;data\u0026#34;: \u0026#34;A1 A2\u0026#34; } ], {}, [\u0026#34;Slave\u0026#34;, [\u0026#34;ctrl\u0026#34;, {\u0026#34;name\u0026#34;: \u0026#34;ack\u0026#34;, \u0026#34;wave\u0026#34;: \u0026#34;x01x0.1x\u0026#34; } ], { \u0026#34;name\u0026#34;: \u0026#34;rdata\u0026#34;, \u0026#34;wave\u0026#34;: \u0026#34;x.....4x\u0026#34;, \u0026#34;data\u0026#34;: \u0026#34;Q2\u0026#34; } ] ] } æ—¶åºç»˜åˆ¶å®Œæ¯•åï¼Œè¿˜å¯ä»¥å¯¹å›¾ç‰‡è¿›è¡Œä¿®é¥°ã€‚ \u0026quot;config\u0026quot;: { \u0026quot;hscale\u0026quot;: n } è¡¨ç¤ºå°†å›¾ç‰‡æ¨ªå‘ç­‰æ¯”ä¾‹æ”¾å¤§ n å€ã€‚\u0026quot;head\u0026quot;:{ } å’Œ \u0026quot;foot\u0026quot;:{ } åˆ†åˆ«è¡¨ç¤ºåœ¨æ—¶åºå›¾çš„ä¸Šæ–¹å’Œä¸‹æ–¹æ·»åŠ ä¸€äº›å†…å®¹ï¼š\ntext å˜é‡åº”è¯¥è®¾ç½®ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæ·»åŠ ä¸€è¡Œæ–‡æœ¬ã€‚ tick å˜é‡åº”è¯¥è®¾ç½®ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºåœ¨æ—¶é’Ÿå‘¨æœŸçš„èµ·ç‚¹æ˜¾ç¤ºåºå·ï¼Œä» n å¼€å§‹ã€‚ tock å˜é‡åº”è¯¥è®¾ç½®ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºåœ¨æ—¶é’Ÿå‘¨æœŸçš„ä¸­ç‚¹æ˜¾ç¤ºåºå·ï¼Œä» n å¼€å§‹ã€‚ ä¾‹å¦‚ï¼š\n{ \u0026#34;signal\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;pclk\u0026#34;, \u0026#34;wave\u0026#34;: \u0026#34;p.......\u0026#34; }, { \u0026#34;name\u0026#34;: \u0026#34;data\u0026#34;, \u0026#34;wave\u0026#34;: \u0026#34;23232323\u0026#34; } ], \u0026#34;config\u0026#34;: { \u0026#34;hscale\u0026#34;: 2 }, \u0026#34;head\u0026#34;: { \u0026#34;text\u0026#34;: \u0026#34;WaveDrom example\u0026#34;, \u0026#34;tick\u0026#34;: 0 }, \u0026#34;foot\u0026#34;: { \u0026#34;text\u0026#34;: \u0026#34;TIME\u0026#34;, \u0026#34;tock\u0026#34;: 0 } } ","date":"2021 July 3","permalink":"/posts/2021/07/03/","section":"Posts","summary":"åœ¨ VSCode ä¸­å®‰è£… Waveform Render æ’ä»¶ï¼š","title":"ä½¿ç”¨ VSCode ç»˜åˆ¶æ•°å­—ç”µè·¯æ—¶åºå›¾"},{"content":"ä»¥ NXP çš„ iMX Yocto 4.9.88 ç³»ç»Ÿç‰ˆæœ¬ä¸ºä¾‹ï¼Œå¯åŠ¨åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼šU-Boot ï¼Œå†…æ ¸ï¼Œæ ¹æ–‡ä»¶ç³»ç»Ÿï¼Œæ¯ä¸ªé˜¶æ®µéƒ½å¯ä»¥è®¾ç½®è‡ªå·±çš„æ˜¾ç¤ºç”»é¢ã€‚\nU-Boot çš„å¯åŠ¨ç”»é¢ #u-boot é˜¶æ®µçš„è¿è¡Œæ—¶å¾ˆçŸ­ï¼Œä¸€èˆ¬ä¸ç”¨ä¿®æ”¹ã€‚å¾…è¡¥å……ã€‚\nå†…æ ¸çš„å¯åŠ¨ç”»é¢ #PPM å›¾ç‰‡æ ¼å¼ #å¦‚æœå¼€å¯äº† FrameBuffer ï¼ŒLinux å†…æ ¸å¯åŠ¨æ—¶ä¼šåœ¨å±å¹•å·¦ä¸Šè§’æ˜¾ç¤ºä¼é¹…å›¾æ ‡ï¼Œå›¾æ ‡çš„æ•°é‡ç­‰äº CPU çš„æ ¸å¿ƒæ•°é‡ã€‚è¿™ä¸ªå›¾æ ‡æ¥è‡ªäºå†…æ ¸æºç çš„ driver/video/logo/ ç›®å½•ä¸‹çš„ ppm æ ¼å¼å›¾ç‰‡ï¼š\n$ ls drivers/video/logo/ clut_vga16.ppm logo_linux_mono.pbm logo_sun_clut224.ppm Kconfig logo_linux_vga16.ppm logo_superh_clut224.ppm logo_blackfin_clut224.ppm logo_m32r_clut224.ppm logo_superh_mono.pbm logo_blackfin_vga16.ppm logo_mac_clut224.ppm logo_superh_vga16.ppm logo.c logo_parisc_clut224.ppm Makefile logo_dec_clut224.ppm logo_sgi_clut224.ppm logo_linux_clut224.ppm logo_spe_clut224.ppm è¿™é‡Œçš„ ppm æ ¼å¼æ˜¯ä¸€ç§ ASCII ç¼–ç çš„å›¾ç‰‡æ–‡ä»¶æ ¼å¼ï¼Œå¯ä»¥ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€ï¼Œä»¥ logo_linux_clut224.ppm ä¸ºä¾‹ ï¼š\nP3 # Standard 224-color Linux logo 80 80 255 0 0 0 0 0 0 0 0 0 0 0 0 äº•å· # å¼€å¤´çš„æ˜¯æ³¨é‡Šï¼Œå¿½ç•¥æ³¨é‡Šåï¼Œå‰ä¸‰è¡Œæ–‡æœ¬æ˜¯æ–‡ä»¶å¤´ï¼š\nç¬¬ä¸€è¡Œè¡¨ç¤ºæ–‡ä»¶ç±»å‹ï¼ŒP3 è¡¨ç¤º ASCII ç¼–ç çš„ RGB ä¸‰è‰²è‰²æ˜¾ç°å›¾åƒ ç¬¬äºŒè¡Œè¡¨ç¤ºå›¾åƒçš„å®½åº¦å’Œé«˜åº¦ï¼Œå•ä½æ˜¯åƒç´  ç¬¬ä¸‰è¡Œè¡¨ç¤ºæœ€å¤§çš„åƒç´ å€¼ æ–‡ä»¶å¤´åé¢æ‰€æœ‰åƒç´ ç‚¹çš„æ•°æ®ï¼Œæ¯ä¸ªåƒç´ ç‚¹æ˜¯ç”± RGBä¸‰ä¸ªæ•°æ®ç»„æˆï¼ŒRGB ä¸­é—´ç”¨ä¸€ä¸ªç©ºæ ¼éš”å¼€ï¼Œåƒç´ ç‚¹ä¹‹é—´ç”±ä¸¤ä¸ªç©ºæ ¼éš”å¼€ï¼Œæ¯ä¸€è¡Œç”¨å›è½¦éš”å¼€ã€‚\nè¿™æ ·çš„æ–‡ä»¶ä¸èƒ½ä¾›å†…æ ¸ç›´æ¥ä½¿ç”¨ï¼Œéœ€è¦è½¬æ¢æˆ C è¯­éŸ³çš„æ ¼å¼ã€‚ç¼–è¯‘å†…æ ¸æ—¶ï¼Œæ‰§è¡Œçš„ drivers/video/logo/Makefile æ–‡ä»¶ä¼šè°ƒç”¨ scripts/pnmtologo å·¥å…·ï¼š\npnmtologo := scripts/pnmtologo # Create commands like \u0026#34;pnmtologo -t mono -n logo_mac_mono -o ...\u0026#34; quiet_cmd_logo = LOGO $@ cmd_logo = $(pnmtologo) \\ -t $(patsubst $*_%,%,$(notdir $(basename $\u0026lt;))) \\ -n $(notdir $(basename $\u0026lt;)) -o $@ $\u0026lt; scripts/pnmtologo æ˜¯ç”¨ scripts/pnmtologo.c ç¼–è¯‘ç”Ÿæˆçš„äºŒè¿›åˆ¶å·¥å…·ï¼Œæ‰§è¡Œçš„è¯­æ³•æ˜¯ï¼š\n./pnmtologo [options] \u0026lt;filename\u0026gt; å¯é€‰é¡¹: -h : æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ -n \u0026lt;name\u0026gt; : ç”Ÿæˆçš„ struct linux_logo ç±»å‹å˜é‡çš„åå­— (default: linux_logo) -o \u0026lt;output\u0026gt; : ç”Ÿæˆçš„ C è¯­éŸ³æºæ–‡ä»¶çš„åå­— -t \u0026lt;type\u0026gt; : å¯åŠ¨ç”»é¢çš„ç±»å‹ mono : monochrome black/white vga16 : 16 colors VGA text palette clut224 : 224 colors (default) gray256 : 256 levels grayscale \u0026lt;filename\u0026gt; æ˜¯è¦è§£æçš„ ppm å›¾ç‰‡çš„æ–‡ä»¶å å®ƒä¼šæŠŠ driver/video/logo/ ç›®å½•ä¸‹ .ppm æ–‡ä»¶è½¬æ¢ä¸ºåŒåçš„ .c æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼Œlogo_linux_clut224.ppm ä¼šè½¬æ¢ä¸º logo_linux_clut224.c ï¼Œé€šè¿‡ä¸€ä¸ª struct linux_logo å˜é‡ä¿å­˜å›¾ç‰‡çš„æ•°æ®ã€‚\næ˜¾ç¤ºå¯åŠ¨ç”»é¢çš„è¿‡ç¨‹ #å†…æ ¸ç»˜åˆ¶ logo æ˜¯ç”± drivers/video/fbdev/core/fbmem.c æ–‡ä»¶ä¸­çš„ fb_show_logo() å®Œæˆçš„ï¼š\nint fb_show_logo(struct fb_info *info, int rotate) { int y; y = fb_show_logo_line(info, rotate, fb_logo.logo, 0, num_online_cpus()); y = fb_show_extra_logos(info, y, rotate); return y; } å‚æ•° info ä¼ é€’çš„ FrameBuffer çš„å±æ€§ï¼Œrotate åˆ™è¡¨ç¤ºå±å¹•çš„æ—‹è½¬æ–¹å‘ã€‚è¿™ä¸ªå‡½æ•°åˆè°ƒç”¨äº† fb_show_logo_line() å‡½æ•°ï¼Œå‚æ•° num_online_cpus() æ˜¯ä¸€ä¸ªå®ï¼Œå®ƒè¿”å›äº† CPU çš„æ ¸å¿ƒæ•°é‡ï¼Œå‚æ•° fb_logo.logo æ˜¯ä¸€ä¸ª struct linux_logo æŒ‡é’ˆï¼Œè¿™ä¸ªç»“æ„è®°å½•äº† logo å›¾ç‰‡çš„åˆ†è¾¨ç‡å’Œåƒç´ æ•°æ®ï¼Œå®ƒæ˜¯åœ¨ fb_prepare_logo() å‡½æ•°ä¸­ç”± fb_find_logo() èµ‹å€¼ï¼š\nint fb_prepare_logo(struct fb_info *info, int rotate) { ... /* Return if no suitable logo was found */ fb_logo.logo = fb_find_logo(depth); ... } å‚æ•° depth è¡¨ç¤º FrameBuffer çš„é¢œè‰²æ·±åº¦ï¼ŒåŸºæœ¬æ˜¯ç”±å±å¹•çš„ç´ è´¨å†³å®šï¼Œfb_find_logo() å‡½æ•°å®šä¹‰åœ¨ drivers/video/logo/logo.c ä¸­ï¼Œå®ƒçš„ä½œç”¨æ˜¯æ ¹æ® depth çš„å€¼å’Œå†…æ ¸é…ç½®å†³å®šç”¨é‚£ä¸ªå›¾ç‰‡ä½œä¸º logo ï¼Œå¦‚æœé¢œè‰²æ·±åº¦æ˜¯ 16 ï¼Œä¸”å†…æ ¸é…ç½®äº† CONFIG_LOGO_LINUX_CLUT224 é€‰é¡¹ï¼Œå°±ç”¨ logo_linux_clut224 ä½œä¸º logo ï¼š\nconst struct linux_logo * __ref fb_find_logo(int depth) { const struct linux_logo *logo = NULL; ... if (depth \u0026gt;= 8) { #ifdef CONFIG_LOGO_LINUX_CLUT224 /* Generic Linux logo */ logo = \u0026amp;logo_linux_clut224; #endif ... return logo; } é…ç½®é€‰é¡¹æ˜¯åœ¨ menuconfig ä¸­çš„ Device Drivers \u0026gt; Graphics support \u0026gt; Bootup logo ä¸­è®¾ç½®çš„ï¼š\nlogo_linux_clut224 æ˜¯ä¸€ä¸ª struct linux_logo ç±»å‹çš„å˜é‡ï¼Œå®šä¹‰åœ¨ logo_linux_clut224.c æ–‡ä»¶ä¸­ï¼Œå®ƒæ˜¯åœ¨ç¼–è¯‘æ—¶ï¼Œç”± drivers/video/logo/Makefile æ–‡ä»¶è°ƒç”¨ scripts/pnmtologo å·¥å…·ï¼Œè¯»å– drivers/video/logo/ ç›®å½•ä¸‹çš„åŒåå›¾ç‰‡ logo_linux_clut224.ppm è§£æåç”Ÿæˆçš„ã€‚å†…å®¹ç±»ä¼¼å¦‚ä¸‹ï¼š\nstatic unsigned char logo_linux_clut224_data[] __initdata = { 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, ... ... }; static unsigned char logo_linux_clut224_clut[] __initdata = { 0xff, 0xff, 0xff, 0xff, 0xff, 0xfd, 0xfe, 0xff, 0xff, 0xff, 0xfe, 0xff, ... ... } const struct linux_logo logo_linux_clut224 __initconst = { .type = LINUX_LOGO_CLUT224, .width = 800, .height = 590, .clutsize = 223, .clut = logo_linux_clut224_clut, .data = logo_linux_clut224_data }; ç¡®å®šäº† logo ç”¨çš„å›¾ç‰‡åï¼Œ fb_show_logo_line() å‡½æ•°ä¼šæ”¹ç”¨ struct fb_image ç»“æ„ä¿å­˜è¦æ˜¾ç¤ºçš„å›¾ç‰‡ï¼š\nstatic int fb_show_logo_line(struct fb_info *info, int rotate, const struct linux_logo *logo, int y, unsigned int n) { struct fb_image image; ... image.depth = 8; //å›¾ç‰‡çš„é¢œè‰²æ·±åº¦å›ºå®šä¸º 8 image.data = logo-\u0026gt;data; //å›¾ç‰‡çš„æ•°æ® image.dx = 0; //ç»˜åˆ¶å›¾ç‰‡çš„èµ·å§‹æ¨ªåæ ‡ï¼Œå±å¹•çš„å·¦ä¸Šè§’ä¸º 0 image.dy = y; //ç»˜åˆ¶å›¾ç‰‡çš„èµ·å§‹çºµåæ ‡ï¼Œä¹Ÿæ˜¯ 0 ï¼Œè¡¨ç¤ºä»å·¦ä¸Šè§’å¼€å§‹æ˜¾ç¤º image.width = logo-\u0026gt;width; //å›¾ç‰‡çš„æ¨ªå‘åˆ†è¾¨ç‡ image.height = logo-\u0026gt;height; //å›¾ç‰‡çš„çºµå‘åˆ†è¾¨ç‡ ... fb_do_show_logo(info, \u0026amp;image, rotate, n); } æœ€åè°ƒç”¨ fb_do_show_logo() å‡½æ•°æ¨ªå‘çš„ç»˜åˆ¶ n ä¸ª image ã€‚å¦‚æœå±å¹•æ˜¯æ­£å‘çš„ï¼Œå›¾ç‰‡ä¼šæŒ‰å¦‚ä¸‹æ–¹å¼ç»˜åˆ¶ï¼š\nstatic void fb_do_show_logo(struct fb_info *info, struct fb_image *image, int rotate, unsigned int num) { ... if (rotate == FB_ROTATE_UR) { for (x = 0; x \u0026lt; num \u0026amp;\u0026amp; image-\u0026gt;dx + image-\u0026gt;width \u0026lt;= info-\u0026gt;var.xres; x++) { info-\u0026gt;fbops-\u0026gt;fb_imageblit(info, image); image-\u0026gt;dx += image-\u0026gt;width + 8; } } ... } æ›´æ¢å¯åŠ¨ç”»é¢ #æ ¹æ® logo çš„æ˜¾ç¤ºåŸç†ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰å¦‚ä¸‹æ­¥éª¤æ›´æ¢å†…æ ¸çš„å¯åŠ¨ç”»é¢ã€‚\né¦–å…ˆå‡†å¤‡ä¸€å¼ å°äºç­‰äºå±å¹•åˆ†è¾¨ç‡çš„ png æ ¼å¼å›¾ç‰‡ï¼Œå‘½åä¸º logo.png ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å°†å…¶è½¬æ¢ä¸º ppm æ ¼å¼ï¼š\n~$ pngtopnm logo.png \u0026gt; logo_linux_clut.pnm ~$ pnmquant 224 logo_linux_clut.pnm \u0026gt; logo_linux_clut224.pnm ~$ pnmtoplainpnm logo_linux_clut224.pnm \u0026gt; logo_linux_clut224.ppm å°†ç”Ÿæˆçš„ logo_linux_clut224.ppm è¦†ç›–åˆ°å†…æ ¸æºç çš„ drivers/video/logo/ ç›®å½•ä¸‹ã€‚\nå¦‚æœ CPU æ˜¯å¤šæ ¸ï¼Œä¸” logo å›¾ç‰‡è·Ÿå±å¹•åˆ†è¾¨ç‡ç›¸åŒï¼Œæƒ³è¦å…¨å±æ˜¾ç¤ºï¼Œå°±ä¿®æ”¹ drivers/video/fbdev/core/fbmem.c æ–‡ä»¶ä¸­çš„ fb_show_logo() å‡½æ•°ï¼Œå°†ç»˜åˆ¶ logo çš„æ•°é‡è®¾ä¸º 1 ï¼š\n@@ -665,7 +665,7 @@ int fb_show_logo(struct fb_info *info, int rotate) int y; y = fb_show_logo_line(info, rotate, fb_logo.logo, 0, - num_online_cpus()); + 1); y = fb_show_extra_logos(info, y, rotate); return y; é»˜è®¤æƒ…å†µä¸‹ï¼Œå›¾ç‰‡ä¼šè´´ç€å±å¹•çš„å·¦ä¸Šè§’ \u0026lt;0,0\u0026gt; æ˜¾ç¤ºã€‚å¦‚æœéœ€è¦å±…ä¸­æ˜¾ç¤ºï¼Œå¯ä»¥åœ¨ drivers/video/fbdev/core/fbmem.c æ–‡ä»¶çš„ fb_show_logo_line() å‡½æ•°ä¸­ä¿®æ”¹å›¾ç‰‡æ˜¾ç¤ºçš„èµ·å§‹åæ ‡ï¼š\n-image.dx=0; -image.dy=y; +image.dx = (info-\u0026gt;var.xres / 2) - (image.width / 2); +image.dy = (info-\u0026gt;var.yres / 2) - (image.height / 2); æŸ¥çœ‹å†…æ ¸çš„ git log å‘ç°ï¼Œåœ¨ 5.0 ä¹‹åçš„ç‰ˆæœ¬ï¼Œé€šè¿‡ commit:3d8b19 æ·»åŠ äº†è®© logo å±…ä¸­æ˜¾ç¤ºçš„é…ç½®é€‰é¡¹ï¼Œä½†æ˜¯å¾ˆå¿«åˆé€šè¿‡ commit/890d14 å°†è¿™ä¸ªåŠŸèƒ½è½¬ç§»åˆ°äº†å‘½ä»¤è¡Œçš„é€‰é¡¹ fbcon=logo-pos:\u0026lt;location\u0026gt; ä¸­ã€‚\nåŠ¨æ€ä¿®æ”¹å¯åŠ¨ç”»é¢ #ä¸Šé¢çš„æ–¹æ³•ä¸­ï¼Œå¯åŠ¨ç”»é¢çš„æ•°æ®å¿…é¡»ç¼–è¯‘åˆ°å†…æ ¸ä¸­ï¼Œæ¯æ¬¡ä¿®æ”¹å¯åŠ¨ç”»é¢éƒ½è¦é‡æ–°ç¼–è¯‘å†…æ ¸ï¼Œä¸å¤ªæ–¹ä¾¿ã€‚eMMC ä¸­æœ‰ä¸€ä¸ªç”¨äºæ”¾ç½®å†…æ ¸å’Œè®¾å¤‡æ ‘æ–‡ä»¶çš„ FAT åˆ†åŒºï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªåˆ†åŒºå’Œ u-boot çš„ load å‘½ä»¤ï¼Œå®ç°åŠ¨æ€ä¿®æ”¹å¯åŠ¨ç”»é¢çš„åŠŸèƒ½ï¼Œå¤§è‡´åŸç†æ˜¯ï¼š\nå°† ppm æ ¼å¼çš„ logo å›¾ç‰‡è½¬æ¢æˆäºŒè¿›åˆ¶æ ¼å¼çš„ ppmlogo.bin æ–‡ä»¶ï¼Œæ”¾åˆ° FAT åˆ†åŒºä¸­ã€‚ u-boot å¯åŠ¨æ—¶ï¼Œè¯»å– ppmlogo.bin æ–‡ä»¶ï¼Œå¹¶å†™å…¥å†…æ ¸çš„ä¿ç•™å†…å­˜ä¸­ã€‚ kernel å¯åŠ¨æ—¶ï¼Œä»ä¿ç•™å†…å­˜çš„ç‰¹å®šä½ç½®è¯»å– ppmlogo.bin çš„æ•°æ®ï¼Œç”¨è¿™ä¸ªæ•°æ®åˆå§‹åŒ– linux_logo å˜é‡ã€‚ é¦–å…ˆå†™ä¸€ä¸ªåä¸º ppmtobin çš„ç¨‹åºï¼Œå¯ä»¥å€Ÿç”¨ script/pnmtologo.c è¿›è¡Œä¿®æ”¹ã€‚å®ƒçš„ä½œç”¨æ˜¯æŠŠä¸€ä¸ª ppm æ ¼å¼çš„ logo å›¾ç‰‡è½¬æ¢æˆå†…æ ¸èƒ½å¤Ÿç›´æ¥è¯»å–çš„äºŒè¿›åˆ¶æ ¼å¼æ–‡ä»¶ ppmlogo.bin ï¼ŒæŠŠè¿™ä¸ªæ–‡ä»¶æ”¾åˆ° eMMC çš„ FAT åˆ†åŒºï¼Œè¯¥æ–‡ä»¶çš„å­˜å‚¨å¸ƒå±€ä¸ struct linux_logo ç›¸åŒï¼š\n* --------------------------------------------- * | 0 1 2 3 (byte) * --------------------------------------------- * 0| logo type * --------------------------------------------- * 4| logo width(w) * --------------------------------------------- * 8| logo height(h) * --------------------------------------------- * 12| logo clutsize * --------------------------------------------- * 16| * ...| logo data * ...| (size = w*h) * --------------------------------------------- * w*h+16| * ...| logo clut * ...| (size = clutsize*3) * --------------------------------------------- ä¸‹ä¸€æ­¥å°±æ˜¯ u-boot ä¸­æ“ä½œã€‚å…ˆç¡®è®¤ä¸€ä¸‹æ¿å¡çš„å†…å­˜ä¿¡æ¯ï¼Œå¯ä»¥åœ¨ u-boot ä¸­æ‰§è¡Œ bdinfo å‘½ä»¤ï¼š\n=\u0026gt; bdinfo arch_number = 0x00000F8C boot_params = 0x10000100 DRAM bank = 0x00000000 -\u0026gt; start = 0x10000000 # å†…å­˜èµ·å§‹åœ°å€ -\u0026gt; size = 0x40000000 # å†…å­˜å¤§å° 1GB ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ logo æ–‡ä»¶åŠ è½½åˆ° 4f000000 åœ°å€åé¢çš„å†…å­˜é‡Œ baudrate = 115200 bps TLB addr = 0x4FFF0000 relocaddr = 0x4FF40000 reloc off = 0x38740000 irq_sp = 0x4EF318C0 sp start = 0x4EF318B0 FB base = 0x4EF46580 Early malloc usage: 114 / 400 ç„¶åç¡®è®¤åˆ†åŒºå’Œæ–‡ä»¶ï¼Œæ˜ç¡® ppplog.bin æ–‡ä»¶çš„è·¯å¾„ï¼š\n=\u0026gt; mmc part Partition Map for MMC device 2 -- Partition Type: DOS Part Start Sector Num Sectors UUID Type 1 20480 1024000 bcd6138c-01 0c 2 1228800 6324224 bcd6138c-02 83 =\u0026gt; fatls mmc 2:1 7679712 zimage 52298 imx6dl-sabresd.dtb 472688 ppmlogo.bin 51391 imx6q-sabresd.dtb å…ˆè¯•è¯•æ‰‹åŠ¨åŠ è½½ï¼Œå°† ppmlogo.bin æ–‡ä»¶åŠ è½½ 4f00000 çš„åœ°å€ä¸Šï¼š\n=\u0026gt; load mmc 2:1 4f000000 ppmlogo.bin reading ppmlogo.bin 472688 bytes read in 29 ms (15.5 MiB/s) åŠ è½½æˆåŠŸåå¯ä»¥è¯»ä¸€ä¸‹è¿™æ®µå†…å­˜çš„å€¼ï¼Œçœ‹ä¸€ä¸‹å†™å…¥çš„å€¼æ˜¯å¦æ­£ç¡®ï¼š\n=\u0026gt; md.l 4f000000 4 4f000000: 00000003 00000320 0000024e 000000df .... ...N....... æ‰‹åŠ¨åŠ è½½æˆåŠŸåï¼Œå°±å¯ä»¥æ–°å»ºä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œä¿å­˜åŠ è½½ logo æ–‡ä»¶çš„æ“ä½œï¼š\n=\u0026gt; env set load_logo load mmc 2:1 4f000000 ppmlogo.bin =\u0026gt; env save æ‰‹åŠ¨æ‰§è¡Œä¸€æ¬¡ï¼Œç¡®ä¿å‘½ä»¤å¯ä»¥æ­£å¸¸æ‰§è¡Œï¼š\n=\u0026gt; run load_logo reading ppmlogo.bin 472688 bytes read in 29 ms (15.5 MiB/s) æœ€åï¼Œç¼–è¾‘ bootcmd ç¯å¢ƒå˜é‡ï¼Œæ·»åŠ  run load_logo; ï¼Œè®© u-boot å¯åŠ¨æ—¶è‡ªåŠ¨æ‰§è¡Œ load_logo ï¼š\n=\u0026gt; env edit bootcmd edit: run findfdt;run findtee;mmc dev ${mmcdev}; run load_logo; if mmc rescan; then if run loadbootscript; then run bootscript; else if run loadimage; then run mmcboot; else run netboot; fi; fi; else run netboot; fi =\u0026gt; env save ä¿å­˜åé‡å¯ï¼Œå¯ä»¥çœ‹åˆ°åŠ è½½ ppmlogo.bin æ—¶ï¼Œu-boot æ‰“å°çš„å¦‚ä¸‹ä¿¡æ¯ï¼š\nreading ppmlogo.bin 472688 bytes read in 28 ms (16.1 MiB/s) æ‰‹åŠ¨ä¿®æ”¹ u-boot æ²¡æœ‰é—®é¢˜åï¼Œå¯ä»¥åœ¨ u-boot æºç ä¸­ä¿®æ”¹ bootcmd çš„å€¼ï¼Œä½¿ u-boot å¯åŠ¨æ—¶è‡ªåŠ¨åŠ è½½ logo å›¾ç‰‡ã€‚ä¾‹å¦‚ä¿®æ”¹ imx6q çš„é…ç½®æ–‡ä»¶ `include/configs/mx6sabre_common.hï¼š\n#define CONFIG_EXTRA_ENV_SETTINGS \\ CONFIG_MFG_ENV_SETTINGS \\ TEE_ENV \\ \u0026#34;epdc_waveform=epdc_splash.bin\\0\u0026#34; \\ \u0026#34;script=boot.scr\\0\u0026#34; \\ \u0026#34;image=zImage\\0\u0026#34; \\ + \u0026#34;load_logo=load mmc 2:1 4f000000 ppmlogo.bin\u0026#34; ... ... #define CONFIG_BOOTCOMMAND \\ \u0026#34;run findfdt;\u0026#34; \\ \u0026#34;run findtee;\u0026#34; \\ \u0026#34;mmc dev ${mmcdev};\u0026#34; \\ + \u0026#34;run load_logo\u0026#34; \\ \u0026#34;if mmc rescan; then \u0026#34; \\ \u0026#34;if run loadbootscript; then \u0026#34; \\ \u0026#34;run bootscript; \u0026#34; \\ \u0026#34;else \u0026#34; \\ \u0026#34;if run loadimage; then \u0026#34; \\ \u0026#34;run mmcboot; \u0026#34; \\ \u0026#34;else run netboot; \u0026#34; \\ \u0026#34;fi; \u0026#34; \\ \u0026#34;fi; \u0026#34; \\ \u0026#34;else run netboot; fi\u0026#34; #endif æœ€åå°±æ˜¯ä¿®æ”¹å†…æ ¸ã€‚æˆ‘ä»¬éœ€è¦åœ¨è®¾å¤‡æ ‘çš„ /reserved-memory ä¸­æ·»åŠ ä¸€ä¸ªå­—èŠ‚ç‚¹ï¼Œç”³è¯·ä¸€æ®µä¿ç•™å†…å­˜ï¼Œå°†åœ°å€ 0x4f000000 å¼€å§‹çš„ 3MB å†…å­˜ç•™çµ¦ u-boot å­˜æ”¾çš„ ppmlogo.bin ï¼Œé¿å…å†…æ ¸å¯åŠ¨åå°†è¿™æ®µå†…å­˜è¦†ç›–ï¼š\nreserved-memory { linux-logo { compatible = \u0026#34;cs-logo\u0026#34;; reusable; reg = \u0026lt;0x4f000000 0x300000\u0026gt;; } } ç„¶åä¿®æ”¹ drivers/video/logo/logo.c æ–‡ä»¶ä¸­çš„ fb_find_logo() å‡½æ•°ï¼Œè¯»å– 0x4f000000 å†…å­˜ä¸­çš„æ•°æ®ï¼Œå¹¶ç»“æ„åŒ–ä¸º struct linux_logo æ ¼å¼ï¼š\ndiff --git a/drivers/video/logo/logo.c b/drivers/video/logo/logo.c index b6bc4a0..d304272 100644 --- a/drivers/video/logo/logo.c +++ b/drivers/video/logo/logo.c @@ -28,6 +28,8 @@ MODULE_PARM_DESC(nologo, \u0026#34;Disables startup logo\u0026#34;); static bool logos_freed; +struct linux_logo cs_logo; //å­˜æ”¾å†…å­˜ä¸­è¯»å–çš„ logo æ•°æ®ï¼Œä¸€å®šè¦å…¨å±€å˜é‡ + static int __init fb_logo_late_init(void) { logos_freed = true; @@ -43,6 +45,7 @@ late_initcall(fb_logo_late_init); const struct linux_logo * __ref fb_find_logo(int depth) { const struct linux_logo *logo = NULL; + char *logo_addr = NULL; if (nologo || logos_freed) return NULL; @@ -76,7 +79,17 @@ const struct linux_logo * __ref fb_find_logo(int depth) if (depth \u0026gt;= 8) { #ifdef CONFIG_LOGO_LINUX_CLUT224 /* Generic Linux logo */ - logo = \u0026amp;logo_linux_clut224; + logo_addr = phys_to_virt((phys_addr_t)(0x4f000000)); // å°†ç‰©ç†åœ°å€è½¬æ¢ä¸ºè™šæ‹Ÿåœ°å€ + memcpy(\u0026amp;cs_logo.type, logo_addr, 4); + memcpy(\u0026amp;cs_logo.width, logo_addr+4, 4); + memcpy(\u0026amp;cs_logo.height, logo_addr+8, 4); + memcpy(\u0026amp;cs_logo.clutsize,logo_addr+12, 4); + printk(\u0026#34;load cs_logo head: %d,%d,%d,%d \\n\u0026#34;, cs_logo.type, cs_logo.width, cs_logo.height, cs_logo.clutsize); + + cs_logo.data = logo_addr+16; + cs_logo.clut = logo_addr+16+cs_logo.width*cs_logo.height; + logo = \u0026amp;cs_logo; + #endif #ifdef CONFIG_LOGO_BLACKFIN_CLUT224 ä¿®æ”¹å®Œæ¯•ï¼Œä¸‹é¢æ˜¯ ppmtobin çš„ç¨‹åºçš„æºç ï¼š\n/* * ppmtobin.c * compile: gcc -Wall ppmtobin.c -o ppmtobin * Author: LiShaocheng * * Convert a logo in ASCII PNM format to binary file, format is * --------------------------------------------- * | 0 1 2 3 * --------------------------------------------- * 0| logo type * --------------------------------------------- * 4| logo width(w) * --------------------------------------------- * 8| logo height(h) * --------------------------------------------- * 12| logo clutsize * --------------------------------------------- * 16| * ...| logo data * ...| (size = w*h) * --------------------------------------------- * w*h+16| * ...| logo clut * ...| (size = clutsize*3) * --------------------------------------------- */ #include \u0026lt;ctype.h\u0026gt; #include \u0026lt;errno.h\u0026gt; #include \u0026lt;stdarg.h\u0026gt; #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; #include \u0026lt;string.h\u0026gt; #include \u0026lt;unistd.h\u0026gt; struct bin_header { int type; /* one of LINUX_LOGO_* */ unsigned int width; unsigned int height; unsigned int clutsize; /* LINUX_LOGO_CLUT224 only */ }; static const char *appname; static const char *filename; static const char *outputname; static FILE *out; #define MAX_LINUX_LOGO_COLORS 224 struct color { unsigned char red; unsigned char green; unsigned char blue; }; static unsigned int logo_width; static unsigned int logo_height; static struct color **logo_data; static struct color logo_clut[MAX_LINUX_LOGO_COLORS]; static unsigned int logo_clutsize; static int is_plain_pbm = 0; static void die(const char *fmt, ...) __attribute__((noreturn)) __attribute((format(printf, 1, 2))); static void usage(void) __attribute((noreturn)); // read data from PNG file static unsigned int get_number(FILE *fp) { int c, val; /* Skip leading whitespace */ do { c = fgetc(fp); if (c == EOF) die(\u0026#34;%s: end of file\\n\u0026#34;, filename); if (c == \u0026#39;#\u0026#39;) { /* Ignore comments \u0026#39;till end of line */ do { c = fgetc(fp); if (c == EOF) die(\u0026#34;%s: end of file\\n\u0026#34;, filename); } while (c != \u0026#39;\\n\u0026#39;); } } while (isspace(c)); /* Parse decimal number */ val = 0; while (isdigit(c)) { val = 10 * val + c - \u0026#39;0\u0026#39;; /* some PBM are \u0026#39;broken\u0026#39;; GiMP for example exports a PBM without space * between the digits. This is Ok cause we know a PBM can only have a \u0026#39;1\u0026#39; * or a \u0026#39;0\u0026#39; for the digit. */ if (is_plain_pbm) break; c = fgetc(fp); if (c == EOF) die(\u0026#34;%s: end of file\\n\u0026#34;, filename); } return val; } static unsigned int get_number255(FILE *fp, unsigned int maxval) { unsigned int val = get_number(fp); return (255 * val + maxval / 2) / maxval; } static void read_image(void) { FILE *fp; unsigned int i, j; int magic; unsigned int maxval; /* open image file */ fp = fopen(filename, \u0026#34;r\u0026#34;); if (!fp) die(\u0026#34;Cannot open file %s: %s\\n\u0026#34;, filename, strerror(errno)); /* check file type and read file header */ magic = fgetc(fp); if (magic != \u0026#39;P\u0026#39;) die(\u0026#34;%s is not a PNM file\\n\u0026#34;, filename); magic = fgetc(fp); switch (magic) { case \u0026#39;1\u0026#39;: case \u0026#39;2\u0026#39;: /* Plain PBM/PGM */ die(\u0026#34;%s: Plain PBM/PGM is not supported\\n\u0026#34; \u0026#34;Use pnmnoraw(1) to convert it to ASCII PNM\\n\u0026#34;, filename); case \u0026#39;3\u0026#39;: /* Plain PPM */ break; case \u0026#39;4\u0026#39;: case \u0026#39;5\u0026#39;: case \u0026#39;6\u0026#39;: /* Binary PBM/PGM/PPM */ die(\u0026#34;%s: Binary PNM is not supported\\n\u0026#34; \u0026#34;Use pnmnoraw(1) to convert it to ASCII PNM\\n\u0026#34;, filename); default: die(\u0026#34;%s is not a PNM file\\n\u0026#34;, filename); } logo_width = get_number(fp); logo_height = get_number(fp); /* allocate image data */ logo_data = (struct color **)malloc(logo_height * sizeof(struct color *)); if (!logo_data) die(\u0026#34;%s\\n\u0026#34;, strerror(errno)); for (i = 0; i \u0026lt; logo_height; i++) { logo_data[i] = malloc(logo_width * sizeof(struct color)); if (!logo_data[i]) die(\u0026#34;%s\\n\u0026#34;, strerror(errno)); } /* read Plain PPM data */ maxval = get_number(fp); for (i = 0; i \u0026lt; logo_height; i++) for (j = 0; j \u0026lt; logo_width; j++) { logo_data[i][j].red = get_number255(fp, maxval); logo_data[i][j].green = get_number255(fp, maxval); logo_data[i][j].blue = get_number255(fp, maxval); } /* close file */ fclose(fp); } static inline int is_equal(struct color c1, struct color c2) { return c1.red == c2.red \u0026amp;\u0026amp; c1.green == c2.green \u0026amp;\u0026amp; c1.blue == c2.blue; } static void write_logo_clut224(void) { unsigned int i, j, k; int len = 0; int write_hex_cnt = 0; struct bin_header header; unsigned char bin_data[logo_width*logo_height]; unsigned char bin_clut[MAX_LINUX_LOGO_COLORS*3]; /* validate image */ for (i = 0; i \u0026lt; logo_height; i++) for (j = 0; j \u0026lt; logo_width; j++) { for (k = 0; k \u0026lt; logo_clutsize; k++) if (is_equal(logo_data[i][j], logo_clut[k])) break; if (k == logo_clutsize) { if (logo_clutsize == MAX_LINUX_LOGO_COLORS) die(\u0026#34;Image has more than %d colors\\n\u0026#34; \u0026#34;Use ppmquant(1) to reduce the number of colors\\n\u0026#34;, MAX_LINUX_LOGO_COLORS); logo_clut[logo_clutsize++] = logo_data[i][j]; } } /* open bin file */ if (outputname) { printf(\u0026#34;Creat %s file\\n\u0026#34;, outputname); out = fopen(outputname, \u0026#34;wb\u0026#34;); if (!out) die(\u0026#34;Cannot create file %s: %s\\n\u0026#34;, outputname, strerror(errno)); } else { printf(\u0026#34;Creat ppmlogo.bin file\\n\u0026#34;); out = fopen(\u0026#34;ppmlogo.bin\u0026#34;, \u0026#34;wb\u0026#34;); if (!out) die(\u0026#34;Cannot create file %s: %s\\n\u0026#34;, outputname, strerror(errno)); } /* write logo header to bin file*/ header.type = 3; header.width = logo_width; header.height = logo_height; header.clutsize = logo_clutsize; printf(\u0026#34;logo_width is %d \\n\u0026#34;, logo_width); printf(\u0026#34;logo_height is %d \\n\u0026#34;, logo_height); printf(\u0026#34;logo_clutsize is %d \\n\u0026#34;, logo_clutsize); len = fwrite(\u0026amp;header, 1, sizeof(header), out); printf(\u0026#34;write logo header len is %d bytes\\n\\n\u0026#34;, len); /* write logo data to bin file*/ for (i = 0; i \u0026lt; logo_height; i++) for (j = 0; j \u0026lt; logo_width; j++) { for (k = 0; k \u0026lt; logo_clutsize; k++) if (is_equal(logo_data[i][j], logo_clut[k])) break; bin_data[write_hex_cnt++] = k + 32; } printf(\u0026#34;bin data len is %d bytes\\n\u0026#34;, write_hex_cnt); len = fwrite(\u0026amp;bin_data, 1, sizeof(bin_data), out); printf(\u0026#34;write bin data len is %d bytes\\n\\n\u0026#34;, len); /* write logo clut to bin file*/ write_hex_cnt = 0; for (i = 0; i \u0026lt; logo_clutsize; i++) { bin_clut[write_hex_cnt++] = logo_clut[i].red; bin_clut[write_hex_cnt++] = logo_clut[i].green; bin_clut[write_hex_cnt++] = logo_clut[i].blue; } printf(\u0026#34;bin clut len is %d bytes\\n\u0026#34;, write_hex_cnt); len = fwrite(\u0026amp;bin_clut, 1, sizeof(bin_clut), out); printf(\u0026#34;write bin clut len is %d bytes\\n\u0026#34;, len); fclose(out); } static void die(const char *fmt, ...) { va_list ap; va_start(ap, fmt); vfprintf(stderr, fmt, ap); va_end(ap); exit(1); } static void usage(void) { die(\u0026#34;Convert a logo in ASCII PNM format to binary file\\n\u0026#34; \u0026#34;Usage: %s [options] \u0026lt;filename\u0026gt;\\n\u0026#34; \u0026#34;\\n\u0026#34; \u0026#34;Valid options:\\n\u0026#34; \u0026#34; -h : display this usage information\\n\u0026#34; \u0026#34; -o \u0026lt;output\u0026gt; : output to file \u0026lt;output\u0026gt; instead of default ppmlogo.bin\\n\u0026#34; \u0026#34;\\n\u0026#34;, appname); } int main(int argc, char *argv[]) { int opt; appname = argv[0]; opterr = 0; while (1) { opt = getopt(argc, argv, \u0026#34;ho:\u0026#34;); if (opt == -1) break; switch (opt) { case \u0026#39;h\u0026#39;: usage(); break; case \u0026#39;o\u0026#39;: outputname = optarg; break; default: usage(); break; } } if (optind != argc - 1) usage(); filename = argv[optind]; read_image(); write_logo_clut224(); exit(0); } ä¸€äº›é—®é¢˜ #å¦‚æœä½ çš„å±å¹•åˆ†è¾¨ç‡æ˜¯ 800x600 ï¼Œè€Œä½ å‡†å¤‡äº†ä¸€å¼  800x600 çš„å›¾ç‰‡ï¼Œæ›¿æ¢åä¼šå‘ç°å¯åŠ¨ç”»é¢æ²¡æœ‰æ˜¾ç¤ºï¼ŒæŸ¥çœ‹å†…æ ¸ä¿¡æ¯ä¼šæç¤ºï¼š\nfbcon_init: disable boot-logo (boot-logo bigger than screen). è¿™æ¡ä¿¡æ¯æ¥è‡ª drivers/video/console/fbcon.c æ–‡ä»¶çš„ fbcon_prepare_logo() å‡½æ•°ï¼š\nif (logo_lines \u0026gt; vc-\u0026gt;vc_bottom) { logo_shown = FBCON_LOGO_CANSHOW; printk(KERN_INFO \u0026#34;fbcon_init: disable boot-logo (boot-logo bigger than screen).\\n\u0026#34;); } logo_lines çš„å€¼æ¥è‡ªï¼š\nlogo_lines = DIV_ROUND_UP(logo_height, vc-\u0026gt;vc_font.height); logo_height è¡¨ç¤ºå›¾ç‰‡çš„é«˜åº¦ï¼Œå°±æ˜¯ 600 ï¼Œvc-\u0026gt;vc_font.height çš„é»˜è®¤å€¼æ˜¯ 16 ï¼ŒDIV_ROUND_UP çš„å®šä¹‰æ˜¯ï¼š\n#define DIV_ROUND_UP __KERNEL_DIV_ROUND_UP#define __KERNEL_DIV_ROUND_UP(n, d) (((n) + (d) - 1) / (d)) è®¡ç®—åå¾—åˆ°çš„ logo_lines å°±æ˜¯ 38 ã€‚æ‰“å° vc-\u0026gt;vc_bottom çš„å€¼å‘ç°æ˜¯ 37 ï¼Œæ‰€æœ‰éœ€è¦æŠŠå›¾ç‰‡çš„çºµå‘åˆ†è¾¨ç‡è°ƒå°åˆ° 592 ï¼Œè¿™æ ·è®¡ç®—å‡ºçš„ logo_lines å°±æ˜¯ 37 ã€‚\nå…³äºä¿ç•™å†…å­˜ #å‚è€ƒå†…æ ¸æ–‡æ¡£ reserved-memory.txt ã€‚\nå¯ä»¥åœ¨è®¾å¤‡æ ‘çš„ /reserved-memory èŠ‚ç‚¹ä¸‹é¢æ–°å»ºå­èŠ‚ç‚¹ï¼Œç”¨äºæè¿°ç‰¹å®šçš„å†…å­˜åŒºåŸŸï¼ŒLinux ä¼šå°†è¿™éƒ¨åˆ†å†…å­˜æ’é™¤åœ¨æ­£å¸¸ä½¿ç”¨ä¹‹å¤–ã€‚ /reserved-memory èŠ‚ç‚¹çš„å®šä¹‰å¦‚ä¸‹ï¼š\nreserved-memory { #address-cells = \u0026lt;1\u0026gt;; # æ ‡å‡†å®šä¹‰ï¼Œç”¨äºè®¾ç½®å­èŠ‚ç‚¹çš„ reg å±æ€§çš„ä¹¦å†™æ ¼å¼ #size-cells = \u0026lt;1\u0026gt;; # æ ‡å‡†å®šä¹‰ï¼Œç”¨äºè®¾ç½®å­èŠ‚ç‚¹çš„ reg å±æ€§çš„ä¹¦å†™æ ¼å¼ ranges; # æ ‡å‡†å®šä¹‰ï¼Œç©ºå±æ€§ #å­èŠ‚ç‚¹ } åœ¨ä¸‹é¢çš„å­èŠ‚ç‚¹ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ reg å±æ€§æ¥æŒ‡å®šä¿ç•™å†…å­˜çš„èŒƒå›´ï¼Œæˆ–è€…ç”¨ size å±æ€§è¯·æ±‚åŠ¨æ€åˆ†é…ä¸€æ®µç‰¹å®šå¤§å°çš„å†…å­˜ï¼Œå¦‚æœä¸¤ä¸ªéƒ½å­˜åœ¨ï¼Œåˆ™ reg ä¼˜å…ˆï¼Œsize ä¼šè¢«å¿½ç•¥ã€‚æŒ‰ç…§æ¨èçš„åšæ³•ï¼ŒèŠ‚ç‚¹åç§°åº”è¯¥åæ˜ èŠ‚ç‚¹çš„ç›®çš„ï¼Œå¦‚æœæ˜¯é™æ€åˆ†é…ï¼Œåº”è¯¥é™„åŠ ä¸Šå•ä½åœ°å€ @\u0026lt;address\u0026gt; ã€‚\nå¯ç”¨çš„å±æ€§å¦‚ä¸‹ï¼š\né™æ€åˆ†é… reg - æ ‡å‡†å®šä¹‰ï¼Œå¿…é¡»è®¾ç½®ã€‚è¯­æ³•æ˜¯ \u0026lt;address offset\u0026gt; ï¼Œä¾‹å¦‚ reg = \u0026lt;0x10000000 0x40000000\u0026gt;; è¡¨ç¤ºä» 0x10000000 å¼€å§‹ï¼Œåˆ†é… 1GB å†…å­˜ã€‚ åŠ¨æ€åˆ†é… size - åŸºäºçˆ¶ç±»çš„ #size-cells çš„é•¿åº¦ï¼Œè¦ä¿ç•™çš„å†…å­˜çš„å­—èŠ‚æ•°ï¼Œå¿…é¡»è®¾ç½®ã€‚ alignment - åŸºäºçˆ¶ç±»çš„#size-cellsçš„é•¿åº¦ï¼Œç”¨äºå¯¹é½åˆ†é…çš„åœ°å€è¾¹ç•Œï¼Œå¯é€‰è®¾ç½®ã€‚ alloc-ranges - è®¾ç½®ä¸€ä¸ªåœ°å€å’Œé•¿åº¦ï¼Œè¯·æ±‚åœ¨è¿™ä¸ªç‰¹å®šåŒºåŸŸå†…åˆ†é…ä¿ç•™å†…å­˜ï¼Œå¯é€‰è®¾ç½®ã€‚ å¯é€‰çš„é™„åŠ å±æ€§ï¼š\ncompatible - å¯ä»¥åŒ…å«ä»¥ä¸‹å­—ç¬¦ä¸²ã€‚\nshared-dma-pool ã€‚è¿™è¡¨ç¤ºä¸€ä¸ªå†…å­˜åŒºåŸŸï¼Œæ—¨åœ¨ä½œä¸ºä¸€ç»„è®¾å¤‡çš„DMAç¼“å†²åŒºçš„å…±äº«æ± ä½¿ç”¨ã€‚å¦‚æœæœ‰å¿…è¦ï¼Œå®ƒå¯ä»¥è¢«æ“ä½œç³»ç»Ÿç”¨æ¥å®ä¾‹åŒ–å¿…è¦çš„æ± ç®¡ç†å­ç³»ç»Ÿã€‚\nå‚å•†ç‰¹å®šçš„å­—ç¬¦ä¸²ï¼Œå½¢å¼ä¸º \u0026lt;vendor\u0026gt;,[\u0026lt;device\u0026gt;-]\u0026lt;usage\u0026gt; ã€‚\nno-map - ç©ºå±æ€§ï¼Œè¡¨ç¤ºæ“ä½œç³»ç»Ÿä¸å¾—åˆ›å»ºè¯¥åŒºåŸŸçš„è™šæ‹Ÿæ˜ å°„ä½œä¸ºå…¶ç³»ç»Ÿå†…å­˜æ ‡å‡†æ˜ å°„çš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿä¸å…è®¸åœ¨ä½¿ç”¨è¯¥åŒºåŸŸçš„è®¾å¤‡é©±åŠ¨ç¨‹åºæ§åˆ¶ä¹‹å¤–çš„ä»»ä½•æƒ…å†µä¸‹å¯¹å…¶è¿›è¡ŒæŠ•æœºè®¿é—®ã€‚\nreusable - ç©ºå±æ€§ï¼Œæ“ä½œç³»ç»Ÿå¯ä»¥ä½¿ç”¨è¯¥åŒºåŸŸçš„å†…å­˜ï¼Œä½†æœ‰ä¸€ä¸ªé™åˆ¶ï¼Œå³æ‹¥æœ‰è¯¥åŒºåŸŸçš„è®¾å¤‡é©±åŠ¨ç¨‹åºéœ€è¦èƒ½å¤Ÿå°†å…¶æ”¶å›ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œè¿™æ„å‘³ç€æ“ä½œç³»ç»Ÿå¯ä»¥ä½¿ç”¨è¯¥åŒºåŸŸæ¥å­˜å‚¨æ˜“å¤±æ€§æˆ–ç¼“å­˜çš„æ•°æ®ï¼Œè¿™äº›æ•°æ®å¯ä»¥é€šè¿‡å…¶ä»–æ–¹å¼é‡æ–°ç”Ÿæˆæˆ–è¿ç§»åˆ°å…¶ä»–åœ°æ–¹ã€‚\nno-map å’Œ reusable ä¸¤ä¸ªå±æ€§ä¸èƒ½å…±å­˜ï¼Œå› ä¸ºå®ƒä»¬çš„é€»è¾‘æ˜¯çŸ›ç›¾çš„ã€‚\nLinux è¿˜æœ‰ç‰¹å®šçš„å®ç°ï¼š\nå¦‚æœ \u0026ldquo;linux,cma-default \u0026ldquo;å±æ€§å­˜åœ¨ï¼Œé‚£ä¹ˆ Linux å°†ä½¿ç”¨è¯¥åŒºåŸŸä½œä¸ºè¿ç»­å†…å­˜åˆ†é…å™¨çš„é»˜è®¤æ± ã€‚\nå¦‚æœ \u0026ldquo;linux,dma-default \u0026ldquo;å±æ€§å­˜åœ¨ï¼Œé‚£ä¹ˆ Linux å°†ä½¿ç”¨è¯¥åŒºåŸŸä½œä¸ºä¸€è‡´ DMA åˆ†é…å™¨çš„é»˜è®¤æ± ã€‚\nå…¶ä»–è®¾å¤‡èŠ‚ç‚¹å¯ä»¥é€šè¿‡ memory-region å±æ€§å¼•ç”¨å·²å®šä¹‰çš„ä¿ç•™å†…å­˜ï¼š\nmemory-region - å®ƒçš„å€¼åº”è¯¥æ˜¯ä¿ç•™å†…å­˜å­èŠ‚ç‚¹çš„åç§° memory-region-names - ä¿ç•™å†…å­˜å­èŠ‚ç‚¹çš„åç§°çš„åˆ—è¡¨ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œå®šä¹‰äº†ä¸‰ä¸ªä¿ç•™å†…å­˜ï¼š\nä¸€ä¸ªæ˜¯æ‰€æœ‰è®¾å¤‡é©±åŠ¨çš„é»˜è®¤åŒºåŸŸï¼ˆåä¸ºlinux,cma@72000000ï¼Œå¤§å°ä¸º64MBï¼‰ã€‚ ä¸€ä¸ªä¸“é—¨ç”¨äºå¸§ç¼“å†²è®¾å¤‡ï¼ˆå‘½åä¸ºframebuffer@78000000ï¼Œ8MBï¼‰ã€‚ ä¸€ä¸ªç”¨äºå¤šåª’ä½“å¤„ç†ï¼ˆåä¸ºmultimedia-memory@77000000ï¼Œ64MBï¼‰ã€‚ / { #address-cells = \u0026lt;1\u0026gt;; #size-cells = \u0026lt;1\u0026gt;; memory { reg = \u0026lt;0x40000000 0x40000000\u0026gt;; }; reserved-memory { #address-cells = \u0026lt;1\u0026gt;; #size-cells = \u0026lt;1\u0026gt;; ranges; /* global autoconfigured region for contiguous allocations */ linux,cma { compatible = \u0026#34;shared-dma-pool\u0026#34;; reusable; size = \u0026lt;0x4000000\u0026gt;; alignment = \u0026lt;0x2000\u0026gt;; linux,cma-default; }; display_reserved: framebuffer@78000000 { reg = \u0026lt;0x78000000 0x800000\u0026gt;; }; multimedia_reserved: multimedia@77000000 { compatible = \u0026#34;acme,multimedia-memory\u0026#34;; reg = \u0026lt;0x77000000 0x4000000\u0026gt;; }; }; /* ... */ fb0: video@12300000 { memory-region = \u0026lt;\u0026amp;display_reserved\u0026gt;; /* ... */ }; scaler: scaler@12500000 { memory-region = \u0026lt;\u0026amp;multimedia_reserved\u0026gt;; /* ... */ }; codec: codec@12600000 { memory-region = \u0026lt;\u0026amp;multimedia_reserved\u0026gt;; /* ... */ }; }; ç”¨æˆ·ç©ºé—´çš„å¯åŠ¨ç”»é¢ #ç”¨æˆ·ç©ºé—´çš„å¯åŠ¨ç”»é¢æ˜¯ç”¨ psplash å®ç°çš„ï¼Œå®ƒçš„åŸç†å°±æ˜¯ä½¿ç”¨ FrameBuffer çš„ API åœ¨å±å¹•ä¸Šç»˜åˆ¶å›¾ç‰‡ã€‚æºç å¯ä»¥ç”¨ git ä¸‹è½½ï¼š\ngit://git.yoctoproject.org/psplash æºæ–‡ä»¶æ¯”è¾ƒç®€å•ï¼Œæ¯”è¾ƒé‡è¦çš„æœ‰ï¼š\nmake-image-header.sh ï¼Œå®ƒçš„ä½œç”¨æ˜¯æŠŠ png æ ¼å¼çš„å›¾ç‰‡è½¬æ¢ä¸º C è¯­è¨€å¤´æ–‡ä»¶ï¼Œè¿™æ ·å°±å¯ä»¥æŠŠå›¾ç‰‡ç¼–è¯‘åˆ°å¯æ‰§è¡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ã€‚ psplash.c ï¼Œmain å‡½æ•°æ‰€åœ¨çš„æºæ–‡ä»¶ï¼Œå¯ä»¥åœ¨è¿™é‡ŒæŸ¥çœ‹ç»˜åˆ¶å¯åŠ¨ç”»é¢çš„æµç¨‹ã€‚ psplash-config.h ï¼ŒåŸºæœ¬çš„é…ç½®å®å®šä¹‰ã€‚ psplash-colors.h ï¼Œé¢œè‰²ç›¸å…³çš„é…ç½®å®å®šä¹‰ã€‚ psplash-poky-img.h ï¼ŒåŒ…å«å›¾ç‰‡æ•°æ®çš„å¤´æ–‡ä»¶ã€‚ psplash-fb.c ï¼Œå®šä¹‰äº† framebuffer ç»˜å›¾å‡½æ•°ã€‚ psplash-config.h å¤´æ–‡ä»¶å®šä¹‰äº†æ˜¾ç¤ºé…ç½®ï¼š\n/* è®¾ç½®å¯åŠ¨ç”»é¢ä¸­æ–‡æœ¬ä¿¡æ¯ï¼Œé»˜è®¤æ˜¯ç©ºçš„ã€‚å¦‚æœä¸ç”¨ï¼Œæœ€å¥½æ³¨é‡Šæ‰ï¼Œå¦åˆ™ä¼šåœ¨å¯åŠ¨ç”»é¢ä¸­æ˜¾ç¤ºä¸€è¡ŒèƒŒæ™¯è‰² */ #define PSPLASH_STARTUP_MSG \u0026#34;\u0026#34; /* ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œç”¨äºæŒ‡ç¤ºå›¾ç‰‡çš„æ˜¾ç¤ºä½ç½®ï¼Œå¦‚æœå›¾ç‰‡çš„åˆ†è¾¨ç‡ç­‰äºå±å¹•åˆ†è¾¨ç‡ï¼Œæœ€å¥½è®¾ä¸º 1 ï¼Œå¦‚æœå›¾ç‰‡çš„åˆ†è¾¨ç‡å°äºå±å¹•åˆ†è¾¨ç‡ ï¼Œå¯ä»¥è®¾ç½®ä¸º 0 ï¼Œç„¶åç”¨åé¢çš„å‚æ•°è°ƒæ•´æ˜¾ç¤ºæ•ˆæœ*/ #define PSPLASH_IMG_FULLSCREEN 0 /* è®¾ç½®åˆ†å±æ˜¾ç¤ºçš„åˆ†å­ */ #define PSPLASH_IMG_SPLIT_NUMERATOR 5 /* è®¾ç½®åˆ†å±æ˜¾ç¤ºçš„åˆ†æ¯ */ #define PSPLASH_IMG_SPLIT_DENOMINATOR 6 psplash-colors.h å¤´æ–‡ä»¶å®šä¹‰äº†ç”»é¢å…ƒç´ çš„é¢œè‰²ï¼š\n/* è®¾ç½®èƒŒæ™¯é¢œè‰²ï¼ŒRGB */ #define PSPLASH_BACKGROUND_COLOR 0xec,0xec,0xe1 /* è®¾ç½®æ–‡å­—çš„é¢œè‰²ï¼ŒRGB */ #define PSPLASH_TEXT_COLOR 0x6d,0x6d,0x70 /* è®¾ç½®è¿›åº¦æ¡çš„é¢œè‰²ï¼ŒRGB */ #define PSPLASH_BAR_COLOR 0x6d,0x6d,0x70 /* è®¾ç½®è¿›åº¦æ¡çš„èƒŒæ™¯é¢œè‰²ï¼ŒRGB */ #define PSPLASH_BAR_BACKGROUND_COLOR 0xec,0xec,0xe1 psplash-poky-img.h æ–‡ä»¶ç”¨ make-image-header.sh è„šæœ¬ç”Ÿæˆçš„ï¼Œæ ¹æ®å›¾ç‰‡çš„å±æ€§å®šä¹‰äº†ä¸€äº›å®ï¼š\n/* å›¾ç‰‡çš„æ¨ªå‘åˆ†è¾¨ç‡ */ #define POKY_IMG_WIDTH (800) /* å›¾ç‰‡çš„çºµå‘åˆ†è¾¨ç‡ */ #define POKY_IMG_HEIGHT (600) /* ä¸€ä¸ªåƒç´ çš„æ•°æ®å¤§å°ï¼Œå•ä½æ˜¯å­—èŠ‚ */ #define POKY_IMG_BYTES_PER_PIXEL (3) /* 3:RGB, 4:RGBA */ /* ä¸€è¡Œåƒç´ å ç”¨çš„æ•°æ®å¤§å°ï¼Œå°±æ˜¯ POKY_IMG_WIDTH*POKY_IMG_BYTES_PER_PIXEL ï¼Œå•ä½æ˜¯å­—èŠ‚ */ #define POKY_IMG_ROWSTRIDE (2400) /* ä¸€å¼ å›¾ç‰‡çš„åƒç´ æ•°æ® */ #define POKY_IMG_RLE_PIXEL_DATA ((uint8*) \u0026#34;\u0026#34; psplash.c ä¸­çš„ main å‡½æ•°ç»˜åˆ¶äº†å¯åŠ¨ç”»é¢ï¼ŒåŸºæœ¬æµç¨‹å¦‚ä¸‹ï¼š\nåˆå§‹åŒ– framebuffer è°ƒç”¨ psplash_fb_draw_rect å‡½æ•°ï¼Œå°†å±å¹•ä¸Šçš„æ¯ä¸ªåƒç´ éƒ¨è®¾ä¸º PSPLASH_BACKGROUND_COLOR é¢œè‰² è°ƒç”¨ psplash_fb_draw_image å‡½æ•°ï¼Œå°† POKY_IMG_RLE_PIXEL_DATA çš„æ‰€æœ‰æ•°æ®ç»˜åˆ¶åˆ°å±å¹•ä¸Šï¼š æ¨ªå‘æ˜¯å±…ä¸­æ˜¾ç¤ºã€‚ å¦‚æœ PSPLASH_IMG_FULLSCREEN ä¸º 1 ï¼Œæ¨ªå‘ä¹Ÿæ˜¯å±…ä¸­æ˜¾ç¤ºã€‚ å¦‚æœ PSPLASH_IMG_FULLSCREEN ä¸º 0 ï¼Œçºµå‘å ç”¨å±å¹•çš„ PSPLASH_IMG_SPLIT_NUMERATOR/PSPLASH_IMG_SPLIT_DENOMINATOR éƒ¨åˆ† è°ƒç”¨ psplash_fb_draw_image å‡½æ•°ï¼Œç»˜åˆ¶è¿›åº¦æ¡ã€‚ è°ƒç”¨ psplash_draw_progress å‡½æ•°ï¼Œç»˜åˆ¶è¿›åº¦æ¡çš„åŠ¨ç”»ã€‚ å¦‚æœå®šä¹‰äº† PSPLASH_STARTUP_MSG ï¼Œè°ƒç”¨ psplash_draw_msg å‡½æ•°ï¼Œåœ¨è¿›åº¦æ¡ä¸Šæ–¹æ˜¾ç¤ºæ–‡æœ¬ä¿¡æ¯ã€‚ å¦‚æœè¦æ›´æ¢å¯åŠ¨ç”»é¢ï¼Œé¦–å…ˆè¦å‡†å¤‡ä¸€å¼  png æ ¼å¼çš„å›¾ç‰‡ï¼Œé‡å‘½åä¸º psplash-poky.png ï¼Œåˆ†è¾¨ç‡åº”è¯¥å°äºç­‰äºå±å¹•çš„åˆ†è¾¨ç‡ã€‚ç„¶åä½¿ç”¨ make-image-header.sh è„šæœ¬å°†å›¾ç‰‡è½¬æ¢ä¸º C è¯­éŸ³çš„æ ¼å¼ï¼š\n./make-image-header.sh psplash-poky.png POKY è¿™ä¸ªè„šæœ¬ä½¿ç”¨ gdk-pixbuf-csource å·¥å…·è¿›è¡Œè½¬æ¢ï¼Œéœ€è¦å®‰è£… gdk-pixbuf-csource ï¼šsudo apt install libgdk-pixbuf2.0-dev\nå¤„ç†å®Œæ¯•ä¼šç”Ÿæˆ psplash-poky-img.h å¤´æ–‡ä»¶ï¼Œç›´æ¥ç¼–è¯‘ï¼Œç”Ÿæˆçš„ psplash äºŒè¿›åˆ¶æ–‡ä»¶å°±åŒ…å«äº†å¯åŠ¨ç”»é¢ï¼Œåœ¨ç³»ç»Ÿå¯åŠ¨æ—¶æ‰§è¡Œå°±å¯ä»¥æ˜¾ç¤ºã€‚iMX Yocto æŠŠè¿™ä¸ªæ–‡ä»¶åæ”¹æˆäº† psplash-default ï¼Œå®‰è£…åœ¨ /usr/bin ç›®å½•ä¸‹ï¼Œé€šè¿‡ psplash-start.service æœåŠ¡å¯åŠ¨ã€‚\n","date":"2021 May 7","permalink":"/posts/2021/05/07/","section":"Posts","summary":"ä»¥ NXP çš„ iMX Yocto 4.","title":"å¦‚ä½•ä¿®æ”¹ ARM Linux ç³»ç»Ÿçš„å¯åŠ¨ç”»é¢"},{"content":"SPI é€šä¿¡åè®® #SPI çš„å…¨ç§°æ˜¯ Serial Peripheral Interfaceï¼Œæ˜¯ä¸€ä¸ªå¸¦æ—¶é’ŸåŒæ­¥çš„å…¨åŒå·¥ä¸²è¡Œé“¾æ¥ï¼Œä½¿ç”¨ä¸»/ä»ç»“æ„ï¼Œç”¨äºè¿æ¥å¾®æ§åˆ¶å™¨å’Œä¼ æ„Ÿå™¨ã€å­˜å‚¨å™¨å’Œå¤–è®¾ã€‚å¸¸è§çš„è¿æ¥ç»“æ„å¦‚ä¸‹ï¼š\né€šä¿¡æ—¶éœ€è¦å››ä¸ªä¿¡å·ï¼š\nSCLKï¼ŒSerial Clockï¼Œæ—¶é’Ÿä¿¡å·ï¼ŒSPI çš„æ—¶é’Ÿé¢‘ç‡é€šå¸¸å¯ä»¥è¾¾åˆ° 10MHzï¼Œå®é™…æƒ…å†µè¿˜ä¾èµ–ä»æœºèƒ½å¤Ÿæ”¯æŒçš„æ—¶é’Ÿé¢‘ç‡ã€‚ MISOï¼ŒMaster In Slave Outï¼Œä»æœºå‘ä¸»æœºå‘å‡ºçš„æ•°æ®ã€‚ MOSIï¼ŒMaster Out Slave Inï¼Œä¸»æœºå‘ä»æœºå‘å‡ºçš„æ•°æ®ã€‚ SSï¼ŒSlave Selectï¼Œä»æœºé€‰æ‹©ï¼Œä¹Ÿå«åšç‰‡é€‰ä¿¡å·ã€‚ä¸€æ¡ SPI æ€»çº¿å¯ä»¥è¿æ¥å¤šä¸ªä»è®¾å¤‡ï¼ŒSCLKã€MISO å’Œ MOSI æ˜¯å…±ç”¨çš„ï¼Œæ¯ä¸ªä»æœºéœ€è¦ä¸€ä¸ªç‹¬ç«‹çš„ç‰‡é€‰ä¿¡å·ï¼Œå½“ä»æœºçš„ SS ä¿¡å·æ‹‰ä½æ—¶ï¼Œè¡¨ç¤ºä»æœºè¢«é€‰ä¸­ï¼Œæ‰å¼€å§‹æ¥æ”¶æ€»çº¿ä¸Šçš„ä¿¡å·ã€‚ åœ¨ä¸€ä¸ªSPIæ—¶é’Ÿå‘¨æœŸå†…ï¼Œæ”¶å‘æ˜¯åŒæ—¶è¿›è¡Œçš„ï¼š\nä¸»æœºé€šè¿‡ MOSI çº¿å‘é€ 1bit æ•°æ®ï¼Œä»æœºé€šè¿‡è¯¥çº¿è¯»å–è¿™ 1bit æ•°æ®ï¼› ä»æœºé€šè¿‡ MISO çº¿å‘é€ 1bit æ•°æ®ï¼Œä¸»æœºé€šè¿‡è¯¥çº¿è¯»å–è¿™ 1bit æ•°æ®ã€‚ è¿™ä¸ªè¿‡ç¨‹æ˜¯ SPI è®¾å¤‡å†…çš„ç§»ä½å¯„å­˜å™¨å®ç°çš„ï¼Œå½“å¯„å­˜å™¨ä¸­çš„å†…å®¹å…¨éƒ¨ç§»å‡ºæ—¶ï¼Œç›¸å½“äºå®Œæˆäº†ä¸¤ä¸ªå¯„å­˜å™¨å†…å®¹çš„äº¤æ¢ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\nä¸‹é¢æ˜¯ä¸€ä¸ªå…¸å‹çš„ä¸»æœºæ¨¡å‹çš„é€šä¿¡æ—¶åºï¼Œæè¿°äº†ä¸»æœºçš„ 0xD2 çš„æ•°æ®è¢«ç§»å‡ºï¼Œä» MISO ä¿¡å·ç§»å…¥äº† 0x66 ï¼š\nSCLK ã€MOSI å’Œ SS ä¿¡å·ç”±ä¸»æœºäº§ç”Ÿï¼ŒMISO æ˜¯ä»æœºå‘å‡ºçš„ä¿¡å·ï¼Œä¸»æœºä»è¿™ä¸ªä¿¡å·è¯»å–ä»æœºçš„æ•°æ®ã€‚é€šä¿¡å¼€å§‹å‰ï¼ŒSCLK ä¸ºä½ç”µå¹³ï¼Œå½“ SS æ‹‰ä½åï¼Œä»æœºè¢«é€‰ä¸­ï¼Œé€šä¿¡å¼€å§‹ï¼ŒMOSI å’Œ MISO ä¿¡å·åœ¨ SCLK çš„ä¸Šå‡æ²¿å‘ç”Ÿå˜åŒ–ï¼ŒMISO ä¿¡å·åœ¨ SCLK çš„ä¸‹é™æ²¿è¢«é‡‡æ ·é”å­˜ï¼Œé€šä¿¡ç»“æŸåï¼ŒSS ä¿¡å·æ‹‰é«˜ï¼ŒSCLK ä¿¡å·é‡å›ä½ç”µå¹³ï¼Œä¸€æ¬¡é€šä¿¡å‘å‡ºçš„ bit æ•°ä¸ºä¸€ä¸ª word ï¼Œä¹Ÿå«å­—é•¿ã€‚è¿™åªæ˜¯ä¸€ç§æƒ…å†µï¼Œåœ¨ SCLK ä¸‹é™æ²¿å’Œä¸Šå‡æ²¿æ‰€åšçš„äº‹æƒ…ç”± CPOL å’Œ CPHA çš„å€¼å†³å®šï¼Œå¯ä»¥åœ¨ SPI è®¾å¤‡å†…çš„å¯„å­˜å™¨é…ç½®ï¼š\nCPOLï¼Œæ—¶é’Ÿææ€§ï¼Œæ˜¯æŒ‡ SS å¤„äºé«˜ç”µå¹³ï¼Œé€šä¿¡ç©ºé—²æ—¶ï¼ŒSCLK çš„ç”µå¹³ã€‚CPOL=0 æ—¶ï¼Œ SCLK åœ¨ç©ºé—²çŠ¶æ€æ—¶ä¸ºä½ç”µå¹³ï¼ŒCPOL=1 æ—¶ï¼Œåˆ™ç›¸åã€‚ CPHAï¼Œæ—¶é’Ÿç›¸ä½ï¼Œæ˜¯æŒ‡é€šä¿¡è¿‡ç¨‹ä¸­ï¼Œæ•°æ®è¢«é‡‡æ ·é”å­˜çš„æ—¶åˆ»ã€‚å½“ CPHA=0 æ—¶ï¼ŒMOSI æˆ– MISO ä¿¡å·ä¼šåœ¨ SCLK çš„â€œå¥‡æ•°è¾¹æ²¿â€è¢«é‡‡æ ·ï¼Œå½“ CPHA=1 æ—¶ï¼Œä¿¡å·åœ¨ SCLK çš„â€œå¶æ•°è¾¹æ²¿â€é‡‡æ ·ã€‚ ä¸¤ä¸ªé…ç½®é€‰é¡¹ï¼Œå°±ä¼šç»„æˆå››ç§æ¨¡å¼ï¼Œæ—¶åºå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\næˆ‘ä»¬éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸»æœºå’Œä»æœºå¿…é¡»åœ¨ç›¸åŒçš„æ¨¡å¼ä¸‹æ‰èƒ½æ­£å¸¸é€šä¿¡ã€‚\nSPI userspace api #Linux çš„ SPI é©±åŠ¨ç”Ÿæˆçš„ spi è®¾å¤‡æ–‡ä»¶æ ¼å¼ /dev/spidevB.C ï¼Œå¹¶æä¾›äº†åŠŸèƒ½æœ‰é™çš„ API ï¼Œå¯ä»¥ç”¨ open() å’Œ close() å‡½æ•°æ‰“å¼€å’Œå…³é—­è®¾å¤‡ï¼Œç”¨ read() å’Œ write() å‡½æ•°è¯»å†™æ•°æ®ï¼Œç”¨ ioctl() å‘é€è¯·æ±‚ã€‚éœ€è¦çš„å¤´æ–‡ä»¶ï¼š\n#include \u0026lt;fcntl.h\u0026gt; #include \u0026lt;unistd.h\u0026gt; #include \u0026lt;sys/ioctl.h\u0026gt; #include \u0026lt;linux/types.h\u0026gt; #include \u0026lt;linux/spi/spidev.h\u0026gt; é¦–å…ˆéœ€è¦æ‰“å¼€è®¾å¤‡æ–‡ä»¶ï¼Œè°ƒç”¨ open() å’Œ close() æ˜¯æ ‡å‡†æ“ä½œï¼Œæ²¡æœ‰ç‰¹æ®Šä¹‹å¤„ï¼Œä¾‹å¦‚ open(\u0026quot;/dev/spidev0.0\u0026quot;, O_RDWR) ã€‚ç„¶åè°ƒç”¨ ioctl() è¿›è¡Œè®¾ç½®ï¼Œå¸¸ç”¨çš„è¯·æ±‚æœ‰ï¼š\nSPI_IOC_RD_MODE å’Œ SPI_IOC_WR_MODE ã€‚ç”¨äºæŸ¥è¯¢ï¼ˆRDï¼‰å’Œè®¾ç½®ï¼ˆWRï¼‰å•å­—èŠ‚ SPI é€šä¿¡çš„å·¥ä½œæ¨¡å¼ï¼ŒåŒ…æ‹¬æ—¶é’Ÿææ€§å’Œæ—¶é’Ÿç›¸ä½ç­‰ç‰¹æ€§ï¼Œéœ€è¦ä¼ é€’ä¸€ä¸ªå­—ç¬¦æŒ‡é’ˆï¼Œæ¯ä¸ªä½è¡¨ç¤ºä¸€ç§ç‰¹æ€§ï¼Œå¯ç”¨çš„å®å®šä¹‰åœ¨å†…æ ¸æºç çš„ include/uapi/linux/spi/spi.h æ–‡ä»¶ä¸­ï¼Œå¸¸ç”¨çš„æœ‰ï¼š SPI_MODE_0 , è¡¨ç¤º CPOL=0ï¼ŒCPHA=0 ã€‚ SPI_MODE_1 , è¡¨ç¤º CPOL=0ï¼ŒCPHA=1 ã€‚ SPI_MODE_2 , è¡¨ç¤º CPOL=1ï¼ŒCPHA=0 ã€‚ SPI_MODE_3 , è¡¨ç¤º CPOL=1ï¼ŒCPHA=1 ã€‚ SPI_CS_HIGH , è¡¨ç¤ºç‰‡é€‰ä¿¡å·é«˜ç”µå¹³æœ‰æ•ˆã€‚ SPI_LSB_FIRST, è¡¨ç¤ºæŒ‰ç…§ LSB å‘é€ï¼Œé»˜è®¤æ˜¯ MSB å‘é€ã€‚ SPI_IOC_RD_MODE32 å’Œ SPI_IOC_WR_MODE32 ã€‚ç”¨äºæŸ¥è¯¢ï¼ˆRDï¼‰å’Œè®¾ç½®ï¼ˆWRï¼‰å®Œæ•´çš„ SPI é€šä¿¡çš„å·¥ä½œæ¨¡å¼ï¼Œä¸å†å±€é™äºå•å­—èŠ‚ä¼ è¾“ã€‚éœ€è¦ä¼ é€’ä¸€ä¸ª uint32 æŒ‡é’ˆï¼Œå¯ç”¨çš„é€‰é¡¹ä¸ SPI_IOC_WR_MODE ç›¸åŒã€‚ SPI_IOC_RD_LSB_FIRST å’Œ SPI_IOC_WR_LSB_FIRST ã€‚ç”¨äºæŸ¥è¯¢ï¼ˆRDï¼‰å’Œè®¾ç½®ï¼ˆWRï¼‰SPI çš„å‘é€é¡ºåºï¼Œéœ€è¦ä¼ é€’ä¸€ä¸ªå­—ç¬¦æŒ‡é’ˆï¼Œ0 è¡¨ç¤º MSB ï¼Œå…¶ä»–å€¼è¡¨ç¤º LSB ã€‚ SPI_IOC_RD_BITS_PER_WORD å’Œ SPI_IOC_WR_BITS_PER_WORD ã€‚ç”¨äºæŸ¥è¯¢ï¼ˆRDï¼‰å’Œè®¾ç½®ï¼ˆWRï¼‰SPI é€šä¿¡çš„å­—é•¿ï¼Œå³ä¸€æ¬¡é€šä¿¡å‘é€çš„ bit æ•°ï¼Œéœ€è¦ä¼ é€’ä¸€ä¸ªå­—ç¬¦æŒ‡é’ˆï¼Œ 0 è¡¨ç¤º 8bits ã€‚ SPI_IOC_RD_MAX_SPEED_HZ å’Œ SPI_IOC_WR_MAX_SPEED_HZ ã€‚ç”¨äºæŸ¥è¯¢ï¼ˆRDï¼‰å’Œè®¾ç½®ï¼ˆWRï¼‰SPI çš„æœ€å¤§ä¼ è¾“é€Ÿç‡ï¼ˆæ¯”ç‰¹ç‡ï¼‰ï¼Œå•ä½æ˜¯ Hzï¼Œéœ€è¦ä¼ é€’ä¸€ä¸ª uint32 å‹çš„æŒ‡é’ˆã€‚ é…ç½®å®Œæ¯•åå°±æ˜¯å¯ä»¥è¯»å†™ï¼Œæ ‡å‡†çš„ read() å’Œ write() å‡½æ•°æ˜¾ç„¶åªèƒ½å®ç°åŠåŒå·¥ï¼Œåœ¨è¿™äº›å‡½æ•°è°ƒç”¨ä¹‹é—´ï¼Œç‰‡é€‰ä¼šè¢«åœç”¨ï¼Œè¦å®ç°å…¨åŒå·¥éœ€è¦è°ƒç”¨ ioctl() å‡½æ•°çš„ SPI_IOC_MESSAGE(n) è¯·æ±‚ï¼Œn ç”¨äºæŒ‡å®šä¼ è¾“çš„æ¬¡æ•°ï¼Œè¯»å†™çš„æ•°æ®éœ€è¦ç”¨ struct spi_ioc_transfer å‹çš„æŒ‡é’ˆä¼ é€’ï¼š\n#include \u0026lt;linux/spi/spidev.h\u0026gt; struct spi_ioc_transfer { __u64\ttx_buf; // å‘é€ç¼“å†²åŒºçš„æŒ‡é’ˆï¼Œé‡Œé¢çš„æ•°æ®ä¼šå‘å‡ºå»ï¼Œå¦‚æœä¸ºç©ºï¼Œä¼šå‘å‡º 0 __u64\trx_buf; // æ¥æ”¶ç¼“å†²åŒºçš„æŒ‡é’ˆï¼Œæ¥æ”¶çš„æ•°æ®ä¼šæ”¾åœ¨è¿™é‡Œï¼Œå¯ä»¥ä¸ºç©º __u32\tlen; // ä¸€æ¬¡ä¼ è¾“çš„æ•°æ®é•¿åº¦ï¼Œå•ä½æ˜¯å­—èŠ‚ __u32\tspeed_hz; // ä¸´æ—¶æ”¹å˜ SPI çš„é€Ÿç‡ __u16\tdelay_usecs; // å¦‚æœéé›¶ï¼Œè¡¨ç¤ºä¸¤æ¬¡ä¼ è¾“ç›´æ¥çš„é—´éš”ï¼Œå•ä½æ˜¯å¾®ç§’ __u8\tbits_per_word; // ä¸´æ—¶æ”¹å˜å­—é•¿ __u8\tcs_change; // å¦‚æœéé›¶ï¼Œä¸‹æ¬¡ä¼ è¾“å‰ä¼šå–æ¶ˆç‰‡é€‰ __u8\ttx_nbits; __u8\trx_nbits; __u8\tword_delay_usecs; __u8\tpad; } ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹ç¨‹ï¼Œå®ƒçš„ä½œç”¨æ˜¯å‘æŒ‡å®šçš„ SPI è®¾å¤‡å‘é€æ•°æ®ï¼Œå¹¶è¯»å›ä»è®¾å¤‡å‘æ¥çš„æ•°æ®ã€‚\n/* Copyright (C), SBS Science \u0026amp; Technology Co., Ltd. Author: LiShaocheng */ #include \u0026lt;sys/types.h\u0026gt; #include \u0026lt;sys/stat.h\u0026gt; #include \u0026lt;fcntl.h\u0026gt; #include \u0026lt;sys/ioctl.h\u0026gt; #include \u0026lt;unistd.h\u0026gt; #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; #include \u0026lt;string.h\u0026gt; #include \u0026lt;errno.h\u0026gt; #include \u0026lt;linux/types.h\u0026gt; #include \u0026lt;linux/spi/spidev.h\u0026gt; #define BUF_MAX_SIZE\t0x100 static unsigned char mode; static unsigned char bits_per_word = 8; static unsigned int speed = 100000; char *buffer; void help_info(const char *appname) { printf(\u0026#34;\\n\u0026#34; \u0026#34;*******************************************************\\n\u0026#34; \u0026#34;*********** Read/Write SPI device test **********\\n\u0026#34; \u0026#34;*******************************************************\\n\u0026#34; \u0026#34;* *\\n\u0026#34; \u0026#34; Options : %s \\n\u0026#34; \u0026#34; [-D spi_dev] [-s speed] \\n\u0026#34; \u0026#34; [-b bits_per_word] \\n\u0026#34; \u0026#34; [-H] [-O] [-C] \u0026lt;value\u0026gt; \\n\u0026#34; \u0026#34;* *\\n\u0026#34; \u0026#34;* \u0026lt;spi_dev\u0026gt; - SPI device name , /dev/spidev0.0 *\\n\u0026#34; \u0026#34;* \u0026lt;speed\u0026gt; - Max transfer speedï¼ŒHz *\\n\u0026#34; \u0026#34;* \u0026lt;bits_per_word\u0026gt; - bits per word *\\n\u0026#34; \u0026#34;* -H - Phase 1 operation of clock *\\n\u0026#34; \u0026#34;* -O - Active low polarity of clock *\\n\u0026#34; \u0026#34;* -C - Active high for chip select *\\n\u0026#34; \u0026#34;* \u0026lt;value\u0026gt; - Actual values to be sent *\\n\u0026#34; \u0026#34;*******************************************************\\n\u0026#34; \u0026#34;\\n\u0026#34;, appname); } void numToHexStr(unsigned char _hexNum, unsigned char* _hexStr) { unsigned char tmp; if(NULL == _hexStr) return; //ä½4bit tmp = (_hexNum \u0026gt;\u0026gt; 4) \u0026amp; 0x0f; if(tmp \u0026lt;= 9) *_hexStr = tmp+\u0026#39;0\u0026#39;; else *_hexStr = tmp-0x0a + \u0026#39;A\u0026#39;; _hexStr++; //é«˜4bit tmp = _hexNum \u0026amp; 0x0f; if(tmp \u0026lt;= 9) *_hexStr = tmp+\u0026#39;0\u0026#39;; else *_hexStr = tmp-0x0a + \u0026#39;A\u0026#39;; } //å°†å­—ç¬¦ä¸²è½¬ä¸º16è¿›åˆ¶å½¢å¼ï¼Œä»¥æŸ¥çœ‹ä¸å¯è§å­—ç¬¦ \u0026#34;01\u0026#34; ==\u0026gt; \u0026#34;3031\u0026#34; int toHexStr(const unsigned char * _str, unsigned char *_hexStr) { int i; int len; unsigned char* resultPtr; if(NULL == _str || NULL == _hexStr) return -1; len = strlen(_str); resultPtr = _hexStr; for(i=0; i\u0026lt;len; i++) { numToHexStr(_str[i], resultPtr); resultPtr += 2; } return strlen(_hexStr); } //åˆ¤æ–­æ˜¯å¦æ˜¯åå…­è¿›åˆ¶çš„åŸºæ•° int isHexNum(unsigned char _hexNum) { if(\u0026#39;0\u0026#39;\u0026lt;=_hexNum \u0026amp;\u0026amp; _hexNum\u0026lt;=\u0026#39;9\u0026#39;) return 1; else if(\u0026#39;A\u0026#39;\u0026lt;=_hexNum \u0026amp;\u0026amp; _hexNum\u0026lt;=\u0026#39;F\u0026#39;) return 2; else if(\u0026#39;a\u0026#39;\u0026lt;=_hexNum \u0026amp;\u0026amp; _hexNum\u0026lt;=\u0026#39;f\u0026#39;) return 3; return -1; } //åå…­è¿›åˆ¶çš„å­—ç¬¦è½¬æ•°å­— unsigned char charToHexNum(unsigned char hexChar) { unsigned char tmp; if(1\u0026gt;isHexNum(hexChar)) return 0xFF; if(hexChar\u0026lt;=\u0026#39;9\u0026#39;) tmp = hexChar-\u0026#39;0\u0026#39;; else if(hexChar\u0026lt;=\u0026#39;F\u0026#39;) tmp = hexChar-\u0026#39;7\u0026#39;; else tmp = hexChar-\u0026#39;W\u0026#39;; return tmp; } static int transfer(int fd, char *tbuf, char *rbuf, int bytes) { int ret; struct spi_ioc_transfer tr = { .tx_buf = (unsigned long)tbuf, .rx_buf = (unsigned long)rbuf, .len = bytes, }; ret = ioctl(fd, SPI_IOC_MESSAGE(1), \u0026amp;tr); if (ret == 1) printf(\u0026#34;can\u0026#39;t send spi message\u0026#34;); return ret; } int spidev_data_rw(char *dev, int len, char *buffer) { char *rbuf; int res = 0; int fd = -1; int i = 0; fd = open(dev, O_RDWR); if (fd \u0026lt; 0) { printf(\u0026#34;Error:cannot open device \u0026#34; \u0026#34;(Maybe not present in your board?)\\n\u0026#34;); return -1; } res = ioctl(fd, SPI_IOC_WR_MODE, \u0026amp;mode); if (res == -1) { printf(\u0026#34;can\u0026#39;t set spi mode\u0026#34;); goto exit; } res = ioctl(fd, SPI_IOC_RD_MODE, \u0026amp;mode); if (res == -1) { printf(\u0026#34;can\u0026#39;t set spi mode\u0026#34;); goto exit; } /* * bits per word */ res = ioctl(fd, SPI_IOC_WR_BITS_PER_WORD, \u0026amp;bits_per_word); if (res == -1) { printf(\u0026#34;can\u0026#39;t set bits per word\u0026#34;); goto exit; } res = ioctl(fd, SPI_IOC_RD_BITS_PER_WORD, \u0026amp;bits_per_word); if (res == -1) { printf(\u0026#34;can\u0026#39;t get bits per word\u0026#34;); goto exit; } /* * max speed hz */ res = ioctl(fd, SPI_IOC_WR_MAX_SPEED_HZ, \u0026amp;speed); if (res == -1) { printf(\u0026#34;can\u0026#39;t set max speed hz\u0026#34;); goto exit; } res = ioctl(fd, SPI_IOC_RD_MAX_SPEED_HZ, \u0026amp;speed); if (res == -1) { printf(\u0026#34;can\u0026#39;t get max speed hz\u0026#34;); goto exit; } printf(\u0026#34;\\n\u0026#34;); printf(\u0026#34;spi mode: %d\\n\u0026#34;, mode); printf(\u0026#34;bits per word: %d\\n\u0026#34;, bits_per_word); printf(\u0026#34;max speed: %d Hz (%d KHz)\\n\\n\u0026#34;, speed, speed/1000); rbuf = malloc(len); memset(rbuf, 0, len); res = transfer(fd, buffer, rbuf, len); if (res \u0026lt; 0) { printf(\u0026#34;Failed transferring data: %d\\n\u0026#34;, errno); free(rbuf); close(fd); return -1; } for(i=0; i\u0026lt;len; i++) { printf(\u0026#34;Data recived buffer[%d] = 0x%02x\\n\u0026#34;, i, rbuf[i]); } free(rbuf); exit: close(fd); return 0; } int main(int argc, char **argv) { char *spi_dev; int bytes, len; int res; int i; unsigned char tmp[4]; if (argc \u0026lt;= 1) { help_info(argv[0]); return 1; } mode = 0; for(i = 1; i \u0026lt; argc; i++) { if(!strcmp(argv[i], \u0026#34;-D\u0026#34;)) { i++; spi_dev = argv[i]; } else if(!strcmp(argv[i], \u0026#34;-s\u0026#34;)) { i++; speed = atoi(argv[i]); } else if(!strcmp(argv[i], \u0026#34;-b\u0026#34;)) { i++; bits_per_word = atoi(argv[i]); } else if(!strcmp(argv[i], \u0026#34;-H\u0026#34;)) mode |= SPI_CPHA; else if(!strcmp(argv[i], \u0026#34;-O\u0026#34;)) mode |= SPI_CPOL; else if(!strcmp(argv[i], \u0026#34;-C\u0026#34;)) mode |= SPI_CS_HIGH; else if((i != (argc - 1))) { printf(\u0026#34;invalid parameter\\n\u0026#34;); help_info(argv[0]); return -1; } } // è·å¾—æœ€åä¸€ä¸ªå‚æ•°çš„é•¿åº¦ï¼Œå•ä½æ˜¯ byte ï¼Œå¹¶å°†æ•°æ®å…¨éƒ¨æ”¾å…¥ buffer bytes = strlen((char *)argv[argc - 1]); if (bytes \u0026lt; 1) { printf(\u0026#34;invalid parameter for buffer size\\n\u0026#34;); help_info(argv[0]); return -1; } buffer = malloc(BUF_MAX_SIZE); memset(buffer, 0, BUF_MAX_SIZE); strcpy(buffer, (char *)argv[argc-1]); // å°†å­—ç¬¦è½¬æ¢ä¸ºåå…­è¿›åˆ¶æ•°å­— for(i=0; i\u0026lt;bytes/2; i++) { tmp[0] = charToHexNum(buffer[i*2]); tmp[0] = tmp[0]\u0026lt;\u0026lt;4; tmp[1] = charToHexNum(buffer[i*2+1]); buffer[i] = tmp[0] + tmp[1]; printf(\u0026#34;Data send buffer[%d] = 0x%02x\\n\u0026#34;, i, buffer[i]); } len = i; printf(\u0026#34;Data send buffer len = 0x%x\\n\u0026#34;, len); res = spidev_data_rw(spi_dev, len, buffer); free(buffer); return res; } ","date":"2021 April 10","permalink":"/posts/2021/04/10/","section":"Posts","summary":"SPI é€šä¿¡åè®® #SPI çš„å…¨ç§°æ˜¯ Serial Peripheral Interfaceï¼Œæ˜¯ä¸€ä¸ªå¸¦æ—¶é’ŸåŒæ­¥çš„å…¨åŒå·¥ä¸²è¡Œé“¾æ¥ï¼Œä½¿ç”¨ä¸»/ä»ç»“æ„ï¼Œç”¨äºè¿æ¥å¾®æ§åˆ¶å™¨å’Œä¼ æ„Ÿå™¨ã€å­˜å‚¨å™¨å’Œå¤–è®¾ã€‚å¸¸è§çš„è¿æ¥ç»“æ„å¦‚ä¸‹ï¼š","title":"Linux ç³»ç»Ÿçš„ SPI è®¾å¤‡ç¼–ç¨‹"},{"content":"ä»¥ NXP çš„ Yocto Linux 4.9.88 ä¸ºä¾‹ã€‚\nSystemd ç®¡ç†ç³»ç»Ÿèµ„æºçš„åŸºæœ¬å•å…ƒæ˜¯ Unit ï¼Œåˆ†ä¸º 12 ç§ï¼š\nService unitï¼šç³»ç»ŸæœåŠ¡ Target unitï¼šå¤šä¸ª Unit æ„æˆçš„ä¸€ä¸ªç»„ Device Unitï¼šç¡¬ä»¶è®¾å¤‡ Mount Unitï¼šæ–‡ä»¶ç³»ç»Ÿçš„æŒ‚è½½ç‚¹ Automount Unitï¼šè‡ªåŠ¨æŒ‚è½½ç‚¹ Path Unitï¼šæ–‡ä»¶æˆ–è·¯å¾„ Scope Unitï¼šä¸æ˜¯ç”± Systemd å¯åŠ¨çš„å¤–éƒ¨è¿›ç¨‹ Slice Unitï¼šè¿›ç¨‹ç»„ Snapshot Unitï¼šSystemd å¿«ç…§ï¼Œå¯ä»¥åˆ‡å›æŸä¸ªå¿«ç…§ Socket Unitï¼šè¿›ç¨‹é—´é€šä¿¡çš„ socket Swap Unitï¼šswap æ–‡ä»¶ Timer Unitï¼šå®šæ—¶å™¨ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ systemd-analyze å‘½ä»¤æ¥åˆ†æç³»ç»Ÿå¯åŠ¨çš„è¿‡ç¨‹ï¼š\n# æŸ¥çœ‹å¯åŠ¨è€—æ—¶ $ systemd-analyze # æŸ¥çœ‹æ¯ä¸ªæœåŠ¡çš„å¯åŠ¨è€—æ—¶ $ systemd-analyze blame # æ˜¾ç¤ºç€‘å¸ƒçŠ¶çš„å¯åŠ¨è¿‡ç¨‹æµ $ systemd-analyze critical-chain # æ˜¾ç¤ºæŒ‡å®šæœåŠ¡çš„å¯åŠ¨æµ $ systemd-analyze critical-chain atd.service # å°†ç³»ç»Ÿå¯åŠ¨æµç¨‹è¾“å‡ºä¸º svg æ ¼å¼ï¼Œå¯ä»¥é€šè¿‡æµè§ˆå™¨æŸ¥çœ‹ systemd-analyze plot \u0026gt; ./systemd.svg Systemd ä½¿ç”¨ Target æ›¿æ¢äº† init å¯åŠ¨æ¨¡å¼çš„ runlevel æ¦‚å¿µã€‚å¸¸ç”¨çš„åˆ†æå‘½ä»¤ï¼š\n# æŸ¥çœ‹å½“å‰ç³»ç»Ÿçš„æ‰€æœ‰ Target $ systemctl list-unit-files --type=target # æŸ¥çœ‹ä¸€ä¸ª Target åŒ…å«çš„æ‰€æœ‰ Unit $ systemctl list-dependencies multi-user.target # æŸ¥çœ‹å¯åŠ¨æ—¶çš„é»˜è®¤ Target $ systemctl get-default # è®¾ç½®å¯åŠ¨æ—¶çš„é»˜è®¤ Target $ systemctl set-default multi-user.target # åˆ‡æ¢ Target æ—¶ï¼Œé»˜è®¤ä¸å…³é—­å‰ä¸€ä¸ª Target å¯åŠ¨çš„è¿›ç¨‹ï¼Œsystemctl isolate å‘½ä»¤å¯ä»¥æ”¹å˜è¿™ç§è¡Œä¸ºï¼Œå®ƒä¼šå…³é—­å‰ä¸€ä¸ª Target é‡Œé¢æ‰€æœ‰ä¸å±äºåä¸€ä¸ª Target çš„è¿›ç¨‹ $ systemctl isolate multi-user.target å¸¸ç”¨çš„ä¸¤ä¸ª Target æ˜¯ï¼š\nmulti-user.target , å¤šç”¨æˆ·æ–‡æœ¬ç•Œé¢ graphical.target , å›¾å½¢ç•Œé¢ï¼Œåœ¨ multi-user.target çš„åŸºç¡€ä¸Šï¼Œå¢åŠ äº†å›¾å½¢ç•Œé¢çš„ç›¸å…³å•å…ƒã€‚ ç³»ç»Ÿç™»å½• #è™šæ‹Ÿæ§åˆ¶å°ï¼ˆtty1\u0026hellip;ï¼‰çš„ç™»å½•æ˜¯ getty@.service æœåŠ¡ç»´æŠ¤çš„ï¼Œæœ€ç»ˆè°ƒç”¨çš„æ˜¯ agetty ï¼š\nExecStart=-/sbin/agetty -o \u0026#39;-p -- \\\\u\u0026#39; --noclear %I $TERM å¯åŠ¨æœåŠ¡æ—¶é€šè¿‡ @ ç¬¦å·å‘ agetty ä¼ é€’ä¸€ä¸ªå‚æ•°ï¼Œä¾‹å¦‚æ‰§è¡Œ getty@tty1.service ï¼Œå¯åŠ¨çš„è¿›ç¨‹å°±æ˜¯ï¼š\n/sbin/agetty -o -p -- \\u --noclear tty1 linux ä¸²å£æ§åˆ¶å°çš„ç™»å½•æ˜¯ serial-getty@.service æœåŠ¡ç»´æŠ¤çš„ï¼Œæœ€ç»ˆè°ƒç”¨çš„ä¹Ÿæ˜¯ agetty ï¼š\nExecStart=-/sbin/agetty -8 -L %I 115200 $TERM è¿™é‡Œä¼ é€’çš„å‚æ•°åº”è¯¥æ˜¯ä¸²å£è®¾å¤‡æ–‡ä»¶ï¼Œä¾‹å¦‚ serial-getty@ttymxc0.service ã€‚\nagetty æœ‰å¾ˆå¤šå‚æ•°ï¼Œ\u0026ndash;noclear è¡¨ç¤ºæ¸…é™¤æ§åˆ¶å°æ˜¾ç¤ºçš„å¯åŠ¨ä¿¡æ¯ï¼š\n-J, --noclear Do not clear the screen before prompting for the login name. By default the screen is cleared. -a ç”¨äºè‡ªåŠ¨ç™»å½•ï¼š\n-a, --autologin username Automatically log in the specified user without asking for a username or password. Using this option causes an -f username option and argument to be added to the /bin/login command line. See --login-options, which can be used to modify this option\u0026#39;s behavior. Note that --autologin may affect the way in which getty initializes the serial line, because on auto-login agetty does not read from the line and it has no opportunity optimize the line setting. è¦ç³»ç»Ÿå¯åŠ¨æ—¶åœ¨ä¸²å£æ§åˆ¶å°è‡ªåŠ¨ç™»å½• root ç”¨æˆ·ï¼Œå¯ä»¥åšå¦‚ä¸‹æ“ä½œï¼š\næ–°å»º /etc/systemd/system/serial-getty@ttymxc0.service.d/ ç›®å½•ã€‚ åœ¨ä¸Šé¢æ–°å»ºçš„ç›®å½•ä¸­æ·»åŠ  autologing.conf æ–‡ä»¶ã€‚ åœ¨ autologing.conf æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š [Service] ExecStart= ExecStart=-/sbin/agetty -a root -8 -L %I 115200 $TERM è¿™é‡Œåˆ©ç”¨çš„æ˜¯ systemd çš„é™„åŠ é…ç½®ç‰‡æ®µåŠŸèƒ½ï¼Œè¿™ä¸ªåŠŸèƒ½å¯ä»¥ä¿®æ”¹ã€é‡ç½®æˆ–è€…è¿½åŠ é…ç½®é€‰é¡¹ã€‚å…ˆåˆ›å»ºåä¸º /etc/systemd/system/\u0026lt;Unit\u0026gt;.d/ çš„ç›®å½•ï¼Œç„¶åæ”¾å…¥ *.conf æ–‡ä»¶ï¼Œå…¶ä¸­å¯ä»¥æ·»åŠ æˆ–é‡ç½®é€‰é¡¹å‚æ•°ï¼Œè¿™é‡Œè®¾ç½®çš„å‚æ•°ä¼˜å…ˆçº§é«˜äºåŸæ¥çš„ Unit é…ç½®æ–‡ä»¶ã€‚ç”¨ systemctl å‘½ä»¤ä¼šæ›´ç®€å•ï¼š\n$ systemctl edit unit è¿™å°†ä¼šåœ¨ç¼–è¾‘å™¨ä¸­æ‰“å¼€æ–‡ä»¶ /etc/systemd/system/[unit].d/override.confï¼Œç¼–è¾‘å®Œæˆä¹‹åè‡ªåŠ¨åŠ è½½ã€‚\nåŸºäº X11 çš„ Qt åº”ç”¨è‡ªå¯åŠ¨ #ç³»ç»Ÿä¸­å¯åŠ¨ Qt çš„æœåŠ¡æ˜¯ xserver-nodm ï¼Œæ˜¯é€šè¿‡ Yocto çš„ xserver-nodm-init_3.0.bb å®‰è£…çš„ã€‚å¯åŠ¨åè°ƒç”¨äº†å¦‚ä¸‹è„šæœ¬ï¼š\nxserver-nodm.service /etc/xserver-nodm/Xserver - /etc/default/xserver-nodm åˆå§‹åŒ–ä¸€äº›ç¯å¢ƒå˜é‡ exec xinit /etc/X11/Xsession -- $XSERVER $DISPLAY $ARGS $* xinit /etc/X11/Xsession -- /usr/bin/Xorg :0 -br -pn æœ€ç»ˆå¹²æ´»çš„æ˜¯ xinit ï¼Œè¿™æ˜¯ X Window ç³»ç»Ÿçš„å¯åŠ¨å™¨ï¼Œå®ƒçš„åŠŸèƒ½æ˜¯å¯åŠ¨ä¸€ä¸ª X Server ï¼ŒåŒæ—¶å¯åŠ¨ä¸€ä¸ª X Client ï¼ŒåŸºæœ¬è¯­æ³•æ˜¯ï¼š\nxinit [ [ client ] options ] [ -- [ server ] [ display ] options ] åœ¨è¿™é‡Œå®ƒæ‰§è¡Œäº† /etc/X11/Xsession è„šæœ¬ï¼ŒXsession ä¼šæŒ‰å­—æ¯é¡ºåºæ‰§è¡Œ /etc/X11/Xsession.d ä¸‹é¢çš„è„šæœ¬ï¼Œåœ¨è„šæœ¬å†…å¯åŠ¨ Qt åº”ç”¨ï¼Œé»˜è®¤å®‰è£…æ—¶ä¼šæœ‰å¾ˆå¤šï¼š\n$ ls /etc/X11/Xsession.d/ 13xdgbasedirs.sh 30xinput_calibrate.sh 70settings-daemon.sh 80matchboxkeyboard.sh 89xdgautostart.sh 90XWindowManager.sh æˆ‘ä»¬å¯ä»¥ä¿®æ”¹è¿™é‡Œçš„è„šæœ¬ï¼Œæ¥å¯åŠ¨è‡ªå·±çš„ Qt åº”ç”¨ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬åªæƒ³å¯åŠ¨ /home/root/ ä¸‹çš„ basiclayouts ï¼Œå¯ä»¥å°† /etc/X11/Xsession.d/ ä¸‹çš„æ–‡ä»¶å…¨éƒ¨åˆ æ‰ï¼Œç„¶åæ–°å»ºä¸€ä¸ª 10qtapp.sh ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\nexec /home/root/basiclayouts é‡å¯ç³»ç»Ÿï¼Œbasiclayouts å°±ä¼šè‡ªåŠ¨å¯åŠ¨ã€‚\næ–‡æœ¬ç•Œé¢çš„ç¨‹åºè‡ªå¯åŠ¨ #é»˜è®¤æƒ…å†µä¸‹ï¼Œç³»ç»Ÿå¯åŠ¨çš„æ˜¯å›¾å½¢ç›®æ ‡ï¼š\n$ systemctl get-default graphical.target å¦‚ä¸ä¸éœ€è¦å›¾å½¢ç•Œé¢ï¼Œå¯ä»¥åˆ‡æ¢åˆ°å¤šç”¨æˆ·æ–‡æœ¬ç›®æ ‡ï¼š\n$ systemctl set-default multi-user.target Removed /etc/systemd/system/default.target. Created symlink /etc/systemd/system/default.target â†’ /lib/systemd/system/multi-user.target. systemd é€šè¿‡ rc-local.service è°ƒç”¨ /etc/rc.local ã€‚éœ€è¦å¼€æœºæ—¶å®ç°çš„ç¨‹åºï¼Œå¯ä»¥æ·»åŠ åˆ° rc.local æ–‡ä»¶ä¸­ã€‚\n","date":"2021 March 6","permalink":"/posts/2021/03/06/","section":"Posts","summary":"ä»¥ NXP çš„ Yocto Linux 4.","title":"Systemd ä¸­å®ç°è‡ªåŠ¨ç™»å½•å’Œç¨‹åºè‡ªå¯åŠ¨"},{"content":"1. æ¦‚è¿° #NXP ä¸ºå®˜æ–¹è¯„ä¼°æ¿ i.MX6ULL EVK æä¾›äº†å®Œæ•´çš„ Yocto é¡¹ç›®æºç å’Œæ–‡æ¡£ ï¼Œæ¿å¡çš„å¤–è§‚å’Œæ¥å£å¦‚å›¾ï¼š\nç‰¹æ€§ï¼š\nå‚è€ƒæ¿æ˜¯ iMX6ULL EVK ï¼šhttps://www.nxp.com/design/development-boards/i-mx-evaluation-and-development-boards/evaluation-kit-for-the-i-mx-6ull-and-6ulz-applications-processor:MCIMX6ULL-EVK èŠ¯ç‰‡æ˜¯ NXP çš„ iMX6ULL : https://www.nxp.com/products/processors-and-microcontrollers/arm-processors/i-mx-applications-processors/i-mx-6-processors:IMX6X_SERIES è½¯ä»¶ä½¿ç”¨æœ€æ–°çš„ Linux 5.4.47_2.2.0 : https://www.nxp.com/design/software/embedded-software/i-mx-software/embedded-linux-for-i-mx-applications-processors:IMXLINUX 2. æ„å»ºç³»ç»Ÿ #æˆ‘ä»¬å…ˆä¸ºè¿™ä¸ªæ¿å¡ç¼–è¯‘ä¸€ä¸ªå¯ä»¥è¿è¡Œçš„ç³»ç»Ÿã€‚\n2.1. å‡†å¤‡å®¿ä¸»æœº #ä½¿ç”¨ Ubuntu 20.04 ï¼ˆè‡³å°‘è¦ç”¨ 18.04 ï¼Œä½ç‰ˆæœ¬ç³»ç»Ÿä¼šé‡åˆ°å¾ˆå¤šé—®é¢˜ï¼‰ï¼Œå®‰è£…å¿…è¦çš„å¼€å‘åŒ…ï¼š\n$ sudo apt-get install gawk wget git-core diffstat unzip texinfo gcc-multilib \\ build-essential chrpath socat cpio python python3 python3-pip python3-pexpect \\ xz-utils debianutils iputils-ping python3-git python3-jinja2 libegl1-mesa libsdl1.2-dev \\ pylint3 xterm å®‰è£… repo :\n$ sudo curl https://storage.googleapis.com/git-repo-downloads/repo \u0026gt; /usr/bin/repo $ sudo chmod +x /usr/bin/repo éœ€è¦è®¾ç½® git è´¦æˆ·ï¼š\n$ git config --global user.name \u0026#34;Your Name\u0026#34; $ git config --global user.email \u0026#34;Your Email\u0026#34; æ–°å»ºä¸€ä¸ªå·¥ç¨‹ç›®å½•ï¼Œç„¶åå¼€å§‹æ‹‰å–æºç ï¼š\n$ mkdir imx-yocto-bsp-5.4.47 $ cd imx-yocto-bsp-5.4.47 $ repo init -u https://source.codeaurora.org/external/imx/imx-manifest -b imx-linux-zeus -m imx-5.4.47-2.2.0.xml $ repo sync æ‹‰å–è¿‡ç¨‹éœ€è¦è¿æ¥ google å’Œ github çš„æœåŠ¡å™¨ï¼Œæ‰€ä»¥å¿…é¡»ç¿»å¢™ã€‚æœ‰äº›è¿œç¨‹ä»“åº“ä½¿ç”¨ git:// ä¸‹è½½å¾ˆæ…¢ï¼Œå¯ä»¥ä¿®æ”¹ .repo/manifests/imx-5.4.47-2.2.0.xml æ–‡ä»¶ä¸­çš„ URL ï¼Œæ›¿æ¢æˆ https:// åŠ å¿«ä¸‹è½½é€Ÿåº¦ã€‚ä¸­é€”å¦‚æœå¡ä½ï¼Œå¯ä»¥ç»“æŸè¿›ç¨‹åé‡æ–°æ‰§è¡Œ repo sync ã€‚ä¹Ÿå¯ä»¥åœ¨ repo sync å‘½ä»¤ä¸­æ·»åŠ  -j4 é€‰é¡¹ï¼Œå¼€å¯å››çº¿ç¨‹ä¸‹è½½ï¼ŒåŠ å¿«ä¸‹è½½é€Ÿåº¦ã€‚\næ‹‰å–æˆåŠŸåï¼Œä¼šæç¤º repo sync has finished successfully. ï¼Œæ‰€æœ‰æºç ä¼šæ”¾åœ¨ imx-yocto-bsp-5.4.47/sources ç›®å½•ä¸‹:\n~/imx-yocto-bsp-5.4.47$ ls -l total 12 lrwxrwxrwx 1 sbs sbs 19 Nov 20 05:55 README -\u0026gt; sources/base/README lrwxrwxrwx 1 sbs sbs 23 Nov 20 05:55 README-IMXBSP -\u0026gt; sources/meta-imx/README drwxrwxr-x 3 sbs sbs 4096 Nov 20 07:08 downloads lrwxrwxrwx 1 sbs sbs 43 Nov 20 05:55 imx-setup-release.sh -\u0026gt; sources/meta-imx/tools/imx-setup-release.sh lrwxrwxrwx 1 sbs sbs 30 Nov 20 05:55 setup-environment -\u0026gt; sources/base/setup-environment drwxrwxr-x 16 sbs sbs 4096 Nov 20 05:55 sources 2.2. é…ç½® #NXP æä¾›äº†ä¸€ä¸ªè„šæœ¬ imx-setup-release.shï¼Œå®ƒç®€åŒ–äº† i.MX æœºå™¨çš„è®¾ç½®ã€‚è¯­æ³•ï¼š\n[MACHINE=\u0026lt;machine\u0026gt;] [DISTRO=fsl-imx-\u0026lt;backend\u0026gt;] source ./imx-setup-release.sh -b \u0026lt;build folder\u0026gt; MACHINE è¡¨ç¤ºç›®æ ‡æœºçš„ç¡¬ä»¶åç§°ï¼Œå½“å‰ç‰ˆæœ¬æ”¯æŒçš„ç¡¬ä»¶å¯ä»¥åœ¨ meta-imx/README æ–‡ä»¶ä¸­æŸ¥çœ‹ï¼Œå®é™…ä¸Šæ˜¯æŒ‡å‘äº† meta-imx/meta-bsp/conf/machine ç›®å½•ä¸‹çš„ç›¸åº”é…ç½®æ–‡ä»¶ã€‚å¯¹äº i.MX 6ULL EVK å¼€å‘æ¿ï¼Œè¦è®¾ä¸º imx6ull14x14evk ã€‚ DISTRO æ˜¯å‘è¡Œç‰ˆçš„åç§°ï¼Œéœ€è¦è®¾ç½®ä¸º meta-imx/meta-sdk/conf/distro ç›®å½•ä¸‹å­˜åœ¨çš„é…ç½®æ–‡ä»¶ï¼ˆä¸ç”¨å¸¦åç¼€ï¼‰ï¼Œè¿™ä¸ªé…ç½®æ–‡ä»¶è®¾ç½®äº†è¯¥å‘è¡Œç‰ˆåŒ…å«å“ªäº›è½¯ä»¶ã€‚å½“å‰ç‰ˆæœ¬æ”¯æŒå‘è¡Œç‰ˆæœ‰ï¼š fsl-imx-fb.confï¼Œæ”¯æŒ framebuff å›¾åƒç•Œé¢çš„ç³»ç»Ÿ fsl-imx-wayland.confï¼Œæ”¯æŒ wayland åè®®çš„ç³»ç»Ÿ fsl-imx-x11.confï¼Œæ”¯æŒ x11 åè®®çš„ç³»ç»Ÿ fsl-imx-xwayland.confï¼ŒåŒæ—¶æ”¯æŒ x11 å’Œ wayland çš„ç³»ç»Ÿ build folder ç”¨äºæŒ‡å®šç¼–è¯‘ç›®å½•ï¼Œæ¯ä¸ªå‘è¡Œç‰ˆéƒ½åº”è¯¥æœ‰ç‹¬ç«‹çš„ç¼–è¯‘ç›®å½•ï¼Œç¼–è¯‘è¿‡ç¨‹ä¸­äº§ç”Ÿçš„æ‰€æœ‰æ–‡ä»¶éƒ½ä¼šè¾“å‡ºåˆ°è¿™ä¸ªç›®å½•ä¸‹ã€‚ åœ¨ imx-yocto-bsp-5.4.47 ç›®å½•ä¸‹æ‰§è¡Œï¼š\nMACHINE=imx6ull14x14evk DISTRO=fsl-imx-fb source ./imx-setup-release.sh -b imx6ullevk-fb æ ¹æ®æç¤ºæ¥å— EULA åè®®ï¼Œæ‰§è¡ŒæˆåŠŸåï¼Œä¼šè‡ªåŠ¨è¿›å…¥ imx-yocto-bsp-5.4.47/imx6ullevk-fb ç›®å½•ï¼Œæ‰€æœ‰çš„é…ç½®æ–‡ä»¶éƒ½ä½äº conf ç›®å½•ä¸‹ï¼š\nbblayers.conf åŒ…å«äº†æœ¬å‘è¡Œç‰ˆæ‰€éœ€çš„æ‰€æœ‰ layer ï¼Œç¼–è¯‘æ—¶ï¼Œä¼šåˆ°è¿™äº› layer ä¸‹æ‰¾ç›¸åº”çš„ recipe ã€‚ local.conf åŒ…å«äº†ä¸€äº›ç¼–è¯‘è®¾ç½®é€‰é¡¹ï¼Œæ¯”å¦‚æŒ‡å®šäº†ç¡¬ç›˜å¹³å°çš„ MACHINE å˜é‡ã€‚ 2.3. ç¼–è¯‘ #å®˜æ–¹æä¾›äº†å¤šç§ç¼–è¯‘ç›®æ ‡ï¼Œå¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©ï¼Œæˆ–è€…åœ¨æ­¤åŸºç¡€ä¸Šä¿®æ”¹ï¼š\nè¿™é‡Œç¼–è¯‘ä¸€ä¸ªåŸºç¡€ç‰ˆæœ¬ï¼š\n$ bitbake core-image-base ç½‘ç»œè‰¯å¥½çš„æƒ…å†µä¸‹ï¼Œå¤§çº¦éœ€è¦ 5 å°æ—¶ã€‚ä¸‹è½½çš„è½¯ä»¶åŒ…æºç éƒ½ä½äº imx-yocto-bsp-5.4.47/downloads ç›®å½•ä¸‹ã€‚å¦‚æœå‡ºç°ç±»ä¼¼å¦‚ä¸‹çš„é”™è¯¯ï¼Œé€šå¸¸æ˜¯ç½‘ç»œè¿æ¥çš„é—®é¢˜ï¼Œç¡®ä¿å¯ä»¥è®¿é—® www.example.com åå³å¯æ­£å¸¸ç¼–è¯‘ï¼š\nFetcher failure for URL: \u0026#39;https://www.example.com/\u0026#39;. URL https://www.example.com/ doesn\u0026#39;t work. 2.4. çƒ§å†™ #ç¼–è¯‘æˆåŠŸåï¼Œè¾“å‡ºçš„æ–‡ä»¶ä½äº tmp/deploy/images/imx6ull14x14evk ç›®å½•ä¸‹ï¼Œç”¨äº SD/MMC/eMMC çš„é•œåƒå‹ç¼©æ–‡ä»¶æ˜¯ core-image-base-imx6ull14x14evk.wic.bz2ï¼Œå®ƒåŒ…å«äº† U-boot ï¼Œè®¾å¤‡æ ‘ï¼Œå†…æ ¸å’Œæ ¹æ–‡ä»¶ç³»ç»Ÿï¼Œå¯ä»¥ç”¨å¦‚ä¸‹å‘½ä»¤ç›´æ¥å†™å…¥ SD å¡ï¼š\n$ bunzip2 -dk -f \u0026lt;image_name\u0026gt;.wic.bz2 $ sudo dd if=\u0026lt;image name\u0026gt;.wic of=/dev/sd\u0026lt;partition\u0026gt; bs=1M conv=fsync é»˜è®¤çš„ .wic é•œåƒä¸Šçš„ rootfs è¢«é™åˆ¶åœ¨ 4GB ä»¥ä¸‹ï¼Œä½†é‡æ–°åˆ†åŒºå’Œé‡æ–°åŠ è½½ rootfs å¯ä»¥å°†å…¶å¢åŠ åˆ°å¡çš„å¤§å°ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥ç‰ˆæœ¬å¯¹SDå¡ä¸Šçš„é•œåƒä½¿ç”¨ä»¥ä¸‹å¸ƒå±€ã€‚å†…æ ¸æ˜ åƒå’Œ DTB ç§»åŠ¨åˆ°ä½¿ç”¨ FAT åˆ†åŒºï¼Œåœ¨ SD å¡ä¸Šæ²¡æœ‰å›ºå®šçš„åŸå§‹åœ°å€ã€‚å¦‚æœéœ€è¦å›ºå®šçš„åŸå§‹åœ°å€ï¼Œç”¨æˆ·å¿…é¡»æ”¹å˜ U-Boot çš„å¯åŠ¨ç¯å¢ƒã€‚\nä¸ºäº†çµæ´»ä½¿ç”¨ï¼Œä¹Ÿæœ‰å¯ä»¥å•ç‹¬çƒ§å†™çš„ç»„ä»¶ï¼š\nu-boot-imx6ull14x14evk.imxï¼ŒU-boot æ–‡ä»¶ imx6ull-14x14-evk-emmc-imx6ull14x14evk.dtb ï¼Œè®¾å¤‡æ ‘æ–‡ä»¶ zImage-imx6ull14x14evk.binï¼Œ å†…æ ¸æ–‡ä»¶ core-image-base-imx6ull14x14evk.tar.bz2 ï¼Œæ ¹æ–‡ä»¶ç³»ç»Ÿå‹ç¼©æ–‡ä»¶ã€‚ ä¸Šé¢è¿™äº›æ–‡ä»¶é€šå¸¸æ˜¯ä¸€ä¸ªè½¯é“¾æ¥ï¼Œæ¯æ¬¡ç¼–è¯‘åéƒ½ä¼šæŒ‡å‘æœ€æ–°ç¼–è¯‘ç”Ÿæˆçš„å®é™…æ–‡ä»¶ã€‚å…³äºå•ç‹¬çƒ§å†™çš„è¯¦ç»†ä¿¡æ¯å¯ä»¥å‚è€ƒ i.MX LinuxÂ® User\u0026rsquo;s Guide (IMXLUG) ä¸­çš„ \u0026ldquo;4.3 Preparing an SD/MMC card to boot\u0026rdquo; ã€‚å¦‚æœè¦çƒ§å†™åˆ°æ¿è½½çš„ eMMC ï¼Œé€šå¸¸æ˜¯ç”¨ UUU å·¥å…·ï¼Œé€šè¿‡ USB-OTG æ¥å£çƒ§å†™ã€‚\n2.5. å®‰è£… # å°† TFå¡å®‰è£…åˆ° CPU æ¿çš„ MicroSD æ’æ§½ï¼ˆJ301ï¼‰ ç”¨ USB çº¿ç¼†ï¼ˆMicro-B è½¬æ ‡å‡†-Aï¼‰è¿æ¥å¼€å‘æ¿çš„è°ƒè¯• USB å£ï¼ˆJ1901 ï¼‰å’Œç”µè„‘çš„ USB å£ï¼Œåœ¨ç”µè„‘çš„è®¾å¤‡ç®¡ç†å™¨ä¸Šå¯ä»¥çœ‹åˆ°ä¸²å£è®¾å¤‡ï¼ˆéœ€è¦å®‰è£…é©±åŠ¨ï¼‰ï¼š åœ¨ç”µè„‘ä¸Šæ‰“å¼€ä¸€ä¸ªä¸²å£ç»ˆç«¯ï¼Œæ¯”å¦‚ putty ï¼ŒæŒ‰å¦‚ä¸‹é…ç½®ï¼š æ³¢ç‰¹ç‡ï¼š 115200 æ•°æ®ä½ï¼š 8 åœæ­¢ä½ï¼š 1 å¥‡å¶æ ¡éªŒï¼šæ—  æµæ§åˆ¶ï¼šæ—  å°† CPU æ¿çš„å¯åŠ¨æ¨¡å¼é€‰æ‹©å¼€å…³ï¼ˆSW602ï¼‰è®¾ä¸º D1:ONã€ D2:OFF ï¼Œå¯åŠ¨è®¾å¤‡é€‰æ‹©å¼€å…³ï¼ˆSW601ï¼‰è®¾ä¸º D1:OFFã€ D2:OFFã€ D3:ONã€ D4:OFF ï¼Œè¡¨ç¤ºä» TF å¡å¯åŠ¨ï¼š è¿æ¥ç”µæºï¼Œå°†ç”µæºå¼€å…³ï¼ˆSW2001ï¼‰æ»‘è‡³ ON ï¼Œç³»ç»Ÿå³å¼€å§‹å¯åŠ¨ï¼Œåœ¨ä¸²å£ç»ˆç«¯è½¯ä»¶ä¸Šå¯ä»¥çœ‹åˆ°å¯åŠ¨è¿‡ç¨‹ã€‚ å¯åŠ¨å®Œæ¯•åä¼šçœ‹åˆ°ç™»å½•æç¤ºç¬¦ï¼Œç”¨æˆ·åæ˜¯ root ï¼Œæ— å¯†ç ã€‚ 3. ä½¿ç”¨ UUU #Universal Update Utilityï¼ˆUUUï¼‰æ˜¯ MFGTools çš„æœ€æ–°æ¼”è¿›ç‰ˆ(ä¹Ÿå«åš MFGTools v3)ï¼Œå¯ä»¥åœ¨ Win10 64bit å’Œ Ubuntu 16.14 64bit ä»¥ä¸Šç‰ˆæœ¬çš„ä¸»æœºä¸Šè¿è¡Œï¼Œæ˜¯NXPå®˜æ–¹å¼€å‘çš„é•œåƒçƒ§å†™å·¥å…·ï¼Œæˆ‘ä»¬ä¸»è¦æ˜¯ç”¨å®ƒé€šè¿‡ USB-OTG æ¥å£å°†å„ç§ç³»ç»Ÿé•œåƒç»„ä»¶çƒ§å†™åˆ°æ¿è½½çš„ eMMC ã€‚å¯ä»¥åœ¨ https://github.com/NXPmicro/mfgtools/releases ä¸‹è½½è½¯ä»¶å’Œæ–‡æ¡£ï¼Œå½“å‰ç‰ˆæœ¬æ˜¯ 1.4.43 ã€‚\n3.1. å‡†å¤‡ #éœ€è¦å°†æ¿ä¸Šçš„ SD å¡å–å‡ºï¼Œæ¢æˆ eMMC ï¼Œç„¶åå°†å¯åŠ¨æ¨¡å¼æ”¹ä¸ºä¸²è¡Œä¸‹è½½å™¨ï¼ˆSW602:D1:OFF,D2:ON)ã€‚ä½¿ç”¨ USB-OTG æ•°æ®çº¿å°†æ¿è½½çš„ OTG æ¥å£è¿æ¥åˆ°ç”µè„‘ã€‚ åœ¨ç”µè„‘ç«¯æ‰“å¼€ PowerShell ç¯å¢ƒï¼Œè¿›å…¥ uuu ç¨‹åºçš„ç›®å½•ï¼Œæ‰§è¡Œ uuu.exe -lsusb ï¼Œä¼šåˆ—å‡ºè¯†åˆ«åˆ°çš„ USB Device ï¼š\nPS D:\\NXP_iMX6\\UUU\u0026gt; .\\uuu.exe -lsusb uuu (Universal Update Utility) for nxp imx chips -- libuuu_1.4.43-0-ga9c099a Connected Known USB Devices Path Chip Pro Vid Pid BcdVersion ================================================== 1:4 MX6ULL SDP: 0x15A2 0x0080 0x0001 å¯ä»¥å°†è°ƒè¯•ä¸²å£ä¹Ÿè¿æ¥åˆ°ç”µè„‘ï¼Œä¼šæœ‰ä¿¡æ¯æ‰“å°è¾“å‡ºã€‚\n3.2. çƒ§å†™ BootLoader #ä»¥çƒ§å†™ u-boot ä¸ºä¾‹ï¼Œå°† u-boot é•œåƒæ–‡ä»¶æ”¾åœ¨ uuu ç¨‹åºçš„ç›®å½•ä¸‹ï¼Œç„¶åæ‰§è¡Œ uuu.exe -b emmc \u0026lt;bootloader\u0026gt; ï¼Œç«‹å³å¼€å§‹çƒ§å†™ï¼Œçƒ§å†™æˆåŠŸæ˜¾ç¤ºå¦‚ä¸‹ï¼š\nPS D:\\NXP_iMX6\\UUU\u0026gt; .\\uuu.exe -b emmc .\\u-boot-sd-optee-2020.04-r0.imx uuu (Universal Update Utility) for nxp imx chips -- libuuu_1.4.43-0-ga9c099a Success 1 Failure 0 1:6 7/ 7 [Done ] FB: Done åœ¨ç”µè„‘çš„ä¸²å£ç»ˆç«¯ä¹Ÿå¯ä»¥è°ƒè¯•ä¸²å£æ‰“å°çš„è¯¦ç»†çƒ§å†™è¿‡ç¨‹ï¼š\nU-Boot 2020.04-5.4.47-2.2.0+gffc3fbe7e5 (Nov 23 2020 - 03:48:29 +0000) CPU: i.MX6ULL rev1.1 900 MHz (running at 396 MHz) CPU: Commercial temperature grade (0C to 95C) at 43C Reset cause: POR Model: i.MX6 ULL 14x14 EVK Board Board: MX6ULL 14x14 EVK DRAM: 512 MiB MMC: FSL_SDHC: 0, FSL_SDHC: 1 Loading Environment from MMC... *** Warning - bad CRC, using default environment [*]-Video Link 0 (480 x 272) [0] lcdif@21c8000, video In: serial Out: serial Err: serial switch to partitions #0, OK mmc1(part 0) is current device flash target is MMC:1 Net: Warning: ethernet@20b4000 using MAC address from ROM eth1: ethernet@20b4000 [PRIME]Get shared mii bus on ethernet@2188000 Warning: ethernet@2188000 using MAC address from ROM, eth0: ethernet@2188000 Fastboot: Normal Boot from USB for mfgtools *** Warning - Use default environment for mfgtools, using default environment Run bootcmd_mfg: run mfgtool_args;if iminfo ${initrd_addr}; then if test ${tee} = yes; then bootm ${tee_addr} ${initrd_addr} ${fdt_addr}; else bootz ${loadaddr} ${initrd_addr} ${fdt_addr}; fi; else echo \u0026#34;Run fastboot ...\u0026#34;; fastboot 0; fi; Hit any key to stop autoboot: 0 ## Checking Image at 86800000 ... Unknown image format! Run fastboot ... switch to partitions #0, OK mmc1(part 0) is current device Starting download of 543744 bytes .... downloading of 543744 bytes finished writing to partition \u0026#39;bootloader\u0026#39; Initializing \u0026#39;bootloader\u0026#39; switch to partitions #1, OK mmc1(part 1) is current device Writing \u0026#39;bootloader\u0026#39; MMC write: dev # 1, block # 2, count 1062 ... 1062 blocks written: OK Writing \u0026#39;bootloader\u0026#39; DONE! çƒ§å†™å®Œæ¯•åï¼Œå°†å¯åŠ¨æ¨¡å¼è®¾ä¸º eMMC å¯åŠ¨ï¼ˆSW602:D1:ON,D2:OFF; SW601:D1:OFF,D2:ON,D3:ON,D4:OFFï¼‰ï¼Œç„¶åæŒ‰ä¸‹å¤ä½é”®ï¼Œä¸»æ¿å¤ä½ï¼Œåœ¨ä¸²å£ç»ˆç«¯å¯ä»¥çœ‹åˆ° u-boot çš„å¯åŠ¨ä¿¡æ¯ï¼š\nU-Boot 2020.04-5.4.47-2.2.0+gffc3fbe7e5 (Nov 23 2020 - 03:48:29 +0000) CPU: i.MX6ULL rev1.1 900 MHz (running at 396 MHz) CPU: Commercial temperature grade (0C to 95C) at 47C Reset cause: POR Model: i.MX6 ULL 14x14 EVK Board Board: MX6ULL 14x14 EVK DRAM: 512 MiB MMC: FSL_SDHC: 0, FSL_SDHC: 1 Loading Environment from MMC... *** Warning - bad CRC, using default environment [*]-Video Link 0 (480 x 272) [0] lcdif@21c8000, video In: serial Out: serial Err: serial switch to partitions #0, OK mmc1(part 0) is current device flash target is MMC:1 Net: Warning: ethernet@20b4000 using MAC address from ROM eth1: ethernet@20b4000 [PRIME]Get shared mii bus on ethernet@2188000 Warning: ethernet@2188000 using MAC address from ROM, eth0: ethernet@2188000 Fastboot: Normal Normal Boot Hit any key to stop autoboot: 0 =\u0026gt; 3.3. çƒ§å†™ç³»ç»Ÿé•œåƒ #çƒ§å†™ç³»ç»Ÿé•œåƒçš„è¯­æ³•æ˜¯ uuu.exe -b emmc_all \u0026lt;bootloader\u0026gt; \u0026lt;rootfs.wic.bz2\u0026gt; ,ä¾‹å¦‚ï¼š\nPS D:\\NXP_iMX6\\UUU\u0026gt; .\\uuu.exe -b emmc_all .\\u-boot-sd-optee-2020.04-r0.imx .\\core-image-base-imx6ull14x14evk-20201123024550.rootfs.wic.bz2 uuu (Universal Update Utility) for nxp imx chips -- libuuu_1.4.43-0-ga9c099a Success 1 Failure 0 1:6 8/ 8 [Done ] FB: done çƒ§å†™å®Œæ¯•åï¼Œå°†å¯åŠ¨æ¨¡å¼è®¾ä¸º eMMC å¯åŠ¨ï¼ˆSW602:D1:ON,D2:OFF; SW601:D1:OFF,D2:ON,D3:ON,D4:OFFï¼‰ï¼Œç„¶åæŒ‰ä¸‹å¤ä½é”®ï¼Œä¸»æ¿å¤ä½ï¼Œåœ¨ä¸²å£ç»ˆç«¯å¯ä»¥çœ‹åˆ°ç³»ç»Ÿå¯åŠ¨ä¿¡æ¯ã€‚\nU-Boot 2020.04-5.4.47-2.2.0+gffc3fbe7e5 (Nov 23 2020 - 03:48:29 +0000) CPU: i.MX6ULL rev1.1 900 MHz (running at 396 MHz) CPU: Commercial temperature grade (0C to 95C) at 43C Reset cause: POR Model: i.MX6 ULL 14x14 EVK Board Board: MX6ULL 14x14 EVK DRAM: 512 MiB MMC: FSL_SDHC: 0, FSL_SDHC: 1 Loading Environment from MMC... *** Warning - bad CRC, using default environment [*]-Video Link 0 (480 x 272) [0] lcdif@21c8000, video In: serial Out: serial Err: serial switch to partitions #0, OK mmc1(part 0) is current device flash target is MMC:1 Net: Warning: ethernet@20b4000 using MAC address from ROM eth1: ethernet@20b4000 [PRIME]Get shared mii bus on ethernet@2188000 Warning: ethernet@2188000 using MAC address from ROM, eth0: ethernet@2188000 Fastboot: Normal Boot from USB for mfgtools *** Warning - Use default environment for mfgtools, using default environment Run bootcmd_mfg: run mfgtool_args;if iminfo ${initrd_addr}; then if test ${tee} = yes; then bootm ${tee_addr} ${initrd_addr} ${fdt_addr}; else bootz ${loadaddr} ${initrd_addr} ${fdt_addr}; fi; else echo \u0026#34;Run fastboot ...\u0026#34;; fastboot 0; fi; Hit any key to stop autoboot: 0 ...... NXP i.MX Release Distro 5.4-zeus imx6ull14x14evk ttymxc0 imx6ull14x14evk login: 4. ä½¿ç”¨ U-boot #å†…æ ¸å’Œæ–‡ä»¶ç³»ç»Ÿè¿˜å¯ä»¥ä½¿ç”¨ u-boot ä¸‹è½½ã€‚\n5. Yoctoç³»ç»Ÿå¼€å‘ #Yoctoç³»ç»Ÿå¼€å‘çš„å­¦ä¹ è¿‡ç¨‹å¯ä»¥å‚è€ƒ https://www.yoctoproject.org/docs/what-i-wish-id-known/ ã€‚\nå‰é¢æ˜¯ä½¿ç”¨å®˜æ–¹æä¾›çš„é…ç½®ç¼–è¯‘å‡ºç³»ç»Ÿé•œåƒï¼Œé€šå¸¸æˆ‘ä»¬éœ€è¦æ ¹æ®å®é™…æƒ…å†µå®šåˆ¶è‡ªå·±çš„ç³»ç»Ÿã€‚åœ¨ Yocto å·¥ç¨‹ä¸­ï¼Œå·¥ä½œå¼€å§‹ä¹‹å‰ï¼Œéƒ½åº”è¯¥åˆå§‹åŒ–ç¼–è¯‘ç¯å¢ƒï¼Œè¯­æ³•æ˜¯ï¼šsource setup-environment \u0026lt;build dir\u0026gt; ã€‚\n5.1. OpenEmbedded #Yocto æ˜¯ä¸€ä¸ªå¼€æºåˆä½œé¡¹ç›®ï¼Œå®ƒå¸®åŠ©å¼€å‘äººå‘˜åˆ›å»ºåŸºäº Linux çš„å®šåˆ¶ç³»ç»Ÿï¼Œä½¿ç”¨ OpenEmbedded å¼€å‘æ¨¡å‹æ„å»ºã€‚\nå‡ ä¸ªæ¦‚å¿µï¼š\nLayers ï¼Œä¸­æ–‡å¯ä»¥å«åšå±‚ã€‚Layer è¢«ç”¨æ¥åˆ†ç±»ä¸åŒçš„ä»»åŠ¡å•å…ƒã€‚æŸäº›ä»»åŠ¡å•å…ƒæœ‰å…±åŒçš„ç‰¹æ€§ï¼Œå¯ä»¥æ”¾åœ¨ä¸€ä¸ª Layer ä¸‹ï¼Œæ–¹ä¾¿æ¨¡å—åŒ–ç»„ç»‡å…ƒæ•°æ®ï¼Œä¹Ÿæ–¹ä¾¿æ—¥åä¿®æ”¹ã€‚ä¾‹å¦‚è¦å®šåˆ¶ä¸€å¥—æ”¯æŒç‰¹å®šç¡¬ä»¶çš„ç³»ç»Ÿï¼Œå¯ä»¥æŠŠä¸ä½å±‚ç›¸å…³çš„å•å…ƒæ”¾åœ¨ä¸€ä¸ª layer ä¸­ï¼Œè¿™å«åš Board Support Package(BSP) Layer ã€‚ Configuration ï¼Œä¸­æ–‡å«åšé…ç½®ã€‚Configuration æ–‡ä»¶çš„åç¼€æ˜¯ .conf ï¼Œå®ƒä¼šåœ¨å¾ˆå¤šåœ°æ–¹å‡ºç°ï¼Œå®šä¹‰äº†å¤šç§å˜é‡ï¼ŒåŒ…æ‹¬ç¡¬ä»¶æ¶æ„é€‰é¡¹ã€ç¼–è¯‘å™¨é€‰é¡¹ã€é€šç”¨é…ç½®é€‰é¡¹ã€ç”¨æˆ·é…ç½®é€‰é¡¹ã€‚ä¸» Configuration æ–‡ä»¶æ˜¯ bitbake.conf ï¼Œä»¥ Yocto ä¸ºä¾‹ï¼Œä½äº ./poky/meta/conf/bitbake.conf ï¼Œå…¶ä»–éƒ½åœ¨æºç æ ‘çš„ conf ç›®å½•ä¸‹ã€‚ Classes ï¼Œä¸­æ–‡å«åšç±»ã€‚Class æ–‡ä»¶çš„åç¼€æ˜¯ .bbclass ï¼Œå®ƒçš„å†…å®¹æ˜¯å…ƒæ•°æ®æ–‡ä»¶ä¹‹é—´çš„å…±äº«ä¿¡æ¯ã€‚BitBake æºç æ ‘éƒ½æºè‡ªä¸€ä¸ªå«åš base.bbclass çš„æ–‡ä»¶ï¼Œåœ¨ Yocto ä¸­ä½äº ./poky/meta/classes/base.bbclass ï¼Œå®ƒä¼šè¢«æ‰€æœ‰çš„ recipe å’Œ class æ–‡ä»¶è‡ªåŠ¨åŒ…å«ã€‚å®ƒåŒ…å«äº†æ ‡å‡†ä»»åŠ¡çš„åŸºæœ¬å®šä¹‰ï¼Œä¾‹å¦‚è·å–ã€è§£å‹ã€é…ç½®ã€ç¼–è¯‘ã€å®‰è£…ã€æ‰“åŒ…ï¼Œæœ‰äº›å®šä¹‰åªæ˜¯æ¡†æ¶ï¼Œå†…å®¹æ˜¯ç©ºçš„ã€‚ Recipe ï¼Œä¸­æ–‡å«åšèœå•æˆ–è€…é…æ–¹ã€‚Recipe æ–‡ä»¶æ˜¯æœ€åŸºæœ¬çš„å…ƒæ•°æ®æ–‡ä»¶ï¼Œæ¯ä¸ªä»»åŠ¡å•å…ƒå¯¹åº”ä¸€ä¸ª Recipe æ–‡ä»¶ï¼Œåç¼€æ˜¯ .bb ï¼Œè¿™ç§æ–‡ä»¶ä¸º BitBake æä¾›çš„ä¿¡æ¯åŒ…æ‹¬è½¯ä»¶åŒ…çš„åŸºæœ¬ä¿¡æ¯ï¼ˆä½œè€…ã€ç‰ˆæœ¬ã€Licenseç­‰ï¼‰ã€ä¾èµ–å…³ç³»ã€æºç çš„ä½ç½®å’Œè·å–æ–¹æ³•ã€è¡¥ä¸ã€é…ç½®å’Œç¼–è¯‘æ–¹æ³•ã€å¦‚ä½•æ‰“åŒ…å’Œå®‰è£…ã€‚ Append ï¼Œä¸­æ–‡å«åšè¿½åŠ ã€‚Append æ–‡ä»¶çš„åç¼€æ˜¯ .bbappend ï¼Œç”¨äºæ‰©å±•æˆ–è€…è¦†ç›– recipe æ–‡ä»¶çš„ä¿¡æ¯ã€‚BitBake å¸Œæœ›æ¯ä¸€ä¸ª append æ–‡ä»¶éƒ½æœ‰ä¸€ä¸ªç›¸å¯¹åº”çš„ recipe æ–‡ä»¶ï¼Œä¸¤ä¸ªæ–‡ä»¶ä½¿ç”¨åŒæ ·çš„æ–‡ä»¶åï¼Œåªæ˜¯åç¼€ä¸åŒï¼Œä¾‹å¦‚ formfactor_0.0.bb å’Œ formfactor_0.0.bbappend ã€‚å‘½å append æ–‡ä»¶æ—¶ï¼Œå¯ä»¥ç”¨ç™¾åˆ†å·ï¼ˆ%ï¼‰æ¥é€šé… recipe æ–‡ä»¶åã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªåä¸º busybox_1.21.%.bbappend çš„ apend æ–‡ä»¶å¯ä»¥å¯¹åº”ä»»ä½•åä¸º busybox_1.21.x.bb çš„ recipe æ–‡ä»¶è¿›è¡Œæ‰©å±•å’Œè¦†ç›–ï¼Œæ–‡ä»¶åä¸­çš„ x å¯ä»¥ä¸ºä»»ä½•å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚ busybox_1.21.1.bbã€busybox_1.21.2.bb â€¦ é€šå¸¸ç”¨ç™¾åˆ†å·æ¥é€šé…ç‰ˆæœ¬å·ã€‚ OpenEmbedded çš„å·¥ä½œæµå¦‚ä¸‹ï¼š\nå‚è€ƒï¼šhttps://www.yoctoproject.org/docs/3.1.2/overview-manual/overview-manual.html\n5.2. ç›®å½•ç»“æ„ #é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ä¸€ä¸ªç¡¬ä»¶åŸå‚å‘å¸ƒçš„ BPS æºç ç¼–è¯‘ç³»ç»Ÿé•œåƒï¼ŒBSP æºç åŒ…å«äº† Yocto é¡¹ç›®çš„å‚è€ƒå‘è¡Œç‰ˆ poky åŒ…ï¼Œè¿˜æœ‰åŸå‚åŠ å…¥çš„æ‰©å±•åŒ…ï¼Œå½“å®Œæˆäº†ç¬¬ä¸€æ¬¡ç³»ç»Ÿæ„å»ºåï¼Œå·¥ç¨‹ç›®å½•ä¸‹çš„æ–‡ä»¶ç»“æ„å¤§è‡´å¦‚ä¸‹ï¼š\nimx-yocto-bsp-5.4.47 â”œâ”€â”€ downloads # bitbake ä¸‹è½½çš„è½¯ä»¶åŒ…éƒ½æ”¾åœ¨è¿™é‡Œ â”œâ”€â”€ imx6ullevk-fb # å·¥ä½œç›®å½•ï¼Œç¼–è¯‘è¿‡ç¨‹äº§ç”Ÿçš„æ‰€æœ‰æ–‡ä»¶éƒ½åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬è‡ªå·±æ·»åŠ çš„æºç ä¹Ÿåº”è¯¥æ”¾åœ¨è¿™é‡Œã€‚ â”œâ”€â”€ imx-setup-release.sh # é…ç½®è„šæœ¬ â”œâ”€â”€ README â”œâ”€â”€ README-IMXBSP â”œâ”€â”€ setup-environment # ç”¨äºåˆå§‹åŒ–ç¼–è¯‘ç¯å¢ƒçš„è„šæœ¬ â””â”€â”€ sources # åŸå‚å®˜æ–¹æä¾›çš„ BSP æºç ï¼Œé€šå¸¸ä¸è¦ç›´æ¥ä¿®æ”¹è¿™ä¸ªç›®å½•ä¸‹çš„æ–‡ä»¶ã€‚ â”œâ”€â”€ base # åŸå‚æ·»åŠ çš„åŒ… â”œâ”€â”€ meta-browser â”œâ”€â”€ meta-freescale â”œâ”€â”€ meta-freescale-3rdparty â”œâ”€â”€ meta-freescale-distro â”œâ”€â”€ meta-imx â”œâ”€â”€ meta-openembedded â”œâ”€â”€ meta-python2 â”œâ”€â”€ meta-qt5 â”œâ”€â”€ meta-rust â”œâ”€â”€ meta-timesys â””â”€â”€ poky # Yocto é¡¹ç›®çš„ä¸»ä»“åº“ ä¸‹è½½çš„è½¯ä»¶åŒ…éƒ½æ”¾åœ¨ downloads ç›®å½•ä¸‹ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªåç¼€ä¸º .done çš„ç©ºæ–‡ä»¶ï¼Œè¡¨ç¤ºæŒ‡å®šçš„åŒ…å·²ç»ä¸‹è½½å®Œæ¯•ã€‚å¦‚æœä½¿ç”¨ bitbake ä¸‹è½½æŸä¸ªåŒ…å¤±è´¥ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨ä¸‹è½½ï¼Œç„¶åæ”¾åˆ° downloads è·¯å¾„ä¸‹ï¼Œå¹¶æ–°å»ºä¸€ä¸ª .done æ–‡ä»¶ï¼Œè¿™æ · bitbake å·¥ä½œæ—¶å°±ä¼šä»»åŠ¡ fetch ä»»åŠ¡å·²ç»å®Œæˆã€‚\npoky æ˜¯ yocto é¡¹ç›®çš„å‚è€ƒå‘è¡Œç‰ˆï¼Œå®˜æ–¹æ–‡æ¡£éƒ½æ˜¯åŸºäºè¿™ä¸ªåŒ…è®²è§£çš„ï¼Œå•ç‹¬ä½¿ç”¨è¿™ä¸ªåŒ…å¯ä»¥æ„å»ºä¸€ä¸ªè¿è¡Œåœ¨ QEMU è™šæ‹Ÿæœºä¸Šçš„ç³»ç»Ÿã€‚å®ƒåŒ…å«äº†æ„å»ºç³»ç»Ÿæ‰€éœ€çš„æ ¸å¿ƒåŒ…ï¼Œæ¯”å¦‚ Linux å†…æ ¸çš„ recipe ã€‚\nmeta-openembedded æä¾›å¾ˆå¤šæ‰©å±•åŒ…ã€‚meta-imx å’Œ meta-freescale* éƒ½æ˜¯ NXP å®˜æ–¹æä¾›çš„ï¼Œé’ˆå¯¹ç¡¬ä»¶çš„æ‰©å±•ã€‚\næˆ‘ä»¬éœ€è¦åœ¨æ­¤åŸºç¡€ä¸Šæ·»åŠ æˆ–è€…ä¿®æ”¹ä¸€äº›åŒ…ï¼Œå®Œæˆè‡ªå·±çš„ç‰¹å®šéœ€æ±‚ã€‚è¿™æ—¶ï¼Œå»ºè®®åœ¨å·¥ä½œç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª layer ï¼Œåœ¨ layer ä¸­åŒ…å«è‡ªå·±çš„ append (.bbappend) æ–‡ä»¶å’Œ recipe(.bb)æ–‡ä»¶ï¼Œæ¥å®Œæˆç›¸åº”çš„å·¥ä½œï¼Œå°½é‡ä¸è¦ä¿®æ”¹ sources ç›®å½•ä¸‹çš„æ–‡ä»¶ã€‚\næºç ç›®å½•ç»“æ„çš„è¯¦ç»†ä¿¡æ¯å¯ä»¥æŸ¥çœ‹ https://www.yoctoproject.org/docs/3.0.4/ref-manual/ref-manual.html#ref-structure ã€‚\n5.3. Bitbake #Bitbake æ‰‹å†Œï¼šhttps://www.yoctoproject.org/docs/3.1.2/bitbake-user-manual/bitbake-user-manual.html\nOpenEmbedded æ„å»ºç³»ç»Ÿæ—¶ä½¿ç”¨çš„ç”Ÿäº§å·¥å…·æ˜¯ BitBake ï¼Œæ˜¯ç”¨ Python å†™çš„ä¸€ä¸ªç¨‹åºï¼Œç°åœ¨æœ‰å¾ˆå¤šåµŒå…¥å¼ç³»ç»Ÿéƒ½æ˜¯åœ¨ä½¿ç”¨ï¼Œæ¯”å¦‚Yocto ã€WindRiver Linux ç­‰ã€‚å®ƒæ˜¯ä¸€ä¸ªå¤šä»»åŠ¡å¼•æ“ï¼Œå¯ä»¥å¹¶è¡Œæ‰§è¡Œ shell å’Œ Python ä»»åŠ¡ï¼Œæ¯ä¸ªä»»åŠ¡å•å…ƒæ ¹æ®é¢„å®šä¹‰çš„å…ƒæ•°æ®æ¥ç®¡ç†æºç ã€é…ç½®ã€ç¼–è¯‘ã€æ‰“åŒ…ï¼Œå¹¶æœ€ç»ˆå°†æ¯ä¸ªä»»åŠ¡ç”Ÿæˆçš„æ–‡ä»¶é›†åˆæˆä¸ºç³»ç»Ÿé•œåƒã€‚ä¾‹å¦‚è¦ä»æºç æ„å»ºä¸€ä¸ª Linux ç³»ç»Ÿï¼Œéœ€è¦æ­å»ºä¸€ä¸ªç”Ÿäº§ç¯å¢ƒï¼Œç„¶åä¾æ¬¡ç”Ÿæˆ Grubã€Kernelã€å„ç§åº“æ–‡ä»¶ã€å„ç§å¯æ‰§è¡Œæ–‡ä»¶ï¼Œç„¶åé›†åˆåˆ°ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿé‡Œã€‚å¦‚æœä½ ç©è¿‡ LFS ï¼Œå°±ä¼šäº†è§£è¿™ä¸ªè¿‡ç¨‹çš„å¤æ‚æ€§ã€‚BitBake å­˜åœ¨çš„æ„ä¹‰å°±æ˜¯æä¾›äº†ä¸€ä¸ªé«˜æ•ˆçš„å·¥å…·ï¼Œå°†è¿™ä¸ªè¿‡ç¨‹æ ‡å‡†åŒ–ã€æµç¨‹åŒ–ã€‚BitBake ä¸ GNU Make çš„å…³ç³»å°±åƒ GNU Make ä¹‹äº GCC ï¼Œè¿ä½œæ–¹å¼ä¹Ÿç±»ä¼¼ GNU Make ï¼Œåˆæœ‰å¾ˆå¤šä¸åŒï¼š\nBitBake æ ¹æ®é¢„å…ˆå®šä¹‰çš„å…ƒæ•°æ®æ‰§è¡Œä»»åŠ¡ï¼Œè¿™äº›å…ƒæ•°æ®å®šä¹‰äº†æ‰§è¡Œä»»åŠ¡æ‰€éœ€çš„å˜é‡ï¼Œæ‰§è¡Œä»»åŠ¡çš„è¿‡ç¨‹ï¼Œä»¥åŠä»»åŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œå®ƒä»¬å­˜å‚¨åœ¨ recipe(.bb)ã€append(.bbappend)ã€configuration(.conf)ã€include(.inc) å’Œ class(.bbclass) æ–‡ä»¶ä¸­ã€‚ BitBake åŒ…å«ä¸€ä¸ªæŠ“å–å™¨ï¼Œç”¨äºä»ä¸åŒçš„ä½ç½®è·å–æºç ï¼Œä¾‹å¦‚æœ¬åœ°æ–‡ä»¶ã€æºç æ§åˆ¶å™¨(git)ã€ç½‘ç«™ç­‰ã€‚ æ¯ä¸€ä¸ªä»»åŠ¡å•å…ƒçš„ç»“æ„é€šè¿‡ recipe æ–‡ä»¶æè¿°ï¼Œæè¿°çš„ä¿¡æ¯æœ‰ä¾èµ–å…³ç³»ã€æºç ä½ç½®ã€ç‰ˆæœ¬ä¿¡æ¯ã€æ ¡éªŒå’Œã€è¯´æ˜ç­‰ç­‰ã€‚ BitBake åŒ…å«äº†ä¸€ä¸ª C/S çš„æŠ½è±¡æ¦‚å¿µï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œæˆ–è€… XML-RPC ä½¿ç”¨ï¼Œæ‹¥æœ‰å¤šç§ç”¨æˆ·æ¥å£ã€‚ æ‰§è¡Œ bitbake -s å‘½ä»¤å¯ä»¥åˆ—å‡ºå½“å‰é¡¹ç›®ä¸­æ‰€æœ‰å¯æ„å»ºçš„åŒ…å’Œç‰ˆæœ¬ã€‚æ„å»ºä¸€ä¸ªåŒ…çš„æœ€ç®€å•æ–¹æ³•æ˜¯æ‰§è¡Œ bitbake \u0026lt;package_name\u0026gt; ï¼ŒBitbake ä¼šæœç´¢è¿™ä¸ªåŒ…çš„ recipe æ–‡ä»¶ï¼Œæ‰¾åˆ°åå°±è§£æ recipe ä¸­çš„é…ç½®é€‰é¡¹ï¼Œç„¶åä¾æ¬¡æ‰§è¡Œå¦‚ä¸‹ä»»åŠ¡ï¼ˆtaskï¼‰ã€‚\nFetch\u0026ndash;ä»è¿œç¨‹æˆ–è€…æœ¬åœ°è·å–æºç  Extract\u0026ndash;å°†æºç è§£å‹åˆ°æŒ‡å®šçš„å·¥ä½œç›®å½•ä¸‹ï¼Œä¹‹åæ‰€æœ‰çš„æ„å»ºå·¥ä½œéƒ½åœ¨è¿™ä¸ªå·¥ä½œç›®å½•ä¸‹è¿›è¡Œ Patch\u0026ndash;ä¸ºé”™è¯¯ä¿®å¤å’Œæ–°åŠŸèƒ½åº”ç”¨è¡¥ä¸æ–‡ä»¶ Configure\u0026ndash;è¿›è¡Œç¼–è¯‘å‰çš„é…ç½®å·¥ä½œ Compile\u0026ndash;ç¼–è¯‘å’Œé“¾æ¥ Install\u0026ndash;å°†æ–‡ä»¶å¤åˆ¶åˆ°ç›®æ ‡ç›®å½•ä¸‹ Package\u0026ndash;ç”Ÿæˆå®‰è£…åŒ… ä¹Ÿå¯ä»¥é€šè¿‡ -c å‚æ•°æ‰§è¡Œå•ç‹¬çš„ä»»åŠ¡ï¼Œä¾‹å¦‚åªä¸‹è½½æºç å¯ä»¥æ‰§è¡Œ bitbake \u0026lt;package_name\u0026gt; -c fetch ã€‚æ‰€æœ‰ä»»åŠ¡å¯ä»¥åœ¨ https://www.yoctoproject.org/docs/3.0.4/ref-manual/ref-manual.html#ref-tasks æŸ¥è¯¢ã€‚å¸¸ç”¨çš„ä»»åŠ¡é€‰é¡¹æœ‰ï¼š\nfetch ï¼Œä¸‹è½½æºç  unpack ï¼Œè§£å‹æºç  patch ï¼Œ æ‰“è¡¥ä¸ configure ï¼Œé…ç½® compile ï¼Œç¼–è¯‘ clean ï¼Œåˆ é™¤æœ€ç»ˆè¾“å‡ºçš„æ–‡ä»¶ clearsstate ï¼Œåˆ é™¤ç¼–è¯‘è¿‡ç¨‹äº§ç”Ÿçš„æ‰€æœ‰æ–‡ä»¶ cleanall ï¼Œåˆ é™¤æ‰€æœ‰æ–‡ä»¶ï¼ŒåŒ…æ‹¬ä¸‹è½½çš„æºç åŒ…ï¼Œç¼–è¯‘è¿‡ç¨‹çš„ç¼“å­˜æ–‡ä»¶å’Œæœ€ç»ˆçš„è¾“å‡ºæ–‡ä»¶ã€‚ æ­¤å¤–ï¼Œæ‰§è¡Œ listtasks é€‰é¡¹å¯ä»¥æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„ä»»åŠ¡ï¼Œä¾‹å¦‚æŸ¥çœ‹ linux-imx çš„ä»»åŠ¡åˆ—è¡¨å’Œæè¿°ï¼š\nbitbake linux-imx -c listtasks æ‰§è¡Œ bitbake -e \u0026lt;package\u0026gt; å¯ä»¥è§£æç‰¹å®šåŒ…çš„é…ç½®é€‰é¡¹ã€‚ä¾‹å¦‚æŸ¥æ‰¾ Linux å†…æ ¸çš„åŒ…åç§°å’Œç‰ˆæœ¬å¯ä»¥æ‰§è¡Œï¼š\n~/imx-yocto-bsp-5.4.47/imx6ullevk-fb$ bitbake -s | grep linux binutils-crosssdk-x86_64-pokysdk-linux :2.32.0-r0 cryptodev-linux :1.10-r0 cryptodev-linux-native :1.10-r0 gcc-crosssdk-x86_64-pokysdk-linux :9.2.0-r0 go-crosssdk-x86_64-pokysdk-linux :1.12.9-r0 linux-atm :2.5.2-r0 linux-firmware 1:20190815-r0 linux-imx :5.4-r0 linux-imx-headers :5.4-r0 linux-imx-mfgtool :4.14.98-r0 å¾ˆæ˜æ˜¾ï¼Œlinux-imx å°±æ˜¯å½“å‰é¡¹ç›®çš„ Linux å†…æ ¸ï¼Œç„¶åå…ˆå®šä½ recipe æ–‡ä»¶çš„ä½ç½®ï¼š\n~/imx-yocto-bsp-5.4.47/imx6ullevk-fb$ bitbake -e linux-imx | grep ^FILE= FILE=\u0026#34;/home/sbs/imx-yocto-bsp-5.4.47/sources/meta-imx/meta-bsp/recipes-kernel/linux/linux-imx_5.4.bb\u0026#34; æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬è¿˜éœ€è¦çŸ¥é“è¿™ä¸ª recipe ä¾èµ–çš„ confã€bbclass ã€bbappend ç­‰æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ BBINCLUDED å˜é‡è·å¾—ï¼š\n~/imx-yocto-bsp-5.4.47/imx6ullevk-fb$ bitbake -e linux-imx | grep ^BBINCLOUD= ç„¶åæˆ‘ä»¬å¯ä»¥å®šä½æ„å»ºè¿™ä¸ªåŒ…æ—¶çš„å·¥ä½œç›®å½•ï¼š\n~/imx-yocto-bsp-5.4.47/imx6ullevk-fb$ bitbake -e linux-imx | grep ^WORKDIR= WORKDIR=\u0026#34;/home/sbs/imx-yocto-bsp-5.4.47/imx6ullevk-fb/tmp/work/imx6ull14x14evk-poky-linux-gnueabi/linux-imx/5.4-r0\u0026#34; å®šä¹‰æºç è§£å‹åçš„ä½ç½®ï¼š\n~/imx-yocto-bsp-5.4.47/imx6ullevk-fb$ bitbake -e linux-imx | grep ^S= S=\u0026#34;/home/sbs/imx-yocto-bsp-5.4.47/imx6ullevk-fb/tmp/work/imx6ull14x14evk-poky-linux-gnueabi/linux-imx/5.4-r0/git\u0026#34; å®šä½æºç çš„ç¼–è¯‘ç›®å½•ï¼š\n~/imx-yocto-bsp-5.4.47/imx6ullevk-fb$ bitbake -e linux-imx | grep ^B= B=\u0026#34;/home/sbs/imx-yocto-bsp-5.4.47/imx6ullevk-fb/tmp/work/imx6ull14x14evk-poky-linux-gnueabi/linux-imx/5.4-r0/build\u0026#34; å·¥ä½œç›®å½•ä¸‹è¿˜æœ‰å‡ ä¸ªé‡è¦çš„æ–‡ä»¶å¤¹ï¼š\nimage ï¼Œå­˜æ”¾è¿™è¦å®‰è£…åˆ°ç›®æ ‡ç³»ç»Ÿçš„æ–‡ä»¶ï¼Œè€Œä¸”æ˜¯æŒ‰ç…§å®‰è£…è·¯å¾„å­˜æ”¾ã€‚ deploy ï¼Œå­˜æ”¾ rpm ï¼Œdeb ç­‰æ ¼å¼çš„å®‰è£…åŒ… tmp ï¼Œå­˜æ”¾äº†æ„å»ºè¿‡ç¨‹ä¸­æ‰§è¡Œçš„æ‰€æœ‰ä»»åŠ¡æŒ‡ä»¤ï¼Œå·²ç»æ‰§è¡Œè¿‡ç¨‹çš„æ—¥å¿—ã€‚ BitBake æ‰§è¡Œä»»åŠ¡çš„é¡ºåºç”±å…¶ä»»åŠ¡è°ƒåº¦å™¨æ§åˆ¶ã€‚${WORKDIR}/tmp/ ç›®å½•ä¸‹ï¼Œä»¥ run_ å¼€å¤´çš„æ–‡ä»¶è®°å½•äº†æ¯ä¸ªä»»åŠ¡è§£æåçš„è¯¦ç»†å†…å®¹ï¼Œä»¥ log_ å¼€å¤´çš„æ–‡ä»¶è®°å½•ä»»åŠ¡æ‰§è¡Œæ—¶çš„æ—¥å¿—ï¼Œlog.task_order æ–‡ä»¶æŒ‰é¡ºåºè®°å½•äº†å½“å‰ç›®æ ‡æ‰§è¡Œäº†å“ªäº›ä»»åŠ¡ã€‚\nå…³äº recipe æ–‡ä»¶ä¸­å…¶ä»–é€‰é¡¹çš„å«ä¹‰å¯ä»¥æŸ¥çœ‹ https://www.yoctoproject.org/docs/3.0.4/ref-manual/ref-manual.html#ref-varlocality-recipes ã€‚\n5.4. æ–°å»º Layer #æ–°å»º layer çš„è¿‡ç¨‹å¯ä»¥æ‰‹åŠ¨å®Œæˆï¼Œä½†æ˜¯æ¨èä½¿ç”¨ bitbake-layers è„šæœ¬çš„create-layerå­å‘½ä»¤æ¥ç®€åŒ–åˆ›å»ºè¿‡ç¨‹ã€‚åŸºæœ¬çš„è¯­æ³•æ˜¯ bitbake-layers create-layer \u0026lt;your_layer_name\u0026gt; ï¼Œè¿™æ¡å‘½ä»¤ä¼šæŒ‰é»˜è®¤çš„æ¨¡å¼æ–°å»ºå¦‚ä¸‹æ–‡ä»¶ï¼š\nä¸€ä¸ªåä¸º your_layer_name çš„æ–‡ä»¶å¤¹ï¼Œæ³¨æ„ï¼Œlayer çš„åç§°åº”è¯¥ä»¥ meta- ä¸ºå‰ç¼€ï¼Œä¸”ä¸è¦ä¸å·²æœ‰çš„ layer é‡åã€‚\nä¸€ä¸ªé…ç½®æ–‡ä»¶ conf/layer.conf ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\n# We have a conf and classes directory, add to BBPATH BBPATH .= \u0026#34;:${LAYERDIR}\u0026#34; # We have recipes-* directories, add to BBFILES BBFILES += \u0026#34;${LAYERDIR}/recipes-*/*/*.bb \\ ${LAYERDIR}/recipes-*/*/*.bbappend\u0026#34; BBFILE_COLLECTIONS += \u0026#34;mylayer\u0026#34; BBFILE_PATTERN_mylayer = \u0026#34;^${LAYERDIR}/\u0026#34; BBFILE_PRIORITY_mylayer = \u0026#34;6\u0026#34; LAYERDEPENDS_mylayer = \u0026#34;core\u0026#34; LAYERSERIES_COMPAT_mylayer = \u0026#34;warrior zeus\u0026#34; BBPATHï¼šå°† layer çš„æ ¹ç›®å½•æ·»åŠ åˆ° BitBake çš„æœç´¢è·¯å¾„ä¸­ã€‚é€šè¿‡ä½¿ç”¨ BBPATH å˜é‡ï¼ŒBitBakeå¯ä»¥å®šä½ç±»æ–‡ä»¶ï¼ˆ.bbclassï¼‰ã€é…ç½®æ–‡ä»¶ä»¥åŠåŒ…å«åœ¨ include å’Œ require è¯­å¥ä¸­çš„æ–‡ä»¶ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼ŒBitBake ä¼šä½¿ç”¨ç¬¬ä¸€ä¸ªä¸ BBPATH ä¸­æ‰¾åˆ°çš„æ–‡ä»¶åç›¸åŒ¹é…çš„æ–‡ä»¶ã€‚è¿™ä¸ PATH å˜é‡ç”¨äºäºŒè¿›åˆ¶æ–‡ä»¶çš„æ–¹å¼ç±»ä¼¼ã€‚å› æ­¤ï¼Œå»ºè®®ä½ åœ¨è‡ªå®šä¹‰å±‚ä¸­ä½¿ç”¨å”¯ä¸€çš„ç±»å’Œé…ç½®æ–‡ä»¶åã€‚ BBFILES: å®šä¹‰ layer ä¸­æ‰€æœ‰ recipes çš„ä½ç½®ã€‚ BBFILE_COLLECTIONSï¼šå®šä¹‰äº†å½“å‰å±‚ä¸­æ‰€æœ‰é…æ–¹çš„ä½ç½®ã€‚é€šè¿‡ç‹¬ç‰¹çš„æ ‡è¯†ç¬¦å»ºç«‹å½“å‰å±‚ï¼Œè¯¥æ ‡è¯†ç¬¦åœ¨æ•´ä¸ªOpenEmbeddedæ„å»ºç³»ç»Ÿä¸­ç”¨äºå¼•ç”¨è¯¥å±‚ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæ ‡è¯†ç¬¦ \u0026ldquo;yoctobsp\u0026rdquo; æ˜¯åä¸º \u0026ldquo;meta-yocto-bsp\u0026rdquo; çš„å®¹å™¨å±‚çš„è¡¨ç¤ºã€‚ BBFILE_PATTERN: åœ¨è§£æè¿‡ç¨‹ä¸­ç«‹å³å±•å¼€ï¼Œæä¾›å±‚çš„ç›®å½•ã€‚ BBFILE_PRIORITY: å»ºç«‹äº†ä¸€ä¸ªä¼˜å…ˆçº§ï¼Œå½“ OpenEmbedded æ„å»ºå‘ç°ä¸åŒå±‚ä¸­çš„åŒåé…æ–¹æ—¶ï¼Œè¯¥å±‚ä¸­çš„é…æ–¹å°†è¢«ä½¿ç”¨ã€‚ LAYERVERSIONï¼šä¸ºå›¾å±‚å»ºç«‹ä¸€ä¸ªç‰ˆæœ¬å·ï¼Œä½ å¯ä»¥åœ¨ä½¿ç”¨ LAYERDEPENDS å˜é‡æ—¶ä½¿ç”¨è¿™ä¸ªç‰ˆæœ¬å·æ¥æŒ‡å®šè¿™ä¸ªå›¾å±‚çš„ç¡®åˆ‡ç‰ˆæœ¬ä½œä¸ºä¾èµ–å…³ç³»ã€‚å½“ä½¿ç”¨ LAYERDEPENDS å˜é‡æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨è¿™ä¸ªç‰ˆæœ¬å·æ¥æŒ‡å®šè¿™ä¸ªå±‚çš„ç¡®åˆ‡ç‰ˆæœ¬ä½œä¸ºä¾èµ–å…³ç³»ã€‚ LAYERDEPENDS: åˆ—å‡ºè¿™ä¸ªå›¾å±‚æ‰€ä¾èµ–çš„æ‰€æœ‰å›¾å±‚ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚ LAYERSERIES_COMPAT: åˆ—å‡ºå½“å‰ç‰ˆæœ¬å…¼å®¹çš„ Yocto é¡¹ç›®ç‰ˆæœ¬ã€‚è¿™ä¸ªå˜é‡æ˜¯è¡¨æ˜ä½ çš„å›¾å±‚æ˜¯å¦æ˜¯å½“å‰ç‰ˆæœ¬çš„å¥½æ–¹æ³•ã€‚ ä¸€ä¸ª recipes-example å­ç›®å½•ï¼Œå…¶ä¸­åŒ…å«äº†å¦ä¸€ä¸ªåä¸º example çš„å­ç›®å½•ï¼Œå…¶ä¸­åŒ…å«äº†ä¸€ä¸ª example.bb é…æ–¹æ–‡ä»¶\nä¸€ä¸ª COPYING.MIT ï¼Œè¿™æ˜¯è¯¥å±‚çš„è®¸å¯è¯å£°æ˜ã€‚è„šæœ¬å‡è®¾ä½ æƒ³å¯¹å›¾å±‚æœ¬èº«çš„å†…å®¹ä½¿ç”¨ MIT è®¸å¯è¯ï¼Œè¿™å¯¹å¤§å¤šæ•°å›¾å±‚æ¥è¯´æ˜¯å…¸å‹çš„ã€‚\nä¸€ä¸ª README æ–‡ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ªæè¿°æ–°å›¾å±‚å†…å®¹çš„æ–‡ä»¶ã€‚\næˆ‘ä»¬æ–°å»ºä¸€ä¸ªåä¸º meta-mylayer çš„å±‚ï¼š\n$ bitbake-layers create-layer meta-mylayer æ–°å»ºå®Œæ¯•åï¼Œéœ€è¦æ ¹æ® layer çš„ç±»å‹ï¼Œæ·»åŠ å†…å®¹ã€‚å¦‚æœè¯¥å±‚æ·»åŠ äº†å¯¹æœºå™¨çš„æ”¯æŒï¼Œåˆ™åœ¨è¯¥å±‚çš„conf/machine/æ–‡ä»¶ä¸­æ·»åŠ æœºå™¨é…ç½®ã€‚å¦‚æœè¯¥å±‚å¢åŠ äº†å‘è¡Œç‰ˆç­–ç•¥ï¼Œå°±æŠŠå‘è¡Œç‰ˆé…ç½®æ·»åŠ åˆ°è¯¥å±‚å†…çš„conf/distro/ æ–‡ä»¶ä¸­ã€‚å¦‚æœå›¾å±‚å¼•å…¥äº†æ–°çš„é…æ–¹ï¼ŒæŠŠä½ éœ€è¦çš„é…æ–¹æ”¾åœ¨å›¾å±‚å†…çš„ recipes-* å­ç›®å½•ä¸­ã€‚\nè¦æƒ³ bitbake ç¼–è¯‘æ—¶æ‰¾åˆ°è¿™ä¸ªæ–°å»ºçš„ layer ï¼Œè¿˜éœ€è¦æŠŠå®ƒæ·»åŠ åˆ° conf/bblayers.conf æ–‡ä»¶çš„ BBLAYERS å˜é‡ä¸­ï¼Œä¾‹å¦‚ï¼š\nBBLAYERS += \u0026#34;${BSPDIR}/imx6ullevk-fb/meta-mylayer\u0026#34; è¿™ä¸€æ­¥ä¹Ÿå¯ä»¥ä½¿ç”¨è„šæœ¬å®Œæˆï¼š\n$ bitbake-layers add-layer meta-mylayer BitBakeæŒ‰ç…§ BBLAYERS å˜é‡çš„è®¾ç½®ï¼Œè‡ªä¸Šè€Œä¸‹åœ°è§£ææ¯ä¸ª conf/layer.conf æ–‡ä»¶ã€‚åœ¨å¤„ç†æ¯ä¸ª conf/layer.conf æ–‡ä»¶çš„è¿‡ç¨‹ä¸­ï¼ŒBitBakeä¼šå°†ç‰¹å®šå±‚ä¸­åŒ…å«çš„é…æ–¹ã€ç±»å’Œé…ç½®æ·»åŠ åˆ°æºç›®å½•ä¸­ã€‚\næœ‰äº›å·¥ä½œå¯èƒ½å·²ç»æœ‰å‰äººåšè¿‡äº†ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ OpenEmbedded Metadata Index ä¸‹æŸ¥æ‰¾ç‰¹å®šåŠŸèƒ½ layer ï¼Œæ‹¿æ¥ç›´æ¥ç”¨ã€‚\n5.5. è‡ªå®šä¹‰ç³»ç»Ÿé•œåƒ #è‡ªå®šä¹‰ç³»ç»Ÿé•œåƒä¸»è¦æ˜¯ä¿®æ”¹æ„å»ºç³»ç»Ÿçš„æºç ï¼Œå®šåˆ¶è¾“å‡ºåˆ°ç›®æ ‡é•œåƒçš„æ–‡ä»¶ï¼Œæœ‰å¾ˆå¤šç§æ–¹å¼ï¼Œæ¯”å¦‚ä¿®æ”¹ con/local.conf æ–‡ä»¶ï¼Œè¿™é‡Œçš„ä¿®æ”¹æ˜¯å…¨å±€æ€§çš„ï¼Œä¼šæ‰€æœ‰çš„é•œåƒç”Ÿæ•ˆï¼Œä¸åˆ©äºé¡¹ç›®çš„å·¥ç¨‹åŒ–ç®¡ç†ï¼Œæœ€å¥½çš„æ–¹å¼ä¾ç„¶æ˜¯åœ¨è‡ªå®šä¹‰çš„ layer ä¸­æ·»åŠ å¯¹æºç çš„ä¿®æ”¹ã€‚ä¾‹å¦‚ï¼Œè¦å®šåˆ¶ fsl-image-machine-test ç”Ÿæˆçš„é•œåƒï¼Œå°±å¯ä»¥æ–°å»ºä¸€ä¸ª image-machine-test.bbappend æ–‡ä»¶è¿›è¡Œä¿®æ”¹ã€‚\n5.5.1. æ·»åŠ æˆ–åˆ é™¤åŒ… #å®šåˆ¶ç³»ç»Ÿæ—¶,ç»å¸¸è¦æ·»åŠ ä¸€ä¸ªåŒ…åˆ°ç›®æ ‡é•œåƒä¸­ï¼Œæˆ–è€…ä»ç›®æ ‡é•œåƒé‡Œåˆ é™¤ä¸€ä¸ªå·²æœ‰çš„åŒ…ã€‚Yocto æ„å»ºç³»ç»Ÿé•œåƒæ—¶ï¼Œä¸»è¦æ˜¯é€šè¿‡ IMAGE_INSTALL å’Œ IMAGE_IMAGE_FEATURES ä¸¤ä¸ªå˜é‡æ¥ç¡®å®šç›®æ ‡é•œåƒè¦å®‰è£…é‚£äº›åŒ…ï¼Œä»¥æ„å»º fsl-image-machine-test ç³»ç»Ÿé•œåƒä¸ºä¾‹ï¼š\n$ bitbake -e fsl-image-machine-test | grep ^IMAGE_INSTALL= IMAGE_INSTALL=\u0026#34; packagegroup-core-boot packagegroup-base-extended packagegroup-fsl-gstreamer1.0 packagegroup-fsl-gstreamer1.0-full packagegroup-fsl-tools-gpu packagegroup-fsl-tools-gpu-external packagegroup-fsl-tools-testapps packagegroup-fsl-tools-benchmark packagegroup-fsl-optee-imx\u0026#34; $ bitbake -e fsl-image-machine-test | grep ^IMAGE_FEATURES IMAGE_FEATURES=\u0026#34;debug-tweaks package-management tools-profile tools-testapps\u0026#34; IMAGE_FEATURES_REPLACES_ssh-server-openssh=\u0026#34;ssh-server-dropbear\u0026#34; IMAGE_INSTALL è®¾ç½®äº†å®‰è£…åˆ°ç›®æ ‡é•œåƒçš„åŒ…å’ŒåŒ…ç»„ï¼ŒåŒ…ç»„å°±æ˜¯ä¸€äº›ç›¸å…³çš„åŒ…çš„é›†åˆï¼Œå®ƒä»¬éƒ½æ˜¯é€šè¿‡ .bb æ–‡ä»¶å®šä¹‰çš„ã€‚å¦‚æœè¦å‘ç›®æ ‡é•œåƒæ·»åŠ åŒ…ï¼Œå¯ä»¥ç”¨ _append è¯­æ³•ï¼ˆå‚è€ƒ Bitbake user manualï¼‰å‘ IMAGE_INSTALL å˜é‡ä¸­è¿½åŠ å†…å®¹ï¼Œä¾‹å¦‚ï¼š\nIMAGE_INSTALL_append = \u0026#34; vim\u0026#34; ä¹Ÿå¯ä»¥ç”¨ _remove è¯­æ³•ä» IMAGE_INSTALL å˜é‡ä¸­åˆ é™¤å·²æœ‰çš„å†…å®¹ï¼Œä¾‹å¦‚ï¼š\nIMAGE_INSTALL_remove = \u0026#34;packagegroup-fsl-tools-testapps\u0026#34; IMAGE_FEATURES è®¾ç½®äº†ç›®æ ‡é•œåƒçš„ç‰¹æ€§ï¼Œä¸æ­¢æ˜¯åŒ…å’ŒåŒ…ç»„ï¼Œè¿™äº›ç‰¹æ€§æ¥è‡ªäº IMAGE_FEATURES çš„å®šä¹‰ï¼Œå‡è®¾ :\nFEATURE_PACKAGES_widget = \u0026#34;package1 package2\u0026#34; é‚£ä¹ˆï¼Œå¦‚æœ IMAGE_FEATURES ä¸­åŒ…å«äº† widget ï¼Œå°±åŒ…å«äº† package1 å’Œ package2 ã€‚ä¾‹å¦‚ï¼š\n$ bitbake -e fsl-image-machine-test | grep ^FEATURE_PACKAGES FEATURE_PACKAGES_eclipse-debug=\u0026#34;packagegroup-core-eclipse-debug\u0026#34; FEATURE_PACKAGES_hwcodecs=\u0026#34;\u0026#34; FEATURE_PACKAGES_nfs-client=\u0026#34;packagegroup-core-nfs-client\u0026#34; FEATURE_PACKAGES_nfs-server=\u0026#34;packagegroup-core-nfs-server\u0026#34; FEATURE_PACKAGES_package-management=\u0026#34;dpkg apt\u0026#34; FEATURE_PACKAGES_splash=\u0026#34;psplash\u0026#34; FEATURE_PACKAGES_ssh-server-dropbear=\u0026#34;packagegroup-core-ssh-dropbear\u0026#34; FEATURE_PACKAGES_ssh-server-openssh=\u0026#34;packagegroup-core-ssh-openssh\u0026#34; FEATURE_PACKAGES_tools-debug=\u0026#34;packagegroup-core-tools-debug\u0026#34; FEATURE_PACKAGES_tools-profile=\u0026#34;packagegroup-core-tools-profile\u0026#34; FEATURE_PACKAGES_tools-sdk=\u0026#34;packagegroup-core-sdk packagegroup-core-standalone-sdk-target\u0026#34; FEATURE_PACKAGES_tools-testapps=\u0026#34;packagegroup-core-tools-testapps\u0026#34; FEATURE_PACKAGES_x11=\u0026#34;packagegroup-core-x11\u0026#34; FEATURE_PACKAGES_x11-base=\u0026#34;packagegroup-core-x11-base\u0026#34; FEATURE_PACKAGES_x11-sato=\u0026#34;packagegroup-core-x11-sato\u0026#34; IMAGE_FEATURES ä¸­å®šä¹‰çš„ tools-testapps å°±è¡¨ç¤º packagegroup-core-tools-testapps ï¼Œå¯ä»¥åœ¨æºç ç›®å½•ä¸­ç›´æ¥æœç´¢è¿™ä¸ªåŒ…ç»„çš„ .bb æ–‡ä»¶ï¼š\n$ find ./ -name \u0026#34;packagegroup-core-tools-testapps*\u0026#34; ./poky/meta/recipes-core/packagegroups/packagegroup-core-tools-testapps.bb ./meta-imx/meta-sdk/recipes-fsl/packagegroup/packagegroup-core-tools-testapps.bbappend æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨ _append å’Œ _remove è¯­æ³•ä¿®æ”¹ IMAGE_FEATURES å˜é‡çš„å†…å®¹ï¼ŒYocto æä¾›çš„å¯é€‰é¡¹å¯ä»¥å‚è€ƒ Feature Image ã€‚\nå¦‚æœæˆ‘ä»¬æƒ³åˆ é™¤çš„åŒ…æ²¡æœ‰æ˜¾ç¤ºåœ¨ IMAGE_INSTALL å’Œ IMAGE_IMAGE_FEATURES çš„å®šä¹‰é‡Œï¼Œé€šå¸¸æ˜¯è¢«å°è£…åˆ°äº†åŒ…ç»„é‡Œé¢ï¼Œè¿™æ—¶ï¼Œå¯ä»¥ç”¨ PACKAGE_EXCLUDE å˜é‡è®¾ç½®ï¼š\nPACKAGE_EXCLUDE = \u0026#34;package_name package_name package_name ...\u0026#34; è¿™äº›åˆ—å‡ºçš„åŒ…éƒ½ä¸ä¼šè¢«å®‰è£…åˆ°ç›®æ ‡é•œåƒä¸­ã€‚è¿™é‡Œå¯èƒ½ä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœå…¶ä»–ä¸€äº›åŒ…ä¾èµ–äºè¿™é‡Œåˆ—å‡ºçš„åŒ…ï¼ˆå³åœ¨ RDEPENDS å˜é‡ä¸­åˆ—å‡ºï¼‰ï¼Œæ„å»ºæ—¶ä¼šæŠ¥é”™ï¼Œå¿…é¡»æ¥è§¦ç›¸åº”çš„ä¾èµ–å…³ç³»ã€‚ä»¥åˆ é™¤ connman ä¸ºä¾‹ï¼š\nPACKAGE_EXCLUDE = \u0026#34;connman\u0026#34; æ„å»ºæ—¶ä¼šå‡ºç°å¦‚ä¸‹é”™è¯¯ï¼š\n$ bitbake fsl-image-machine-test ... Some packages could not be installed. This may mean that you have requested an impossible situation or if you are using the unstable distribution that some required packages have not yet been created or been moved out of Incoming. The following information may help to resolve the situation: The following packages have unmet dependencies: packagegroup-core-tools-testapps : Depends: connman-client but it is not going to be installed Depends: connman-tools but it is not going to be installed E: Unable to correct problems, you have held broken packages. ... packagegroup-core-tools-testapps åŒ…ç»„é‡Œçš„ connman-client å’Œ connman-tools éƒ½ä¾èµ–äº connman ï¼Œåœ¨ packagegroup-core-tools-testapps.bb æ–‡ä»¶ä¸­å¯ä»¥çœ‹åˆ°ï¼š\nRDEPENDS_${PN} = \u0026#34;\\ blktool \\ ${KEXECTOOLS} \\ alsa-utils-amixer \\ alsa-utils-aplay \\ ltp \\ connman-tools \\ connman-tests \\ connman-client \\ ${@bb.utils.contains(\u0026#39;DISTRO_FEATURES\u0026#39;, \u0026#39;x11\u0026#39;, \u0026#34;${X11TOOLS}\u0026#34;, \u0026#34;\u0026#34;, d)} \\ ${@bb.utils.contains(\u0026#39;DISTRO_FEATURES\u0026#39;, \u0026#39;x11 opengl\u0026#39;, \u0026#34;${X11GLTOOLS}\u0026#34;, \u0026#34;\u0026#34;, d)} \\ ${@bb.utils.contains(\u0026#39;DISTRO_FEATURES\u0026#39;, \u0026#39;3g\u0026#39;, \u0026#34;${3GTOOLS}\u0026#34;, \u0026#34;\u0026#34;, d)} \\ \u0026#34; å¯ä»¥æ–°å»ºä¸€ä¸ª packagegroup-core-tools-testapps.bbappend æ–‡ä»¶ï¼Œä½¿ç”¨ _remove è¯­æ³•å°†å…¶åˆ é™¤ï¼š\nRDEPENDS_${PN}_remove = \u0026#34;connman-tools connman-tests connman-client\u0026#34; ä¿®æ”¹å®Œæ¯•åï¼Œå¯ä»¥ä½¿ç”¨ bitbake çš„ -g é€‰é¡¹ç”Ÿæˆç›®æ ‡çš„ä¾èµ–å…³ç³»ï¼š\nbitbake -g fsl-image-machine-test å®ƒä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶ï¼Œpn-buildlist åˆ—å‡ºäº†ç”Ÿæˆç›®æ ‡æ‰€ä¾èµ–çš„æ‰€æœ‰åŒ…ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œå¿«é€Ÿçš„æ£€æŸ¥åˆ å‡å’Œå¢åŠ çš„æ“ä½œæ˜¯å¦æˆåŠŸï¼Œtask-depends.dot è®°å½•äº†æ‰€æœ‰ä»»åŠ¡çš„ä¾èµ–å…³ç³»ï¼Œå¯ä»¥ç”¨ Graphviz æ‰“å¼€ï¼Œè¿›è¡Œå›¾å½¢åŒ–çš„é˜…è§ˆã€‚\n5.5.2. è‡ªå®šä¹‰ recipe #æˆ‘ä»¬ä¹Ÿå¯ä»¥æ–°å»ºä¸€ä¸ªç³»ç»Ÿé•œåƒçš„ recipe ï¼Œæ·»åŠ è‡ªå·±éœ€è¦çš„ç‰¹æ€§ã€‚ä¾‹å¦‚ï¼Œåœ¨ meta-freescale-distro/recipes-fsl/images ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª fsl-image-custom.bb æ–‡ä»¶ï¼Œç„¶åæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š\nLICENSE = \u0026#34;MIT\u0026#34; # å£°æ˜è®¸å¯è¯ inherit core-image # ç»§æ‰¿ core-image ç±» IMAGE_INSTALL_append = \u0026#34; package-name\u0026#34; # æ·»åŠ çš„åŒ… 5.5.3. è‡ªå®šä¹‰åŒ…ç»„ #åŒ…ç»„ï¼ˆpackagegroupï¼‰å°±æ˜¯æŒ‰ç‰¹å®šéœ€æ±‚æŠŠå‡ ä¸ªåŒ…ç»„åˆæˆä¸€ä¸ªå˜é‡ï¼Œä»¥ packagegroup- ä¸ºå‰ç¼€ï¼Œåœ¨ç±»ä¼¼ meta*/recipes*/packagegroups/packagegroup*.bbçš„æ–‡ä»¶ä¸­å®šä¹‰ã€‚ä»¥ poky/meta/recipes-core/packagegroups/packagegroup-base.bb æ–‡ä»¶ä¸ºä¾‹ï¼Œæ–‡ä»¶å†…é€šè¿‡ PACKAGES å˜é‡åˆ—å‡ºäº†è¦äº§ç”Ÿçš„åŒ…ç»„ï¼Œç„¶åå†ç”¨ RDEPENDS å’Œ RRECOMMENDS é¡¹è®¾ç½®æ¯ä¸ªåŒ…ç»„æ‰€åŒ…å«çš„è½¯ä»¶åŒ…ã€‚\nä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰ä¸€ä¸ªåä¸º packagegroup-custom.bb çš„ recipe æ–‡ä»¶ï¼š\nDESCRIPTION = \u0026#34;My Custom Package Groups\u0026#34; inherit packagegroup PACKAGES = \u0026#34;\\ ${PN}-apps \\ ${PN}-tools \\ \u0026#34; RDEPENDS_${PN}-apps = \u0026#34;\\ dropbear \\ portmap \\ psplash\u0026#34; RDEPENDS_${PN}-tools = \u0026#34;\\ oprofile \\ oprofileui-server \\ lttng-tools\u0026#34; RRECOMMENDS_${PN}-tools = \u0026#34;\\ kernel-module-oprofile\u0026#34; ${PN} æ˜¯æ›¿ä»£æ–‡ä»¶åï¼ˆpackagegroup-customï¼‰çš„å˜é‡ï¼Œæ‰€ä»¥ï¼Œè¿™é‡Œæ˜¯å®šä¹‰äº†ä¸¤ä¸ªåŒ…ç»„ï¼špackagegroup-custom-apps å’Œ packagegroup-custom-tools ï¼Œç„¶åç”¨ RDEPENDS_${PN}-* è®¾ç½®äº†æ¯ä¸ªåŒ…ç»„ä¾èµ–çš„è½¯ä»¶åŒ…ã€‚å¦‚æœåªæƒ³å®šä¹‰ä¸€èˆ¬åŒ…ç»„ï¼Œå¯ä»¥ä¸ç”¨ PACKAGES å˜é‡ï¼Œâ€‹${PN} å³æ˜¯åŒ…ç»„çš„åç§°ï¼Œç”¨ RDEPENDS_${PN} è®¾ç½®åŒ…ç»„ä¾èµ–çš„è½¯ä»¶åŒ…ã€‚\n5.5.4. è‡ªå®šä¹‰ hostname #Linux ç³»ç»Ÿåœ¨ /etc/hostname æ–‡ä»¶ä¸­å®šä¹‰äº† hostname ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒYocto æ˜¯åœ¨ base-files_*.bb æ–‡ä»¶ä¸­å®šä¹‰ hostname çš„ï¼š\n# By default the hostname is the machine name. If the hostname is unset then a # /etc/hostname file isn\u0026#39;t written, suitable for environments with dynamic # hostnames. # # The hostname can be changed outside of this recipe by using # hostname_pn-base-files = \u0026#34;my-host-name\u0026#34;. hostname = \u0026#34;${MACHINE}\u0026#34; é»˜è®¤å€¼æ˜¯ ${MACHINE} å®šä¹‰åœ¨ conf/local.conf æ–‡ä»¶ä¸­ã€‚æœ‰ä¸¤ç§æ–¹æ³•é‡å†™å®šä¹‰ hostname çš„å€¼ã€‚ä½ å¯ä»¥æ–°å¢ä¸€ä¸ª base-files_*.bbappend æ–‡ä»¶ï¼Œåœ¨å…¶ä¸­æ·»åŠ ï¼š\nhostname=\u0026#34;myhostname\u0026#34; æˆ–è€…åœ¨ conf/local.conf ä¸­æ·»åŠ ï¼š\nhostname_pn-base-files = \u0026#34;myhostname\u0026#34; 5.5.5. è‡ªå®šä¹‰ /etc/issue å’Œ /etc/issue.net #Linux ç³»ç»Ÿåœ¨ç”¨æˆ·ç™»å½•æ—¶ä¼šæ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯ï¼Œé€šå¸¸æ˜¯ä¸€äº›å…³äºç³»ç»Ÿç‰ˆæœ¬çš„è¯´æ˜ï¼Œè¿™äº›ä¿¡æ¯å®šä¹‰åœ¨ /etc/issue å’Œ /etc/issue.net ä¸¤ä¸ªæ–‡ä»¶ä¸­ã€‚åœ¨ Yocto ä¸­ï¼Œè¿™ä¸¤ä¸ªæ–‡ä»¶çš„å†…å®¹ä¹Ÿæ˜¯åœ¨ base-files_*.bb æ–‡ä»¶ä¸­å®šä¹‰çš„ï¼š\nâ€‹``` BASEFILESISSUEINSTALL ?= \u0026#34;do_install_basefilesissue\u0026#34; ...... DISTRO_VERSION[vardepsexclude] += \u0026#34;DATE\u0026#34; do_install_basefilesissue () { install -m 644 ${WORKDIR}/issue* ${D}${sysconfdir} if [ -n \u0026#34;${DISTRO_NAME}\u0026#34; ]; then printf \u0026#34;${DISTRO_NAME} \u0026#34; \u0026gt;\u0026gt; ${D}${sysconfdir}/issue printf \u0026#34;${DISTRO_NAME} \u0026#34; \u0026gt;\u0026gt; ${D}${sysconfdir}/issue.net if [ -n \u0026#34;${DISTRO_VERSION}\u0026#34; ]; then distro_version_nodate=\u0026#34;${@d.getVar(\u0026#39;DISTRO_VERSION\u0026#39;).replace(\u0026#39;snapshot-${DATE}\u0026#39;,\u0026#39;snapshot\u0026#39;).replace(\u0026#39;${DATE}\u0026#39;,\u0026#39;\u0026#39;)}\u0026#34; printf \u0026#34;%s \u0026#34; $distro_version_nodate \u0026gt;\u0026gt; ${D}${sysconfdir}/issue printf \u0026#34;%s \u0026#34; $distro_version_nodate \u0026gt;\u0026gt; ${D}${sysconfdir}/issue.net fi printf \u0026#34;\\\\\\n \\\\\\l\\n\u0026#34; \u0026gt;\u0026gt; ${D}${sysconfdir}/issue echo \u0026gt;\u0026gt; ${D}${sysconfdir}/issue echo \u0026#34;%h\u0026#34; \u0026gt;\u0026gt; ${D}${sysconfdir}/issue.net echo \u0026gt;\u0026gt; ${D}${sysconfdir}/issue.net fi } do_install_basefilesissue[vardepsexclude] += \u0026#34;DATE\u0026#34; æ¬¢è¿ä¿¡æ¯æ˜¯é€šè¿‡ do_install_basefilesissue() å‡½æ•°æ·»åŠ åˆ°æ–‡ä»¶çš„ï¼Œä¸»è¦æ˜¯è®°å½•äº†å‘è¡Œç‰ˆçš„åç§° ${DISTRO_NAME} å’Œç‰ˆæœ¬å· ${DISTRO_VERSION} ï¼Œè¿™ä¸¤ä¸ªå˜é‡çš„å€¼å¯ä»¥ç›´æ¥æŸ¥è¯¢ï¼š\n$ bitbake -e base-files | grep -E \u0026#34;^DISTRO_NAME=|^DISTRO_VERSION=\u0026#34; DISTRO_NAME=\u0026#34;NXP i.MX Release Distro\u0026#34; DISTRO_VERSION=\u0026#34;5.4-zeus\u0026#34; æˆ‘ä»¬å¯ä»¥æ–°å¢ä¸€ä¸ª base-files_*.bbappend æ–‡ä»¶ï¼Œç¦ç”¨ do_install_basefilesissue() å‡½æ•°ï¼Œç„¶åæ·»åŠ è‡ªå·±çš„å‡½æ•°ï¼Œä¾‹å¦‚ï¼š\nFILESEXTRAPATHS_prepend := \u0026#34;${THISDIR}/${PN}:\u0026#34; SRC_URI_prepend = \u0026#34; file://issue \\ file://issue.net \u0026#34; BASEFILESISSUEINSTALL = \u0026#34;do_install_basefilesissuecustom\u0026#34; do_install_basefilesissuecustom () { install -m 644 ${WORKDIR}/issue* ${D}${sysconfdir} } 5.5.6. ä¿®æ”¹ rootfs åˆ†åŒºçš„å¤§å° #æˆ‘ä»¬çš„ç³»ç»Ÿé•œåƒæ–‡ä»¶ä½¿ç”¨ .wic æ ¼å¼å®šä¹‰ SD/MMC å­˜å‚¨ä»‹è´¨ä¸Šçš„åˆ†åŒºï¼Œ .wic æ˜¯ç”¨ OpenEmbedded Kickstart(.wks) ç”Ÿæˆçš„ï¼Œæ”¯æŒ RAW å’Œ FileSystemä¸¤ç§åˆ†åŒºæ–¹å¼ï¼Œå…³äº .wks çš„è¯¦ç»†ä¿¡æ¯å¯ä»¥æŸ¥çœ‹ kickstart-docs ã€‚\nå¯ä»¥æ‰§è¡Œ bitbake -e core-image-base å¯¼å‡ºå½“å‰é•œåƒçš„æ‰€æœ‰å…ƒæ•°æ®ï¼Œåœ¨ _WKS_TEMPLATE å­—æ®µå¯ä»¥çœ‹åˆ°å¯åŠ¨é•œåƒåœ¨å­˜å‚¨ä»‹è´¨ä¸Šçš„å¸ƒå±€ï¼š\n# $_WKS_TEMPLATE # set image_types_wic.bbclass:112 [__anon_115__home_sbs_imx_yocto_bsp_5_4_47_sources_poky_meta_classes_image_types_wic_bbclass] # \u0026#34;# short-description: Create SD card image with a boot partition # # long-description: # # Create an image that can be written onto a SD card using dd for use # # with i.MX SoC family # # It uses u-boot # # # # The disk layout used is: # # - --------- -------------- -------------- # # | | u-boot | boot | rootfs | # # - --------- -------------- -------------- # # ^ ^ ^ ^ # # | | | | # # 0 1kiB 4MiB 16MiB + rootfs + IMAGE_EXTRA_SPACE (default 10MiB) # # # part u-boot --source rawcopy --sourceparams=\u0026#34;file=${UBOOT_BINARY}\u0026#34; --ondisk mmcblk --no-table --align 1 # part /boot --source bootimg-partition --ondisk mmcblk --fstype=vfat --label boot --active --align 4096 --size 16 # part / --source rootfs --ondisk mmcblk --fstype=ext4 --label root --align 4096 # # bootloader --ptable msdos # \u0026#34; _WKS_TEMPLATE=\u0026#34;# short-description: Create SD card image with a boot partition \\ å¯è§ï¼ŒU-boot å äº†å‰é¢çš„ 4MB ï¼Œboot æ˜¯ä¸€ä¸ª FAT æ ¼å¼çš„åˆ†åŒºï¼Œå­˜æ”¾äº†è®¾å¤‡æ ‘å’Œå†…æ ¸æ–‡ä»¶ï¼Œrootfs æ˜¯ ext4 åˆ†åŒºï¼Œåœ¨å®¿ä¸»æœºçš„ç¼–è¯‘ç¯å¢ƒä¸‹ä¹Ÿä¼šä¿ç•™ä¸€ä»½æ ¹æ–‡ä»¶ç³»ç»Ÿçš„æ‹·è´ï¼Œä½äº IMAGE_ROOTFS å˜é‡æŒ‡å®šçš„è·¯å¾„ï¼š\n# $IMAGE_ROOTFS [2 operations] # set /home/sbs/imx-yocto-bsp-5.4.47/sources/poky/meta/conf/bitbake.conf:451 # \u0026#34;${WORKDIR}/rootfs\u0026#34; # set /home/sbs/imx-yocto-bsp-5.4.47/sources/poky/meta/conf/documentation.conf:219 # [doc] \u0026#34;The location of the root filesystem while it is under construction (i.e. during do_rootfs).\u0026#34; # pre-expansion value: # \u0026#34;${WORKDIR}/rootfs\u0026#34; IMAGE_ROOTFS=\u0026#34;/home/sbs/imx-yocto-bsp-5.4.47/imx6ullevk-fb/tmp/work/imx6ull14x14evk-poky-linux-gnueabi/core-image-base/1.0-r0/rootfs\u0026#34; rootfs ä¹‹åçš„å­˜å‚¨ç©ºé—´éƒ½å¯èƒ½æˆä¸ºæœªä½¿ç”¨çš„ç©ºé—´è€Œè¢«æµªè´¹ï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹ rootfs åˆ†åŒºçš„å¤§å°ï¼Œä½¿å…¶å æ»¡æ•´ä¸ª SD/MMC çš„å­˜å‚¨ç©ºé—´ã€‚\nrootfs åˆ†åŒºçš„å¤§å°æ˜¯ç”±ä¸€å¥—ç®—æ³•å†³å®šçš„,å¯ä»¥è¡¨ç¤ºå¦‚ä¸‹ï¼š\nif (image-du * overhead) \u0026lt; rootfs-size: internal-rootfs-size = rootfs-size + xspace else: internal-rootfs-size = (image-du * overhead) + xspace where: image-du = Returned value of the du command on the image. overhead = IMAGE_OVERHEAD_FACTOR rootfs-size = IMAGE_ROOTFS_SIZE xspace = IMAGE_ROOTFS_EXTRA_SPACE internal-rootfs-size = Initial root filesystem size before any modifications. è¯¥ç®—æ³•æ¶‰åŠä¸‰ä¸ªå˜é‡ï¼š\nåˆå§‹ç£ç›˜ç©ºé—´ IMAGE_ROOTFS_SIZE å¼€é”€ç³»æ•° IMAGE_OVERHEAD_FACTOR é¢å¤–å¯ç”¨ç©ºé—´ IMAGE_ROOTFS_EXTRA_SPACE æ„å»ºç³»ç»Ÿé¦–å…ˆè¿è¡Œ du å‘½ä»¤æ¥ç¡®å®š rootfs ç›®å½•æ ‘çš„ç£ç›˜ä½¿ç”¨é‡ï¼ˆimage-duï¼‰ã€‚å¦‚æœ IMAGE_ROOTFS_SIZE å½“å‰å€¼å¤§äºç£ç›˜ä½¿ç”¨é‡ï¼ˆimage-duï¼‰ä¹˜ä»¥å¼€é”€ç³»æ•°ï¼ˆIMAGE_OVERHEAD_FACTORï¼‰ï¼Œåˆ™åªå¢åŠ é¢å¤–çš„ç©ºé—´ï¼ˆIMAGE_ROOTFS_EXTRA_SPACEï¼‰ã€‚å¦‚æœ IMAGE_ROOTFS_SIZE å°äºç£ç›˜ä½¿ç”¨é‡ä¹˜ä»¥å¼€é”€ç³»æ•°ï¼Œåˆ™åœ¨æ·»åŠ é¢å¤–ç©ºé—´ä¹‹å‰ï¼Œå…ˆå°†ç£ç›˜ä½¿ç”¨é‡ä¹˜ä»¥å¼€é”€ç³»æ•°ã€‚\nIMAGE_ROOTFS_SIZE å˜é‡å¿…é¡»è®¾ç½®ä¸€ä¸ªé»˜è®¤å€¼ï¼Œå•ä½æ˜¯ KBytes ï¼Œè¿™ä¸ªé»˜è®¤å€¼é€šå¸¸å¾ˆä½ï¼Œå› ä¸ºå®ƒåªæ˜¯åˆå§‹åŒ–ï¼Œå¹¶åœ¨æ¯æ¬¡ç”Ÿæˆé•œåƒæ—¶æ ¹æ®å®é™…å¤§å°éœ€æ±‚è¿›è¡Œæ›´æ–°ã€‚ä»¥ core-image-base é•œåƒä¸ºä¾‹ï¼Œé»˜è®¤å€¼æ˜¯ 65536 KBytes ï¼š\n# $IMAGE_ROOTFS_SIZE [2 operations] # set /home/sbs/imx-yocto-bsp-5.4.47/sources/poky/meta/conf/documentation.conf:221 # [doc] \u0026#34;Defines the size in Kbytes for the generated image.\u0026#34; # set /home/sbs/imx-yocto-bsp-5.4.47/sources/poky/meta/conf/bitbake.conf:783 # [_defaultval] \u0026#34;65536\u0026#34; # pre-expansion value: # \u0026#34;65536\u0026#34; IMAGE_ROOTFS_SIZE=\u0026#34;65536\u0026#34; å¼€é”€ç³»æ•°çš„é»˜è®¤å€¼æ˜¯ 1.3 ï¼Œä¹Ÿå°±æ˜¯åœ¨ rootfs ä¸­é¢„ç•™ 30% çš„ç©ºé—´ç»™ç”¨æˆ·å®‰è£…è½¯ä»¶ï¼Œé¢å¤–ç©ºé—´é»˜è®¤ä¸º 0 ï¼š\n# $IMAGE_OVERHEAD_FACTOR [2 operations] # set? /home/sbs/imx-yocto-bsp-5.4.47/sources/poky/meta/conf/bitbake.conf:460 # \u0026#34;1.3\u0026#34; # set /home/sbs/imx-yocto-bsp-5.4.47/sources/poky/meta/conf/documentation.conf:216 # [doc] \u0026#34;Defines a multiplier that the build system applies to the initial image size for cases when the multiplier times the returned disk usage value for the image is greater than the sum of IMAGE_ROOTFS_SIZE and IMAGE_ROOTFS_EXTRA_SPACE.\u0026#34; # pre-expansion value: # \u0026#34;1.3\u0026#34; IMAGE_OVERHEAD_FACTOR=\u0026#34;1.3\u0026#34; # # $IMAGE_ROOTFS_EXTRA_SPACE [2 operations] # set? /home/sbs/imx-yocto-bsp-5.4.47/sources/poky/meta/conf/bitbake.conf:465 # \u0026#34;0\u0026#34; # set /home/sbs/imx-yocto-bsp-5.4.47/sources/poky/meta/conf/documentation.conf:220 # [doc] \u0026#34;Defines additional free disk space created in the image in Kbytes. By default, this variable is set to \u0026#39;0\u0026#39;.\u0026#34; # pre-expansion value: # \u0026#34;0\u0026#34; IMAGE_ROOTFS_EXTRA_SPACE=\u0026#34;0\u0026#34; æ‰€ä»¥ï¼Œæ‰©å¤§ rootfs åˆ†åŒºå¤§å°æœ‰å¤šç§æ–¹æ³•ã€‚\nä¿®æ”¹å¼€é”€ç³»æ•°ï¼Œæ¯”å¦‚åœ¨ conf/local.conf ä¸­æ·»åŠ ï¼šIMAGE_OVERHEAD_FACTOR = \u0026ldquo;1.5\u0026rdquo; ï¼Œä½¿ rootfs åˆ†åŒºæœ‰ 50% çš„ç©ºé—²å­˜å‚¨ç©ºé—´ã€‚ å¢åŠ é¢å¤–ç©ºé—´ï¼Œæ¯”å¦‚åœ¨ conf/local.conf æ–‡ä»¶ä¸­æ·»åŠ ï¼šIMAGE_ROOTFS_EXTRA_SPACE = \u0026ldquo;1048576\u0026rdquo; ï¼Œä½¿ rootfs ç›´æ¥å¤šå‡º 1GB çš„ç©ºé—´ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™å¯èƒ½æ˜¯ IMAGE_OVERHEAD_FACTOR ç³»æ•°ä¹‹åçš„é¢å¤–ç©ºé—´ã€‚ ç›´æ¥è®¾ç½® IMAGE_ROOTFS_SIZE ï¼Œä½¿å®ƒè¶³å¤Ÿå¤§ï¼Œå¯ä»¥å æ»¡å­˜å‚¨ä»‹è´¨çš„ç©ºé—´ã€‚ 5.6. æ·»åŠ æ–°çš„ recipe #recipeï¼ˆ.bbæ–‡ä»¶ï¼‰æ˜¯ Yocto é¡¹ç›®ç¯å¢ƒä¸­çš„åŸºæœ¬ç»„ä»¶ã€‚ç”± OpenEmbedded æ„å»ºç³»ç»Ÿæ„å»ºçš„æ¯ä¸ªè½¯ä»¶åŒ…éƒ½éœ€è¦ä¸€ä¸ª recipe æ¥å®šä¹‰ã€‚æˆ‘ä»¬å¯ä»¥ä»å¤´å¼€å§‹æ‰‹å†™ recipe ï¼Œæˆ–è€…å‚è€ƒåˆ«çš„ recipe è¿›è¡Œä¿®æ”¹ï¼Œä¾‹å¦‚åœ¨ http://layers.openembedded.org/layerindex/branch/master/layers/ ä¸­æœ‰å¾ˆå¤šç¤¾åŒºç»´æŠ¤çš„recipe ï¼Œå¯ä»¥æŸ¥æ‰¾ç¬¦åˆéœ€æ±‚çš„æ‹¿æ¥ç”¨ã€‚æ­¤å¤–ï¼ŒOpenEmbedded å’Œ Yocto åˆ†åˆ«æä¾›äº†äº† devtool å’Œ recipetool ä¸¤ç§å·¥å…·æ¥æ–°å»º recipe ã€‚Recipe æ–‡ä»¶çš„è¯­æ³•ä¹Ÿå¯ä»¥å‚è€ƒ https://www.yoctoproject.org/docs/1.8/bitbake-user-manual/bitbake-user-manual.html ã€‚ä¸‹é¢æ˜¯æ‰‹å†™ä¸€ä¸ª recipe çš„åŸºæœ¬æµç¨‹ï¼š\n5.6.1. æ–°å»ºæ–‡ä»¶ #ä»¥ç§»æ¤ UCI ä¸ºä¾‹ï¼Œå› ä¸º bitbake æ˜¯é€šè¿‡ conf/layer.conf æ–‡ä»¶ä¸­å®šä¹‰çš„ BBFILES å˜é‡æ¥æœç´¢ recipe çš„ï¼Œè¿™ä¸ªå˜é‡å®šä¹‰äº†æœç´¢è·¯å¾„ï¼š\nBBFILES += \u0026#34;${LAYERDIR}/recipes-*/*/*.bb \\ ${LAYERDIR}/recipes-*/*/*.bbappend\u0026#34; æ‰€ä»¥æˆ‘ä»¬ä¾æ¬¡å»ºç«‹å¦‚ä¸‹è·¯å¾„å’Œæ–‡ä»¶ï¼š\nmeta-mylayer/recipes-example/uci meta-mylayer/recipes-example/uci/uci_git.bb recipe æ–‡ä»¶çš„å‘½åè§„èŒƒæ˜¯ \u0026lt;packagename\u0026gt;_\u0026lt;version\u0026gt;-\u0026lt;revision\u0026gt;.bb :\npackagename å°±æ˜¯åŒ…çš„åå­—ï¼Œåå­—ä¸­é—´ä¸åº”è¯¥æœ‰ä¸‹åˆ’çº¿ï¼Œå¯ä»¥ç”¨çŸ­æ¨ªçº¿ï¼Œbitbake ä¼šå°†å…¶èµ‹å€¼ç»™å˜é‡ PN version æ˜¯è½¯ä»¶åŒ…çš„ç‰ˆæœ¬å·ï¼Œbitbake ä¼šå°†å…¶èµ‹å€¼ç»™å˜é‡ PV revision æ˜¯ä¿®è®¢ç‰ˆæœ¬å·ï¼Œbitbake ä¼šå°†å…¶èµ‹å€¼ç»™å˜é‡ PR ä¾‹å¦‚ linux-imx_5.4.bb ã€‚ä¼ ç»Ÿçš„å¼€æºè½¯ä»¶éƒ½æ˜¯ä»¥æºç å‹ç¼©åŒ…çš„å½¢å¼ï¼Œå‹ç¼©åŒ…çš„æ–‡ä»¶åé‡Œå°±å¸¦æœ‰ç‰ˆæœ¬å·ï¼Œè¿™æ ·çš„å‘½åå°±å¯ä»¥æ–¹ä¾¿æŠŠç‰ˆæœ¬å·ä¼ é€’åˆ° recipe æ–‡ä»¶å†…éƒ¨ã€‚å¯¹äº git æˆ–è€… svn ç­‰å½¢å¼å‘å¸ƒçš„è½¯ä»¶ï¼Œå¯ä»¥ç›´æ¥ç”¨ git æˆ– svn æ›¿ä»£ç‰ˆæœ¬å·çš„ä½ç½®ï¼Œä¾‹å¦‚ uci_git.bb ã€‚å‘æ–‡ä»¶å¡«å…¥ä¸€äº›åŸºæœ¬ä¿¡æ¯ï¼š\nSUMMARY = \u0026#34;UCI\u0026#34; DESCRIPTION = \u0026#34;OpenWrt Unified Configuration Interface\u0026#34; LICENSE = \u0026#34;GPLv2\u0026#34; SUMMARY æ˜¯å¯¹è¿™ä¸ª recipe çš„æ¦‚è¿°ï¼Œä¸èƒ½è¶…è¿‡ 72 ä¸ªå­—ç¬¦ã€‚ DESCRIPTION æ˜¯å¯¹è¿™ä¸ª recipe çš„è¯¦ç»†æè¿° LICENSE æ˜¯è¿™ä¸ªè½¯ä»¶åŒ…çš„å¼€æºè®¸å¯è¯ æ­¤æ—¶ï¼Œrecipe æ–‡ä»¶å·²ç»å¯ä»¥è¢«æ­£ç¡®è§£æï¼ŒæŸ¥çœ‹ä¸€äº›åŸºæœ¬çš„å˜é‡ï¼š\n$ bitbake -e uci | grep -E \u0026#34;^PN=|^PV=|^PR=\u0026#34; PN=\u0026#34;uci\u0026#34; PR=\u0026#34;r0\u0026#34; PV=\u0026#34;git\u0026#34; ä¸‹é¢å¼€å§‹ç¼–è¾‘è¿™ä¸ªæ–‡ä»¶ã€‚\n5.6.2. è·å–æºç  #è·å–æºç çš„è¿‡ç¨‹æ˜¯ç”± do_fetch ä»»åŠ¡æ¥å®Œæˆï¼Œä¸»è¦æ˜¯é€šè¿‡ SRC_URI å˜é‡æ§åˆ¶ï¼Œå®ƒå¯ä»¥æŒ‡å®šæºç çš„ä½ç½®ï¼Œè·å–æºç çš„åè®®ï¼Œæºç çš„ç‰ˆæœ¬ç­‰ã€‚æºç é€šå¸¸æ¥æºäºä¸‰ç§é€”å¾„ï¼š\nä¸Šæ¸¸å‘å¸ƒçš„æºç å‹ç¼©åŒ…ï¼Œé€šå¸¸æ˜¯ ftp ã€http ç­‰åè®®çš„ä¸‹è½½åœ°å€ã€‚ é€šè¿‡ç‰ˆæœ¬æ§åˆ¶æœåŠ¡å™¨å‘å¸ƒçš„æºç ï¼Œé€šå¸¸æ˜¯ git ã€svn ç­‰åè®®ä¸‹è½½åœ°å€ã€‚ æœ¬åœ°æºç æ ‘ï¼Œæºç æ–‡ä»¶å°±æ”¾åœ¨ recipe æ–‡ä»¶çš„åŒå±‚è·¯å¾„ä¸‹ï¼Œé€šå¸¸æ˜¯ç”¨æˆ·è‡ªå·±å¼€å‘çš„è½¯ä»¶ã€‚ å¿…é¡»åœ¨ recipe ä¸­å®šä¹‰ SRC_URI ï¼Œå°½é‡ä¸è¦ä½¿ç”¨ç¡¬ç¼–ç ï¼Œè€Œè¦å¤šç”¨ç³»ç»Ÿä½“ç”¨çš„å˜é‡ï¼Œæ¯”å¦‚ poky/meta/recipes-connectivity/iw/iw_5.3.bb ä¸­çš„å®šä¹‰ï¼š\nSRC_URI = \u0026#34;http://www.kernel.org/pub/software/network/iw/${BP}.tar.gz \\ BP çš„å«ä¹‰å°±æ˜¯ ${BPN}-${PV} ï¼ŒBPN æ˜¯ PN çš„å¦ä¸€ä¸ªç‰ˆæœ¬ï¼Œå®ƒä¼šå»æ‰ PN çš„ä¸€äº›ç‰¹æ®Šå‰åç¼€ï¼ˆæ¯”å¦‚lib32- ã€-nativeç­‰ï¼‰ã€‚\nå¦‚æœæ˜¯é€šè¿‡ git å…‹éš†çš„æºç ï¼Œè¿˜éœ€è¦æ‰‹åŠ¨è®¾ç½® SRCREV å’Œ PV ã€‚SRCREV æ˜¯ git ä»“åº“çš„ commit hash å€¼ï¼Œbitbake æ ¹æ®è¿™ä¸ªå€¼è°ƒç”¨ git å‘½ä»¤æ£€å‡ºæˆ‘ä»¬éœ€è¦çš„ç‰ˆæœ¬ã€‚PV çš„é»˜è®¤å€¼å°±æ˜¯ git ï¼Œæœ€å¥½æ‰‹åŠ¨è®¾ç½®ä¸€ä¸ªå…·æœ‰ç‰ˆæœ¬æ„ä¹‰çš„å€¼ï¼Œæ¯”å¦‚ /meta-openembedded/meta-oe/recipes-devtools/libubox/libubox_git.bb ä¸­çš„å®šä¹‰ï¼š\nPV = \u0026#34;1.0.1+git${SRCPV}\u0026#34; 1.0.1+git æ˜¯è‡ªå®šä¹‰çš„å­—æ®µï¼ŒSRCPV çš„å€¼æ˜¯ bitbake è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œä¸»è¦ä½¿ç”¨äº† SRCREV çš„å‰åä¸ªå­—ç¬¦ã€‚å¯¹äº git åè®®ï¼Œè¿˜å¯ä»¥è®¾ç½®å…¶ä»–å‚æ•°æ¥ç²¾ç¡®åŒ¹é…æƒ³è¦çš„ç‰ˆæœ¬ï¼Œä¾‹å¦‚ï¼š\nbranchï¼Œè¦å…‹éš†çš„åˆ†æ”¯ï¼Œå¦‚æœæœªè®¾ç½®ï¼Œé»˜è®¤ä¸º \u0026ldquo;master\u0026rdquo;ã€‚ tagï¼ŒæŒ‡å®šç”¨äºæ£€å‡ºçš„æ ‡ç­¾ï¼Œæœ‰äº›è½¯ä»¶æ˜¯ç”¨ tag æ¥æ ‡è®°ç‰ˆæœ¬çš„ã€‚ å‚æ•°ä¹‹é—´ç”¨åˆ†å·éš”å¼€ï¼Œä¾‹å¦‚ï¼š\nSRC_URI = \u0026#34;git://git.oe.handhelds.org/git/vip.git;tag=version-1\u0026#34; å¯¹äºè¿œç¨‹ä¸‹è½½çš„æºç å‹ç¼©åŒ…ï¼Œbitbake ä¼šå°è¯•è®¡ç®—æ–‡ä»¶çš„æ ¡éªŒå’Œï¼Œç„¶åä¸ recpie ä¸­è®¾ç½®çš„ SRC_URI[md5sum] å’Œ SRC_URI[sha256sum] è¿›è¡Œå¯¹æ¯”ï¼Œç¡®ä¿æ²¡æœ‰ç¯¡æ”¹æˆ–æŸåï¼Œå¦‚æœæ£€éªŒå’Œä¸ä¸€è‡´ï¼Œä¼šæŠ¥é”™ã€‚è¿˜æ˜¯ä»¥ poky/meta/recipes-connectivity/iw/iw_5.3.bb ä¸­çš„å®šä¹‰ä¸ºä¾‹ï¼š\nSRC_URI = \u0026#34;http://www.kernel.org/pub/software/network/iw/${BP}.tar.gz \\ file://0001-iw-version.sh-don-t-use-git-describe-for-versioning.patch \\ file://separate-objdir.patch \\ \u0026#34; SRC_URI[md5sum] = \u0026#34;6d4d1c0ee34f3a7bda0e6aafcd7aaf31\u0026#34; SRC_URI[sha256sum] = \u0026#34;175abbfce86348c0b70e778c13a94c0bfc9abc7a506d2bd608261583aeedf64a\u0026#34; å¦‚æœä½¿ç”¨äº†æœ¬åœ°çš„æºç ï¼Œæºç æ–‡ä»¶è¦æ”¾åœ¨ recipe æ–‡ä»¶æ—è¾¹åä¸º ${BP}ã€${BPN} æˆ–è€… files çš„æ–‡ä»¶å¤¹ä¸­ï¼Œç„¶åç”¨ file:// åè®®æŒ‡å®šç›¸å¯¹è·¯å¾„ï¼Œbitbake ä¼šä¾æ¬¡ä» ${BP}ã€${BPN} å’Œ files æ–‡ä»¶å¤¹ä¸­æŒ‰ç›¸å¯¹è·¯å¾„è¿›è¡Œæœç´¢ã€‚\næºç è·å–æˆåŠŸåï¼Œdo_unpack ä»»åŠ¡ä¼šæŠŠæºç é‡Šæ”¾åˆ° ${S} å˜é‡æŒ‡å‘çš„è·¯å¾„ã€‚S çš„é»˜è®¤å€¼æ˜¯ ${ WORKDIR}/${ BPN}-${ PV} ï¼Œå¦‚æœä¸‹è½½çš„æ˜¯æºç å‹ç¼©åŒ…ï¼Œå¹¶ä¸”å‹ç¼©åŒ…çš„å†…éƒ¨ç»“æ„ç¬¦åˆé¡¶å±‚å­ç›®å½• ${BPN}-${PV} çš„çº¦å®šï¼Œé‚£å°±ä¸éœ€è¦è®¾ç½® S ã€‚ç„¶è€Œï¼Œå‹ç¼©åŒ…ä¸ç¬¦åˆè¿™ä¸ªçº¦å®šï¼Œæˆ–è€…æ˜¯ä» git ç­‰ç‰ˆæœ¬ç®¡ç†æœåŠ¡å™¨å…‹éš†çš„æºç ï¼Œå°±è¦æ‰‹åŠ¨è®¾ç½® S ï¼Œæ¯”å¦‚ git ä¼šå°†æºç å…‹éš†åˆ° ${WORKDIR}/git è·¯å¾„ä¸‹ï¼Œå°±è¦åœ¨ recipe ä¸­è®¾ç½®è¿™ä¸ªå€¼ã€‚ä¸‹é¢æ˜¯è·å–å’Œé‡Šæ”¾æºç çš„ç¤ºæ„å›¾ï¼š\næˆ‘ä»¬éœ€è¦åœ¨ uci_git.bb ä¸­æ·»åŠ ï¼š\nSRC_URI = \u0026#34;git://git.openwrt.org/project/uci.git\u0026#34; SRCREV = \u0026#34;52bbc99f69ea6f67b6fe264f424dac91bde5016c\u0026#34; PV = \u0026#34;1.0.0+git${SRCPV}\u0026#34; S = \u0026#34;${WORKDIR}/git\u0026#34; ç„¶åæ‰§è¡Œ unpack ä»»åŠ¡ï¼ŒéªŒè¯ recipe æ˜¯å¦æ­£ç¡®ï¼š\nbitbake uci -c unpack æºç ä¼šé‡Šæ”¾åˆ° tmp/work/cortexa7t2hf-neon-poky-linux-gnueabi/uci/1.0.0+gitAUTOINC+52bbc99f69-r0/git è·¯å¾„ä¸‹ã€‚\n5.6.3. æ‰“è¡¥ä¸ #æœ‰æ—¶éœ€è¦åœ¨è·å–æºç åå¯¹å…¶æ‰“è¡¥ä¸ã€‚SRC_URI ä¸­æåˆ°çš„ä»»ä½•æ–‡ä»¶ï¼Œå¦‚æœå…¶åç§°ä»¥ .patc æˆ– .diffç»“å°¾ï¼Œæˆ–è€…æ˜¯è¿™äº›åç¼€çš„å‹ç¼©ç‰ˆæœ¬(ä¾‹å¦‚ï¼šdiff.gz)ï¼Œéƒ½ä¼šè¢«è§†ä¸ºè¡¥ä¸ã€‚do_patch ä»»åŠ¡ä¼šè‡ªåŠ¨åº”ç”¨è¿™äº›è¡¥ä¸ã€‚\næ„å»ºç³»ç»Ÿåº”è¯¥èƒ½å¤Ÿä½¿ç”¨\u0026quot;-p1 \u0026ldquo;é€‰é¡¹æ¥åº”ç”¨è¡¥ä¸ (å³è·¯å¾„ä¸­çš„ä¸€ä¸ªç›®å½•çº§åˆ«å°†è¢«ç§»é™¤)ã€‚å¦‚æœä½ çš„è¡¥ä¸éœ€è¦å‰¥ç¦»æ›´å¤šçš„ç›®å½•çº§åˆ«ï¼Œè¯·ä½¿ç”¨è¡¥ä¸çš„ SRC_URI æ¡ç›®ä¸­çš„ \u0026ldquo;striplevel\u0026rdquo; é€‰é¡¹æŒ‡å®šçº§åˆ«æ•°ã€‚å¦å¤–ï¼Œå¦‚æœæ‚¨çš„è¡¥ä¸éœ€è¦åº”ç”¨åœ¨è¡¥ä¸æ–‡ä»¶ä¸­æ²¡æœ‰æŒ‡å®šçš„ç‰¹å®šå­ç›®å½•ä¸­ï¼Œè¯·ä½¿ç”¨æ¡ç›®ä¸­çš„ \u0026ldquo;patchdir \u0026ldquo;é€‰é¡¹ã€‚\nå¦‚åŒåœ¨ SRC_URI ä¸­ä½¿ç”¨ file:// å¼•ç”¨çš„æœ¬åœ°æ–‡ä»¶ä¸€æ ·ï¼Œåº”è¯¥æŠŠè¡¥ä¸æ–‡ä»¶æ”¾åœ¨ recipe æ–‡ä»¶æ—è¾¹åä¸º ${BP}ã€${BPN} æˆ–è€… files çš„æ–‡ä»¶å¤¹ä¸­ã€‚\n5.6.4. è®¾ç½® License #åº”è¯¥åœ¨ recipe ä¸­ç”¨ LICENSE å’Œ LIC_FILES_CHKSUM è®¾ç½®ç‰ˆæƒè®¸å¯è¯å’Œè®¸å¯è¯æ–‡ä»¶çš„æ ¡éªŒå’Œã€‚\nè½¯ä»¶é€šå¸¸ä¼šåœ¨æºç åŒ…çš„æŸä¸ªæ–‡ä»¶ä¸­å£°æ˜è‡ªå·±çš„è®¸å¯è¯ç±»å‹ï¼Œæ¯”å¦‚ COPYING, LICENSE å’Œ README ç­‰ï¼ŒæŸ¥åˆ°è®¸å¯è¯ç±»å‹å°±å¯ä»¥è®¾ç½® LICENSE ï¼Œå¯¹äºæ ‡å‡†è®¸å¯è¯ï¼Œä½¿ç”¨ poky/meta/files/common-licenses/ ä¸­çš„æ–‡ä»¶åï¼Œæˆ–è€… meta/conf/licenses.conf ä¸­å®šä¹‰çš„ SPDXLICENSEMAP æ ‡å¿—åå³å¯ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„è®¸å¯è¯åç§°ã€‚ç„¶åç”¨è®¸å¯è¯æ–‡ä»¶çš„ md5 æ ¡éªŒå€¼è®¾ç½® LIC_FILES_CHKSUM ã€‚å¦‚æœæºç åŒ…é‡Œæ²¡æœ‰è®¸å¯è¯æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ç”¨ä»»æ„æ–‡ä»¶æ›¿ä»£ã€‚æˆ–è€…ç”¨ç³»ç»Ÿå†…çš„ License ï¼Œä¾‹å¦‚:\nLICENSE = \u0026#34;MIT\u0026#34; LIC_FILES_CHKSUM = \u0026#34;file://${COMMON_LICENSE_DIR}/MIT;md5=0835ade698e0bcf8506ecda2f7b4f302\u0026#34; æˆ‘ä»¬éœ€è¦åœ¨ uci_git.bb ä¸­æ·»åŠ ï¼š\nLICENSE = \u0026#34;GPLv2\u0026#34; LIC_FILES_CHKSUM = \u0026#34;file://CMakeLists.txt;md5=5c39cc16168ed9d0e1603468508a6e2b\u0026#34; 5.6.5. ç¡®å®šä¾èµ–å…³ç³» #å¤§å¤šæ•°è½¯ä»¶åŒ…éƒ½æœ‰ä¸€ä¸ªå®ƒä»¬æ‰€éœ€è¦çš„å…¶ä»–è½¯ä»¶åŒ…çš„ç®€çŸ­åˆ—è¡¨ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„ä¾èµ–å…³ç³»ã€‚è¿™äº›ä¾èµ–å…³ç³»å¯åˆ†ä¸ºä¸¤å¤§ç±»ï¼šæ„å»ºæ—¶ä¾èµ–å…³ç³»ï¼Œè¿™æ˜¯è½¯ä»¶æ„å»ºæ—¶éœ€è¦çš„ï¼›è¿è¡Œæ—¶ä¾èµ–å…³ç³»ï¼Œè¿™æ˜¯è½¯ä»¶è¿è¡Œæ—¶éœ€è¦å®‰è£…åœ¨ç›®æ ‡æœºä¸Šçš„ã€‚\nåœ¨ recipe æ–‡ä»¶ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ DEPENDS å˜é‡è®¾ç½®æ„å»ºæ—¶çš„ä¾èµ–å…³ç³»ï¼ŒDEPENDSä¸­æŒ‡å®šçš„é¡¹ç›®åº”è¯¥æ˜¯å…¶ä»– recipe çš„åç§°ã€‚ä»¥ meta-openembedded/meta-oe/recipes-devtools/libubox/libubox_git.bb ä¸ºä¾‹ï¼š\nDEPENDS = \u0026#34;json-c\u0026#34; å¦ä¸€ä¸ªè€ƒè™‘å› ç´ æ˜¯ï¼Œconfigure è„šæœ¬å¯èƒ½ä¼šè‡ªåŠ¨æ£€æŸ¥å¯é€‰çš„ä¾èµ–å…³ç³»ï¼Œå¹¶åœ¨å‘ç°è¿™äº›ä¾èµ–å…³ç³»æ—¶å¯ç”¨ç›¸åº”çš„åŠŸèƒ½ã€‚è¿™æ„å‘³ç€ï¼Œä¸ºäº†ä¿è¯ç¡®å®šæ€§ï¼Œåº”è¯¥æŠŠè¿™äº›ä¾èµ–å…³ç³»ä¹Ÿæ˜¾å¼åœ°æŒ‡å®šå‡ºæ¥ï¼Œæˆ–è€…æ˜ç¡®åœ°å‘Šè¯‰ configure è„šæœ¬ç¦ç”¨è¿™äº›åŠŸèƒ½ã€‚\nä¸æ„å»ºæ—¶çš„ä¾èµ–å…³ç³»ç±»ä¼¼ï¼Œå¯ä»¥ RDEPENDS å˜é‡è®¾ç½®è¿è¡Œæ—¶çš„ä¾èµ–å…³ç³»ï¼Œè¿™äº›ä¾èµ–å…³ç³»æ˜¯ä¸ºäº†è®©åŒ…æ­£ç¡®è¿è¡Œè€Œå¿…é¡»å®‰è£…çš„å…¶ä»–åŒ…ã€‚å› ä¸º RDEPENDS å˜é‡é€‚ç”¨äºæ­£åœ¨æ„å»ºçš„åŒ…ï¼Œæ‰€ä»¥ä½ åº”è¯¥æ€»æ˜¯ä»¥å¸¦æœ‰åŒ…åçš„å½¢å¼æ¥ä½¿ç”¨è¿™ä¸ªå˜é‡ï¼ˆè®°ä½ï¼Œä¸€ä¸ª recipe å¯ä»¥æ„å»ºå¤šä¸ªåŒ…ï¼‰ã€‚ä¾‹å¦‚ï¼Œå‡è®¾ä½ æ­£åœ¨æ„å»ºä¸€ä¸ªä¾èµ–äºperlåŒ…çš„å¼€å‘åŒ…ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ ä¼šä½¿ç”¨ä¸‹é¢çš„RDEPENDSè¯­å¥ã€‚\nRDEPENDS_${PN}-dev += \u0026#34;perl\u0026#34; uci çš„ç¼–è¯‘å’Œè¿è¡Œéƒ½ä¾èµ– libubox ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ uci_git.bb ä¸­æ·»åŠ ï¼š\nDEPENDS = \u0026#34;libubox\u0026#34; 5.6.6. é…ç½® #å¤§éƒ¨åˆ†è½¯ä»¶åœ¨ç¼–è¯‘ä¹‹å‰éƒ½éœ€è¦è¿›è¡Œé…ç½®ï¼Œé€šå¸¸æœ‰å¦‚ä¸‹ä¸‰ç§æƒ…å†µï¼š\nAutotoolsï¼šå¦‚æœæºæ–‡ä»¶ä¸­æœ‰configure.acæ–‡ä»¶ï¼Œé‚£ä¹ˆè½¯ä»¶æ˜¯ä½¿ç”¨ Autotools æ„å»ºçš„ï¼Œrecipe æ–‡ä»¶é‡Œéœ€è¦ç»§æ‰¿ autotools ç±»ï¼ˆinherit autotoolsï¼‰ï¼Œè€Œä¸”ä¸å¿…åŒ…å« do_configure ä»»åŠ¡ã€‚ä½†æ˜¯ï¼Œå¯èƒ½è¿˜æ˜¯è¦åšä¸€äº›è°ƒæ•´ï¼Œå¯ä»¥è®¾ç½® EXTRA_OECONF æˆ– PACKAGECONFIG_CONFARGS æ¥ä¼ é€’æ‰€éœ€çš„é…ç½®é€‰é¡¹ã€‚ CMake: å¦‚æœæºæ–‡ä»¶ä¸­æœ‰ä¸€ä¸ª CMakeLists.txt æ–‡ä»¶ï¼Œé‚£ä¹ˆä½ çš„è½¯ä»¶æ˜¯ç”¨ CMake æ„å»ºçš„ï¼Œrecipeæ–‡ä»¶éœ€è¦ç»§æ‰¿ cmake ç±»ï¼ˆinherit cmakeï¼‰ï¼Œè€Œä¸”ä¸å¿…åŒ…å«do_configureä»»åŠ¡ã€‚ä½ å¯ä»¥é€šè¿‡è®¾ç½® EXTRA_OECMAKE æ¥è¿›è¡Œä¸€äº›è°ƒæ•´ã€‚ å…¶ä»–ï¼šå…¶ä»–æƒ…å†µå°±éœ€è¦åœ¨ä½ çš„ recipe ä¸­æä¾›ä¸€ä¸ªdo_configureä»»åŠ¡ã€‚ uci ç¼–è¯‘æ—¶é»˜è®¤éœ€è¦ lua5.1 ï¼Œä½†æ˜¯æˆ‘ä»¬çš„ç³»ç»Ÿæ²¡æœ‰å®‰è£… lua5.1 ï¼Œæºç åŒ…ä¸­çš„ CMakeLists.txt æä¾›äº† BUILD_LUA é€‰é¡¹ï¼Œé»˜è®¤æ˜¯ ON ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªç‰¹æ€§å…³é—­ï¼Œæ‰§è¡Œ cmake æ—¶å°±ä¸ä¼šå¯»æ‰¾ lua5.1 äº†ï¼š\ninherit cmake EXTRA_OECMAKE = \u0026#34;-DBUILD_LUA=OFF\u0026#34; ä¸€æ—¦é…ç½®æˆåŠŸï¼Œæœ€å¥½æ£€æŸ¥ä¸€ä¸‹ log.do_configure æ–‡ä»¶ï¼Œä»¥ç¡®ä¿é€‚å½“çš„é€‰é¡¹å·²ç»å¯ç”¨ã€‚\n5.6.7. ç¼–è¯‘ #é…ç½®æˆåŠŸåï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è°ƒç”¨ do_compile ä»»åŠ¡è¿›è¡Œç¼–è¯‘ï¼Œå¦‚æœæ²¡æœ‰æŠ¥é”™ï¼Œå°±ä¸ç”¨åšä»»ä½•äº‹æƒ…ã€‚å¦‚æœç¼–è¯‘æ­¥éª¤å¤±è´¥ï¼Œéœ€è¦åˆ†æå¤±è´¥åŸå› ï¼Œå¯èƒ½çš„åŸå› æœ‰ï¼š\nå¹¶è¡Œæ„å»ºå¤±è´¥ã€‚è¿™äº›æ•…éšœè¡¨ç°ä¸ºé—´æ­‡æ€§é”™è¯¯ï¼Œæˆ–æŠ¥å‘Šè¯´æ‰¾ä¸åˆ°åº”ç”±æ„å»ºè¿‡ç¨‹å…¶ä»–éƒ¨åˆ†åˆ›å»ºçš„æ–‡ä»¶æˆ–ç›®å½•ã€‚è¯¦ç»†ä¿¡æ¯å’Œè§£å†³æ–¹æ³•å¯ä»¥å‚è€ƒ https://docs.yoctoproject.org/3.0.4/dev-manual/dev-manual.html#debugging-parallel-make-races ä¸»æœºè·¯å¾„é”™è¯¯ã€‚å½“ä¸ºç›®æ ‡æœºäº¤å‰ç¼–è¯‘æ—¶ï¼Œä½¿ç”¨äº†æ¥è‡ªä¸»æœºç³»ç»Ÿçš„ä¸æ­£ç¡®çš„å¤´æ–‡ä»¶ã€åº“æˆ–å…¶ä»–æ–‡ä»¶æ—¶ï¼Œå°±ä¼šå‘ç”Ÿè¯¥æ•…éšœã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¯·æ£€æŸ¥log.do_compileæ–‡ä»¶ï¼Œä»¥ç¡®å®šæ­£åœ¨ä½¿ç”¨çš„è·¯å¾„ï¼Œç„¶åæ·»åŠ é…ç½®é€‰é¡¹ã€åº”ç”¨è¡¥ä¸ç­‰ã€‚ é”™è¯¯çš„å¤´æ–‡ä»¶å’Œåº“æ–‡ä»¶ã€‚å¦‚æœå› ä¸ºæ²¡æœ‰åœ¨ DEPENDS ä¸­å£°æ˜è€Œç¼ºå°‘æ„å»ºæ—¶çš„ä¾èµ–å…³ç³»ï¼Œæˆ–è€…å› ä¸ºä¾èµ–å…³ç³»å­˜åœ¨ï¼Œä½†æ„å»ºè¿‡ç¨‹ç”¨æ¥æŸ¥æ‰¾æ–‡ä»¶çš„è·¯å¾„ä¸æ­£ç¡®ï¼Œé…ç½®æ­¥éª¤æ²¡æœ‰æ£€æµ‹åˆ°å®ƒï¼Œç¼–è¯‘è¿‡ç¨‹å¯èƒ½ä¼šå¤±è´¥ã€‚å¯¹äºè¿™ä¸¤ç§å¤±è´¥çš„æƒ…å†µï¼Œç¼–è¯‘è¿‡ç¨‹éƒ½ä¼šæŠ¥å‘Šæ— æ³•æ‰¾åˆ°æ–‡ä»¶ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œéœ€è¦å›è¿‡å¤´æ¥å‘é…ç½®è¿‡ç¨‹æ·»åŠ é¢å¤–çš„é€‰é¡¹ã€‚ 5.6.8. å®‰è£… #å®‰è£…è¿‡ç¨‹ä¸­ï¼Œç³»ç»Ÿè°ƒç”¨ do_install ä»»åŠ¡ç”Ÿæˆçš„æ–‡ä»¶å’Œç›®å½•ç»“æ„å¤åˆ¶åˆ°ç›®æ ‡è®¾å¤‡ä¸Šçš„é•œåƒä½ç½®ã€‚ä¼šå°† ${S}ã€${B} å’Œ ${WORKDIR} ç›®å½•ä¸­çš„æ–‡ä»¶å¤åˆ¶åˆ° ${D} ç›®å½•ä¸­ï¼Œä»¥åˆ›å»ºç›®æ ‡ç³»ç»Ÿä¸­çš„ç»“æ„ã€‚å¯¹äºä½¿ç”¨ autotools å’Œ cmake æ„å»ºçš„è½¯ä»¶åŒ…ï¼Œç³»ç»Ÿä¼šè°ƒç”¨å®ƒä»¬çš„ instal æŒ‡ä»¤æ‰§è¡Œå®‰è£…ä»»åŠ¡ï¼Œå¦‚æœèƒ½å¤Ÿæ»¡è¶³è¦æ±‚ï¼Œå°±ä¸ç”¨ä¿®æ”¹ã€‚å…¶ä»–æƒ…å†µåˆ™éœ€è¦ä¿®æ”¹æˆ–è€…æ‰‹å†™ do_install ä»»åŠ¡ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ recipe æ–‡ä»¶ä¸­å®šä¹‰ä¸€ä¸ª do_install å‡½æ•°ï¼Œç„¶åæ·»åŠ å®‰è£…æŒ‡ä»¤ã€‚\nå¦‚æœä½ çš„æºç åŒ…æœ‰ Makefile æ–‡ä»¶ï¼Œå¹¶æ”¯æŒ make install æ“ä½œï¼Œéœ€è¦åœ¨ do_install ä¸­è°ƒç”¨ oe_runmake install æŒ‡ä»¤æ‰§è¡Œå®‰è£…æ“ä½œï¼Œä¾‹å¦‚ï¼š\ndo_install () { oe_runmake install DESTDIR=${D} SBINDIR=${sbindir} MANDIR=${mandir} INCLUDEDIR=${includedir} } å¦‚æœè¦æ‰‹åŠ¨å®‰è£…ï¼Œå¿…é¡»å…ˆåœ¨ do_install å‡½æ•°ä¸­ä½¿ç”¨ install -d æ¥åˆ›å»º ${D} ä¸‹çš„ç›®å½•ã€‚ä¸€æ—¦è¿™äº›ç›®å½•å­˜åœ¨ï¼Œå°±å¯ä»¥ä½¿ç”¨ install æ¥æ‰‹åŠ¨å®‰è£…æ–‡ä»¶åˆ°è¿™äº›ç›®å½•ä¸­ã€‚ä»¥ meta-openembedded/meta-networking/recipes-connectivity/mosquitto/mosquitto_1.6.7.bb ä¸ºä¾‹ï¼š\ndo_install() { oe_runmake \u0026#39;DESTDIR=${D}\u0026#39; install install -d ${D}${systemd_unitdir}/system/ install -m 0644 ${S}/service/systemd/mosquitto.service.notify ${D}${systemd_unitdir}/system/mosquitto.service install -d ${D}${sysconfdir}/mosquitto install -m 0644 ${D}${sysconfdir}/mosquitto/mosquitto.conf.example \\ ${D}${sysconfdir}/mosquitto/mosquitto.conf install -d ${D}${sysconfdir}/init.d/ install -m 0755 ${WORKDIR}/mosquitto.init ${D}${sysconfdir}/init.d/mosquitto sed -i -e \u0026#39;s,@SBINDIR@,${sbindir},g\u0026#39; \\ -e \u0026#39;s,@BASE_SBINDIR@,${base_sbindir},g\u0026#39; \\ -e \u0026#39;s,@LOCALSTATEDIR@,${localstatedir},g\u0026#39; \\ -e \u0026#39;s,@SYSCONFDIR@,${sysconfdir},g\u0026#39; \\ ${D}${sysconfdir}/init.d/mosquitto } 5.6.9. ä½¿èƒ½ç³»ç»ŸæœåŠ¡ #å¦‚æœå¸Œæœ›è½¯ä»¶å®‰è£…åéšç³»ç»Ÿå¼€æœºå¯åŠ¨ï¼Œé€šå¸¸éœ€è¦ä½¿èƒ½ SysVinit æˆ– Systemd ã€‚\nå¯¹äº SysVinitæœåŠ¡ï¼Œrecipe éœ€è¦ç»§æ‰¿ update-rc.d ç±»ï¼Œå¹¶è®¾ç½®INITSCRIPT_PACKAGESã€INITSCRIPT_NAMEå’ŒINITSCRIPT_PARAMSå˜é‡ã€‚è¯¦æƒ…å‚è€ƒ https://www.yoctoproject.org/docs/3.0.4/ref-manual/ref-manual.html#ref-classes-update-rc.d ã€‚\nå¯¹äº Systemd æœåŠ¡ï¼Œé¦–å…ˆè¦ç¡®ä¿ DISTRO_FEATURES ä¸­å·²ç»åŠ å…¥äº† \u0026ldquo;systemd\u0026rdquo;ï¼Œç„¶å recipe éœ€è¦ç»§æ‰¿ systemd ç±»ã€‚è¯¦æƒ…å‚è€ƒ https://www.yoctoproject.org/docs/3.0.4/ref-manual/ref-manual.html#ref-classes-systemd ã€‚\n5.6.10. æ‰“åŒ… #å¦‚æœä½¿ç”¨äº† cmake ï¼Œè¿™ä¸€æ­¥ä¹Ÿæ˜¯è‡ªåŠ¨çš„ï¼Œå¦åˆ™éœ€è¦å†™ä¸€ä¸ª do_package å‡½æ•°ã€‚\n5.6.11 å®ä¾‹ #ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•å®ä¾‹ï¼Œç›®å½•ç»“æ„å¦‚ä¸‹ï¼š\ntest-app |---files |---helloworld.c |---CMakeLists.txt |---test-app_0.1.bb æºç ç¼–è¯‘ä½¿ç”¨äº† cmake ï¼ŒCMakeLists.txt çš„å†…å®¹ï¼š\ncmake_minimum_required(VERSION 3.1) project(test-app) add_executable(helloworld helloworld.c) install(TARGETS helloworld DESTINATION bin) æ‰€ä»¥ recipe æ–‡ä»¶éå¸¸ç®€å•ï¼š\nSUMMARY = \u0026#34;test app\u0026#34; DESCRIPTION = \u0026#34;interface test application\u0026#34; LICENSE = \u0026#34;MIT\u0026#34; LIC_FILES_CHKSUM = \u0026#34;file://${COMMON_LICENSE_DIR}/MIT;md5=0835ade698e0bcf8506ecda2f7b4f302\u0026#34; inherit cmake S = \u0026#34;${WORKDIR}\u0026#34; SRC_URI = \u0026#34;file://helloworld.c \\ file://CMakeLists.txt \u0026#34; è¿™é‡Œæºç æ–‡ä»¶åªæœ‰ä¸¤ä¸ªï¼Œæ¯”è¾ƒç®€å•ï¼Œå¦‚æœæºç å¾ˆå¤šï¼Œä¸€ä¸ªä¸ªçš„æ·»åŠ åˆ° SRC_URI éå¸¸éº»çƒ¦ï¼Œå¯ä»¥é€‰æ‹©å°†æºç æ‰“åŒ…æˆä¸€ä¸ªå‹ç¼©åŒ…ï¼Œä¾‹å¦‚ helloworld.tar.gz ï¼Œè¿˜æ˜¯æ”¾åœ¨ files ç›®å½•ä¸‹ï¼Œç„¶åç›´æ¥æ·»åŠ ï¼š\nSRC_URI = \u0026#34;file://helloworld.tar.gz;md5=0374ade698e0bcf8509ecda2f7b4f404\u0026#34; è¿™æ ·è™½ç„¶æ–¹ä¾¿ï¼Œä½†æ˜¯å‹ç¼©åŒ…æ— æ³•ç”¨ git è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ï¼Œæ‰€ä»¥ï¼Œæœ€å¥½æ˜¯åœ¨æœåŠ¡å™¨ä¸Šå»ºç«‹ git ä»“åº“ï¼Œç„¶åé€šè¿‡ git åè®®æ·»åŠ åˆ° SRC_URI ã€‚\n5.7. ä½¿ç”¨ .bbappend æ–‡ä»¶ #å°†å…ƒæ•°æ®è¿½åŠ åˆ°å¦ä¸€ä¸ª recipe çš„ recipe ç§°ä¸º BitBake append æ–‡ä»¶ã€‚ä¸€ä¸ª BitBake appendæ–‡ä»¶ä½¿ç”¨ .bbappend åç¼€ï¼Œè€Œç›¸åº”çš„é…æ–¹ä¸­çš„ Metadata è¢«é™„åŠ åˆ°çš„é…æ–¹ä½¿ç”¨ .bb æ–‡ä»¶ç±»å‹åç¼€ã€‚\nä½ å¯ä»¥åœ¨ä½ çš„å›¾å±‚ä¸­ä½¿ç”¨ .bbappend æ–‡ä»¶å¯¹å¦ä¸€ä¸ªå›¾å±‚çš„é…æ–¹å†…å®¹è¿›è¡Œæ·»åŠ æˆ–æ›´æ”¹ï¼Œè€Œä¸å¿…å°†å¦ä¸€ä¸ªå›¾å±‚çš„é…æ–¹å¤åˆ¶åˆ°ä½ çš„å›¾å±‚ä¸­ã€‚æ‚¨çš„ .bbappend æ–‡ä»¶ä½äºæ‚¨çš„å›¾å±‚ä¸­ï¼Œè€Œæ‚¨è¦é™„åŠ å…ƒæ•°æ®çš„ä¸».bbé…æ–¹æ–‡ä»¶åˆ™ä½äºå¦ä¸€ä¸ªå›¾å±‚ä¸­ã€‚\nèƒ½å¤Ÿå°†ä¿¡æ¯è¿½åŠ åˆ°ç°æœ‰çš„é…æ–¹ä¸­ï¼Œä¸ä»…é¿å…äº†é‡å¤ï¼Œè€Œä¸”è¿˜èƒ½è‡ªåŠ¨å°†ä¸åŒå±‚çš„é…æ–¹æ›´æ”¹åº”ç”¨åˆ°æ‚¨çš„å±‚ä¸­ã€‚å¦‚æœä½ æ˜¯å¤åˆ¶é…æ–¹ï¼Œä½ å°†ä¸å¾—ä¸åœ¨å‘ç”Ÿå˜åŒ–æ—¶æ‰‹åŠ¨åˆå¹¶ã€‚\nå½“ä½ åˆ›å»ºä¸€ä¸ªè¿½åŠ æ–‡ä»¶æ—¶ï¼Œä½ å¿…é¡»ä½¿ç”¨ä¸å¯¹åº”çš„é…æ–¹æ–‡ä»¶ç›¸åŒçš„æ ¹åã€‚ä¾‹å¦‚ï¼Œè¿½åŠ æ–‡ä»¶ someapp_3.1.2.bbappend å¿…é¡»åº”ç”¨åˆ° someapp_3.1.2.bbã€‚è¿™æ„å‘³ç€åŸå§‹é…æ–¹å’Œè¿½åŠ æ–‡ä»¶çš„åç§°æ˜¯é’ˆå¯¹ç‰ˆæœ¬å·çš„ã€‚å¦‚æœé‡å‘½åç›¸åº”çš„é…æ–¹ä»¥æ›´æ–°åˆ°è¾ƒæ–°çš„ç‰ˆæœ¬ï¼Œä½ ä¹Ÿå¿…é¡»é‡å‘½åå¹¶å¯èƒ½æ›´æ–°ç›¸åº”çš„.bbappendã€‚åœ¨æ„å»ºè¿‡ç¨‹ä¸­ï¼Œå¦‚æœ BitBake æ£€æµ‹åˆ°ä¸€ä¸ª .bbappend æ–‡ä»¶ï¼Œè€Œè¯¥æ–‡ä»¶æ²¡æœ‰å¯¹åº”çš„é…æ–¹ä¸åç§°ç›¸åŒ¹é…ï¼Œåˆ™ä¼šåœ¨å¯åŠ¨æ—¶æ˜¾ç¤ºä¸€ä¸ªé”™è¯¯ã€‚è¯·å‚é˜… BB_DANGLINGAPPENDS_WARNONLY å˜é‡ï¼Œäº†è§£å¦‚ä½•å¤„ç†è¿™ä¸ªé”™è¯¯ã€‚\nä»¥ formfactor_0.0.bb ä¸ºä¾‹ï¼Œä½äºmeta/recipes-bsp/formfactor ï¼š\nSUMMARY = \u0026#34;Device formfactor information\u0026#34; SECTION = \u0026#34;base\u0026#34; LICENSE = \u0026#34;MIT\u0026#34; LIC_FILES_CHKSUM = \u0026#34;file://${COREBASE}/meta/COPYING.MIT;md5=3da9cfbcb788c80a0384361b4de20420\u0026#34; PR = \u0026#34;r45\u0026#34; SRC_URI = \u0026#34;file://config file://machconfig\u0026#34; S = \u0026#34;${WORKDIR}\u0026#34; PACKAGE_ARCH = \u0026#34;${MACHINE_ARCH}\u0026#34; INHIBIT_DEFAULT_DEPS = \u0026#34;1\u0026#34; do_install() { # Install file only if it has contents install -d ${D}${sysconfdir}/formfactor/ install -m 0644 ${S}/config ${D}${sysconfdir}/formfactor/ if [ -s \u0026#34;${S}/machconfig\u0026#34; ]; then install -m 0644 ${S}/machconfig ${D}${sysconfdir}/formfactor/ fi } åœ¨ recipe ä¸­ï¼Œæ³¨æ„ SRC_URI å˜é‡ï¼Œå®ƒå‘Šè¯‰ OpenEmbedded æ„å»ºç³»ç»Ÿåœ¨æ„å»ºè¿‡ç¨‹ä¸­åœ¨å“ªé‡Œæ‰¾åˆ°æ–‡ä»¶ã€‚ä¸‹é¢æ˜¯ append æ–‡ä»¶ï¼Œåä¸º formfactor_0.0.bbappend ï¼Œæ¥è‡ªmeta-raspberrypi/recipes-bsp/formfactor :\nFILESEXTRAPATHS_prepend := \u0026#34;${THISDIR}/${PN}:\u0026#34; é»˜è®¤æƒ…å†µä¸‹ï¼Œæ„å»ºç³»ç»Ÿä½¿ç”¨ FILESPATH å˜é‡æ¥å®šä½æ–‡ä»¶ã€‚è¿™ä¸ª append æ–‡ä»¶é€šè¿‡è®¾ç½® FILESEXTRAPATHS å˜é‡æ¥æ‰©å±•è¿™äº›ä½ç½®ã€‚åœ¨ .bbappend æ–‡ä»¶ä¸­è®¾ç½®è¿™ä¸ªå˜é‡æ˜¯å°†ç›®å½•æ·»åŠ åˆ°æ„å»ºç³»ç»Ÿç”¨æ¥æŸ¥æ‰¾æ–‡ä»¶çš„æœç´¢è·¯å¾„ä¸­çš„æœ€å¯é å’Œæœ€æ¨èçš„æ–¹æ³•ã€‚\næœ¬ä¾‹ä¸­çš„è¯­å¥å°†ç›®å½•æ‰©å±•ä¸ºåŒ…æ‹¬ ${THISDIR}/${PN}ï¼Œå®ƒçš„è§£æç»“æœæ˜¯åœ¨ append æ–‡ä»¶æ‰€åœ¨çš„åŒä¸€ç›®å½•ä¸‹çš„ä¸€ä¸ªåä¸º formfactor çš„ç›®å½•ï¼ˆå³ meta-raspberrypi/recipes-bsp/formfactor ï¼‰ã€‚è¿™æ„å‘³ç€ä½ å¿…é¡»è®¾ç½®å¥½æ”¯æŒçš„ç›®å½•ç»“æ„ï¼Œå®ƒå°†åŒ…å«ä½ å°†ä»å±‚ä¸­åŒ…å«çš„ä»»ä½•æ–‡ä»¶æˆ–è¡¥ä¸ã€‚\nä½¿ç”¨ç«‹å³æ‰©å±•èµ‹å€¼è¿ç®—ç¬¦ := æ˜¯å¾ˆé‡è¦çš„ï¼Œå› ä¸ºå®ƒå¼•ç”¨äº† thisdir ã€‚å°¾éƒ¨çš„å†’å·å­—ç¬¦å¾ˆé‡è¦ï¼Œå› ä¸ºå®ƒç¡®ä¿åˆ—è¡¨ä¸­çš„é¡¹ç›®ä¿æŒå†’å·åˆ†éš”ã€‚\næ³¨æ„ï¼ŒBitBake ä¼šè‡ªåŠ¨å®šä¹‰ THISDIR å˜é‡ï¼Œä½ ä¸åº”è¯¥è‡ªå·±è®¾ç½®è¿™ä¸ªå˜é‡ã€‚ä½¿ç”¨\u0026rdquo;_prepend \u0026ldquo;ä½œä¸º FILESEXTRAPATHS çš„ä¸€éƒ¨åˆ†ï¼Œå¯ä»¥ç¡®ä¿ä½ çš„è·¯å¾„ä¼šåœ¨æœ€ç»ˆåˆ—è¡¨ä¸­çš„å…¶ä»–è·¯å¾„ä¹‹å‰è¢«æœç´¢åˆ°ã€‚å¦å¤–ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„è¿½åŠ æ–‡ä»¶éƒ½ä¼šæ·»åŠ é¢å¤–çš„æ–‡ä»¶ã€‚å¾ˆå¤š append æ–‡ä»¶åªæ˜¯ä¸ºäº†æ·»åŠ æ„å»ºé€‰é¡¹è€Œå­˜åœ¨ï¼ˆä¾‹å¦‚systemdï¼‰ã€‚å¯¹äºè¿™äº›æƒ…å†µï¼Œä½ çš„ append æ–‡ä»¶ç”šè‡³ä¸ä¼šä½¿ç”¨ FILESEXTRAPATHS è¯­å¥ã€‚\n6. Yocto å†…æ ¸å¼€å‘ #å‚è€ƒï¼šLinux Kernel Development Manualã€‚è¿›è¡Œå¼€å‘å·¥ä½œä¹‹å‰ï¼Œéƒ½è¦åˆå§‹åŒ–å¼€å‘ç¯å¢ƒï¼š\nsource setup-environment imx6ullevk-fb/ æ–°å»ºä¸€ä¸ª layer ï¼Œç”¨äºå¼€å‘ï¼Œè®°å¾—æŠŠå®ƒæ·»åŠ åˆ° conf/bblayers.conf ä¾‹å¦‚ï¼š\nbitbake-layers create-layer meta-mylayer bitbake-layers add-layer meta-mylayer ç„¶ååœ¨ meta-mylayer ä¸‹æ–°å»ºä¸€ä¸ª recipes-kernel æ–‡ä»¶å¤¹ï¼Œç”¨äºå­˜æ”¾å†…æ ¸å¼€å‘ç›¸å…³çš„ append å’Œ recipe ã€‚\n6.1. ä¿®æ”¹å†…æ ¸æºç  #å¯¹å†…æ ¸æºç çš„ä¿®æ”¹æ˜¯é€šè¿‡ append æ–‡ä»¶ï¼Œä½¿ç”¨è¡¥ä¸æ–‡ä»¶çš„å½¢å¼æ·»åŠ ä¿®æ”¹å†…å®¹ã€‚\né¦–å…ˆéœ€è¦æ–°å»º appendæ–‡ä»¶ ã€‚å†…æ ¸çš„ recipe æ–‡ä»¶æ˜¯ linux-imx_5.4.bb ï¼Œæ‰€ä»¥è¦æ–°å»ºå¦‚ä¸‹ç›®å½•å’Œæ–‡ä»¶ï¼š\nmeta-mylayer/recipes-kernel/linux/ meta-mylayer/recipes-kernel/linux/linux-imx/ meta-mylayer/recipes-kernel/linux/linux-imx_5.4.bbappend åœ¨ .bbappend æ–‡ä»¶ä¸­æ·»åŠ \nFILESEXTRAPATHS_prepend := \u0026#34;${THISDIR}/${PN}:\u0026#34; æ„å»ºæ—¶ï¼Œ${THISDIR}/${PN} ä¼šè¢«æ›¿æ¢ä¸º meta-mylayer/recipes-kernel/linux/linux-imx ï¼Œæ„å»ºç³»ç»Ÿä¼šåˆ°è¯¥è·¯å¾„ä¸‹æœç´¢è¡¥ä¸æ–‡ä»¶ã€‚\nç„¶åéœ€è¦è·å–æˆ–è€…åˆ¶ä½œè¡¥ä¸ã€‚ä»¥ä¿®æ”¹ calibrate.c æ–‡ä»¶æ·»åŠ å†…æ ¸æ‰“å°ä¿¡æ¯ä¸ºä¾‹ï¼Œå…ˆè¿›å…¥å†…æ ¸æºç ç›®å½• /tmp/work/imx6ull14x14evk-poky-linux-gnueabi/linux-imx/5.4-r0/git ï¼Œç¼–è¾‘ init/calibrate.c æ–‡ä»¶çš„ calibrate_delay() å‡½æ•°ï¼Œæ·»åŠ å¦‚ä¸‹ printk å‡½æ•°ï¼š\nvoid calibrate_delay(void) { unsigned long lpj; static bool printed; int this_cpu = smp_processor_id(); printk(\u0026#34;*************************************\\n\u0026#34;); printk(\u0026#34;* *\\n\u0026#34;); printk(\u0026#34;* HELLO YOCTO KERNEL *\\n\u0026#34;); printk(\u0026#34;* *\\n\u0026#34;); printk(\u0026#34;*************************************\\n\u0026#34;); if (per_cpu(cpu_loops_per_jiffy, this_cpu)) { ... ä½¿ç”¨ git å‘½ä»¤æäº¤å˜æ›´å¹¶ç”Ÿæˆè¡¥ä¸ï¼š\n$ git add init/calibrate.c $ git commit -m \u0026#34;calibrate.c - Added some printk statements\u0026#34; $ git format-patch -1 0001-calibrate.c-Added-some-printk-statements.patch æŠŠç”Ÿæˆçš„è¡¥ä¸æ–‡ä»¶æ”¾åˆ° meta-mylayer/recipes-kernel/linux/linux-imx/ è·¯å¾„ä¸‹ï¼Œå¹¶åœ¨ .bbappend æ–‡ä»¶ä¸­æ·»åŠ ï¼š\nSRC_URI_append = \u0026#34; file://0001-calibrate.c-Added-some-printk-statements.patch\u0026#34; æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå…ˆæ¸…ç©ºå†…æ ¸ç¼–è¯‘ç›®å½•ï¼Œç„¶åé‡æ–°æ‰“è¡¥ä¸ï¼š\n$ bitbake linux-imx -c clean $ bitbake linux-imx -c patch ç„¶åæŸ¥çœ‹æ‰“è¿‡è¡¥ä¸çš„æºç ï¼Œç¡®è®¤è¡¥ä¸å·²ç»ç”Ÿæ•ˆï¼Œå³å¯æ‰§è¡Œç¼–è¯‘ï¼š\n$ bitbake linux-imx 6.2. ä¿®æ”¹å†…æ ¸é…ç½® #æºç å‡†å¤‡å®Œæ¯•åï¼Œbitbake ä¼šç»§ç»­æ‰§è¡Œé…ç½®å·¥ä½œï¼Œå¦‚æœè¦ä¿®æ”¹é…ç½®ï¼Œéœ€è¦æ‰‹åŠ¨æ‰§è¡Œ menuconfig ï¼š\n$ bitbake linux-imx -c menuconfig è¿™ä¸€æ­¥å°±æ˜¯æ‰§è¡Œå†…æ ¸ç¼–è¯‘æ—¶çš„ make menuconfig æ“ä½œï¼Œä¼šæ‰“å¼€ä¸€ä¸ªäº¤äº’ç•Œé¢ï¼Œåœ¨è¿™é‡Œä¿®æ”¹é…ç½®ï¼š\nè¿™é‡Œçš„é…ç½®æ¥è‡ªäºç¼–è¯‘ç›®å½•ä¸‹çš„ .config æ–‡ä»¶ï¼Œå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡ç¼–è¯‘ï¼Œè¿™ä¸ªæ–‡ä»¶å°±æ˜¯å†…æ ¸æºç çš„ arch/arm/conifg ç›®å½•çš„æŸä¸ª defconfig æ–‡ä»¶çš„æ‹·è´ï¼Œå…·ä½“æ˜¯å“ªä¸ªæ–‡ä»¶ï¼Œé€šå¸¸æ˜¯åœ¨ recipe æ–‡ä»¶çš„ do_config ä»»åŠ¡ä¸­æœ‰è¯´æ˜ã€‚\nåœ¨ menuconfig ä¸­ä¿®æ”¹å®Œæ¯•åï¼Œä¿å­˜å¹¶æ¨å‡ºã€‚åœ¨ç¼–è¯‘ç›®å½• tmp/work/imx6ull14x14evk-poky-linux-gnueabi/linux-imx/5.4-r0/build/ ä¸‹é¢ä¼šç”Ÿæˆæ›´æ–°åçš„ .config æ–‡ä»¶ï¼ŒåŸæœ‰çš„ .config è¢«é‡å‘½åä¸º .config.old ã€‚ç„¶åè°ƒç”¨ diffconfig é€‰é¡¹ç”Ÿæˆä¸€ä¸ªé…ç½®ç‰‡æ®µï¼š\nbitbake linux-imx -c diffconfig è¿™ä¸€æ­¥å°±æ˜¯å¯¹æ¯” .config å’Œ .config.old çš„åŒºåˆ«ï¼Œç¡®å®šä¿®æ”¹çš„å†…å®¹ï¼Œç”Ÿæˆä¸€ä¸ªè¡¥ä¸æ–‡ä»¶ï¼Œç§°ä¹‹ä¸ºé…ç½®ç‰‡æ®µï¼Œç”Ÿæˆçš„æ–‡ä»¶ä½äºå†…æ ¸æ„å»ºç›®å½•ä¸‹çš„ fragment.cfg ã€‚æˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªæ–‡ä»¶å¤åˆ¶åˆ° meta-mylayer/recipes-kernel/linux/linux-imx/ ç›®å½•ä¸‹ï¼Œç„¶ååœ¨ linux-imx_5.4.bbappend æ–‡ä»¶ä¸­æ·»åŠ ï¼š\nSRC_URI += \u0026#34;file://fragment.cfg\u0026#34; æœ€å¥½ä¸º fragment.cfg æ›´æ”¹ä¸€ä¸ªæœ‰æ„ä¹‰çš„æ–‡ä»¶åï¼Œå› ä¸ºé€šå¸¸ä¼šä½¿ç”¨å¤šä¸ªé…ç½®ç‰‡æ®µæ¥æ·»åŠ ä¸åŒç±»å‹çš„ä¿®æ”¹å†…å®¹ã€‚\nåœ¨ç¼–è¯‘å‰ï¼Œå¯ä»¥è°ƒç”¨ kernel_configcheck é€‰é¡¹æ£€æŸ¥å†…æ ¸é…ç½®æ˜¯å¦æ­£ç¡®ï¼š\nbitbake linux-imx -c kernel_configcheck åœ¨æŸäº›æ—§ç‰ˆæœ¬é‡Œï¼Œå†…æ ¸çš„ recipe å­˜åœ¨ bugï¼Œæ— æ³•åˆå¹¶é…ç½®ç‰‡æ®µï¼Œå¯ä»¥å‚è€ƒå¦‚ä¸‹æ–¹æ³•è§£å†³ã€‚\nLinux å†…æ ¸æºç çš„ /scripts/kconfig/merge_config.sh è„šæœ¬æä¾›äº†åˆå¹¶é…ç½®ç‰‡æ®µçš„åŠŸèƒ½ï¼Œè¯­æ³•ï¼š\n$ ./merge_config.sh -h Usage: ./merge_config.sh [OPTIONS] [CONFIG [...]] -h display this help text -m only merge the fragments, do not execute the make command -n use allnoconfig instead of alldefconfig -r list redundant entries when merging fragments -y make builtin have precedence over modules -O dir to put generated output files. Consider setting $KCONFIG_CONFIG instead. Used prefix: \u0026#39;CONFIG_\u0026#39;. You can redefine it with $CONFIG_ environment variable. æˆ‘ä»¬å¯ä»¥åœ¨ linux-imx çš„ .bbappend æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ªä»»åŠ¡ï¼Œè®©å®ƒåœ¨ç¼–è¯‘å‰åˆ©ç”¨ merge_config.sh è„šæœ¬åˆå¹¶é…ç½®ç‰‡æ®µï¼š\ndo_merge_fragment() { if [ -f ${WORKDIR}/fragment.cfg ]; then ${S}/scripts/kconfig/merge_config.sh -m ${B}/.config ${WORKDIR}/fragment.cfg mv .config ${B}/.config fi } addtask merge_fragment before do_compile after do_configure 6.3. ç¼–è¯‘å¤–éƒ¨é©±åŠ¨ #å¯¹äºæ¥è‡ªå†…æ ¸æºç æ ‘ä¹‹å¤–çš„é©±åŠ¨ï¼Œå¯ä»¥é€šè¿‡æ–°å»º recipe çš„æ–¹å¼è¿›è¡Œç¼–è¯‘ã€‚ä»¥ sources/poky/meta-skeleton/recipes-kernel/hello-mod/hello-mod_0.1.bb ä¸ºä¾‹ï¼š\nSUMMARY = \u0026#34;Example of how to build an external Linux kernel module\u0026#34; LICENSE = \u0026#34;GPLv2\u0026#34; LIC_FILES_CHKSUM = \u0026#34;file://COPYING;md5=12f884d2ae1ff87c09e5b7ccc2c4ca7e\u0026#34; inherit module SRC_URI = \u0026#34;file://Makefile \\ file://hello.c \\ file://COPYING \\ \u0026#34; S = \u0026#34;${WORKDIR}\u0026#34; RPROVIDES_${PN} += \u0026#34;kernel-module-hello\u0026#34; å¯ä»¥æŠŠè¿™ä¸ªæ–‡ä»¶å¤åˆ¶åˆ° meta-mylayer/recipes-kernel/ ä¸‹çš„ç›¸åº”æ–‡ä»¶å¤¹é‡Œï¼Œæ›´æ”¹ä¸€ä¸ªæœ‰æ„ä¹‰çš„åå­—ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹ã€‚\n7. Yocto åº”ç”¨å¼€å‘ #Yocto çš„åº”ç”¨å¼€å‘æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯åœ¨ yocto é¡¹ç›®å†…æ–°å»º recipe ï¼Œå¦ä¸€ç§æ˜¯å¯¼å‡º SDK ï¼Œç„¶åä½¿ç”¨ SDK ç‹¬ç«‹å¼€å‘åº”ç”¨è½¯ä»¶ï¼Œç¬¬äºŒç§æ›´æ–¹ä¾¿ä¸€ç‚¹ã€‚\n7.1. å®‰è£… SDK #æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œç”Ÿæˆæ‰©å±• SDK å®‰è£…è„šæœ¬ï¼š\n~/imx-yocto-bsp-5.4.47/imx6ullevk-fb$ bitbake imx-image-multimedia -c populate_sdk ç”Ÿæˆçš„è„šæœ¬ä½äº tmp/deploy/sdk ç›®å½•ä¸‹ï¼Œæ‰§è¡Œè¿™ä¸ªè„šæœ¬å³å¯å®‰è£…ï¼š\n~/imx-yocto-bsp-5.4.47/imx6ullevk-fb$ cd tmp/deploy/sdk/ ~/imx-yocto-bsp-5.4.47/imx6ullevk-fb/tmp/deploy/sdk$ ./fsl-imx-fb-glibc-x86_64-imx-image-multimedia-cortexa7t2hf-neon-imx6ull14x14evk-toolchain-5.4-zeus.sh é»˜è®¤å®‰è£…åœ¨ /opt ç›®å½•ä¸‹ã€‚ä¹Ÿå¯ä»¥æŠŠè¿™ä¸ªè„šæœ¬å¤åˆ¶åˆ°å…¶ä»–ä¸»æœºä¸­æ‰§è¡Œã€‚å‚è€ƒï¼šUsing the Standard SDK\n","date":"2020 December 12","permalink":"/posts/2020/12/12/","section":"Posts","summary":"1. æ¦‚è¿° #NXP ä¸ºå®˜æ–¹è¯„ä¼°æ¿ i.","title":"åœ¨ i.MX 6ULL ä¸Šå­¦ä¹  Yocto"},{"content":"# 1. å®‰è£… #Docker çš„å®‰è£…æ¯”è¾ƒç®€å•ï¼Œè®¿é—® \u0026lt;www.docker.com\u0026gt; ï¼ŒæŒ‰ç…§æŒ‡å¼•å®‰è£…ç›¸åº”ç³»ç»Ÿçš„ç‰ˆæœ¬å³å¯ã€‚å®‰è£…å®Œæ¯•åï¼Œæˆ‘ä»¬å…ˆæ‹‰å– Redis çš„é•œåƒï¼š\n$ docker pull redis è¿™ä¸ªå‘½ä»¤é»˜è®¤æ˜¯æ‹‰å– Redis å®˜æ–¹çš„ Docker é•œåƒæœ€æ–°ç‰ˆï¼Œä¹Ÿå¯ä»¥åœ¨åé¢æŒ‡å®šå…·ä½“çš„ç‰ˆæœ¬ï¼š\n$ docker images REPOSITORY TAG IMAGE ID CREATED SIZE docker101tutorial latest 8e9d20f8bd52 38 hours ago 27.3MB nginx alpine 6f715d38cfe0 2 weeks ago 22.1MB nginx latest 4bb46517cac3 2 weeks ago 133MB python alpine 44fceb565b2a 2 weeks ago 42.7MB redis latest 1319b1eaa0b7 3 weeks ago 104MB node 12-alpine 18f4bc975732 4 weeks ago 89.3MB ç„¶åå¯åŠ¨è¿™ä¸ªè¿›è¡Œå®¹å™¨:\n$ docker run -itd --name redis -p 6379:6379 redis $ docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES f0b825b877b8 redis \u0026#34;docker-entrypoint.sâ€¦\u0026#34; 1 hours ago Up Up 9 seconds 0.0.0.0:6379-\u0026gt;6379/tcp redis æœ€åï¼Œè¿›å…¥å®¹å™¨ï¼Œä½¿ç”¨ redis-cli å‘½ä»¤è¿æ¥ Redis ï¼š\n$ docker exec -it redis redis-cli 127.0.0.1:6379\u0026gt; ping PONG 127.0.0.1:6379\u0026gt; exit ","date":"2020 September 1","permalink":"/posts/2020/09/01/","section":"Posts","summary":"# 1.","title":"ä½¿ç”¨ Docker å­¦ä¹  Redis"},{"content":"1. å·¥ä½œåŸç† #epoll æ˜¯ Linux ç‹¬æœ‰çš„ I/O å¤šè·¯å¤ç”¨æœºåˆ¶ï¼Œæ ¸å¿ƒæ¦‚å¿µå°±æ˜¯ epoll å®ä¾‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªå†…æ ¸é‡Œçš„æ•°æ®ç»“æ„ï¼Œä»ç”¨æˆ·è§’åº¦æ¥çœ‹å®ƒå¯ä»¥ç®€å•çš„çœ‹åšåŒ…å«äº†ä¸¤ä¸ªé˜Ÿåˆ—ï¼š\ninterest listï¼ˆæˆ–è€…å«epoll setï¼‰ï¼Œç”¨æˆ·æ³¨å†Œçš„æ„Ÿå…´è¶£çš„æè¿°ç¬¦é›†åˆã€‚ ready listï¼Œå°±ç»ªçš„æè¿°ç¬¦é›†åˆï¼Œå½“æœ‰ I/O å°±ç»ªæ—¶ï¼Œå†…æ ¸ä¼šè‡ªåŠ¨å°†å°±ç»ªçš„æè¿°ç¬¦åŠ åˆ° ready list ä¸­ã€‚ åœ¨ç”¨æˆ·ç«¯çš„å·¥ä½œæµç¨‹å°±æ˜¯ï¼š\nå‘ interest list æ³¨å†Œæ„Ÿå…´è¶£çš„æ–‡ä»¶æè¿°ç¬¦çš„ I/O äº‹ä»¶ã€‚ ç­‰å¾…å·²æ³¨å†Œçš„æ–‡ä»¶æè¿°ç¬¦å°±ç»ªã€‚ å¤„ç†æ‰€æœ‰å·²ç»å°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦ã€‚ 2. ä½¿ç”¨æ–¹æ³• #ä½¿ç”¨ epoll æ—¶ï¼Œéœ€è¦åŒ…æ‹¬å¤´æ–‡ä»¶ï¼š\n#include \u0026lt;sys/epoll.h\u0026gt; 2.1 æ–°å»ºä¸€ä¸ª epoll å®ä¾‹ #int epoll_create(int size); epoll_create() å‡½æ•°ä¼šæ–°å»ºä¸€ä¸ª epoll å®ä¾‹ï¼Œç„¶åè¿”å›ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œä½œä¸º epoll æ“ä½œçš„å¥æŸ„ã€‚ä» Linux 2.6.8 å¼€å§‹ï¼Œ å‚æ•° size å¯ä»¥å¿½ç•¥ï¼Œä½†æ˜¯å¿…é¡»å¤§äº 0 ã€‚å½“ä¸åœ¨éœ€è¦è¿™ä¸ªæè¿°ç¬¦æ—¶ï¼Œåº”è¯¥è°ƒç”¨ close() å‡½æ•°å°†å…¶å…³é—­ã€‚\nè°ƒç”¨å¤±è´¥æ—¶ï¼Œä¼šè¿”å›ä¸€ä¸ªè´Ÿæ•°ã€‚\n2.2 æ“ä½œ epoll å®ä¾‹ #int epoll_ctl(int epfd, int op, int fd, struct epoll_event *event); è¿™æ˜¯æ“ä½œ epoll å®ä¾‹çš„æ¥å£å‡½æ•°ï¼Œç”¨äºæ·»åŠ ã€åˆ é™¤å’Œä¿®æ”¹ interest list ä¸­ç›‘æ§çš„æ–‡ä»¶æè¿°ç¬¦ã€‚å¦‚æœè°ƒç”¨æˆåŠŸï¼Œä¼šè¿”å› 0 ï¼Œå¦‚æœå¤±è´¥ï¼Œä¼šè¿”å›ä¸€ä¸ªè´Ÿæ•°ï¼Œå¹¶è®¾ç½® errno ã€‚å‚æ•°çš„å«ä¹‰ï¼š\nç¬¬ä¸€ä¸ªå‚æ•° epfd å°±æ˜¯ epoll_create() å‡½æ•°è¿”å›çš„æ–‡ä»¶æè¿°ç¬¦ã€‚ ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºæ“ä½œç±»å‹ï¼Œå¯é€‰ï¼š EPOLL_CTL_ADDï¼Œå°† fd æ·»åŠ åˆ° epfd çš„ interest list ä¸­ã€‚ EPOLL_CTL_MODï¼Œä» interest list ä¸­åˆ é™¤ fd ã€‚ EPOLL_CTL_DELï¼Œä¿®æ”¹ fd çš„ç›‘è§†äº‹ä»¶ã€‚ ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯éœ€è¦ç›‘å¬çš„æ–‡ä»¶æè¿°ç¬¦ã€‚ ç¬¬å››ä¸ªå‚æ•°æ˜¯éœ€è¦ç›‘å¬çš„äº‹ä»¶ã€‚ ç›‘è§†çš„äº‹ä»¶é€šè¿‡ struct epoll_event ç»“æ„ä½“è®¾ç½®ï¼š\ntypedef union epoll_data { void *ptr; int fd; uint32_t u32; uint64_t u64; } epoll_data_t; struct epoll_event { uint32_t events; /* Epoll events */ epoll_data_t data; /* User data variable */ }; ç»“æ„æˆå‘˜ data ç”±å†…æ ¸è´Ÿè´£ä¿®æ”¹ï¼Œå½“ç›‘è§†çš„æ–‡ä»¶æè¿°ç¬¦å‡†å¤‡å°±ç»ªæ—¶è¿”å›ã€‚ç»“æ„æˆå‘˜ event ç”¨äºè®¾ç½®ç›‘è§†çš„äº‹ä»¶ç±»å‹ï¼Œæ˜¯ä¸€ä¸ªæšä¸¾çš„é›†åˆï¼Œå¯ä»¥ç”¨ | æ¥å¢åŠ å¤šç§äº‹ä»¶ç±»å‹ï¼Œæšä¸¾å¦‚ä¸‹ï¼š\nEPOLLIN è¡¨ç¤ºå…³è”çš„ fd å¯ä»¥è¿›è¡Œè¯»æ“ä½œäº†ã€‚ EPOLLOUT è¡¨ç¤ºå…³è”çš„ fd å¯ä»¥è¿›è¡Œå†™æ“ä½œäº†ã€‚ EPOLLRDHUP(since Linux 2.6.17) è¡¨ç¤ºå¥—æ¥å­—å…³é—­äº†è¿æ¥ï¼Œæˆ–è€…å…³é—­äº†æ­£å†™ä¸€åŠçš„è¿æ¥ã€‚ EPOLLPRI è¡¨ç¤ºå…³è”çš„ fd æœ‰ç´§æ€¥ä¼˜å…ˆäº‹ä»¶å¯ä»¥è¿›è¡Œè¯»æ“ä½œäº†ã€‚ EPOLLERR è¡¨ç¤ºå…³è”çš„fdå‘ç”Ÿäº†é”™è¯¯ï¼Œepoll_wait() ä¼šä¸€ç›´ç­‰å¾…è¿™ä¸ªäº‹ä»¶ï¼Œæ‰€ä»¥ä¸€èˆ¬æ²¡å¿…è¦è®¾ç½®è¿™ä¸ªå±æ€§ã€‚ EPOLLHUP è¡¨ç¤ºå…³è”çš„fdæŒ‚èµ·äº†ï¼Œepoll_wait() ä¼šä¸€ç›´ç­‰å¾…è¿™ä¸ªäº‹ä»¶ï¼Œæ‰€ä»¥ä¸€èˆ¬æ²¡å¿…è¦è®¾ç½®è¿™ä¸ªå±æ€§ã€‚ EPOLLET è®¾ç½®å…³è”çš„fdä¸ºETçš„å·¥ä½œæ–¹å¼ï¼Œepoll çš„é»˜è®¤å·¥ä½œæ–¹å¼æ˜¯LTã€‚ EPOLLONESHOT (since Linux 2.6.2) è®¾ç½®å…³è”çš„ fd ä¸º one-shot çš„å·¥ä½œæ–¹å¼ã€‚è¡¨ç¤ºåªç›‘å¬ä¸€æ¬¡äº‹ä»¶ï¼Œå¦‚æœè¦å†æ¬¡ç›‘å¬ï¼Œéœ€è¦æŠŠ socket æ”¾å…¥åˆ° epoll é˜Ÿåˆ—ä¸­ã€‚ 2.3 ç­‰å¾… I/O äº‹ä»¶ #int epoll_wait(int epfd, struct epoll_event *events, int maxevents, int timeout); epoll_wait() ç”¨äºç­‰å¾…ç›‘è§†çš„ I/O äº‹ä»¶å°±ç»ªï¼Œä¹Ÿå°±æ˜¯è¿”å› ready list ä¸­çš„æ–‡ä»¶æè¿°ç¬¦ ã€‚è°ƒç”¨åï¼Œå‡½æ•°å¼€å§‹é˜»å¡ï¼Œç›´åˆ°ï¼š\nä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦è§¦å‘äº†ä¸€ä¸ªç›‘è§†çš„äº‹ä»¶ã€‚ è¢«ä¿¡å·ä¸­æ–­ã€‚ è¶…æ—¶æ—¶é—´åˆ°ã€‚ å·²ç»å°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦ä¼šå†™å…¥ events æŒ‡å‘çš„ç¼“å­˜ï¼Œè¿™æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ è®°å½•äº†ä¸€ä¸ªå°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦çš„ä¿¡æ¯ã€‚maxevents ç”¨äºå‘Šè¯‰å†…æ ¸ä¸€æ¬¡æœ€å¤šè¿”å›å¤šå°‘ä¸ªå·²ç»å°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¿™ä¸ªå€¼å¿…é¡»å¤§äº 0 ï¼Œä½†ä¸è¦å¤§äºå·²ç»æ³¨å†Œçš„æ–‡ä»¶æè¿°ç¬¦çš„ä¸ªæ•°ã€‚timeout è®¾ç½®äº†ç­‰å¾…è¶…æ—¶ï¼Œå•ä½æ˜¯æ¯«ç§’ï¼Œ0 è¡¨ç¤ºç«‹å³è¿”å›ï¼Œå¦‚æœè®¾ä¸º -1 ï¼Œè¡¨ç¤ºæ°¸ä¹…ç­‰å¾…ã€‚\nå¦‚æœè°ƒç”¨æˆåŠŸï¼Œè¿”å›å€¼å°±æ˜¯å·²ç»å°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦çš„æ•°é‡ï¼Œå¦‚æœè¿”å›å€¼æ˜¯ 1ï¼Œé‚£ events æ•°å­—çš„é•¿åº¦ä¹Ÿåªæœ‰ ã€‚å¤±è´¥ä¼šè¿”å›ä¸€ä¸ªè´Ÿæ•°ã€‚\n3. ä¾‹ç¨‹ #å‚è€ƒ # å½»åº•ç†è§£ I/O å¤šè·¯å¤ç”¨ epoll çš„è¿è¡Œæœºåˆ¶ epoll_create epoll_ctl ","date":"2020 August 30","permalink":"/posts/2020/08/30/","section":"Posts","summary":"1. å·¥ä½œåŸç† #epoll æ˜¯ Linux ç‹¬æœ‰çš„ I/O å¤šè·¯å¤ç”¨æœºåˆ¶ï¼Œæ ¸å¿ƒæ¦‚å¿µå°±æ˜¯ epoll å®ä¾‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªå†…æ ¸é‡Œçš„æ•°æ®ç»“æ„ï¼Œä»ç”¨æˆ·è§’åº¦æ¥çœ‹å®ƒå¯ä»¥ç®€å•çš„çœ‹åšåŒ…å«äº†ä¸¤ä¸ªé˜Ÿåˆ—ï¼š","title":"epoll å­¦ä¹ ç¬”è®°"},{"content":"uthash æ˜¯ä¸€ä¸ª C è¯­è¨€çš„å“ˆå¸Œè¡¨å‡½æ•°åº“ï¼Œæ”¯æŒå“ˆå¸Œè¡¨çš„å„ç§æ“ä½œï¼ŒåŒ…æ‹¬æ·»åŠ ï¼Œåˆ é™¤ï¼ŒæŸ¥æ‰¾ï¼Œæ’åºç­‰ã€‚ä½ å¯ä»¥åœ¨ github ä¸Šä¸‹è½½åˆ°å®ƒçš„æºç ï¼š\næºç ï¼šhttps://github.com/troydhanson/uthash æ–‡æ¡£ï¼šhttps://troydhanson.github.io/uthash/userguide.html è¿™ä¸ªå‡½æ•°åº“åœ¨ä½¿ç”¨æ—¶åªéœ€è¦åŒ…å« uthash.h å¤´æ–‡ä»¶å³å¯ï¼Œæ²¡æœ‰äºŒè¿›åˆ¶çš„åº“æ–‡ä»¶ã€‚\n1. æ•°æ®ç»“æ„ #uthash çš„å“ˆå¸Œè¡¨æ˜¯ç”±å¤šä¸ªç»“æ„ä½“ç»„æˆçš„åŒå‘é“¾è¡¨å®ç°çš„ï¼Œä¸€ä¸ªç»“æ„ä½“å°±æ˜¯ä¸€ä¸ªé”®å€¼å¯¹ï¼Œä¾‹å¦‚ï¼š\n#include \u0026#34;uthash.h\u0026#34; struct my_struct { int id; /* key */ char name[10]; UT_hash_handle hh; /* makes this structure hashable */ }; id å°±æ˜¯é”®ï¼ˆkeyï¼‰ï¼Œåç§°å’Œæ•°æ®ç±»å‹æ²¡æœ‰é™åˆ¶ï¼› name å°±æ˜¯å€¼ï¼ˆvalueï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯ä»»ä½•æ•°æ®ç±»å‹ï¼› hh æ˜¯å†…éƒ¨ä½¿ç”¨çš„ hash å¤„ç†å¥æŸ„ï¼ŒUT_hash_handle å­—æ®µå¿…é¡»å­˜åœ¨äºä½ çš„ç»“æ„ä¸­ã€‚å®ƒç”¨äºå†…éƒ¨è®°å½•ï¼Œä½¿å“ˆå¸Œè¡¨æ­£å¸¸å·¥ä½œï¼Œå®ƒä¸éœ€è¦åˆå§‹åŒ–ã€‚å¯ä»¥è¢«å‘½åä¸ºä»»ä½•æ ‡è¯†ç¬¦ï¼› å“ˆå¸Œå¥æŸ„åœ¨ 32 ä½ç³»ç»Ÿä¸­æ¯ä¸ªå…ƒç´ æ¶ˆè€—çº¦ 32 ä¸ªå­—èŠ‚ï¼Œåœ¨ 64 ä½ç³»ç»Ÿä¸­æ¯ä¸ªå…ƒç´ æ¶ˆè€— 56 ä¸ªå­—èŠ‚ã€‚å…¶ä»–çš„å¼€é”€æˆæœ¬\u0026ndash;æ¡¶å’Œè¡¨\u0026ndash;ç›¸æ¯”ä¹‹ä¸‹å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚ä½ å¯ä»¥ä½¿ç”¨ HASH_OVERHEAD æ¥è·å–å“ˆå¸Œè¡¨çš„å¼€é”€å¤§å°ï¼Œå•ä½æ˜¯å­—èŠ‚ã€‚\n2. åŸºæœ¬æ“ä½œ #å®Œæ•´çš„ä¾‹å­å¯ä»¥åœ¨æºç ä¸‹çš„ tests/exapmle.c æ–‡ä»¶ä¸­æ‰¾åˆ°ï¼Œå¯ä»¥æ‰§è¡Œ make example è¿›è¡Œç¼–è¯‘ã€‚\n2.1 å£°æ˜ #å®šä¹‰ä¸€ä¸ªç»“æ„ä½“ç±»å‹çš„ç©ºæŒ‡é’ˆï¼Œå³å£°æ˜äº†ä¸€ä¸ªå“ˆå¸Œè¡¨ï¼š\nstruct my_struct *users = NULL; æ­¤æ—¶çš„å“ˆå¸Œè¡¨ç¤ºç©ºçš„ï¼Œæˆ‘ä»¬éœ€è¦å…ˆè¡¨ä¸­æ·»åŠ æ•°æ®å…ƒç´ ï¼Œåœ¨æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ï¼Œè¿™ä¸ªæŒ‡é’ˆéƒ½æŒ‡å‘é“¾è¡¨çš„å¤´ç»“ç‚¹ã€‚\n2.2 æ·»åŠ  #é¦–å…ˆéœ€è¦åˆå§‹åŒ–ä¸€ä¸ªæ•°æ®å…ƒç´ ï¼Œä¹Ÿå°±æ˜¯å®šä¹‰ä¸€ä¸ª struct my_struct å˜é‡ï¼Œå¹¶åˆ†é…ç©ºé—´ï¼Œç„¶åè°ƒç”¨ HASH_ADD ï¼ˆè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨æ–¹ä¾¿çš„å® HASH_ADD_INTï¼Œå®ƒä¸º int ç±»å‹çš„ key æä¾›äº†ç®€åŒ–çš„ç”¨æ³•ï¼‰æ–¹æ³•ï¼Œå°†å…¶æ·»åŠ åˆ°å“ˆå¸Œè¡¨ä¸­ï¼š\nvoid add_user(int user_id, char *name) { struct my_struct *s; s = malloc(sizeof(struct my_struct)); s-\u0026gt;id = user_id; strcpy(s-\u0026gt;name, name); HASH_ADD_INT( users, id, s ); /* id: name of key field */ } HASH_ADD_INT çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å“ˆå¸Œè¡¨çš„æŒ‡é’ˆï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ç»“æ„ä½“ä¸­ key çš„å˜é‡åï¼Œæœ€åä¸€ä¸ªå‚æ•°æ˜¯éœ€è¦åŠ å…¥å“ˆå¸Œè¡¨çš„å…ƒç´ ã€‚ä¸€ä¸ªå…ƒç´ æ·»åŠ åˆ°å“ˆå¸Œè¡¨åï¼Œå°±ä¸èƒ½ä¿®æ”¹å®ƒçš„ key çš„å€¼ï¼Œå¿…é¡»ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤åï¼Œæ‰èƒ½ä¿®æ”¹ã€‚\n2.3 æŸ¥è¯¢ #å¯ä»¥è°ƒç”¨ HASH_FIND ï¼ˆè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨æ–¹ä¾¿çš„å® HASH_ADD_INTï¼Œå®ƒä¸º int ç±»å‹çš„ key æä¾›äº†ç®€åŒ–çš„ç”¨æ³•ï¼‰æŸ¥è¯¢æŸä¸ª key çš„ value ï¼š\nstruct my_struct *find_user(int user_id) { struct my_struct *s; HASH_FIND_INT( users, \u0026amp;user_id, s ); /* s: output pointer */ return s; } ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å“ˆå¸Œè¡¨çš„æŒ‡é’ˆï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ key çš„å€¼ï¼Œç¬¬ä¸‰å‚æ•°æ˜¯è¿”å›çš„ç»“æœï¼Œå°±æ˜¯ç»™å®š key çš„ç»“æ„ä½“æŒ‡é’ˆï¼Œå¦‚æœæ²¡æ‰¾åˆ°ï¼Œå°±è¿”å› NULL ã€‚\né€šå¸¸åœ¨æ·»åŠ ä¹‹å‰è¦æŸ¥è¯¢ä¸€ä¸‹ key æ˜¯å¦å·²ç»å­˜åœ¨ï¼Œé¿å…å‘ç”Ÿå†²çªã€‚\n2.4 åˆ é™¤ #è¦ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ä¸€ä¸ªå…ƒç´ ï¼Œå¿…é¡»å…ˆè·å–è¿™ä¸ªå…ƒç´ çš„æŒ‡é’ˆï¼ˆå¯ä»¥ç”¨ HASH_FINDï¼‰ï¼Œç„¶åè°ƒç”¨ HASH_DEL ï¼š\nvoid delete_user(struct my_struct *user) { HASH_DEL(users, user); /* user: pointer to deletee */ free(user); /* optional; it\u0026#39;s up to you! */ } users å°±æ˜¯å“ˆå¸Œè¡¨çš„æŒ‡é’ˆï¼Œuser å°±æ˜¯è¦åˆ é™¤çš„å…ƒç´ ï¼Œåˆ é™¤åï¼Œuthash ä¸ä¼šè‡ªåŠ¨é‡Šæ”¾ user æŒ‡å‘çš„å†…å­˜ï¼Œå¯ä»¥è°ƒç”¨ free() æ‰‹åŠ¨é‡Šæ”¾ï¼Œå¯ä»¥ç»§ç»­å…¶ä»–å·¥ä½œï¼Œæ¯”å¦‚ä¿®æ”¹è¿™ä¸ªé”®å€¼å¯¹ã€‚\nå½“åˆ é™¤çš„æ˜¯å“ˆå¸Œè¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œusers çš„å€¼æ˜¯ä¼šæ”¹å˜çš„ï¼Œå®ƒä¼šç»§ç»­æŒ‡å‘æ–°çš„å¤´ç»“ç‚¹ã€‚\nå¦‚æœè¦åˆ é™¤æ‰€æœ‰å…ƒç´ ï¼Œå¯ä»¥è°ƒç”¨ HASH_ITER æ–¹æ³•ï¼Œè¿™ä¸ªå®å¯ä»¥æ‰©å±•ä¸ºä¸€ä¸ªç®€å•çš„å¾ªç¯ï¼š\nvoid delete_all() { struct my_struct *current_user, *tmp; HASH_ITER(hh, users, current_user, tmp) { HASH_DEL(users,current_user); /* delete; users advances to next */ free(current_user); /* optional- if you want to free */ } } å¦‚æœæ¸…ç©ºå“ˆå¸Œè¡¨æ—¶ï¼Œå¹¶ä¸æƒ³é‡Šæ”¾æ‰€æœ‰å…ƒç´ çš„ç©ºé—´ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨ï¼š\nHASH_CLEAR(hh, users); ä¹‹åï¼Œusers å°±ä¼šå˜ä¸ºç©ºæŒ‡é’ˆã€‚\n2.5 ç»Ÿè®¡ #è·å–å“ˆå¸Œè¡¨ä¸­å…ƒç´ æ€»æ•°æ—¶ï¼Œå¯ä»¥è°ƒç”¨ HASH_COUNT ï¼š\nunsigned int num_users; num_users = HASH_COUNT(users); printf(\u0026#34;there are %u users\\n\u0026#34;, num_users); å¦‚æœå“ˆå¸Œè¡¨æ˜¯ç©ºçš„ï¼Œä¼šè¿”å› 0 ã€‚\n","date":"2020 August 29","permalink":"/posts/2020/08/29/","section":"Posts","summary":"uthash æ˜¯ä¸€ä¸ª C è¯­è¨€çš„å“ˆå¸Œè¡¨å‡½æ•°åº“ï¼Œæ”¯æŒå“ˆå¸Œè¡¨çš„å„ç§æ“ä½œï¼ŒåŒ…æ‹¬æ·»åŠ ï¼Œåˆ é™¤ï¼ŒæŸ¥æ‰¾ï¼Œæ’åºç­‰ã€‚ä½ å¯ä»¥åœ¨ github ä¸Šä¸‹è½½åˆ°å®ƒçš„æºç ï¼š","title":"uthash å­¦ä¹ ç¬”è®°"},{"content":"ç¼–è¯‘å®‰è£… #é¦–å…ˆè¦å®‰è£…ä¸€äº›ä¾èµ–çš„è½¯ä»¶ï¼š\napt-get install pkg-config apt-get install lua5.1 apt-get install liblua5.1-dev apt-get install cmake apt-get install libjson-c-dev ç„¶åè¦ç¼–è¯‘å®‰è£… libubox ï¼š\ngit clone https://git.openwrt.org/project/libubox.git cd libubox cmake . make make install ulog #å¤´æ–‡ä»¶ ulog.h æä¾›äº†æ‰“å°æ—¥å¿—çš„æ–¹æ³•ã€‚ä½¿ç”¨æ—¶ï¼Œå…ˆè°ƒç”¨ ulog_open() å‡½æ•°åˆå§‹åŒ–ä¸€äº› ulog éœ€è¦çš„å˜é‡ï¼š\nvoid ulog_open(int channels, int facility, const char *ident); channels ç”¨äºè®¾ç½®æ—¥å¿—æ¶ˆæ¯çš„è¾“å‡ºç›®æ ‡ï¼Œå–å€¼ï¼š\nULOG_KMSGï¼Œå†…æ ¸æ—¥å¿—ï¼Œè¾“å‡ºåˆ°äº† /dev/kmsg æ–‡ä»¶ã€‚ ULOG_SYSLOGï¼Œç³»ç»Ÿæ—¥å¿—ï¼Œè°ƒç”¨äº† vsyslog() äº§ç”Ÿç³»ç»Ÿæ—¥å¿—ã€‚ ULOG_STDIOï¼Œæ ‡å‡†è¾“å‡ºï¼Œè¾“å‡ºåˆ°äº† stderr ã€‚ facility ç”¨äºè®¾ç½®è®°å½•æ—¥å¿—çš„ç¨‹åºçš„ç±»å‹ï¼Œåªæœ‰å½“ channels çš„å€¼ä¸º ULOG_SYSLOG æ—¶ï¼Œè¿™ä¸ªå‚æ•°æœ‰æ•ˆã€‚å–å€¼ä¸ openlog() çš„ç¬¬ä¸‰ä¸ªå‚æ•°ä¸€è‡´ï¼Œå®ƒä»¬æ˜¯å®šä¹‰åœ¨ \u0026lt;syslog.h\u0026gt; ä¸­çš„å®ï¼š\n/* facility codes */ #define LOG_KERN (0\u0026lt;\u0026lt;3) /* kernel messages */ #define LOG_USER (1\u0026lt;\u0026lt;3) /* random user-level messages */ #define LOG_MAIL (2\u0026lt;\u0026lt;3) /* mail system */ #define LOG_DAEMON (3\u0026lt;\u0026lt;3) /* system daemons */ #define LOG_AUTH (4\u0026lt;\u0026lt;3) /* security/authorization messages */ #define LOG_SYSLOG (5\u0026lt;\u0026lt;3) /* messages generated internally by syslogd */ #define LOG_LPR (6\u0026lt;\u0026lt;3) /* line printer subsystem */ #define LOG_NEWS (7\u0026lt;\u0026lt;3) /* network news subsystem */ #define LOG_UUCP (8\u0026lt;\u0026lt;3) /* UUCP subsystem */ #define LOG_CRON (9\u0026lt;\u0026lt;3) /* clock daemon */ #define LOG_AUTHPRIV (10\u0026lt;\u0026lt;3) /* security/authorization messages (private) */ #define LOG_FTP (11\u0026lt;\u0026lt;3) /* ftp daemon */ ident ç”¨äºè®¾ç½®æ—¥å¿—æ¶ˆæ¯çš„æ ‡è¯†ï¼Œå½“ channels çš„å€¼ä¸º ULOG_STDIO æ—¶ï¼Œè¿™ä¸ªå‚æ•°æ— æ•ˆã€‚å¯ä»¥è®¾ç½®ä¸ºç¨‹åºåçš„å­—ç¬¦ä¸²ï¼Œå¦‚æœä¸ºç©ºï¼Œå®ƒä¼šä» /proc/self/status æ–‡ä»¶è¯»å–å½“å‰è¿›ç¨‹çš„åç§°ä½œä¸ºé»˜è®¤å€¼ã€‚\nåˆå§‹åŒ–å®Œæ¯•åï¼Œå°±å¯ä»¥è°ƒç”¨ ulog æ‰“å°ä¸€æ¡æ—¥å¿—ï¼š\nvoid ulog(int priority, const char *fmt, ...) priority è¡¨ç¤ºè¿™æ¡æ—¥å¿—çš„ç±»å‹ï¼Œå½“ channels çš„å€¼ä¸º ULOG_STDIO æ—¶ï¼Œè¿™ä¸ªå‚æ•°æ— æ•ˆã€‚å–å€¼ä¸ syslog() çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸€è‡´ï¼Œå®ƒä»¬æ˜¯å®šä¹‰åœ¨ \u0026lt;syslog.h\u0026gt; ä¸­çš„å®ï¼š\n#define LOG_EMERG 0 /* system is unusable */ #define LOG_ALERT 1 /* action must be taken immediately */ #define LOG_CRIT 2 /* critical conditions */ #define LOG_ERR 3 /* error conditions */ #define LOG_WARNING 4 /* warning conditions */ #define LOG_NOTICE 5 /* normal but significant condition */ #define LOG_INFO 6 /* informational */ #define LOG_DEBUG 7 /* debug-level messages */ ä¸ºäº†è°ƒç”¨æ–¹ä¾¿ï¼Œulog æä¾›äº†ä¸åŒç±»å‹çš„å®å®šä¹‰ï¼š\n#define ULOG_INFO(fmt, ...) ulog(LOG_INFO, fmt, ## __VA_ARGS__) #define ULOG_NOTE(fmt, ...) ulog(LOG_NOTICE, fmt, ## __VA_ARGS__) #define ULOG_WARN(fmt, ...) ulog(LOG_WARNING, fmt, ## __VA_ARGS__) #define ULOG_ERR(fmt, ...) ulog(LOG_ERR, fmt, ## __VA_ARGS__) ç¨‹åºç»“æŸæ—¶ï¼Œåº”è¯¥è°ƒç”¨ ulog_close() å…³é—­æ—¥å¿—ï¼Œå¯¹äº ULOG_SYSLOG æ¥è¯´ï¼Œå®ƒä¼šè°ƒç”¨ closelog() å‡½æ•°å®Œæˆä»»åŠ¡ã€‚\nulog è¿˜æä¾›äº†ä¸€ä¸ªå‡½æ•°æ¥æ§åˆ¶ç¨‹åºæ‰“å°æ—¥å¿—çš„çº§åˆ«ï¼š\nvoid ulog_threshold(int threshold); threshold å¯é€‰çš„å€¼ä¸ ulog() çš„ priority å‚æ•°ä¸€è‡´ï¼Œé»˜è®¤å€¼æ˜¯ LOG_DEBUG ã€‚è®¾ç½®åï¼Œå†è°ƒåŠ¨ ulog() æ—¶ï¼Œå¦‚æœ priority çš„æ•°å€¼å¤§äº threshold ï¼Œå°±ä¸ä¼šæ‰“å°ä»»ä½•æ¶ˆæ¯ã€‚æˆ‘ä»¬å¯ä»¥åœ¨å¼€å‘è°ƒè¯•é˜¶æ®µè®¾ç½®ä¸º LOG_DEBUG ï¼Œè°ƒè¯•ç»“æŸå‘å¸ƒç¨‹åºæ—¶å†è®¾ä¸º LOG_INFO ï¼Œè°ƒè¯•ä¿¡æ¯å°±ç›´æ¥å…³é—­äº†ã€‚\nä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹ç¨‹ï¼š\n// main.c #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;stdarg.h\u0026gt; #include \u0026lt;libubox/ulog.h\u0026gt; int main() { ulog_open(ULOG_SYSLOG, LOG_USER, NULL); ULOG_INFO(\u0026#34;hello ulog\u0026#34;); ulog_close(); } ç¼–è¯‘åæ‰§è¡Œï¼š\n~$ gcc -Wall main.c -o main -lubox ~$ ./main ç„¶åï¼Œåœ¨ç³»ç»Ÿæ—¥å¿—ä¸­å¯ä»¥æŸ¥çœ‹åˆ°è¿™æ¡æ¶ˆæ¯ï¼š\nJul 02 10:58:06 ubuntu main[25733]: hello ulog utils #utils.h ç±»ä¼¼ä¸€ä¸ªå·¥å…·åº“ï¼Œæä¾›å¾ˆå¤šä½¿ç”¨çš„æ–¹æ³•ã€‚\nbase64 #utils æä¾›äº† base64 çš„ç¼–è§£ç æ–¹æ³•ã€‚\nç¼–ç å‡½æ•°æ˜¯ b64_encode() ï¼š\nint b64_encode(const void *_src, size_t srclength, void *dest, size_t targsize) å‚æ•° _src æ˜¯æŒ‡å‘æºæ•°æ®çš„æŒ‡é’ˆï¼Œsrclength æ˜¯æºæ•°æ®çš„é•¿åº¦ï¼Œå•ä½æ˜¯å­—èŠ‚ã€‚dest æŒ‡å‘ç¼–ç åçš„å­—ç¬¦ä¸²å­˜æ”¾ä½ç½®ï¼Œtargsize æ˜¯ dest çš„ç©ºé—´å¤§å°ï¼Œå•ä½æ˜¯å­—èŠ‚ã€‚targsize åº”è¯¥ä¸å°äº (((srclength) + 2) / 3) * 4 + 1 ï¼Œé™¤æ³•å–æ•´ï¼Œæœ€åè¦åŠ å­—ç¬¦ä¸²ç»“æŸç¬¦ '\\0' ï¼Œæ‰€ä»¥è¦åŠ  1 ã€‚å¦‚æœè°ƒç”¨æˆåŠŸï¼Œè¿”å›å€¼æ˜¯ç¼–ç åçš„å­—ç¬¦ä¸²é•¿åº¦ï¼Œå¤±è´¥åˆ™è¿”å› -1 ã€‚ä¾‹å¦‚ï¼š\nb64_encode(\u0026#34;food\u0026#34;, 4, buf, 9); è§£ç å‡½æ•°æ˜¯ b64_decode() ï¼š\nint b64_decode(const void *_src, void *dest, size_t targsize); å‚æ•°çš„å«ä¹‰ä¸ç¼–ç å‡½æ•°ä¸€è‡´ï¼Œä¸éœ€è¦è®¾ç½®æºæ•°æ®çš„é•¿åº¦ï¼Œå‡½æ•°ä»¥ _src å­—ç¬¦ä¸²ä¸­çš„ '\\0' å­—ç¬¦ä¸ºç»“æŸç¬¦ã€‚å¦‚æœè°ƒç”¨æˆåŠŸï¼Œè¿”å›å€¼æ˜¯ç¼–ç åçš„å­—ç¬¦ä¸²é•¿åº¦ï¼Œå¤±è´¥åˆ™è¿”å› -1 ã€‚\nutil.h æ–‡ä»¶æä¾›äº†è®¡ç®—ç¼–è§£ç åå­—ç¬¦ä¸²é•¿åº¦çš„å®ï¼š\n#define B64_ENCODE_LEN(_len)\t((((_len) + 2) / 3) * 4 + 1) #define B64_DECODE_LEN(_len)\t(((_len) / 4) * 3 + 1) list #ubox ç”¨ list.h æä¾›äº†ä¸€ç§ä¾µå…¥å¼é“¾è¡¨ç»“æ„ï¼Œç»“ç‚¹ä¸­ä¸å«ä»»ä½•æ•°æ® ï¼š\nstruct list_head { struct list_head *next; // ä¸‹ä¸€ä¸ªå…ƒç´  struct list_head *prev; // ä¸Šä¸€ä¸ªå…ƒç´  }; å¯ä»¥ç”¨ä¸€ä¸ªå®åˆå§‹åŒ–é“¾è¡¨ï¼š\n#define LIST_HEAD_INIT(name) { \u0026amp;(name), \u0026amp;(name) } å®ƒå®šä¹‰äº†é“¾è¡¨çš„ head ï¼Œnext å’Œ prev éƒ½æŒ‡å‘æœ¬èº«ï¼Œè°ƒç”¨æ–¹æ³•ï¼š\nstruct list_head test_list = LIST_HEAD_INIT(test_list); ubox çš„ list è¿˜æ˜¯ä¸€ä¸ªåŒå‘å¾ªç¯é“¾è¡¨ï¼š\nåœ¨é“¾è¡¨ head çš„å¤´éƒ¨æ’å…¥ new ç»“ç‚¹ï¼Œå®é™…ä¸Šæ˜¯åœ¨ head ä¸ first ä¹‹é—´æ’å…¥ new ç»“ç‚¹ï¼š\nstatic inline void list_add(struct list_head *_new, struct list_head *head); åœ¨é“¾è¡¨ head çš„æœ«å°¾è¿½åŠ  new ç»“ç‚¹ï¼Œå®é™…ä¸Šæ˜¯åœ¨ head ä¸ last ä¹‹é—´æ’å…¥ new ç»“ç‚¹ ï¼š\nstatic inline void list_add_tail(struct list_head *_new, struct list_head *head); å°† entry ç»“ç‚¹ä»åŸæœ‰çš„åˆ—è¡¨ä¸­åˆ é™¤ï¼š\nstatic inline void list_del(struct list_head *entry); å°† list ç»“ç‚¹ç§»åŠ¨åˆ—è¡¨å¤´éƒ¨ï¼Œå°±æ˜¯ head ä¸ first ä¹‹é—´ï¼š\nstatic inline void list_move(struct list_head *list, struct list_head *head); å°† list ç»“ç‚¹ç§»åŠ¨åˆ°åˆ—è¡¨æœ«å°¾ï¼Œå°±æ˜¯ head ä¸ last ä¹‹é—´ï¼š\nstatic inline void list_move_tail(struct list_head *entry, struct list_head *head); åˆ¤æ–­ä¸€ä¸ªé“¾è¡¨æ˜¯å¦ä¸ºç©ºï¼Œå®ƒä¼šåˆ¤æ–­ head ç»“ç‚¹çš„ next æŒ‡é’ˆæ˜¯å¦æŒ‡å‘æœ¬èº«ã€‚ï¼š\nstatic inline bool list_empty(const struct list_head *head); åˆ¤æ–­ list ç»“ç‚¹æ˜¯å¦æ˜¯ head é“¾è¡¨çš„å¤´ç»“ç‚¹ï¼š\nstatic inline bool list_is_first(const struct list_head *list, const struct list_head *head); åˆ¤æ–­ list ç»“ç‚¹æ˜¯å¦æ˜¯ head é“¾è¡¨çš„å°¾ç»“ç‚¹ï¼š\nstatic inline bool list_is_last(const struct list_head *list, const struct list_head *head); å¯¹äºä¾µå…¥å¼é“¾è¡¨ï¼Œé€šå¸¸çš„ä½¿ç”¨æ–¹æ³•æ˜¯å°† list ç»“ç‚¹åµŒå…¥åˆ°ç‰¹å®šçš„æ•°æ®ç»“æ„ä¸­ï¼Œä¾‹å¦‚ï¼š\nstruct item { const char *data; struct list_head list; }; usock #usock.h æä¾›ä¾¿äºæ–°å»º socket çš„æ–¹æ³•ï¼Œæ˜¯å¯¹ Linux socket API çš„å°è£…ï¼š\nint usock(int type, const char *host, const char *service); å¦‚æœè°ƒç”¨æˆåŠŸï¼Œå°±è¿”å›ä¸€ä¸ª socket æ–‡ä»¶æè¿°ç¬¦ï¼Œå¤±è´¥è¿”å› -1ã€‚\nå‚æ•° type ç”¨äºè®¾ç½® socket ç±»å‹ï¼Œå¯é€‰çš„å€¼æ˜¯ä¸‹é¢è¿™äº›å®å®šä¹‰çš„ç»„åˆï¼š\n#define USOCK_IPV6ONLY 0x2000 // IPv4 åœ°å€åŸŸçš„å¥—æ¥å­— #define USOCK_IPV4ONLY 0x4000 // IPv6 åœ°å€åŸŸçš„å¥—æ¥å­— #define USOCK_UNIX 0x8000 // UNIX åŸŸçš„å¥—æ¥å­— #define USOCK_TCP 0 // å­—èŠ‚æµ #define USOCK_UDP 1 // æŠ¥æ–‡ #define USOCK_SERVER 0x0100 #define USOCK_NOCLOEXEC 0x0200 #define USOCK_NONBLOCK 0x0400 // éé˜»å¡ #define USOCK_NUMERIC 0x0800 host æ˜¯æœ¬æœºåœ°å€ï¼Œå¦‚æœæ˜¯ç½‘ç»œ socketï¼Œè¿™é‡Œåº”è¯¥æ˜¯ä¸€ä¸ª IP åœ°å€æˆ–è€…åŸŸåï¼Œå¦‚æœæ˜¯ UNIX socket ï¼Œè¿™é‡Œåº”è¯¥æ˜¯ socket æ–‡ä»¶çš„è·¯å¾„ã€‚\nservice æ˜¯æœ¬æœºç«¯å£ï¼Œä¹Ÿå¯ä»¥æ˜¯åè®®åç§°çš„å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ http å’Œ ftp ç­‰ã€‚å¯¹äº UNIX socket ï¼Œè¿™ä¸ªå‚æ•°æ— æ•ˆã€‚\nå¯¹äºéé˜»å¡çš„ socket ï¼Œusock æä¾›äº†ä¸€ä¸ªç­‰å¾…æè¿°ç¬¦å°±ç»ªçš„æ–¹æ³•ï¼š\nint usock_wait_ready(int fd, int msecs); fd æ˜¯è¦ç­‰å¾…çš„ socket æè¿°ç¬¦ï¼Œmsecs æ˜¯ç­‰å¾…è¶…æ—¶ï¼Œå•ä½æ˜¯å¾®ç§’ã€‚è¿™ä¸ªæ–¹æ³•æ˜¯å¯¹ poll() å‡½æ•°çš„å°è£…ã€‚\nconst char *usock_port(int port); usock_port() å‡½æ•°å¯ä»¥æŠŠæ•°å­—è¡¨ç¤ºçš„ç«¯å£å·è½¬æ¢ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ã€‚\n","date":"2020 July 16","permalink":"/posts/2020/07/16/","section":"Posts","summary":"ç¼–è¯‘å®‰è£… #é¦–å…ˆè¦å®‰è£…ä¸€äº›ä¾èµ–çš„è½¯ä»¶ï¼š","title":"libubox å­¦ä¹ ç¬”è®°"},{"content":"æœ¬æ•™ç¨‹æä¾›äº†ä¸€ä¸ªæ¸è¿›å¼çš„æŒ‡å¯¼ï¼Œå‚è€ƒçš„æ˜¯å®˜æ–¹æ•™ç¨‹ CMake Tutorial ï¼Œç„¶ååŠ å…¥å­¦ä¹ è¿‡ç¨‹çš„ç¬”è®°ã€‚æ¶µç›–äº†ä½¿ç”¨ CMake æ„å»ºä¸€ä¸ªå·¥ç¨‹æ—¶ç»å¸¸é‡åˆ°çš„é—®é¢˜ ã€‚é€šè¿‡ä¸€ä¸ªç¤ºä¾‹é¡¹ç›®ï¼Œå±•ç¤ºå„ç§åŠŸèƒ½æ˜¯å¦‚ä½•ä¸€èµ·å·¥ä½œçš„ï¼Œè¿™å¯¹ç†è§£ CMake éå¸¸æœ‰ç”¨ã€‚\n1. æœ€ç®€å•çš„å·¥ç¨‹ #æœ€ç®€å•å·¥ç¨‹æ˜¯ä»æºç æ–‡ä»¶ç›´æ¥ç¼–è¯‘ç”Ÿæˆä¸€ä¸ªå¯æ‰§è¡Œçš„é—®é¢˜ï¼Œæœ€ç®€å•çš„è§£å†³æ–¹æ¡ˆåªéœ€è¦åœ¨ CMakeLists.txt æ–‡ä»¶ä¸­æ·»åŠ ä¸‰è¡Œã€‚\næ–°å»ºä¸€ä¸ªå·¥ç¨‹ç›®å½•ï¼Œåœ¨ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªæºæ–‡ä»¶ Tutorial.c ï¼š\n#include \u0026lt;stdio.h\u0026gt; int main (int argc, char *argv[]) { printf(\u0026#34;Hello World!\\n\u0026#34;); return 0; } æ–°å»ºä¸€ä¸ª CMakeLists.txt ï¼š\ncmake_minimum_required(VERSION 3.1) project(Tutorial) add_executable(Tutorial Tutorial.c) CMakeLists.txt æ˜¯ cmake ç”Ÿæˆ Makefile æ‰€ä¾èµ–çš„æè¿°æ€§æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹ç”±ä¸€è¡Œä¸€è¡Œçš„å‘½ä»¤ç»„æˆï¼Œå‘½ä»¤ä¸åŒºåˆ†å¤§å°å†™ã€‚\ncmake_minimum_required è¡¨ç¤ºè¯¥é¡¹ç›®å¯¹ CMake çš„æœ€ä½ç‰ˆæœ¬è¦æ±‚ã€‚ project ç”¨äºè®¾ç½®é¡¹ç›®åç§°ã€‚ add_executable æ·»åŠ äº†ä¸€ä¸ªç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå’Œä¾èµ–çš„æºç ã€‚ è¿™æ ·çš„è¯ï¼Œæ‰§è¡Œ cmake . ç”Ÿæˆ Makefile ï¼Œå†æ‰§è¡Œ make å¼€å§‹ç¼–è¯‘ï¼Œå°±å¯ä»¥ä½¿ç”¨ Tutorial.c ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶ Tutorial ã€‚\ncmake æ‰§è¡Œè¿‡ç¨‹ä¸­ä¼šç”Ÿæˆå¤§é‡çš„ç¼“å­˜æ–‡ä»¶ï¼Œåˆæ²¡æœ‰æä¾›ç±»ä¼¼ cmake clean çš„å‘½ä»¤æ¥æ¸…é™¤ç”Ÿæˆçš„æ–‡ä»¶ï¼Œæœ‰ä¸€ä¸ªç®€å•çš„æ–¹æ³•å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚åœ¨å·¥ç¨‹ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªåä¸º build çš„å­ç›®å½•ï¼Œè¿›å…¥è¿™ä¸ªå­ç›®å½•ä¸­æ‰§è¡Œ cmake .. ï¼Œè¿™æ ·ç”Ÿæˆçš„æ–‡ä»¶éƒ½ä¼šè¾“å‡ºåˆ° build å­ç›®å½•ä¸­ï¼Œæ–¹ä¾¿æ¸…ç†ã€‚\næ·»åŠ ä¸€ä¸ªç‰ˆæœ¬å· #ä¸€ä¸ªè½¯ä»¶å·¥ç¨‹é€šå¸¸éœ€è¦ç‰ˆæœ¬å·ï¼Œå¯ä»¥ç›´æ¥å†™åœ¨æºç é‡Œï¼Œä½†æ˜¯ CMake æä¾›äº†æ›´ä¾¿æ·çš„æ–¹æ³•ã€‚å¯ä»¥åœ¨ project() å‘½ä»¤ä¸­æ·»åŠ ç‰ˆæœ¬å·ï¼Œä¾‹å¦‚ï¼š\nproject(Tutorial VERSION 1.0) å…¶å®ï¼Œè¿˜å¯ä»¥åœ¨è¯¥å‘½ä»¤ä¸­æ·»åŠ é¡¹ç›®çš„æè¿°ç­‰ï¼Œå®ƒçš„è¯­æ³•æ˜¯ï¼š\nproject(\u0026lt;PROJECT-NAME\u0026gt; [VERSION \u0026lt;major\u0026gt;[.\u0026lt;minor\u0026gt;[.\u0026lt;patch\u0026gt;[.\u0026lt;tweak\u0026gt;]]]] [DESCRIPTION \u0026lt;project-description-string\u0026gt;] [HOMEPAGE_URL \u0026lt;url-string\u0026gt;] [LANGUAGES \u0026lt;language-name\u0026gt;...]) è¿™æ ·æ·»åŠ çš„ç‰ˆæœ¬å·ï¼Œè¢« cmake å­˜æ”¾åœ¨ç‰¹å®šçš„å˜é‡ä¸­ï¼š\n\u0026lt;PROJECT-NAME\u0026gt;_VERSION ï¼Œå­˜æ”¾å®Œæ•´çš„ç‰ˆæœ¬å· ã€‚ \u0026lt;PROJECT-NAME\u0026gt;_VERSION_MAJOR ï¼Œå­˜æ”¾ major ã€‚ \u0026lt;PROJECT-NAME\u0026gt;_VERSION_MINOR ï¼Œå­˜æ”¾ minor ã€‚ \u0026lt;PROJECT-NAME\u0026gt;_VERSION_PATCH ï¼Œ å­˜æ”¾ patch ã€‚ \u0026lt;PROJECT-NAME\u0026gt;_VERSION_TWEAK ï¼Œå­˜æ”¾ tweak ã€‚ \u0026lt;PROJECT-NAME\u0026gt;è¡¨ç¤ºå·¥ç¨‹çš„åç§°ï¼Œè¿™é‡Œçš„å€¼ä¸º Tutorial ï¼Œæ‰€ä»¥ Tutorial_VERSION_MAJOR çš„å€¼å°±æ˜¯ 1 ï¼Œ Tutorial_VERSION_MINOR çš„å€¼å°±æ˜¯ 0 ã€‚æˆ‘ä»¬éœ€è¦æ–°å»ºä¸€ä¸ªåä¸º TutorialConfig.h.in çš„æ–‡ä»¶ä¼ é€’è¿™äº›å˜é‡ï¼š\n#define Tutorial_VERSION_MAJOR @Tutorial_VERSION_MAJOR@ #define Tutorial_VERSION_MINOR @Tutorial_VERSION_MINOR@ ç„¶åï¼Œåœ¨ CMakeLists.txt ä¸­æ·»åŠ ä¸€æ¡å‘½ä»¤ï¼š\nconfigure_file(TutorialConfig.h.in TutorialConfig.h) cmake æ‰§è¡Œè¿™æ¡å‘½ä»¤çš„æ—¶å€™ï¼Œä¼šè¯»å– TutorialConfig.h.in æ–‡ä»¶ï¼Œå¹¶å°†å…¶ä¸­çš„å˜é‡æ›¿æ¢æˆçœŸå®çš„å€¼ï¼Œç„¶ååœ¨æ‰§è¡Œç›®å½•ä¸‹ç”Ÿæˆå¤´æ–‡ä»¶ TutorialConfig.h ï¼š\n#define Tutorial_VERSION_MAJOR 1 #define Tutorial_VERSION_MINOR 0 ä¸‹ä¸€æ­¥ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æºç æ–‡ä»¶ Tutorial.c ä¸­å¯¼å…¥å¤´æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨å¤´æ–‡ä»¶é‡Œå®šä¹‰çš„å®æ‰“å°ç‰ˆæœ¬å·ï¼š\n#include \u0026lt;stdio.h\u0026gt; #include \u0026#34;TutorialConfig.h\u0026#34; # å¯¼å…¥å¤´æ–‡ä»¶ int main (int argc, char *argv[]) { printf(\u0026#34;Hello World!\\n\u0026#34;); printf(\u0026#34;MAJOR Version is %d\\n\u0026#34;, Tutorial_VERSION_MAJOR); # å¼•ç”¨ç‰ˆæœ¬å·çš„å®å®šä¹‰ printf(\u0026#34;MINOR Version is %d\\n\u0026#34;, Tutorial_VERSION_MINOR); return 0; } å¦‚æœä½ æ˜¯åœ¨æºç ç›®å½•ä¸‹æ‰§è¡Œ cmake ï¼Œè¿™æ ·ä¿®æ”¹å°±å¯ä»¥äº†ã€‚å¦‚æœæ˜¯åœ¨ build ç›®å½•ä¸‹æ‰§è¡Œ cmake ï¼Œç”Ÿæˆçš„ TutorialConfig.h æ–‡ä»¶ä½äº build ç›®å½•ä¸‹ï¼Œæºæ–‡ä»¶ä¸­çš„ #include \u0026quot;TutorialConfig.h\u0026quot; è¯­å¥ä¼šæ‰¾ä¸åˆ°å¤´æ–‡ä»¶ï¼Œè¿™æ—¶ï¼Œéœ€è¦å°† build ç›®å½•é¡µåŠ å…¥åˆ°å¤´æ–‡ä»¶çš„æ£€ç´¢è·¯å¾„ä¸­ï¼Œå¯ä»¥åœ¨ CMakeLists.txt çš„æœ«å°¾åŠ ä¸€è¡Œï¼š\ntarget_include_directories(Tutorial PUBLIC \u0026#34;${PROJECT_BINARY_DIR}\u0026#34;) target_include_directories() çš„è¯­æ³•æ˜¯ï¼š\ntarget_include_directories(\u0026lt;target\u0026gt; [SYSTEM] [BEFORE] \u0026lt;INTERFACE|PUBLIC|PRIVATE\u0026gt; [items1...] [\u0026lt;INTERFACE|PUBLIC|PRIVATE\u0026gt; [items2...] ...]) å®ƒçš„ä½œç”¨æ˜¯å‘ç›®æ ‡æ–‡ä»¶æ·»åŠ å¤´æ–‡ä»¶æ£€ç´¢è·¯å¾„ã€‚å½“ç¼–è¯‘ target ç›®æ ‡æ–‡ä»¶æ—¶ï¼Œå»æŒ‡å®šçš„ iters* è·¯å¾„ä¸‹æ£€ç´¢å¤´æ–‡ä»¶ã€‚target çš„å€¼å¿…é¡»æ˜¯é€šè¿‡ add_executable() æˆ– add_library() å‘½ä»¤æ·»åŠ çš„ç›®æ ‡æ–‡ä»¶åç§°ã€‚\nPROJECT_BINARY_DIR æ˜¯æŒ‡ cmake æä¾›çš„ä¸€ä¸ªå˜é‡ï¼Œè¡¨ç¤ºç›®æ ‡æ–‡ä»¶è¾“å‡ºçš„è·¯å¾„ï¼Œé€šå¸¸å°±æ˜¯æ‰§è¡Œ cmake å‘½ä»¤æ—¶çš„è·¯å¾„ã€‚è¿˜æœ‰ä¸€ä¸ªå˜é‡ PROJECT_SOURCE_DIR ï¼Œè¡¨ç¤ºæºç çš„è·¯å¾„ã€‚å®ƒä»¬çš„å€¼éƒ½æ˜¯ç”± project() å‘½ä»¤è‡ªåŠ¨è®¾ç½®çš„ã€‚åœ¨ cmake ä¸­ï¼Œåº”ç”¨å˜é‡çš„è¯­æ³•æ˜¯ ${variable-name} ã€‚\næµ‹è¯• #ä¿®æ”¹å®Œæ¯•åï¼ŒCMakeLists.txt çš„å®Œæ•´å†…å®¹æ˜¯ï¼š\ncmake_minimum_required(VERSION 3.1) project(Tutorial VERSION 1.0) configure_file(TutorialConfig.h.in TutorialConfig.h) add_executable(Tutorial Tutorial.c) target_include_directories(Tutorial PUBLIC \u0026#34;${PROJECT_BINARY_DIR}\u0026#34;) ç„¶åï¼Œæˆ‘ä»¬åœ¨ build å­ç›®å½•ä¸‹ä¾æ¬¡æ‰§è¡Œ cmake .. å’Œ make ï¼ˆæˆ–è€… cmake --build .ï¼‰ ï¼Œç”Ÿæˆçš„æ–‡ä»¶å¦‚ä¸‹ï¼š\n~$ ls CMakeCache.txt Tutorial inc CMakeFiles TutorialConfig.h Makefile cmake_install.cmake ~$ ./Tutorial Hello World! MAJOR Version is 1 MINOR Version is 0 2. æ·»åŠ ä¸€ä¸ªåº“ #ä¸‹é¢æˆ‘ä»¬åœ¨å·¥ç¨‹ä¸­æ·»åŠ ä¸€ä¸ªç”¨äºæ•°å­¦è®¡ç®—çš„é“¾æ¥åº“ï¼ŒæŠŠåº“çš„æºç æ”¾åœ¨ MathFunctions å­ç›®å½•ä¸­ï¼Œå·¥ç¨‹ç»“æ„å¦‚ä¸‹ï¼š\n~$ tree . â”œâ”€â”€ CMakeLists.txt â”œâ”€â”€ MathFunctions â”‚ â”œâ”€â”€ MathFunctions.h â”‚ â””â”€â”€ mysqrt.c â”œâ”€â”€ Tutorial.c â””â”€â”€ TutorialConfig.h.in å¤´æ–‡ä»¶ MathFunctions.h ä¸­å£°æ˜äº†ä¸€ä¸ªè®¡ç®—å¹³æ–¹æ ¹çš„å‡½æ•° mysqrt() ï¼š\ndouble mysqrt(double x); å®ƒå®šä¹‰åœ¨ mysqrt.c æ–‡ä»¶ä¸­ï¼š\n#include \u0026lt;stdio.h\u0026gt; #include \u0026#34;MathFunctions.h\u0026#34; // a hack square root calculation using simple operations double mysqrt(double x) { if (x \u0026lt;= 0) { return 0; } double result = x; // do ten iterations for (int i = 0; i \u0026lt; 10; ++i) { if (result \u0026lt;= 0) { result = 0.1; } double delta = x - (result * result); result = result + 0.5 * delta / result; printf(\u0026#34;Computing sqrt of %f to be %f .\\n\u0026#34;, x, result); } return result; } ç„¶åï¼Œæˆ‘ä»¬åœ¨ Tutorial.c æ–‡ä»¶ä¸­è°ƒç”¨è¿™ä¸ªå‡½æ•°è®¡ç®—ä¸€ä¸ªæ•°çš„å¹³æ–¹æ ¹ï¼š\n#include \u0026lt;stdio.h\u0026gt; #include \u0026#34;TutorialConfig.h\u0026#34; #include \u0026#34;MathFunctions/MathFunctions.h\u0026#34; int main (int argc, char *argv[]) { double input = 4; printf(\u0026#34;Hello World!\\n\u0026#34;); printf(\u0026#34;Version %d.%d\\n\u0026#34;, Tutorial_VERSION_MAJOR, Tutorial_VERSION_MINOR); double output = mysqrt(input); printf(\u0026#34;The square root of %f is %f .\\n\u0026#34;, input, output); return 0; } ç¼–è¯‘çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¸Œæœ›å°† mysqrt.c ç”Ÿæˆä¸€ä¸ªå…±äº«åº“ï¼Œå†è¿æ¥åˆ° Tutorial ç›®æ ‡ä¸­ã€‚æ‰€ä»¥ï¼Œéœ€è¦å¯¹ CMake çš„æè¿°æ–‡ä»¶åšå¦‚ä¸‹ä¿®æ”¹ï¼š\nåœ¨ MathFunctions å­ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª CMakeLists.txt ï¼Œå†…å®¹æ˜¯ add_library(MathFunctions mysqrt.c) ï¼Œè¡¨ç¤ºå°† mysqrt.c ç¼–è¯‘ä¸ºåº“æ–‡ä»¶ã€‚ åœ¨é¡¶å±‚ç›®å½•çš„ CMakeLists.txt æ–‡ä»¶ä¸­å¦‚ä¸‹å†…å®¹ï¼š add_subdirectory(MathFunctions) ï¼Œè¡¨ç¤ºå‘ CMake å·¥ç¨‹æ·»åŠ ä¸€ä¸ªå­ç›®å½•ï¼Œæ‰§è¡Œæ—¶ä¼šè°ƒç”¨å­ç›®å½•ä¸­çš„ CMakeLists.txt ã€‚ target_link_libraries(Tutorial PUBLIC MathFunctions) ï¼Œè¡¨ç¤ºç›®æ ‡æ–‡ä»¶ Tutorial è¦é“¾æ¥ MathFunctions ã€‚ å› ä¸º Tutorial.c æ–‡ä»¶ä¸­å¯¼å…¥äº† MathFunctions å­ç›®å½•ä¸‹çš„å¤´æ–‡ä»¶ï¼Œæ‰€ä»¥ï¼Œè¦ç”¨ target_include_directories() å‘½ä»¤å°†è¿™ä¸ªå­ç›®å½•ä¹ŸåŠ å…¥å¤´æ–‡ä»¶æ£€ç´¢è·¯å¾„ã€‚ å®Œæ•´çš„é¡¶å±‚ç›®å½• CMakeLists.txt æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\ncmake_minimum_required(VERSION 3.1) project(Tutorial VERSION 1.0) add_subdirectory(MathFunctions) configure_file(TutorialConfig.h.in TutorialConfig.h) add_executable(Tutorial Tutorial.c) target_link_libraries(Tutorial PUBLIC MathFunctions) target_include_directories(Tutorial PUBLIC \u0026#34;${PROJECT_BINARY_DIR}\u0026#34; \u0026#34;${PROJECT_SOURCE_DIR}/MathFunctions\u0026#34; ) ç„¶åï¼Œåœ¨ build ç›®å½•ä¸‹ä¾æ¬¡æ‰§è¡Œ cmake .. å’Œ cmake --build . ï¼Œç¼–è¯‘ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ Tutorial ï¼Œæ‰§è¡Œï¼š\n~$ ./Tutorial Hello World! Version 1.0 Computing sqrt of 4.000000 to be 2.500000 . Computing sqrt of 4.000000 to be 2.050000 . Computing sqrt of 4.000000 to be 2.000610 . Computing sqrt of 4.000000 to be 2.000000 . Computing sqrt of 4.000000 to be 2.000000 . Computing sqrt of 4.000000 to be 2.000000 . Computing sqrt of 4.000000 to be 2.000000 . Computing sqrt of 4.000000 to be 2.000000 . Computing sqrt of 4.000000 to be 2.000000 . Computing sqrt of 4.000000 to be 2.000000 . The square root of 4.000000 is 2.000000 . æä¾›å¯é€‰é¡¹ #ä¸Šä¸€æ­¥æ·»åŠ çš„ MathFunctions åº“å¯ä»¥åšæˆä¸€ä¸ªå¯é€‰çš„æ¨¡å—ï¼Œè¿™æ˜¯å¤§å‹å·¥ç¨‹é‡Œçš„å¸¸è§åšæ³•ã€‚\né¦–å…ˆéœ€è¦ç”¨ option() å‘½ä»¤è®¾ç½®ä¸€ä¸ªé€‰é¡¹ï¼š\noption(USE_MYMATH, \u0026#34;Use tutorial provided math implementation\u0026#34;, ON) è¿™æ ·å°±è®¾ç½®äº†ä¸€ä¸ªåä¸º USE_MYMATH çš„é€‰é¡¹ï¼Œåˆå§‹å€¼æ˜¯ ON ã€‚option() çš„ä½œç”¨æ˜¯æ–°å»ºä¸€ä¸ªç”¨æˆ·å¯ä»¥é€‰æ‹©çš„é€‰é¡¹ï¼Œè¯­æ³•å¾ˆç®€å•ï¼š\noption(\u0026lt;variable\u0026gt; \u0026#34;\u0026lt;help_text\u0026gt;\u0026#34; [value]) ä¸‰ä¸ªå‚æ•°ä¾æ¬¡æ˜¯é€‰é¡¹çš„å˜é‡åï¼Œé€‰é¡¹çš„æè¿°ï¼Œé€‰é¡¹çš„åˆå§‹å€¼ã€‚é€‰é¡¹çš„å€¼åªæœ‰ä¸¤ä¸ªï¼šON å’Œ OFF ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®åˆå§‹å€¼ï¼Œé»˜è®¤å°±æ˜¯ OFF ã€‚\nç„¶åå¯ä»¥é€šè¿‡è¿™ä¸ªé€‰é¡¹ï¼ŒæŠŠæ¨¡å—ç›¸å…³çš„è¯­å¥åŒ…è£¹åœ¨ä¸€ä¸ªé€‰æ‹©è¯­å¥ä¸­ï¼š\noption(USE_MYMATH \u0026#34;Use tutorial provided math implementation\u0026#34; ON) if(USE_MYMATH) add_subdirectory(MathFunctions) list(APPEND EXTRA_LIBS MathFunctions) list(APPEND EXTRA_INCLUDES \u0026#34;${PROJECT_SOURCE_DIR}/MathFunctions\u0026#34;) endif() target_link_libraries(Tutorial PUBLIC ${EXTRA_LIBS}) target_include_directories(Tutorial PUBLIC \u0026#34;${PROJECT_BINARY_DIR}\u0026#34; \u0026#34;${EXTRA_INCLUDES}\u0026#34; ) list() å‘½ä»¤ç”¨äºæ“ä½œåˆ—è¡¨ï¼ŒAPPEND å¯ä»¥å°†ä¸€ä¸ªå…ƒç´ è¿½åŠ åˆ°ä¸€ä¸ªåˆ—è¡¨çš„å°¾éƒ¨ã€‚åé¢é€šè¿‡æ–°å»ºçš„åˆ—è¡¨è°ƒç”¨æ¨¡å—ï¼Œè¿™æ ·çš„è¯ï¼Œåªæœ‰ USE_MYMATH çš„å€¼ä¸º ON æ—¶ï¼Œæ‰ä¼šå°†æ¨¡å—åŒ…å«åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ã€‚\næºç ä¸­çš„ä¿®æ”¹æ¯”è¾ƒç®€å•ï¼Œåªéœ€ä¿®æ”¹ Tutorial.c æ–‡ä»¶ï¼Œé€šè¿‡å®å®šä¹‰å°†æ¨¡å—ç›¸å…³çš„è¯­å¥åšæˆå¯é€‰é¡¹ï¼š\n#ifdef USE_MYMATH #include \u0026#34;MathFunctions/MathFunctions.h\u0026#34; #endif #ifdef USE_MYMATH double output = mysqrt(input); printf(\u0026#34;The square root of %f is %f .\\n\u0026#34;, input, output); #endif è¿™ä¸ªå®å®šä¹‰çš„å€¼ä¹Ÿéœ€è¦é€šè¿‡ TutorialConfig.h.in æ–‡ä»¶ä¼ é€’ç»™æºç ï¼š\n#cmakedefine USE_MYMATH æ‰§è¡Œåˆ° configure_file() å‘½ä»¤çš„æ—¶å€™ï¼Œå¦‚æœ USE_MYMATH çš„å€¼æ˜¯ ON ï¼Œè¿™æ¡è¯­å¥ä¼šè¢«æ›¿æ¢ä¸º #define USE_MYMATH ï¼›å¦‚æœ USE_MYMATH çš„å€¼æ˜¯ OFF ï¼Œè¿™æ¡è¯­å¥ä¼šè¢«æ›¿æ¢ä¸ºä¸€è¡Œæ³¨é‡Š /* #undef USE_MYMATH */ ã€‚\nè®¾ç½®åº“æ–‡ä»¶çš„ä½¿ç”¨è¦æ±‚ #æ„å»º C è¯­è¨€çš„å·¥ç¨‹æ—¶ï¼Œåº”è¯¥æ¸…æ™°çš„è§„åˆ’æ¨¡å—ä¹‹é—´çš„å…³ç³»ï¼Œåœ¨ç¼–è¯‘æ—¶ï¼Œå…ˆç¼–è¯‘å‡ºå­æ¨¡å—çš„ç›®æ ‡æ–‡ä»¶ï¼Œå†ç”±è¿™äº›ç›®æ ‡æ–‡ä»¶é“¾æ¥èµ·æ¥ç”Ÿæˆä¸Šä¸€å±‚çš„ç›®æ ‡æ–‡ä»¶ï¼Œå±‚å±‚é€’è¿›ï¼Œæœ€ç»ˆç¼–è¯‘å‡ºå¯æ‰§è¡Œæ–‡ä»¶ã€‚ç›®æ ‡æ–‡ä»¶åŒ…æ‹¬ add_executable() å’Œ add_library() å‘½ä»¤ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶å’Œåº“ã€‚ç›®æ ‡æ–‡ä»¶çš„ä¾èµ–å…³ç³»æ˜¯é€šè¿‡ä¸¤æ¡å‘½ä»¤æ§åˆ¶çš„ï¼š\ntarget_include_directories() ï¼Œå‘ç›®æ ‡æ–‡ä»¶æ·»åŠ ç¼–è¯‘æ—¶çš„å¤´æ–‡ä»¶æ£€ç´¢ç›®å½•ã€‚ target_link_libraries() ï¼Œå‘ç›®æ ‡æ–‡ä»¶æ·»åŠ ç¼–è¯‘æ—¶ä¾èµ–çš„åº“ã€‚ è¿™ä¸¤æ¡å‘½ä»¤éœ€è¦ä¸€ä¸ªæ§åˆ¶ä¼ é€’å±æ€§çš„å‚æ•°ï¼Œå¯é€‰ä¸‰ç§å…³é”®å­—ï¼š\nPRIVATE ï¼Œç§æœ‰ã€‚åº“æ–‡ä»¶æä¾›çš„æ–¹æ³•åªä¾›ç›®æ ‡æ–‡ä»¶ä½¿ç”¨ï¼Œä¸ä¼šæš´éœ²ç»™æ›´ä¸Šå±‚ç›®æ ‡æ–‡ä»¶ã€‚å³ç”Ÿäº§è€…éœ€è¦ï¼Œæ¶ˆè´¹è€…ä¸éœ€è¦ã€‚ INTERFACE ï¼Œæ¥å£ã€‚åº“æ–‡ä»¶æä¾›çš„æ–¹æ³•ä¼šæš´éœ²ç»™ä¸Šå±‚æ–‡ä»¶ä½¿ç”¨ï¼Œæœ¬ç›®æ ‡æ–‡ä»¶åªç”¨åˆ°äº†åº“æ–‡ä»¶æä¾›çš„ä¸€äº›æ•°æ®ç»“æ„å’Œå£°æ˜ç­‰ã€‚å³ç”Ÿäº§è€…ä¸éœ€è¦ï¼Œæ¶ˆè´¹è€…éœ€è¦ã€‚ PUBLIC ï¼Œå…¬å¼€ã€‚åº“æ–‡ä»¶æä¾›çš„æ–¹æ³•å¯ä»¥ä¾›æ‰€æœ‰ç›®æ ‡æ–‡ä»¶ä½¿ç”¨ã€‚å³ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…éƒ½éœ€è¦ã€‚ ä»¥ä¸Šä¸€èŠ‚çš„å·¥ç¨‹ä¸ºä¾‹ï¼Œç›®å½•ç»“æœæ˜¯ï¼š\n. â”œâ”€â”€ build â”œâ”€â”€ CMakeLists.txt â”œâ”€â”€ MathFunctions # ç”Ÿæˆ libMathFunctions.a â”‚ â”œâ”€â”€ CMakeLists.txt â”‚ â”œâ”€â”€ MathFunctions.h â”‚ â””â”€â”€ mysqrt.c â”œâ”€â”€ Tutorial.c â””â”€â”€ TutorialConfig.h.in ç›®æ ‡ MathFunctions éœ€è¦çš„å¤´æ–‡ä»¶ MathFunctions.h ä¸­çš„å£°æ˜ï¼Œå¹¶å°†æ–¹æ³•æš´éœ²ç»™ä¸Šä¸€å±‚çš„ Tutorial.c ä½¿ç”¨ã€‚æ‰€ä»¥ï¼Œç›®æ ‡ MathFunctions å¯¹å¤´æ–‡ä»¶ MathFunctions.h çš„ä½¿ç”¨è¦æ±‚å°±æ˜¯ INTERFACE ï¼Œç›®æ ‡ Tutrial å¯¹ç›®æ ‡ MathFunctions çš„ä½¿ç”¨è¦æ±‚æ˜¯ PRIVATE ã€‚\né‚£ä¹ˆï¼Œå¯ä»¥åœ¨ MathFunctions/CMakeLists.txt ä¸­æ·»åŠ ä¸€è¡Œï¼š\ntarget_include_directories(MathFunctions INTERFACE ${CMAKE_CURRENT_SOURCE_DIR} ) ç„¶åå°±å¯ä»¥æŠŠé¡¶å±‚ CMakeLists.txt ä¸­åŒ…å«å¤´æ–‡ä»¶çš„éƒ¨åˆ†åˆ é™¤ï¼Œå¹¶å°†åº“æ–‡ä»¶çš„ä½¿ç”¨è¦æ±‚æ”¹ä¸ºç§æœ‰ï¼š\nif(USE_MYMATH) add_subdirectory(MathFunctions) list(APPEND EXTRA_LIBS MathFunctions) endif() target_link_libraries(Tutorial PRIVATE ${EXTRA_LIBS}) target_include_directories(Tutorial PRIVATE \u0026#34;${PROJECT_BINARY_DIR}\u0026#34; ) 3. å®‰è£…å’Œæµ‹è¯• #è¿™ä¸ªå·¥ç¨‹åªéœ€è¦æŠŠå¯æ‰§è¡Œæ–‡ä»¶å®‰è£…åˆ°æŒ‡å®šçš„ç›®å½•ï¼Œæ‰€ä»¥ï¼Œåœ¨é¡¶å±‚ CMakeLists.txt ç›®å½•ä¸‹æ·»åŠ ä¸€è¡Œï¼š\ninstall(TARGETS Tutorial DESTINATION bin) è¿™æ ·ï¼Œåœ¨æ‰§è¡Œ make install æ—¶ï¼Œå°±ä¼šæŠŠ Tutorial æ–‡ä»¶å®‰è£…åˆ° /usr/local/bin/ ç›®å½•ä¸‹ï¼Œé»˜è®¤çš„å‰ç¼€æ˜¯ /usr/local/ ï¼Œå¦‚æœè¦æ¢åˆ«çš„ç›®å½•ï¼Œå¯ä»¥å†™ä¸Šç»å¯¹è·¯å¾„ã€‚\n","date":"2020 June 29","permalink":"/posts/2020/06/29/","section":"Posts","summary":"æœ¬æ•™ç¨‹æä¾›äº†ä¸€ä¸ªæ¸è¿›å¼çš„æŒ‡å¯¼ï¼Œå‚è€ƒçš„æ˜¯å®˜æ–¹æ•™ç¨‹ CMake Tutorial ï¼Œç„¶ååŠ å…¥å­¦ä¹ è¿‡ç¨‹çš„ç¬”è®°ã€‚æ¶µç›–äº†ä½¿ç”¨ CMake æ„å»ºä¸€ä¸ªå·¥ç¨‹æ—¶ç»å¸¸é‡åˆ°çš„é—®é¢˜ ã€‚é€šè¿‡ä¸€ä¸ªç¤ºä¾‹é¡¹ç›®ï¼Œå±•ç¤ºå„ç§åŠŸèƒ½æ˜¯å¦‚ä½•ä¸€èµ·å·¥ä½œçš„ï¼Œè¿™å¯¹ç†è§£ CMake éå¸¸æœ‰ç”¨ã€‚","title":"CMake å­¦ä¹ ç¬”è®°"},{"content":"tcpdump æ˜¯ä¸€ä¸ªå¸®åŠ©ç”¨æˆ·æ•è·ã€ç­›é€‰å’Œè§£æ TCP/IP åè®®æ•°æ®åŒ…çš„å‘½ä»¤è¡Œå·¥å…·ã€‚\n1. åŸºæœ¬ç”¨æ³• #ä¸‹é¢å±•ç¤ºäº† tcpdump çš„å¸¸ç”¨çš„é€‰é¡¹ï¼š\n:~$ tcpdump -nn -s0 -v -i en0 port 80 -i ï¼šæŒ‡å®šéœ€è¦ç›‘å¬çš„ç½‘å¡ï¼Œå¯ä»¥æ˜¯ç‰©ç†ç½‘å¡ï¼Œä¹Ÿå¯ä»¥æ˜¯è™šæ‹Ÿç½‘å¡ã€‚é€”å¾„è¯¥ç½‘å¡çš„æ•°æ®åŒ…éƒ½ä¼šè¢«æ•è·ï¼Œç„¶åç”¨è¿‡æ»¤å™¨çš„è§„åˆ™è¿›è¡Œç­›é€‰ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤ä¼šç›‘å¬æœ¬æœºçš„æ‰€æœ‰ç½‘å¡ã€‚ port ï¼šè¿™æ˜¯ä¸€ä¸ªè¿‡æ»¤å™¨è§„åˆ™ï¼Œè¡¨ç¤ºåªæ˜¾ç¤ºä½¿ç”¨è¯¥ç«¯å£æ”¶å‘çš„æ•°æ®ã€‚ -nn ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œtcpdump ä¼šå°† ip å’Œç«¯å£å·è§£æä¸ºå­—ç¬¦ä¸²çš„å½¢å¼ï¼Œä¾‹å¦‚ 80 ç«¯å£ä¼šæ˜¾ç¤ºä¸º http ã€‚å¯ä»¥ç”¨ -n è¡¨ç¤ºä¸è§£æä¸»æœºåï¼Œ-nn è¡¨ç¤ºä¸è§£æä¸»æœºåå’Œç«¯å£å·ï¼Œè¿™æ ·å¯ä»¥åŠ å¿«é€Ÿåº¦ï¼Œä¹Ÿæ–¹ä¾¿æŸ¥çœ‹ã€‚ -s0 ï¼šè®¾ç½®è¦æ•è·çš„æ•°æ®åŒ…çš„å¤§å°ï¼Œs0 è¡¨ç¤ºä¸é™åˆ¶å¤§å°ã€‚ -v ï¼šè¡¨ç¤ºç²—ç•¥æ˜¾ç¤ºæ•°æ®åŒ…çš„å†…å®¹ï¼Œ-vv å¯ä»¥å¢åŠ æ˜¾ç¤ºæ•°æ®åŒ…çš„ç»†èŠ‚ã€‚ 1.1 æ˜¾ç¤ºæ§åˆ¶ #ä½¿ç”¨ -A é€‰é¡¹å¯ä»¥å°†æ•°æ®åŒ…çš„å†…å®¹ä»¥ ASCII å­—ç¬¦å½¢å¼æ˜¾ç¤ºï¼Œæ–¹ä¾¿é˜…è¯»ï¼Œå¦ä¸€ä¸ªé€‰é¡¹ -X å¯ä»¥è®©æ•°æ®åŒ…çš„å†…å®¹åŒæ—¶ä»¥ 16 è¿›åˆ¶å’Œ ASCII å­—ç¬¦å½¢å¼æ˜¾ç¤ºï¼Œä¾‹å¦‚ï¼š\n:~$ tcpdump -nn -s0 -v -i en0 port 80 -X tcpdump: listening on en0, link-type EN10MB (Ethernet), capture size 262144 bytes 08:51:01.902291 IP (tos 0x0, ttl 64, id 0, offset 0, flags [DF], proto TCP (6), length 40) 192.168.50.102.53936 \u0026gt; 120.92.84.16.80: Flags [F.], cksum 0xefc2 (correct), seq 710116020, ack 2044458673, win 4096, length 0 0x0000: 4500 0028 0000 4000 4006 7b55 c0a8 3266 E..(..@.@.{U..2f 0x0010: 785c 5410 d2b0 0050 2a53 82b4 79db f6b1 x\\T....P*S..y... 0x0020: 5011 1000 efc2 0000 P....... 1.2 ç»„åˆè§„åˆ™ #å¤šç§è¿‡æ»¤å™¨è§„åˆ™å¯ä»¥ç”¨æ ‡å‡†é€»è¾‘è¿›è¡Œç»„åˆã€‚\nand æˆ–è€… \u0026amp;\u0026amp; è¡¨ç¤º ä¸ or æˆ–è€… || è¡¨ç¤ºæˆ– not æˆ–è€… ! è¡¨ç¤ºé 1.3 å†™å…¥æ–‡ä»¶ #ç”¨ -w [filename] é€‰é¡¹å¯ä»¥å°†ç­›é€‰è§£æåçš„æ•°æ®ä»¥ pcap æ ¼å¼å†™å…¥æ–‡ä»¶ï¼Œè¿™ç§æ ¼å¼å¯ä»¥ç”¨ wireshark æ‰“å¼€æ˜¾ç¤ºï¼Œæ–¹ä¾¿æŸ¥çœ‹ã€‚ä¾‹å¦‚ï¼š\n:~$ tcpdump -nn -s0 -v -i en0 port 80 -w test.pcap 1.4 è¡Œç¼“å­˜æ¨¡å¼ #å¦‚æœæƒ³å®æ—¶å°†æŠ“å–åˆ°çš„æ•°æ®é€šè¿‡ç®¡é“ä¼ é€’ç»™å…¶ä»–å·¥å…·æ¥å¤„ç†ï¼Œéœ€è¦ä½¿ç”¨ -l é€‰é¡¹æ¥å¼€å¯è¡Œç¼“å­˜æ¨¡å¼ï¼ˆæˆ–ä½¿ç”¨ -c é€‰é¡¹æ¥å¼€å¯æ•°æ®åŒ…ç¼“å­˜æ¨¡å¼ï¼‰ã€‚å®ƒå¯ä»¥å°†æ ‡å‡†è¾“å‡ºç«‹å³å‘é€ç»™å…¶ä»–å‘½ä»¤ï¼Œå…¶ä»–å‘½ä»¤ä¼šç«‹å³å“åº”ã€‚ä¾‹å¦‚ï¼š\n:~$ tcpdump -l | tee dat 2. è¿‡æ»¤å™¨ #2.1 ç­›é€‰ IP #ç­›é€‰ç›®çš„ IP æˆ–è€…æº IP ä¸ºç‰¹å®šå€¼çš„æ•°æ®åŒ…ï¼š\n:~$ tcpdump -i en0 host 192.168.1.1 ä¹Ÿå¯ç”¨ src ç­›é€‰æº IP ä¸ºç‰¹å®šå€¼çš„æ•°æ®åŒ…ï¼Œç”¨ dst ç­›é€‰ç›®çš„ IP ä¸ºç‰¹å®šåœ¨çš„æ•°æ®åŒ…ï¼š\n:~$ tcpdump -i en0 dst 192.168.1.1 2.2 ç­›é€‰ç«¯å£ #ä½¿ç”¨ port é€‰é¡¹å¯ä»¥ç­›é€‰é€šè¿‡ç‰¹å®šç«¯å£æ”¶å‘çš„æ•°æ®åŒ…ï¼Œä¾‹å¦‚ï¼š\n:~$ tcpdump -i en0 port 80 ä¹Ÿå¯ä»¥ç­›é€‰ç‰¹å®šèŒƒå›´å†…çš„ç«¯å£ï¼š\n:~$ tcpdump -i en0 portrange 21-23 2.2 ç­›é€‰åè®® #ä½¿ç”¨ proto é€‰é¡¹å¯ä»¥ç­›é€‰ç‰¹å®šåè®®çš„æ•°æ®åŒ…ï¼Œä¾‹å¦‚åªæ˜¾ç¤º upd æ•°æ®åŒ…ï¼š\n:~$ tcpdump -i en0 proto udp å…³é”®å­— proto å¯ä»¥çœç•¥ï¼Œç›´æ¥å†™åè®®åç§°ï¼Œæ”¯æŒçš„åè®®æœ‰ icmp, igmp, igrp, pim, ah, esp, carp, vrrp, udpå’Œ tcp ã€‚\n","date":"2020 April 12","permalink":"/posts/2020/04/12/","section":"Posts","summary":"tcpdump æ˜¯ä¸€ä¸ªå¸®åŠ©ç”¨æˆ·æ•è·ã€ç­›é€‰å’Œè§£æ TCP/IP åè®®æ•°æ®åŒ…çš„å‘½ä»¤è¡Œå·¥å…·ã€‚","title":"tcpdump ä½¿ç”¨ç¬”è®°"},{"content":"This article offers a sample of basic Markdown syntax that can be used in Hugo content files, also it shows whether basic HTML elements are decorated with CSS in a Hugo theme.\nHeadings #The following HTML \u0026lt;h1\u0026gt;â€”\u0026lt;h6\u0026gt; elements represent six levels of section headings. \u0026lt;h1\u0026gt; is the highest section level while \u0026lt;h6\u0026gt; is the lowest.\nH1 #H2 #H3 #H4 #H5 #H6 #Paragraph #Xerum, quo qui aut unt expliquam qui dolut labo. Aque venitatiusda cum, voluptionse latur sitiae dolessi aut parist aut dollo enim qui voluptate ma dolestendit peritin re plis aut quas inctum laceat est volestemque commosa as cus endigna tectur, offic to cor sequas etum rerum idem sintibus eiur? Quianimin porecus evelectur, cum que nis nust voloribus ratem aut omnimi, sitatur? Quiatem. Nam, omnis sum am facea corem alique molestrunt et eos evelece arcillit ut aut eos eos nus, sin conecerem erum fuga. Ri oditatquam, ad quibus unda veliamenimin cusam et facea ipsamus es exerum sitate dolores editium rerore eost, temped molorro ratiae volorro te reribus dolorer sperchicium faceata tiustia prat.\nItatur? Quiatae cullecum rem ent aut odis in re eossequodi nonsequ idebis ne sapicia is sinveli squiatum, core et que aut hariosam ex eat.\nBlockquotes #The blockquote element represents content that is quoted from another source, optionally with a citation which must be within a footer or cite element, and optionally with in-line changes such as annotations and abbreviations.\nBlockquote without attribution # Tiam, ad mint andaepu dandae nostion secatur sequo quae. Note that you can use Markdown syntax within a blockquote.\nBlockquote with attribution # Don\u0026rsquo;t communicate by sharing memory, share memory by communicating. â€” Rob Pike1\nTables #Tables aren\u0026rsquo;t part of the core Markdown spec, but Hugo supports supports them out-of-the-box.\nName Age Bob 27 Alice 23 Code Blocks #Code block with backticks\nhtml \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Example HTML5 Document\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;p\u0026gt;Test\u0026lt;/p\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; List Types #Ordered List\nFirst item Second item Third item Unordered List\nList item Another item And another item ","date":"2020 January 15","permalink":"/posts/2020/01/15/","section":"Posts","summary":"This article offers a sample of basic Markdown syntax that can be used in Hugo content files, also it shows whether basic HTML elements are decorated with CSS in a Hugo theme.","title":"Markdown Syntax Guide"},{"content":"iproute2 æ˜¯ä¸€ä¸ª Linux ç½‘ç»œç®¡ç†å·¥å…·åŒ…ï¼Œæä¾›äº† ip ã€tc ã€ss ç­‰ç»„ä»¶ï¼Œé›†æˆäº†åŸæœ‰çš„ ifconfg ã€arp ã€route ã€netstat ç­‰å¤šç§å‘½ä»¤çš„åŠŸèƒ½ï¼Œå¹¶æ–°å¢äº†å¾ˆå¤šç‰¹æ€§ã€‚\n1. ip å‘½ä»¤ #ip å‘½ä»¤çš„è¯­æ³•æ˜¯ï¼š\nip [OPTIONS] OBJECT {COMMAND|help} å…¶ä¸­ï¼š\nOBJECT è¡¨ç¤ºæ“ä½œå¯¹è±¡ï¼Œå¯é€‰çš„å€¼æœ‰ { link | addr | addrlabel | route | rule | neigh | ntable | tunnel | maddr | mroute | mrule | monitor | xfrm | token } ï¼Œå¸¸ç”¨çš„å¯¹è±¡åŒ…æ‹¬ï¼š linkï¼šç½‘ç»œè®¾å¤‡ addrï¼šè®¾å¤‡ä¸Šçš„åè®®ï¼ˆIPæˆ–IPv6ï¼‰åœ°å€ addrlabelï¼šåè®®åœ°å€é€‰æ‹©çš„æ ‡ç­¾é…ç½® routeï¼šè·¯ç”±è¡¨æ¡ç›® ruleï¼šè·¯ç”±ç­–ç•¥æ•°æ®åº“ä¸­çš„è§„åˆ™ neigh: ARP è¡¨ OPTIONS è¡¨ç¤ºé€‰é¡¹ï¼Œå¯é€‰çš„å€¼æœ‰ { -V[ersion] | -s[tatistics] | -d[etails] | -r[esolve] | -h[uman-readable] | -iec | -f[amily] { inet | inet6 | ipx | dnet | link } | -o[neline] | -t[imestamp] | -b[atch] [filename] | -rc[vbuf] [size] } å¸¸ç”¨çš„é€‰é¡¹åŒ…æ‹¬ï¼š -Vï¼Œ-Versionï¼šæ˜¾ç¤ºæŒ‡ä»¤ç‰ˆæœ¬ä¿¡æ¯ -sï¼Œ-statsï¼Œstatisticsï¼šè¾“å‡ºè¯¦ç»†ä¿¡æ¯ -hï¼Œ-humanï¼Œ-human-readableï¼šè¾“å‡ºäººç±»å¯è¯»çš„ç»Ÿè®¡ä¿¡æ¯å’Œåç¼€ -oï¼Œ-onelineï¼šå°†æ¯æ¡è®°å½•è¾“å‡ºåˆ°ä¸€è¡Œï¼Œç”¨ \\ å­—ç¬¦æ›¿æ¢æ¢è¡Œç¬¦ 1.1 é…ç½®ç½‘å¡ #è°ƒç”¨ ip addr å¯ä»¥æŸ¥çœ‹æ‰€æœ‰ç½‘å¡çš„ä¿¡æ¯å’Œé…ç½®ï¼Œä¹Ÿå¯ä»¥åœ¨åè¿½åŠ ç½‘å¡çš„æ¥å£åç§°ï¼Œå•ç‹¬æŸ¥çœ‹ç‰¹å®šç½‘å¡ï¼Œä»¥ enp1s0 ä¸ºä¾‹ï¼š\nroot@localhost:~# ip addr show enp1s0 3: enp1s0: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc mq state UP group default qlen 1000 link/ether 00:1d:f3:52:b7:94 brd ff:ff:ff:ff:ff:ff inet 192.168.5.242/24 brd 192.168.5.255 scope global enp1s0 valid_lft forever preferred_lft forever inet6 fe80::21d:f3ff:fe52:b794/64 scope link valid_lft forever preferred_lft forever æ¯ä¸ªå­—æ®µçš„å«ä¹‰ï¼š\n\u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; : BROADCASTè¡¨ç¤ºè¯¥æ¥å£æ”¯æŒå¹¿æ’­ï¼›MULTICASTè¡¨ç¤ºè¯¥æ¥å£æ”¯æŒå¤šæ’­ï¼›UPè¡¨ç¤ºè¯¥ç½‘ç»œæ¥å£å·²å¯ç”¨ï¼›LOWER_UPè¡¨ç¤ºç½‘ç»œç”µç¼†å·²æ’å…¥ï¼Œè®¾å¤‡å·²è¿æ¥è‡³ç½‘ç»œã€‚ mtu 1500ï¼šæœ€å¤§ä¼ è¾“å•å…ƒï¼ˆé“¾è·¯å±‚æœ€å¤§ä¸€æ¬¡ä¼ è¾“çš„ä¸Šå±‚æ•°æ®å¤§å°ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ª IP åŒ…çš„æœ€å¤§å€¼ï¼‰ä¸º 1500 å­—èŠ‚ã€‚ qdisc mqï¼šç”¨äºæ•°æ®åŒ…æ’é˜Ÿ ã€‚ state UPï¼šç½‘ç»œæ¥å£å·²å¯ç”¨ï¼Œå¦‚æœæ¥å£æ²¡æœ‰å¯ç”¨ï¼Œä¼šæ˜¾ç¤º DOWN ã€‚ qlen 1000ï¼šä¼ è¾“é˜Ÿåˆ—é•¿åº¦ã€‚ link/ether 00:1d:f3:52:b7:94 : ç½‘å¡çš„ MAC åœ°å€ã€‚ brd ff:ff:ff:ff:ff:ff : å¹¿æ’­ MAC åœ°å€ã€‚ inet 192.168.5.242/24 : ç½‘å¡çš„ IPv4 åœ°å€ã€‚ brd 192.168.5.255 : å¹¿æ’­ IPv4 åœ°å€ã€‚ scope globalï¼šå…¨å±€æœ‰æ•ˆï¼Œå¦‚æœæ˜¾ç¤ºä¸º link è¡¨ç¤ºä»…å¯¹æ­¤è®¾å¤‡æœ‰æ•ˆã€‚ enp1s0 : å¦‚æœå‰é¢æœ‰ dynamic å­—ç¬¦ï¼Œè¡¨ç¤ºè¿™ä¸ªç½‘å¡çš„ IP æ˜¯åŠ¨æ€è·å–çš„ã€‚ valid_lft forever : IP çš„æœ‰æ•ˆæœŸæ˜¯æ°¸ä¹…ï¼Œå¦‚æœæ˜¯åŠ¨æ€è·å–çš„ IP ï¼Œä¼šæ˜¾ç¤ºå‰©ä½™çš„æœ‰æ•ˆæ—¶é—´ã€‚ preferred_lft forever : é¦–é€‰ IP çš„åœ°å€çš„æœ‰æ•ˆæœŸã€‚ ä¸ºç½‘å¡æ·»åŠ æˆ–è€…åˆ é™¤ä¸€ä¸ª IP åœ°å€ï¼š\nip addr add/del 192.168.0.123/24 dev enp1s0 å¯åŠ¨æˆ–è€…ç¦ç”¨ä¸€ä¸ªç½‘å¡ï¼š\nip link set enp1s0 up/down è®¾ç½®ç½‘å¡çš„å…¶ä»–ç‰¹æ€§ä¹Ÿå¯ä»¥ç”¨ ip link set è¯­æ³•ã€‚ä¾‹å¦‚ï¼š\narp on/off : æ”¹å˜ç½‘å¡çš„ NOARP æ ‡è¯†ï¼Œè®¾ä¸º off è¡¨ç¤ºç¦ç”¨è¯¥ç½‘å¡çš„ ARP åè®®ã€‚ç½‘å¡å¤„äº UP çŠ¶æ€æ—¶ä¸èƒ½æ‰§è¡Œè¿™ä¸ªæ“ä½œã€‚ multicast on/off : æ”¹å˜ç½‘å¡çš„ MULTICAST æ ‡è¯†ï¼Œè®¾ä¸º off è¡¨ç¤ºç¦ç”¨è¯¥ç½‘å¡çš„ç»„æ’­ã€‚ dynamic on/off : æ”¹å˜ç½‘å¡çš„ DYNAMIC æ ‡è¯†ï¼Œè®¾ä¸º off è¡¨ç¤ºç¦æ­¢è¯¥ç½‘å¡åŠ¨æ€è·å– IPã€‚ mtu NUMBER : è®¾ç½®è¯¥ç½‘å¡çš„æœ€å¤§ä¼ è¾“å•å…ƒã€‚ æŸ¥çœ‹ç½‘å¡çš„æµé‡ç»Ÿè®¡ï¼š\nroot@localhost:~# ip -s -s link ls enp1s0 3: enp1s0: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc mq state UP mode DEFAULT group default qlen 1000 link/ether 00:1d:f3:52:b7:94 brd ff:ff:ff:ff:ff:ff RX: bytes packets errors dropped overrun mcast 42861012 137710 0 0 0 151 RX errors: length crc frame fifo missed 0 0 0 0 0 TX: bytes packets errors dropped carrier collsns 520406 6159 0 0 0 0 TX errors: aborted fifo window heartbeat transns 0 0 0 0 2 1.2 é…ç½®è·¯ç”±è¡¨ #æ˜¾ç¤ºç³»ç»Ÿçš„è·¯ç”±è¡¨ï¼š\nroot@localhost:~# ip route show default via 10.76.141.9 dev enp0s29u1u4c2 proto static metric 100 10.76.141.8/29 dev enp0s29u1u4c2 proto kernel scope link src 10.76.141.12 metric 100 192.168.5.0/24 dev enp1s0 proto kernel scope link src 192.168.5.242 metric 100 192.168.99.0/24 dev wlp3s0 proto kernel scope link src 192.168.99.1 metric 600 default ä¸€è¡Œè¡¨ç¤ºç¼ºçœè·¯ç”±ã€‚\nvia 10.76.141.9 è¡¨ç¤ºç½‘å…³ï¼Œä¹Ÿå°±æ˜¯å“ä¸€è·³çš„ IP ã€‚\næ™®é€šè·¯ç”±çš„ç¬¬ä¸€ä¸ªå­—æ®µè¡¨ç¤ºç›®æ ‡ç½‘æ®µã€‚\ndev enp1s0 è¡¨ç¤ºå‡ºå£ç½‘å¡ã€‚\nmetric 100 è¡¨ç¤ºä¼˜å…ˆçº§ï¼Œæ•°å­—å°çš„ä¼˜å…ˆã€‚\næ·»åŠ ä¸€æ¡åˆ°ä¸»æœºçš„é™æ€è·¯ç”±ï¼š\nip route add 192.0.2.1 via 192.168.145.2 dev enp1s0 add è¡¨ç¤ºæ·»åŠ ï¼Œå¦‚æœè¦åˆ é™¤å¯ä»¥ç”¨ del å‘½ä»¤ 192.0.2.1 è¡¨ç¤ºç›®æ ‡ä¸»æœºçš„ IP via 192.168.145.2 è¡¨ç¤ºå“ä¸€è·³åœ°å€ dev enp1s0 è¡¨ç¤ºå‡ºå£çš„ç½‘å¡è®¾å¤‡ å¦‚æœè¦æ·»åŠ åˆ°ç½‘ç»œçš„é™æ€è·¯ç”±ï¼Œå°†ç›®æ ‡åœ°å€è®¾ä¸ºä¸€ä¸ªç½‘æ®µå³å¯ï¼š\nip route add 192.0.2.1/24 via 192.168.145.2 dev enp1s0 å¦‚æœè¦æ·»åŠ ä¸€æ¡é»˜è®¤è·¯ç”±ï¼Œå°†ç›®æ ‡åœ°å€è®¾ä¸º default å³å¯ï¼š\nip route add default via 192.168.145.2 dev enp1s0 1.3 é…ç½® ARP #æŸ¥çœ‹ç³»ç»Ÿçš„ ARP ç¼“å­˜ï¼š\nroot@localhost:~# ip neigh show 192.168.5.252 dev enp1s0 lladdr 8c:a6:df:0c:7a:0a REACHABLE 192.168.5.36 dev enp1s0 lladdr 98:ee:cb:a9:c1:98 STALE 192.168.5.50 dev enp1s0 lladdr f8:7b:20:ee:d2:47 STALE 192.168.5.64 dev enp1s0 lladdr 74:27:ea:6f:08:35 STALE 10.76.141.9 dev enp0s29u1u4c2 lladdr 4c:54:99:45:e5:d5 REACHABLE fe80::4e54:99ff:fe45:e5d5 dev enp0s29u1u4c2 lladdr 4c:54:99:45:e5:d5 router REACHABLE æ¯ä¸€è¡Œéƒ½æ˜¯ä¸€æ¡ ARP ï¼Œä»¥ç¬¬ä¸€è¡Œä¸ºä¾‹ï¼š\n192.168.5.252 è¡¨ç¤ºè®¾å¤‡çš„ IP ã€‚ dev enp1s0 è¡¨ç¤ºå‘ç°æ­¤è®¾å¤‡çš„ç½‘å¡ã€‚ lladdr 8c:a6:df:0c:7a:0a è¡¨ç¤ºæ­¤è®¾å¤‡çš„ MAC åœ°å€ã€‚ REACHABLE è¡¨ç¤ºè¿™æ¡ ARP æ¡ç›®çš„çŠ¶æ€ï¼š REACHABLE è¡¨ç¤ºæ¡ç›®æœ‰æ•ˆï¼Œè®¾å¤‡åœ¨çº¿ã€‚ STALE è¡¨ç¤ºæ¡ç›®æœ‰æ•ˆï¼Œä½†æ˜¯è®¾å¤‡æœªå¿…åœ¨çº¿ã€‚ FAILED è¡¨ç¤ºæ¡ç›®æ— æ•ˆï¼Œè®¾å¤‡ä¸åœ¨çº¿ã€‚ PERMANENT è¡¨ç¤ºæ­¤æ¡ç›®æ°¸ä¹…æœ‰æ•ˆï¼Œç›´åˆ°ç®¡ç†å‘˜å°†å…¶åˆ é™¤ï¼Œé€šå¸¸æ˜¯æ‰‹åŠ¨æ·»åŠ çš„é™æ€ ARP ç»‘å®šã€‚ æ·»åŠ ä¸€æ¡é™æ€ ARP ï¼š\nip neight add dev enp1s0 add 192.168.5.50 lladdr f8:7b:20:ee:d2:47 nud permanent å¦‚æœ ARP è¡¨ä¸­å·²ç»å­˜åœ¨äº†è¿™æ ·çš„ ARP æ˜ å°„ï¼Œæ‰§è¡Œ add å‘½ä»¤ä¼šæŠ¥é”™ï¼Œå¯ä»¥ç”¨ replace å°†å…¶æ›¿æ¢ï¼Œå…¶ä»–å‚æ•°ä¸å˜ï¼š\nip neight relpace dev enp1s0 add 192.168.5.50 lladdr f8:7b:20:ee:d2:47 nud permanent åˆ é™¤ä¸€æ¡ ARP æ—¶ä¸ç”¨è¿™ä¹ˆå¤šå‚æ•°ï¼Œåªéœ€æŒ‡å®šæ¥å£å’Œ IP å³å¯ï¼š\nip neight delete dev enp1s0 add 192.168.5.50 æ¸…ç©ºå½“å‰ ARP è¡¨ï¼š\nip neight flush dev enp1s0 2. ss å‘½ä»¤ #ss æ˜¯æŸ¥çœ‹ socket è¿æ¥ä¿¡æ¯çš„å·¥å…·ã€‚å¸¸ç”¨çš„å‚æ•°æœ‰ï¼š\n-a ï¼Œæ˜¾ç¤ºæ‰€æœ‰ socket è¿æ¥çš„ä¿¡æ¯ã€‚ -4 ï¼Œåªæ˜¾ç¤º IPv4 çš„ socket ã€‚ -6 ï¼Œåªæ˜¾ç¤º IPv6 çš„ socket ã€‚ -t ï¼Œåªæ˜¾ç¤º TCP åè®®çš„ socket ã€‚ -u ï¼Œåªæ˜¾ç¤º UCP åè®®çš„ socket ã€‚ -x ï¼Œåªæ˜¾ç¤º Unix åŸŸçš„ socket ã€‚ -l ï¼Œæ˜¾ç¤ºå¤„äº LISTEN çŠ¶æ€çš„ socket ã€‚ -o ï¼Œæ˜¾ç¤ºå®šæ—¶å™¨ä¿¡æ¯ã€‚ -p ï¼Œ -e ï¼Œ å‚è€ƒï¼š # http://www.policyrouting.org/iproute2.doc.html\nhttps://linux.cn/article-3144-1.html\n","date":"2020 January 8","permalink":"/posts/2020/01/08/","section":"Posts","summary":"iproute2 æ˜¯ä¸€ä¸ª Linux ç½‘ç»œç®¡ç†å·¥å…·åŒ…ï¼Œæä¾›äº† ip ã€tc ã€ss ç­‰ç»„ä»¶ï¼Œé›†æˆäº†åŸæœ‰çš„ ifconfg ã€arp ã€route ã€netstat ç­‰å¤šç§å‘½ä»¤çš„åŠŸèƒ½ï¼Œå¹¶æ–°å¢äº†å¾ˆå¤šç‰¹æ€§ã€‚","title":"iproute2 å­¦ä¹ ç¬”è®°"},{"content":"UCI å’Œ ubus éƒ½æ˜¯ Openwrt é¡¹ç›®æä¾›çš„è½¯ä»¶ï¼ŒUCI æä¾›äº†ç»Ÿä¸€çš„é…ç½®æ–‡ä»¶æ ¼å¼å’Œè¯»å†™å·¥å…·ï¼Œubus æä¾›äº†åŸºäº Unix Socket çš„è¿›ç¨‹é—´é€šä¿¡æ¡†æ¶ã€‚ä¸¤ä¸ªè½¯ä»¶éƒ½å¯ä»¥æ–¹ä¾¿çš„ç§»æ¤åˆ°å…¶ä»– Linux ç³»ç»Ÿï¼Œä»¥ Ubuntu20.04 ä¸ºä¾‹ï¼Œé¦–å…ˆè¦å®‰è£…ä¸€äº›ä¾èµ–çš„è½¯ä»¶ï¼š\napt-get install pkg-config apt-get install lua5.1 apt-get install liblua5.1-dev apt-get install cmake apt-get install libjson-c-dev ç„¶åè¦ç¼–è¯‘å®‰è£… libubox ï¼š\ngit clone https://git.openwrt.org/project/libubox.git cd libubox cmake . make make install ç¼–è¯‘æ—¶å¯èƒ½å‡ºç°æ‰¾ä¸åˆ°å¤´æ–‡ä»¶çš„é”™è¯¯ï¼š\n/root/libubox/lua/uloop.c:21:17: fatal error: lua.h: No such file or directory è¿™æ˜¯è·¯å¾„é—®é¢˜ï¼Œå› ä¸º lua çš„å¤´æ–‡ä»¶åœ¨ /usr/include/lua5.1 ç›®å½•ä¸‹ï¼Œæ‰€æœ‰ä¿®æ”¹ uloop.c æ–‡ä»¶ï¼Œä¸º lua.h ç­‰å¤´æ–‡ä»¶å‰é¢åŠ ä¸Š lua5.1/ è·¯å¾„ï¼š\n#include \u0026lt;lua5.1/lua.h\u0026gt; #include \u0026lt;lua5.1/lualib.h\u0026gt; #include \u0026lt;lua5.1/lauxlib.h\u0026gt; 1. UCI #å®˜æ–¹æ–‡æ¡£ï¼šhttps://openwrt.org/docs/guide-user/base-system/uci\nç¼–è¯‘å®‰è£… uci ï¼š\ngit clone https://git.openwrt.org/project/uci.git cd uci cmake . make make install # é»˜è®¤éƒ½å®‰è£…åœ¨ /usr/local è·¯å¾„ä¸‹ å®‰è£…å®Œæˆåæ‰§è¡Œä¸€æ¬¡ sudo ldconfig -v ï¼Œå¦åˆ™å¯èƒ½æ‰¾ä¸åˆ°åˆšå®‰è£…çš„å…±äº«åº“ã€‚\nUCI çš„å…¨ç§°å«åšç»Ÿä¸€é…ç½®æ¥å£ï¼ˆUnified Configuration Interfaceï¼‰ï¼Œå®ƒçš„ä½œç”¨ä¸ºå„ç§ä¸åŒçš„æœåŠ¡å•å…ƒæä¾›ç»Ÿä¸€çš„é…ç½®æ–‡ä»¶æ ¼å¼å’Œç¼–ç¨‹æ–¹æ³•ã€‚é…ç½®æ–‡ä»¶æ˜¯çº¯æ–‡æœ¬æ–‡ä»¶ï¼Œåªæ”¯æŒ ASCII å­—ç¬¦ï¼ŒUCI æä¾›äº† shell å‘½ä»¤ï¼ŒC è¯­è¨€å’Œ Lua è¯­è¨€ç¼–ç¨‹æ¥å£ï¼Œä¸æ¨èæ‰‹åŠ¨ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œé¿å…å‡ºç°è¯­æ³•é”™è¯¯ã€‚\n1.1 é…ç½®æ–‡ä»¶è¯­æ³• #UCI çš„é…ç½®æ–‡ä»¶é»˜è®¤éƒ½æ”¾åœ¨ /etc/config è·¯å¾„ä¸‹ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰ã€‚é…ç½®æ–‡ä»¶çš„è¯­æ³•æ˜¯ config -\u0026gt; section -\u0026gt; option è¿™æ ·çš„å±‚çº§å…³ç³»ï¼Œä¸€ä¸ªé…ç½®æ–‡ä»¶å°±æ˜¯ä¸€ä¸ª configï¼Œç”±å¤šä¸ª section æ®µç»„æˆçš„ï¼Œæ¯ä¸ª section å†…åŒ…å«äº†ä¸€ç»„é€‰é¡¹å’Œå€¼ï¼Œä»¥äº•å· # å¼€å¤´çš„è¡Œæ˜¯æ³¨é‡Šï¼Œè¯­æ³•å¦‚ä¸‹ï¼š\nconfig \u0026lt;type\u0026gt; [\u0026#34;name\u0026#34;] # section option \u0026lt;name\u0026gt; \u0026#34;\u0026lt;value\u0026gt;\u0026#34; # option ä»¥ openwrt ç³»ç»Ÿçš„ /etc/confg/network æ–‡ä»¶ä¸ºä¾‹ï¼Œç³»ç»Ÿçš„ç½‘ç»œé…ç½®ç¨‹åºåœ¨å¯åŠ¨æ—¶ä¼šè¯»å–å¹¶è§£æè¿™ä¸ªé…ç½®æ–‡ä»¶ï¼Œç„¶åæ ¹æ®æ–‡ä»¶å†…çš„é€‰é¡¹æ¥è®¾ç½®ç½‘å¡å‚æ•°ï¼š\nconfig interface \u0026#39;lan\u0026#39; option ifname \u0026#39;eth0\u0026#39; option proto \u0026#39;static\u0026#39; option netmask \u0026#39;255.255.255.0\u0026#39; option ipaddr \u0026#39;192.168.1.1\u0026#39; config interface \u0026#39;wan\u0026#39; option ifname \u0026#39;eth1\u0026#39; option proto \u0026#39;dhcp\u0026#39; è¿™é‡ŒåŒ…å«äº†ä¸¤ä¸ª section , æ¯ä¸ª section å¿…é¡»ä»¥ config å…³é”®å­—å¼€å¤´ï¼Œåé¢ä¸¤ä¸ªå…ƒç´ åˆ†åˆ«æ˜¯ section çš„ type å’Œ name ï¼Œç”±ç”¨æˆ·è‡ªå®šä¹‰ï¼Œname å¿…é¡»ç”¨å¼•å·åŒ…è£¹ï¼Œå¦‚æœæ²¡æœ‰å®šä¹‰ nameï¼ŒUCI ä¼šè‡ªåŠ¨åˆ†é…ä¸€ä¸ª ID ä½œä¸ºå®ƒçš„ name ï¼Œè¿™å«åšåŒ¿å section ã€‚\næ¯ä¸ª section ä¸‹åŒ…å«äº†è‹¥å¹²é€‰é¡¹ï¼Œä»¥è¡Œä¸ºå•ä½ï¼Œå¿…é¡»ä»¥ option å…³é”®å­—å¼€å¤´ï¼Œåé¢ä¸¤ä¸ªå…ƒç´ åˆ†åˆ«æ˜¯ option çš„ name å’Œ vlaue ï¼Œç”±ç”¨æˆ·è‡ªå®šä¹‰ï¼Œvalue å¿…é¡»ç”¨å¼•å·åŒ…è£¹ï¼Œä¸èƒ½ä¸ºç©ºï¼Œå¦åˆ™è§£ææ—¶ä¼šæŠ¥é”™ã€‚\nè¦è·å– wan å£ç½‘å¡çš„åç§°ï¼Œå¯ä»¥ç”¨ network.wan.ifname å®šä½ï¼š\n$ uci get network.wan.ifname eth1 1.2 shell å‘½ä»¤ #UCI æä¾›äº† uci å‘½ä»¤è¯»å†™é…ç½®æ–‡ä»¶ï¼Œè¯­æ³•å¯ä»¥ç›´æ¥ç”¨ uci -h è·å¾—ï¼Œå¸¸ç”¨çš„å‘½ä»¤ï¼š\nbatch ï¼Œè¿›å…¥ä¸€ä¸ªäº¤äº’ç¯å¢ƒï¼Œå¯ä»¥è¿ç»­æ‰§è¡Œå¤šæ¡ uci å‘½ä»¤ï¼Œç”¨ exit å‘½ä»¤é€€å‡ºã€‚ export [\u0026lt;config\u0026gt;] ï¼Œä»¥ uci é…ç½®æ–‡ä»¶çš„è¯­æ³•æ˜¾ç¤º config çš„å†…å®¹ã€‚ import [\u0026lt;config\u0026gt;] ï¼Œå¯¼å…¥é…ç½®æ–‡ä»¶ã€‚ changes [\u0026lt;config\u0026gt;] ï¼Œæ˜¾ç¤ºå·²ä¿®æ”¹æœªä¿å­˜çš„å†…å®¹ã€‚ commit [\u0026lt;config\u0026gt;] ï¼Œå°†ä¿®æ”¹å†…å®¹æäº¤ä¿å­˜åˆ°é…ç½®æ–‡ä»¶ã€‚ add \u0026lt;config\u0026gt; \u0026lt;section-type\u0026gt; ï¼Œæ·»åŠ ä¸€ä¸ªåŒ¿å section ã€‚ add_list \u0026lt;config\u0026gt;.\u0026lt;section\u0026gt;.\u0026lt;option\u0026gt;=\u0026lt;string\u0026gt; ï¼Œæ·»åŠ  list ã€‚ del_list \u0026lt;config\u0026gt;.\u0026lt;section\u0026gt;.\u0026lt;option\u0026gt;=\u0026lt;string\u0026gt; ï¼Œåˆ é™¤ list ã€‚ show [\u0026lt;config\u0026gt;[.\u0026lt;section\u0026gt;[.\u0026lt;option\u0026gt;]]] ï¼Œä»¥ç¼–ç¨‹å¯è¯»çš„è¯­æ³•æ˜¾ç¤º configï¼Œsection æˆ–è€… option çš„å†…å®¹ get \u0026lt;config\u0026gt;.\u0026lt;section\u0026gt;[.\u0026lt;option\u0026gt;] ï¼Œè·å– section çš„ type ï¼Œæˆ–è€… option çš„ value ã€‚ set \u0026lt;config\u0026gt;.\u0026lt;section\u0026gt;[.\u0026lt;option\u0026gt;]=\u0026lt;value\u0026gt; ï¼Œè®¾ç½® section çš„ type ï¼Œæˆ–è€… option çš„ value delete \u0026lt;config\u0026gt;[.\u0026lt;section\u0026gt;[[.\u0026lt;option\u0026gt;][=\u0026lt;id\u0026gt;]]] ï¼Œåˆ é™¤ä¸€ä¸ª sectionï¼Œoption æˆ–è€… option çš„ type rename \u0026lt;config\u0026gt;.\u0026lt;section\u0026gt;[.\u0026lt;option\u0026gt;]=\u0026lt;name\u0026gt; ï¼Œé‡å‘½å section æˆ–è€… option ã€‚ revert \u0026lt;config\u0026gt;[.\u0026lt;section\u0026gt;[.\u0026lt;option\u0026gt;]] ï¼Œæ¢å¤æœªä¿å­˜çš„ä¿®æ”¹å†…å®¹ reorder \u0026lt;config\u0026gt;.\u0026lt;section\u0026gt;=\u0026lt;position\u0026gt; æ–°å»ºä¸€ä¸ª /etc/config/system æ–‡ä»¶ï¼Œç„¶ååšä¸€æ¬¡é…ç½®æµ‹è¯•ï¼š\n# æ·»åŠ ä¸€ä¸ªåŒ¿å section $ sudo uci add system system cfg01e48a # è®¾ç½®ä¸€ä¸ªé€‰é¡¹ hostname ä¸º openwrt $ sudo uci set system.@system[0].hostname=\u0026#34;openwrt\u0026#34; # æŸ¥çœ‹å·²ä¿®æ”¹æœªä¿å­˜çš„å†…å®¹ $ sudo uci changes system system.cfg01e48a=\u0026#39;system\u0026#39; system.cfg01e48a.hostname=\u0026#39;openwrt\u0026#39; # å°†ä¿®æ”¹å†…å®¹æäº¤ä¿å­˜åˆ°é…ç½®æ–‡ä»¶ $ sudo uci commit system # è·å–ä¸€ä¸ªé€‰é¡¹çš„å€¼ $ uci get system.@system[0].hostname openwrt # æŸ¥çœ‹æ–‡ä»¶å†…å®¹ $ cat /etc/config/system config system option hostname \u0026#39;openwrt\u0026#39; uci é»˜è®¤å…ˆå°†ä¿®æ”¹å†…å®¹ä¿å­˜åœ¨ /tmp/.uci/ ç›®å½•ä¸‹çš„ä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œä½¿ç”¨ commit å‘½ä»¤åï¼Œæ‰ä¼šå°†ä¿®æ”¹å†…å®¹åˆå¹¶åˆ° /etc/confg/ ä¸‹çš„æ–‡ä»¶ã€‚è¿˜æ²¡æœ‰ commit çš„å†…å®¹ï¼Œå¯ä»¥ç”¨ revert å‘½ä»¤æ¢å¤ï¼ŒåŸç†å°±æ˜¯åˆ é™¤ä¸´æ—¶æ–‡ä»¶ã€‚\nå°†åŒ¿å section é‡å‘½å ï¼š\n$ uci rename system.@system[0]=info $ uci changes system.cfg01e48a=\u0026#39;info\u0026#39; $ uci show system.info=system system.info.hostname=\u0026#39;openwrt\u0026#39; $ uci commit $ cat /etc/config/system config system \u0026#39;info\u0026#39; option hostname \u0026#39;openwrt\u0026#39; UCI è¿˜æ”¯æŒä¸€ç§ç‰¹åˆ«çš„é€‰é¡¹ list ï¼Œé€šå¸¸ç”¨äºè®°å½•ä¸€ç»„å¸¸é‡ã€‚ä»¥è®¾ç½® ntp æœåŠ¡å™¨ä¸ºä¾‹ï¼š\n$ sudo uci add system timeserver cfg02096b $ sudo uci rename system.@timeserver[0]=ntp $ sudo uci add_list system.ntp.server=\u0026#39;0.de.pool.ntp.org\u0026#39; $ sudo uci add_list system.ntp.server=\u0026#39;1.de.pool.ntp.org\u0026#39; $ sudo uci add_list system.ntp.server=\u0026#39;2.de.pool.ntp.org\u0026#39; $ sudo uci export system package system config system \u0026#39;info\u0026#39; option hostname \u0026#39;openwrt\u0026#39; config timeserver \u0026#39;ntp\u0026#39; list server \u0026#39;0.de.pool.ntp.org\u0026#39; list server \u0026#39;1.de.pool.ntp.org\u0026#39; list server \u0026#39;2.de.pool.ntp.org\u0026#39; $ sudo uci commit åŒåçš„ list å¯ä»¥ä¸€æ¬¡è¯»å–ï¼š\n$ uci get system.ntp.server 0.de.pool.ntp.org 1.de.pool.ntp.org 2.de.pool.ntp.org 1.3 C ç¼–ç¨‹æ¥å£ #ä½¿ç”¨ C è¯­è¨€è§£æ UCI éå¸¸å¤æ‚ï¼Œä¸æ¨èã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œå¯ä»¥è¯»å–ä¸€ä¸ªé€‰é¡¹çš„å€¼ï¼š\n// uci-example.c #include \u0026lt;unistd.h\u0026gt; #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; #include \u0026lt;string.h\u0026gt; #include \u0026lt;uci.h\u0026gt; int main(int argc, char **argv) { struct uci_context *ctx; struct uci_ptr ptr; char *opt = strdup(\u0026#34;system.@system[0].hostname\u0026#34;); // ç”³è¯·ä¸€ä¸ª uci_context ctx = uci_alloc_context(); // è·å–å¹¶æ‰“å°é€‰é¡¹çš„å€¼ if(UCI_OK != uci_lookup_ptr(ctx, \u0026amp;ptr, opt, true)) { uci_perror(ctx, \u0026#34;uci_lookup_ptr():\u0026#34;); } else { printf(\u0026#34;%s\\n\u0026#34;, ptr.o-\u0026gt;v.string); } // é‡Šæ”¾æŒ‡é’ˆ uci_free_context(ctx); free(opt); return 0; } è¦åŒ…å« uci.h å¤´æ–‡ä»¶ï¼Œå…³é”®çš„æ•°æ®ç»“æ„å’Œ API éƒ½å®šä¹‰åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ã€‚\né¦–å…ˆè¦è°ƒç”¨ uci_alloc_context() å‡½æ•°ç”³è¯·ä¸€ä¸ª struct uci_context ç±»å‹çš„æŒ‡é’ˆï¼Œè¯¥ç»“æ„å­˜å‚¨äº†ä½¿ç”¨ UCI è¿‡ç¨‹ä¸­çš„å„ç§çŠ¶æ€æ•°æ®ï¼Œå…¶ä»–æ–¹æ³•éƒ½è¦é€šè¿‡è¿™ä¸ªæŒ‡é’ˆè·å¾—ä¸Šä¸‹æ–‡æ•°æ®ã€‚ä½¿ç”¨å®Œæ¯•ç”¨ uci_free_context() å‡½æ•°é‡Šæ”¾ã€‚\nuci_lookup_ptr() å‡½æ•°çš„ä½œç”¨æ˜¯è§£æ opt ä¼ å…¥çš„ uci å…ƒç´ å®šä½å­—ç¬¦ä¸²ï¼ŒæŸ¥æ‰¾é…ç½®æ–‡ä»¶ï¼Œå°†è¯¥å…ƒç´ ä¸‹çš„æ ‘å½¢ç»“æ„ä¿å­˜åˆ°ä¸€ä¸ª struct uci_ptr ç»“æ„å˜é‡ä¸­ï¼ŒåŸå‹å¦‚ä¸‹ï¼š\nint uci_lookup_ptr(struct uci_context *ctx, struct uci_ptr *ptr, char *str, bool extended); æœ€åä¸€ä¸ªå‚æ•°ç”¨äºä½¿èƒ½ UCI æ‰©å±•è¯­æ³•ï¼Œè®¾ä¸º true æ‰å¯ä»¥è§£æ @system[0] è¿™ç§åŒ¿å section ã€‚å‡½æ•°è°ƒç”¨æˆåŠŸä¼šè¿”å› UCI_OK ï¼Œè°ƒç”¨å¤±è´¥ä¼šè¿”å›é”™è¯¯ä»£ç ï¼Œå¯ä»¥ç”¨ uci_perror() æ‰“å°æœ€æ–°çš„é”™è¯¯ä»£ç å¯¹åº”çš„é”™è¯¯ä¿¡æ¯ï¼ŒåŸå‹å¦‚ä¸‹ï¼š\nvoid uci_perror(struct uci_context *ctx, const char *str); ç¬¬äºŒä¸ªå‚æ•°ç”¨äºè®¾ç½®é”™è¯¯ä¿¡æ¯çš„å‰ç¼€ï¼Œå¯ä»¥è®¾ä¸ºç©ºã€‚\nç¼–è¯‘æ‰§è¡Œï¼š\n$ gcc -Wall uci-example.c -o uci-example -luci $ ./uci-example openwrt 1.4 Lua ç¼–ç¨‹æ¥å£ #ä½¿ç”¨ lua ç¼–ç¨‹æ›´ä¸ºç®€ä¾¿ï¼Œåªéœ€å¯¼å…¥ uci åŒ…ï¼Œå°±å¯ä»¥è°ƒç”¨ uci çš„ lua è¯­è¨€ API ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š\n#!/usr/bin/lua -- uci-example.lua require(\u0026#34;uci\u0026#34;) print(\u0026#34;Hello World!\u0026#34;) -- æ–°å»ºä¸€ä¸ª uci æ“ä½œå®ä¾‹ ctx = uci.cursor() -- è·å–ä¸€ä¸ªé€‰é¡¹çš„å€¼ hostname = ctx:get(\u0026#34;system\u0026#34;,\u0026#34;@system[0]\u0026#34;,\u0026#34;hostname\u0026#34;) print(hostname) ä¿å­˜åæ‰§è¡Œï¼š\n$ chmod +x uci-example.lua $ ./uci-example.lua Hello World! openwrt æ›´å¤šçš„ API å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼šhttps://openwrt.org/docs/techref/uci ã€‚\n2. ubus #ubus æ˜¯åŸºäº unix socket çš„è¿›ç¨‹é—´é€šä¿¡æ¡†æ¶ï¼ŒåŒ…å«å®ˆæŠ¤è¿›ç¨‹ã€å‘½ä»¤è¡Œå·¥å…·å’Œé“¾æ¥åº“ï¼Œå®ˆæŠ¤è¿›ç¨‹ ubusd ä½œä¸º socket server ï¼Œç”¨æˆ·å¯ç”¨ lua æˆ–è€… C è¯­è¨€çš„ API å®ç° socket client ï¼Œclient å’Œ server ä¹‹é—´ç”¨ json æ ¼å¼è¿›è¡Œé€šä¿¡ï¼Œclient ç«¯çš„æ¶ˆæ¯å¤„ç†æŠ½è±¡å¤„ç†å¯¹è±¡ï¼ˆobjectï¼‰å’Œæ–¹æ³•ï¼ˆmethodï¼‰ã€‚ubus é€šè¿‡å¯¹ socket çš„å°è£…ï¼Œç®€åŒ–äº†è¿›ç¨‹é—´é€šä¿¡çš„æ­¥éª¤ï¼Œåªéœ€æŒ‰ç…§å›ºå®šæ¨¡å¼è°ƒç”¨ ubus æä¾›çš„APIå³å¯ã€‚æœ‰ä¸¤ç§å¸¸è§çš„åº”ç”¨åœºæ™¯ï¼š\næœåŠ¡å™¨-å®¢æˆ·ç«¯çš„å½¢å¼ï¼Œè¿›ç¨‹ A æ³¨å†Œä¸€ç³»åˆ—æœåŠ¡ï¼Œè¿›ç¨‹ B è°ƒç”¨è¿™äº›æœåŠ¡ è®¢é˜…-é€šçŸ¥çš„å½¢å¼ï¼Œè¿›ç¨‹ A æä¾›è®¢é˜…æœåŠ¡ï¼Œå…¶ä»–è¿›ç¨‹å¯ç”¨è®¢é˜…æˆ–è€…é€€è®¢è¿™äº›æœåŠ¡ï¼Œè¿›ç¨‹ A å¯ç”¨å‘æ‰€æœ‰è®¢é˜…è€…å‘å¸ƒæ¶ˆæ¯ ç¼–è¯‘å®‰è£… ubus\ngit clone https://git.openwrt.org/project/ubus.git cd ubus cmake . make make install é»˜è®¤å®‰è£…åœ¨ /usr/local ç›®å½•ä¸‹ï¼Œä¸»è¦æœ‰å››ç§æ–‡ä»¶ï¼š\nubusd ï¼Œå®ˆæŠ¤è¿›ç¨‹ ubus ï¼Œå‘½ä»¤è¡Œå·¥å…· libubus.h ç­‰ï¼Œä¸€äº›å¤´æ–‡ä»¶ libubus.so ç­‰ï¼Œä¸€äº›é“¾æ¥åº“ ","date":"2019 December 24","permalink":"/posts/2019/12/24/","section":"Posts","summary":"UCI å’Œ ubus éƒ½æ˜¯ Openwrt é¡¹ç›®æä¾›çš„è½¯ä»¶ï¼ŒUCI æä¾›äº†ç»Ÿä¸€çš„é…ç½®æ–‡ä»¶æ ¼å¼å’Œè¯»å†™å·¥å…·ï¼Œubus æä¾›äº†åŸºäº Unix Socket çš„è¿›ç¨‹é—´é€šä¿¡æ¡†æ¶ã€‚ä¸¤ä¸ªè½¯ä»¶éƒ½å¯ä»¥æ–¹ä¾¿çš„ç§»æ¤åˆ°å…¶ä»– Linux ç³»ç»Ÿï¼Œä»¥ Ubuntu20.","title":"UCI å’Œ ubus å­¦ä¹ ç¬”è®°"},{"content":"1. å¥—æ¥å­— #å¥—æ¥å­—ï¼ˆSocketï¼‰æ˜¯ä¸€ç§æ“ä½œç³»ç»Ÿæä¾›çš„è¿›ç¨‹é—´é€šä¿¡æœºåˆ¶ï¼Œå¯ä»¥ç”¨äºä¸åŒä¸»æœºé—´çš„è¿›ç¨‹é€šä¿¡ï¼Œæœ€æ—©ç”± UNIX æå‡ºï¼Œç°åœ¨å¹¿æ³›ç”¨äºå„ç§æ“ä½œç³»ç»Ÿï¼ŒåŒæ—¶ä¹Ÿç‰¹æŒ‡è¿™ç§æœºåˆ¶ä¸‹çš„é€šä¿¡ç«¯ç‚¹ã€‚æ ¹æ®é€šä¿¡åœ°å€çš„ä¸åŒç§ç±»ï¼ŒSocket å¯ä»¥åˆ†ä¸ºä¸‰ç±»ï¼š\nINET ï¼Œè¿™æ˜¯ IPv4 åœ°å€åŸŸçš„å¥—æ¥å­—ï¼Œç”¨äº IPv4 ç½‘ç»œé—´çš„é€šä¿¡ã€‚ INET6 ï¼Œè¿™æ˜¯ IPv6 åœ°å€åŸŸçš„å¥—æ¥å­—ï¼Œç”¨äº IPv6 ç½‘ç»œé—´çš„é€šä¿¡ã€‚ UNIX ï¼Œè¿™æ˜¯ UNIX åŸŸçš„å¥—æ¥å­—ï¼Œç”¨äºä¸»æœºå†…çš„è¿›ç¨‹é—´é€šä¿¡ã€‚ å¥—æ¥å­—å¸¸ç”¨çš„æŠ¥æ–‡ç±»å‹æœ‰ä¸¤ç§ï¼š\nSOCK_DGRAMï¼Œå›ºå®šé•¿åº¦ï¼Œæ— è¿æ¥ä¸å¯é çš„æŠ¥æ–‡ä¼ é€’ï¼Œä¸¤ä¸ªå¯¹ç­‰è¿›ç¨‹ä¹‹é—´é€šä¿¡æ—¶ä¸éœ€è¦å»ºç«‹é€»è¾‘è¿æ¥ï¼Œç›´æ¥å‘å¯¹æ–¹çš„å¥—æ¥å­—å‘é€æŠ¥æ–‡å³å¯ã€‚åœ¨ INET å¥—æ¥å­—ä¸­ï¼Œè¿™ç§æŠ¥æ–‡ä½¿ç”¨çš„é»˜è®¤åè®®æ˜¯ UDP ã€‚ SOCK_STREAMï¼Œæœ‰åºçš„ï¼Œå¯é çš„ï¼ŒåŒå‘çš„ï¼Œé¢å‘è¿æ¥çš„å­—èŠ‚æµï¼Œä¸¤ä¸ªå¯¹ç­‰è¿›ç¨‹åœ¨æ­£å¼é€šä¿¡ä¹‹å‰ï¼Œè¦å…ˆå»ºç«‹é€»è¾‘è¿æ¥ã€‚åœ¨ INET å¥—æ¥å­—ä¸­ï¼Œè¿™ç§æŠ¥æ–‡ä½¿ç”¨çš„é»˜è®¤åè®®æ˜¯ TCP ã€‚ Python æä¾›äº† socket æ¨¡å—ç”¨äºåº•å±‚ socket é€šä¿¡ï¼Œæ¨¡å—æä¾›äº†ä¸€ä¸ªåŒåçš„ç±»ï¼Œä»¥åŠå…¶ä»–è¯»å†™ socket çš„æ–¹æ³•ã€‚\n2. è·å¾—ä¸»æœºä¿¡æ¯ #è·å–æœ¬æœºçš„åå­—å’Œ IP ï¼š\n$ python3 Python 3.7.4 (default, Jul 9 2019, 18:13:23) [Clang 10.0.1 (clang-1001.0.46.4)] on darwin Type \u0026#34;help\u0026#34;, \u0026#34;copyright\u0026#34;, \u0026#34;credits\u0026#34; or \u0026#34;license\u0026#34; for more information. \u0026gt;\u0026gt;\u0026gt; import socket \u0026gt;\u0026gt;\u0026gt; socket.gethostname() \u0026#39;lscMBP.local\u0026#39; \u0026gt;\u0026gt;\u0026gt; socket.gethostbyname(\u0026#39;lscMBP.local\u0026#39;) \u0026#39;127.0.0.1\u0026#39; \u0026gt;\u0026gt;\u0026gt; socket.gethostbyname(\u0026#39;localhost\u0026#39;) \u0026#39;127.0.0.1\u0026#39; ä¹Ÿå¯ä»¥é€šè¿‡åŸŸåè·å¾—è¿œç¨‹ä¸»æœºçš„ IP ï¼š\n\u0026gt;\u0026gt;\u0026gt; socket.gethostbyname(\u0026#39;www.baidu.com\u0026#39;) \u0026#39;14.215.177.38\u0026#39; ä»¥ä¸Šæ–¹æ³•è¿”å›çš„ IP åœ°å€éƒ½æ˜¯ str ç±»å‹ï¼Œsocket æ¨¡å—æä¾›æ ¼å¼è½¬æ¢çš„æ–¹æ³•ï¼Œå¯ä»¥æŠŠå­—ç¬¦ä¸²è½¬æ¢ä¸º 32 ä½çš„æ•´å‹ï¼š\n\u0026gt;\u0026gt;\u0026gt; addr = socket.gethostbyname(\u0026#39;localhost\u0026#39;) \u0026gt;\u0026gt;\u0026gt; addr \u0026#39;127.0.0.1\u0026#39; \u0026gt;\u0026gt;\u0026gt; socket.inet_aton(addr) b\u0026#39;\\x7f\\x00\\x00\\x01\u0026#39; ä¹Ÿå¯ä»¥æŠŠ 32 ä½æ•´å‹ IP åœ°å€è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼š\n\u0026gt;\u0026gt;\u0026gt; socket.inet_ntoa(b\u0026#39;\\xc0\\xa8\\x00\\x01\u0026#39;) \u0026#39;192.168.0.1\u0026#39; 3. UDP socket #socket ç¼–ç¨‹çš„ç¬¬ä¸€æ­¥ï¼Œé€šå¸¸æ˜¯å…ˆæ–°å»ºä¸€ä¸ª socket å¯¹è±¡ï¼Œä½œä¸ºé€šä¿¡ç«¯ç‚¹è‡ªèº«çš„æŠ½è±¡ï¼Œæœ€åŸºæœ¬çš„æ–¹æ³•æ˜¯ï¼š\nsocket.socket(family=AF_INET, type=SOCK_STREAM, proto=0, fileno=None) å‚æ•° family ç”¨äºè®¾ç½®åŸŸï¼Œå¸¸ç”¨çš„å€¼æ˜¯ï¼š\nAF_INET : IPv4 åŸŸ AF_UNIX : UNIX åŸŸ å‚æ•° type ç”¨äºè®¾ç½®æŠ¥æ–‡çš„ç±»å‹ï¼Œå¸¸ç”¨çš„å€¼æ˜¯ï¼š\nSOCK_STREAM : æœ‰åºçš„ï¼Œå¯é çš„ï¼ŒåŒå‘çš„ï¼Œé¢å‘è¿æ¥çš„å­—èŠ‚æµ SOCK_DGRAM : å›ºå®šé•¿åº¦çš„ï¼Œæ— è¿æ¥çš„ï¼Œä¸å¯é çš„æ•°æ®æŠ¥ å‚æ•° proto ç”¨äºè®¾ç½®åè®®ç±»å‹ï¼Œ0 è¡¨ç¤ºé»˜è®¤ï¼Œå¯¹äº SOCK_STREAM ç±»å‹ï¼Œé»˜è®¤çš„åè®®å°±æ˜¯ TCP ï¼Œå¯¹äº SOCK_DGRAM ç±»å‹ï¼Œé»˜è®¤çš„åè®®å°±æ˜¯ UDP ã€‚\næ–°å»º socket åï¼Œå¯ä»¥è°ƒç”¨ socket.bind() æ–¹æ³•ä¸º socket å¯¹è±¡ç»‘å®šä¸€ä¸ªæœ¬æœºçš„ IP å’Œç«¯å£ï¼Œè¡¨ç¤ºç”¨è¯¥ç«¯å£æ”¶å‘æ•°æ®ï¼š\nsocket.bind(address) å¯¹äº AF_INET , address åº”è¯¥æ˜¯ä¸€ä¸ªå…ƒç»„ (host, port) ï¼Œhost æ˜¯ä¸€ä¸ªè¡¨ç¤º IPv4 æˆ–è€…åŸŸåçš„å­—ç¬¦ä¸²ï¼Œhost æ˜¯è¡¨ç¤ºç«¯å£å·çš„æ•°å­—ã€‚ å¯¹äº AF_UNIX ï¼Œaddress åº”è¯¥æ˜¯ä¸€ä¸ªè¡¨ç¤º sock æ–‡ä»¶ç»å¯¹è·¯å¾„çš„å­—ç¬¦ä¸² å¦‚æœæ²¡æœ‰è°ƒç”¨ socket.bind() ç»‘å®šç«¯å£ï¼Œç³»ç»Ÿä¼šä¸º socket éšæœºåˆ†é…å¯ç”¨çš„ç«¯å£ã€‚æ‰€ä»¥ï¼Œæ¥æ”¶æ–¹å¿…é¡»ç»‘å®šç«¯å£ï¼Œå‘é€æ–¹é€šå¸¸å¯ç”¨ç­‰å¾…ç³»ç»Ÿåˆ†é…ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ã€‚\næ¥æ”¶æ–¹ç»‘å®šäº† UDP:20000 ç«¯å£ï¼Œå¾ªç¯æ¥æ”¶æ•°æ®ï¼Œå¹¶æ‰“å°å‘é€æ–¹çš„åœ°å€ï¼š\n#!/usr/bin/env python3 import socket with socket.socket(socket.AF_INET, socket.SOCK_DGRAM) as s : s.bind((\u0026#39;127.0.0.1\u0026#39;, 20000)) while True : data, addr = s.recvfrom(1024) print(\u0026#39;Received\u0026#39;, repr(data), \u0026#39;from\u0026#39;, repr(addr)) å‘é€æ–¹å‘æŒ‡å®šçš„åœ°å€å‘é€ä¸€ä¸ªå­—ç¬¦ä¸²ï¼š\n#!/usr/bin/env python3 import socket with socket.socket(socket.AF_INET, socket.SOCK_DGRAM) as s : s.sendto(b\u0026#39;Hello world\u0026#39;, (\u0026#39;127.0.0.1\u0026#39;, 20000)) å¯¹äº UDP ï¼Œæ–°å»º socket åï¼Œä¸éœ€è¦å»ºç«‹è¿æ¥ï¼Œå¯ç”¨ç›´æ¥å‘å¯¹æ–¹çš„ IP å’Œç«¯å£å‘é€æ•°æ®ã€‚é€šå¸¸ç”¨ socket.redvfrom() å’Œ socket.sendto() å‡½æ•°æ”¶å‘ UDP æ•°æ®ã€‚\n4. TCP socket #TCP æœ‰å¦‚ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š\né¢å‘è¿æ¥ï¼Œå‘é€æ•°æ®å‰å¿…é¡»å»ºç«‹è¿æ¥ï¼Œç¡®è®¤æ¥æ”¶æ–¹å­˜åœ¨ æœ‰åºä¼ é€ï¼Œæ•°æ®æŒ‰å‘é€è€…å†™å…¥çš„é¡ºåºè¢«è¯»å– å¯é ï¼Œç½‘ç»œä¼ è¾“ä¸­ä¸¢å¤±çš„æ•°æ®åŒ…ä¼šè¢«æ£€æµ‹åˆ°å¹¶é‡æ–°å‘é€ TCP socket ç¼–ç¨‹çš„ API è°ƒç”¨æ¬¡åºå¦‚ä¸‹ï¼š\næœåŠ¡å™¨ç«¯çš„ socket ç»‘å®šæœ¬æœº IP å’Œç«¯å£åï¼Œè°ƒç”¨ socket.listen() æ–¹æ³•è¡¨ç¤ºæ„¿æ„æ¥å—è¿æ¥è¯·æ±‚ï¼š\nsocket.listen([backlog]) å‚æ•° backlog å¯é€‰ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œç³»ç»Ÿä¼šæä¾›ä¸€ä¸ªé»˜è®¤å€¼ï¼Œè¡¨ç¤ºè¯¥è¿›ç¨‹å…è®¸è¿›å»è¯·æ±‚é˜Ÿåˆ—çš„çš„è¿æ¥æ•°é‡çš„æœ€å¤§å€¼ï¼Œå¦‚æœé˜Ÿåˆ—æ»¡äº†ï¼Œä¼šæ‹’ç»å¤šä½™çš„è¿æ¥è¯·æ±‚ã€‚æ‰€ä»¥ï¼Œbacklog çš„å€¼åº”è¯¥åŸºäºæœåŠ¡å™¨æœŸæœ›è´Ÿè½½å’Œå¤„ç†çš„è¿æ¥æ•°é‡è¿›è¡Œè®¾ç½®ã€‚\nä¹‹åï¼Œå¥—æ¥å­—å¯ä»¥è°ƒç”¨ socket.accept() æ–¹æ³•è·å¾—è¿æ¥è¯·æ±‚ï¼Œå¹¶å»ºç«‹è¿æ¥ï¼š\nsocket.accept() é»˜è®¤æƒ…å†µä¸‹è¿™ä¸ªæ–¹æ³•ä¼šé˜»å¡ï¼Œæ”¶åˆ°å®¢æˆ·ç«¯çš„è¯·æ±‚åä¼šè¿”å›ä¸€ä¸ªå…ƒç»„ (conn, address) ï¼Œå…¶ä¸­ï¼Œconn æ˜¯å®¢æˆ·ç«¯çš„ socket ï¼Œç”¨äºå‘å®¢æˆ·ç«¯æ”¶å‘æ•°æ®ï¼Œaddress æ˜¯å®¢æˆ·ç«¯ socket ç»‘å®šçš„åœ°å€ã€‚\nå®¢æˆ·ç«¯å¯ä»¥è°ƒç”¨ socket.connect() æ–¹æ³•å‘æœåŠ¡å™¨ç«¯å‘èµ·è¿æ¥ï¼š\nsocket.connect(address) å‚æ•° address æ˜¯è¡¨ç¤ºæœåŠ¡å™¨ç«¯åœ°å€çš„å…ƒç»„ (host, port) ï¼Œè°ƒç”¨å¤±è´¥ä¼šæŠ›å‡ºä¸€ä¸ª OSError å¼‚å¸¸ã€‚è¿æ¥æˆåŠŸåï¼Œå¯ä»¥è°ƒç”¨ socket.send() å’Œ socket.recv() æ”¶å‘æ•°æ®ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ã€‚\næœåŠ¡å™¨ç«¯ï¼š\n#!/usr/bin/env python3 import socket host = \u0026#34;127.0.0.1\u0026#34; port = 20000 with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s : s.bind((host, port)) s.listen() conn, addr = s.accept() with conn : print(\u0026#34;Connected by\u0026#34;, addr) while True : data = conn.recv(1024) #é˜»å¡ï¼Œç›´åˆ°å¯¹æ–¹ socket å…³é—­ if not data : print(\u0026#34;Received finish\u0026#34;) break print(\u0026#34;Received : \u0026#34;, repr(data)) conn.sendall(data) print(\u0026#34;Reply !\u0026#34;) å®¢æˆ·ç«¯ï¼š\n#!/usr/bin/env python3 import socket host = \u0026#34;127.0.0.1\u0026#34; port = 20000 with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s : try : s.connect((host, port)) s.sendall(b\u0026#39;Hello world\u0026#39;) data = s.recv(1024) # é˜»å¡ï¼Œç›´åˆ°å¯¹æ–¹ socket å…³é—­ except OSError as err : print(err) else : print(\u0026#34;Received : \u0026#34;, repr(data)) 5. UNIX socket #UNIX åŸŸå¥—æ¥å­—ç”¨äºåŒä¸€å°ä¸»æœºå†…çš„è¿›ç¨‹é—´é€šä¿¡ï¼Œä¹Ÿæä¾› STREAM å’Œ DGRAM ä¸¤ç§æŠ¥æ–‡ç±»å‹ï¼Œä½† UNIX åŸŸå¥—æ¥å­—çš„ DGRAM æ˜¯å¯é çš„ï¼Œä¸ä¼šä¸¢å¤±ä¹Ÿä¸ä¼šä¼ é€’å‡ºé”™ã€‚ç¼–ç¨‹æ–¹æ³•ä¸ INET åŸŸç±»ä¼¼ï¼Œåªæ˜¯ UNIX socket éœ€è¦ç»‘å®šçš„åœ°å€æ˜¯ä¸»æœºä¸Šçš„ socket ç±»å‹æ–‡ä»¶ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ª STREAM ç±»å‹çš„ä¾‹å­ã€‚\næœåŠ¡å™¨ç«¯ï¼š\n#!/usr/bin/env python3 import socket import os SOCK = \u0026#34;./server.sock\u0026#34; if os.path.exists(SOCK): os.remove(SOCK) with socket.socket(socket.AF_UNIX, socket.SOCK_STREAM) as s : s.bind(SOCK) s.listen() conn, _ = s.accept() with conn : print(\u0026#34;Connected by\u0026#34;, SOCK) while True : data = conn.recv(1024) if not data : print(\u0026#34;Received finish\u0026#34;) break print(\u0026#34;Received :\u0026#34;, repr(data)) conn.sendall(data) print(\u0026#34;Reply !\u0026#34;) os.remove(SOCK) å®¢æˆ·ç«¯ï¼š\n#!/usr/bin/env python3 import socket SOCK = \u0026#34;./server.sock\u0026#34; with socket.socket(socket.AF_UNIX, socket.SOCK_STREAM) as s : try : s.connect(SOCK) s.sendall(b\u0026#39;Hello world\u0026#39;) data = s.recv(1024) except OSError as err : print(err) else : print(\u0026#34;Received : \u0026#34;, repr(data)) 6. bytes å¯¹è±¡ #socket åªèƒ½æ”¶å‘ bytes ç±»å‹çš„æ•°æ®ï¼Œè¿™æ˜¯ Python å†…å»ºçš„ä¸€ä¸ªæ•°æ®ç±»å‹ï¼Œæ˜¯ç”¨äºè¡¨ç¤ºå­—èŠ‚åºåˆ—çš„å¯¹è±¡ï¼Œbytes å¯¹è±¡æä¾›çš„å¾ˆå¤šæ–¹æ³•ä»…åœ¨å¤„ç† ASCII å…¼å®¹æ•°æ®æ—¶æœ‰æ•ˆï¼Œä¸”ä¸å­—ç¬¦ä¸²å¯¹è±¡å¯†åˆ‡ç›¸å…³ã€‚bytes ç±»çš„å®šä¹‰ï¼š\nclass bytes([source[, encoding[, errors]]]) å¦‚æœ source æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œä¼šè¿”å›ä¸€ä¸ªé•¿åº¦ä¸º source ï¼Œå†…å®¹å…¨ä¸º 0 çš„åˆå§‹åŒ–å­—èŠ‚åºåˆ—ã€‚ å¦‚æœ source æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¼šæŒ‰ç…§ encoding æŒ‡å®šçš„ç¼–ç å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå­—èŠ‚åºåˆ—ã€‚ \u0026gt;\u0026gt;\u0026gt; b=bytes(10) \u0026gt;\u0026gt;\u0026gt; b b\u0026#39;\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\u0026#39; \u0026gt;\u0026gt;\u0026gt; a=\u0026#34;hello\u0026#34; \u0026gt;\u0026gt;\u0026gt; b=bytes(a,\u0026#39;ascii\u0026#39;) \u0026gt;\u0026gt;\u0026gt; b b\u0026#39;hello\u0026#39; æ›´ç®€ä¾¿çš„æ–¹æ³•æ˜¯åœ¨ä¸€ä¸ªå­—ç¬¦ä¸²å‰é¢åŠ ä¸Šå­—ç¬¦ b ï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ª bytes ç±»å‹çš„å­—ç¬¦ä¸²ï¼š\n\u0026gt;\u0026gt;\u0026gt; a=b\u0026#39;hello\u0026#39; \u0026gt;\u0026gt;\u0026gt; type(a) \u0026lt;class \u0026#39;bytes\u0026#39;\u0026gt; str ç±»å‹çš„å­—ç¬¦ä¸²å¯ä»¥è°ƒç”¨ encode() æ–¹æ³•è½¬æ¢ä¸º bytes ç±»å‹ï¼š\n\u0026gt;\u0026gt;\u0026gt; a=\u0026#39;hello\u0026#39; \u0026gt;\u0026gt;\u0026gt; a.encode() b\u0026#39;hello\u0026#39; bytes ç±»å‹çš„å­—ç¬¦ä¸²å¯ä»¥è°ƒç”¨ decode() æ–¹æ³•è½¬æ¢ä¸º str ç±»å‹ï¼š\n\u0026gt;\u0026gt;\u0026gt; a=b\u0026#39;hello\u0026#39; \u0026gt;\u0026gt;\u0026gt; a.decode() \u0026#39;hello\u0026#39; bytes ç±»æä¾›äº† hex() æ–¹æ³•ï¼Œå¯ä»¥è¿”å›å®ä¾‹çš„åå…­è¿›åˆ¶æ•°å­—çš„å­—ç¬¦ä¸²å¯¹è±¡ï¼š\n\u0026gt;\u0026gt;\u0026gt; a=b\u0026#39;hello\u0026#39; \u0026gt;\u0026gt;\u0026gt; a.hex() \u0026#39;68656c6c6f\u0026#39; \u0026gt;\u0026gt;\u0026gt; type(a.hex()) \u0026lt;class \u0026#39;str\u0026#39;\u0026gt; é™¤äº†æ˜¾å¼ ASCII å­—ç¬¦ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å®šä¹‰ä¸€ä¸²åå…­è¿›åˆ¶åºåˆ—ï¼Œè¿™æ ·ï¼Œé ASCII å­—ç¬¦ä¹Ÿå¯ä»¥ä½¿ç”¨ bytes ï¼š\n\u0026gt;\u0026gt;\u0026gt; a=b\u0026#39;\\x68\\x65\\x6c\u0026#39; \u0026gt;\u0026gt;\u0026gt; a b\u0026#39;hel\u0026#39; \u0026gt;\u0026gt;\u0026gt; a=b\u0026#39;\\x01\\x02\u0026#39; \u0026gt;\u0026gt;\u0026gt; a b\u0026#39;\\x01\\x02\u0026#39; \u0026gt;\u0026gt;\u0026gt; a.hex() \u0026#39;0102\u0026#39; å› ä¸º bytes æ˜¯ä»¥å­—èŠ‚ä¸ºå•ä½çš„åºåˆ—ï¼Œå¯ä»¥ç”¨ä¸‹æ ‡ç´¢å¼•è¯»å–æ¯ä¸ªå­—èŠ‚ï¼š\n\u0026gt;\u0026gt;\u0026gt; a=b\u0026#39;hello\u0026#39; \u0026gt;\u0026gt;\u0026gt; a.hex() \u0026#39;68656c6c6f\u0026#39; \u0026gt;\u0026gt;\u0026gt; a[0] 104 \u0026gt;\u0026gt;\u0026gt; a[0:2] b\u0026#39;he\u0026#39; ä¹Ÿå¯ä»¥ç”¨ list() æ–¹æ³•æŠŠ bytes è½¬æ¢ä¸ºå…ƒç»„ï¼Œæˆ–è€…ç”¨å…ƒç»„å®šä¹‰ bytes ï¼š\n\u0026gt;\u0026gt;\u0026gt; a=b\u0026#39;hello\u0026#39; \u0026gt;\u0026gt;\u0026gt; list(a) [104, 101, 108, 108, 111] \u0026gt;\u0026gt;\u0026gt; b=bytes([104, 101, 108, 108, 111]) \u0026gt;\u0026gt;\u0026gt; b b\u0026#39;hello\u0026#39; åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥å¤„ç†é ASCII ç¼–ç çš„æ•°æ®ï¼Œä¾‹å¦‚æŠŠä¸€ä¸ª 32 ä½æ— ç¬¦å·æ•´æ•°å˜æˆé•¿åº¦ä¸º 4 çš„ bytes ï¼š\n\u0026gt;\u0026gt;\u0026gt; n = 0x12345678 \u0026gt;\u0026gt;\u0026gt; n 305419896 \u0026gt;\u0026gt;\u0026gt; b1 = (n\u0026amp;0xff000000) \u0026gt;\u0026gt; 24 \u0026gt;\u0026gt;\u0026gt; b2 = (n\u0026amp;0xff0000) \u0026gt;\u0026gt; 16 \u0026gt;\u0026gt;\u0026gt; b3 = (n\u0026amp;0xff00) \u0026gt;\u0026gt; 8 \u0026gt;\u0026gt;\u0026gt; b4 = (n\u0026amp;0xff) \u0026gt;\u0026gt;\u0026gt; bs = bytes([b1, b2, b3, b4]) \u0026gt;\u0026gt;\u0026gt; bs b\u0026#39;\\x124Vx\u0026#39; \u0026gt;\u0026gt;\u0026gt; bs.hex() \u0026#39;12345678\u0026#39; 7. Struct æ¨¡å— #é ASCII ç¼–ç çš„æ•°æ®è½¬æ¢ä¸º bytes å¯¹è±¡æ¯”è¾ƒéº»çƒ¦ï¼Œpython æä¾›äº† struct æ¨¡å—æ¥è§£å†³äºŒè¿›åˆ¶æ•°æ®ç±»å‹ä¸ bytes ä¹‹é—´çš„è½¬æ¢ã€‚struct.pack() å‡½æ•°å¯ä»¥æŠŠä»»æ„æ•°æ®ç±»å‹è½¬æ¢ä¸º bytes ï¼š\nstruct.pack(format, v1, v2, ...) ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¤„ç†æŒ‡ä»¤ï¼Œåé¢çš„å‚æ•°æ˜¯è¦å¤„ç†çš„æ•°æ®ï¼Œè¿”å›ä¸€ä¸ª bytes å¯¹è±¡ï¼Œä¾‹å¦‚æŠŠä¸€ä¸ª 32 ä½æ— ç¬¦å·æ•´æ•°å˜æˆé•¿åº¦ä¸º 4 çš„ bytes ï¼š\n\u0026gt;\u0026gt;\u0026gt; import struct \u0026gt;\u0026gt;\u0026gt; struct.pack(\u0026#39;\u0026gt;I\u0026#39;,0x12345678) b\u0026#39;\\x124Vx\u0026#39; \u0026gt;I ä¸­çš„ \u0026gt; è¡¨ç¤ºå­—èŠ‚åºæ˜¯å¤§ç«¯ï¼Œä¹Ÿå°±æ˜¯ç½‘ç»œåºï¼ŒI è¡¨ç¤ºä¸€ä¸ª 4 å­—èŠ‚çš„æ— ç¬¦å·æ•´æ•°ï¼Œåé¢çš„æ•°æ®è¦å’Œå¤„ç†æŒ‡ä»¤ä¸€è‡´ã€‚å¤„ç†æŒ‡ä»¤çš„ç¬¬ä¸€ä¸ªå­—ç¬¦æ€»è¦å®šä¹‰å­—èŠ‚åºã€å¤§å°å’Œå¯¹é½æ–¹å¼ï¼Œå¯é€‰å¦‚ä¸‹å­—ç¬¦ï¼š\nå­—ç¬¦ å­—èŠ‚åº å¤§å° å¯¹é½æ–¹å¼ @ åŸç”Ÿ åŸç”Ÿ åŸç”Ÿ = åŸç”Ÿ æ ‡å‡† æ—  \u0026lt; å°ç«¯ æ ‡å‡† æ—  \u0026gt; å¤§ç«¯ æ ‡å‡† æ—  ! ç½‘ç»œåºï¼ˆå¤§ç«¯ï¼‰ æ ‡å‡† æ—  å¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œé»˜è®¤ä½¿ç”¨ @ ã€‚ å­—èŠ‚åºåˆ†ä¸ºå¤§ç«¯å’Œå°ç«¯ï¼ŒåŸç”Ÿ è¡¨ç¤ºä¸æœ¬åœ°çš„ä¸»æœºç³»ç»Ÿä¿æŒä¸€è‡´ã€‚ å¤§å°æ˜¯æŒ‡ä¸åŒç±»å‹æ‰€å çš„å­—èŠ‚æ•°ï¼ŒåŸç”Ÿ è¡¨ç¤ºä¸æœ¬æœºä½¿ç”¨çš„ C ç¼–è¯‘å™¨ä¿æŒä¸€è‡´ï¼Œæ ‡å‡† æ˜¯æŒ‡ struct æ¨¡å—å†…ç½®çš„æ ‡å‡†å¤§å°ï¼Œå‚è€ƒä¸‹é¢çš„æ ¼å¼å­—ç¬¦è¡¨ã€‚ å­—èŠ‚å¯¹é½æ–¹å¼ä¸ C è¯­è¨€ç›¸åŒã€‚ å­—èŠ‚åºæ˜¯æŒ‡æ•°æ®å­˜å‚¨æ–¹å¼ï¼ŒIntel å¤„ç†å’Œ Linux ç³»ç»Ÿéƒ½æ˜¯å°ç«¯ï¼Œä¹Ÿå°±æ˜¯ä½ä½æ•°æ®å­˜æ”¾åœ¨é«˜ä½åœ°å€ä¸Šï¼Œè€Œ TCP/IP åè®®ä½¿ç”¨çš„ç½‘ç»œåºæ˜¯å¤§ç«¯ï¼Œä½ä½æ•°æ®å­˜æ”¾åœ¨ä½ä½åœ°å€ä¸Šã€‚ä¾‹å¦‚ï¼š\n\u0026gt;\u0026gt;\u0026gt; a=0x01020304 \u0026gt;\u0026gt;\u0026gt; struct.pack(\u0026#34;I\u0026#34;, a) b\u0026#39;\\x04\\x03\\x02\\x01\u0026#39; \u0026gt;\u0026gt;\u0026gt; struct.pack(\u0026#34;!I\u0026#34;, a) b\u0026#39;\\x01\\x02\\x03\\x04\u0026#39; struct æ¨¡å—çš„æœ¬è´¨æ˜¯æŠŠ C è¯­è¨€çš„æ•°æ®ç±»å‹è½¬æ¢ä¸º Python çš„æ•°æ®ç±»å‹ï¼Œå¸¸ç”¨çš„ç±»å‹è½¬æ¢å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š\nå­—ç¬¦ C ç±»å‹ Python ç±»å‹ å¤§å° å¤‡æ³¨ c char bytes of length 1 1 b signed char integer 1 B unsigned char integer 1 ? _Bool bool 1 h short integer 2 H unsigned short integer 2 i int integer 4 I unsigned int integer 4 l long integer 4 L unsigned long integer 4 q long long integer 8 Q unsigned long long integer 8 f float float 4 d double float 8 s char[] bytes åœ¨å­—ç¬¦å‰å¯ä»¥åŠ ä¸€ä¸ªæ•°å­—ï¼Œè¡¨ç¤ºæœ‰è¿ç»­å¤šä¸ªè¿™æ ·çš„æ•°æ®ï¼Œä¾‹å¦‚ 4I ç­‰åŒäº IIII ã€‚å¯¹äº s å­—ç¬¦ï¼Œé»˜è®¤åªä¼šå» bytes æ•°æ®çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼Œå¦‚æœå‰é¢åŠ ä¸€ä¸ªæ•°å­—ï¼Œè¡¨ç¤ºå– bytes æ•°å»çš„å‰é¢å‡ ä¸ªå­—èŠ‚ã€‚\nstruct.unpack() å‡½æ•°å¯ä»¥æŠŠ bytes ç±»å‹è½¬æ¢ä¸ºå…¶ä»–æ•°æ®ç±»å‹ï¼Œä¾‹å¦‚æŠŠä¸€ä¸ª 6 å­—èŠ‚çš„ bytes è½¬æ¢ä¸ºä¸€ä¸ª 4 å­—èŠ‚çš„æ— ç¬¦å·æ•´æ•°å’Œä¸€ä¸ª 2 å­—èŠ‚çš„æ— ç¬¦å·æ•´æ•°ï¼š\n\u0026gt;\u0026gt;\u0026gt; struct.unpack(\u0026#39;\u0026gt;IH\u0026#39;, b\u0026#39;\\xf0\\xf0\\xf0\\xf0\\x08\\x08\u0026#39;) (4042322160, 2056) ä¸¾ä¾‹å¡«å……ä¸€ä¸ªæ•°æ®å¸§ï¼Œç”±ä¸¤ä¸ªå•å­—èŠ‚æ•´æ•°ï¼Œä¸€ä¸ªå››å­—èŠ‚æ•´æ•°å’Œå››ä¸ªå­—ç¬¦ç»„æˆï¼š\n\u0026gt;\u0026gt;\u0026gt; buff = struct.pack(\u0026#39;2BI4s\u0026#39;, 0x01, 0x02, 0x12345678, b\u0026#39;will\u0026#39;) \u0026gt;\u0026gt;\u0026gt; print(buff) b\u0026#39;\\x01\\x02\\x00\\x00xV4\\x12will\u0026#39; \u0026gt;\u0026gt;\u0026gt; a = struct.unpack(\u0026#39;2BI4s\u0026#39;,buff) \u0026gt;\u0026gt;\u0026gt; print(a) (1, 2, 305419896, b\u0026#39;will\u0026#39;) \u0026gt;\u0026gt;\u0026gt; struct.calcsize(\u0026#39;2BI4s\u0026#39;) 12 struct.calcsize() å‡½æ•°ç”¨äºè®¡ç®—æ•°æ®æ ¼å¼æ‰€å çš„å­—èŠ‚æ•°ï¼Œä¸ºäº†ä¸ I å‹æ•°æ®å­—èŠ‚å¯¹é½ï¼Œä¸¤ä¸ª B å‹æ•°æ®éƒ½å¡«å……äº†ä¸€ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥å®é™…å ç”¨äº† 12 ä¸ªå­—èŠ‚ã€‚\nä¸Šé¢å¤„ç†çš„æ•°æ®å¸§ä¸­ï¼Œæ¯ä¸ªä½ç½®çš„é•¿åº¦éƒ½æ˜¯å›ºå®šçš„ï¼Œè€Œç°å®ä¸­çš„å¾ˆå¤šåè®®éƒ½æœ‰ä¸å®šé•¿çš„å­—æ®µï¼Œå¤„ç†è¿™ç§æ•°æ®æ—¶ï¼Œéœ€è¦æŠŠå­—æ®µé•¿åº¦ä¹Ÿä¸€èµ·æ‰“åŒ…ï¼Œåé¢æ‰æ–¹ä¾¿è§£åŒ…ã€‚ä¾‹å¦‚æ‰“åŒ…ä¸€ä¸ªé•¿åº¦ä¸å®šçš„å­—ç¬¦ä¸²ï¼š\n\u0026gt;\u0026gt;\u0026gt; s = b\u0026#39;hello\u0026#39; \u0026gt;\u0026gt;\u0026gt; data = struct.pack(\u0026#34;I%ds\u0026#34; % len(s), len(s), s) \u0026gt;\u0026gt;\u0026gt; data b\u0026#39;\\x05\\x00\\x00\\x00hello\u0026#39; è§£åŒ…çš„æ—¶å€™å…ˆè·å–å­—ç¬¦ä¸²é•¿åº¦ï¼Œç„¶ååœ¨è¯»å–å­—ç¬¦ä¸²ï¼š\n\u0026gt;\u0026gt;\u0026gt; int_size = struct.calcsize(\u0026#34;I\u0026#34;) \u0026gt;\u0026gt;\u0026gt; (i,)=struct.unpack(\u0026#34;I\u0026#34;, data[:int_size]) \u0026gt;\u0026gt;\u0026gt; i 5 \u0026gt;\u0026gt;\u0026gt; data_content = struct.unpack(\u0026#34;I%ds\u0026#34; % i, data) \u0026gt;\u0026gt;\u0026gt; data_content (5, b\u0026#39;hello\u0026#39;) 8. éé˜»å¡å’Œè¶…æ—¶ #sokcet å¯¹è±¡æœ‰ä¸‰ç§æ¨¡å¼ï¼šé˜»å¡ã€éé˜»å¡å’Œè¶…æ—¶ï¼š\né˜»å¡ï¼Œä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°æ“ä½œæˆåŠŸï¼Œæˆ–è€…è¿”å›é”™è¯¯ã€‚ éé˜»å¡ï¼Œæ— è®ºæ“ä½œæ˜¯å¦æˆåŠŸï¼Œéƒ½ä¼šç«‹å³è¿”å›ï¼Œç­‰å¾…æ—¶é—´ä¸º 0 ã€‚ è¶…æ—¶ï¼Œä¼šç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œä¹‹åä¼šè¿”å›ä¸€ä¸ªè¶…æ—¶é”™è¯¯ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œæ–°å»ºçš„ socket å¯¹è±¡æ€»æ˜¯é˜»å¡çš„ï¼Œaccept() ã€connect() å’Œ recv() ç­‰æ–¹æ³•éƒ½ä¼šå—åˆ°é˜»å¡çš„å½±å“ã€‚å¯ä»¥è°ƒç”¨å¦‚ä¸‹å‡½æ•°è®¾ä¸ºéé˜»å¡ï¼š\nsocket.setblocking(flag) flag è®¾ä¸º Ture è¡¨ç¤ºé˜»å¡ã€‚ flag è®¾ä¸º False è¡¨ç¤ºéé˜»å¡ã€‚ éé˜»å¡æ¨¡å¼ä¸‹ï¼Œé»˜è®¤çš„ç­‰å¾…æ—¶é—´æ˜¯ 0 ï¼Œå¯ä»¥è®¾ç½®ç­‰å¾…æ—¶é—´ï¼Œè¿™æ ·å°±ä¼šå˜ä¸ºè¶…æ—¶æ¨¡å¼ï¼Œè®¾ç½®æ–¹æ³•æ˜¯ï¼š\nsocket.settimeout(value) å‚æ•° value åº”è¯¥è®¾ç½®ä¸€ä¸ªæµ®ç‚¹æ•°ï¼Œæ—¶é—´å•ä½æ˜¯ç§’ã€‚\né€šè¿‡ socket.accept() æ–¹æ³•è¿”å›çš„ socket å¯¹è±¡æ˜¯ä»€ä¹ˆæ¨¡å¼ï¼Œå–å†³äºå¤šç§å› ç´ ï¼Œæœ€å¥½è®¾ç½®ä¸€æ¬¡ã€‚\n9. å¹¶å‘ #å®ç° Socket æœåŠ¡å™¨å¹¶å‘çš„ä¸ºäº†åŒæ—¶æ¥æ”¶å¹¶å¤„ç†æ›´å¤šçš„å®¢æˆ·ç«¯è¿æ¥ï¼Œæ–¹æ³•æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚å¤šçº¿ç¨‹ï¼Œæ¥æ”¶åˆ°ä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥åå°±æ–°å»ºä¸€ä¸ªçº¿ç¨‹å»å¤„ç†ï¼Œä¸»çº¿ç¨‹ç»§ç»­ç­‰å¾…æ–°çš„è¿æ¥ã€‚ä»¥ Unix Socket ä¸ºä¾‹ï¼š\n#!/usr/bin/env python3 import threading import socket import os def handle(conn): print(threading.current_thread().name) with conn : while True : data = conn.recv(1024) if not data : print(\u0026#34;Received finish\u0026#34;) break print(\u0026#34;Received :\u0026#34;, repr(data)) conn.sendall(data) print(\u0026#34;Reply !\u0026#34;) return SOCK = \u0026#34;./server.sock\u0026#34; if os.path.exists(SOCK): os.remove(SOCK) with socket.socket(socket.AF_UNIX, socket.SOCK_STREAM) as s : s.bind(SOCK) s.listen() while True : conn, _ = s.accept() t = threading.Thread(target=handle, args=(conn, )) t.start() os.remove(SOCK) å‚è€ƒ # socket æ–‡æ¡£ Pythonå¹¶è¡Œç¼–ç¨‹ ","date":"2019 November 26","permalink":"/posts/2019/11/26/","section":"Posts","summary":"1. å¥—æ¥å­— #å¥—æ¥å­—ï¼ˆSocketï¼‰æ˜¯ä¸€ç§æ“ä½œç³»ç»Ÿæä¾›çš„è¿›ç¨‹é—´é€šä¿¡æœºåˆ¶ï¼Œå¯ä»¥ç”¨äºä¸åŒä¸»æœºé—´çš„è¿›ç¨‹é€šä¿¡ï¼Œæœ€æ—©ç”± UNIX æå‡ºï¼Œç°åœ¨å¹¿æ³›ç”¨äºå„ç§æ“ä½œç³»ç»Ÿï¼ŒåŒæ—¶ä¹Ÿç‰¹æŒ‡è¿™ç§æœºåˆ¶ä¸‹çš„é€šä¿¡ç«¯ç‚¹ã€‚æ ¹æ®é€šä¿¡åœ°å€çš„ä¸åŒç§ç±»ï¼ŒSocket å¯ä»¥åˆ†ä¸ºä¸‰ç±»ï¼š","title":"Python Socket ç¼–ç¨‹ç¬”è®°"},{"content":"ä»¥ Ubuntu 16.04 ä¸ºä¾‹ï¼Œå¦‚æœåªæƒ³è·å¾—å½“å‰å†…æ ¸ç‰ˆæœ¬çš„æºç å¯ä»¥ç”¨ apt-get ï¼Œå¦‚æœæƒ³è·å–å½“å‰ç³»ç»Ÿçš„æ‰€æœ‰å†…æ ¸æºç å»ºè®®ç”¨ git ã€‚\n1. apt-get #é€šå¸¸æ˜¯ç”¨ apt-get source ä¸‹è½½ï¼š\napt-get source linux-image-$(uname -r) æºç ä¼šç›´æ¥ä¸‹è½½åˆ°å½“å‰ç›®å½•ï¼Œå¹¶è‡ªåŠ¨è§£å‹ï¼Œæ‰€ä»¥å»ºè®®åœ¨ /usr/src/ ç›®å½•ä¸‹æ‰§è¡Œï¼š\nroot@ubuntu:/usr/src# ls linux-4.4.0 linux_4.4.0-161.189.dsc linux-headers-4.4.0-142 linux_4.4.0-161.189.diff.gz linux_4.4.0.orig.tar.gz linux-headers-4.4.0-142-generic linux_4.4.0.orig.tar.gz æ˜¯æ ‡å‡†å†…æ ¸æºç  linux_4.4.0-161.189.diff.gz æ˜¯ Ubuntu kernel çš„è¡¥ä¸ linux_4.4.0-161.189.dsc æ˜¯ Debian Source Control æ–‡æ¡£ï¼Œç”¨äºæè¿°æºç ç‰ˆæœ¬çš„ç›¸å…³ä¿¡æ¯ linux-4.4.0 æ˜¯å‰ä¸¤ä¸ªæ–‡ä»¶è§£å‹æ‰“è¡¥ä¸åçš„æºç ç›®å½• è¿™æ ·è‡ªåŠ¨ä¸‹è½½çš„å°ç‰ˆæœ¬å·é€šå¸¸æ˜¯æœ€æ–°çš„ï¼Œå¦‚æœæƒ³ç²¾ç¡®åŒ¹é…å½“å‰çš„å†…æ ¸ç‰ˆæœ¬ï¼Œå¯ä»¥åœ¨ https://launchpad.net/ubuntu/+source/linux/ æœç´¢æ‰€éœ€çš„ç‰ˆæœ¬ï¼Œä¹Ÿæ˜¯è¿™æ ·çš„ä¸‰ä¸ªæ–‡ä»¶ï¼Œä¸‹è½½åéœ€è¦æ‰‹åŠ¨è§£å‹æ‰“è¡¥ä¸ï¼š\ntar xfvz \u0026lt;filname\u0026gt;.orig.tar.gz gunzip \u0026lt;filename\u0026gt;.diff.gz cd ./\u0026lt;filename\u0026gt; patch -p1 -i \u0026lt;file name\u0026gt;.diff æ­¤å¤–ï¼Œç”¨ apt-cache search linux-source å’Œ apt-get install linux-source ä¹Ÿå¯ä»¥æœç´¢å¹¶ä¸‹è½½å½“å‰å†…æ ¸ç‰ˆæœ¬çš„æºç ï¼Œå¹¶è‡ªåŠ¨è§£å‹åˆ° /usr/src/ ç›®å½•ä¸‹ã€‚\nroot@ubuntu:/usr/src$ ls linux-headers-4.4.0-116 linux-headers-4.4.0-116-generic linux-source-4.4.0 linux-source-4.4.0.tar.gz root@ubuntu:/usr/src$ ls linux-source-4.4.0/ debian debian.master linux-source-4.4.0.tar.gz å…¶ä¸­ debian å’Œ debian.master ç›®å½•ä¸‹å­˜æ”¾çš„æ˜¯ ubuntu å‘è¡Œç‰ˆä¸­é’ˆå¯¹å†…æ ¸ä¿®æ”¹çš„é…ç½®ã€è¡¥ä¸ã€è¯´æ˜å’Œä¸€äº›å·¥å…·ï¼Œåœ¨ /usr/src/ ç›®å½•ä¸‹æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤è§£å‹ï¼Œæ‰€æœ‰æºç å°±è§£å‹åœ¨ linux-source-4.4.0 ç›®å½•ä¸‹ï¼Œï¼š\n/usr/src$ tar xvf linux-source-4.4.0.tar.gz 2. git #Ubuntu ä½¿ç”¨çš„å†…æ ¸æºç éƒ½æ˜¯ç”¨ git ç»´æŠ¤çš„ï¼Œæ¯ä¸ªç‰ˆæœ¬çš„æºä»£ç éƒ½ä¿å­˜åœ¨ kernel.ubuntu.comä¸Šçš„ git å­˜å‚¨åº“ä¸­ã€‚å¯ä»¥ä¸‹è½½ä½ éœ€è¦çš„ç‰ˆæœ¬ï¼š\ngit clone git://kernel.ubuntu.com/ubuntu/ubuntu-\u0026lt;release codename\u0026gt;.git ä¾‹å¦‚ä¸‹è½½ 16.04 LTS Xenial Xerus çš„æºç ï¼š\ngit clone git://kernel.ubuntu.com/ubuntu/ubuntu-xenial.git è¿™ä¸ªç‰ˆæœ¬åº“åŒ…å«äº†å½“å‰å†…æ ¸æºç çš„æ‰€æœ‰ commit ï¼Œå¯ä»¥æ£€å‡ºæ‰€éœ€çš„å…·ä½“ç‰ˆæœ¬ã€‚\n3. ç¼–è¯‘ #ç¼–è¯‘å†…æ ¸å‰ï¼Œéœ€è¦å®‰è£…ä¸€äº›ä¾èµ–ï¼Œå¹¶å¤åˆ¶ä¸€ä»½ç³»ç»Ÿè‡ªå¸¦çš„é…ç½®æ–‡ä»¶ï¼š\nroot@ubuntu:~# apt-get install libncurses5-dev bc libssl-dev root@ubuntu:~# cp -rf /boot/config-4.4.0-116-generic /usr/src/linux-source-4.4.0/.config å¦‚æœåªæ˜¯æƒ³ä¿®æ”¹ä¸ªåˆ«æ¨¡å—ï¼Œå¿…é¡»å…ˆå¤åˆ¶å½“å‰å®‰è£…çš„æ¨¡å—çš„ç¬¦å·è¡¨\nroot@ubuntu:/usr/src/linux-4.4# cp -rf /lib/modules/4.4.0-142-generic/build/Module.symvers ./Module.symvers ç„¶åæ‰§è¡Œ make M=\u0026lt;module dir\u0026gt; å‘½ä»¤ç¼–è¯‘ã€‚\nå‚è€ƒ # Build Your Own Kernel Kernel Git Guide ","date":"2019 September 20","permalink":"/posts/2019/09/20/","section":"Posts","summary":"ä»¥ Ubuntu 16.","title":"Ubuntu ä¸‹è·å–å’Œç¼–è¯‘å†…æ ¸æºç çš„æ–¹æ³•"},{"content":"keepalived æ˜¯ä¸€ä¸ªç”¨ C è¯­è¨€ç¼–å†™çš„å…è´¹å¼€æºè½¯ä»¶ï¼Œå®ƒå®ç°äº† VRRPåè®®ï¼ŒåŒæ—¶æä¾›äº†å¼ºå¤§çš„è´Ÿè½½å‡è¡¡ (LVS) åŠŸèƒ½ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ä»–çš„ VRRP åŠŸèƒ½å®ç°è·¯ç”±å™¨æˆ–è€…æœåŠ¡å™¨ç­‰ç½‘ç»œè®¾å¤‡çš„åŒæœºçƒ­å¤‡ã€‚ç®€å•çš„è¯´ï¼Œä¸¤å°è·¯ç”±å™¨ï¼Œä¸€å°ä½œä¸ºä¸»æœºï¼Œä¸€å°ä½œä¸ºå¤‡æœºï¼Œä¸¤å°è·¯ç”±å™¨æœ‰è‡ªå·±çš„ç‹¬ç«‹ IP ï¼ŒåŒæ—¶å…±äº«ä¸€ä¸ªè™šæ‹Ÿ IP ï¼Œä¸»æœºæ­£å¸¸æ˜¯ï¼Œè¿™ä¸ªè™šæ‹Ÿ IP æŒ‡å‘ä¸»æœºï¼Œå½“ä¸»æœºå‡ºç°æ•…éšœæ—¶ï¼Œè™šæ‹Ÿ IP æŒ‡å‘å¤‡æœºï¼Œå®ç°äº†è·¯ç”±å™¨çš„æ— ç¼è‡ªåŠ¨åˆ‡æ¢ã€‚ç½‘ç»œæ‹“æ‰‘å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\nè™šæ‹Ÿ IP çš„å®ç°æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œæ¯”è¾ƒå¯é çš„æ–¹æ³•æ˜¯ä¸ºä¸€ä¸ªç½‘å¡å®šä¹‰å¤šä¸ª IP ï¼Œç«¯å£åç”¨å†’å·éš”å¼€ä¸€ä¸ªæ•°å­—ï¼Œç”¨ ifconfig å‘½ä»¤å®ç°ï¼Œä¾‹å¦‚ï¼š\nifconfig eth0:0 192.168.6.100 netmask 255.255.255.0 up ç”¨ç‚¹éš”å¼€ä¸€ä¸ªæ•°å­—çš„ç«¯å£åå±äº VLAN ç½‘å¡ï¼Œä¾‹å¦‚ eth0.100 ï¼Œå…·æœ‰ä¸åŒçš„ç‰¹æ€§å’Œåº”ç”¨ã€‚\nå®‰è£… #keepalived å®˜ç½‘åœ¨ https://www.keepalived.org/ ï¼Œå¯ä»¥ç¼–è¯‘æºç è¿›è¡Œå®‰è£…ã€‚åœ¨ ubuntu ç³»ç»Ÿä¸‹ï¼Œç›´æ¥ç”¨ apt å®‰è£…ï¼š\napt-get install keepalived é…ç½® #keepalived åªæœ‰ä¸€ä¸ªé…ç½®æ–‡ä»¶ keepalived.confï¼Œé€šå¸¸ä½äº /etc/keepalived/ ç›®å½•ä¸‹ï¼Œkeepalived è¿˜æä¾›äº†å¾ˆå¤šé…ç½®æ–‡ä»¶çš„å®ä¾‹ï¼Œå®‰è£…åœ¨ /usr/share/doc/keepalived/sample/ ç›®å½•ä¸‹ã€‚å¯¹äºåŒæœºçƒ­å¤‡ï¼Œæœ€ç®€å•çš„é…ç½®å¦‚ä¸‹ï¼š\nä¸»æœº ï¼š\nvrrp_instance VI_1 { # å®šä¹‰ä¸€ä¸ª VRRP å®ä¾‹ï¼ŒVI_1 è¡¨ç¤ºè¿™ä¸ªå®ä¾‹çš„åç§°ï¼ŒåŒä¸€ç»„ VRRP è·¯ç”±å™¨çš„å®ä¾‹åç§°å¿…é¡»ä¸€è‡´ state MASTER # å®šä¹‰æœ¬æœºçš„åˆå§‹çŠ¶æ€ï¼ŒMASTER è¡¨ç¤ºä¸»æœºï¼ŒBACKUP è¡¨ç¤ºå¤‡æœº interface enp3s0 # æŒ‡å®š VRRP è¿è¡Œçš„ç½‘å¡ virtual_router_id 51 # å®šä¹‰ VRRP è·¯ç”±å™¨çš„ ID ï¼Œå–å€¼ 1~255 ï¼ŒåŒä¸€ç»„ VRRP è·¯ç”±å™¨çš„ ID å¿…é¡»ä¸€è‡´ï¼Œè¿™ä¸ª ID ä¼šç”¨äºè™šæ‹Ÿè·¯ç”±å™¨çš„ MAC åœ°å€ priority 100 # å®šä¹‰æœ¬æœºçš„ä¼˜å…ˆçº§ï¼Œå–å€¼ 1~254 ï¼Œæ•°å­—è¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼ŒMASTER åº”è¯¥æ¯” BACKUP é«˜ 50 ä»¥ä¸Šã€‚ virtual_ipaddress { # å®šä¹‰è™šæ‹Ÿ IP 192.168.1.3/24 } } å¤‡æœºï¼š\nvrrp_instance VI_1 { state BACKUP interface enp3s0 virtual_router_id 51 priority 40 virtual_ipaddress { 192.168.1.3/24 } } é…ç½®å®Œæˆåï¼Œæ‰§è¡Œ systemctl start keepalived å‘½ä»¤å¯åŠ¨ keepalived æœåŠ¡ã€‚\néªŒè¯ #ä¸»æœºæ­£å¸¸çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥çœ‹åˆ°ä¸»æœºçš„ VRRP å®ä¾‹å¤„äº MASTER çŠ¶æ€ï¼š\n# systemctl status keepalived.service â— keepalived.service - Keepalive Daemon (LVS and VRRP) Loaded: loaded (/lib/systemd/system/keepalived.service; enabled; vendor preset: enabled) Active: active (running) since Sat 2019-08-24 16:22:33 CST; 9min ago Process: 2311 ExecStart=/usr/sbin/keepalived $DAEMON_ARGS (code=exited, status=0/SUCCESS) Main PID: 2315 (keepalived) Tasks: 3 Memory: 1.2M CPU: 195ms CGroup: /system.slice/keepalived.service â”œâ”€2315 /usr/sbin/keepalived â”œâ”€2316 /usr/sbin/keepalived â””â”€2319 /usr/sbin/keepalived Aug 24 16:22:33 ubuntu Keepalived_vrrp[2319]: Using LinkWatch kernel netlink reflector... Aug 24 16:22:33 ubuntu Keepalived_healthcheckers[2316]: Registering Kernel netlink reflector Aug 24 16:22:33 ubuntu Keepalived_healthcheckers[2316]: Registering Kernel netlink command channel Aug 24 16:22:33 ubuntu Keepalived_healthcheckers[2316]: Opening file \u0026#39;/etc/keepalived/keepalived.conf\u0026#39;. Aug 24 16:22:33 ubuntu Keepalived_healthcheckers[2316]: Using LinkWatch kernel netlink reflector... Aug 24 16:25:27 ubuntu Keepalived_vrrp[2319]: VRRP_Instance(VI_1) Entering MASTER STATE ä»¥åŠè™šæ‹Ÿ IP æŒ‡å‘ä¸»æœºçš„ç½‘å¡ï¼š\nroot@ubuntu:~# ip addr 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever 2: enp3s0: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000 link/ether 00:1d:f3:52:99:10 brd ff:ff:ff:ff:ff:ff inet 192.168.1.1/24 brd 192.168.1.255 scope global enp3s0 valid_lft forever preferred_lft forever inet 192.168.1.3/24 scope global secondary enp3s0 valid_lft forever preferred_lft forever inet6 fe80::21d:f3ff:fe52:9910/64 scope link valid_lft forever preferred_lft forever å¦‚æœæŠŠä¸»æœºå…³é—­ï¼Œåˆ™å¤‡æœºçš„ VRRP å®ä¾‹çŠ¶æ€ä¼šå˜ä¸º MASTER ï¼Œè™šæ‹Ÿ IP ä¹Ÿä¼šæŒ‡å‘å¤‡æœºçš„ç½‘å¡ï¼š\n# systemctl status keepalived.service â— keepalived.service - Keepalive Daemon (LVS and VRRP) Loaded: loaded (/lib/systemd/system/keepalived.service; enabled; vendor preset: enabled) Active: active (running) since Sat 2019-08-24 16:22:33 CST; 9min ago Process: 2311 ExecStart=/usr/sbin/keepalived $DAEMON_ARGS (code=exited, status=0/SUCCESS) Main PID: 2315 (keepalived) Tasks: 3 Memory: 1.2M CPU: 195ms CGroup: /system.slice/keepalived.service â”œâ”€2315 /usr/sbin/keepalived â”œâ”€2316 /usr/sbin/keepalived â””â”€2319 /usr/sbin/keepalived Aug 24 16:22:33 ubuntu Keepalived_vrrp[2319]: Using LinkWatch kernel netlink reflector... Aug 24 16:22:33 ubuntu Keepalived_healthcheckers[2316]: Registering Kernel netlink reflector Aug 24 16:22:33 ubuntu Keepalived_healthcheckers[2316]: Registering Kernel netlink command channel Aug 24 16:22:33 ubuntu Keepalived_healthcheckers[2316]: Opening file \u0026#39;/etc/keepalived/keepalived.conf\u0026#39;. Aug 24 16:22:33 ubuntu Keepalived_healthcheckers[2316]: Using LinkWatch kernel netlink reflector... Aug 24 16:22:34 ubuntu Keepalived_vrrp[2319]: VRRP_Instance(VI_1) Entering BACKUP STATE Aug 24 16:25:26 ubuntu Keepalived_vrrp[2319]: VRRP_Instance(VI_1) Transition to MASTER STATE Aug 24 16:25:27 ubuntu Keepalived_vrrp[2319]: VRRP_Instance(VI_1) Entering MASTER STATE å‚è€ƒ # è™šæ‹Ÿè·¯ç”±å†—ä½™åè®®(VRRP) CentOS 7 é…ç½® Keepalived å®ç°åŒæœºçƒ­å¤‡ è™šæ‹Ÿ IP æŠ€æœ¯ Linux-eth0 eth0:1 å’Œeth0.1å…³ç³»ã€ifconfigä»¥åŠè™šæ‹ŸIPå®ç°ä»‹ç» ","date":"2019 August 24","permalink":"/posts/2019/08/24/","section":"Posts","summary":"keepalived æ˜¯ä¸€ä¸ªç”¨ C è¯­è¨€ç¼–å†™çš„å…è´¹å¼€æºè½¯ä»¶ï¼Œå®ƒå®ç°äº† VRRPåè®®ï¼ŒåŒæ—¶æä¾›äº†å¼ºå¤§çš„è´Ÿè½½å‡è¡¡ (LVS) åŠŸèƒ½ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ä»–çš„ VRRP åŠŸèƒ½å®ç°è·¯ç”±å™¨æˆ–è€…æœåŠ¡å™¨ç­‰ç½‘ç»œè®¾å¤‡çš„åŒæœºçƒ­å¤‡ã€‚ç®€å•çš„è¯´ï¼Œä¸¤å°è·¯ç”±å™¨ï¼Œä¸€å°ä½œä¸ºä¸»æœºï¼Œä¸€å°ä½œä¸ºå¤‡æœºï¼Œä¸¤å°è·¯ç”±å™¨æœ‰è‡ªå·±çš„ç‹¬ç«‹ IP ï¼ŒåŒæ—¶å…±äº«ä¸€ä¸ªè™šæ‹Ÿ IP ï¼Œä¸»æœºæ­£å¸¸æ˜¯ï¼Œè¿™ä¸ªè™šæ‹Ÿ IP æŒ‡å‘ä¸»æœºï¼Œå½“ä¸»æœºå‡ºç°æ•…éšœæ—¶ï¼Œè™šæ‹Ÿ IP æŒ‡å‘å¤‡æœºï¼Œå®ç°äº†è·¯ç”±å™¨çš„æ— ç¼è‡ªåŠ¨åˆ‡æ¢ã€‚ç½‘ç»œæ‹“æ‰‘å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š","title":"ä½¿ç”¨ keepalived å®ç°åŒæœºçƒ­å¤‡"},{"content":"aes åŠ å¯†éœ€è¦ä¸€ä¸ªå­—ç¬¦ä¸²ä½œä¸ºå¯†é’¥ï¼Œè‡ªå·±å†™ä¸€ä¸ªï¼Œæˆ–è€…ç”¨å®Œæˆçš„å·¥å…·ç”Ÿæˆä¸€éšæœºçš„ï¼Œå‡è®¾å¯†é’¥ä¸º passphrase ï¼ŒåŠ å¯†ä¸€ä¸ªæ–‡ä»¶ fileï¼š\nopenssl enc -aes-128-cbc -in file -out file.enc -k passphrase ä¹Ÿå¯ä»¥æŠŠå¯†é’¥å­˜æ”¾åœ¨ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œç„¶åç”¨ -kfile é€‰é¡¹æŒ‡å®šï¼š\nopenssl enc -aes-128-cbc -in file -out file.enc -kfile passphrase.txt ","date":"2019 August 18","permalink":"/posts/2019/08/18/","section":"Posts","summary":"aes åŠ å¯†éœ€è¦ä¸€ä¸ªå­—ç¬¦ä¸²ä½œä¸ºå¯†é’¥ï¼Œè‡ªå·±å†™ä¸€ä¸ªï¼Œæˆ–è€…ç”¨å®Œæˆçš„å·¥å…·ç”Ÿæˆä¸€éšæœºçš„ï¼Œå‡è®¾å¯†é’¥ä¸º passphrase ï¼ŒåŠ å¯†ä¸€ä¸ªæ–‡ä»¶ fileï¼š","title":"ä½¿ç”¨ openssl è¿›è¡Œ AES åŠ å¯†"},{"content":"æœ‰æ—¶æˆ‘ä»¬éœ€è¦è¿æ¥ä¸åŒå±€åŸŸç½‘çš„ä¸¤å°ä¸»æœºï¼Œä½¿å…¶å¯ä»¥äº’ç›¸è®¿é—®ï¼Œæ¯”å¦‚ç”¨å®¶é‡Œçš„ç”µè„‘ç™»å½•åŠå…¬å®¤ç”µè„‘çš„æŸä¸ªæœåŠ¡ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ OpenVPN å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œå®ƒçš„åŸç†æ˜¯åœ¨ä¸¤å°ç”µè„‘ä¸Šå®‰è£… OpenVPN å®¢æˆ·ç«¯ï¼ŒåŒæ—¶è¿æ¥å…¬ç½‘ä¸Šçš„ OpenVPN æœåŠ¡å™¨ï¼ŒOpenVPN ä¼šå°†è¿™ä¸¤å°ç”µè„‘ç»„æˆä¸€ä¸ªè™šæ‹Ÿå±€åŸŸç½‘ï¼Œå®ƒä»¬å°±å¯ä»¥åƒå±€åŸŸç½‘å†…ä¸€æ ·äº’ç›¸è®¿é—®äº†ã€‚æ­å»º VPN å‰çš„ç½‘ç»œæ‹“æ‰‘å¦‚ä¸‹ï¼š\nå®¶é‡Œçš„ç”µè„‘æ˜¯ Windows7 ç³»ç»Ÿï¼ŒåŠå…¬å®¤çš„ç”µè„‘å®‰è£…äº† Ubuntu16.04 ï¼Œå…¬ç½‘ä¸Šçš„ VPS å®‰è£…äº† Ubuntu16.04 ã€‚å¦‚æœå…¨éƒ¨éƒ½æ˜¯ Windows ç³»ç»Ÿï¼Œé…ç½®èµ·æ¥ä¼šæ›´æ–¹ä¾¿ä¸€ç‚¹ï¼ŒLinux ä¸‹çš„æ–‡æœ¬æ“ä½œç•¥æ˜¾ç¹çï¼Œå¥½åœ¨ SoftEther æä¾›äº†å¯ä»¥è¿œç¨‹ç®¡ç†çš„ GUI å·¥å…·ã€‚\n1. åœ¨ VPS ä¸Šå®‰è£… SoftEther #SoftEther è¿™å¥—è½¯ä»¶å…¶å®æ˜¯ä¸€ä¸ªå®Œæ•´çš„å¤¸å¹³å° VPN è§£å†³æ–¹æ¡ˆï¼Œåœ¨å•ä¸€è½¯ä»¶å†…é›†æˆäº† OpenVPN ã€L2TP ã€IPsec ç­‰ VPN åè®®ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒåœ¨ VPS ä¸Šæ­å»ºä¸€ä¸ª OpenVPN çš„æœåŠ¡å™¨ï¼Œéå¸¸æ–¹ä¾¿ã€‚\né¦–å…ˆåœ¨ SoftEther ä¸‹è½½ä¸­å¿ƒ ä¸‹è½½ X64-Linux å¹³å°çš„ SoftEther VPN Serverï¼Œæˆ‘ä¸‹è½½çš„ç‰ˆæœ¬æ˜¯ softether-vpnserver-v4.29-9680-rtm-2019.02.28-linux-x64-64bit.tar.gz ï¼Œå°†å…¶è§£å‹åˆ° VPS çš„ç”¨æˆ·æ ¹ç›®å½•ä¸‹ï¼Œå¾—åˆ°ä¸€ä¸ªåä¸º vpnserver çš„æ–‡ä»¶å¤¹ï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹æ‰§è¡Œ ./.install.sh ï¼Œæ ¹æ®æç¤ºä¾æ¬¡è¾“å…¥ä¸‰æ¬¡æ•°å­— 1 å¹¶æŒ‰å›è½¦å³å¯å®Œæˆç¼–è¯‘å®‰è£…ï¼Œæ‰€æœ‰çš„å¯æ‰§è¡Œæ–‡ä»¶è¿˜æ˜¯åœ¨è¿™ä¸ªè·¯å¾„ä¸‹ï¼Œå…ˆæ‰§è¡Œ sudo ./vpnserver start è®©æœåŠ¡å™¨åœ¨åå°è¿è¡Œï¼Œç„¶åæ‰§è¡Œ ./vpncmd å¼€å§‹åˆå§‹åŒ–é…ç½®ï¼ŒæŒ‰å¦‚ä¸‹è¾“å…¥ï¼š\nubuntu@VM-231-137-ubuntu:~/vpnserver$ sudo ./vpnserver start The SoftEther VPN Server service has been started. ubuntu@VM-231-137-ubuntu:~/vpnserver$ ./vpncmd vpncmd command - SoftEther VPN Command Line Management Utility SoftEther VPN Command Line Management Utility (vpncmd command) Version 4.29 Build 9680 (English) Compiled 2019/02/28 19:22:54 by yagi at pc33 Copyright (c) SoftEther VPN Project. All Rights Reserved. By using vpncmd program, the following can be achieved. 1. Management of VPN Server or VPN Bridge 2. Management of VPN Client 3. Use of VPN Tools (certificate creation and Network Traffic Speed Test Tool) Select 1, 2 or 3: [åœ¨è¿™é‡Œè¾“å…¥ 1 ï¼Œè¡¨ç¤ºç®¡ç† VPN æœåŠ¡å™¨] Specify the host name or IP address of the computer that the destination VPN Server or VPN Bridge is operating on. By specifying according to the format â€˜host name:port numberâ€™, you can also specify the port number. (When the port number is unspecified, 443 is used.) If nothing is input and the Enter key is pressed, the connection will be made to the port number 8888 of localhost (this computer). Hostname of IP Address of Destination:[è¿™é‡Œæ•²å›è½¦é”®ï¼ŒæŒ‰é»˜è®¤é…ç½®ä½¿ç”¨ 443 ç«¯å£] If connecting to the server by Virtual Hub Admin Mode, please input the Virtual Hub name. If connecting by server admin mode, please press Enter without inputting anything. Specify Virtual Hub Name: [è¿™é‡Œæ•²å›è½¦é”®] Connection has been established with VPN Server â€œlocalhostâ€ (port 443).You have administrator privileges for the entire VPN Server. VPN Server\u0026gt;[è¾“å…¥ ServerPasswordSet ï¼Œè¡¨ç¤ºè®¾ç½®ä¸€ä¸ªå¯†ç ] ServerPasswordSet command - Set VPN Server Administrator PasswordPlease enter the password. To cancel press the Ctrl+D key. Password: [è¾“å…¥ä½ çš„å¯†ç ] Confirm input: [å†æ¬¡è¾“å…¥ä½ çš„å¯†ç ] ä¹‹åçš„é…ç½®å¯ä»¥ç”¨ Windows ä¸‹çš„è¿œç¨‹ç®¡ç†å·¥å…·è¿›è¡Œã€‚\né¦–å…ˆåœ¨ SoftEther ä¸‹è½½ä¸­å¿ƒ ä¸‹è½½ X64-Windows å¹³å°çš„ SoftEther VPN Server ï¼ŒæŠŠå®ƒå®‰è£…åœ¨å®¶é‡Œçš„ç¬”è®°æœ¬ä¸Šï¼Œå®‰è£…æ—¶é€‰æ‹© SoftEther VPN Server ç®¡ç†å·¥å…·ï¼ˆä»…é™ç®¡ç†å·¥å…·ï¼‰ ï¼Œæˆ‘ä»¬åªæ˜¯ç”¨å®ƒæ¥è¿æ¥å¹¶é…ç½® VPS ä¸Šçš„ VPN æœåŠ¡å™¨ï¼š\nå®‰è£…å®Œæˆåå¯åŠ¨ SoftEther VPN Server ç®¡ç†å™¨ ï¼Œåœ¨è¿æ¥è®¾ç½®ç•Œé¢ä¸­ç‚¹å‡» æ–°è®¾ç½® æŒ‰é’®ï¼Œåœ¨å¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­æŒ‰å¦‚ä¸‹è®¾ç½®ï¼Œæ–°å»ºä¸€ä¸ªæŒ‡å‘ VPS çš„è¿æ¥ï¼š\næ–°å»ºæˆåŠŸåï¼Œåœ¨è¿æ¥è®¾ç½®ç•Œé¢åŒå‡»è¿™ä¸ªè®¾ç½®ï¼Œå¼€å§‹è¿æ¥ VPS ï¼Œè¿æ¥æˆåŠŸåä¼šå¼¹å‡ºä¸€ä¸ªç®¡ç†å¯¹è¯æ¡†ï¼Œè¿™é‡Œä¼šå‡ºç°ä¸€ä¸ªé»˜è®¤çš„è™šæ‹Ÿ HUB ï¼Œå…ˆå°†å…¶åˆ é™¤ï¼Œç„¶åç‚¹å‡» åˆ›å»ºè™šæ‹Ÿ HUB æŒ‰é’®ï¼ŒæŒ‰å¦‚ä¸‹è®¾ç½®ï¼Œç„¶åç‚¹å‡» ç¡®å®š ï¼Œå°±å¯ä»¥æ–°å»ºä¸€ä¸ªè™šæ‹Ÿ HUB ï¼Œå…¶ä¸­åå­—å’Œå¯†ç éƒ½å¯ä»¥è‡ªå®šä¹‰ï¼š\nå›åˆ°ç®¡ç†ç•Œé¢ï¼ŒåŒå‡»åˆšæ‰æ–°å»ºçš„è¿™ä¸ªè™šæ‹Ÿ HUB ï¼Œè¿›å…¥è¿™ä¸ª HUB çš„ç®¡ç†ç•Œé¢ï¼š\nç‚¹å‡» ç®¡ç†ç”¨æˆ· ï¼Œä¸ºè¿™ä¸ª HUB æ–°å»ºä¸€ä¸ªç”¨æˆ·ï¼ŒæŒ‰å¦‚ä¸‹è®¾ç½®ï¼š\nå›åˆ°è¿™ä¸ª HUB çš„ç®¡ç†ç•Œé¢ï¼Œç‚¹å‡» è™šæ‹Ÿ NAT å’Œ è™šæ‹Ÿ DHCP æœåŠ¡å™¨ ï¼Œåœ¨å¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­ç‚¹å‡» å¯åŠ¨ SecureNAT ï¼Œå¦‚æœæƒ³ä¿®æ”¹é…ç½®ï¼Œå¯ä»¥ç‚¹å‡» SecureNAT é…ç½® ã€‚è‡³æ­¤ï¼ŒVPN æœåŠ¡å™¨é…ç½®éƒ½ç»“æŸäº†ï¼Œæˆ‘ä»¬éœ€è¦å¯¼å‡ºç›¸åº”çš„å®¢æˆ·ç«¯é…ç½®ï¼Œä¾›åé¢çš„å®¢æˆ·ç«¯ä½¿ç”¨ã€‚åœ¨ç®¡ç†ç•Œé¢çš„å³ä¸‹è§’ç‚¹å‡» OpenVPN/MS-SSTP è®¾ç½® æŒ‰é’®ï¼Œåœ¨å¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­æŒ‰å¦‚ä¸‹è®¾ç½®ï¼š\nç„¶åç‚¹å‡» ä¸º OpenVPN Client ç”Ÿæˆé…ç½®æ ·æœ¬æ–‡ä»¶ å°±å¯ä»¥å¯¼å‡ºä¸€ä¸ªä¿æŠ¤é…ç½®æ–‡ä»¶çš„å‹ç¼©åŒ…ï¼Œå‹ç¼©åŒ…é‡Œä¼šæœ‰ä¸¤ä¸ªé…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ L3 ç”¨äºè¿œç¨‹è®¿é—®çš„è¿™ä¸ªï¼š\næ³¨æ„ï¼ŒVPS ä¸Šä½¿ç”¨äº†é»˜è®¤çš„ TCP:443 å’Œ UDP:1194 ç«¯å£ï¼Œè¦è®°å¾—åœ¨ VPS çš„é˜²ç«å¢™ä¸Šæ‰“å¼€è¿™ä¸¤ä¸ªç«¯å£ï¼Œå¦åˆ™ä¼šé€ æˆå®¢æˆ·ç«¯è¿æ¥å¤±è´¥ã€‚\n2. åœ¨å®¶é‡Œç”µè„‘ä¸Šå®‰è£… OpenVPN å®¢æˆ·ç«¯ #åœ¨ OpenVPN ä¸‹è½½ä¸­å¿ƒ ä¸‹è½½ Win7 ç‰ˆçš„å®‰è£…åŒ…ï¼Œä¸€è·¯ Next å®‰è£…æˆåŠŸåå¯åŠ¨ OpenVPN GUI ï¼Œé¦–æ¬¡å¯åŠ¨ä¼šæç¤ºæ²¡æœ‰é…ç½®æ–‡ä»¶ï¼Œè¿™æ—¶éœ€è¦åœ¨çŠ¶æ€æ çš„ OpenVPN å›¾æ ‡ä¸Šç‚¹å‡»å³é”®ï¼Œé€‰æ‹© å¯¼å…¥é…ç½®æ–‡ä»¶... :\nå¯¼å…¥ä¸Šä¸€æ­¥å¾—åˆ°çš„ vm-231-137-ubunt_openvpn_remote_access_l3.ovpn é…ç½®æ–‡ä»¶ï¼Œç„¶åç‚¹å‡» è¿æ¥ ï¼ŒæŒ‰æç¤ºè¾“å…¥ OpenVPN æœåŠ¡å™¨ä¸­è®¾ç½®çš„ç”¨æˆ·åå’Œå¯†ç ï¼š\nç‚¹å‡» ç¡®å®š åå¼€å§‹è¿æ¥ï¼Œè¿æ¥æˆåŠŸåä¼šè·å¾—è™šæ‹Ÿå±€åŸŸç½‘ä¸ºæœ¬æœºåˆ†é…çš„ IP ï¼š\n3. åœ¨åŠå…¬å®¤ç”µè„‘ä¸Šå®‰è£… OpenVPN å®¢æˆ·ç«¯ #åœ¨ Ubuntu ä¸Šç”¨ sudo apt-get install openvpn å‘½ä»¤å®‰è£… OpenVPN ï¼Œç„¶åæŠŠé…ç½®æ–‡ä»¶ vm-231-137-ubunt_openvpn_remote_access_l3.ovpn å¤åˆ¶åˆ° /etc/openvpn/ è·¯å¾„ä¸‹ï¼Œå¹¶æ”¹åä¸º client.conf ï¼Œç„¶åæ‰§è¡Œ systemctl start openvpn@client å¯åŠ¨è¿æ¥ï¼š\nroot@ubuntu:~# systemctl start openvpn@client Enter Auth Username: **** Enter Auth Password: *********** root@ubuntu:~# systemctl status openvpn@client â— openvpn@client.service - OpenVPN connection to client Loaded: loaded (/lib/systemd/system/openvpn@.service; disabled; vendor preset: enabled) Active: active (running) since Wed 2019-07-03 10:12:01 CST; 11s ago Docs: man:openvpn(8) https://community.openvpn.net/openvpn/wiki/Openvpn23ManPage https://community.openvpn.net/openvpn/wiki/HOWTO Process: 2409 ExecStart=/usr/sbin/openvpn --daemon ovpn-%i --status /run/openvpn/%i.status 10 --cd /etc/openvp Main PID: 2429 (openvpn) CGroup: /system.slice/system-openvpn.slice/openvpn@client.service â””â”€2429 /usr/sbin/openvpn --daemon ovpn-client --status /run/openvpn/client.status 10 --cd /etc/openvp Jul 03 10:12:04 ubuntu ovpn-client[2429]: ROUTE_GATEWAY 10.231.222.129/255.255.255.248 IFACE=enp0s29u1u3u1c2 HWA Jul 03 10:12:04 ubuntu ovpn-client[2429]: TUN/TAP device tun0 opened Jul 03 10:12:04 ubuntu ovpn-client[2429]: TUN/TAP TX queue length set to 100 Jul 03 10:12:04 ubuntu ovpn-client[2429]: do_ifconfig, tt-\u0026gt;ipv6=0, tt-\u0026gt;did_ifconfig_ipv6_setup=0 Jul 03 10:12:04 ubuntu ovpn-client[2429]: /sbin/ip link set dev tun0 up mtu 1500 Jul 03 10:12:04 ubuntu ovpn-client[2429]: /sbin/ip addr add dev tun0 local 192.168.30.13 peer 192.168.30.14 Jul 03 10:12:04 ubuntu ovpn-client[2429]: /sbin/ip route add 118.89.16.2/32 via 10.231.222.129 Jul 03 10:12:04 ubuntu ovpn-client[2429]: /sbin/ip route add 0.0.0.0/1 via 192.168.30.14 Jul 03 10:12:04 ubuntu ovpn-client[2429]: /sbin/ip route add 128.0.0.0/1 via 192.168.30.14 Jul 03 10:12:04 ubuntu ovpn-client[2429]: Initialization Sequence Completed root@ubuntu:~# ps -ef | grep openvpn root 2429 1 0 10:12 ? 00:00:00 /usr/sbin/openvpn --daemon ovpn-client --status /run/openvpn/client.status 10 --cd /etc/openvpn --script-security 2 --config /etc/openvpn/client.conf --writepid /run/openvpn/client.pid root 2503 1858 0 10:12 pts/0 00:00:00 grep --color=auto openvpn è¿æ¥æˆåŠŸåä¼šå‡ºç° tun0 ç½‘ç»œæ¥å£ï¼Œå¹¶è·å¾—ä¸€ä¸ª IP ï¼š\nroot@ubuntu:~# ifconfig tun0 tun0 Link encap:UNSPEC HWaddr 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00 inet addr:192.168.30.13 P-t-P:192.168.30.14 Mask:255.255.255.255 UP POINTOPOINT RUNNING NOARP MULTICAST MTU:1500 Metric:1 RX packets:6 errors:0 dropped:0 overruns:0 frame:0 TX packets:6 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:100 RX bytes:396 (396.0 B) TX bytes:396 (396.0 B) root@ubuntu:~# cat /run/openvpn/client.status OpenVPN STATISTICS Updated,Wed Jul 3 10:12:52 2019 TUN/TAP read bytes,594 TUN/TAP write bytes,594 TCP/UDP read bytes,4196 TCP/UDP write bytes,2725 Auth read bytes,850 END 4. æµ‹è¯• #è¿æ¥æˆåŠŸåçš„ç½‘ç»œæ‹“æ‰‘å¦‚ä¸‹ï¼š\nå®¢æˆ·ç«¯é€šè¿‡ VPN éš§é“è¿æ¥åˆ°äº†æœåŠ¡å™¨çš„è™šæ‹Ÿ HUB ä¸Šï¼Œå…±åŒç»„æˆäº†ä¸€ä¸ª 192.168.30.0/24 çš„å±€åŸŸç½‘ï¼Œå®¢æˆ·ç«¯ç›´æ¥å¯ä»¥æƒ³å±€åŸŸç½‘å†…ä¸€æ ·ç›¸äº’è®¿é—®ï¼Œåœ¨å®¶é‡Œç”µè„‘ä¸Š ping åŠå…¬å®¤å†…çš„ç”µè„‘ï¼š\n5. é…ç½®ç­¾åè¯ä¹¦ #ä¸Šé¢å»ºç«‹çš„ VPN æœåŠ¡å™¨æ”¯æŒçš„æ˜¯å¯†ç éªŒè¯ï¼Œå¦‚æœè¦ä½¿ç”¨ç­¾åè¯ä¹¦è®¤è¯ï¼Œéœ€è¦ç”¨ OpenVPN æ­å»ºæœåŠ¡å™¨ï¼Œå› ä¸º SoftEther å¯¹ç­¾åè¯ä¹¦è®¤è¯æ”¯æŒä¸å¤Ÿå®Œå–„ã€‚ç­¾åè¯ä¹¦ç”±æœåŠ¡å™¨ç«¯ç­¾å‘ï¼Œéœ€è¦åˆ¶ä½œä¸‰ä¸ªè¯ä¹¦ï¼š CA è¯ä¹¦ã€æœåŠ¡å™¨ç«¯è¯ä¹¦å’Œå®¢æˆ·ç«¯è¯ä¹¦ã€‚\n5.1. ç”Ÿæˆè¯ä¹¦ #å…ˆåœ¨æœåŠ¡å™¨ç«¯ä½¿ç”¨ sudo apt-get install openvpn easy-rsa å‘½ä»¤å®‰è£… OpenVPN å’Œè¯ä¹¦åˆ¶ä½œå·¥å…· easy-rsa ã€‚ç„¶åæŠŠ /usr/share/easy-rsa/ æ–‡ä»¶å¤¹åŠå…¶å†…å®¹å¤åˆ¶åˆ° /etc/openvpn/ è·¯å¾„ä¸‹ï¼Œç„¶åç¼–è¾‘å…¶ä¸­çš„ vars æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯ easy-rsa çš„é…ç½®æ–‡ä»¶ï¼ŒåŒ…å«äº†ç”Ÿæˆè¯ä¹¦å’Œå¯†é’¥æ—¶ä½¿ç”¨çš„é€‰é¡¹ï¼Œå¯ä»¥ä½¿ç”¨é»˜è®¤å€¼ï¼Œæˆ–è€…æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹å¦‚ä¸‹é€‰é¡¹ï¼š\n# These are the default values for fields # which will be placed in the certificate. # Don\u0026#39;t leave any of these fields blank. export KEY_COUNTRY=\u0026#34;CN\u0026#34; #å›½å®¶ export KEY_PROVINCE=\u0026#34;GD\u0026#34; #çœä»½ export KEY_CITY=\u0026#34;Shenzhen\u0026#34; #åŸå¸‚ export KEY_ORG=\u0026#34;Fort-Funston\u0026#34; #ç»„ç»‡/å…¬å¸ export KEY_EMAIL=\u0026#34;me@myhost.mydomain\u0026#34; #Email export KEY_OU=\u0026#34;MyOrganizationalUnit\u0026#34; #éƒ¨é—¨åç§° # X509 Subject Field export KEY_NAME=\u0026#34;EasyRSA\u0026#34; #å¯†é’¥çš„åç§° ç„¶åä½¿è¿™é¡¹é€‰é¡¹ç”Ÿæ•ˆï¼Œå¹¶åˆå§‹åŒ–ï¼Œéœ€è¦å…ˆåˆ‡æ¢åˆ° root ç”¨æˆ·ï¼š\nubuntu@VM-231-137-ubuntu:~$ sudo su root@VM-231-137-ubuntu:~# cd /etc/openvpn/easy-rsa root@VM-231-137-ubuntu:/etc/openvpn/easy-rsa# source vars NOTE: If you run ./clean-all, I will be doing a rm -rf on /etc/openvpn/easy-rsa/keys root@VM-231-137-ubuntu:/etc/openvpn/easy-rsa# ./clean-all æ‰§è¡Œ ./build-ca æ–°å»º CA è¯ä¹¦ï¼Œä¸€è·¯å›è½¦å³å¯ï¼Œç”Ÿæˆçš„è¯ä¹¦å’Œå¯†é’¥åœ¨ keys æ–‡ä»¶å¤¹ä¸‹ï¼ŒæŠŠè¯ä¹¦å¤åˆ¶åˆ° /etc/openvpn/ ç›®å½•ä¸‹ï¼š\nroot@VM-231-137-ubuntu:/etc/openvpn/easy-rsa# ls keys/ ca.crt ca.key index.txt serial root@VM-231-137-ubuntu:/etc/openvpn/easy-rsa# cp -rf keys/ca.crt /etc/openvpn/ æ‰§è¡Œ ./build-key-server EasyRSA æ–°å»ºæœåŠ¡å™¨ç«¯è¯ä¹¦ï¼Œå…¶ä¸­ EasyRSA æ˜¯ vars æ–‡ä»¶ä¸­è®¾ç½®çš„ KEY_NAME çš„å€¼ï¼Œå†æ‰§è¡Œ ./build-dh ç”Ÿæˆå¯†é’¥äº¤æ¢æ‰€éœ€çš„ Diffe-Hellman æ–‡ä»¶ï¼Œä¸€è·¯å›è½¦åï¼Œç”Ÿæˆçš„è¯ä¹¦å’Œå¯†é’¥ç­‰éƒ½åœ¨ keys æ–‡ä»¶å¤¹ä¸‹ï¼ŒæŠŠä»–ä»¬å¤åˆ¶åˆ° /etc/openvpn/ ç›®å½•ä¸‹ï¼š\nroot@VM-231-137-ubuntu:/etc/openvpn/easy-rsa# ll keys/ total 60 drwx------ 2 root root 4096 Jul 3 17:51 ./ drwxr-xr-x 3 root root 4096 Jul 3 17:43 ../ -rw-r--r-- 1 root root 5702 Jul 3 17:45 01.pem -rw-r--r-- 1 root root 5702 Jul 3 17:45 EasyRSA.crt -rw-r--r-- 1 root root 1094 Jul 3 17:45 EasyRSA.csr -rw------- 1 root root 1704 Jul 3 17:45 EasyRSA.key -rw-r--r-- 1 root root 1801 Jul 3 17:27 ca.crt -rw------- 1 root root 1704 Jul 3 17:27 ca.key -rw-r--r-- 1 root root 424 Jul 3 17:51 dh2048.pem -rw-r--r-- 1 root root 146 Jul 3 17:45 index.txt -rw-r--r-- 1 root root 21 Jul 3 17:45 index.txt.attr -rw-r--r-- 1 root root 0 Jul 3 17:23 index.txt.old -rw-r--r-- 1 root root 3 Jul 3 17:45 serial -rw-r--r-- 1 root root 3 Jul 3 17:23 serial.old root@VM-231-137-ubuntu:/etc/openvpn/easy-rsa# cp -rf keys/EasyRSA.crt /etc/openvpn/ root@VM-231-137-ubuntu:/etc/openvpn/easy-rsa# cp -rf keys/EasyRSA.key /etc/openvpn/ root@VM-231-137-ubuntu:/etc/openvpn/easy-rsa# cp -rf keys/dh2048.pem /etc/openvpn/ æ‰§è¡Œ ./build-key client æ–°å»ºå®¢æˆ·ç«¯è¯ä¹¦ï¼Œclient æ˜¯è¯ä¹¦åç§°ï¼Œå¯ä»¥è‡ªå®šä¹‰ï¼Œç”Ÿæˆçš„å®¢æˆ·ç«¯è¯ä¹¦å’Œå¯†é’¥ç­‰éƒ½åœ¨ keys æ–‡ä»¶å¤¹ä¸‹ï¼š\nroot@VM-231-137-ubuntu:/etc/openvpn/easy-rsa# ll keys/ total 92 drwx------ 2 root root 4096 Jul 3 17:57 ./ drwxr-xr-x 3 root root 4096 Jul 3 17:43 ../ -rw-r--r-- 1 root root 5702 Jul 3 17:45 01.pem -rw-r--r-- 1 root root 5578 Jul 3 17:57 02.pem -rw-r--r-- 1 root root 5702 Jul 3 17:45 EasyRSA.crt -rw-r--r-- 1 root root 1094 Jul 3 17:45 EasyRSA.csr -rw------- 1 root root 1704 Jul 3 17:45 EasyRSA.key -rw-r--r-- 1 root root 1801 Jul 3 17:27 ca.crt -rw------- 1 root root 1704 Jul 3 17:27 ca.key -rw-r--r-- 1 root root 5578 Jul 3 17:57 client.crt -rw-r--r-- 1 root root 1094 Jul 3 17:57 client.csr -rw------- 1 root root 1704 Jul 3 17:57 client.key -rw-r--r-- 1 root root 424 Jul 3 17:51 dh2048.pem -rw-r--r-- 1 root root 291 Jul 3 17:57 index.txt -rw-r--r-- 1 root root 21 Jul 3 17:57 index.txt.attr -rw-r--r-- 1 root root 21 Jul 3 17:45 index.txt.attr.old -rw-r--r-- 1 root root 146 Jul 3 17:45 index.txt.old -rw-r--r-- 1 root root 3 Jul 3 17:57 serial -rw-r--r-- 1 root root 3 Jul 3 17:45 serial.old 5.2. æœåŠ¡å™¨ç«¯é…ç½® #æœåŠ¡å™¨ç«¯å¯ä»¥å¤åˆ¶ OpenVPN è‡ªå¸¦çš„é…ç½®æ–‡ä»¶æ¨¡æ¿ï¼Œå¾—åˆ° server.conf ï¼Œç„¶åè¿›è¡Œä¿®æ”¹ï¼š\nroot@VM-231-137-ubuntu:~# cp -rf /usr/share/doc/openvpn/examples/sample-config-files/server.conf.gz /etc/openvpn/ root@VM-231-137-ubuntu:~# cd /etc/openvpn/ root@VM-231-137-ubuntu:/etc/openvpn# gzip -d server.conf.gz æ³¨æ„å¦‚ä¸‹å‡ ä¸ªé€‰é¡¹ï¼š\nport 1194 # ç›‘å¬çš„ç«¯å£ï¼Œä½¿ç”¨é»˜è®¤çš„ 1194 å°±è¡Œ proto udp # ä½¿ç”¨çš„ä¼ è¾“å±‚åè®®ï¼Œé»˜è®¤ä½¿ç”¨ UDP dev tun # è¿™é‡Œè®¾ç½®äº†è™šæ‹Ÿç½‘å¡çš„ç±»å‹ï¼Œtun è¡¨ç¤ºç½‘ç»œå±‚è®¾å¤‡ï¼Œå®ƒæ“ä½œ IP æ•°æ®åŒ…ï¼Œtap è¡¨ç¤ºä»¥å¤ªç½‘è®¾å¤‡ï¼Œå®ƒæ“ä½œé“¾è·¯å±‚çš„ä»¥å¤ªç½‘æ•°æ®å¸§ã€‚ ca ca.crt # æŒ‡å®š CA è¯ä¹¦ cert EasyRSA.crt # æŒ‡å®šæœåŠ¡å™¨ç«¯è¯ä¹¦ key EasyRSA.key # æŒ‡å®šæœåŠ¡å™¨ç«¯å¯†é’¥ dh dh2048.pem # æŒ‡å®š Diffe-Hellman æ–‡ä»¶ server 10.8.0.0 255.255.255.0 # è®¾ç½®è™šæ‹Ÿå±€åŸŸç½‘çš„ç½‘æ®µï¼Œ10.8.0.1 ä¼šç•™ç»™æœåŠ¡å™¨è‡ªç”¨ client-to-client # å…è®¸å®¢æˆ·ç«¯ä¹‹é—´ç›¸äº’å¯è§ï¼Œå¦åˆ™å¤šä¸ªå®¢æˆ·ç«¯åªèƒ½çœ‹åˆ°æœåŠ¡å™¨ï¼Œè€Œçœ‹ä¸åˆ°å½¼æ­¤ duplicate-cn # è¿™ä¸ªé€‰é¡¹å…è®¸å¤šä¸ªå®¢æˆ·ç«¯ä½¿ç”¨ç›¸åŒçš„è¯ä¹¦å’Œå¯†é’¥è¿›è¡Œè¿æ¥ï¼Œå¹¶åˆ†é…ä¸åŒçš„ IP ä¿å­˜ååˆ‡å›æ™®é€šç”¨æˆ·ï¼Œç„¶åå¯åŠ¨ OpenVPN æœåŠ¡å™¨ï¼š\nroot@VM-231-137-ubuntu:~# exit exit ubuntu@VM-231-137-ubuntu:~$ cd ubuntu@VM-231-137-ubuntu:~$ systemctl start openvpn@server ubuntu@VM-231-137-ubuntu:~$ systemctl status openvpn@server * openvpn@server.service - OpenVPN connection to server Loaded: loaded (/lib/systemd/system/openvpn@.service; disabled; vendor preset: enabled Active: active (running) since Thu 2019-07-04 09:05:45 CST; 2s ago Docs: man:openvpn(8) https://community.openvpn.net/openvpn/wiki/Openvpn23ManPage https://community.openvpn.net/openvpn/wiki/HOWTO Process: 20430 ExecStart=/usr/sbin/openvpn --daemon ovpn-%i --status /run/openvpn/%i.st Main PID: 20439 (openvpn) CGroup: /system.slice/system-openvpn.slice/openvpn@server.service `-20439 /usr/sbin/openvpn --daemon ovpn-server --status /run/openvpn/server.st Jul 04 09:05:45 VM-231-137-ubuntu ovpn-server[20439]: do_ifconfig, tt-\u0026gt;ipv6=0, tt-\u0026gt;did_if Jul 04 09:05:45 VM-231-137-ubuntu ovpn-server[20439]: /sbin/ip link set dev tun0 up mtu 1 Jul 04 09:05:45 VM-231-137-ubuntu ovpn-server[20439]: /sbin/ip addr add dev tun0 local 10 Jul 04 09:05:45 VM-231-137-ubuntu ovpn-server[20439]: /sbin/ip route add 10.8.0.0/24 via Jul 04 09:05:45 VM-231-137-ubuntu ovpn-server[20439]: UDPv4 link local (bound): [undef] Jul 04 09:05:45 VM-231-137-ubuntu ovpn-server[20439]: UDPv4 link remote: [undef] Jul 04 09:05:45 VM-231-137-ubuntu ovpn-server[20439]: MULTI: multi_init called, r=256 v=2 Jul 04 09:05:45 VM-231-137-ubuntu ovpn-server[20439]: IFCONFIG POOL: base=10.8.0.4 size=6 Jul 04 09:05:45 VM-231-137-ubuntu ovpn-server[20439]: IFCONFIG POOL LIST Jul 04 09:05:45 VM-231-137-ubuntu ovpn-server[20439]: Initialization Sequence Completed ubuntu@VM-231-137-ubuntu:~$ ifconfig tun0 tun0 Link encap:UNSPEC HWaddr 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00 inet addr:10.8.0.1 P-t-P:10.8.0.2 Mask:255.255.255.255 UP POINTOPOINT RUNNING NOARP MULTICAST MTU:1500 Metric:1 RX packets:0 errors:0 dropped:0 overruns:0 frame:0 TX packets:0 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:100 RX bytes:0 (0.0 B) TX bytes:0 (0.0 B) 5.3. å®¢æˆ·ç«¯é…ç½® #å®¢æˆ·ç«¯çš„è®¤è¯éœ€è¦ä¸‰ä¸ªæ–‡ä»¶ï¼šca.crt ã€client.crt å’Œ client.key ï¼Œå®ƒä»¬éƒ½åœ¨æœåŠ¡å™¨ /etc/openvpn/easy-rsa/keys/ ç›®å½•ä¸‹å·²ç»ç”Ÿæˆäº†ï¼Œå®¢æˆ·ç«¯çš„é…ç½®æ–‡ä»¶ä¹Ÿå¯ç”¨ OpenVPN æä¾›çš„æ¨¡æ¿ /usr/share/doc/openvpn/examples/sample-config-files/client.conf è¿›è¡Œä¿®æ”¹ã€‚\nä»¥ Ubuntu ç³»ç»Ÿä¸ºä¾‹ï¼ŒæŠŠä»¥ä¸Šå››ä¸ªæ–‡ä»¶å¤åˆ¶åˆ°å®¢æˆ·ç«¯çš„ /etc/openvpn/ ç›®å½•ä¸‹ï¼Œç„¶åä¿®æ”¹é…ç½®æ–‡ä»¶ /etc/openvpn/ ï¼Œæ³¨æ„å¦‚ä¸‹å‡ ä¸ªé€‰é¡¹ã€‚\ndev tun # è™šæ‹Ÿç½‘å¡ç±»å‹ï¼Œä¸æœåŠ¡å™¨ä¿æŒä¸€è‡´ proto udp # ä¼ è¾“å±‚åè®®ç±»å‹ï¼Œä¸æœåŠ¡å™¨ä¿æŒä¸€è‡´ remote 118.89.16.2 1194 # æœåŠ¡å™¨çš„ IP å’Œç«¯å£ ca ca.crt # CA è¯ä¹¦çš„æ–‡ä»¶åï¼Œå› ä¸ºåœ¨åŒä¸€ç›®å½•ä¸‹ï¼Œæ‰€ä»¥ä¸ç”¨åŠ è·¯å¾„ cert client.crt # å®¢æˆ·ç«¯è¯ä¹¦ key client.key # å®¢æˆ·ç«¯å¯†é’¥ ä¿å­˜åå¯åŠ¨ OpenVPN å®¢æˆ·ç«¯è¿æ¥ï¼Œè¿™æ¬¡å°±ä¸ç”¨å†è¾“å…¥ç”¨æˆ·åå’Œå¯†ç äº†ï¼š\nroot@ubuntu:~# systemctl start openvpn@client root@ubuntu:~# ifconfig tun0 tun0 Link encap:UNSPEC HWaddr 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00 inet addr:10.8.0.6 P-t-P:10.8.0.5 Mask:255.255.255.255 UP POINTOPOINT RUNNING NOARP MULTICAST MTU:1500 Metric:1 RX packets:0 errors:0 dropped:0 overruns:0 frame:0 TX packets:0 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:100 RX bytes:0 (0.0 B) TX bytes:0 (0.0 B) å¦‚æœæ˜¯ Windows å®¢æˆ·ç«¯ï¼Œé…ç½®æ–‡ä»¶çš„åç¼€è¦æ”¹æˆ .ovpn ï¼Œå…¶ä»–éƒ½æ˜¯ä¸€æ ·çš„ã€‚\n","date":"2019 July 2","permalink":"/posts/2019/07/02/","section":"Posts","summary":"æœ‰æ—¶æˆ‘ä»¬éœ€è¦è¿æ¥ä¸åŒå±€åŸŸç½‘çš„ä¸¤å°ä¸»æœºï¼Œä½¿å…¶å¯ä»¥äº’ç›¸è®¿é—®ï¼Œæ¯”å¦‚ç”¨å®¶é‡Œçš„ç”µè„‘ç™»å½•åŠå…¬å®¤ç”µè„‘çš„æŸä¸ªæœåŠ¡ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ OpenVPN å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œå®ƒçš„åŸç†æ˜¯åœ¨ä¸¤å°ç”µè„‘ä¸Šå®‰è£… OpenVPN å®¢æˆ·ç«¯ï¼ŒåŒæ—¶è¿æ¥å…¬ç½‘ä¸Šçš„ OpenVPN æœåŠ¡å™¨ï¼ŒOpenVPN ä¼šå°†è¿™ä¸¤å°ç”µè„‘ç»„æˆä¸€ä¸ªè™šæ‹Ÿå±€åŸŸç½‘ï¼Œå®ƒä»¬å°±å¯ä»¥åƒå±€åŸŸç½‘å†…ä¸€æ ·äº’ç›¸è®¿é—®äº†ã€‚æ­å»º VPN å‰çš„ç½‘ç»œæ‹“æ‰‘å¦‚ä¸‹ï¼š","title":"ä½¿ç”¨ OpenVPN å®ç°è¿œç¨‹è®¿é—®"},{"content":"UDP æ˜¯é¢å‘éè¿æ¥çš„ï¼Œå¦‚æœé€šè®¯åŒæ–¹éƒ½åœ¨å±€åŸŸç½‘ä¸­ï¼ŒæœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯æ²¡æœ‰åŒºåˆ«ï¼Œå¦‚æœæ˜¯å±€åŸŸç½‘å†…çš„ä¸»æœºä¸å…¬ç½‘ä¸Šçš„ä¸»æœºé€šè®¯ï¼Œç”±äº NAT åœ°å€è½¬æ¢åè®®çš„ä½œç”¨ï¼Œå¿…é¡»ç”±å±€åŸŸç½‘å†…çš„ä¸»æœºä¸»åŠ¨å‘å…¬ç½‘çš„ä¸»å¥å‘é€æ•°æ®ï¼Œå…¬ç½‘çš„ä¸»æœºä½œä¸ºæœåŠ¡å™¨ç«¯ï¼Œå¿…é¡»æ¥æ”¶å®¢æˆ·ç«¯çš„æ•°æ®åï¼Œè§£æå‡ºæº IP å’Œç«¯å£ï¼Œå†åå‘å‘é€ï¼Œå®ç°åŒå‘é€šè®¯ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ Demo ã€‚\næœåŠ¡å™¨ç«¯ï¼š\n// server.c #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;unistd.h\u0026gt; #include \u0026lt;sys/types.h\u0026gt; #include \u0026lt;sys/socket.h\u0026gt; #include \u0026lt;netinet/in.h\u0026gt; #include \u0026lt;arpa/inet.h\u0026gt; #include \u0026lt;string.h\u0026gt; #define SERVER_PORT 6789 #define CPU_PORT 9009 #define BUFF_LEN 1024 int main(int argc, char* argv[]) { int server_fd, count; struct sockaddr_in ser_addr; struct sockaddr_in src_addr; socklen_t len; char buf[BUFF_LEN]; server_fd = socket(AF_INET, SOCK_DGRAM, 0); //IPV4,UDP memset(\u0026amp;ser_addr, 0, sizeof(ser_addr)); ser_addr.sin_family = AF_INET; ser_addr.sin_addr.s_addr = htonl(INADDR_ANY); // any ip ser_addr.sin_port = htons(SERVER_PORT); // server port bind(server_fd, (struct sockaddr*)\u0026amp;ser_addr, sizeof(ser_addr)); while(1) { // recv memset(buf, 0, BUFF_LEN); len = sizeof(src_addr); count = recvfrom(server_fd, buf, BUFF_LEN, 0, (struct sockaddr*)\u0026amp;src_addr, \u0026amp;len); //block if(count == -1) { printf(\u0026#34;recieve data fail!\\n\u0026#34;); return 0; } printf(\u0026#34;server recv from %s:%d : %s\\n\u0026#34;,inet_ntoa(src_addr.sin_addr),ntohs(src_addr.sin_port),buf); // send memset(buf, 0, BUFF_LEN); sprintf(buf, \u0026#34;Server have recieved %d bytes data!\u0026#34;, count); printf(\u0026#34;server send : %s\\n\\n\u0026#34;,buf); // send to src_addr sendto(server_fd, buf, BUFF_LEN, 0, (struct sockaddr*)\u0026amp;src_addr, len); } close(server_fd); return 0; } å®¢æˆ·ç«¯ï¼š\n// cpu.c #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;unistd.h\u0026gt; #include \u0026lt;sys/types.h\u0026gt; #include \u0026lt;sys/socket.h\u0026gt; #include \u0026lt;netinet/in.h\u0026gt; #include \u0026lt;arpa/inet.h\u0026gt; #include \u0026lt;string.h\u0026gt; #define SERVER_IP \u0026#34;118.89.16.24\u0026#34; #define SERVER_PORT 6789 #define CPU_PORT 9009 #define BUFF_LEN 1024 int main(int argc, char* argv[]) { int cpu_fd; struct sockaddr_in ser_addr; struct sockaddr_in src_addr; struct sockaddr_in my_addr; socklen_t len; char buf[BUFF_LEN] = \u0026#34;cpu msg!\u0026#34;; cpu_fd = socket(AF_INET, SOCK_DGRAM, 0); //IPV4,UDP memset(\u0026amp;my_addr, 0, sizeof(my_addr)); my_addr.sin_family = AF_INET; my_addr.sin_addr.s_addr = htonl(INADDR_ANY); // any ip my_addr.sin_port = htons(CPU_PORT); // server port bind(cpu_fd, (struct sockaddr*)\u0026amp;my_addr, sizeof(my_addr)); memset(\u0026amp;ser_addr, 0, sizeof(ser_addr)); ser_addr.sin_family = AF_INET; ser_addr.sin_addr.s_addr = inet_addr(SERVER_IP); ser_addr.sin_port = htons(SERVER_PORT); len = sizeof(ser_addr); printf(\u0026#34;CPU send : %s\\n\u0026#34;,buf); sendto(cpu_fd, buf, BUFF_LEN, 0, (struct sockaddr*)\u0026amp;ser_addr, len); memset(buf, 0, BUFF_LEN); recvfrom(cpu_fd, buf, BUFF_LEN, 0, (struct sockaddr*)\u0026amp;src_addr, \u0026amp;len); //recv msg from server printf(\u0026#34;CPU recv from %s:%d : %s\\n\u0026#34;,inet_ntoa(src_addr.sin_addr),ntohs(src_addr.sin_port),buf); close(cpu_fd); return 0; } ","date":"2018 December 20","permalink":"/posts/2018/12/20/","section":"Posts","summary":"UDP æ˜¯é¢å‘éè¿æ¥çš„ï¼Œå¦‚æœé€šè®¯åŒæ–¹éƒ½åœ¨å±€åŸŸç½‘ä¸­ï¼ŒæœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯æ²¡æœ‰åŒºåˆ«ï¼Œå¦‚æœæ˜¯å±€åŸŸç½‘å†…çš„ä¸»æœºä¸å…¬ç½‘ä¸Šçš„ä¸»æœºé€šè®¯ï¼Œç”±äº NAT åœ°å€è½¬æ¢åè®®çš„ä½œç”¨ï¼Œå¿…é¡»ç”±å±€åŸŸç½‘å†…çš„ä¸»æœºä¸»åŠ¨å‘å…¬ç½‘çš„ä¸»å¥å‘é€æ•°æ®ï¼Œå…¬ç½‘çš„ä¸»æœºä½œä¸ºæœåŠ¡å™¨ç«¯ï¼Œå¿…é¡»æ¥æ”¶å®¢æˆ·ç«¯çš„æ•°æ®åï¼Œè§£æå‡ºæº IP å’Œç«¯å£ï¼Œå†åå‘å‘é€ï¼Œå®ç°åŒå‘é€šè®¯ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ Demo ã€‚","title":"UDP socket ç¼–ç¨‹å®è·µ"},{"content":"å…³äº iptables çš„åŸç†ï¼Œè¿™é‡Œæœ‰ä¸€ä»½æ•™ç¨‹å†™å¾—æ·±å…¥æµ…å‡ºï¼Œæµ…æ˜¾æ˜“æ‡‚ï¼š\niptables è¯¦è§£ å¸¸ç”¨çš„å‘½ä»¤å¯ä»¥å‚è€ƒå‚è€ƒ iptables æ‰‹å†Œ\nä¸‹é¢è®°å½•ä¸€äº›å¸¸è§çš„ iptables åº”ç”¨åœºæ™¯ã€‚\n1. IP è½¬å‘ #IP è½¬å‘ä¹Ÿå¯ä»¥å«åšè·¯ç”±è½¬å‘ï¼Œç”¨äºè¿æ¥ä¸¤ä¸ªä¸åŒçš„ç½‘æ®µï¼Œåšè½¯è·¯ç”±æ—¶ç»å¸¸ç”¨åˆ°ï¼Œå¦‚ä¸‹æ˜¯ä¸€ä¸ªåº”ç”¨åœºæ™¯çš„ç½‘ç»œæ‹“æ‰‘ï¼š\nä¸­é—´çš„è·¯ç”±å™¨ä¸Šæ˜¯ Linux ç³»ç»Ÿï¼Œæœ‰ä¸¤å¼ ç½‘å¡ï¼Œeth0 ä½œä¸º LAN å£è¿æ¥å†…ç½‘ï¼Œwan ä½œä¸º WAN å£è¿æ¥å…¬ç½‘ã€‚è¦å®ç°è½¯è·¯ç”±åŠŸèƒ½ï¼Œä½¿å†…ç½‘çš„è®¾å¤‡å¯ä»¥é€šè¿‡ WAN å£ä¸Šç½‘ã€‚é¦–å…ˆéœ€è¦å¼€å¯å†…æ ¸çš„ IP è½¬å‘åŠŸèƒ½ï¼Œå¯ä»¥ç”¨ sysctl å‘½ä»¤æˆ–è€…ç›´æ¥æŸ¥çœ‹ /proc/sys/net/ipv4/ip_forward æ–‡ä»¶è·å¾—å½“å‰ç³»ç»Ÿçš„ ip_forward æ˜¯å¦å¼€å¯ï¼š\n~# sysctl net.ipv4.ip_forward net.ipv4.ip_forward = 0 ~# cat /proc/sys/net/ipv4/ip_forward 0 Linux ç³»ç»Ÿé»˜è®¤æ˜¯ç¦æ­¢ IP è½¬å‘çš„ï¼Œæ‰€æœ‰è¿”å› 0 ï¼Œå¯ä»¥ç”¨ sysctl å‘½ä»¤æˆ–è€…ç›´æ¥å‘ /proc/sys/net/ipv4/ip_forward æ–‡ä»¶å†™ 1 æ¥å¼€å¯ IP è½¬å‘ï¼Œå¦‚æœè¦æ°¸ä¹…å¼€å¯ï¼Œå¯ä»¥åœ¨ /etc/sysctl.conf æ–‡ä»¶ä¸­ä¿®æ”¹é…ç½®ï¼š\n~# cat /etc/sysctl.conf | grep ip_forward net.ipv4.ip_forward=1 ç„¶ååœ¨ iptables ä¸­æ·»åŠ è§„åˆ™ï¼š\n# Default policy to drop all incoming packets iptables -P INPUT DROP iptables -P FORWARD DROP # Accept incoming packets from localhost and the LAN interface iptables -A INPUT -i lo -j ACCEPT iptables -A INPUT -i eth0 -j ACCEPT # Accept incoming packets from the WAN if the router initiated the connection iptables -A INPUT -i wan -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT # Forward LAN packets to the WAN iptables -A FORWARD -i eth0 -o wan -j ACCEPT # Forward WAN packets to the LAN if the LAN initiated the connection iptables -A FORWARD -i wan -o eth0 -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT # NAT traffic going out the WAN interface iptables -t nat -A POSTROUTING -o wwan -j MASQUERADE 2. ç«¯å£æ˜ å°„ #ç«¯å£æ˜ å°„å°±æ˜¯å°†å¤–ç½‘ä¸»æœºçš„ä¸€ä¸ªç«¯å£æ˜ å°„åˆ°å†…ç½‘ä¸­æŸå°ä¸»æœºçš„æŸä¸ªç«¯å£ï¼Œå½“ç”¨æˆ·è®¿é—®å¤–ç½‘ä¸»æœºçš„è¿™ä¸ªç«¯å£æ—¶ï¼Œå®é™…ä¸Šæ˜¯ç”±å†…ç½‘ä¸»æœºçš„ç›¸åº”ç«¯å£é€šè®¯ã€‚å¦‚ä¸‹æ˜¯ä¸€ä¸ªå…¸å‹çš„åº”ç”¨åœºæ™¯ï¼š\nåœ¨è¿™ä¸ªç½‘ç»œæ‹“æ‰‘é‡Œï¼Œå³ä¾§ 192.168.2.101 çš„ä¸»æœºæƒ³è¦è®¿é—®ä¸‹æ–¹è·¯ç”±å™¨è¿æ¥çš„ 192.168.1.101 ä¸»æœºçš„ HTTP æœåŠ¡ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ\næ–¹æ³•æ˜¯åœ¨ä¸‹æ–¹è·¯ç”±å™¨ä¸Šåšç«¯å£æ˜ å°„ï¼Œå°† 192.168.1.101 çš„ 80 ç«¯å£æ˜ å°„åˆ° 192.168.2.103 çš„ 80 ç«¯å£ä¸Šï¼Œè¿™æ ·ç›´æ¥è®¿é—® 192.168.2.103:80 å°±å¯ä»¥ä¸ 192.168.1.101:80 é€šè®¯ã€‚ å…·ä½“æ·»åŠ çš„è§„åˆ™æ˜¯ï¼š\niptables -t nat -I PREROUTING -i eth2 -d 192.168.2.103 -p tcp --dport 80 -j DNAT --to-destination 192.168.1.101:80 iptables -t nat -I POSTROUTING -o eth1 -d 192.168.1.101 -p tcp --dport 80 -j SNAT --to-source 192.168.1.1 å½“ 192.168.2.101 è®¿é—® 192.168.2.103:80 æ—¶ï¼Œç¬¬ä¸€æ¡è§„åˆ™åœ¨å…¥å£å¤„ä¿®æ”¹äº†æ•°æ®åŒ…çš„ç›®çš„åœ°å€ï¼Œç¬¬äºŒæ¡è§„åˆ™åœ¨å‡ºå£å¤„ä¿®æ”¹äº†æºåœ°å€ï¼Œå°±å°†æ•°æ®åŒ…è½¬ç§»åˆ°äº† 192.168.1.101:80 ã€‚\n3. ç¦æ­¢ ping #ç¦æ­¢ ping æŒ‡çš„æ˜¯ç¦æ­¢åˆ«çš„ä¸»æœº ping æœ¬æœºï¼Œå¯ä»¥æ·»åŠ å¦‚ä¸‹è§„åˆ™ï¼š\niptables -t filter -I INPUT -p icmp -m icmp --icmp-type 8/0 -j REJECT # or iptables -t filter -I INPUT -p icmp -m icmp --icmp-type 8 -j REJECT # or iptables -t filter -I INPUT -p icmp -m icmp --icmp-type \u0026#34;echo-request\u0026#34; -j REJECT å‘å‡ºçš„ ping è¯·æ±‚å±äº type 8 ç±»å‹çš„ ICMP æŠ¥æ–‡ï¼Œè¿™æ¡è§„åˆ™è¡¨ç¤º type ä¸º 8 ï¼Œcode ä¸º 0 çš„ ICMP åŒ…ä¼šè¢«æ‹’ç»ã€‚\n","date":"2018 December 12","permalink":"/posts/2018/12/12/","section":"Posts","summary":"å…³äº iptables çš„åŸç†ï¼Œè¿™é‡Œæœ‰ä¸€ä»½æ•™ç¨‹å†™å¾—æ·±å…¥æµ…å‡ºï¼Œæµ…æ˜¾æ˜“æ‡‚ï¼š","title":"iptables å­¦ä¹ ç¬”è®°"},{"content":"æŸ¥çœ‹å½“å‰ç³»ç»Ÿæ—¶é—´ï¼š\n$ timedatectl status Local time: Thu 2018-09-20 09:42:53 CST Universal time: Thu 2018-09-20 01:42:53 UTC RTC time: Thu 2018-09-20 01:42:53 Time zone: Asia/Chongqing (CST, +0800) Network time on: yes NTP synchronized: yes RTC in local TZ: no RTC in local TZ: no è¡¨ç¤º RTC æ—¶é’Ÿä¸æ˜¯ç”¨æœ¬åœ°æ—¶é—´ï¼Œè€Œæ˜¯ä½¿ç”¨ UTC æ—¶é—´ï¼Œå¯ä»¥æ”¹æˆä½¿ç”¨æœ¬åœ°æ—¶é—´ï¼Œä½†æ˜¯å¹¶ä¸æ¨èè¿™ä¹ˆåšï¼š\n$ timedatectl set-local-rtc 1 $ timedatectl Local time: Thu 2018-09-20 03:57:58 CEST Universal time: Thu 2018-09-20 01:57:58 UTC RTC time: Thu 2018-09-20 03:57:59 Time zone: Europe/Paris (CEST, +0200) Network time on: yes NTP synchronized: yes RTC in local TZ: yes Warning: The system is configured to read the RTC time in the local time zone. This mode can not be fully supported. It will create various problems with time zone changes and daylight saving time adjustments. The RTC time is never updated, it relies on external facilities to maintain it. If at all possible, use RTC in UTC by calling \u0026#39;timedatectl set-local-rtc 0\u0026#39;. åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„æ—¶åŒºï¼š\n$ timedatectl list-timezones ä¿®æ”¹æ—¶åŒºï¼š\n$ timedatectl set-timezone \u0026#34;Europe/Paris\u0026#34; $ timedatectl Local time: Thu 2018-09-20 03:46:02 CEST Universal time: Thu 2018-09-20 01:46:02 UTC RTC time: Thu 2018-09-20 01:46:02 Time zone: Europe/Paris (CEST, +0200) Network time on: yes NTP synchronized: yes RTC in local TZ: no $ cat /etc/timezone Europe/Paris $ date Thu Sep 20 03:46:48 CEST 2018 è®¾ç½®æ—¶é—´å’Œæ—¥æœŸï¼š\ntimedatectl set-time \u0026#39;16:10:40 2018-11-20\u0026#39; å…³é—­æ—¶é—´åŒæ­¥ï¼Œå®é™…æ˜¯å…³é—­ systemd-timesyncd.service æœåŠ¡ï¼š\n$ timedatectl set-ntp 0 $ timedatectl Local time: Thu 2018-09-20 04:19:41 CEST Universal time: Thu 2018-09-20 02:19:41 UTC RTC time: Thu 2018-09-20 02:19:41 Time zone: Europe/Paris (CEST, +0200) Network time on: no NTP synchronized: yes RTC in local TZ: no $ systemctl status systemd-timesyncd.service â— systemd-timesyncd.service - Network Time Synchronization Loaded: loaded (/lib/systemd/system/systemd-timesyncd.service; disabled; vendor preset: enabled) Drop-In: /lib/systemd/system/systemd-timesyncd.service.d â””â”€disable-with-time-daemon.conf Active: inactive (dead) Docs: man:systemd-timesyncd.service(8) Feb 11 17:28:02 ubuntu systemd-timesyncd[472]: System clock time unset or jumped backwards, restoring from recorded timestamp: Sep 19 11:36:39 ubuntu systemd[1]: Started Network Time Synchronization. Sep 20 03:19:45 ubuntu systemd-timesyncd[472]: Synchronized to time server 91.189.91.157:123 (ntp.ubuntu.com). Sep 20 04:19:37 ubuntu systemd[1]: Stopping Network Time Synchronization... Sep 20 04:19:37 ubuntu systemd[1]: Stopped Network Time Synchronization. Sep 20 04:20:27 ubuntu systemd[1]: Starting Network Time Synchronization... Sep 20 04:20:27 ubuntu systemd[1]: Started Network Time Synchronization. Sep 20 04:20:27 ubuntu systemd-timesyncd[1901]: Synchronized to time server 91.189.89.198:123 (ntp.ubuntu.com). Sep 20 04:20:51 ubuntu systemd[1]: Stopping Network Time Synchronization... Sep 20 04:20:51 ubuntu systemd[1]: Stopped Network Time Synchronization. systemd-timesyncd.service è°ƒç”¨çš„æ˜¯ /lib/systemd/systemd-timesyncd å®ˆæŠ¤è¿›ç¨‹æ‰§è¡Œæ—¶é—´åŒæ­¥ï¼Œé…ç½®æ–‡ä»¶æ˜¯ /etc/systemd/timesyncd.conf ï¼Œæœ‰ä¸¤ä¸ªé€‰é¡¹ï¼š\nNTP= ï¼Œä¸» NTP æœåŠ¡å™¨åŸŸåæˆ–è€… IP åˆ—è¡¨ï¼Œå¤šä¸ªåœ°å€ä¹‹é—´ç”¨ç©ºæ ¼éš”å¼€ã€‚ FallbackNTP= ï¼Œå¤‡ç”¨ NTP æœåŠ¡å™¨åŸŸåæˆ–è€… IP åˆ—è¡¨ï¼Œå¤šä¸ªåœ°å€ä¹‹é—´ç”¨ç©ºæ ¼éš”å¼€ã€‚ æ¯æ¬¡æ—¶é—´åŒæ­¥åéƒ½ä¼šæ›´æ–° /var/lib/systemd/clock æ–‡ä»¶ï¼š\n$ ll /var/lib/systemd/clock -rw-r--r-- 1 systemd-timesync systemd-timesync 0 Spe 25 14:09 /var/lib/systemd/clock å¤§çº¦ 20 åˆ†é’ŸåŒæ­¥ä¸€æ¬¡ï¼Œè¿™ä¸ªæ—¶é—´é—´éš”ä¸å¯ä»¥è®¾ç½®ã€‚\n","date":"2018 September 24","permalink":"/posts/2018/09/24/","section":"Posts","summary":"æŸ¥çœ‹å½“å‰ç³»ç»Ÿæ—¶é—´ï¼š","title":"ç”¨ timedatectl ç®¡ç†ç³»ç»Ÿæ—¶é—´"},{"content":"dnf æ˜¯ Fedora ä¸Šçš„æ–°ä¸€ä»£è½¯ä»¶åŒ…ç®¡ç†å™¨ï¼Œä» Fedora22 å¼€å§‹å–ä»£äº†åŸæœ‰çš„ yum ã€‚æ‹¥æœ‰è¶…çº§ç”¨æˆ·æƒé™æ‰å¯ä»¥ä½¿ç”¨ dnf åœ¨ç³»ç»Ÿä¸Šå®‰è£…ã€æ›´æ–°å’Œåˆ é™¤è½¯ä»¶åŒ…ã€‚\n1. é…ç½® #dnf çš„é…ç½®æ–‡ä»¶ä½äº /etc/dnf/dnf.conf ,æ–‡ä»¶é‡Œçš„é…ç½®ä¿¡æ¯æŒ‰ä¸åŒç§ç±»åˆ†ä¸ºå¤šä¸ªå°èŠ‚ï¼Œå…¶ä¸­å¿…é¡»çš„ [main] å°èŠ‚åŒ…å«äº†æ‰€æœ‰å…¨å±€é€‰é¡¹ï¼Œè¿˜å¯èƒ½åŒ…å«ä¸€äº› [repository] å°èŠ‚ç”¨äºè®¾ç½®ç‰¹å®šå­˜å‚¨åº“çš„é€‰é¡¹ï¼Œä½†æ˜¯å»ºè®®åœ¨ /etc/yum.repos.d/ ç›®å½•ä¸­çš„ .repo æ–‡ä»¶é‡Œå®šä¹‰æŸä¸ªå­˜å‚¨åº“çš„é€‰é¡¹ï¼Œè¿™äº›é€‰é¡¹çš„å€¼ä¼šè¦†ç›– [main] å°èŠ‚çš„åŒåé€‰é¡¹ã€‚\næœ€ç®€å•çš„ /etc/dnf/dnf.conf æ–‡ä»¶ç±»ä¼¼å¦‚ä¸‹ï¼š\n[main] gpgcheck=1 installonly_limit=3 clean_requirements_on_remove=true å¸¸ç”¨çš„é€‰é¡¹å’Œå«ä¹‰åŒ…æ‹¬ï¼š\ngpgcheck=value ï¼Œvalue å¯é€‰ä¸¤ä¸ªå€¼ï¼Œ0 è¡¨ç¤ºç¦æ­¢æ‰€æœ‰ GPG ç­¾åæ£€æŸ¥ï¼Œ1 è¡¨ç¤ºå¯¹æ‰€æœ‰å®‰è£…çš„åŒ…è¿›è¡Œ GPG ç­¾åæ£€æŸ¥ã€‚ installonlypkgs=space separated list of packages ï¼Œè¿™ä¸ªé€‰é¡¹ä¸­åˆ—å‡ºçš„è½¯ä»¶åŒ…åªå®‰è£…ä¸æ›´æ–°ï¼Œå¤šä¸ªè½¯ä»¶åŒ…ä¹‹é—´ç”¨ç©ºæ ¼åˆ†å¼€ã€‚ installonly_limit=value ï¼Œvalue æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤º installonlypkgs æŒ‡ä»¤ä¸­åˆ—å‡ºçš„è½¯ä»¶åŒ…å¯ä»¥åŒæ—¶å®‰è£…çš„æœ€å¤§ç‰ˆæœ¬æ•°ã€‚installonlypkgs æŒ‡ä»¤çš„é»˜è®¤å€¼åŒ…æ‹¬å‡ ä¸ªä¸åŒçš„å†…æ ¸åŒ…ï¼Œå› æ­¤ï¼Œæ›´æ”¹ installonly_limit çš„å€¼ä¹Ÿä¼šå½±å“ä»»ä½•å•ä¸ªå†…æ ¸åŒ…çš„æœ€å¤§å®‰è£…ç‰ˆæœ¬æ•°ã€‚ /etc/dnf/dnf.conf ä¸­åˆ—å‡ºçš„é»˜è®¤å€¼ä¸º installonly_limit = 3ï¼Œå»ºè®®ä¸è¦é™ä½æ­¤å€¼ï¼Œå°¤å…¶æ˜¯ä½äº2ã€‚ keepcache=value ï¼Œvalue å¯é€‰ä¸¤ä¸ªå€¼ï¼Œ0 è¡¨ç¤ºæˆåŠŸå®‰è£…åä¸ä¿ç•™æ ‡å¤´å’Œè½¯ä»¶åŒ…çš„ç¼“å­˜ï¼Œè¿™æ˜¯é»˜è®¤å€¼ã€‚1 è¡¨ç¤ºæˆåŠŸå®‰è£…åä¿ç•™ç¼“å­˜ã€‚ 2. ä½¿ç”¨ #2.1. æ›´æ–° #æ£€æµ‹å¹¶å®‰è£…æ‰€æœ‰è½¯ä»¶åŒ…çš„æ›´æ–°ï¼š\ndnf upgrade å¦‚æœå¸¦æœ‰åŒ…çš„åå­—å°±å¯ä»¥å•ç‹¬æ›´æ–°æŸä¸ªåŒ…ï¼š\ndnf upgrade package_name åªæ£€æŸ¥å¯ç”¨çš„æ›´æ–°ï¼š\ndnf check-update 2.2. æŸ¥æ‰¾ #åœ¨æºé‡Œæœç´¢æ‰€æœ‰åå­—é‡ŒåŒ…å« term çš„åŒ…ï¼š\ndnf search term åå­—åŒ¹é…æ—¶æ”¯æŒä¸¤ç§é€šé…ç¬¦ï¼Œå¦‚æœåå­—æœ¬èº«å°±åŒ…å«è¿™ä¸¤ä¸ªé€šé…ç¬¦ï¼Œå¯ä»¥ç”¨åæ–œæ è½¬ä¹‰ï¼š\n* ï¼Œæ˜Ÿå·å¯ä»¥åŒ¹é…ä»»ä½•å­—ç¬¦å¤šæ¬¡ ï¼Ÿï¼Œé—®å·å¯ä»¥åŒ¹é…ä»»ä½•ä¸€ä¸ªå­—ç¬¦ åˆ—å‡ºæ‰€æœ‰å·²å®‰è£…çš„å’Œå¯å®‰è£…çš„è½¯ä»¶åŒ…ï¼š\ndnf list all ä»…åˆ—å‡ºå·²å®‰è£…çš„è½¯ä»¶åŒ…\ndnf list installed åˆ—å‡ºæœªå®‰è£…ä½†å¯ç”¨çš„è½¯ä»¶åŒ…ï¼š\ndnf list available ä¹Ÿå¯ä»¥åˆ—å‡ºåå­—åŒ¹é…çš„åŒ…ï¼š\ndnf list term æ˜¾ç¤ºæŸä¸ªåŒ…çš„è¯¦ç»†ä¿¡æ¯ï¼š\ndnf info package_name 2.3. å®‰è£… #ç”¨ install å‘½ä»¤å®‰è£…è½¯ä»¶åŒ…ï¼Œå¯ä»¥ä¸€æ¬¡å®‰è£…å¤šä¸ªï¼š\ndnf install package_name... å¦‚æœä¸çŸ¥é“æŸä¸ªè½¯ä»¶åŒ…çš„åå­—ï¼ŒåªçŸ¥é“å®ƒçš„æŸä¸ªäºŒè¿›åˆ¶æ–‡ä»¶çš„å®‰è£…è·¯å¾„ï¼Œä¹Ÿå¯ä»¥åªå†™è¯¥æ–‡ä»¶çš„è·¯å¾„ï¼Œdnf ä¼šè‡ªåŠ¨æœç´¢å¹¶å®‰è£…ï¼Œä¾‹å¦‚ï¼š\ndnf install /usr/sbin/named åˆ é™¤æŸä¸ªåŒ…ç”¨ remove å‘½ä»¤ï¼š\ndnf remove package_name... 2.4. å†å² #dnf çš„ history å‘½ä»¤å¯ä»¥è®©ç”¨æˆ·æŸ¥çœ‹ä½¿ç”¨è®°å½•ï¼ŒåŒ…æ‹¬å®‰è£…ã€æ›´æ–°ã€åˆ é™¤ç­‰å„ç§æ“ä½œä½¿ç”¨çš„å‘½ä»¤å’Œæ—¶é—´ç­‰è¯¦æƒ…ï¼Œä¾‹å¦‚åˆ—å‡ºæ‰€æœ‰çš„å†å²æ“ä½œè®°å½•ï¼š\ndnf history list æ ¹æ®æ“ä½œé¡ºåºçš„ ID åˆ—å‡ºæŸä¸ªèŒƒå›´çš„å†å²è®°å½•ï¼š\ndnf history list start_id..end_id æ’¤é”€æŸä¸€æ­¥æ“ä½œï¼š\ndnf history undo id é‡åšæŸä¸€æ­¥æ“ä½œï¼š\ndnf history redo id å‚è€ƒ #[DNF Command Reference](https://dnf.readthedocs.io/en/latest/command_ref.html\u003e\n","date":"2018 September 21","permalink":"/posts/2018/09/21/","section":"Posts","summary":"dnf æ˜¯ Fedora ä¸Šçš„æ–°ä¸€ä»£è½¯ä»¶åŒ…ç®¡ç†å™¨ï¼Œä» Fedora22 å¼€å§‹å–ä»£äº†åŸæœ‰çš„ yum ã€‚æ‹¥æœ‰è¶…çº§ç”¨æˆ·æƒé™æ‰å¯ä»¥ä½¿ç”¨ dnf åœ¨ç³»ç»Ÿä¸Šå®‰è£…ã€æ›´æ–°å’Œåˆ é™¤è½¯ä»¶åŒ…ã€‚","title":"åŒ…ç®¡ç†å™¨ dnf å­¦ä¹ ç¬”è®°"},{"content":"1.CPU ä¸»é¢‘ #CPU çš„ä¸»é¢‘æ˜¯æŒ‡ CPU æ ¸å¿ƒçš„æ—¶é’Ÿé¢‘ç‡ï¼Œå®ƒæ˜¯ CPU æ‰§è¡ŒæŒ‡ä»¤çš„æœ€å°æ—¶é—´å•ä½ã€‚CPU å†…éƒ¨æœ‰æ—¶é’Ÿç®¡ç†æ¨¡å—ï¼Œé€šè¿‡å¤–éƒ¨æŒ¯è¡å™¨ï¼ˆè·å–å…¶ä»–æ—¶é’Ÿç”µè·¯ï¼‰è¾“å…¥ä¸€ä¸ªç‰¹å®šçš„é¢‘ç‡ï¼ˆå¤–é¢‘ï¼‰ï¼Œç»è¿‡å†…éƒ¨çš„ PLL ç”µè·¯ï¼ˆå€é¢‘å™¨ï¼‰é”å®šåˆ°ä¸€ä¸ªå¾ˆé«˜çš„é¢‘ç‡ï¼Œå†ç»è¿‡ä¸åŒçš„åˆ†é¢‘ï¼Œä¾›ç»™ä¸åŒçš„æ¨¡å—å’Œæ€»çº¿ä½¿ç”¨ï¼Œä¾›ç»™ CPU çš„å°±ç§°ä¸ºä¸»é¢‘,å°±æ˜¯é€šå¸¸æ‰€è¯´çš„â€œä¸»é¢‘ = å¤–é¢‘ x å€é¢‘â€ã€‚ç›®å‰æ¡Œé¢ X86 CPU çš„å¤–é¢‘ç”±ä¸»æ¿ä¾›ç»™ï¼Œé€šå¸¸æ˜¯ 100MHz ï¼Œå€é¢‘é€šå¸¸æ˜¯å›ºå®šè®¾ç½®çš„ã€‚å¦‚æœè¦è¶…é¢‘ï¼Œé€šå¸¸æ˜¯åœ¨ä¸»æ¿çš„ BIOS ä¸­ä¿®æ”¹å€é¢‘å› å­ï¼Œä¹Ÿæœ‰ç‰¹æ®Šæƒ…å†µå¯ä»¥å¢åŠ å¤–é¢‘ã€‚\nX86-Linux ä½“ç³»æœ‰ä¸‰ç§ç¡¬ä»¶æ—¶é’Ÿï¼š\nReal Time Clock(RTC) ï¼Œå®æ—¶æ—¶é’Ÿï¼Œé€šå¸¸ä½äº CMOS ï¼Œç‹¬ç«‹å·¥ä½œ Programmalbe Interval Timer(PIT) ï¼Œå¯ç¼–ç¨‹çš„é—´éš”å®šæ—¶å™¨ï¼Œé€šå¸¸ç”± 8254 èŠ¯ç‰‡å®ç° Time Stamp Counter(TSC) ï¼Œæ—¶é—´æˆ³æ§åˆ¶å™¨ï¼Œè®°å½• CPU æ—¶é’Ÿå‘¨æœŸ Linux å†…æ ¸åœ¨è®¡ç®— CPU ä¸»é¢‘æ—¶ä¼šç”¨åˆ° PIT å’Œ TSC ã€‚ä»¥ä¸‹æ˜¯åœ¨ kernel 3.4 ç‰ˆæœ¬ä¸­åˆ†æã€‚\n2.Programmalbe Interval Timer (PIT) #Programmalbe Interval Timer (PIT) æ˜¯ç°ä»£è®¡ç®—æœºçš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå°¤å…¶æ˜¯åœ¨å¤šä»»åŠ¡ç¯å¢ƒä¸­ã€‚ PIT æ˜¯ç”¨ 8253/8254 èŠ¯ç‰‡å®ç°çš„ï¼Œç”±äºå†å²åŸå› ï¼Œå¤–æ¥çš„æ™¶æŒ¯é¢‘ç‡æ˜¯ 1.193182 MHz ï¼ŒLinux å†…æ ¸é‡Œçš„å®šä¹‰åœ¨ include/linux/timex.h æ–‡ä»¶ï¼š\n/* The clock frequency of the i8253/i8254 PIT */ #define PIT_TICK_RATE 1193182ul 8253/8254 å†…ç½®ä¸‰ä¸ªç‹¬ç«‹çš„ 16 ä½å‡æ³•è®¡æ•°å™¨ç”¨äºåˆ†é¢‘ï¼Œæ¯ä¸ªè®¡æ•°å™¨æœ‰ä¸€ä¸ªè¾“å‡ºç”¨äºç‰¹å®šçš„åŠŸèƒ½ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š\nChannel 0 ï¼šPIT Channel 0 çš„è¾“å‡ºè¿æ¥åœ¨ä¸­æ–­æ§åˆ¶å™¨ä¸Šï¼Œå› æ­¤å®ƒä¼šäº§ç”Ÿ â€œIRQ 0â€ã€‚é€šå¸¸åœ¨å¼•å¯¼é˜¶æ®µï¼ŒBIOS å°† Channel 0 è®¾ç½®ä¸º 65535 æˆ– 0ï¼ˆè½¬æ¢ä¸º65536ï¼‰ï¼Œè¿™å°†æä¾› 18.2065Hz çš„è¾“å‡ºé¢‘ç‡ï¼ˆæ¯ 54.9254ms ä¸€æ¬¡çš„ä¸­æ–­ï¼‰ã€‚ Channel 0 å¯èƒ½æ˜¯æœ€æœ‰ç”¨çš„ PIT é€šé“ï¼Œå› ä¸ºå®ƒæ˜¯å”¯ä¸€è¿æ¥åˆ° IRQ çš„é€šé“ï¼Œå¯ä»¥ç”¨å®ƒäº§ç”Ÿå®šæ—¶ä¸­æ–­ã€‚é€‰æ‹©å·¥ä½œæ¨¡å¼æ—¶ï¼Œè¦æ³¨æ„ IRQ0 æ˜¯ç”± Channel 0 è¾“å‡ºç”µå‹çš„ä¸Šå‡æ²¿äº§ç”Ÿçš„ã€‚ Channel 1 ï¼šPIT Channel 1 çš„è¾“å‡ºæ›¾è¢«ç”¨äºåˆ·æ–° DRAM æˆ– RAM ã€‚é€šå¸¸ï¼ŒRAM ä¸­çš„æ¯ä¸ªä½ç”±ä¸€ä¸ªç”µå®¹å™¨ç»„æˆï¼Œè¯¥ç”µå®¹å™¨ä¿æŒä»£è¡¨è¯¥ä½çŠ¶æ€çš„å¾®å°ç”µè·ï¼Œä½†æ˜¯ç”±äºæ³„æ¼ï¼Œè¿™äº›ç”µå®¹å™¨éœ€è¦å®šæœŸâ€œåˆ·æ–°â€ï¼Œä»¥ä¾¿å®ƒä»¬ä¸ä¼šå¿˜è®°è‡ªå·±çš„çŠ¶æ€ã€‚åœ¨ä»¥åçš„æœºå™¨ä¸Šï¼ŒDRAM åˆ·æ–°æ˜¯é€šè¿‡ä¸“ç”¨ç¡¬ä»¶å®Œæˆçš„ï¼Œä¸å†ä½¿ç”¨ PIT ã€‚åœ¨å¤§è§„æ¨¡é›†æˆç”µè·¯ä¸­å®ç°çš„ç°ä»£è®¡ç®—æœºä¸Šï¼ŒPIT Channel 1 ä¸å†å¯ç”¨ã€‚ Channel 2 ï¼šPIT Channel 2 çš„è¾“å‡ºè¿æ¥åœ¨èœ‚é¸£å™¨ä¸Šï¼Œå› æ­¤è¾“å‡ºçš„é¢‘ç‡å†³å®šäº†èœ‚é¸£å™¨äº§ç”Ÿçš„å£°éŸ³çš„é¢‘ç‡ã€‚è¿™æ˜¯å”¯ä¸€å¯ä»¥é€šè¿‡è½¯ä»¶æ§åˆ¶é—¨ä¿¡å·çš„é€šé“ï¼ˆé€šè¿‡I/O ç«¯å£ 0x61 çš„ bit0ï¼‰ï¼Œä¹Ÿå¯ä»¥ç”¨è½¯ä»¶è¯»å–å…¶è¾“å‡ºã€‚ PIT çš„ 8253/8254 èŠ¯ç‰‡æœ‰å››ä¸ªå¯„å­˜å™¨ï¼ŒåŒ…æ‹¬ä¸‰ä¸ªæ•°æ®å¯„å­˜å™¨å’Œä¸€ä¸ªæ¨¡å¼æ§åˆ¶å¯„å­˜å™¨ï¼Œå®ƒä»¬çš„åœ°å€å’ŒåŠŸèƒ½æè¿°ï¼š\nI/O port Usage 0x40 Channel 0 data port (read/write) 0x41 Channel 1 data port (read/write) 0x42 Channel 2 data port (read/write) 0x43 Mode/Command register (write only, a read is ignored) æ¨¡å¼æ§åˆ¶å¯„å­˜å™¨çš„æ ¼å¼ï¼š\nç¼–ç¨‹æ–¹å¼æ˜¯å…ˆåœ¨æ¨¡å¼æ§åˆ¶å¯„å­˜å™¨ä¸­è®¾ç½®è®¡æ•°å™¨ã€è¯»å†™æ–¹å¼å’Œå·¥ä½œæ¨¡å¼ï¼Œç„¶åå‘ç›¸åº”çš„è®¡æ•°å™¨ä¸­å†™å…¥åˆå§‹å€¼ã€‚\n3.Time Stamp Counter (TSC) #æ—¶é—´æˆ³æ§åˆ¶å™¨ Time Stamp Counter (TSC) æ˜¯ X86 CPU é‡Œçš„ä¸€ä¸ª 64 ä½å¯„å­˜å™¨ï¼Œè‡ª Pentium å¼€å§‹å¼•å…¥ï¼Œç”¨äºè®°å½• CPU å¤ä½åçš„å‘¨æœŸæ•°ï¼ŒCPU å†…éƒ¨æ—¶é’Ÿæ¯äº§ç”Ÿä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸï¼Œè¯¥å¯„å­˜å™¨å°±åŠ ä¸€ï¼Œä¹Ÿå°±æ˜¯ CPU ä¸»é¢‘çš„èŠ‚æ‹è®°å½•å™¨ã€‚æˆ‘ä»¬å¯ä»¥ç”¨å•ä½æ—¶é—´å†… TSC è®°å½•çš„æ—¶é’Ÿå‘¨æœŸä¸ªæ•°æ¥æ¨ç®— CPU çš„å®é™…é¢‘ç‡ï¼Œæ¯”å¦‚ä¸€ç§’å†… TSC çš„å€¼å¢é•¿äº† 1000 ï¼Œé‚£ä¹ˆä¸»é¢‘å°±æ˜¯ 1KHz ã€‚åœ¨å•æ ¸ CPU ä¸Šï¼ŒTSC æ˜¯ä¸€ä¸ªç®€å•é«˜æ•ˆçš„è·å–é«˜ç²¾åº¦ CPU æ—¶åºä¿¡æ¯çš„æ–¹å¼ï¼Œä½†æ˜¯åœ¨å¤šæ ¸ CPU ã€ä¼‘çœ æ“ä½œç³»ç»Ÿä¸Šï¼Œè¿™ä¸ªæ–¹å¼æ— æ³•æä¾›å‡†ç¡®ä¿¡æ¯ï¼Œä¾èµ– TSC ä¼šé™ä½è½¯ä»¶çš„å¯ç§»æ¤æ€§ã€‚åœ¨ Windows å¹³å°ä¸Šï¼Œå¾®è½¯åå¯¹ä½¿ç”¨ TSC è¿›è¡Œé«˜ç²¾åº¦è®¡æ—¶ï¼Œåœ¨ POSIX ç³»ç»Ÿä¸Šï¼Œç¨‹åºå¯ä»¥ä½¿ç”¨ clock_gettime() å‡½æ•°è¯»å– CLOCK_MONOTONIC æ—¶é’Ÿçš„å€¼æ¥è·å¾—ç±»ä¼¼çš„åŠŸèƒ½ã€‚åœ¨ Linux çš„å†…æ ¸ä¸Šï¼Œå¯ä»¥ç”¨å¯åŠ¨å‚æ•° notsc ç¦ç”¨ TSC ã€‚\nX86 CPU æä¾›äº† RDTSC æŒ‡ä»¤æ¥è¯»å– TSC çš„å€¼ï¼Œä½ 32 ä½å­˜æ”¾åœ¨ EAX å¯„å­˜å™¨ï¼Œé«˜ 32 ä½å­˜æ”¾åœ¨ EDX å¯„å­˜å™¨:\næŒ‡ä»¤ æ“ä½œç  è¯´æ˜ RDTSC 0F 31 å°† TSC çš„å€¼è¯»å…¥ EDX:EAX åœ¨å†…æ ¸æºç çš„ arch/x86/include/asm/msr.h æ–‡ä»¶ä¸­æä¾›äº†è¯»å–æ–¹æ³•ï¼š\n#ifdef CONFIG_X86_64 #define DECLARE_ARGS(val, low, high)\tunsigned low, high #define EAX_EDX_VAL(val, low, high)\t((low) | ((u64)(high) \u0026lt;\u0026lt; 32)) #define EAX_EDX_ARGS(val, low, high)\t\u0026#34;a\u0026#34; (low), \u0026#34;d\u0026#34; (high) #define EAX_EDX_RET(val, low, high)\t\u0026#34;=a\u0026#34; (low), \u0026#34;=d\u0026#34; (high) #else #define DECLARE_ARGS(val, low, high)\tunsigned long long val #define EAX_EDX_VAL(val, low, high)\t(val) #define EAX_EDX_ARGS(val, low, high)\t\u0026#34;A\u0026#34; (val) #define EAX_EDX_RET(val, low, high)\t\u0026#34;=A\u0026#34; (val) #endif static __always_inline unsigned long long __native_read_tsc(void) { DECLARE_ARGS(val, low, high); asm volatile(\u0026#34;rdtsc\u0026#34; : EAX_EDX_RET(val, low, high)); return EAX_EDX_VAL(val, low, high); } æˆ‘ä»¬å¯ä»¥åœ¨ç”¨æˆ·ç©ºé—´ç”¨ C è¯­è¨€å†…è”æ±‡ç¼–å®ç°åŒæ ·çš„åŠŸèƒ½ï¼š\n#include \u0026lt;stdio.h\u0026gt; int main() { unsigned int low=0, high=0; asm volatile(\u0026#34;rdtsc\u0026#34; : \u0026#34;=a\u0026#34;(low), \u0026#34;=d\u0026#34;(high)); printf(\u0026#34;0x%x 0x%x\\n\u0026#34;,high,low); } 4.è®¡ç®—ä¸»é¢‘ #Linux å†…æ ¸åœ¨åˆå§‹åŒ–é˜¶æ®µç”¨ TSC æ¥è®¡ç®— CPU ä¸»é¢‘ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ dmesg ä¸­æ‰¾åˆ°ç±»ä¼¼çš„ä¿¡æ¯ï¼š\n$ dmesg | grep -E \u0026#34;TSC|tsc\u0026#34; tsc: Fast TSC calibration using PIT tsc: Detected 3192.872 MHz processor TSC deadline timer enabled tsc: Refined TSC clocksource calibration: 3192.747 MHz Switched to clocksource tsc å‰ç¼€çš„ tsc æ˜¯æ¨¡å—çš„åç§°ï¼Œæœ‰äº›å†…æ ¸å¯èƒ½æ²¡æœ‰è¿™ä¸ªï¼Œæ²¡æœ‰å…³ç³»ï¼Œæˆ‘ä»¬ä» Detected 3192.872 MHz processor å…¥æ‰‹ï¼Œè¿™æ˜¯åœ¨ arch/x86/kernel/tsc.c æ–‡ä»¶çš„ tsc_init() å‡½æ•°ä¸­æ‰“å°çš„ä¿¡æ¯ï¼Œå±äºå†…æ ¸çš„æ—¶é’Ÿå­ç³»ç»Ÿï¼Œå®ƒé€šè¿‡å¦‚ä¸‹è·¯å¾„è°ƒç”¨ï¼š\nstart_kernel() -\u0026gt; time_init() â€”\u0026gt; x86_late_time_init() -\u0026gt; tsc_init() è¿™ä¸ªå‡½æ•°æ‰§è¡Œçš„æ˜¯ TSC æ¨¡å—çš„åˆå§‹åŒ–å·¥ä½œï¼Œç„¶åæ ¡å‡† TSC é¢‘ç‡ï¼Œè®¾ç½®ä¸º CPU ä¸»é¢‘ï¼Œåˆ¤æ–­ TSC é¢‘ç‡æ˜¯å¦å¯é ï¼Œç”¨ TSC é¢‘ç‡è®¡ç®— lpj ç­‰ï¼Œæˆ‘ä»¬å…ˆå…³æ³¨è¿™ä¸€æ®µï¼š\nunsigned int __read_mostly cpu_khz; EXPORT_SYMBOL(cpu_khz); unsigned int __read_mostly tsc_khz; EXPORT_SYMBOL(tsc_khz); void __init tsc_init(void) { ... tsc_khz = x86_platform.calibrate_tsc(); cpu_khz = tsc_khz; if (!tsc_khz) { mark_tsc_unstable(\u0026#34;could not calculate TSC khz\u0026#34;); return; } printk(\u0026#34;Detected %lu.%03lu MHz processor.\\n\u0026#34;, (unsigned long)cpu_khz / 1000, (unsigned long)cpu_khz % 1000); ... } å…¶ä¸­çš„ x86_platform.calibrate_tsc() è°ƒç”¨çš„æ˜¯ native_calibrate_tsc() å‡½æ•°ï¼Œå®ƒçš„åŠŸèƒ½æ˜¯æ ¡å‡† tsc ï¼Œè·å– tsc é¢‘ç‡ã€‚é¦–å…ˆç”¨ PIT å¿«é€Ÿæ ¡å‡† TSC ï¼Œå®ƒçš„åŸç†æ˜¯ç”¨ PIT è®°å½•ä¸€æ®µæ—¶é—´ï¼Œå†æµ‹é‡è¿™æ®µæ—¶é—´å†… TSC çš„å˜æ¢é‡ï¼Œå°±å¯ä»¥è®¡ç®—å‡ºä¸»é¢‘ï¼Œé€šè¿‡ quick_pit_calibrate() å‡½æ•°å®ç°ï¼š\n/* è¯»å– PIT çš„ MSB ï¼Œåˆ¤æ–­ MSB æ˜¯å¦ç­‰äºå‚æ•° val */ static inline int pit_verify_msb(unsigned char val) { /* Ignore LSB */ inb(0x42); return inb(0x42) == val; } /* è¿™ä¸ªå‡½æ•°é€šè¿‡ä¸€ä¸ª for å¾ªç¯ä¸æ–­çš„è¯»å–å’Œåˆ¤æ–­ PIT å’Œ TSC ï¼Œæœ€ç»ˆç”¨ *tscp è¿”å› MSB==val æ—¶çš„ TSC çš„å€¼ï¼Œ*deltap è¿”å›æ˜¯å¢é‡ï¼ˆ delta ï¼šå¸Œè…Šå­—æ¯ç¬¬å››ä¸ªï¼‰ */ static inline int pit_expect_msb(unsigned char val, u64 *tscp, unsigned long *deltap) { int count; u64 tsc = 0, prev_tsc = 0; for (count = 0; count \u0026lt; 50000; count++) { if (!pit_verify_msb(val)) // PIT çš„ MSB ç­‰äº val æ—¶è·³å‡ºå¾ªç¯ break; prev_tsc = tsc; tsc = get_cycles(); //è¯»å– tsc çš„å€¼ï¼Œæœ€ç»ˆæ˜¯è°ƒç”¨ä¸Šä¸€ç« æåˆ°çš„ __native_read_tsc() å‡½æ•° } *deltap = get_cycles() - prev_tsc; *tscp = tsc; return count \u0026gt; 5; } /* è¿™ä¸ªå®ç¡®å®šçš„æ˜¯è¿­ä»£æ¬¡æ•°ï¼Œä¹Ÿå°±æ˜¯è·å–å¤šå°‘æ¬¡ PIT çš„ MSB ã€‚ æˆ‘ä»¬çš„ç›®æ ‡æ˜¯æœ€å¤§é”™è¯¯ç‡ä¸º 500ppmï¼ˆå®é™…ä¸ŠçœŸæ­£çš„è¯¯å·®è¦å°å¾—å¤šï¼‰ï¼Œä½†æ˜¯è€—æ—¶ä¸èƒ½è¶…è¿‡ 50ms ï¼Œ MAX_QUICK_PIT_MS * PIT_TICK_RATE / 1000 å¾—åˆ°çš„æ˜¯ 50ms å†…çš„æ—¶é’Ÿå‘¨æœŸä¸ªæ•°ï¼Œä¹Ÿå°±æ˜¯è®¡æ•°å™¨å‡å°‘çš„æ•°å€¼ï¼Œ æœ€åé™¤ä»¥ 256 æ˜¯å› ä¸ºæˆ‘ä»¬åªå– MSB ã€‚ */ #define MAX_QUICK_PIT_MS 50 #define MAX_QUICK_PIT_ITERATIONS (MAX_QUICK_PIT_MS * PIT_TICK_RATE / 1000 / 256) //=233 static unsigned long quick_pit_calibrate(void) { int i; u64 tsc, delta; unsigned long d1, d2; /* å…³é—­èœ‚é¸£å™¨ */ outb((inb(0x61) \u0026amp; ~0x02) | 0x01, 0x61); /* è®¡æ•°å™¨ 2 , è¯»å†™æ–¹å¼æ˜¯å…ˆä½åé«˜ï¼Œå·¥ä½œæ¨¡å¼æ˜¯ 0 , äºŒè¿›åˆ¶è®¡æ•° å½“è®¡æ•°å™¨å·¥ä½œæ¨¡å¼è®¾ä¸º 0 åï¼Œè¯¥è®¡æ•°å™¨çš„è¾“å‡ºä¿¡å·ç«‹å³å˜ä¸ºä½ç”µå¹³ï¼Œä¸”è®¡æ•°è¿‡ç¨‹ä¸­ä¸€ç›´ä¿æŒä½ç”µå¹³ã€‚åœ¨ç»åˆå€¼å¯„å­˜å™¨èµ‹åˆå€¼åï¼Œå¼€å§‹è®¡æ•°ï¼Œåœ¨æ¯ä¸ª CLK æ—¶é’Ÿä¸‹é™æ²¿ï¼Œè®¡æ•°å™¨è¿›è¡Œå‡ 1 è®¡æ•°ï¼Œå½“è®¡æ•°å‡åˆ° 0 æ—¶ï¼ŒOUT è¾“å‡ºä¿¡å·å˜ä¸ºé«˜ç”µå¹³ï¼Œä¸”ä¸€ç›´ä¿æŒåˆ°è¯¥è®¡æ•°å™¨é‡æ–°èµ‹åˆå€¼ã€‚è¯¥ä¿¡å·å¯ä»¥ä½œä¸ºä¸­æ–­è¯·æ±‚ä¿¡å·ã€‚ 0 æ¨¡å¼æ— è‡ªåŠ¨è£…å…¥è®¡æ•°åˆå§‹å€¼çš„åŠŸèƒ½ï¼Œè‹¥è¦ç»§ç»­è®¡æ•°ï¼Œåˆ™éœ€è¦é‡æ–°å†™å…¥è®¡æ•°åˆå§‹å€¼ã€‚åœ¨è®¡æ•°æœŸé—´ï¼Œè£…å…¥æ–°çš„åˆå§‹å€¼ï¼Œè®¡æ•°å™¨ä¼šåœ¨åˆå§‹å€¼å†™å…¥åé‡æ–°å¼€å§‹è®¡æ•°ã€‚ */ outb(0xb0, 0x43); /* ä» 0xffff å¼€å§‹è®¡æ•° */ outb(0xff, 0x42); outb(0xff, 0x42); /* è¿™é‡Œéœ€è¦ä¸€ä¸ªå¾®å°çš„å»¶æ—¶ï¼Œæœ€ç®€å•çš„æ–¹æ³•æ˜¯ç¬¬ä¸€æ¬¡ PIT */ pit_verify_msb(0); /* ä¸‹é¢é€šè¿‡ä¸€ä¸ªè¿­ä»£è¿‡ç¨‹æµ‹é‡å‡ºä¸€æ®µæ—¶é—´(50ms)å†… TSC çš„å¢é•¿ æ¯æ¬¡å¾ªç¯ï¼ŒPIT éƒ½ä¼šå‡å°‘ 256 , i æ¬¡å¾ªç¯å°±æ˜¯ (I * 256 / PIT_TICK_RATE) ç§’ delta è®°å½•çš„æ˜¯å¾ªç¯è¿‡ç¨‹ä¸­ TSC æ•°å€¼çš„å¢é•¿ å¾ªç¯ç»“æŸåï¼Œç”¨è¿™ä¸¤ä¸ªæ•°å€¼è®¡ç®—ä¸»é¢‘ */ if (pit_expect_msb(0xff, \u0026amp;tsc, \u0026amp;d1)) { for (i = 1; i \u0026lt;= MAX_QUICK_PIT_ITERATIONS; i++) { if (!pit_expect_msb(0xff-i, \u0026amp;delta, \u0026amp;d2)) break; delta -= tsc; if (d1+d2 \u0026gt;= delta \u0026gt;\u0026gt; 11) //ç¡®ä¿è¯¯å·®å°äº 500ppm ï¼Œä¸ç†è§£ continue; if (!pit_verify_msb(0xfe - i)) //å†æ¬¡æ£€æµ‹ PIT çš„ MSB ï¼Œç¡®ä¿ PIT çš„å€¼å·²ç»æ˜¯ 0xfe-i break; goto success; } } printk(\u0026#34;Fast TSC calibration failed\\n\u0026#34;); return 0; success: /* kHz = ticks / time-in-seconds / 1000; kHz = (t2 - t1) / (I * 256 / PIT_TICK_RATE) / 1000 kHz = ((t2 - t1) * PIT_TICK_RATE) / (I * 256 * 1000) ä¸»é¢‘é€šè¿‡ delta è¿”å› */ delta *= PIT_TICK_RATE; do_div(delta, i*256*1000); // do_div() æ˜¯å†…æ ¸çš„ 64 ä½é™¤æ³•å‡½æ•°ï¼Œç»“æœä¿æŒåœ¨ç¬¬ä¸€å‚æ•°ï¼Œè¿”å›ä½™æ•° printk(\u0026#34;Fast TSC calibration using PIT\\n\u0026#34;); return delta; } é€šå¸¸ç”¨ PIT å¿«é€Ÿæ ¡å‡† TSC éƒ½ä¼šæˆåŠŸï¼Œç›´æ¥ç”¨è¿”å›å€¼ä½œä¸º tsc_khz ï¼Œå¹¶èµ‹äºˆ cpu_khz ä½œä¸ºä¸»é¢‘ã€‚å¦‚æœå¤±è´¥ï¼Œä¼šç»§ç»­ç”¨ä¸€ç§å¤æ‚çš„æ–¹å¼è®¡ç®— PIT å’Œ TSC ã€‚\n5./proc/cpuinfo #åœ¨ç”¨æˆ·ç©ºé—´ï¼Œæˆ‘ä»¬æ˜¯é€šè¿‡ /proc/cpuinfo æ–‡ä»¶è·å¾— CPU ä¸»é¢‘çš„ã€‚proc æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–‡ä»¶ï¼Œå¿…é¡»åœ¨å†…æ ¸æºç çš„æŸä¸ªä½ç½®åˆ›å»ºå¹¶ä½¿ç”¨ file_operations å£°æ˜ï¼Œcpuinfo çš„å£°æ˜ä½äº fs/proc/cpuinfo.c æ–‡ä»¶ï¼š\nstatic const struct file_operations proc_cpuinfo_operations = { .open\t= cpuinfo_open, .read\t= seq_read, .llseek\t= seq_lseek, .release\t= seq_release, }; static int __init proc_cpuinfo_init(void) { proc_create(\u0026#34;cpuinfo\u0026#34;, 0, NULL, \u0026amp;proc_cpuinfo_operations); return 0; } ç„¶ååœ¨ arch/x86/kernel/cpu/proc.c æ–‡ä»¶ä¸­æœ‰å¾ˆå¤š show_cpuinfo_*() å‡½æ•°ï¼Œæ¯”å¦‚ static int show_cpuinfo(struct seq_file *m, void *v) ï¼Œå®ƒä»¬ä¼šè°ƒç”¨ seq_printf() å‡½æ•°æŠŠä¿¡æ¯è¾“å‡ºåˆ° /proc/cpuinfo æ–‡ä»¶ä¸­:\nstatic int show_cpuinfo(struct seq_file *m, void *v) { struct cpuinfo_x86 *c = v; unsigned int cpu; int i; cpu = c-\u0026gt;cpu_index; seq_printf(m, \u0026#34;processor\\t: %u\\n\u0026#34; \u0026#34;vendor_id\\t: %s\\n\u0026#34; \u0026#34;cpu family\\t: %d\\n\u0026#34; \u0026#34;model\\t\\t: %u\\n\u0026#34; \u0026#34;model name\\t: %s\\n\u0026#34;, cpu, c-\u0026gt;x86_vendor_id[0] ? c-\u0026gt;x86_vendor_id : \u0026#34;unknown\u0026#34;, c-\u0026gt;x86, c-\u0026gt;x86_model, c-\u0026gt;x86_model_id[0] ? c-\u0026gt;x86_model_id : \u0026#34;unknown\u0026#34;); ... } å¯ä»¥çœ‹å‡ºå¤§éƒ¨åˆ† CPU ä¿¡æ¯éƒ½æ˜¯é€šè¿‡ struct cpuinfo_x86 *c ç»“æ„è·å–çš„ï¼Œè¿™ä¸ªç»“æ„çš„å£°æ˜åœ¨ arch/x86/include/asm/processor.h æ–‡ä»¶ï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶ä¸­æœç´¢è¯¥ç»“æ„çš„å¼•ç”¨ï¼Œä¼šæ‰¾åˆ° extern void cpu_detect(struct cpuinfo_x86 *c); ç­‰ç±»ä¼¼çš„å‡½æ•°ï¼Œè¿™äº›å‡½æ•°å†…é€šè¿‡ cpuid() å‡½æ•°ä»ç¡¬ä»¶å¯„å­˜å™¨ä¸Šè¯»å–ä¿¡æ¯ï¼Œç„¶åå¡«å…… struct cpuinfo_x86 *c ç»“æ„ ï¼Œè¿™æ˜¯ä¸€ä¸ªå†…è”å‡½æ•° ï¼š\nstatic inline void cpuid(unsigned int op, unsigned int *eax, unsigned int *ebx, unsigned int *ecx, unsigned int *edx) { *eax = op; *ecx = 0; __cpuid(eax, ebx, ecx, edx); } å‡½æ•°å†…çš„ __cpuid() æ˜¯å°è£…äº† native_cpuid() å‡½æ•°çš„å®å®šä¹‰ï¼Œä¹Ÿåœ¨è¿™ä¸ªæ–‡ä»¶é‡Œå®šä¹‰ï¼š\nstatic inline void native_cpuid(unsigned int *eax, unsigned int *ebx, unsigned int *ecx, unsigned int *edx) { /* ecx is often an input as well as an output. */ asm volatile(\u0026#34;cpuid\u0026#34; : \u0026#34;=a\u0026#34; (*eax), \u0026#34;=b\u0026#34; (*ebx), \u0026#34;=c\u0026#34; (*ecx), \u0026#34;=d\u0026#34; (*edx) : \u0026#34;0\u0026#34; (*eax), \u0026#34;2\u0026#34; (*ecx) : \u0026#34;memory\u0026#34;); } è¿™é‡Œæ˜¯é€šè¿‡æ±‡ç¼–æŒ‡ä»¤è¯»å–ç›¸åº”çš„å¯„å­˜å™¨ï¼Œè¿™äº›æŒ‡ä»¤å±äº CPUID ï¼Œæ˜¯ X86 æ¶æ„çš„å¤„ç†å™¨è¡¥å……æŒ‡ä»¤ï¼Œç”¨äºå‘ç°å¤„ç†å™¨çš„è¯¦ç»†ä¿¡æ¯ï¼Œå‚è€ƒhttps://zh.wikipedia.org/wiki/CPUIDã€‚\nè¿˜æœ‰ä¸€äº›ä¿¡æ¯ä¸æ˜¯é€šè¿‡ CUPID è·å–çš„ï¼Œæ¯”å¦‚ CPU ä¸»é¢‘ï¼ˆCPU frequencyï¼‰ï¼Œåœ¨ arch/x86/kernel/cpu/proc.c æ–‡ä»¶çš„ show_cpuinfo() å‡½æ•°ä¸­å¯ä»¥çœ‹åˆ°ï¼š\nif (cpu_has(c, X86_FEATURE_TSC)) { unsigned int freq = cpufreq_quick_get(cpu); if (!freq) freq = cpu_khz; seq_printf(m, \u0026#34;cpu MHz\\t\\t: %u.%03u\\n\u0026#34;, freq / 1000, (freq % 1000)); } å®ƒæ˜¯å…ˆè°ƒç”¨ cpufreq_quick_get() å‡½æ•°è¿”å›ä¸€ä¸ªå€¼ï¼Œè¿™æ˜¯ cpufrep æ¨¡å—çš„ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒçš„è¿”å›å€¼ä¸ sysfs ä¸­ /sys/devices/system/cpu/cpu[n]/cpufreq/ ç›®å½•ä¸‹çš„ scaling_cur_freq å®Œå…¨ä¸€è‡´ï¼Œè€Œä¸”å¯ä»¥åŠ¨æ€å˜åŒ–ã€‚å¦‚æœè°ƒç”¨å¤±è´¥ï¼Œå°±æŠŠ cpu_khz ä½œä¸º CPU ä¸»é¢‘ã€‚\nCPU çš„ä¸»é¢‘æ˜¯å¯ä»¥åŠ¨æ€è°ƒèŠ‚çš„ã€‚ä¸»é¢‘è¶Šé«˜ï¼ŒåŠŸè€—ä¹Ÿè¶Šé«˜ï¼Œä¸ºäº†èŠ‚çœ CPU çš„åŠŸè€—å’Œå‡å°‘å‘çƒ­ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®å½“å‰ CPU çš„è´Ÿè½½æƒ…å†µï¼ŒåŠ¨æ€åœ°æä¾›åˆšå¥½è¶³å¤Ÿçš„ä¸»é¢‘ç»™ CPU ã€‚Linux å†…æ ¸æä¾›äº†ä¸€å¥—æ¡†æ¶æ¥å®Œæˆè¿™ä¸ªç›®æ ‡ï¼Œè¿™å°±æ˜¯ cpufrep å­ç³»ç»Ÿã€‚\ncpufrep å­ç³»ç»Ÿåœ¨ç”¨æˆ·ç©ºé—´æä¾›äº† sysfs æ¥å£ï¼Œéƒ½ä½äº /sys/devices/system/cpu ç›®å½•ä¸‹ï¼š\n/sys/devices/system/cpu$ ls cpu0 cpu2 cpufreq kernel_max modalias online power probe uevent cpu1 cpu3 cpuidle microcode offline possible present release 6.BogoMIPS #åœ¨ /proc/cpuinfo ä¸­å¯ä»¥çœ‹åˆ°ä¸€ä¸ªå‚æ•° bogomips ï¼Œåœ¨ dmesg ä¸­ä¹Ÿå¯ä»¥çœ‹åˆ°ç±»ä¼¼çš„ä¿¡æ¯ï¼š\n[ 0.000001] Calibrating delay loop (skipped), value calculated using timer frequency.. 6385.48 BogoMIPS (lpj=12770964) ä»å­—é¢æ„æ€ä¹Ÿå¯ä»¥ç†è§£ï¼Œ BogoMIPS å°±æ˜¯ä¼ªç™¾ä¸‡æ¬¡æŒ‡ä»¤æ¯ç§’ï¼Œæ¯ç§’é’Ÿå¯ä»¥æ‰§è¡Œå‡ ç™¾ä¸‡æ¡æŒ‡ä»¤ï¼Œæ˜¯ä¸€ç§è¡¡é‡ CPU é€Ÿåº¦çš„ä¸ç§‘å­¦æ–¹æ³•ã€‚è¿™æ¡ä¿¡æ¯æ¥è‡ªäºå†…æ ¸ init/calibrate.c æ–‡ä»¶çš„ calibrate_delay() å‡½æ•°ã€‚\nå‚è€ƒ # CPU é¢‘ç‡ Programmable Interval Timer CPU frequency scaling ","date":"2018 August 7","permalink":"/posts/2018/08/07/","section":"Posts","summary":"1.CPU ä¸»é¢‘ #CPU çš„ä¸»é¢‘æ˜¯æŒ‡ CPU æ ¸å¿ƒçš„æ—¶é’Ÿé¢‘ç‡ï¼Œå®ƒæ˜¯ CPU æ‰§è¡ŒæŒ‡ä»¤çš„æœ€å°æ—¶é—´å•ä½ã€‚CPU å†…éƒ¨æœ‰æ—¶é’Ÿç®¡ç†æ¨¡å—ï¼Œé€šè¿‡å¤–éƒ¨æŒ¯è¡å™¨ï¼ˆè·å–å…¶ä»–æ—¶é’Ÿç”µè·¯ï¼‰è¾“å…¥ä¸€ä¸ªç‰¹å®šçš„é¢‘ç‡ï¼ˆå¤–é¢‘ï¼‰ï¼Œç»è¿‡å†…éƒ¨çš„ PLL ç”µè·¯ï¼ˆå€é¢‘å™¨ï¼‰é”å®šåˆ°ä¸€ä¸ªå¾ˆé«˜çš„é¢‘ç‡ï¼Œå†ç»è¿‡ä¸åŒçš„åˆ†é¢‘ï¼Œä¾›ç»™ä¸åŒçš„æ¨¡å—å’Œæ€»çº¿ä½¿ç”¨ï¼Œä¾›ç»™ CPU çš„å°±ç§°ä¸ºä¸»é¢‘,å°±æ˜¯é€šå¸¸æ‰€è¯´çš„â€œä¸»é¢‘ = å¤–é¢‘ x å€é¢‘â€ã€‚ç›®å‰æ¡Œé¢ X86 CPU çš„å¤–é¢‘ç”±ä¸»æ¿ä¾›ç»™ï¼Œé€šå¸¸æ˜¯ 100MHz ï¼Œå€é¢‘é€šå¸¸æ˜¯å›ºå®šè®¾ç½®çš„ã€‚å¦‚æœè¦è¶…é¢‘ï¼Œé€šå¸¸æ˜¯åœ¨ä¸»æ¿çš„ BIOS ä¸­ä¿®æ”¹å€é¢‘å› å­ï¼Œä¹Ÿæœ‰ç‰¹æ®Šæƒ…å†µå¯ä»¥å¢åŠ å¤–é¢‘ã€‚","title":"Linux ç³»ç»Ÿå¦‚ä½•è·å– CPU ä¸»é¢‘"},{"content":" åŸºäº Ubuntu 14.04 ï¼ŒLinux Kernel 4.0 ä»¥ä¸Šç‰ˆæœ¬ã€‚\n1. printk() #printk() æ˜¯å†…æ ¸æä¾›çš„å‡½æ•°ï¼Œç”¨äºå°†å†…æ ¸ç©ºé—´çš„ä¿¡æ¯æ‰“å°åˆ°ç”¨æˆ·ç©ºé—´ç¼“å†²åŒºï¼Œæ‰“å°çš„ä¿¡æ¯å¯ä»¥é€šè¿‡ demsg å‘½ä»¤æŸ¥çœ‹ï¼Œæˆ–è€…ç›´æ¥æŸ¥çœ‹ /proc/kmsg æ–‡ä»¶ã€‚ç¼“å†²åŒºæ˜¯ä¸€ä¸ªç¯å½¢é˜Ÿåˆ—çš„ç»“æ„ï¼Œæ¶ˆæ¯å¤ªå¤šæ—¶ï¼Œæ—§çš„æ¶ˆæ¯å°±ä¼šè¢«é€æ¸è¦†ç›–ï¼Œç¼“å†²åŒºå¤§å°æ˜¯åœ¨ kernel/printk/printk.c æ–‡ä»¶ä¸­çš„ä»£ç è®¾ç½®çš„ï¼š\n#define __LOG_BUF_LEN (1 \u0026lt;\u0026lt; CONFIG_LOG_BUF_SHIFT) static char __log_buf[__LOG_BUF_LEN] __aligned(LOG_ALIGN); ç¼“å†²åŒºå¤§å°æ˜¯ CONFIG_LOG_BUF_SHIFT*2 ä¸ªå­—èŠ‚ï¼ŒCONFIG_LOG_BUF_SHIFT æ˜¯åœ¨ init/Kconfig æ–‡ä»¶ä¸­è®¾ç½®çš„ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ menuconfig çš„ç›¸å…³è·¯å¾„ä¸­ä¿®æ”¹ï¼š\nGeneral setup -\u0026gt; Kernel log buffer size(16 =\u0026gt; 64KB, 17 =\u0026gt; 128kB) è¿˜å¯ä»¥åœ¨åŠ è½½å†…æ ¸æ—¶ç”¨å¯åŠ¨å‚æ•° log_buf_len=n[KMG] è®¾ç½®ï¼Œå…¶ä¸­çš„ n å¿…é¡»æ˜¯ 2 çš„æ•´æ•°å€ã€‚\nåœ¨è°ƒç”¨ printk() å‡½æ•°æ—¶è¦è®¾ç½®æ¶ˆæ¯çº§åˆ«ï¼Œä» 0 åˆ° 7 ï¼Œæ•°å€¼è¶Šå°çº§åˆ«è¶Šé«˜ï¼Œç›¸åº”çš„å®å®šä¹‰åœ¨ include/linux/kern_levels.h æ–‡ä»¶ä¸­ï¼š\n#define KERN_EMERG KERN_SOH \u0026quot;0\u0026quot; /* system is unusable */ #define KERN_ALERT KERN_SOH \u0026quot;1\u0026quot; /* action must be taken immediately */ #define KERN_CRIT KERN_SOH \u0026quot;2\u0026quot; /* critical conditions */ #define KERN_ERR KERN_SOH \u0026quot;3\u0026quot; /* error conditions */ #define KERN_WARNING KERN_SOH \u0026quot;4\u0026quot; /* warning conditions */ #define KERN_NOTICE KERN_SOH \u0026quot;5\u0026quot; /* normal but significant condition */ #define KERN_INFO KERN_SOH \u0026quot;6\u0026quot; /* informational */ #define KERN_DEBUG KERN_SOH \u0026quot;7\u0026quot; /* debug-level messages */ #define KERN_DEFAULT KERN_SOH \u0026quot;d\u0026quot; /* the default kernel loglevel */ å†…æ ¸ä¸­è¿˜æœ‰ä¸€ä¸ªé»˜è®¤æ—¥å¿—çº§åˆ«ï¼Œåªæœ‰æ•°å€¼å°äºè¿™ä¸ªçº§åˆ«çš„æ¶ˆæ¯æ‰ä¼šè¢«æ‰“å°åˆ°æ§åˆ¶å°ä¸Šï¼Œå¤§äºæˆ–è€…ç­‰äºè¿™ä¸ªæ•°å€¼çš„æ¶ˆæ¯ä¸ä¼šæ˜¾ç¤ºï¼Œå®ƒè®¾ç½®åœ¨ lib/Kconfig.debug æ–‡ä»¶ä¸­ï¼Œç¼ºçœæƒ…å†µä¸‹ä¼šè®¾ä¸º KERN_WARNING(4) ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ menuconfig çš„ç›¸å…³è·¯å¾„ä¸­è®¾ç½®ï¼š\nKernel hacking -\u0026gt; printk and dmesg options -\u0026gt; Default message log level(1-7) ä¹Ÿå¯ä»¥ç”¨å†…æ ¸å¯åŠ¨å‚æ•° loglevel=n è®¾ç½®ï¼Œn çš„å–å€¼æ˜¯ 0~7 ã€‚å¦‚æœç›´æ¥è®¾ç½®äº†å¯åŠ¨å‚æ•° debug ï¼Œé‚£ä¹ˆæ—¥å¿—çº§åˆ«å°±æ˜¯ KERN_DEBUG(7) ï¼Œæ‰€æœ‰è°ƒè¯•ä¿¡æ¯éƒ½ä¼šæ˜¾ç¤ºåœ¨æ§åˆ¶å°ä¸Šã€‚è¿˜å¯ä»¥åœ¨ç³»ç»Ÿå¯åŠ¨åï¼Œåœ¨ /proc/sys/kernel/printk æ–‡ä»¶ä¸­è°ƒæ•´ printk() å‡½æ•°çš„è¾“å‡ºç­‰çº§ï¼Œè¯¥æ–‡ä»¶æœ‰å››ä¸ªæ•°å€¼ï¼Œå„è‡ªçš„å«ä¹‰ï¼š\næ§åˆ¶å°çš„æ—¥å¿—çº§åˆ«:å½“å‰çš„æ‰“å°çº§åˆ«,ä¼˜å…ˆçº§é«˜äºè¯¥å€¼(å€¼è¶Šå°,ä¼˜å…ˆçº§è¶Šé«˜)çš„æ¶ˆæ¯å°†è¢«æ‰“å°è‡³æ§åˆ¶å° é»˜è®¤çš„æ¶ˆæ¯æ—¥å¿—çº§åˆ«: å°†ç”¨è¯¥ä¼˜å…ˆçº§æ¥æ‰“å°æ²¡æœ‰ä¼˜å…ˆçº§å‰ç¼€çš„æ¶ˆæ¯,ä¹Ÿå°±æ˜¯ç›´æ¥å†™ printk(\u0026quot;xxx\u0026quot;) è€Œä¸å¸¦æ‰“å°çº§åˆ«çš„æƒ…å†µä¸‹,ä¼šä½¿ç”¨è¯¥æ‰“å°çº§åˆ« æœ€ä½çš„æ§åˆ¶å°æ—¥å¿—çº§åˆ«: æ§åˆ¶å°æ—¥å¿—çº§åˆ«å¯è¢«è®¾ç½®çš„æœ€å°å€¼(ä¸€èˆ¬æ˜¯1) é»˜è®¤çš„æ§åˆ¶å°æ—¥å¿—çº§åˆ«: æ§åˆ¶å°æ—¥å¿—çº§åˆ«çš„é»˜è®¤å€¼ ä¿®æ”¹æ–¹æ³•ï¼š\nroot@sh-VirtualBox:/proc/sys/kernel# cat printk 4\t4\t1\t7 root@sh-VirtualBox:/proc/sys/kernel# echo 5 \u0026gt; printk root@sh-VirtualBox:/proc/sys/kernel# cat printk 5\t4\t1\t7 root@sh-VirtualBox:/proc/sys/kernel# echo \u0026quot;5 5\u0026quot; \u0026gt; printk root@sh-VirtualBox:/proc/sys/kernel# cat printk 5\t5\t1\t7 é»˜è®¤æƒ…å†µä¸‹ï¼Œprintk() æ‰“å°çš„æ¶ˆæ¯æ˜¯å¸¦æ—¶é—´æˆ³çš„ï¼Œå¯ä»¥åœ¨ menuconfig çš„ç›¸åº”è·¯å¾„ä¸‹å…³é—­æˆ–è€…æ‰“å¼€ï¼š\nKernel hacking -\u0026gt; printk and dmesg options -\u0026gt; Show timing information on printks ä¸ºäº†æ–¹ä¾¿è°ƒç”¨ï¼Œå†…æ ¸æä¾›å¾ˆå¤šå°è£…äº† printk() å‡½æ•°çš„å®ï¼Œåœ¨ /include/linux/printk.h å¤´æ–‡ä»¶ä¸­å£°æ˜çš„ pr_xxx() ï¼Œä¾‹å¦‚ï¼š\n#define pr_fmt(fmt) fmt #define pr_err(fmt, ...) printk(KERN_ERR pr_fmt(fmt), ##__VA_ARGS__) #define pr_warning(fmt, ...) printk(KERN_WARNING pr_fmt(fmt), ##__VA_ARGS__) #define pr_info(fmt, ...) printk(KERN_INFO pr_fmt(fmt), ##__VA_ARGS__) æˆ‘ä»¬å¯ç”¨é€šè¿‡ pr_fmt(fmt) æ·»åŠ ä¸€äº›è‡ªå®šä¹‰çš„æ¶ˆæ¯æ ¼å¼ï¼Œä¾‹å¦‚ï¼š\n#define pr_fmt(fmt) \u0026quot;[driver] watchdog:\u0026quot; fmt è¿™é‡Œè¦æ³¨æ„ pr_debug()ï¼Œå®ƒä¸å…¶ä»–çš„å®ä¸åŒï¼Œéœ€è¦æ»¡è¶³å¦‚ä¸‹ä¸¤ä¸ªæ¡ä»¶ä¹‹ä¸€æ‰ä¼šæ‰“å°ä¿¡æ¯ï¼š\nåœ¨æºæ–‡ä»¶ã€æˆ–è€…ç¼–è¯‘æ—¶å®šä¹‰äº† DEBUG å®ï¼Œè¿™ä¸ªæ–¹å¼åœ¨å¼€å‘å†…æ ¸æ¨¡å—æ—¶å¾ˆæœ‰ç”¨ å¼€å¯äº† CONFIG_DYNAMIC_DEBUG ï¼Œä¹Ÿå°±æ˜¯ menuconfig ä¸­çš„ Kernel hacking -\u0026gt; printk and dmesg options è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå†…æ ¸å¯åŠ¨åï¼Œéœ€è¦ä¸€æ®µæ—¶é—´æ‰èƒ½å‡†å¤‡å¥½æ§åˆ¶å°ï¼Œè¿™æ®µæ—¶é—´å†…çš„å†…æ ¸ä¿¡æ¯æ˜¯æ— æ³•é€šè¿‡æ§åˆ¶å°æ˜¾ç¤ºï¼Œå†…æ ¸ä¸ºæ­¤æä¾›äº† early printk æœºåˆ¶ï¼Œå®ƒä¼šåœ¨å†…æ ¸å¯åŠ¨åå°±æ³¨å†Œä¸€ä¸ª boot console ï¼Œè®©åå°†å†…æ ¸ä¿¡æ¯æ˜¾ç¤ºåœ¨è¿™ä¸ªæ§åˆ¶å°ä¸Šã€‚ä½¿èƒ½ early printk çš„æ–¹æ³•æœ‰ä¸¤æ­¥ï¼š\nåœ¨ menuconfig ä¸­æ‰“å¼€ Early printk ï¼šKernel hacking -\u0026gt; Early printk åœ¨å¯åŠ¨å‚æ•°ä¸­è®¾ç½® earlyprintk=[vga|serial][,ttySn[,baudrate]][,keep] å¦‚æœç”¨æˆ·ç©ºé—´çš„ printf() å’Œå†…æ ¸ç©ºé—´çš„ printk() åŒæ—¶æ‰§è¡Œï¼ŒäºŒè€…çš„è¾“å‡ºä¼šäº’ç›¸å¹²æ‰°ï¼Œå†…æ ¸ä¸ºæ­¤æä¾›äº† /dev/ttyprintk è®¾å¤‡æ–‡ä»¶ï¼Œå¯ä»¥å°†ç”¨æˆ·ç©ºé—´çš„ä¿¡æ¯æ‰“å°åˆ°è¿™ä¸ªè®¾å¤‡ä¸­ï¼Œè¿™æ ·ç”¨æˆ·ä¿¡æ¯ä¸å†…æ ¸ä¿¡æ¯å°±ä¼šé¡ºåºè¾“å‡ºï¼Œè¾“å‡ºçš„æ¶ˆæ¯ä¼šè‡ªå¸¦ [U] å‰ç¼€ã€‚å¯¹äºæ²¡æœ‰ /dev/ttyprintk è®¾å¤‡çš„ç³»ç»Ÿï¼Œå¯ä»¥ç”¨ /dev/kmsg ä»£æ›¿ï¼Œåªæ˜¯æ²¡æœ‰äº† [U] æ ‡è¯†ï¼Œéœ€è¦ç”¨æˆ·è‡ªå·±æ·»åŠ å‰ç¼€ã€‚\n2. SysRq é”® #æ ‡å‡†é”®ç›˜çš„å³ä¸Šè§’æœ‰ä¸€ä¸ª PrintScreen/SysRq é”®ï¼Œå®ƒçš„ä¸€ä¸ªåŠŸèƒ½æ˜¯æˆªå±ï¼Œå¦ä¸€ä¸ªåŠŸèƒ½æ˜¯å½“ç³»ç»Ÿæ­»æœºæ— æ³•è¾“å…¥å‘½ä»¤æ—¶ï¼Œç”¨è¿™ä¸ªæŒ‰é”®è·å–å†…æ ¸ä¿¡æ¯ã€‚SysRq é”®åœ¨ç¡®è®¤å†…æ ¸è¿è¡Œã€è°ƒæŸ¥æ­»æœºåŸå› ç­‰æƒ…å†µæ—¶éå¸¸æœ‰æ•ˆã€‚å…³äºå®ƒçš„è¯¦ç»†æƒ…å†µå¯ä»¥å‚è€ƒå†…æ ¸çš„ Documentation/sysrq.txt æ–‡ä»¶ã€‚\nè¦ä½¿ç”¨ SysRq é”®ï¼Œéœ€è¦å¯åŠ¨å†…æ ¸é…ç½® CONFIG_MAGIC_SYSRQ ï¼Œåœ¨ menuconfig ä¸­çš„è·¯å¾„æ˜¯ï¼š\nKernel hacking -\u0026gt; Magic SysRq key ç³»ç»Ÿå¯åŠ¨åï¼Œå°±å¯ä»¥åœ¨ /proc/sys/kernel/sysrq æ–‡ä»¶ä¸­è®¾ç½® SysRq æŒ‰é”®çš„åŠŸèƒ½ï¼Œè¯¥æ–‡ä»¶çš„é»˜è®¤å€¼æ˜¯å†…æ ¸é€‰é¡¹ CONFIG_MAGIC_SYSRQ_DEFAULT_ENABLE è®¾ç½®çš„,å¿…é¡»æ˜¯åå…­è¿›åˆ¶ï¼Œåœ¨ menuconfig çš„è·¯å¾„æ˜¯ï¼š\nKernel hacking -\u0026gt; (0x01) Enable magic Sysrq key functions by default æ³¨æ„ï¼Œ/proc/sys/kernel/sysrq è®¾ç½®çš„å„é¡¹åŠŸèƒ½ï¼Œåªå¯¹ä»é”®ç›˜å’Œä¸²å£æ§åˆ¶å°çš„è¾“å…¥æœ‰æ•ˆï¼Œå¯¹äºè¿œç¨‹ ssh ç­‰æ–¹å¼æ— æ•ˆã€‚ç›´æ¥å‘ /proc/sysrq-trigger å†™å…¥å‘½ä»¤é”®åˆ™ä¸å—é™åˆ¶ï¼šecho [command key] \u0026gt; /proc/sysrq-trigger ã€‚\nè¿™ä¸ªæ–‡ä»¶çš„å€¼æ˜¯ä½æ©ç ï¼Œå–å€¼å¦‚ä¸‹ï¼Œæ‹¬å·å†…æ˜¯å‘½ä»¤é”®ï¼š\n0 ï¼Œç¦ç”¨ sysrq 1 ï¼Œä½¿èƒ½æ‰€æœ‰ sysrq åŠŸèƒ½ 2 = 0x2 ï¼Œå…è®¸æ§åˆ¶æ§åˆ¶å°æ—¥å¿—çº§åˆ«ï¼ˆ0~9ï¼‰ 4 = 0x4 ï¼Œä½¿èƒ½é”®ç›˜æ§åˆ¶ (kr) 8 = 0x8 ï¼Œä½¿èƒ½æ˜¾ç¤ºè¿›è¡Œç­‰ä¿¡æ¯ï¼ˆlptwmczï¼‰ 16 = 0x10 ï¼Œä½¿èƒ½ sync å‘½ä»¤ï¼ˆsï¼‰ 32 = 0x20 ï¼Œä½¿èƒ½åªè¯»çŠ¶æ€ä¸‹çš„é‡æ–°æŒ‚åœ¨ï¼ˆuï¼‰ 64 = 0x40 ï¼Œä½¿èƒ½è¿›ç¨‹ä¿¡å·ï¼Œä¾‹å¦‚ term, killï¼ˆeiï¼‰ 128 = 0x80 ï¼Œä½¿èƒ½é‡å¯å’Œå…³æœºï¼ˆbï¼‰ 256 = 0x100 ï¼Œå…è®¸æ§åˆ¶å®æ—¶ä»»åŠ¡ï¼ˆqï¼‰ å¯ä»¥ç›´æ¥ä¿®æ”¹è¿™ä¸ªæ–‡ä»¶çš„å€¼ï¼Œæ¯”å¦‚ä½¿èƒ½ sync å’Œé‡æ–°æŒ‚è½½ï¼š\n# echo 48 \u0026gt; /proc/sys/kernel/sysrq ä¹Ÿå¯ä»¥åœ¨ /etc/sysctl.d/10-magic-sysrq.conf æ–‡ä»¶ä¸­ä¿®æ”¹ kernel.sysrq é€‰é¡¹ï¼ˆä¹Ÿå¯èƒ½åœ¨ /etc/sysctl.conf æ–‡ä»¶ä¸­ï¼‰ã€‚é…ç½®å¥½åŠŸèƒ½åï¼Œé€šè¿‡ç»„åˆé”® Alt-SysRq-\u0026lt;command key\u0026gt; å°±å¯ä»¥ä½¿ç”¨ SysRq é”®çš„å„é¡¹åŠŸèƒ½ï¼ŒåŠŸèƒ½é”®å¦‚ä¸‹ï¼š\n'b' - Will immediately reboot the system without syncing or unmounting your disks. 'c'\t- Will perform a system crash by a NULL pointer dereference. A crashdump will be taken if configured. 'd'\t- Shows all locks that are held. 'e' - Send a SIGTERM to all processes, except for init. 'f'\t- Will call the oom killer to kill a memory hog process, but do not panic if nothing can be killed. 'g'\t- Used by kgdb (kernel debugger) 'h' - Will display help (actually any other key than those listed here will display help. but 'h' is easy to remember :-) 'i' - Send a SIGKILL to all processes, except for init. 'j' - Forcibly \u0026quot;Just thaw it\u0026quot; - filesystems frozen by the FIFREEZE ioctl. 'k' - Secure Access Key (SAK) Kills all programs on the current virtual console. NOTE: See important comments below in SAK section. 'l' - Shows a stack backtrace for all active CPUs. 'm' - Will dump current memory info to your console. 'n'\t- Used to make RT tasks nice-able 'o' - Will shut your system off (if configured and supported). 'p' - Will dump the current registers and flags to your console. 'q' - Will dump per CPU lists of all armed hrtimers (but NOT regular timer_list timers) and detailed information about all clockevent devices. 'r' - Turns off keyboard raw mode and sets it to XLATE. 's' - Will attempt to sync all mounted filesystems. 't' - Will dump a list of current tasks and their information to your console. 'u' - Will attempt to remount all mounted filesystems read-only. 'v'\t- Forcefully restores framebuffer console 'v'\t- Causes ETM buffer dump [ARM-specific] 'w'\t- Dumps tasks that are in uninterruptable (blocked) state. 'x'\t- Used by xmon interface on ppc/powerpc platforms. Show global PMU Registers on sparc64. Dump all TLB entries on MIPS. 'y'\t- Show global CPU Registers [SPARC-64 specific] 'z'\t- Dump the ftrace buffer '0'-'9' - Sets the console log level, controlling which kernel messages will be printed to your console. ('0', for example would make it so that only emergency messages like PANICs or OOPSes would make it to your console.) å¦‚æœç³»ç»Ÿç–‘ä¼¼æ­»æœºï¼Œå¯ä»¥ä¸€æ¬¡æ‰§è¡Œ s-u-b å‘½ä»¤é‡å¯å†…æ ¸ï¼Œå¦‚æœä¸éœ€è¦é‡å¯ï¼Œå¯ä»¥æ‰§è¡Œ c å‘½ä»¤æå–å´©æºƒè½¬å‚¨ï¼Œè·å–å†…æ ¸ä¿¡æ¯ï¼ˆå†…æ ¸å´©æºƒè½¬å‚¨æ˜¯æŒ‡å°†ç³»ç»Ÿå†…å­˜çš„å†…å®¹è¾“å‡ºåˆ°æ–‡ä»¶ï¼‰ã€‚è¿˜å¯ä»¥å°è¯•ç”¨ i å‘½ä»¤å‘è¿›ç¨‹å‘é€ SIGKILL ä¿¡å·ï¼Œä½¿ç³»ç»Ÿæ¢å¤ã€‚\n3. Kdump #Kdump æ˜¯å†…æ ¸æä¾›çš„å´©æºƒè½¬å‚¨åŠŸèƒ½ï¼Œå·¥ä½œåŸç†æ˜¯åœ¨ç³»ç»Ÿå†…æ ¸å´©æºƒæ—¶å¯åŠ¨ä¸€ä¸ªç‰¹æ®Šçš„ dump-capture kernel æŠŠç³»ç»Ÿå†…å­˜é‡Œçš„æ•°æ®ä¿å­˜åˆ°ç£ç›˜æ–‡ä»¶ä¸­ï¼Œç”±å†…æ ¸æœºåˆ¶å’Œç”¨æˆ·ç©ºé—´å·¥å…·å…±åŒå®Œæˆã€‚Dump-capture kernel å¯ä»¥æ˜¯ç‹¬ç«‹çš„ï¼Œä¹Ÿå¯ä»¥å’Œç³»ç»Ÿå†…æ ¸é›†æˆåœ¨ä¸€èµ·ï¼ˆè¿™éœ€è¦ç¡¬ä»¶æ”¯æŒï¼‰ã€‚Kdump çš„å·¥ä½œè¿‡ç¨‹å¦‚ä¸‹ï¼š\nç³»ç»Ÿå†…æ ¸å¯åŠ¨çš„æ—¶å€™ï¼Œè¦ç»™ dump-capture kernel é¢„ç•™ä¸€å—å†…å­˜ç©ºé—´ï¼› å†…æ ¸å¯åŠ¨å®Œæˆåï¼Œç”¨æˆ·ç©ºé—´çš„ kdump service æ‰§è¡Œ kexec -p å‘½ä»¤æŠŠ dump-capture kernel è½½å…¥é¢„ç•™çš„å†…å­˜é‡Œï¼ˆ/sys/kernel/kexec_crash_loaded çš„å€¼ä¸º 1 è¡¨ç¤ºå·²ç»åŠ è½½ï¼‰ï¼› å¦‚æœç³»ç»Ÿå‘ç”Ÿ crashï¼Œç”Ÿäº§å†…æ ¸ä¼šè‡ªåŠ¨ reboot è¿›å…¥ dump-capture kernelï¼Œdump-capture kernel åªä½¿ç”¨è‡ªå·±çš„é¢„ç•™å†…å­˜ï¼Œç¡®ä¿å…¶ä½™çš„å†…å­˜æ•°æ®ä¸ä¼šè¢«æ”¹åŠ¨ï¼Œå®ƒçš„ä»»åŠ¡æ˜¯æŠŠç³»ç»Ÿå†…å­˜é‡Œçš„æ•°æ®å†™å…¥åˆ° dump æ–‡ä»¶ï¼Œæ¯”å¦‚ /var/crash/vmcoreï¼Œä¸ºäº†å‡å°æ–‡ä»¶çš„å¤§å°ï¼Œå®ƒä¼šé€šè¿‡ makedumpfile(8) å‘½ä»¤å¯¹å†…å­˜æ•°æ®è¿›è¡ŒæŒ‘é€‰å’Œå‹ç¼©ï¼› dump æ–‡ä»¶å†™å®Œä¹‹åï¼Œdump-capture kernel è‡ªåŠ¨ reboot ã€‚ é¢„ç•™å†…å­˜çš„æ–¹æ³•æ˜¯ç”¨å†…æ ¸å¯åŠ¨å‚æ•° crashkernel=size[@offset] å®ç°çš„ï¼ŒæŸäº›å†…æ ¸æ”¯æŒ crashkernel=auto è‡ªåŠ¨åˆ†é…å¤§å°ï¼Œå¦‚æœä¸æ”¯æŒï¼Œæˆ–è€…ç³»ç»Ÿæ²¡æœ‰è¶³å¤Ÿå†…å­˜ï¼Œå°±éœ€è¦æ‰‹åŠ¨è®¾ç½®ã€‚é€šå¸¸ offset å¯ä»¥è®¾ç½®ä¸º 16MB(0x1000000) ï¼Œsize æ ¹æ®ç³»ç»Ÿå†…å­˜çš„å¤§å°è®¾ç½®ï¼Œè€Œä¸”è¦ä¸ 64MB å¯¹é½ï¼š\nå¦‚æœç³»ç»Ÿå†…å­˜å°äº 512MB ï¼Œåˆ™ä¸è¦ä¿ç•™å†…å­˜ å¦‚æœç³»ç»Ÿå†…å­˜ä»‹äº 512MB åˆ° 2GB ä¹‹é—´ï¼Œå¯ä»¥ä¿ç•™ 64MB å†…å­˜ å¦‚æœç³»ç»Ÿå†…å­˜å¤§äº 2GB ï¼Œå¯ä»¥ä¿ç•™ 128MB å†…å­˜ å¯èƒ½å¯¼è‡´å†…æ ¸å´©æºƒçš„äº‹ä»¶åŒ…æ‹¬ï¼š\nKernel Panic Non Maskable Interrupts (NMI) Machine Check Exceptions (MCE) Hardware failure Manual intervention å¯¹äºæŸäº›å´©æºƒäº‹ä»¶ï¼ˆä¾‹å¦‚ panicã€NMIï¼‰ï¼Œå†…æ ¸ä¼šè‡ªåŠ¨åšå‡ºååº”ï¼Œå¹¶é€šè¿‡ kexec è§¦å‘å´©æºƒè½¬å‚¨ï¼Œå…¶ä»–æƒ…å†µä¸‹éœ€è¦æ‰‹åŠ¨æ•è·å†…å­˜ä¿¡æ¯ã€‚\nåœ¨ Ubuntu ä¸Šé¦–å…ˆè¦å®‰è£…å†…æ ¸å´©æºƒè½¬å‚¨å·¥å…·ï¼š\n$ sudo apt-get install linux-crashdump å¦‚æœæ˜¯ Fedora æ“ä½œç³»ç»Ÿï¼Œé€šå¸¸æ˜¯å®‰è£… crash å’Œ kexec-tools è½¯ä»¶åŒ…ã€‚\nlinux-crashdump åŒ…å®‰è£…äº†ä¸‰ä¸ªå·¥å…·ï¼Œåˆ†åˆ«æ˜¯ï¼šcrashï¼Œkexec-tools å’Œ makedumpfileã€‚å®‰è£…è¿‡ç¨‹ä¸­ä¼šå‡ºç°å¦‚ä¸‹å¯¹è¯æ¡†ï¼Œé€‰æ‹© Yes ï¼Œè¡¨ç¤ºé»˜è®¤ä½¿èƒ½ kdump ï¼š\n|------------------------| Configuring kdump-tools |------------------------| | | | | | If you choose this option, the kdump-tools mechanism will be enabled. A | | reboot is still required in order to enable the crashkernel kernel | | parameter. | | | | Should kdump-tools be enabled by default? | | | | \u0026lt;Yes\u0026gt; \u0026lt;No\u0026gt; | | | |---------------------------------------------------------------------------| ç„¶åç¼–è¾‘ /etc/default/kdump-tools æ–‡ä»¶ï¼Œä¿®æ”¹é€‰é¡¹ USE_KDUMP=1 ï¼Œä½¿èƒ½å†…æ ¸åŠ è½½ kdump ï¼Œç„¶åé‡å¯ç³»ç»Ÿï¼Œå†…æ ¸è‡ªåŠ¨æ¿€æ´» crashkernel= å¯åŠ¨å‚æ•° ï¼Œkdump-tools é»˜è®¤å¯åŠ¨ï¼Œç”¨ kdump-config show å‘½ä»¤å’Œ /sys/kernel/kexec_crash_loaded æ–‡ä»¶æŸ¥çœ‹ kdump çš„é…ç½®å’ŒçŠ¶æ€ï¼Œåœ¨ /proc/cmdline æ–‡ä»¶ä¸­æŸ¥çœ‹ crashkernel çš„è®¾ç½®ï¼š\n$ kdump-config show DUMP_MODE: kdump USE_KDUMP: 1 KDUMP_SYSCTL: kernel.panic_on_oops=1 KDUMP_COREDIR: /var/crash crashkernel addr: 0x2d000000 current state: ready to kdump kexec command: /sbin/kexec -p --command-line=\u0026quot;BOOT_IMAGE=/boot/vmlinuz-4.4.0-31-generic root=UUID=2744d8e0-18c2-493f-b61c-d887647494a0 ro quiet splash vt.handoff=7 irqpoll maxcpus=1 nousb\u0026quot; --initrd=/boot/initrd.img-4.4.0-31-generic /boot/vmlinuz-4.4.0-31-generic $ cat /sys/kernel/kexec_crash_loaded 1 $ cat /proc/cmdline BOOT_IMAGE=/boot/vmlinuz-4.4.0-31-generic root=UUID=2744d8e0-18c2-493f-b61c-d887647494a0 ro quiet splash crashkernel=384M-:128M vt.handoff=7 ç³»ç»Ÿå¯åŠ¨åï¼Œå¯ä»¥é€šè¿‡å‘ /sys/kernel/kexec_crash_size å†™å…¥ä¸€ä¸ªæ¯”åŸæ¥å°çš„æ•°å€¼æ¥ç¼©å°ç”šè‡³å®Œå…¨é‡Šæ”¾ crashkernel ã€‚ç„¶åæ‰§è¡Œ sudo kdump-config load åŠ è½½ kdump ï¼Œä¹Ÿå¯ä»¥æŠŠ /etc/init.d/kdump-tool æœåŠ¡è®¾ä¸ºé»˜è®¤å¯åŠ¨ï¼Œè¿™æ ·ç³»ç»Ÿä¼šè‡ªåŠ¨åŠ è½½ã€‚å‡†å¤‡å·¥ä½œå®Œæˆåï¼Œå°è¯•æå–å´©æºƒè½¬å‚¨ï¼Œå…ˆç¡®ä¿ sysrq=1 ï¼Œç„¶åæ‰‹åŠ¨è§¦å‘ä¸€æ¬¡å´©æºƒï¼š\n# echo c \u0026gt; /proc/sysrq-tirgger ç¨ç­‰ç‰‡åˆ»ï¼Œå¦‚æœè½¬å‚¨æˆåŠŸï¼Œå†…æ ¸ä¼šè‡ªåŠ¨é‡å¯ï¼Œå¹¶ä¸”åœ¨ /var/crash/ ç›®å½•ä¸‹ç”Ÿæˆè½¬å‚¨æ–‡ä»¶ï¼š\n$ ls -l /var/crash/* total 28 drwxr-sr-x 2 root whoopsie 4096 7æœˆ 6 11:45 201807061145 -rw-r----- 1 root whoopsie 18095 7æœˆ 6 11:45 linux-image-4.4.0-31-generic-201807061145.crash $ ls -l /var/crash/201807061145/ total 55300 -rw------- 1 root whoopsie 41223 7æœˆ 6 11:45 dmesg.201807061145 -rw------- 1 root whoopsie 56578589 7æœˆ 6 11:45 dump.201807061145 è½¬å‚¨éœ€è¦æ—¶é—´ï¼Œå¦‚æœæ‰‹åŠ¨å…³æœºé‡å¯ä¼šå¯¼è‡´è½¬å‚¨ä¸å®Œæ•´ï¼Œæ•°æ®æ— æ³•è§£è¯»ã€‚\nå¦‚æœæ˜¯ RedHat ç³»ç»Ÿï¼Œç”Ÿæˆçš„è½¬å‚¨æ–‡ä»¶æ˜¯ vmcore ï¼Œå¯ä»¥ç›´æ¥ç”¨ crash å‘½ä»¤åˆ†æã€‚è€Œ Ubuntu æä¾›äº†å«åš Apport çš„å·¥å…·ï¼Œå°†ç³»ç»Ÿå†…å…¶ä»–æœ‰ç”¨çš„ä¿¡æ¯ä¸€èµ·æ‰“åŒ…ç”Ÿæˆäº† linux-image-4.4.0-31-generic-201807061145.crash æ–‡ä»¶ï¼Œè€Œä»¥æ—¶é—´æˆ³å‘½åçš„æ–‡ä»¶å¤¹ 201807061145 åŒ…å«äº† dmesg ä¿¡æ¯æ–‡ä»¶å’Œ kdump è½¬å‚¨æ–‡ä»¶ï¼Œå¯¹äºæŸäº›ç‰ˆæœ¬ï¼Œè¿™ä¸¤ä¸ªæ–‡ä»¶ä¹ŸåŒ…å«åœ¨ crash æ–‡ä»¶ä¸­ã€‚å¯¹ crash æ–‡ä»¶è§£å‹åå¯ä»¥å¾—åˆ°å‡ ä¸ªä¸ç³»ç»Ÿä¿¡æ¯æœ‰å…³çš„çº¯æ–‡æœ¬æ–‡ä»¶ï¼š\n$ sudo apport-unpack /var/crash/linux-image-4.4.0-31-generic-201807061145.crash ~/201807061145.crash $ ls ~/201807061145.crash Architecture Date DistroRelease Package ProblemType Uname VmCoreDmesg 4. å´©æºƒæµ‹è¯• #å†…æ ¸æœ‰ä¸€ä¸ª lkdtm æ¨¡å—ï¼ŒLinux Kernel Dump Test Module ï¼Œé€šè¿‡å„ç§æ–¹å¼ä½¿å†…æ ¸å´©æºƒï¼Œç”¨äºæµ‹è¯•å´©æºƒè½¬å‚¨çš„åŠŸèƒ½ã€‚é€šå¸¸å‘è¡Œç‰ˆçš„å†…æ ¸ä¸ä¼šä½¿èƒ½è¿™ä¸ªæ¨¡å—ï¼Œéœ€è¦å¯ç”¨å†…æ ¸ CONFIG_LKDTM é€‰é¡¹ï¼Œåœ¨ menuconfig çš„è·¯å¾„æ˜¯ï¼š\nKernel hacking -\u0026gt; RunTime Testing -\u0026gt; Linux Kernel Dump Test Tool Module æœ€å¥½ç¼–è¯‘æˆæ¨¡å—ï¼Œç„¶ååŠ è½½æ¨¡å—æ—¶ï¼Œé€šè¿‡æ¨¡å—å‚æ•°æŒ‡å®šå´©æºƒä½ç½®å’Œå´©æºƒåŸå› ï¼Œå³å¯é€ æˆæ‰€éœ€çš„å†…æ ¸å´©æºƒã€‚\n5. crash å‘½ä»¤ #crash æ˜¯ä¸€ä¸ªå¼ºå¤§çš„äº¤äº’å¼å·¥å…·ï¼ŒåŸºäº gdb ï¼Œç”¨äºåˆ†æå†…æ ¸æ˜ åƒï¼Œæ¯”å¦‚å†…æ ¸å´©æºƒè½¬å‚¨ä¿¡æ¯ã€‚æœ‰äº›ç³»ç»Ÿä¸­ï¼Œå®‰è£… linux-crashdump æ—¶ä¼šåŒ…å« crash ï¼Œå¦‚æœæ²¡æœ‰ï¼Œéœ€è¦æ‰‹åŠ¨å®‰è£…ï¼š\nsudo apt-get install crash åˆ†æä¹‹å‰éœ€è¦å®‰è£…ç³»å¸¦æœ‰ debug-info çš„å†…æ ¸ï¼Œå«åš kernel-debuginfo ï¼Œè¿™æ˜¯ redhat çš„å«æ³•ï¼Œ ubuntu ä¸‹å« debug symbolsï¼Œç®€ç§° dbgsym ã€‚ ubuntu é»˜è®¤å®‰è£…æ—¶ä¸ä¼šå®‰è£… dbgsym ï¼Œé»˜è®¤ä»“åº“ä¸Šä¹Ÿæ²¡æœ‰ dbgsym åŒ…ã€‚ dbgsym åŒ…å­˜åœ¨äºç‹¬ç«‹çš„ä»“åº“ä¸Šï¼Œå®˜æ–¹ä»“åº“åœ°å€ä¸º http://ddebs.ubuntu.com/ ï¼Œå®‰è£…æ–¹æ³•å‚è€ƒï¼šhttps://oolap.com/2015-11-07-ubuntu-install-dbgsym ã€‚kernel-debuginfo çš„ç‰ˆæœ¬åº”è¯¥å’Œç³»ç»Ÿè¿è¡Œçš„å†…æ ¸ç‰ˆæœ¬å®Œå…¨ä¸€è‡´ï¼Œå¦‚æœæ˜¯è‡ªè¡Œç¼–è¯‘çš„å†…æ ¸ï¼Œå¯èƒ½æ— æ³•åœ¨å®˜æ–¹ä»“åº“ä¸­æ‰¾åˆ°å¯¹åº”ç‰ˆæœ¬çš„ kernel-debuginfo ï¼Œè¿™æ—¶å¯ä»¥è‡ªè¡Œç¼–è¯‘å®‰è£… kernel-debuginfo ï¼Œå‚è€ƒä¸‹ä¸€èŠ‚ã€‚å®‰è£…å®Œæˆåï¼Œä¼šåœ¨ /usr/lib/debug/boot/ ç›®å½•ä¸‹ç”Ÿæˆå¸¦æœ‰è°ƒè¯•ä¿¡æ¯çš„ vmlinux ï¼Œç„¶åç”¨ crash å·¥å…·åˆ†æ kdump ç”Ÿæˆå´©æºƒè½¬å‚¨ä¿¡æ¯ï¼š\n$ sudo crash /usr/lib/debug/boot/vmlinux-4.4.0-31-generic /var/crash/201807061145/dump.201807061145 ä¸‹é¢ä»¥ä¸€ä¸ª Fedora14(kernel 2.6.37) ä¸‹äº§ç”Ÿçš„è½¬å‚¨æ–‡ä»¶ vmcore ä¸ºä¾‹è¯´æ˜ crash çš„ç”¨æ³•ï¼Œcrash æˆåŠŸå¯åŠ¨åå…ˆæ‰“å°ä¸€æ®µè½¬å‚¨æ–‡ä»¶çš„åˆ†ææŠ¥å‘Šï¼ŒåŒ…æ‹¬å´©æºƒæ—¶é—´ã€å´©æºƒç±»å‹ã€CPUã€å†…å­˜ç­‰ï¼Œç„¶åè¿›å…¥ä¸€ä¸ªäº¤äº’ç¯å¢ƒï¼š\nKERNEL: /boot/vmlinux DUMPFILE: vmcore CPUS: 1 DATE: Fri Jul 27 13:59:13 2018 UPTIME: 00:05:23 LOAD AVERAGE: 0.01, 0.11, 0.07 TASKS: 56 NODENAME: localhost.localdomain RELEASE: 2.6.37.6 VERSION: #11 SMP Thu Jul 26 15:42:06 CST 2018 MACHINE: i686 (1500 Mhz) MEMORY: 1 GB PANIC: \u0026quot;[ 323.903003] Oops: 0002 [#1] SMP \u0026quot; (check log for details) PID: 4437 COMMAND: \u0026quot;bash\u0026quot; TASK: f6ec0c90 [THREAD_INFO: f6d2e000] CPU: 0 STATE: TASK_RUNNING (PANIC) crash \u0026gt; å¯ä»¥çœ‹åˆ°å¼•èµ·å´©æºƒçš„è¿›ç¨‹æ˜¯ PID: 4437 , crash æä¾›äº† ps å‘½ä»¤æ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹çš„çŠ¶æ€ï¼Œç”¨ ps | grep 4437 å¯ä»¥ç­›é€‰å‡ºå¼•èµ·å´©æºƒçš„è¿›ç¨‹ï¼š\ncrash \u0026gt; ps | grep 4437 PID PPID CPU TASK ST %MEM VSZ RSS COMM 4437 4426 0 f6ec0c90 RU 0.2 8064 1780 bash bt å‘½ä»¤ç”¨äºè¾“å‡ºæŸä¸ªè¿›ç¨‹çš„å†…æ ¸æ ˆçš„éå†ï¼Œæ²¡æœ‰æŒ‡å®š PID æ—¶é»˜è®¤è¾“å‡ºå¼•èµ·å´©æºƒçš„è¿›ç¨‹çš„å†…æ ¸æ ˆä¿¡æ¯ï¼š\ncrash\u0026gt; bt PID: 4437 TASK: f6ec0c90 CPU: 0 COMMAND: \u0026quot;bash\u0026quot; #0 [f6d2fdec] crash_kexec at c0466264 #1 [f6d2fe2c] __bad_area_nosemaphore at c04225b5 #2 [f6d2fe48] bad_area at c042260c #3 [f6d2fe60] do_page_fault at c079c8c9 #4 [f6d2fed8] error_code (via page_fault) at c079a685 EAX: 00000063 EBX: 00000063 ECX: ffffffd6 EDX: 00000000 EBP: f6d2ff18 DS: 007b ESI: c095dfe0 ES: 007b EDI: 00000004 GS: 00e0 CS: 0060 EIP: c061e0b9 ERR: ffffffff EFLAGS: 00010046 #5 [f6d2ff0c] sysrq_handle_crash at c061e0b9 #6 [f6d2ff1c] __handle_sysrq at c061e63d #7 [f6d2ff40] write_sysrq_trigger at c061e6e2 #8 [f6d2ff50] proc_reg_write at c0507c84 #9 [f6d2ff74] vfs_write at c04cdf4c #10 [f6d2ff90] sys_write at c04ce11d #11 [f6d2ffb0] ia32_sysenter_target at c0403298 EAX: 00000004 EBX: 00000001 ECX: b77f8000 EDX: 00000002 DS: 007b ESI: b77f8000 ES: 007b EDI: 00000002 SS: 007b ESP: bfc32fd0 EBP: bfc33008 GS: 0033 CS: 0073 EIP: b77fc424 ERR: 00000004 EFLAGS: 00000246 å¯ä»¥çœ‹åˆ°ç³»ç»Ÿå´©æºƒå‰æœ€åä¸€æ¡è°ƒç”¨æ˜¯ #5 [f6d2ff0c] sysrq_handle_crash at c061e0b9 ï¼Œæˆ‘ä»¬ç”¨ dis å‘½ä»¤çœ‹ä¸€ä¸‹è¿™ä¸ªåœ°å€çš„åæ±‡ç¼–ç»“æœï¼š\ncrash\u0026gt; dis -l c061e0b9 /usr/src/linux-2.6.37/drivers/tty/sysrq.c: 134 0xc061e0b9 \u0026lt;sysrq_handle_crash+23\u0026gt;: movb $0x1,0x0 å‡ºé”™çš„ä»£ç ä½äº /usr/src/linux-2.6.37/drivers/tty/sysrq.c æ–‡ä»¶çš„ 134 è¡Œï¼š\n129 static void sysrq_handle_crash(int key) 130 { 131 char *killer = NULL; 132 panic_on_oops = 1; /* force panic */ 133 wmb(); 134 *killer = 1; 135 } è¿™é‡Œä¸ºæŒ‡é’ˆèµ‹å€¼ *killer = 1 ï¼Œè€Œ 131 è¡Œå®šä¹‰çš„æ˜¯ä¸€ä¸ªç©ºæŒ‡é’ˆï¼Œæ¯”å¦‚å‡ºé”™ã€‚\ncrash è¿˜æœ‰å¾ˆå¤šå‘½ä»¤ï¼š\nlog ï¼šæ‰“å°ç³»ç»Ÿæ¶ˆæ¯ç¼“å†²åŒºï¼Œä»è€Œå¯èƒ½æ‰¾åˆ°ç³»ç»Ÿå´©æºƒçš„çº¿ç´¢ã€‚ sys ï¼šæ˜¾ç¤ºç³»ç»Ÿæ¦‚å†µã€‚ kmem ï¼šæ˜¾ç¤ºå†…å­˜ä½¿ç”¨ä¿¡æ¯ã€‚ irq ï¼šæ˜¾ç¤ºä¸­æ–­çš„ä¿¡æ¯ã€‚ mod ï¼šæ˜¾ç¤ºæ¨¡å—ä¿¡æ¯ã€‚ runq ï¼šæ˜¾ç¤ºå¤„äºè¿è¡Œé˜Ÿåˆ—çš„è¿›ç¨‹ã€‚ struct ï¼šæ˜¾ç¤ºç»“æ„çš„å®šä¹‰ã€åœ°å€å’Œæ•°æ®ã€‚ 6. kernel-debuginfo #kernel-debuginfo æ˜¯æŒ‡å¸¦æœ‰ Debug information çš„å†…æ ¸ï¼Œå°±æ˜¯åœ¨ç¼–è¯‘å†…æ ¸æ˜¯æŒ‡å®š CONFIG_DEBUG_INFO ç­‰ç›¸å…³é€‰é¡¹ï¼Œåœ¨ menuconfig çš„è·¯å¾„æ˜¯ï¼š\nKernel hacking -\u0026gt; Kernel debugging -\u0026gt; Compile the kernel with debug info ä¸ Kdump åˆ†æç›¸å…³çš„é€‰é¡¹è¿˜æœ‰ï¼š\nkexec system call ï¼šCONFIG_KEXEC=y sysfs file system support ï¼š CONFIG_SYSFS=y Compile the kernel with debug info ï¼š CONFIG_DEBUG_INFO=Y kernel crash dumps ï¼š CONFIG_CRASH_DUMP=y /proc/vmcore support ï¼š CONFIG_PROC_VMCORE=y ç¼–è¯‘æˆåŠŸåï¼Œå°±ä¼šåœ¨æºç ç›®å½•ä¸‹ç”Ÿæˆå¸¦æœ‰ debuginfo çš„å†…æ ¸é•œåƒ vmlinux ï¼Œkdump ã€crash ç­‰å†…æ ¸è°ƒè¯•æ–¹æ³•éƒ½ä¼šç”¨åˆ°å®ƒã€‚vmlinux æ˜¯ä¸€ä¸ªåŒ…å« Linux kernel çš„é™æ€é“¾æ¥çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼ŒELF æ ¼å¼ã€‚é€šå¸¸ /boot ç›®å½•ä¸‹å¯åŠ¨çš„å†…æ ¸æ˜¯ vmlinuz ï¼Œå®ƒæ˜¯ vmlinux ç»è¿‡ gzip å’Œ objcopy åˆ¶ä½œå‡ºæ¥çš„å‹ç¼©æ–‡ä»¶ã€‚vmlinuz æ˜¯ä¸€ç§ç»Ÿç§°ï¼Œæœ‰ä¸¤ç§å…·ä½“çš„è¡¨ç°å½¢å¼ zImage å’Œ bzImage ã€‚bzimage å’Œ zImage çš„åŒºåˆ«åœ¨äºæœ¬èº«çš„å¤§å°ï¼Œä»¥åŠåŠ è½½åˆ°å†…å­˜æ—¶çš„åœ°å€ä¸åŒï¼ŒzImageåœ¨ 0ï½640KBï¼Œè€ŒbzImage åˆ™åœ¨ 1M ä»¥ä¸Šçš„ä½ç½®ã€‚\nä¸åŒçš„ç¨‹åºæŸ¥æ‰¾è¿™ä¸ªå†…æ ¸çš„è·¯å¾„æ˜¯ä¸ä¸€æ ·çš„ï¼Œé€šå¸¸éœ€è¦åœ¨å¦‚ä¸‹è·¯å¾„å»ºç«‹è¿™ä¸ªå†…æ ¸çš„ç¬¦å·é“¾æ¥ï¼š\n/boot/vmlinux-`uname -r` /usr/lib/debug/lib/modules/`uname -r`/vmlinux /lib/modules/`uname -r`/vmlinux æœ‰äº›ç¨‹åºè¿˜éœ€è¦åœ¨ /lib/modules/ ç›®å½•ä¸‹å»ºç«‹å†…æ ¸æºç æ ‘å’Œæ„å»ºç›®å½•çš„ç¬¦å·é“¾æ¥ï¼š\n/lib/modules/`uname -r`/source /lib/modules/`uname -r`/build 7. NMI #NMI(non-maskable interrupt) å°±æ˜¯ä¸å¯å±è”½çš„ä¸­æ–­ï¼Œå½“ x86 å‘ç”Ÿäº†æ— æ³•æ¢å¤çš„ç¡¬ä»¶æ•…éšœåï¼Œä¼šè§¦å‘è¿™ä¸ªä¸­æ–­é€šçŸ¥æ“ä½œç³»ç»Ÿï¼Œå¦‚æœæ“ä½œç³»ç»Ÿé…ç½®äº† kdumpï¼Œè¿˜ä¼šè§¦å‘å´©æºƒè½¬å‚¨ã€‚æ ¹æ® Intel çš„è½¯ä»¶å¼€å‘è€…æ‰‹å†Œç¬¬ä¸‰å· 6.7 çš„æè¿°ï¼ŒNMI çš„æ¥æºæœ‰ä¸¤ä¸ªï¼š\nå¤–éƒ¨å¼•è„š NMI pinï¼Œå¤–éƒ¨è®¾å¤‡å¯ä»¥é€šè¿‡è¿™ä¸ªå¼•è„šè§¦å‘ NMI ï¼Œæœ‰äº›æœåŠ¡å™¨ç”šè‡³æä¾›äº† NMI è§¦å‘æŒ‰é’® å¤„ç†å™¨ç³»ç»Ÿæ€»çº¿æˆ–è€… APIC ä¸²è¡Œæ€»çº¿äº§ç”Ÿçš„ NMI æ¶ˆæ¯ï¼ˆåŒ…æ‹¬èŠ¯ç‰‡é”™è¯¯ã€å†…å­˜æ ¡éªŒé”™è¯¯ã€æ€»çº¿æ•°æ®æŸåç­‰ï¼‰ x86 åœ¨ IO ç«¯å£å¯„å­˜å™¨ 0x70 çš„ bit7 æä¾›äº† NMI_Enable ä½ï¼Œå¯ä»¥å¦‚ä¸‹ä»£ç ä½¿èƒ½ã€æˆ–è€…ç¦ç”¨ NMI ï¼š\nvoid NMI_enable(void) { outb(0x70, inb(0x70)\u0026amp;0x7F); } void NMI_disable(void) { outb(0x70, inb(0x70)|0x80); } Linux å†…æ ¸æä¾›äº†åä¸º NMI watchdog çš„æœºåˆ¶ï¼Œç”¨äºæ£€æµ‹ç³»ç»Ÿæ˜¯å¦å¤±å»å“åº”ï¼ˆä¹Ÿç§°ä¸º lockupï¼ŒåŒ…æ‹¬ soft lockup å’Œ hard lockupï¼‰ï¼ŒåŸç†æ˜¯å‘¨æœŸæ€§çš„äº§ç”Ÿ NMI ï¼Œç”± NMI handler å“åº”ä¸­æ–­å¹¶åˆ·æ–° hrtimer å®šæ—¶å™¨ï¼Œå¦‚æœä¸€æ®µæ—¶é—´å†…æ²¡æœ‰åˆ·æ–°ï¼Œå°±è¡¨ç¤ºç³»ç»Ÿå¤±å»äº†ç›¸åº”ï¼Œäºæ˜¯è°ƒç”¨ panicï¼Œè¶…æ—¶æ—¶é—´åœ¨å†…æ ¸é…ç½®é‡Œè®¾ç½®ï¼Œé»˜è®¤æ˜¯ 5 ç§’ã€‚ç›¸å…³ä»£ç åœ¨å†…æ ¸çš„ kernel/watchdog.c æ–‡ä»¶ä¸­ã€‚\nNMI watchdog ä¾èµ– APIC ï¼Œæ‰€æœ‰è¦å°† APIC ç¼–è¯‘è¿›å†…æ ¸ï¼Œå¯åŠ¨å‚æ•°ä¸­ä¹Ÿä¸è¦å…³é—­ APIC ã€‚ä¼ ç»Ÿçš„ x86 æ¶æ„é‡‡ç”¨ 8259A èŠ¯ç‰‡å¤„ç†ä¸­æ–­ï¼Œç°åœ¨çš„ x86 æ¶æ„éƒ½å¼•å…¥äº† APIC ã€‚å¯ä»¥æ‰§è¡Œ cat /proc/interrupts ï¼Œå¦‚æœè¾“å‡ºç»“æœä¸­åˆ—å‡ºäº† IO-APIC-* ï¼Œè¯´æ˜ç³»ç»Ÿæ­£åœ¨ä½¿ç”¨ APIC ï¼Œå¦‚æœçœ‹åˆ° XT-PIC ï¼Œè¯´æ˜ç³»ç»Ÿæ­£åœ¨ä½¿ç”¨ 8259A èŠ¯ç‰‡ã€‚\nNMI watchdog çš„å¼€å…³æ˜¯å†…æ ¸å¯åŠ¨å‚æ•° nmi_watchdog=[panic,]N ï¼Œä¹Ÿå¯ä»¥åœ¨ /etc/sysctl.conf ã€/etc/sysctl.d/* ç­‰é…ç½®æ–‡ä»¶ä¸­æ·»åŠ å†…æ ¸å‚æ•° kernel.nmi_watchdog=[panic,]N ã€‚å…¶ä¸­ panic å¯é€‰ï¼Œè¡¨ç¤º NMI watchdog è¶…æ—¶æ—¶äº§ç”Ÿ panic ï¼Œè¿›è€Œå¯ä»¥è§¦å‘ kdump ã€‚N å¯ä»¥å–å€¼ 0~2 ï¼Œ0 è¡¨ç¤ºç¦ç”¨ NMI watchdog ï¼Œå¦‚æœè¦å¯ç”¨ NMI watchdog ï¼Œåœ¨å…·æœ‰ IO-ACPI çš„ç³»ç»Ÿä¸­è®¾ä¸º 1 ï¼Œåœ¨æ²¡æœ‰ IO-ACPI çš„ç³»ç»Ÿä¸­è®¾ä¸º 2 ã€‚è®¾ç½®æˆåŠŸåï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹å†…æ ¸ä¿¡æ¯ï¼š\n$ dmesg | grep NMI ACPI: LAPIC_NMI (acpi_id[0xff] high edge lint[0x1]) NMI watchdog: enabled on all CPUs, permanently consumes one hw-PMU counter. ç„¶åå¯ä»¥çœ‹åˆ° NMI ä¸­æ–­è®¡æ•°ï¼š\n$ cat /proc/interrupts | grep NMI NMI: 449 207 197 179 Non-maskable interrupts å› ä¸º NMI æ˜¯ç¡¬ä»¶äº§ç”Ÿçš„ï¼Œæ‰€ä»¥åœ¨è™šæ‹Ÿæœºä¸Šæµ‹è¯•å¾ˆå¯èƒ½ä¼šå¤±è´¥ï¼Œå†…æ ¸ä¼šæŠ¥é”™è¯¯ä¿¡æ¯ : NMI watchdog: disable(cpu0): hardware events not enabled\næˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ªæ¨¡å—éªŒè¯ NMI watchdog èƒ½å¦æ­£å¸¸å·¥ä½œï¼Œå®ƒçš„åŸç†æ˜¯åœ¨åŠ è½½æ¨¡å—æ—¶ç¦ç”¨æ‰€æœ‰ä¸­æ–­ï¼Œè¿™æ · NMI handler å°±ä¸ä¼šå“åº”ï¼Œä¹Ÿä¸ä¼šåˆ·æ–°å®šæ—¶å™¨ï¼Œç›´åˆ°è¶…æ—¶ï¼š\n#include \u0026lt;linux/init.h\u0026gt; #include \u0026lt;linux/module.h\u0026gt; #include \u0026lt;linux/interrupt.h\u0026gt; static int __init nmitest_init(void) { printk(\u0026quot;nmitest init\\n\u0026quot;); local_irq_disable(); while(1); return 0; } static void __exit nmitest_exit(void) { printk(\u0026quot;nmitest exit\\n\u0026quot;); } module_init(nmitest_init); module_exit(nmitest_exit); MODULE_LICENSE(\u0026quot;GPL\u0026quot;); ç³»ç»Ÿè¿è¡Œè¿‡ç¨‹ä¸­è¦ç¦ç”¨ NMI watchdog ï¼Œå¯ä»¥å°† /proc/sys/kernel/nmi_watchdog è®¾ä¸º 0 ã€‚\n8. Soft lockup å’Œ Hard lockup #","date":"2018 July 5","permalink":"/posts/2018/07/05/","section":"Posts","summary":"åŸºäº Ubuntu 14.","title":"Linux å†…æ ¸è°ƒè¯•æ–¹æ³•"},{"content":"0. ç®€ä»‹ #systemd æ˜¯ freedesktop çš„é¡¹ç›®ï¼Œå®˜ç½‘ https://www.freedesktop.org/wiki/Software/systemd/ ,é¡¹ç›®æºç åœ¨ github ä¸Šå‘å¸ƒï¼Œå¯ä»¥åœ¨ https://github.com/systemd/systemd æŸ¥çœ‹æ‰€æœ‰ç‰ˆæœ¬æ›´æ–°ã€ Bug Fix å’Œç‰ˆæœ¬å¯¹åº”çš„æ–‡æ¡£ç­‰ã€‚\nsystemd-networkd æ˜¯ systemd é»˜è®¤æä¾›çš„ç½‘ç»œç®¡ç†æœåŠ¡ï¼Œå¯ä»¥å®Œå…¨ç®¡ç†ä»¥å¤ªç½‘ï¼Œå¯¹äºæ— çº¿ç½‘å¡ï¼Œè¿˜éœ€è¦å…¶ä»–æœåŠ¡æ”¯æŒï¼Œæ¯”å¦‚ç®¡ç† Wi-Fi çš„ wpa_supplicant@.service ï¼Œç®¡ç† PPP çš„ ppp@.service ã€‚\nç®¡ç†ç½‘å¡å‰ï¼Œåº”è¯¥ç¡®ä¿å„ç½‘å¡çš„é©±åŠ¨éƒ½å·²ç»æ­£å¸¸åŠ è½½ï¼Œsystemd çš„ systemd-modules-load.service è´Ÿè´£åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶é™æ€åŠ è½½å†…æ ¸æ¨¡å—ã€‚å®ƒä¼šä»ä»¥ä¸‹è·¯å¾„æœç´¢å¯ç”¨çš„é…ç½®æ–‡ä»¶ï¼š\n/etc/modules-load.d/*.conf /run/modules-load.d/*.conf /usr/lib/modules-load.d/*.conf é…ç½®æ–‡ä»¶çš„å†…å®¹å°±æ˜¯ä¸€ä¸ªå†…æ ¸æ¨¡å—åç§°çš„åˆ—è¡¨ï¼Œå¯ä»¥ç”¨äº•å· # æˆ–è€…åˆ†å· ; æ³¨é‡Šå•ä¸ªæ¨¡å—ã€‚\n1. åŸºæœ¬é…ç½® #æˆ‘çš„ç³»ç»Ÿä¸­ï¼Œsystemd çš„ç‰ˆæœ¬æ˜¯ 216 ï¼Œæœ‰ä¸¤ä¸ªä»¥å¤ªç½‘å¡å’Œä¸€ä¸ª Wi-Fi ç½‘å¡ï¼Œå…ˆæŸ¥çœ‹ä¸€ä¸‹ç½‘å¡åˆ—è¡¨ï¼Œå†æŸ¥çœ‹ systemd-networkd.service çš„çŠ¶æ€ï¼š\n~# networkctl list IDX LINK TYPE OPERATIONAL SETUP 1 lo loopback carrier unmanaged 2 wlp1s0 wlan off unmanaged 3 enp0s20f6 ether routable configured 4 enp0s20f7 ether no-carrier configured 4 links listed. ~# systemctl status systemd-networkd aâ€”? systemd-networkd.service - Network Service Loaded: loaded (/lib/systemd/system/systemd-networkd.service; enabled) Active: active (running) since Fri 2018-04-27 17:49:22 UTC; 24min ago Docs: man:systemd-networkd.service(8) Main PID: 260 (systemd-network) Status: \u0026quot;Processing requests...\u0026quot; CGroup: /system.slice/systemd-networkd.service aâ€â€aâ€â‚¬260 /lib/systemd/systemd-networkd Apr 27 17:49:21 quark systemd[1]: Starting Network Service... Apr 27 17:49:22 quark systemd-networkd[260]: lo : gained carrier Apr 27 17:49:22 quark systemd[1]: Started Network Service. Apr 27 17:49:22 quark systemd-networkd[260]: eth1 : renamed to enp0s20f7 Apr 27 17:49:22 quark systemd-networkd[260]: eth0 : renamed to enp0s20f6 Apr 27 17:49:23 quark systemd-networkd[260]: enp0s20f6 : gained carrier Apr 27 17:49:23 quark systemd-networkd[260]: enp0s20f7 : gained carrier Apr 27 17:49:25 quark systemd-networkd[260]: enp0s20f6 : lost carrier Apr 27 17:49:26 quark systemd-networkd[260]: enp0s20f7 : lost carrier sytemd-network.service çš„é…ç½®æ–‡ä»¶å¯ä»¥ä½äº /usr/lib/systemd/network/ æˆ–è€… /etc/systemd/network/ ç›®å½•ä¸‹ï¼Œåè€…å…·æœ‰æœ€é«˜ä¼˜å…ˆçº§ã€‚é…ç½®æ–‡ä»¶æœ‰ä¸‰ç§ç±»å‹ï¼š\n.network æ–‡ä»¶ï¼Œè®¾ç½®ç½‘å¡çš„ IP ç­‰å„é¡¹å±æ€§ .netdev æ–‡ä»¶ï¼Œæ–°å»ºä¸€ä¸ªè™šæ‹Ÿç½‘å¡ .link æ–‡ä»¶ï¼Œæ¯å½“ä¸€ä¸ªç½‘å¡å‡ºç°æ—¶ï¼Œudev éƒ½ä¼šæŸ¥æ‰¾ä¸å®ƒåŒåçš„ .link æ–‡ä»¶ è¿™å‡ ç±»æ–‡ä»¶éƒ½éµå¾ªä¸‹é¢çš„è§„åˆ™ï¼š\nå„é€‰é¡¹çš„å€¼éƒ½æ”¯æŒæ˜Ÿå· * é€šé…ç¬¦ å½“ [Match] æ®µå†…çš„æ¡ä»¶éƒ½åŒ¹é…æ—¶ï¼Œåé¢çš„é…ç½®é¡¹æ‰ä¼šè¢«æ¿€æ´» å¦‚æœ [Match] æ®µä¸ºç©ºï¼Œè¡¨ç¤ºåé¢çš„é…ç½®é¡¹åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½å¯ç”¨ æ— è®ºé…ç½®æ–‡ä»¶åœ¨å“ªä¸ªç›®å½•ï¼Œéƒ½ä¼šç»Ÿä¸€å®‰è£…å­—å…¸é¡ºåºè¿›è¡ŒåŠ è½½ åŒåæ–‡ä»¶å¯ä»¥ç›¸äº’æ›¿æ¢ å¦‚æœè¦ç»™ enp0s20f6 é…ç½®ä¸€ä¸ªé™æ€ IP ï¼Œå¯ä»¥åœ¨ /etc/systemd/network/ ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª eth0.network æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\n[Match] Name=enp0s20f6 # åŒ¹é…åä¸º enp0s20f6 çš„ç½‘å¡ [Network] DHCP=none # å…³é—­ DHCP å®¢æˆ·ç«¯ï¼Œ Address=192.168.5.242/24 # è®¾ç½® IP å’Œå­ç½‘æ©ç  Gateway=192.168.5.50 # è®¾ç½®ç½‘å…³ï¼Œè¿™é¡¹è®¾ç½®ä¼šå°†è¯¥ç½‘å¡æ·»åŠ åˆ°ç¼ºçœè·¯ç”± DNS=8.8.8.8 # è®¾ç½® DNS å¦‚æœè¦ä½¿ç”¨ DHCP è‡ªåŠ¨è·å– IP ï¼Œä¹Ÿå°† DHCP è®¾ä¸ºå¦‚ä¸‹å€¼ï¼š\nv4 ï¼Œåªæ¥å— ipv4 çš„ IP v6 ï¼Œåªæ¥å— ipv6 çš„ IP both ï¼ŒåŒæ—¶æ¥å— ipv4 å’Œ ipv6 æ ¼å¼çš„ IP å¯åŠ¨ DHCP å®¢æˆ·ç«¯åï¼ŒGateway å’Œ DNS ä¹Ÿä¼šè‡ªåŠ¨è·å–ï¼Œæœ‰æ—¶æˆ‘ä»¬ä¸å¸Œæœ›è¿™æ ·ï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ª [DHCP] æ®µï¼Œåšå¦‚ä¸‹è®¾ç½®ï¼š\n[DHCP] UseDNS=false # ä¸ä½¿ç”¨ DHCP åˆ†é…çš„ DNS ï¼Œé»˜è®¤å€¼æ˜¯ true UseRoutes=false # ä¸ä¼šå°†æœ¬ç½‘å¡è®¾ä¸ºç¼ºçœè·¯ç”±ï¼Œé»˜è®¤å€¼æ˜¯ true åœ¨è¿™é‡Œä¼šå‡ºç°ä¸€ä¸ª Bug ï¼Œå°±æ˜¯ UseRoutes è®¾ç½®æ— æ•ˆï¼Œé«˜ç‰ˆæœ¬ä¸­å·²ç»è§£å†³ï¼Œè§£å†³æ–¹æ¡ˆåœ¨ https://github.com/systemd/systemd/pull/3075 ã€‚\n2. Wi-Fi é…ç½® #Wi-Fi è¿æ¥è¿˜æ˜¯ä½¿ç”¨ wpa_supplicant ç¨‹åºï¼Œsystemd æä¾›äº† wpa_supplicant@.service ç®¡ç†æ•´ä¸ªæµç¨‹ï¼Œç„¶åå†ç”¨ systemd-networkd.service é…ç½® IP ç­‰ã€‚\nwpa_supplicant@.service çš„å†…å®¹ï¼š\n[Unit] Description=WPA supplicant daemon (interface-specific version) Requires=sys-subsystem-net-devices-%i.device After=sys-subsystem-net-devices-%i.device # NetworkManager users will probably want the dbus version instead. [Service] Type=simple ExecStart=/usr/sbin/wpa_supplicant -c/etc/wpa_supplicant/wpa_supplicant-%I.conf -i%I [Install] Alias=multi-user.target.wants/wpa_supplicant@%i.service è¿™æ˜¯ service æ¨¡æ¿ï¼Œå¯åŠ¨æ—¶åœ¨ @ ç¬¦å·ä¹‹ååŠ å…¥ Wi-Fi ç½‘å¡çš„åç§°ä½¿å…¶å®ä¾‹å®ä¾‹åŒ–ï¼Œè¿™ä¸ªåè¯è¿˜ä¼šå…³è”åˆ° wpa_supplicant çš„é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬å…ˆåœ¨ /etc/ ä¸‹æ–°å»ºä¸€ä¸ª wpa_supplicant ç›®å½•ï¼Œç„¶åæ–°å»ºä¸€ä¸ª wpa_supplicant-wlp1s0.conf æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\nctrl_interface=/var/run/wpa_supplicant ctrl_interface_group=wheel update_config=1 eapol_version=1 ap_scan=1 fast_reauth=1 ç”¨ wpa_passphrase æ·»åŠ æ— çº¿è·¯ç”±å™¨é…ç½®ï¼š\n~# sudo wpa_passphrase [essid] [password] \u0026gt;\u0026gt; /etc/wpa_supplicant/wpa_supplicant-wlp1s0.conf åœ¨ /etc/systemd/network/ ç›®å½•ä¸‹æ·»åŠ é…ç½®æ–‡ä»¶ wireless.network ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\n[Match] Name=wlp1s0 [Network] DHCP=yes æœ€åé‡å¯å„é¡¹æœåŠ¡ï¼š\n~# systemctl restart systemd-networkd ~# systemctl restart wpa_supplicant@wlp1s0 ~# systemctl restart systemd-resolved 3. 3G/4G é…ç½® #ä¾ç„¶ä½¿ç”¨ pppd è¿›è¡Œ 3G/4G æ‹¨å·ï¼Œsystemd æä¾›äº† ppp@.service æœåŠ¡ç®¡ç† pppd ã€‚é¦–å…ˆåœ¨ /etc/ppp/peers/ ä¸‹å»ºå¥½ ppp æ‹¨å·æ–‡ä»¶ me909s ï¼Œç„¶åå¯åŠ¨æœåŠ¡ï¼š\n~# systemctl start ppp@me909s 4. å…³é—­ IPv6 #å‘å†…æ ¸å‚æ•°åŠ å…¥ ipv6.disable=1 å¯ä»¥å®Œå…¨å…³é—­ IPv6 åŠŸèƒ½ã€‚æ­¤å¤–ï¼ŒåªåŠ å…¥ ipv6.disable_ipv6=1 å†…æ ¸å‚æ•°å¯ä»¥ä¿ç•™ IPv6 åŠŸèƒ½ï¼Œä½†ä¸ä¼šå‘ç½‘å¡åˆ†é… IPv6 åœ°å€ï¼Œåšæ³•æ˜¯ï¼š\n~# echo 1 \u0026gt; /proc/sys/net/ipv6/conf/enp0s20f6/disable_ipv6 5. ssh server #ç›®å‰æµè¡Œçš„å¯åŠ¨ ssh server çš„æ–¹å¼æ˜¯è°ƒç”¨ sshd.socket ï¼š\n~# systemctl start sshd.socket æ—§æœ‰çš„ sshd.service æ¨¡å¼ä¼šåœ¨åå°ä¿æŒä¸€ä¸ª sshd çš„å®ˆæŠ¤è¿›ç¨‹ï¼Œæ¯å½“æœ‰ ssh è¿æ¥è¦å»ºç«‹æ—¶ï¼Œå°±åˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹ï¼Œæ¯”è¾ƒé€‚åˆ SSH ä¸‹æœ‰å¤§é‡æµé‡çš„ç³»ç»Ÿï¼›\næ–°çš„ sshd.socket æ–¹å¼ä¹Ÿæ˜¯åœ¨æ¯æ¬¡è¦å»ºç«‹æ–°çš„sshè¿æ¥æ—¶ç”Ÿæˆä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹çš„å®ä¾‹ï¼Œä¸è¿‡ç›‘å¬ç«¯å£åˆ™æ˜¯äº¤ç»™äº† systemd æ¥å®Œæˆï¼Œæ„å‘³ç€æ²¡æœ‰ ssh è¿æ¥çš„æ—¶å€™ï¼Œä¹Ÿä¸ä¼šæœ‰ sshd å®ˆæŠ¤è¿›ç¨‹è¿è¡Œï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œä½¿ç”¨ sshd.socket æœåŠ¡æ›´ä¸ºåˆé€‚ã€‚è¿™ä¹Ÿä¸ MacOS ä¸‹çš„è¡Œä¸ºç›¸ä¸€è‡´ï¼Œé»˜è®¤åªç›‘å¬ç«¯å£ï¼Œæœ‰è¿æ¥æ—¶æ‰åˆ›å»ºè¿›ç¨‹ã€‚\nå¦å¤–ï¼Œé€šè¿‡ä½¿ç”¨ .socket æ–‡ä»¶æ¥ç®¡ç†éœ€è¦ç›‘å¬ç«¯å£çš„æœåŠ¡ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡ systemctl æ¥æŸ¥çœ‹ä¸€äº›ç½‘ç»œç›¸å…³çš„ä¿¡æ¯ï¼Œå¦‚ç›‘å¬çš„ç«¯å£ã€ç›®å‰å·²ç»æ¥å—çš„è¿æ¥æ•°ã€ç›®å‰æ­£è¿æ¥çš„è¿æ¥æ•°ç­‰ã€‚\nå‚è€ƒ # How to use systemd-networkd to manage your wifi Systemd-network ","date":"2018 May 9","permalink":"/posts/2018/05/09/","section":"Posts","summary":"0. ç®€ä»‹ #systemd æ˜¯ freedesktop çš„é¡¹ç›®ï¼Œå®˜ç½‘ https://www.","title":"systemd çš„ç½‘ç»œç®¡ç†"},{"content":"0. Quick Start #æ„å»ºä¸€ä¸ª yocto ç³»ç»Ÿé•œåƒçš„åŸºæœ¬æµç¨‹å¦‚ä¸‹ï¼š\nå‡†å¤‡å®¿ä¸»æœºç³»ç»Ÿï¼Œå®‰è£…å¿…è¦çš„å¼€å‘å·¥å…·ã€‚ åˆå§‹åŒ–æ„å»ºç¯å¢ƒï¼Œé€šå¸¸æ˜¯åˆ©ç”¨ oe-init-build-env è„šæœ¬ï¼Œé»˜è®¤ä¼šæ–°å»ºä¸€ä¸ªæ„å»ºç›®å½• build ã€‚ ç¼–è¾‘ build/conf/local.conf æ–‡ä»¶ï¼Œç¡®è®¤ MACHINE å˜é‡ï¼Œä¸º å¼€å§‹æ„å»ºç³»ç»Ÿé•œåƒï¼Œæœ€ç»ˆçš„é•œåƒæ–‡ä»¶ä¼šç”Ÿæˆåœ¨ build/tmp/deploy/images/ ç›®å½•ä¸‹ã€‚ å…ˆåœ¨å®¿ä¸»æœºå®‰è£… Ubuntu Server 18.04 ï¼Œè‡³å°‘é¢„ç•™ 50GB ç¡¬ç›˜ç©ºé—´ï¼Œæ¨è 100GB ï¼Œç„¶åå®‰è£…å¦‚ä¸‹è½¯ä»¶åŒ…ï¼š\n$ sudo apt-get install gawk wget git-core diffstat unzip texinfo gcc-multilib build-essential chrpath socat cpio python python3 python3-pip python3-pexpect xz-utils debianutils iputils-ping libsdl1.2-dev xterm ç”¨ git å…‹éš†ä¸€ä»½ yocto æºç ï¼š\n$ git clone git://git.yoctoproject.org/poky Cloning into 'poky'... remote: Counting objects: 367178, done. remote: Compressing objects: 100% (88161/88161), done. remote: Total 367178 (delta 272761), reused 366942 (delta 272525) Receiving objects: 100% (367178/367178), 133.26 MiB | 6.40 MiB/s, done. Resolving deltas: 100% (272761/272761), done. Checking connectivity... done. $ cd poky/ $ git status On branch master Your branch is up to date with 'origin/master'. nothing to commit, working tree clean $ git branch -a * master remotes/origin/1.1_M1 remotes/origin/1.1_M2 ... remotes/origin/1.6_M5 remotes/origin/HEAD -\u0026gt; origin/master remotes/origin/bernard ... remotes/origin/rocko remotes/origin/rocko-next remotes/origin/sumo remotes/origin/sumo-next å…‹éš†åˆ°æœ¬åœ°çš„ä»“åº“å¤„äº master åˆ†æ”¯ï¼Œåœ¨è¿™é‡Œå¯ä»¥çœ‹åˆ° yocto çš„ç‰ˆæœ¬å‘è¡Œè®°å½•ï¼Œæˆ‘ä»¬åº”è¯¥æ£€å‡ºå½“å‰çš„ç‰ˆæœ¬ 2.4.2(Rocko) ï¼š\n$ git checkout -b rocko origin/rocko Branch 'rocko' set up to track remote branch 'rocko' from 'origin'. Switched to a new branch 'rocko' $ git branch master * rocko æ¯ä¸ªåˆ†æ”¯å†…åˆæœ‰å¾ˆå¤š tags ï¼Œå…ˆæŸ¥çœ‹å½“å‰çš„ç‰ˆæœ¬å’Œ tag ä¿¡æ¯:\n$ git describe rocko-18.0.2-105-g701cc0009f $ git show rocko-18.0.2 tag rocko-18.0.2 Tagger: Tracy Graydon \u0026lt;tracy.graydon@intel.com\u0026gt; Date: Mon Mar 12 14:51:03 2018 -0700 Tagging for yocto-2.4.2 ... ... commit 342fbd6a3e57021c8e28b124b3adb241936f3d9d (tag: yocto-2.4.2, tag: rocko-18.0.2) Author: Anuj Mittal \u0026lt;anuj.mittal@intel.com\u0026gt; Date: Tue Feb 20 08:33:45 2018 +0800 å¯ä»¥çœ‹åˆ°ï¼Œå½“å‰ç‰ˆæœ¬å·²ç»æ˜¯ tag rocko-18.0.2 ä¹‹åçš„ç¬¬ 105 æ¬¡ commit ï¼Œå¯ä»¥é€‰æ‹©å°†ç‰ˆæœ¬å›é€€åˆ°ä¸€ä¸ªç‰¹å®šçš„ tag ã€‚ç„¶ååˆå§‹åŒ–ç¼–è¯‘ç¯å¢ƒï¼š\n$ source oe-init-build-env build ä»¥åæ‰€æœ‰ç¼–è¯‘ç”Ÿæˆçš„æ–‡ä»¶éƒ½ä½äº build ç›®å½•ä¸‹ï¼Œç„¶åå¼€å§‹ç¼–è¯‘ï¼š\n$ bitbake core-image-sato é»˜è®¤ä¼šæ„å»ºå‡ºä¸€ä¸ªåŸºäº qemu çš„ç³»ç»Ÿé•œåƒã€‚\n","date":"2018 April 27","permalink":"/posts/2018/04/27/","section":"Posts","summary":"0. Quick Start #æ„å»ºä¸€ä¸ª yocto ç³»ç»Ÿé•œåƒçš„åŸºæœ¬æµç¨‹å¦‚ä¸‹ï¼š","title":"Yocto å­¦ä¹ ç¬”è®°"},{"content":"0. ç®€ä»‹ #libpcap æ˜¯ç”¨äºæ•è· TCP/IP ç½‘ç»œæ•°æ®åŒ…çš„ C/C++ åº“ï¼Œæ”¯æŒ Linux ç³»ç»Ÿï¼ŒTcpdump å°±æ˜¯åœ¨å…¶åŸºç¡€ä¸Šå¼€å‘çš„ï¼Œé€šå¸¸ç”¨äºç½‘ç»œå—…æ¢ã€æ•°æ®æŠ“å–ã€åè®®åˆ†æç­‰ï¼Œå®˜ç½‘æ˜¯ http://www.tcpdump.org ï¼Œä¸»è¦çš„åŠŸèƒ½æœ‰ï¼š\næ•°æ®åŒ…æ•è·ï¼šæ•è·æµç»ç½‘å¡çš„åŸå§‹æ•°æ®åŒ… è§„åˆ™è¿‡æ»¤ï¼šæä¾›è‡ªå¸¦è§„åˆ™è¿‡æ»¤åŠŸèƒ½ï¼ŒæŒ‰éœ€è¦é€‰æ‹©è¿‡æ»¤è§„åˆ™ æµé‡é‡‡é›†ä¸ç»Ÿè®¡ï¼šé‡‡é›†ç½‘ç»œä¸­çš„æµé‡ä¿¡æ¯ è‡ªå®šä¹‰æ•°æ®åŒ…å‘é€ï¼šæ„é€ ä»»ä½•æ ¼å¼çš„åŸå§‹æ•°æ®åŒ… åŒ…æ•è·æœºåˆ¶æ˜¯åœ¨æ•°æ®é“¾è·¯å±‚å¢åŠ ä¸€ä¸ªæ—è·¯å¤„ç†ï¼Œå¹¶ä¸å¹²æ‰°ç³»ç»Ÿè‡ªèº«çš„ç½‘ç»œåè®®æ ˆçš„å¤„ç†ï¼Œå¯¹å‘é€å’Œæ¥æ”¶çš„æ•°æ®åŒ…é€šè¿‡ Linux å†…æ ¸åšè¿‡æ»¤å’Œç¼“å†²å¤„ç†ï¼Œæœ€åç›´æ¥ä¼ é€’ç»™ä¸Šå±‚åº”ç”¨ç¨‹åºã€‚åœ¨ Linux å‘è¡Œç‰ˆä¸Šå¯ä»¥ç›´æ¥å®‰è£… libpcap æˆ–è€…å¼€å‘åº“ libpcap-devel ï¼Œä¹Ÿå¯ä»¥ä¸‹è½½æºç åç¼–è¯‘å®‰è£…ã€‚\n1. ç¼–ç¨‹ #è°ƒç”¨ libpcap åº“å‡½æ•°å‰è¦åŒ…å«çš„å¤´æ–‡ä»¶ï¼š\n#include \u0026lt;pcap/pcap.h\u0026gt; è°ƒç”¨ libpcap åº“æŠ“åŒ…çš„æµç¨‹ï¼š\næŸ¥æ‰¾ç½‘å¡ï¼Œç›®çš„æ˜¯å‘ç°å¯ç”¨çš„ç½‘å¡ï¼Œå®ç°çš„å‡½æ•°ä¸º pcap_lookupdev() ã€‚ è·å¾—ç½‘å¡å‚æ•°ï¼Œè¿™é‡Œæ˜¯åˆ©ç”¨ pcap_lookupnet() å‡½æ•°ï¼Œè·å¾—æŒ‡å®šç½‘å¡çš„ IP åœ°å€å’Œå­ç½‘æ©ç ã€‚ æ‰“å¼€ç½‘å¡ï¼Œåˆ©ç”¨ç¬¬ä¸€æ­¥çš„è¿”å›å€¼ï¼Œå†³å®šä½¿ç”¨å“ªä¸ªç½‘å¡ï¼Œè°ƒç”¨ pcap_open_live() å°†å…¶æ‰“å¼€ã€‚ ç¼–è¯‘è¿‡æ»¤ç­–ç•¥ï¼ŒLipcap çš„é‡è¦åŠŸèƒ½å°±æ˜¯æä¾›æ•°æ®åŒ…çš„è¿‡æ»¤ï¼Œå®ç°çš„å‡½æ•°æ˜¯ pcap_compile() ã€‚ è®¾ç½®è¿‡æ»¤å™¨ï¼Œè°ƒç”¨ pcap_setfilter() å‡½æ•°å°†ç¼–è¯‘å¥½çš„è¿‡æ»¤ç­–ç•¥è®¾ç½®åˆ°ç›¸åº”ç½‘å¡ã€‚ å¼€å§‹æ•è·æ•°æ®åŒ…ï¼Œæœ‰å¤šç§å®ç°å‡½æ•°ï¼Œå…·æœ‰ä¸åŒçš„ç‰¹æ€§ã€‚ å…³é—­ç½‘å¡ï¼Œé‡Šæ”¾èµ„æºã€‚ å¦‚æœæ˜¯ç”¨æºç åŒ…ç¼–è¯‘å®‰è£…çš„è¯ï¼Œåœ¨ tests ç›®å½•ä¸‹æœ‰å‡ ä¸ªä¾‹ç¨‹å¯ä»¥å‚è€ƒã€‚\n1.1. æŸ¥æ‰¾ç½‘å¡ #char errbuf[PCAP_ERRBUF_SIZE]; int pcap_findalldevs(pcap_if_t **alldevsp, char *errbuf); void pcap_freealldevs(pcap_if_t *alldevs); pcap_freealldevs() å‡½æ•°å¯ä»¥æœç´¢å½“å‰ç³»ç»Ÿä¸­çš„ç½‘å¡ï¼Œå¹¶æ„é€ ä¸€ä¸ªç½‘å¡è®¾å¤‡é“¾è¡¨ã€‚å¦‚æœè°ƒç”¨æˆåŠŸï¼Œå‡½æ•°è¿”å› 0 ï¼ŒæŒ‡é’ˆ alldevsp ä¼šæŒ‡å‘åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼›å¦åˆ™è¿”å› -1 ï¼ŒæŒ‡é’ˆä¸º NULL ï¼Œå¹¶åœ¨ errbuf ä¸­å­˜æ”¾é”™è¯¯ä¿¡æ¯ï¼Œerrbuf è‡³å°‘åº”è¯¥æ˜¯ PCAP_ERRBUF_SIZE ä¸ªå­—èŠ‚é•¿åº¦çš„ã€‚é“¾è¡¨ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ pcap_if_t ç±»å‹ï¼š\nstruct pcap_if { struct pcap_if *next; char *name; /* ç½‘å¡è®¾å¤‡åç§°ï¼Œå¯ä»¥è°ƒç”¨ \u0026quot;pcap_open_live()\u0026quot; æ‰“å¼€*/ char *description; /* ç½‘å¡è®¾å¤‡æè¿°, å¯ä»¥ä¸º NULL */ struct pcap_addr *addresses; bpf_u_int32 flags; /* PCAP_IF_ interface flags */ }; typedef struct pcap_if pcap_if_t; addresses æ˜¯ struct pcap_addr ç±»å‹çš„æŒ‡é’ˆï¼ŒåŒ…å«äº† IP ã€æ©ç ç­‰ç½‘å¡ä¿¡æ¯ï¼š\nstruct pcap_addr { struct pcap_addr *next; struct sockaddr *addr; /* address */ struct sockaddr *netmask; /* netmask for that address */ struct sockaddr *broadaddr; /* broadcast address for that address */ struct sockaddr *dstaddr; /* P2P destination address for that address */ }; typedef struct pcap_addr pcap_addr_t; bpf_u_int32 flags æ˜¯è®¾ç½®ç½‘å¡çŠ¶æ€å±æ€§çš„å˜é‡ï¼Œå¯é€‰å€¼æœ‰ï¼š\nPCAP_IF_LOOPBACK ï¼ŒæŠŠç½‘å¡è®¾ä¸º loopback æ¥å£ PCAP_IF_UP ï¼Œç½‘å¡çŠ¶æ€è®¾ä¸º UP PCAP_IF_RUNNING ï¼Œç½‘å¡çŠ¶æ€è®¾ä¸º running ä½¿ç”¨å®Œæˆåï¼Œè°ƒç”¨å¦‚ä¸‹å‡½æ•°é‡Šæ”¾è®¾å¤‡é“¾è¡¨ï¼š\nvoid pcap_freealldevs(pcap_if_t *alldevs); ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;pcap/pcap.h\u0026gt; int main() { int ret = 0; int i = 0; char errbuf[PCAP_ERRBUF_SIZE] = \u0026quot;\\0\u0026quot;; pcap_if_t *devsp = NULL; pcap_if_t *temp = NULL; printf(\u0026quot;start libpcap\\n\u0026quot;); ret = pcap_findalldevs(\u0026amp;devsp, errbuf); if(ret==0 \u0026amp;\u0026amp; devsp) { for(temp=devsp;temp;temp=temp-\u0026gt;next) { printf(\u0026quot;%d : interface name %s\\n\u0026quot;,i++,temp-\u0026gt;name); } } else { printf(\u0026quot;pcap_findalldevs error : %s\\n\u0026quot;, errbuf); } return 0; } ç¼–è¯‘ï¼š\n$ gcc -Wall test.c -o test -lpcap æ‰§è¡Œï¼š\n$ ./test start libpcap 0 : interface name eth0 1 : interface name any 2 : interface name lo 3 : interface name nflog 4 : interface name nfqueue 5 : interface name usbmon1 1.2. æ‰“å¼€ç½‘å¡ #è·å¾—äº†ç½‘å¡åç§°åï¼Œå°±å¯ä»¥è°ƒç”¨ç›¸å…³å‡½æ•°æŠŠå®ƒæ‰“å¼€ï¼š\npcap_t *pcap_open_live(const char *device, int snaplen, int promisc, int to_ms, char *errbuf); è¯¥å‡½æ•°çš„ä½œç”¨è·å¾—æŒ‡å®šç½‘å¡çš„æ“ä½œå¥æŸ„ï¼Œå¹¶è®¾ç½®å¥æŸ„çš„å„ç§å±æ€§ï¼Œåé¢çš„æŠ“åŒ…å‡½æ•°éƒ½æ˜¯ç›´æ¥æ“ä½œè¿™ä¸ªå¥æŸ„ã€‚å„å‚æ•°çš„å«ä¹‰ï¼š\ndevice æ˜¯ç½‘å¡åç§°çš„å­—ç¬¦ä¸² snaplen è¡¨ç¤ºå¯¹æ¯ä¸ªæ•°æ®åŒ…ï¼Œä»å¼€å¤´æŠ“å–å¤šå°‘ä¸ªå­—èŠ‚ï¼Œä»»ä½•ä¸€ä¸ªåè®®çš„ä¸€ä¸ªæ•°æ®åŒ…é•¿åº¦éƒ½å°äº 65536 å­—èŠ‚ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨è¿™ä¸ªå‚æ•°è®¾ç½®åªæŠ“å–å¤´éƒ¨ï¼Œè€Œä¸å…³ç³»å…·ä½“å†…å®¹ promise è®¾ä¸º 0 è¡¨ç¤ºå…³é—­æ··æ‚æ¨¡å¼ï¼Œ1 è¡¨ç¤ºæ‰“å¼€ï¼Œæ­¤æ—¶ç½‘å¡ä¹Ÿå¿…é¡»æ‰“å¼€æ··æ‚æ¨¡å¼ï¼Œä¾‹å¦‚ ifconfig eth0 promisc to_ms ç”¨äºè®¾ç½®æŸäº›æŠ“åŒ…å‡½æ•°çš„è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’ï¼Œ0 è¡¨ç¤ºä¸€ç›´ç­‰å¾… errbuf ç”¨äºå­˜æ”¾é”™è¯¯ä¿¡æ¯ è¯¥å‡½æ•°è°ƒç”¨æˆåŠŸæ—¶ä¼šè¿”å›ä¸€ä¸ª pcap_t ç±»å‹çš„æŒ‡é’ˆï¼Œå¤±è´¥åˆ™è¿”å› NULL ã€‚ä½¿ç”¨å®Œæ¯•åï¼Œåº”è¯¥è°ƒç”¨ä¸‹é¢çš„å‡½æ•°å°†å…¶å…³é—­ï¼š\nvoid pcap_close(pcap_t * p); å¦‚æœæƒ³è¦çŸ¥é“æŸä¸ªç½‘å¡çš„ç±»å‹ï¼Œå¯ä»¥è°ƒç”¨ pcap_datalink() ï¼Œå®ƒä¼šè¿”å›ç½‘å¡æ•°æ®é“¾è·¯ç±»å‹ï¼š\nint pcap_datalink(pcap_t *p); å®ƒçš„è¿”å›å€¼åˆ—è¡¨å¯ä»¥åœ¨ http://www.tcpdump.org/linktypes.html æŸ¥åˆ°ï¼Œå¸¸è§çš„æœ‰ï¼š\nLINKTYPE_ name value æè¿° LINKTYPE_ETHERNET 1 IEEE 802.3 ä»¥å¤ªç½‘ LINKTYPE_PPP 9 PPP, æè¿°åœ¨ RFC 1661 å’Œ RFC 1662 LINKTYPE_IEEE802_11 105 IEEE 802.11 æ— çº¿ 1.3. è·å–æ•°æ®åŒ… #libpcap æœ‰å¤šç§è·å–æ•°æ®åŒ…çš„æ–¹æ³•ï¼Œå¯ä»¥æ ¹æ®ä¸åŒçš„åº”ç”¨åœºæ™¯è¿›è¡Œé€‰æ‹©ã€‚\nconst u_char *pcap_next(pcap_t *p, struct pcap_pkthdr *h); pcap_next() åœ¨è·å–ä¸€ä¸ªæ•°æ®åŒ…åç«‹å³è¿”å›ï¼Œå¹¶å°†æ•°æ®åŒ…å­˜æ”¾åœ¨è¿”å›å€¼æŒ‡å‘çš„å†…å­˜ä¸­ï¼Œè¿™æ®µå†…å­˜å¯èƒ½éšæ—¶è¢«æ›´æ”¹æˆ–è€…é‡Šæ”¾ï¼Œæ‰€ä»¥ï¼Œå¦‚æœè¦å¯¹æ•°æ®åšè¿›ä¸€æ­¥å¤„ç†ï¼Œæœ€å¥½å…ˆæ‹·è´ä¸€ä»½ï¼Œè°ƒç”¨å¤±è´¥ä¼šè¿”å› NULL ã€‚è¿™ç§æ–¹å¼å¤„ç†æ•°æ®åŒ…çš„å†…å®¹å¹¶ä¸æ–¹ä¾¿ï¼Œæ‰€æœ‰æˆ‘ä»¬é€šå¸¸åªç”¨è¿™ä¸ªæ–¹æ³•ç»Ÿè®¡æ•°æ®é‡ï¼Œå‚æ•° struct pcap_pkthdr *h è®°å½•äº†æ•°æ®åŒ…çš„å…¶ä»–ä¿¡æ¯ï¼š\nstruct pcap_pkthdr { struct timeval ts; /* æ—¶é—´æˆ³ */ bpf_u_int32 caplen; /* æœ¬æ¬¡æ•è·çš„æ•°æ®é•¿åº¦ */ bpf_u_int32 len; /* è¿™ä¸ªæ•°æ®åŒ…çš„çœŸå®é•¿åº¦ */ }; å› ä¸ºä¸èƒ½ä¿è¯æ¯æ¬¡æ•è·çš„åŒ…æ˜¯å®Œæ•´çš„ï¼Œä¾‹å¦‚ä¸€ä¸ªåŒ…é•¿ 1480ï¼Œä½†æ˜¯æ•è·åˆ°1000çš„æ—¶å€™ï¼Œå¯èƒ½å› ä¸ºæŸäº›åŸå› å°±ä¸­æ­¢äº†ï¼Œæ‰€ä»¥caplen æ˜¯è®°å½•å®é™…æ•è·çš„é•¿åº¦ï¼Œä¹Ÿå°±æ˜¯ 1000ï¼Œè€Œ len å°±æ˜¯1480ã€‚\nå¦ä¸€ä¸ªé‡è¦çš„æ–¹æ³•æ˜¯ pcap_loop() ï¼š\nint pcap_loop(pcap_t * p, int cnt, pcap_handler callback, u_char * user); è¯¥å‡½æ•°ä¼šè¿ç»­æ•è· cnt ä¸ªæ•°æ®åŒ…åé€€å‡ºï¼Œå¦‚æœ cnt \u0026lt; 0 ï¼Œä¼šä¸€ç›´å¾ªç¯æŠ“åŒ…ï¼Œç›´åˆ°å‡ºç°é”™è¯¯æˆ–è€…è°ƒç”¨ pcap_breakloop() ã€‚åœ¨ä½ç‰ˆæœ¬ä¸­ï¼Œæ²¡æœ‰å®šä¹‰ cnt==0 æ—¶çš„æƒ…å†µï¼Œä¸åŒå¹³å°ä¸Šçš„ç‰¹æ€§æ— æ³•ç¡®å®šã€‚å‡½æ•°æ­£å¸¸é€€å‡ºæ—¶è¿”å› 0 ï¼Œå‡ºé”™è¿”å› -1 ï¼Œå¦‚æœæ˜¯è¢« pcap_breakloop() ä¸­æ–­çš„ä¼šè¿”å› -2 ã€‚æ¯å½“æ”¶åˆ°è¶³å¤Ÿçš„æ•°æ®åŒ…æ—¶ï¼Œpcap_loop() ä¼šè°ƒç”¨ callback å›è°ƒå‡½æ•°ï¼Œå¹¶å¯ä»¥é€šè¿‡ u_char * user å‘å›è°ƒå‡½æ•°ä¼ é€’å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å›è°ƒå‡½æ•°é‡Œå¤„ç†æ”¶åˆ°çš„æ•°æ®åŒ…ï¼š\ntypedef void (*pcap_handler)(u_char *user, const struct pcap_pkthdr *h, const u_char *bytes); æ•°æ®åŒ…å°±å­˜æ”¾åœ¨æŒ‡é’ˆå‚æ•° bytes æŒ‡å‘çš„å†…å­˜é‡Œï¼Œé•¿åº¦å¯ä»¥é€šè¿‡ç¬¬äºŒä¸ªå‚æ•° struct pcap_pkthdr *h è·å–ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;unistd.h\u0026gt; #include \u0026lt;time.h\u0026gt; #include \u0026lt;pcap.h\u0026gt; void get_packet(u_char * arg, const struct pcap_pkthdr * pkthdr, const u_char * packet) { int * id = (int *)arg; printf(\u0026quot;id: %d\\n\u0026quot;, ++(*id)); printf(\u0026quot;Packet length: %d\\n\u0026quot;, pkthdr-\u0026gt;len); printf(\u0026quot;Number of bytes: %d\\n\u0026quot;, pkthdr-\u0026gt;caplen); printf(\u0026quot;Recieved time: %s\\n\u0026quot;, ctime((const time_t *)\u0026amp;pkthdr-\u0026gt;ts.tv_sec)); //print packet int i; for(i=0; i\u0026lt;pkthdr-\u0026gt;len; ++i) { printf(\u0026quot; %02x\u0026quot;, packet[i]); if( (i + 1) % 16 == 0 ) printf(\u0026quot;\\n\u0026quot;); } printf(\u0026quot;\\n\\n\u0026quot;); } int main() { char dev[10]=\u0026quot;eth0\u0026quot;; char errbuf[1024]; int id = 0; pcap_t* device=pcap_open_live(dev,65535,1,0,errbuf); if(!device){ printf(\u0026quot;couldn't open the net device: %s\\n\u0026quot;,errbuf); return 1; } //capture the packet pcap_loop(device,-1,get_packet,(u_char*)\u0026amp;id); return 0; } å¦ä¸€ä¸ªæ–¹æ³• pcap_dispatch() ä¸ pcap_loop() éå¸¸ç›¸ä¼¼ï¼Œå‚æ•°å®Œå…¨ç›¸åŒï¼š\nint pcap_dispatch(pcap_t *p, int cnt, pcap_handler callback, u_char *user); ä¸åŒçš„æ˜¯ï¼Œè¿™ä¸ªå‡½æ•°æœ‰è¶…æ—¶è®¾å®šï¼Œè¶…æ—¶æ—¶é—´ç”± pcap_open_live() å‡½æ•°çš„ç¬¬å››ä¸ªå‚æ•° to_ms è®¾ç½®ï¼Œå¦‚æœè¶…è¿‡ to_ms æ¯«ç§’è¿˜æ²¡æœ‰æ”¶åˆ°æ•°æ®å°±ä¼šè¿”å›ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œè¿™ä¸ªå‡½æ•°çš„è¿”å›å€¼æ˜¯æ”¶åˆ°çš„æ•°æ®åŒ…ä¸ªæ•°ï¼Œæ²¡æ”¶åˆ°å°±è¿”å› 0 ï¼Œå‡ºé”™æ—¶è¿”å› -1 ï¼Œå¦‚æœæ˜¯è¢« pcap_breakloop() ä¸­æ–­çš„ä¼šè¿”å› -2 ã€‚æœ‰ä¸€ç‚¹è¦æ³¨æ„ï¼Œè¯¥å‡½æ•°è¿”å›åï¼Œå¦‚æœè¿˜è¦ç»§ç»­æŠ“åŒ…ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨ pcap_dispatch() ç»§ç»­æŠ“åŒ…ï¼Œé™¤éè°ƒç”¨å‡ºé”™ï¼Œå¦åˆ™ä¸è¦å…³é—­è®¾å¤‡ï¼Œé¢‘ç¹çš„æ‰“å¼€å…³é—­è®¾å¤‡å¯èƒ½å‡ºç°æ„æƒ³ä¸åˆ°çš„é”™è¯¯ã€‚å‚æ•° cnt è¡¨ç¤ºçš„æ˜¯æœ€å¤§å€¼ï¼Œå³æœ€å¤šæ”¶åˆ° cnt ä¸ªæ•°æ®åŒ…å°±è¿”å›ï¼Œå› ä¸ºä¸€æ¬¡åªè¯»å–ä¸€ä¸ªç¼“å†²åŒºå†…çš„æ•°æ®åŒ…ï¼Œå¯èƒ½ä¼šå¤„ç†å°‘äº cnt çš„æ•°æ®åŒ…ï¼Œå¦‚æœè®¾ä¸º -1 æˆ–è€… 0 ï¼Œè¡¨ç¤ºæ•è·ä¸€ä¸ªç¼“å†²åŒºå†…çš„æ‰€æœ‰æ•°æ®åŒ…ã€‚\nè¿™å‡ ä¸ªå‡½æ•°å‡ºé”™æ—¶ï¼Œå¯ä»¥ç”¨ pcap_geterr() è·å–é”™è¯¯ä¿¡æ¯ï¼š\nchar *pcap_geterr(pcap_t *p); è¿”å›å€¼æ˜¯æ‰§è¡Œé”™è¯¯ä¿¡æ¯å­—ç¬¦ä¸²çš„æŒ‡é’ˆï¼Œæœ€å¥½æ‹·è´ä¸€ä»½å†åšå¤„ç†ã€‚\n1.3. è¿‡æ»¤å™¨ #libpcap çš„è¿‡æ»¤å™¨æ˜¯åˆ©ç”¨ BPF æ¥ç­›é€‰ç½‘ç»œæ•°æ®åŒ…çš„ï¼Œå®ƒæ˜¯ç±» Unix ç³»ç»Ÿä¸Šæ•°æ®é“¾è·¯å±‚çš„ä¸€ç§åŸå§‹æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿‡æ»¤å™¨ä¸­è®¾ç½®è§„åˆ™ï¼Œè·å–æƒ³è¦çš„ç½‘ç»œæ•°æ®åŒ…ï¼Œæ¯”å¦‚åªè·å– UDP æ•°æ®åŒ…ï¼Œåªè·å–ç‰¹å®šåœ°å€çš„æ•°æ®åŒ…ç­‰ã€‚è¿‡æ»¤æ•°æ®åŒ…éœ€è¦å®Œæˆä¸‰ä»¶äº‹ï¼š\næ„é€ è¿‡æ»¤è¡¨è¾¾å¼ï¼Œè¿™æ˜¯ä¸€ä¸ªåŒ…å«ç­›é€‰è§„åˆ™çš„å­—ç¬¦ä¸² æŠŠè¿‡æ»¤è¡¨è¾¾å¼ç¼–è¯‘åˆ° BPF åº”ç”¨è¿‡æ»¤å™¨ è¿‡æ»¤è¡¨è¾¾å¼çš„è¯­æ³•æ¯”è¾ƒç®€å•ï¼Œä¸€ä¸ªè¿‡æ»¤è¡¨è¾¾å¼é€šå¸¸ç”±ä¸€ä¸ª id ï¼ˆåå­—æˆ–æ•°å­—ï¼‰å’Œå¤šä¸ªä¿®é¥°è¯ç»„æˆï¼Œä¿®é¥°è¯åˆ†ä¸ºä¸‰ç§ï¼š\ntype ï¼Œç”¨æ¥è¯´æ˜ id æ˜¯ä»€ä¹ˆç±»å‹ï¼Œå¯é€‰çš„ net ã€host å’Œ port åˆ†åˆ«è¡¨ç¤ºç½‘ç»œã€ä¸»æœºå’Œç«¯å£ï¼Œæ²¡æœ‰å£°æ˜æ—¶é»˜è®¤æ˜¯ host ï¼Œä¾‹å¦‚ net 192.168 , host 192.168.5.252 ï¼Œ port 22 ã€‚ dir ï¼Œè¡¨ç¤º id çš„ä¼ è¾“æ–¹å‘ï¼Œå¯é€‰ src ã€dst ç­‰ï¼Œé»˜è®¤æ˜¯ src or dst ï¼Œä¾‹å¦‚ dst port 22 è¡¨ç¤ºç›®çš„ç«¯å£æ˜¯ 22 ã€‚ proto ï¼Œé™å®šåŒ¹é…çš„åè®®ï¼Œæ¯”å¦‚é“¾è·¯å±‚åè®® ether ã€wlan ï¼Œç½‘ç»œå±‚åè®® ip ï¼Œä¼ è¾“å±‚åè®® tcp ã€udp ç­‰ã€‚ å¤šä¸ªè¡¨è¾¾å¼å¯ä»¥ç”¨ and ã€or ã€not è¿æ¥ï¼Œè¡¨ç¤ºé€»è¾‘ä¸ã€æˆ–ã€éã€‚ ä¸‹é¢æ˜¯ä¸€äº›å¸¸ç”¨çš„è¡¨è¾¾å¼ï¼Œæ›´å¤šç»†èŠ‚å¯ä»¥æŸ¥çœ‹ https://www.tcpdump.org/manpages/pcap-filter.7.html :\n#åªæ¥å—æºåœ°å€æ˜¯ 192.168.1.1 çš„æ•°æ®åŒ… src host 192.168.1.1 #åªæ¥å—ç›®çš„ç«¯å£æ˜¯ 8000 çš„æ•°æ®åŒ… dst port 8000 #åªæ¥å— UDP æ•°æ®åŒ… udp #ä¸æ¥å— TCP æ•°æ®åŒ… not tcp #åªæ¥å— ip çš„ ttl==5 çš„æ•°æ®åŒ…ï¼ˆip é¦–éƒ¨ç¬¬å…«ä¸ªå­—èŠ‚æ˜¯ ttlï¼‰ ip[8]==5 #æ¥å—æ¥è‡ª 192.168.5.252 ä¸»æœºï¼Œä¸”ç›®çš„ç«¯å£æ˜¯ 22 æˆ–è€… 23 çš„æ•°æ®åŒ… dst port 192.168.5.252 and (dst port 22 or dst port 23) æ„é€ å¥½è¿‡æ»¤è¡¨è¾¾å¼åï¼Œå°±å¯ä»¥è°ƒç”¨ pcap_compile() å‡½æ•°è¿›è¡Œç¼–è¯‘ï¼š\nint pcap_compile(pcap_t *p, struct bpf_program *fp, const char *str, int optimize, bpf_u_int32 netmask); fp æ˜¯ä¸€ä¸ªä¼ å‡ºå‚æ•°ï¼Œç”¨äºä¿å­˜ç¼–è¯‘åçš„ BPF ï¼Œstr å°±æ˜¯è¿‡æ»¤è¡¨è¾¾å¼ï¼Œoptimize è®¾ä¸º 1 è¡¨ç¤ºå¯¹è¿‡æ»¤è¡¨è¾¾å¼è¿›è¡Œä¼˜åŒ–ï¼Œnetmask è®¾ä¸º 0 å³å¯ã€‚ç¼–è¯‘æˆåŠŸè¿”å› 0 ï¼Œå¤±è´¥è¿”å› -1 ã€‚\næ³¨æ„ï¼Œ åœ¨ libpcap 1.8.0 ä»¥åŠä¹‹åçš„ç‰ˆæœ¬ä¸­ï¼Œpcap_compile() å¯ä»¥ç”¨äºå¤šçº¿ç¨‹ï¼Œæ—§ç‰ˆæœ¬ä¸­ï¼Œè¯¥å‡½æ•°æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œå¦‚æœç”¨äºå¤šçº¿ç¨‹ï¼Œéœ€è¦åšäº’æ–¥åŒæ­¥ã€‚\nç¼–è¯‘æˆåŠŸåï¼Œè°ƒç”¨ pcap_setfilter() åº”ç”¨è¿™ä¸ªè¿‡æ»¤å™¨ï¼š\nint pcap_setfilter(pcap_t *p, struct bpf_program *fp); ","date":"2018 April 23","permalink":"/posts/2018/04/23/","section":"Posts","summary":"0. ç®€ä»‹ #libpcap æ˜¯ç”¨äºæ•è· TCP/IP ç½‘ç»œæ•°æ®åŒ…çš„ C/C++ åº“ï¼Œæ”¯æŒ Linux ç³»ç»Ÿï¼ŒTcpdump å°±æ˜¯åœ¨å…¶åŸºç¡€ä¸Šå¼€å‘çš„ï¼Œé€šå¸¸ç”¨äºç½‘ç»œå—…æ¢ã€æ•°æ®æŠ“å–ã€åè®®åˆ†æç­‰ï¼Œå®˜ç½‘æ˜¯ http://www.","title":"Libpcap å­¦ä¹ ç¬”è®°"},{"content":"0. å¼€å§‹ #Tkinter æ˜¯ Python å†…ç½®çš„ GUI æ¡†æ¶ï¼Œå®‰è£…å Python åå³å¯ä½¿ç”¨ï¼š\nPython 3.6.2 (v3.6.2:5fd33b5926, Jul 16 2017, 20:11:06) [GCC 4.2.1 (Apple Inc. build 5666) (dot 3)] on darwin Type \u0026quot;help\u0026quot;, \u0026quot;copyright\u0026quot;, \u0026quot;credits\u0026quot; or \u0026quot;license\u0026quot; for more information. \u0026gt;\u0026gt;\u0026gt; import tkinter as tk \u0026gt;\u0026gt;\u0026gt; tk._test() è¿è¡Œç»“æœï¼š\nä¸‹é¢è¿™ä¸ªä¾‹å­åªåŒ…å«ä¸€ä¸ª Quit æŒ‰é’®:\nimport tkinter as tk window = tk.Tk() #å®šä¹‰ä¸€ä¸ªé¡¶å±‚çª—å£ window.title('my window') #å®šä¹‰çª—å£çš„æ ‡é¢˜ window.geometry('200x100') #è®¾ç½®çª—å£çš„å¤§å° quitbutton = tk.Button(window, text=\u0026quot;Quit\u0026quot;, command=window.quit) #åœ¨ window ä¸Šå®šä¹‰ä¸€ä¸ªæŒ‰é’®ï¼Œæ˜¾ç¤º Quit ï¼Œç‚¹å‡»æŒ‰é’®æ‰§è¡Œ quit æ–¹æ³• quitbutton.grid() #æ˜¾ç¤ºè¿™ä¸ªæŒ‰é’® window.mainloop() #å¼€å§‹ä¸»å¾ªç¯ è¿è¡Œç»“æœï¼š\n1. å¸ƒå±€ç®¡ç† #Tkinter æœ‰å¤šç§å¸ƒå±€ç®¡ç†ç³»ç»Ÿï¼Œgrid æ˜¯æœ€å¸¸ç”¨çš„ä¸€ç§ã€‚ä»¥é¡¶å±‚çª—å£ä½œä¸ºæ ¹æ§ä»¶å½¢æˆä¸€ä¸ªæ§ä»¶æ ‘ï¼Œä¸€ä¸ªçˆ¶æ§ä»¶ä¸Šå¯ä»¥åŒ…å«å¾ˆå¤šå­æ§ä»¶ï¼Œä¾‹å¦‚é¡¶å±‚çª—å£ä¸Šæœ‰æŒ‰é’®ã€è¾“å…¥æ¡†ç­‰ï¼Œå¤§ä½“åº”è¯¥æ˜¯å¦‚ä¸‹çš„ç»“æ„ï¼š\næ–°å»ºä¸€ä¸ªæ§ä»¶åˆ†ä¸ºä¸¤æ­¥ï¼š\nself.thing = tk.Constructor(parent, ...) self.thing.grid(...) å®šä¹‰æ§ä»¶ï¼ŒConstructor æ˜¯ä¸€ç§æ§ä»¶çš„ç±»ï¼Œ æ¯”å¦‚ Buttonã€Frame ï¼Œparent è¡¨ç¤ºè¯¥æ§ä»¶çš„çˆ¶æ§ä»¶ å°†æ§ä»¶æ”¾åˆ°çª—å£ä¸Šï¼Œæ‰€æœ‰çš„æ§ä»¶éƒ½æœ‰ grid æ–¹æ³•ï¼Œè´Ÿè´£é€šçŸ¥å¸ƒå±€ç®¡ç†å™¨å°†è¿™ä¸ªç»„ä»¶æ”¾ç½®åˆ°åˆé€‚çš„ä½ç½® grid å¸ƒå±€å°†çˆ¶æ§ä»¶çš„æ˜¾ç¤ºåŒºåŸŸåˆ’åˆ†ä¸ºç½‘æ ¼ï¼Œä½¿ç”¨ grid å¸ƒå±€çš„è¿‡ç¨‹å°±æ˜¯ä¸ºå„ä¸ªå­æ§ä»¶æŒ‡å®šè¡Œå·å’Œåˆ—å·ï¼Œå·¦ä¸Šè§’çš„åæ ‡æ˜¯ (0,0)ï¼Œä¸éœ€è¦ä¸ºæ¯ä¸ªå•å…ƒæ ¼æŒ‡å®šå¤§å°ï¼Œgrid å¸ƒå±€ä¼šè‡ªåŠ¨è®¾ç½®ä¸€ä¸ªåˆé€‚çš„å¤§å°ã€‚grid æ–¹æ³•çš„åŸå‹æ˜¯ w.grid(option=value, ...) ï¼Œå®ƒå°†æ§ä»¶ w æ³¨å†Œåˆ°çˆ¶æ§ä»¶çš„ grid å¸ƒå±€ï¼Œå¹¶è®¾ç½®æ‰€å¤„çš„å•å…ƒæ ¼åæ ‡ï¼Œå¸¸ç”¨å±æ€§å¦‚ä¸‹ï¼š\ncolumn ï¼Œåˆ—åæ ‡ï¼Œé»˜è®¤æ˜¯ 0 row ï¼Œè¡Œåæ ‡ï¼Œé»˜è®¤æ˜¯æ–°å¯ä¸€è¡Œ sticky ï¼Œæ§ä»¶å¡«å……å•å…ƒæ ¼çš„æ–¹å¼ï¼Œä¸è®¾ç½®è¯¥é€‰é¡¹æ—¶é»˜è®¤æ˜¯æ¨ªç«–å±…ä¸­ï¼Œå®ƒæœ‰ä¸¤ç§å¯é€‰å€¼ï¼Œå¯ä»¥ç”¨åŠ å·ç»„åˆï¼š ç´§è´´å•å…ƒæ ¼çš„æŸä¸ªè§’è½ï¼šsticky=tk.NE (å³ä¸Šè§’) ï¼Œ tk.SE (å³ä¸‹è§’) ï¼Œ tk.SW (å·¦ä¸‹è§’) æˆ–è€… tk.NW (å·¦ä¸Šè§’) ç´§è´´å•å…ƒæ ¼çš„æŸæ¡è¾¹çº¿ï¼šsticky=tk.N (ä¸Šè¾¹å±…ä¸­) ï¼Œ tk.E (å³è¾¹å±…ä¸­) ï¼Œ tk.S (åº•è¾¹å±…ä¸­) æˆ–è€… tk.W (å·¦è¾¹å±…ä¸­) padx ï¼Œæ¨ªå‘å†…è¾¹è· pady ï¼Œçºµå‘å†…è¾¹è· ä¹Ÿå¯ä»¥æ‰‹åŠ¨è®¾ç½®å½“å‰æ§ä»¶çš„å•å…ƒæ ¼å¤§å°ï¼š\nè®¾ç½®ç¬¬ N åˆ—ï¼šw.columnconfigure(N, option=value, ...) è®¾ç½®ç¬¬ N è¡Œï¼šw.rowconfigure(N, option=value, ...) option æœ‰ä¸‰ä¸ªå±æ€§å¯é€‰ï¼š\nminsize ï¼Œè¡Œæˆ–è€…åˆ—çš„æœ€å°å°ºå¯¸ï¼Œå•ä½æ˜¯åƒç´  pad ï¼Œè¡Œæˆ–è€…åˆ—å ç”¨çš„å°ºå¯¸å¤§å°ï¼Œå•ä½æ˜¯åƒç´  weight ï¼Œè®¾ç½®è¡Œæˆ–è€…åˆ—å ç”¨çš„æ¯”ä¾‹ï¼Œä½¿ç½‘æ ¼å°ºå¯¸å…·æœ‰å¼¹æ€§ï¼Œ ä¾‹å¦‚ï¼š\nimport tkinter as tk window = tk.Tk() window.title('my window') window.geometry('200x100') window.columnconfigure(0, weight=1) #ç¬¬ä¸€åˆ—å ç”¨ 1/3 å®½åº¦ window.columnconfigure(1, weight=2) #ç¬¬äºŒåˆ—å ç”¨ 2/3 å®½åº¦ window.rowconfigure(0, weight=1) #ç¬¬ä¸€è¡Œå ç”¨å…¨éƒ¨é«˜åº¦ Abutton = tk.Button(window, text=\u0026quot;A\u0026quot;) Abutton.grid() Bbutton = tk.Button(window, text=\u0026quot;B\u0026quot;) Bbutton.grid(row=0,column=1,sticky=tk.W+tk.E) window.mainloop() è¿è¡Œç»“æœï¼š\nè¿˜æœ‰ä¸€äº›å¸¸ç”¨çš„æ–¹æ³•ï¼š\nw.grid_forget() ï¼Œéšè—ä¸€ä¸ªæ§ä»¶ w.grid_propagate() ï¼Œæ§ä»¶çš„å°ºå¯¸é€šå¸¸æ˜¯ç”±æ§ä»¶é‡Œçš„å†…å®¹å†³å®šçš„ï¼Œä½†æ˜¯æœ‰æ—¶éœ€è¦å¼ºåˆ¶è®¾ç½®æ§ä»¶å¤§å°ï¼Œè¿™å°±è¦å…ˆè®¾ç½® w.grid_propagate(0) ï¼Œç„¶åè®¾ç½®å°ºå¯¸ w.grid_info()ï¼Œè¿”å›ä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«äº†æ§ä»¶çš„å±æ€§åç§°å’Œå€¼ w.grid_size()ï¼Œè¿”å›ä¸€ä¸ªå…ƒç»„ï¼ŒåŒ…å«ä¸¤ä¸ªå…ƒç´ ï¼Œåˆ†åˆ«æ˜¯è¡Œå’Œåˆ— w.grid_configure(option, \u0026hellip;) ï¼Œè®¾ç½® grid çš„å±æ€§ï¼Œä¾‹å¦‚ w.grid_configure(padx=5,pady=5) 2. ä¸€ä¸ªå®Œæ•´çš„ä¾‹å­ #2.1. è®¾è®¡ #è¿™ä¸ªä¾‹å­æ˜¯ä¸€ä¸ªå•çª—å£ GUI åº”ç”¨ï¼ŒåŠŸèƒ½æ˜¯å°†è‹±å°ºè½¬æ¢ä¸ºç±³ï¼Œç•Œé¢è‰å›¾æ˜¯è¿™ä¸ªæ ·å­ï¼š\nç¬¬ä¸€è¡Œæœ‰ä¸€ä¸ªè¾“å…¥æ¡†ï¼Œå•ä½ feet æ”¾åœ¨ä¸€ä¸ªæ ‡ç­¾é‡Œï¼Œç¬¬äºŒè¡Œä¸­é—´æ˜¯ä¸€ä¸ªç©ºç™½æ ‡ç­¾ï¼Œç”¨äºæ”¾ç½®è½¬æ¢åçš„ç»“æœï¼Œå·¦å³åˆ†åˆ«æ˜¯æ–‡å­—è¯´æ˜ï¼Œå³ä¸‹è§’æ˜¯ä¸€ä¸ª \u0026lsquo;Calculate\u0026rsquo; æŒ‰é’®ï¼ŒæŒ‰ä¸‹æ—¶è·å–è¾“å…¥æ¡†ä¸­çš„æ•°å€¼ï¼Œè½¬æ¢æˆç±³åæ˜¾ç¤ºåœ¨ä¸­é—´çš„æ ‡ç­¾ä¸­ã€‚æ•´ä¸ªçª—å£æ˜¯ä¸€ä¸ª 3x3 çš„ grid å¸ƒå±€ï¼š\nä¸‰è¡Œæ‰€å é«˜åº¦åº”è¯¥æ˜¯ 1:1:1 ï¼Œä¸‰åˆ—æ‰€å çš„å®½åº¦åº”è¯¥æ˜¯ 2:1:1 ï¼Œè¾“å…¥æ¡†å®½åº¦ 7 ä¸ªå­—ç¬¦ã€‚\n2.2. ç¼–ç  #æ–°å»ºä¸€ä¸ªç›®å½•ï¼Œç¼–è¾‘æºæ–‡ä»¶ mygui.py ï¼Œä»£ç å¦‚ä¸‹ï¼š\n#!~/py3-env/bin/python import tkinter as tk #æ–°å»ºä¸€ä¸ªæ ¹çª—å£ï¼Œå¹¶è®¾ç½®çª—å£æ ‡é¢˜ window = tk.Tk() window.title('Feet to Meters') #æŒ‰ä¸‹æŒ‰é’®æ˜¯è°ƒç”¨çš„å‡½æ•°ï¼Œè·å–è¾“å…¥æ¡†çš„å€¼ï¼Œè½¬æ¢æˆç±³åˆ¶å•ä½åœ¨å†™å…¥æ ‡ç­¾ def calculate(*args): value = float(feet.get()) meters.set( (0.3048*value*10000.0 + 0.5) / 10000.0 ) #åœ¨çª—å£ä¸Šç»˜åˆ¶ä¸€ä¸ªæ¡†æ¶ï¼Œå¹¶å®šä¹‰æ¡†æ¶çš„å†…è¾¹è· mainframe = tk.Frame(window,padx=15,pady=25) #mainframe ä¼šå æ»¡æ•´ä¸ªçª—å£ mainframe.grid(row=0,column=0,sticky=tk.N+tk.W+tk.E+tk.S) mainframe.rowconfigure(0,weight=1) mainframe.columnconfigure(0,weight=1) #è¾“å…¥æ¡†ä½äºç¬¬ä¸€è¡Œç¬¬äºŒåˆ—ï¼Œå·¦å³å æ»¡ï¼Œå®½åº¦æ˜¯ 7 ä¸ªå­—ç¬¦ï¼Œå†…éƒ¨æ–‡æœ¬å³å¯¹é½ï¼Œå¹¶ä¸”æ˜¯ç¨‹åºå¯åŠ¨åé»˜è®¤çš„ç„¦ç‚¹ feet=tk.StringVar() feet_entry = tk.Entry(mainframe,width=7,justify=tk.RIGHT,textvariable=feet) feet_entry.grid(row=0,column=1,sticky=tk.W+tk.E) feet_entry.focus() feet_label = tk.Label(mainframe,text=\u0026quot;Feet\u0026quot;,anchor=tk.W) feet_label.grid(row=0,column=2,sticky=tk.W) meters=tk.StringVar() tk.Label(mainframe,text=\u0026quot;is equivalent to\u0026quot;).grid(row=1,column=0,sticky=tk.E) tk.Label(mainframe,textvariable=meters).grid(row=1,column=1,sticky=tk.W+tk.E) tk.Label(mainframe,text=\u0026quot;Meters\u0026quot;).grid(row=1,column=2,sticky=tk.W+tk.W) #åœ¨å³ä¸‹è§’æ”¾ç½®ä¸€ä¸ªæŒ‰é’®ï¼ŒæŒ‰ä¸‹æ—¶æ‰§è¡Œ calculate å‡½æ•° tk.Button(mainframe,text=\u0026quot;Calculate\u0026quot;,command=calculate).grid(row=2,column=2,sticky=tk.W) #è®¾ç½® mainframe å†…æ¯ä¸ªæ§ä»¶çš„å†…è¾¹è·ä¸º 5 for child in mainframe.winfo_children(): child.grid_configure(padx=5,pady=5) #æŒ‰ä¸‹å›è½¦é”®æ—¶ä¹Ÿä¼šæ‰§è¡Œè½¬æ¢ window.bind('\u0026lt;Return\u0026gt;', calculate) window.mainloop() ä¿å­˜åè¿è¡Œï¼Œçœ‹ä¸€ä¸‹æ•ˆæœï¼š\n2.3. æ‰“åŒ… #æµ‹è¯•æˆåŠŸåç”¨ pyinstaller å°†æºç æ‰“åŒ…ï¼Œè¿™æ ·åœ¨å…¶ä»–è®¡ç®—æœºä¸Šä¹Ÿå¯ä»¥è¿è¡Œï¼Œç”šè‡³ä¸ç”¨å®‰è£… python ï¼Œä½†æ˜¯æœ‰ä¸€ç‚¹è¦æ³¨æ„ï¼Œåœ¨ macOS ä¸‹ç”¨ pyinstaller æ‰“åŒ…çš„ç¨‹åºåªèƒ½è¿è¡Œäº macOS ï¼Œåœ¨ Windows ä¸‹ç”¨ pyinstaller æ‰“åŒ…çš„ç¨‹åºåªèƒ½è¿è¡Œäº Windows ã€‚å…ˆå®‰è£… pyinstaller ï¼š\n$ pip install pyinstaller $ python -m PyInstaller --version 3.3.1 è¿™ä¸ªç‰ˆæœ¬åœ¨ macOS ä¸Šæœ‰ä¸ª Bug ï¼Œå°±æ˜¯æ‰“åŒ…çš„ tkinter ç¨‹åºåœ¨è¿è¡Œæ—¶ä¼šæŠ¥å¦‚ä¸‹çš„é”™è¯¯ï¼š\nImportError: dlopen(/var/folders/gk/q_9lv83d6999mzn5d3cjrry80000gn/T/_MEIlRBLqx/_tkinter.so, 2): Library not loaded: @loader_path/Tcl Referenced from: /var/folders/gk/q_9lv83d6999mzn5d3cjrry80000gn/T/_MEIlRBLqx/_tkinter.so Reason: image not found éœ€è¦å®‰è£…ä¸‹é¢æä¾›çš„è¡¥ä¸ä¿®æ”¹ pyinstaller : https://github.com/pyinstaller/pyinstaller/pull/2969 ã€‚ç„¶ååœ¨æºç ç›®å½•ä¸‹æ‰§è¡Œï¼š\n$ pyinstaller -w -F mygui.py -F è¡¨ç¤ºå°†æ‰€æœ‰æ–‡ä»¶å’Œåº“æ‰“åŒ…æˆä¸€ä¸ªæ–‡ä»¶ï¼Œè¿™æ ·åœ¨æ²¡æœ‰å®‰è£… python çš„è®¡ç®—æœºä¸Šä¹Ÿå¯ä»¥è¿è¡Œï¼Œ-w è¡¨ç¤ºå…³é—­ç»ˆç«¯ï¼Œå¦åˆ™åœ¨è¿è¡Œç”Ÿæˆçš„åº”ç”¨åœ¨æ‰“å¼€æ—¶ä¼šè¿è¡Œä¸€ä¸ªç»ˆç«¯ã€‚ç”Ÿæˆçš„åº”ç”¨ç¨‹åºåœ¨ dist ç›®å½•ä¸‹ï¼Œè¯¥ç›®å½•ä¸‹æœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼Œmygui æ˜¯è°ƒè¯•ç‰ˆï¼Œmygui.app æ˜¯å‘è¡Œç‰ˆï¼ŒåŒå‡» mygui.app å³å¯è¿è¡Œï¼š\né»˜è®¤æ‰“åŒ…åçš„ç¨‹åºæ˜¯ä¸æ”¯æŒ Retina å±å¹•çš„ï¼Œæ‰€ä»¥åœ¨ macOS ä¸Šä¼šæ˜¾ç¤ºæ¨¡ç³Šã€‚éœ€è¦å…ˆç”Ÿæˆä¸€ä¸ª spec æ–‡ä»¶ï¼š\n$ pyi-makespec -w -F mygui.py ç„¶åç¼–è¾‘ç”Ÿæˆçš„ mygui.spec ï¼Œæ·»åŠ  info_plist å¹¶è®¾ç½® 'NSHighResolutionCapable': 'True' ï¼š\napp = BUNDLE(exe, name='mygui.app', icon=None, bundle_identifier=None, info_plist={ 'NSHighResolutionCapable': 'True' } ) ä¿å­˜åç”¨è¿™ä¸ªé…ç½®æ–‡ä»¶æ‰§è¡Œæ‰“åŒ…ä»»åŠ¡ï¼š\n$ pyinstaller -w -F mygui.spec è¿™æ ·ç”Ÿæˆçš„åº”ç”¨å°±æ”¯æŒ Retina å±å¹•äº†ã€‚\n3. å¸¸ç”¨æ§ä»¶ #æ¯ä¸ªæ§ä»¶éƒ½æ˜¯ä¸€ä¸ªç±»ï¼Œè°ƒç”¨æ§ä»¶çš„åˆå§‹åŒ–å‡½æ•°å°±ä¼šæ–°å»ºä¸€ä¸ªå®ä¾‹ã€‚\n3.1. æŒ‰é’® #æŒ‰é’®çš„åŸå‹ï¼š\nw = tk.Button(parent, option=value, ...) bg or background\tï¼ŒèƒŒæ™¯é¢œè‰² bd or borderwidth\tï¼Œè¾¹æ¡†å®½åº¦ï¼Œé»˜è®¤æ˜¯ 2 anchor ï¼ŒæŒ‰é’®ä¸Šæ–‡å­—çš„å¯¹é½ä½ç½®ï¼Œä¾‹å¦‚ anchor=tk.NE è¡¨ç¤ºå³ä¸Šè§’å¯¹é½ text ï¼ŒæŒ‰é’®ä¸Šæ˜¾ç¤ºçš„æ–‡å­— textvariable ï¼Œä¸ºè¯¥å±æ€§è®¾ç½®ä¸€ä¸ªæ§åˆ¶å˜é‡ StringVal ç±»çš„å®ä¾‹ï¼Œä»¥åä¿®æ”¹è¿™ä¸ªå˜é‡å°±å¯ä»¥ä¿®æ”¹æ ‡ç­¾å†…æ˜¾ç¤ºçš„æ–‡æœ¬ command ï¼Œè®¾ç½®æŒ‰é’®æŒ‰ä¸‹æ—¶çš„è¡Œä¸ºï¼Œå¯ä»¥æŒ‡å‘ä¸€ä¸ªå‡½æ•°æˆ–è€…æ–¹æ³• width ï¼ŒæŒ‰é’®çš„å®½åº¦ï¼Œå•ä½æ˜¯å­—ç¬¦ä¸ªæ•°ï¼Œå¦‚æœæŒ‰é’®æ˜¾ç¤ºçš„æ˜¯å›¾ç‰‡ï¼Œåˆ™å•ä½æ˜¯åƒç´  padx ï¼ŒæŒ‰é’®è¾¹æ¡†ä¸æ–‡å­—ä¹‹é—´çš„æ¨ªå‘é—´è·ï¼Œå°±æ˜¯å†…è¾¹è·ï¼Œå•ä½æ˜¯åƒç´  pady ï¼ŒæŒ‰é’®è¾¹æ¡†ä¸æ–‡å­—ä¹‹é—´çš„çºµå‘é—´è·ï¼Œå•ä½æ˜¯åƒç´  relief ï¼Œ3D æ ·å¼ï¼Œé»˜è®¤å€¼æ˜¯ relief=tk.RAISEDï¼Œå¯é€‰å››ä¸ªå€¼ï¼štk.GROOVE(è¾¹æ¡†çªå‡º)ï¼Œtk.RIDGE(è¾¹æ¡†å‡¹é™·)ï¼Œtk.SUNKEN(æ•´ä½“å‡¹é™·)ï¼Œtk.RAISED(æ•´ä½“çªå‡º)ï¼Œè¾¹æ¡†å®½åº¦ç”± borderwidth å†³å®š state ï¼ŒæŒ‰é’®çš„çŠ¶æ€ï¼Œé»˜è®¤æ˜¯ tk.NORMAL ï¼Œé¼ æ ‡æ‚¬åœæ—¶è¿™ä¸ªå€¼æ˜¯ tk.ACTIVE ï¼Œè®¾ä¸º tk.DISABLED æ—¶æŒ‰é’®å˜ç°å¹¶ä¸”å¤±æ•ˆ å®ƒæœ‰ä¸¤ä¸ªæ–¹æ³•ï¼š\n.invoke() ï¼Œè°ƒç”¨ command æŒ‡å®šçš„å‡½æ•°ã€‚ .flash() ï¼Œä½¿æŒ‰é’®çš„é¢œè‰²åœ¨æŒ‰ä¸‹å’Œæ”¾å¼€ä¹‹é—´é—ªçƒå‡ æ¬¡ã€‚ ä¾‹ç¨‹ï¼š\nimport tkinter as tk window = tk.Tk() window.title('my window') window.geometry('200x100') window.columnconfigure(0, weight=1) window.rowconfigure(0, weight=1) button = tk.Button(window, anchor=tk.CENTER, text='Quit', command=window.quit) button.grid() window.mainloop() è¿è¡Œç»“æœï¼š\n3.2. æ ‡ç­¾ #æ ‡ç­¾æ§ä»¶å¯ä»¥æ˜¾ç¤ºä¸€è¡Œæˆ–è€…å¤šè¡Œæ–‡æœ¬ï¼Œæˆ–è€…ä¸€å¼ å›¾ç‰‡ã€‚\nw = tk.Label(parent, option, ...) å¸¸ç”¨å±æ€§ï¼›\nactivebackground ï¼Œé¼ æ ‡ç»è¿‡æ—¶çš„èƒŒæ™¯é¢œè‰² activeforeground ï¼Œé¼ æ ‡ç»è¿‡æ—¶çš„å‰æ™¯é¢œè‰² anchor ï¼Œæ–‡æœ¬æˆ–è€…å›¾ç‰‡çš„å¯¹é½ä½ç½®ï¼Œé»˜è®¤æ˜¯ anchor=tk.CENTER bg or background ï¼ŒèƒŒæ™¯é¢œè‰² bd or borderwidth\tï¼Œè¾¹æ¡†å®½åº¦ï¼Œé»˜è®¤æ˜¯ 2 text ï¼Œæ˜¾ç¤ºæ˜¯æ–‡æœ¬ textvariable ï¼Œä¸ºè¯¥å±æ€§è®¾ç½®ä¸€ä¸ªæ§åˆ¶å˜é‡ StringVal ç±»çš„å®ä¾‹ï¼Œä»¥åä¿®æ”¹è¿™ä¸ªå˜é‡å°±å¯ä»¥ä¿®æ”¹æ ‡ç­¾å†…æ˜¾ç¤ºçš„æ–‡æœ¬ width ï¼Œå®½åº¦ï¼Œå•ä½æ˜¯å­—ç¬¦ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œå®½åº¦éšå†…å®¹å˜åŒ– padx ï¼ŒæŒ‰é’®è¾¹æ¡†ä¸æ–‡å­—ä¹‹é—´çš„æ¨ªå‘é—´è·ï¼Œå°±æ˜¯å†…è¾¹è·ï¼Œå•ä½æ˜¯åƒç´  pady ï¼ŒæŒ‰é’®è¾¹æ¡†ä¸æ–‡å­—ä¹‹é—´çš„çºµå‘é—´è·ï¼Œå•ä½æ˜¯åƒç´  relief ï¼Œ3D æ ·å¼ï¼Œé»˜è®¤å€¼æ˜¯ relief=tk.FLATï¼Œå¯é€‰å››ä¸ªå€¼ï¼štk.GROOVE(è¾¹æ¡†çªå‡º)ï¼Œtk.RIDGE(è¾¹æ¡†å‡¹é™·)ï¼Œtk.SUNKEN(æ•´ä½“å‡¹é™·)ï¼Œtk.RAISED(æ•´ä½“çªå‡º)ï¼Œè¾¹æ¡†å®½åº¦ç”± borderwidth å†³å®š ä¾‹ç¨‹ï¼š\nimport tkinter as tk window = tk.Tk() window.title('my window') window.geometry('200x100') window.columnconfigure(0, weight=1) window.rowconfigure(0, weight=1) label = tk.Label(window, bg='#ff0000', text='Please',padx=5, pady=3) label.grid() window.mainloop() è¿è¡Œç»“æœï¼š\n3.3. è¾“å…¥æ¡† #è¾“å…¥æ¡†å¯ä»¥æ˜¾ç¤ºå’Œè¾“å…¥å•è¡Œæ–‡æœ¬ï¼Œæ–‡æœ¬ä¸­çš„å­—ç¬¦ç¼–å·ä» 0 å¼€å§‹ï¼Œå¸¸é‡ tk.END è¡¨ç¤ºæ–‡æœ¬çš„ç»“å°¾ï¼Œtk.INSERT è¡¨ç¤ºå½“å‰å…‰æ ‡æ‰€å¤„çš„ä½ç½®ï¼ŒåŸå‹ï¼š\nw = tk.Entry(parent, option, ...) å¸¸ç”¨å±æ€§ï¼š\nbg or background\tï¼ŒèƒŒæ™¯é¢œè‰² bd or borderwidth\tï¼Œè¾¹æ¡†å®½åº¦ï¼Œé»˜è®¤æ˜¯ 0 width ï¼Œè¾“å…¥æ¡†èƒ½å¤Ÿå®¹çº³çš„å­—ç¬¦æ•°ï¼Œé»˜è®¤æ˜¯ 20 showï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¾“å…¥çš„å­—ç¬¦ä¼šç›´æ¥æ˜¾ç¤ºï¼Œå¦‚æœæ˜¯å¯†ç ï¼Œéœ€è¦éšè—ï¼Œå¯ä»¥è¦æ±‚è¾“å…¥çš„å­—ç¬¦éƒ½æ˜¾ç¤ºä¸ºæ˜Ÿå·ï¼š show='*' justify ï¼Œè¾“å…¥æ¡†å†…æ–‡æœ¬çš„å¯¹é½æ–¹å¼ï¼Œé»˜è®¤æ˜¯å·¦å¯¹é½ justify=tk.LEFT ï¼Œè¿˜å¯é€‰ tk.CENTER å’Œ tk.RIGHT validate ï¼Œè®¾ç½®æ£€æŸ¥è¾“å…¥æ¡†å†…å®¹çš„æ—¶æœº validatecommand ï¼Œè®¾ç½®ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œè´Ÿè´£æ£€æŸ¥è¾“å…¥æ¡†çš„å†…å®¹ textvariable ï¼Œä¸ºè¯¥å±æ€§è®¾ç½®ä¸€ä¸ªæ§åˆ¶å˜é‡ StringVar ç±»çš„å®ä¾‹ï¼Œå°±å¯ä»¥ç”¨ v.get() æ–¹æ³•å–å›è¾“å…¥æ¡†ä¸­å†…å®¹ï¼Œæˆ–è€…ç”¨ v.set(value) è®¾ç½®ï¼Œv å°±æ˜¯è¿™ä¸ªå®ä¾‹ state ï¼Œé»˜è®¤æ˜¯ tk.NORMAL ï¼Œé¼ æ ‡æ‚¬åœæ—¶è¿™ä¸ªå€¼æ˜¯ tk.ACTIVE ï¼Œè®¾ä¸º tk.DISABLED æ—¶è¾“å…¥æ¡†å˜ç°ï¼Œå¹¶æ— æ³•è¾“å…¥ã€‚ å¸¸ç”¨æ–¹æ³•ï¼š\n.delete(first, last=None) ï¼Œåˆ é™¤å­—ç¬¦ï¼Œä»ç¬¬ first ä¸ªå­—ç¬¦åˆ°ç¬¬ last ä¸ªå­—ç¬¦ä¹‹å‰ã€‚ .get() ï¼Œè·å–è¾“å…¥æ¡†ä¸­çš„æ–‡æœ¬ï¼Œè¿”å›å€¼æ˜¯å­—ç¬¦ä¸²ã€‚ .insert(index, s) ï¼Œåœ¨ç¬¬ index ä¸ªå­—ç¬¦å‰æ’å…¥å­—ç¬¦ä¸² s ã€‚ ä¾‹ç¨‹ï¼š\nimport tkinter as tk window = tk.Tk() window.title('my window') window.geometry('300x100') window.columnconfigure(0, weight=1) window.columnconfigure(1, weight=2) window.rowconfigure(0, weight=1) label1 = tk.Label(window,text=\u0026quot;Username:\u0026quot;, anchor=tk.E) label1.grid(row=0,column=0,sticky=tk.SE) user = tk.Entry(window, width=16, justify=tk.RIGHT) user.grid(row=0,column=1,sticky=tk.SW) label2 = tk.Label(window,text=\u0026quot;Password:\u0026quot;, anchor=tk.E) label2.grid(row=1,column=0,sticky=tk.NE) passwd = tk.Entry(window, width=16,show='*', justify=tk.RIGHT) passwd.grid(row=1,column=1,sticky=tk.NW) window.mainloop() è¿è¡Œç»“æœï¼š\næœ‰æ—¶æˆ‘ä»¬éœ€è¦æ£€æŸ¥è¾“å…¥çš„æ–‡æœ¬æ˜¯å¦åˆæ³•ï¼Œè¿™éœ€è¦å®šä¹‰ä¸€ä¸ªæ£€æµ‹å‡½æ•°ï¼Œå¹¶è®¾ç½®è°ƒç”¨å®ƒçš„æ—¶é—´ï¼Œå…·ä½“æ­¥éª¤ï¼š\nå®šä¹‰ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œè´Ÿè´£æ£€æŸ¥è¾“å…¥çš„å†…å®¹ï¼Œå¦‚æœåˆæ³•å°±è¿”å› True ï¼Œå¦åˆ™è¿”å› False ç”¨ w.register(function) æ–¹æ³•å°†å›æ‰å‡½æ•°å°è£…ä¸º Tcl ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç”¨å®ƒè®¾ç½® validatecommand è®¾ç½® validate ï¼Œå£°æ˜è°ƒç”¨å›æ‰å‡½æ•°çš„æ—¶æœºï¼Œå¸¸ç”¨ä»é€‰é¡¹æœ‰ï¼š \u0026lsquo;focus\u0026rsquo; ï¼Œè¾“å…¥æ¡†è·å¾—æˆ–è€…å¤±å»ç„¦ç‚¹æ—¶ \u0026lsquo;focusin\u0026rsquo; ï¼Œè¾“å…¥æ¡†è·å¾—ç„¦ç‚¹æ—¶ \u0026lsquo;focusout\u0026rsquo; ï¼Œè¾“å…¥æ¡†å¤±å»ç„¦ç‚¹æ—¶ \u0026lsquo;key\u0026rsquo; ï¼Œå†…å®¹æ”¹å˜æ—¶ \u0026lsquo;all\u0026rsquo; ï¼Œä»¥ä¸Šä»»ä½•æƒ…å†µå‘ç”Ÿæ—¶ \u0026rsquo;none\u0026rsquo; ï¼Œå…³é—­å†…å®¹æ£€æŸ¥ï¼Œè¿™æ˜¯é»˜è®¤å€¼ 3.4. æ¡†æ¶ #æ¡†æ¶æ˜¯å…¶ä»–æ§ä»¶çš„å®¹å™¨ï¼Œé¡¶å±‚çª—å£æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ¡†æ¶ä¼šç´§ç´§çš„åŒ…è£¹å®ƒçš„æ§ä»¶ï¼Œå®ƒçš„åŸå‹ï¼š\nw = Frame(parent, option, ...) å¸¸ç”¨å±æ€§ï¼š\nbg or background\tï¼ŒèƒŒæ™¯é¢œè‰² bd or borderwidth\tï¼Œè¾¹æ¡†å®½åº¦ï¼Œé»˜è®¤æ˜¯ 0 width ï¼Œæ¡†æ¶çš„å®½åº¦ï¼Œ w.grid_propagate(0) æ—¶æœ‰æ•ˆ height ï¼Œæ¡†æ¶çš„é«˜åº¦ï¼Œw.grid_propagate(0) æ—¶æœ‰æ•ˆ padx ï¼Œåœ¨æ¡†æ¶ä¸æ§ä»¶ä¹‹é—´çš„æ¨ªå‘é—´è·ï¼Œå•ä½æ˜¯åƒç´  pady ï¼Œåœ¨æ¡†æ¶ä¸æ§ä»¶ä¹‹é—´çš„çºµå‘é—´è· relief ï¼Œ3D æ ·å¼ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ¡†æ¶æ˜¯å®Œå…¨éšå½¢çš„ relief=tk.FLATï¼Œå¯é€‰å››ä¸ªå€¼ï¼štk.GROOVE(è¾¹æ¡†çªå‡º)ï¼Œtk.RIDGE(è¾¹æ¡†å‡¹é™·)ï¼Œtk.SUNKEN(æ•´ä½“å‡¹é™·)ï¼Œtk.RAISED(æ•´ä½“çªå‡º)ï¼Œè¾¹æ¡†å®½åº¦ç”± borderwidth å†³å®š ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹ç¨‹ï¼š\nimport tkinter as tk window = tk.Tk() window.title('my window') window.geometry('200x100') window.columnconfigure(0, weight=1) window.rowconfigure(0, weight=1) frame = tk.Frame(window,height=50,width=100,relief=tk.GROOVE,bd=5) frame.grid_propagate(0) frame.grid() label = tk.Label(frame, text=\u0026quot;Label\u0026quot;) label.grid() window.mainloop() è¿è¡Œç»“æœï¼š\n3.5. æ ‡ç­¾æ¡†æ¶ #LabelFrame æ§ä»¶æ˜¯å¸¦æœ‰æ ‡ç­¾çš„æ¡†æ¶ï¼ŒåŸå‹ï¼š\nw = tk.LabelFrame(parent, option, ...) å¸¸ç”¨å±æ€§ï¼š\nbg or background\tï¼ŒèƒŒæ™¯é¢œè‰²\nbd or borderwidth\tï¼Œè¾¹æ¡†å®½åº¦ï¼Œé»˜è®¤æ˜¯ 2\nwidth ï¼Œæ¡†æ¶çš„å®½åº¦ï¼Œ w.grid_propagate(0) æ—¶æœ‰æ•ˆ\nheight ï¼Œæ¡†æ¶çš„é«˜åº¦ï¼Œw.grid_propagate(0) æ—¶æœ‰æ•ˆ\nlabelwidget ï¼Œå¯ä»¥åœ¨æ ‡ç­¾ä¸­æ’å…¥ä»»ä½•æ§ä»¶ï¼Œä»£æ›¿åŸæ¥çš„æ–‡æœ¬\ntext ï¼Œæ ‡ç­¾ä¸­çš„æ–‡å­—\nlabelanchor ï¼Œæ ‡ç­¾åœ¨æ¡†æ¶ä¸Šçš„ä½ç½®ï¼Œé»˜è®¤å€¼æ˜¯ \u0026rsquo;nw\u0026rsquo; ï¼Œå¯é€‰å€¼ï¼š\npadx=N ï¼Œåœ¨æ¡†æ¶ä¸æ§ä»¶ä¹‹é—´ï¼Œæ¨ªå‘æ·»åŠ  N ä¸ªåƒç´ \npady=N ï¼Œåœ¨æ¡†æ¶ä¸æ§ä»¶ä¹‹é—´ï¼Œçºµå‘æ·»åŠ  N ä¸ªåƒç´ \nrelief ï¼Œ3D æ ·å¼ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œé»˜è®¤å€¼æ˜¯ tk.GROOVEï¼Œå¯é€‰å››ä¸ªå€¼ï¼štk.GROOVE(è¾¹æ¡†çªå‡º)ï¼Œtk.RIDGE(è¾¹æ¡†å‡¹é™·)ï¼Œtk.SUNKEN(æ•´ä½“å‡¹é™·)ï¼Œtk.RAISED(æ•´ä½“çªå‡º)ï¼Œè¾¹æ¡†å®½åº¦ç”± borderwidth å†³å®š\nä¾‹ç¨‹ï¼š\nimport tkinter as tk window = tk.Tk() window.title('my window') window.minsize(width=300,height=150) window.columnconfigure(0, weight=1) window.rowconfigure(0, weight=1) login = tk.LabelFrame(window,text=\u0026quot;Login\u0026quot;,labelanchor='n',padx=10,pady=10) login.grid() label1 = tk.Label(login,text=\u0026quot;Username:\u0026quot;, anchor=tk.E) label1.grid(row=0,column=0,sticky=tk.SE) user = tk.Entry(login, width=16, justify=tk.RIGHT) user.grid(row=0,column=1,sticky=tk.SW) label2 = tk.Label(login,text=\u0026quot;Password:\u0026quot;, anchor=tk.E) label2.grid(row=1,column=0,sticky=tk.NE) passwd = tk.Entry(login, width=16,show='*', justify=tk.RIGHT) passwd.grid(row=1,column=1,sticky=tk.NW) window.mainloop() è¿è¡Œç»“æœï¼š\n3.6. èœå• #4. é¡¶å±‚çª—å£ #Tk() æ˜¯ç”± root æ–°å»ºçš„é¡¶å±‚çª—å£ï¼Œå¦‚æœè¦æ–°å»ºå…¶ä»–çª—å£ï¼Œéœ€è¦è°ƒç”¨ .Toplevel() æ–¹æ³•ï¼š\nw = tk.Toplevel(option, ...) 4.1. å¸¸ç”¨å±æ€§ # bg or background ï¼ŒèƒŒæ™¯é¢œè‰² bd or borderwidth\tï¼Œè¾¹æ¡†å®½åº¦ï¼Œé»˜è®¤æ˜¯ 0 menu ï¼Œä¸ºè¯¥å±æ€§ä¼ é€’ä¸€ä¸ª menu æ§ä»¶çš„å®ä¾‹ï¼Œä¼šä¸ºçª—å£æ·»åŠ ä¸€ä¸ªèœå•æ ï¼Œå¦‚æœæ˜¯ Windows æˆ–è€… Unix ç³»ç»Ÿï¼Œèœå•æ ä¼šå‡ºç°åœ¨ä¸²å£çš„é¡¶ç«¯ï¼Œå¦‚æœæ˜¯ MacOS ï¼Œèœå•æ ä¼šå‡ºç°åœ¨å±å¹•é¡¶ç«¯ 4.2. å¸¸ç”¨æ–¹æ³• # .maxsize(width=None, height=None) ï¼Œè®¾ç½®çª—å£çš„æœ€å¤§å°ºå¯¸ã€‚ .minsize(width=None, height=None) ï¼Œè®¾ç½®çª—å£çš„æœ€å°å°ºå¯¸ã€‚ .title(text=None) ï¼Œè®¾ç½®çª—å£æ ‡é¢˜ã€‚ .withdraw() ï¼Œéšè—çª—å£ã€‚ .geometry(newGeometry=None) ï¼Œè®¾ç½®çª—å£çš„å°ºå¯¸ï¼Œå‚æ•° newGeometry æ˜¯ä¸€ä¸ªå‡ ä½•å­—ç¬¦ä¸²ã€‚ 5. é€šç”¨æ–¹æ³• #ä¸‹é¢æ˜¯æ¯ä¸ªæ§ä»¶éƒ½æ”¯æŒçš„æ–¹æ³•ã€‚\nw.mainloop() ï¼Œä¸»å¾ªç¯ï¼Œå¤„ç†å„ç§äº‹ä»¶ï¼Œé€šå¸¸åœ¨æ‰€æœ‰é™æ€æ§ä»¶æ–°å»ºå®Œæ¯•åè°ƒç”¨ï¼Œ w.quit() ï¼Œç»“æŸä¸»å¾ªç¯ .mainloop() ï¼Œç¨‹åºé€€å‡º w.bind(sequence=None, func=None, add=None) ï¼Œå°†å½“å‰æ§ä»¶ä¸Šå‘ç”Ÿçš„äº‹ä»¶ä¸æŸäº›å‡½æ•°ç»‘å®šï¼Œsequence æ˜¯æè¿°äº‹ä»¶çš„å­—ç¬¦ä¸² w.bind_all(sequence=None, func=None, add=None)ï¼Œå°†å½“å‰åº”ç”¨ä¸Šæ‰€æœ‰æ§ä»¶å‘ç”Ÿçš„äº‹ä»¶ä¸æŸå†™å‡½æ•°ç»‘å®š w.bind_class(className, sequence=None, func=None, add=None) ï¼Œå°†æŸä¸€ç±»æ§ä»¶å‘ç”Ÿçš„äº‹ä»¶ä¸æŸäº›å‡½æ•°ç»‘å®šï¼ŒclassName æ˜¯æ§ä»¶ç±»çš„åç§°ï¼Œæ¯”å¦‚ \u0026lsquo;Button\u0026rsquo; w.winfo_screenheight() ï¼Œè¿”å›å±å¹•å‚ç›´æ–¹å‘çš„åˆ†è¾¨ç‡ w.winfo_screenwidth() ï¼Œè¿”å›å±å¹•æ°´å¹³æ–¹å‘çš„åˆ†è¾¨ç‡ w.winfo_children() ï¼Œè¿”å›ä¸€ä¸ªåŒ…å«æ‰€æœ‰å­æ§ä»¶çš„åˆ—è¡¨ï¼Œä»ä½åˆ°é«˜æ’åº w.configure(option=value, \u0026hellip;) ï¼Œè®¾ç½®ä¸€ä¸ªæˆ–è€…å¤šä¸ªå±æ€§ 6. æ ‡å‡†å±æ€§ #6.1. åæ ‡ #Tkinter çš„åæ ‡ç³»ä»¥å·¦ä¸Šè§’ä¸ºåŸç‚¹ï¼Œæ¨ªè½´æ˜¯ x ï¼š\nTkinter è¿˜å®šä¹‰äº†ä¸€äº›å¸¸é‡ï¼Œç”¨äºæ§åˆ¶ç›¸å¯¹ä½ç½®ï¼Œæ¯”å¦‚æ ‡ç­¾å†…æ–‡å­—çš„å¯¹é½æ–¹å‘ç­‰ï¼Œä¸‹é¢æ˜¯è¿™äº›å¸¸é‡çš„ç¤ºæ„å›¾ï¼š\n6.2. å•ä½ #è®¸å¤šæ§ä»¶çš„é•¿åº¦ã€å®½åº¦ã€æˆ–è€…å…¶ä»–å°ºå¯¸çš„å•ä½å¯ä»¥æ˜¯åƒç´ ã€å­—ç¬¦ï¼Œä¹Ÿå¯ä»¥ç”¨å…¶ä»–å•ä½æè¿°ï¼Œåªéœ€åœ¨æ•°å­—çš„åé¢è·Ÿä¸Šå•ä½å³å¯ï¼š\nå•ä½ æè¿° c å˜ç±³ i è‹±å¯¸ m æ¯«ç±³ p æ‰“å°æœºçš„ç‚¹ 6.3. é¢œè‰² #Tkinter ä¸­çš„é¢œè‰²å¯ä»¥ç”¨ RGB å­—ç¬¦ä¸²è¡¨ç¤ºï¼š\nå­—ç¬¦ä¸² æè¿° #rgb æ¯ç§é¢œè‰²å å››ä½ #rrggbb æ¯ç§é¢œè‰²å å…«ä½ #rrrgggbbb æ¯ç§é¢œè‰²å åäºŒä½ æ¯”å¦‚ \u0026lsquo;#FFF\u0026rsquo; æ˜¯ç™½è‰²ï¼Œ\u0026rsquo;#000000\u0026rsquo; æ˜¯é»‘è‰²ï¼Œ\u0026rsquo;#FF0000\u0026rsquo; æ˜¯çº¢è‰²ã€‚è¿˜å¯ä»¥ä½¿ç”¨å·²ç»å®šä¹‰çš„æ ‡å‡†é¢œè‰²åç§°ï¼Œæ¯”å¦‚ \u0026lsquo;white\u0026rsquo; ï¼Œ \u0026lsquo;black\u0026rsquo; ï¼Œ \u0026lsquo;red\u0026rsquo; ï¼Œ \u0026lsquo;green\u0026rsquo; ï¼Œ \u0026lsquo;blue\u0026rsquo; ï¼Œ \u0026lsquo;cyan\u0026rsquo; ï¼Œ \u0026lsquo;yellow\u0026rsquo; å’Œ \u0026lsquo;magenta\u0026rsquo; ã€‚\n6.4. å‡ ä½•å­—ç¬¦ä¸² #å‡ ä½•å­—ç¬¦ä¸²æ˜¯æè¿°é¡¶å±‚çª—å£å¤§å°å’Œä½ç½®çš„æ ‡å‡†æ–¹æ³•ï¼Œé€šå¸¸çš„æ ¼å¼æ˜¯ 'wxhÂ±xÂ±y'ï¼Œç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼š\nw å’Œ h åˆ†åˆ«è¡¨ç¤ºå®½å’Œé«˜ï¼Œå•ä½æ˜¯åƒç´ ï¼Œç”¨ x è¿æ¥ï¼Œè¿™ä¸ªéƒ¨åˆ†æ˜¯å¿…é¡»çš„ å¦‚æœåé¢è·Ÿç€ +x ï¼Œè¡¨ç¤ºçª—å£çš„å·¦è¾¹æ¡†è·ç¦»å±å¹•å·¦è¾¹æ¡† x ä¸ªåƒç´ ï¼Œå¦‚æœæ˜¯ -x ï¼Œè¡¨ç¤ºçª—å£çš„å·¦è¾¹æ¡†è¶…å‡ºå±å¹•å·¦è¾¹æ¡† x ä¸ªåƒç´  å¦‚æœåé¢è¿˜æ­£å¸¸ +y ï¼Œè¡¨ç¤ºçª—å£çš„ä¸Šè¾¹æ¡†è·ç¦»å±å¹•ä¸Šè¾¹æ¡† y ä¸ªåƒç´ ï¼Œå¦‚æœæ˜¯ -y ï¼Œè¡¨ç¤ºçª—å£çš„ä¸Šè¾¹æ¡†è¶…å‡ºå±å¹•ä¸Šè¾¹æ¡† y ä¸ªåƒç´  7. æ§åˆ¶å˜é‡ #Tkinter çš„æ§åˆ¶å˜é‡æ˜¯ä¸€ç§ç‰¹å®šçš„å¯¹è±¡ï¼Œå®ƒçš„è¡Œä¸ºç±»ä¼¼ Python çš„æ™®é€šå˜é‡ï¼Œå°±æ˜¯å€¼çš„å®¹å™¨ã€‚å®ƒçš„ç‰¹æ®Šä¹‹å¤„æ˜¯å¯ä»¥ç”±ä¸€ç»„æ§ä»¶å…±äº«ï¼Œå¦‚æœæŸä¸ªæ§åˆ¶å˜é‡ c è°ƒç”¨ c.set() æ–¹æ³•æ”¹å˜äº†è‡ªå·±çš„å€¼ï¼Œé‚£ä¹ˆæ‰€æœ‰ä½¿ç”¨ c çš„æ§ä»¶éƒ½ä¼šè‡ªåŠ¨æ›´æ–°ã€‚æ§åˆ¶å˜é‡çš„ä½œç”¨æ˜¯ä¿å­˜æ§ä»¶ä¸Šçš„æŸäº›å€¼ã€‚æ§åˆ¶å˜é‡æœ‰ä¸‰ç§ï¼š\nv = tk.DoubleVar() # Holds a float; default value 0.0 v = tk.IntVar() # Holds an int; default value 0 v = tk.StringVar() # Holds a string; default value '' æ§åˆ¶å˜é‡æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼š\n.get() ï¼Œè¿”å›å˜é‡çš„å€¼ .set(value) ï¼Œè®¾ç½®å˜é‡çš„å€¼ ç”¨åˆ°æ§åˆ¶å˜é‡çš„æ§ä»¶åŒ…æ‹¬ï¼š\næ§ä»¶ å±æ€§ ç±»å‹ Button textvariable StringVar Entry textvariable StringVar Label textvariable StringVar Checkbutton variable IntVar Menubutton textvariable StringVar 8. ç„¦ç‚¹ï¼šå¼•å¯¼é”®ç›˜è¾“å…¥ #æŸä¸ªæ§ä»¶è¢«è®¾ä¸ºç„¦ç‚¹ï¼ˆfocusï¼‰ï¼Œæ„å‘³ç€é”®ç›˜è¾“å…¥ä¼šç›´æ¥ä½œç”¨äºè¿™ä¸ªæ§ä»¶ã€‚Tkinter å¯ä»¥è®¾ç½®æŸä¸ªæ§ä»¶ä¸ºé»˜è®¤ç„¦ç‚¹ï¼Œä¹Ÿå¯ä»¥è®¾ç½®å„ç§æ§ä»¶çš„ç„¦ç‚¹é¡ºåºï¼Œä¹Ÿå°±æ˜¯ç”¨ Tab é”®åˆ‡æ¢æ—¶çš„é¡ºåºã€‚\n9. äº‹ä»¶ï¼šå¯¹åˆºæ¿€åšå‡ºååº” #å‰é¢æˆ‘ä»¬éƒ½åœ¨æè¿°æ€ä¹ˆç»˜åˆ¶å›¾å½¢ç•Œé¢ï¼Œä¸‹é¢æˆ‘ä»¬è®¨è®ºå¦‚ä»Šå°†æ§ä»¶ä¸åå°åŠŸèƒ½è”ç³»èµ·æ¥ï¼Œè®©ç”¨æˆ·çš„æ“ä½œå¾—åˆ°å®é™…çš„åé¦ˆã€‚\näº‹ä»¶ï¼ˆeventï¼‰å°±æ˜¯åº”ç”¨ç¨‹åºä¸Šå‘ç”Ÿçš„äº‹æƒ…ï¼Œæ¯”å¦‚é”®ç›˜è¾“å…¥ã€é¼ æ ‡å•å‡»æˆ–è€…åŒå‡»ï¼Œåº”ç”¨ç¨‹åºåº”è¯¥å¯¹æ­¤ä½œå‡ºååº”ã€‚å¾ˆå¤šæ§ä»¶éƒ½æœ‰ä¸€äº›å†…ç½®çš„è¡Œä¸ºï¼Œæ¯”å¦‚æŒ‰é’®æŒ‰ä¸‹æ—¶ä¼šè°ƒç”¨ command æŒ‡å‘çš„å‡½æ•°ã€‚Tkinker å…è®¸ä¸ºä¸€ä¸ªæˆ–è€…å¤šä¸ªäº‹ä»¶å®šä¹‰ç›¸åº”çš„å¤„ç†æ–¹æ³•ï¼Œæœ‰ä¸‰ä¸­ç»‘å®šçº§åˆ«ï¼š\nå•ç‹¬ç»‘å®šï¼Œä¸ºä¸€ä¸ªæ§ä»¶ä¸Šå¯èƒ½å‘ç”Ÿçš„æŸäº›äº‹ä»¶ç»‘å®šä¸€ä¸ªæ–¹æ³•ï¼šw.bind(sequence=None, func=None, add=None) ï¼Œæ¯”å¦‚åœ¨ canvas æ§ä»¶é‡Œä¸º PageUp æŒ‰é”®ç»‘å®šä¸€ä¸ªç¿»é¡µåŠŸèƒ½çš„æ–¹æ³•ã€‚ åˆ†ç±»ç»‘å®šï¼Œä¸ºæ‰€ç”¨åŒç±»æ§ä»¶ä¸Šå¯èƒ½å‘ç”Ÿçš„æŸäº›äº‹ä»¶ç»‘å®šä¸€ä¸ªæ–¹æ³•ï¼šw.bind_class(className, sequence=None, func=None, add=None) ï¼Œæ¯”å¦‚åŒå‡»é¼ æ ‡æ—¶æ‰€æœ‰çš„æŒ‰é’®åŒæ—¶æŒ‰ä¸‹ã€‚ åº”ç”¨ç»‘å®šï¼Œä¸ºåº”ç”¨ä¸Šæ‰€æœ‰æ§ä»¶å¯èƒ½å‘ç”Ÿçš„æŸäº›äº‹ä»¶ç»‘å®šä¸€ä¸ªçŠ¯æ³•ï¼šw.bind_all(sequence=None, func=None, add=None) ã€‚ Tkinter ç”¨äº‹ä»¶åºåˆ—å­—ç¬¦ä¸²ï¼ˆsequenceï¼‰ çš„æ–¹å¼æè¿°äº‹ä»¶ï¼Œä¸€ä¸ªå­—ç¬¦ä¸²å¯ä»¥æè¿°ä¸€ä¸ªæˆ–è€…å¤šä¸ªäº‹ä»¶ï¼Œå­—ç¬¦ä¸²éµå¾ªå¦‚ä¸‹æ ¼å¼ï¼š\n\u0026lt;[modifier-]...type[-detail]\u0026gt; å­—ç¬¦ä¸²ç”±å°–æ‹¬å· \u0026lt;\u0026gt; åŒ…å›´ type æ˜¯å¿…é€‰é¡¹ï¼ŒæŒ‡äº‹ä»¶ç±»å‹ï¼Œä¾‹å¦‚æŒ‰é”®ï¼Œé¼ æ ‡ç­‰ modifier æ˜¯å¯é€‰é¡¹ï¼Œå¯ä»¥è¿ç»­è®¾ç½®å¤šä¸ªï¼Œä¸ type ç»„æˆæ··åˆä½“æ¥æè¿°ç»„åˆé”®ï¼Œä¾‹å¦‚æŒ‰ä¸‹ shift çš„æ—¶å€™å•å‡»é¼ æ ‡ detail æ˜¯å¯é€‰é¡¹ï¼Œæè¿°å…·ä½“æ˜¯å“ªä¸ªé”®ç›˜æŒ‰é”®ã€å“ªä¸ªé¼ æ ‡æŒ‰é”®ã€‚ ä¸‹é¢æ˜¯ä¸‰ä¸ªä¾‹å­ï¼š\nsequence æè¿° Button-1 æŒ‰ä¸‹é¼ æ ‡å·¦é”® KeyPress-H æŒ‰ä¸‹é”®ç›˜ä¸Šçš„ H é”® Control-Shift-KeyPress-H æŒ‰ä¸‹ control-shift-H ç»„åˆé”® 9.1. type #å¸¸ç”¨çš„äº‹ä»¶ç±»å‹ï¼š\nName Type æè¿° Activate 36 æ§ä»¶è¢«æ¿€æ´»ï¼Œè¿™ä¸ªäº‹ä»¶æ˜¯ç”±æ§ä»¶çš„ state å±æ€§å˜åŒ–å¼•èµ·çš„ Button 4 æŒ‰ä¸‹é¼ æ ‡ï¼Œå…·ä½“å“ªä¸ªé”®è¢«æŒ‰ä¸‹ç”± detail å†³å®šï¼ŒæŒ‰äº†å‡ æ¬¡ç”± modifier å†³å®š ButtonRelease 5 æ¾å¼€é¼ æ ‡ï¼Œé€šå¸¸æ¾å¼€æ—¶è§¦å‘äº‹ä»¶æ¯”æŒ‰ä¸‹æ—¶æ›´å¥½ Configure 22 æ§ä»¶çš„å¤§å°å‘ç”Ÿæ”¹å˜ Deactivate 37 æ§ä»¶çš„çŠ¶æ€ç”±æ¿€æ´»å˜ä¸ºä¸å¯ç”¨ï¼ˆç°è‰²ï¼‰ï¼Œè¿™ä¸ªäº‹ä»¶æ˜¯ç”±æ§ä»¶çš„ state å±æ€§å˜åŒ–å¼•èµ·çš„ Destroy 17 æ§ä»¶è¢«æ¯ç­ Enter 7 é¼ æ ‡ç§»åŠ¨åˆ°äº†æ§ä»¶ä¸Š Expose 12 æ§ä»¶ä»è¢«å…¶ä»–çª—å£é®æŒ¡çš„çŠ¶æ€å˜ä¸ºå¯è§æ—¶ FocusIn 9 æ§ä»¶è·å¾—è¾“å…¥ç„¦ç‚¹æ—¶ï¼Œè¿™ä¸ªäº‹ä»¶å¯ä»¥ç”±ç¨‹åºå†…éƒ¨äº§ç”Ÿï¼Œæ¯”å¦‚è°ƒç”¨ .focus_set() æ—¶ FocusOut 10 è¾“å…¥ç„¦ç‚¹ä»æ§ä»¶ä¸Šç§»å¼€æ—¶ï¼Œè¿™ä¸ªäº‹ä»¶å¯ä»¥ç”±ç¨‹åºå†…éƒ¨äº§ç”Ÿ KeyPress 2 æŒ‰ä¸‹é”®ç›˜æŒ‰é”®ï¼Œå…·ä½“å“ªä¸ªé”®è¢«æŒ‰ä¸‹ç”± detail å†³å®šï¼ŒæŒ‰äº†å‡ æ¬¡ç”± modifier å†³å®š KeyRelease 3 æ¾å¼€é”®ç›˜æŒ‰é”®ï¼Œ Leave 8 é¼ æ ‡ä»æ§ä»¶ä¸Šç§»å¼€ Map 19 æ§ä»¶å˜ä¸ºå¯è§æ—¶ï¼Œæ¯”å¦‚è°ƒç”¨ .grid() æ–¹æ³• Motion 6 åœ¨æ§ä»¶å†…ç§»åŠ¨é¼ æ ‡ MouseWheel 38 ä¸Šä¸‹ç§»åŠ¨é¼ æ ‡æ»šè½®ï¼Œåªåœ¨ Windows å’Œ macOS ä¸‹æœ‰æ•ˆï¼Œ Linux ä¸æ”¯æŒ Unmap 18 æ§ä»¶å˜ä¸ºä¸å¯è§çŠ¶æ€ï¼Œæ¯”å¦‚è°ƒç”¨ .grid_remove() æ–¹æ³• Visibility 15 åº”ç”¨ç¨‹åºçª—å£çš„ä¸€éƒ¨åˆ†åœ¨å±å¹•ä¸Šå˜ä¸ºå¯è§ 9.2. modifier #æ‰€æœ‰å¯é€‰çš„ modifier åç§°ï¼š\nmodifier æè¿° Alt æŒ‰ä½ Alt é”® Any è¡¨ç¤ºä»»æ„çš„ï¼Œç”¨äºæ¦‚å†µä¸€ç±»äº‹ä»¶ï¼Œæ¯”å¦‚ \u0026lsquo;\u0026rsquo; è¡¨ç¤ºæŒ‰ä¸‹ä»»æ„æŒ‰é”® Control æŒ‰ä½ control é”® Double åŒå‡»ï¼Œå³å¾ˆçŸ­çš„æ—¶é—´å†…è¿ç»­å‘ç”Ÿä¸¤æ¬¡ï¼Œä¾‹å¦‚ \u0026lsquo;\u0026rsquo; è¡¨ç¤ºåŒå‡»é¼ æ ‡å·¦é”® Lock æŒ‰ä¸‹ shift lock é”® Shift æŒ‰ä½ shift é”® Triple ä¸‰å‡»ï¼Œå³å¾ˆçŸ­çš„æ—¶é—´å†…è¿ç»­å‘ç”Ÿä¸‰æ¬¡ 9.3. detail #å¯¹äºé¼ æ ‡äº‹ä»¶ï¼Œ1 è¡¨ç¤ºé¼ æ ‡å·¦é”®ï¼Œ3 è¡¨ç¤ºé¼ æ ‡å³é”®ã€‚å¯¹äºé”®ç›˜äº‹ä»¶ï¼ŒTkinter æä¾›äº†å¤šç§æ–¹å¼è¯†åˆ«æŒ‰é”®ï¼Œè¿™å‡ ç§æ–¹å¼éƒ½æ˜¯ Event ç±»æ”¯æŒçš„å±æ€§ ï¼š\n.keysym è¡¨ç¤ºæŒ‰é”®çš„ç¬¦å·ï¼Œæœ‰çš„æŒ‰é”®æœ‰ä¸¤ä¸ªç¬¦å· .keycode è¡¨ç¤ºæŒ‰é”®çš„ç¼–ç ï¼Œä½†æ˜¯è¿™ç§ç¼–ç æ²¡æœ‰åŒºåˆ†åŒä¸€æŒ‰é”®ä¸Šçš„ä¸åŒç¬¦å·ï¼Œæ¯”å¦‚å°é”®ç›˜çš„æ•°å­— 2 (KP_2) å’Œå‘ä¸‹ç®­å¤´ (KP_Down) æ˜¯åŒä¸€ä¸ªæŒ‰é”®ï¼Œç¼–ç éƒ½æ˜¯ 88 ï¼Œä¹Ÿæ— æ³•åŒºåˆ†å¤§å°å†™ï¼Œæ‰€ä»¥ a å’Œ A çš„ç¼–ç æ˜¯ä¸€æ ·çš„ .keysym_num è¡¨ç¤ºä¸æŒ‰é”®ç¬¦å·ç›¸å¯¹åº”çš„ç¼–ç  ä¸‹è¡¨æ˜¯ç¾å¼ 101-key é”®ç›˜é€šç”¨å­—ç¬¦é›†çš„éƒ¨åˆ†ç¬¦å·ï¼š\n.keysym .keycode .keysym_num Key Alt_L 64 65513 The left-hand alt key Alt_R 113 65514 The right-hand alt key BackSpace 22 65288 backspace Cancel 110 65387 break Caps_Lock 66 65549 CapsLock Control_L 37 65507 The left-hand control key Control_R 109 65508 The right-hand control key Delete 107 65535 Delete Down 104 65364 â†“ End 103 65367 end Escape 9 65307 esc Execute 111 65378 SysReq F1 67 65470 Function key F1 F2 68 65471 Function key F2 Fi 66+i 65469+i Function key Fi F12 96 65481 Function key F12 Home 97 65360 home Insert 106 65379 insert Left 100 65361 â† Linefeed 54 106 Linefeed (control-J) KP_0 90 65438 0 on the keypad KP_1 87 65436 1 on the keypad KP_2 88 65433 2 on the keypad KP_3 89 65435 3 on the keypad KP_4 83 65430 4 on the keypad KP_5 84 65437 5 on the keypad KP_6 85 65432 6 on the keypad KP_7 79 65429 7 on the keypad KP_8 80 65431 8 on the keypad KP_9 81 65434 9 on the keypad KP_Add 86 65451 + on the keypad KP_Begin 84 65437 The center key (same key as 5) on the keypad KP_Decimal 91 65439 Decimal (.) on the keypad KP_Delete 91 65439 delete on the keypad KP_Divide 112 65455 / on the keypad KP_Down 88 65433 â†“ on the keypad KP_End 87 65436 end on the keypad KP_Enter 108 65421 enter on the keypad KP_Home 79 65429 home on the keypad KP_Insert 90 65438 insert on the keypad KP_Left 83 65430 â† on the keypad KP_Multiply 63 65450 Ã— on the keypad KP_Next 89 65435 PageDown on the keypad KP_Prior 81 65434 PageUp on the keypad KP_Right 85 65432 â†’ on the keypad KP_Subtract 82 65453 - on the keypad KP_Up 80 65431 â†‘ on the keypad Next 105 65366 PageDown Num_Lock 77 65407 NumLock Pause 110 65299 pause Print 111 65377 PrintScrn Prior 99 65365 PageUp Return 36 65293 The enter key (control-M). The name Enter refers to a mouse-related event, not a keypress; see Section 54, â€œEventsâ€ Right 102 65363 â†’ Scroll_Lock 78 65300 ScrollLock Shift_L 50 65505 The left-hand shift key Shift_R 62 65506 The right-hand shift key Tab 23 65289 The tab key Up 98 65362 â†‘ 10. ttk : ä¸»é¢˜æ§ä»¶ #ä» Tk 8.5 å¼€å§‹ï¼Œæ­£å¼åŠ å…¥äº† ttk æ¨¡å—ï¼Œè¿™ä¸ªæ¨¡å—å¯ä»¥æ›¿ä»£å¤§éƒ¨åˆ† Tkinter åŸæœ‰çš„æœºåˆ¶ï¼Œè€Œä¸”å¸¦æ¥äº†å¾ˆå¤šä¼˜åŠ¿ï¼š\nåœ¨ Tk 8.5 ä»¥å‰ï¼Œå¼€å‘è€…ç»å¸¸æŠ±æ€¨çš„å°±æ˜¯ Tkinter çš„ UI é£æ ¼æ— æ³•é€‚åº”æ“ä½œç³»ç»Ÿï¼Œæ˜¾å¾—å¾ˆéš¾çœ‹ã€‚ttk å¯ä»¥åœ¨è‡ªé€‚åº”ä¸åŒçš„æ“ä½œç³»ç»Ÿ UI é£æ ¼ï¼Œæ— éœ€ä¿®æ”¹ç¨‹åºä»£ç ã€‚ åŸæœ‰çš„æ§ä»¶éƒ½æœ‰ä¸€ä¸ª ttk çš„ç‰ˆæœ¬ï¼Œè¿˜å¢åŠ äº†ä¸€äº›æ–°çš„æ§ä»¶ å¸¦æ¥äº†æ›´åŠ ç®€åŒ–å’Œæ˜“äºæ“ä½œçš„æ§ä»¶å±æ€§ã€‚ æ¨èä½¿ç”¨å¦‚ä¸‹æ–¹å¼å¯¼å…¥ ttk æ¨¡å—ï¼š\nfrom tkinter import ttk è¿™æ ·çš„è¯ï¼Œttk.Label å°±è¡¨ç¤º Label æ§ä»¶ã€‚\n10.1. ttk.Button #æŒ‰é’®æ§ä»¶ï¼ŒåŸå‹ï¼š\nw = ttk.Button(parent, option=value, ...) å¸¸ç”¨å±æ€§ï¼š\ncommand ï¼ŒæŒ‰ä¸‹æŒ‰é’®æ˜¯è°ƒç”¨çš„å‡½æ•° image ï¼Œè®¾ç½®æŒ‰é’®ä¸Šæ˜¾ç¤ºçš„å›¾ç‰‡ text ï¼Œè®¾ç½®æŒ‰é’®ä¸Šæ˜¾ç¤ºçš„æ–‡å­— compound ï¼Œå¦‚æœåŒæ—¶è®¾ç½®äº† image å’Œ text ï¼Œè¯¥å±æ€§è®¾ç½®äº† image ç›¸å¯¹äº text çš„ä½ç½®ï¼Œæœ‰å››ä¸ªå¯é€‰å€¼ï¼štk.TOP (image åœ¨ text ä¸Šé¢) ï¼Œtk.BOTTOM (image åœ¨ text ä¸‹é¢) ï¼Œtk.LEFT (image åœ¨ text å·¦è¾¹) ï¼Œtk.RIGHT (image åœ¨ text å³è¾¹) textvariable ï¼Œæ§åˆ¶å˜é‡ StringVal width ï¼ŒæŒ‰é’®çš„å®½åº¦ï¼Œå•ä½æ˜¯å­—ç¬¦ä¸ªæ•°ï¼Œå¦‚æœæŒ‰é’®æ˜¾ç¤ºçš„æ˜¯å›¾ç‰‡ï¼Œåˆ™å•ä½æ˜¯åƒç´  underline ï¼Œè®¾ç½®ä¸€ä¸ªæ•°å­— n ï¼ŒæŒ‰é’®ä¸Šçš„ç¬¬ n ä¸ªå­—ç¬¦ä¼šæ˜¾ç¤ºä¸€æ¡ä¸‹åˆ’çº¿ style ï¼ŒåŸ Tkinter çš„æ ·å¼å±æ€§éƒ½è¢«è¿™ä¸ªå±æ€§ä»£æ›¿äº† å‡ºæ¥é€šç”¨æ–¹æ³•ï¼Œå®ƒè¿˜æœ‰ä¸€ä¸ªè‡ªå·±çš„æ–¹æ³•ï¼š\n.invoke() ï¼Œè°ƒç”¨ command æŒ‡å®šçš„å‡½æ•°ã€‚ 10.2. ttk.Entry #è¾“å…¥æ¡†ï¼Œå‡½æ•°åŸå‹ï¼š\nw = ttk.Entry(parent, option=value, ...) å¸¸ç”¨å±æ€§ï¼š\nwidth ï¼Œè¾“å…¥æ¡†èƒ½å¤Ÿå®¹çº³çš„å­—ç¬¦æ•°ï¼Œé»˜è®¤æ˜¯ 20 showï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¾“å…¥çš„å­—ç¬¦ä¼šç›´æ¥æ˜¾ç¤ºï¼Œå¦‚æœæ˜¯å¯†ç ï¼Œéœ€è¦éšè—ï¼Œå¯ä»¥è¦æ±‚è¾“å…¥çš„å­—ç¬¦éƒ½æ˜¾ç¤ºä¸ºæ˜Ÿå·ï¼š show='*' justify ï¼Œè¾“å…¥æ¡†å†…æ–‡æœ¬çš„å¯¹é½æ–¹å¼ï¼Œé»˜è®¤æ˜¯å·¦å¯¹é½ justify=tk.LEFT ï¼Œè¿˜å¯é€‰ tk.CENTER å’Œ tk.RIGHT validate ï¼Œè®¾ç½®æ£€æŸ¥è¾“å…¥æ¡†å†…å®¹çš„æ—¶æœº validatecommand ï¼Œè®¾ç½®ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œè´Ÿè´£æ£€æŸ¥è¾“å…¥æ¡†çš„å†…å®¹ textvariable ï¼Œä¸ºè¯¥å±æ€§è®¾ç½®ä¸€ä¸ªæ§åˆ¶å˜é‡ StringVar ç±»çš„å®ä¾‹ï¼Œå°±å¯ä»¥ç”¨ v.get() æ–¹æ³•å–å›è¾“å…¥æ¡†ä¸­å†…å®¹ï¼Œæˆ–è€…ç”¨ v.set(value) è®¾ç½®ï¼Œv å°±æ˜¯è¿™ä¸ªå®ä¾‹ style ï¼ŒåŸ Tkinter çš„æ ·å¼å±æ€§éƒ½è¢«è¿™ä¸ªå±æ€§ä»£æ›¿äº† ttk.Entry æ”¯æŒæ‰€æœ‰ ttk çš„é€šç”¨æ–¹æ³•å’Œ tk.Entry çš„æ–¹æ³•ã€‚\n10.3. ttk.Combobox #å¸¦ä¸‹æ‹‰èœå•çš„è¾“å…¥æ¡†ï¼Œå‡½æ•°åŸå‹ï¼š\nw = ttk.Combobox(parent, option=value, ...) å¸¸ç”¨å±æ€§ï¼š\nexportselection ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œé€‰ä¸­çš„å†…å®¹ä¼šè‡ªåŠ¨å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œè®¾ç½® exportselection=0 å¯ä»¥å…³é—­è¿™ä¸ªç‰¹æ€§ height ï¼Œè®¾ç½®ä¸‹æ‹‰èœå•ä¸­é€‰é¡¹çš„æœ€å¤§è¡Œæ•°ï¼Œé»˜è®¤æ˜¯ 20 ï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªå€¼ï¼Œä¼šè‡ªåŠ¨å‡ºç°æ»šåŠ¨æ¡ justify ï¼Œè¾“å…¥æ¡†å†…æ–‡æœ¬çš„å¯¹é½æ–¹å¼ï¼Œé»˜è®¤æ˜¯å·¦å¯¹é½ justify=tk.LEFT ï¼Œè¿˜å¯é€‰ tk.CENTER å’Œ tk.RIGHT postcommand ï¼Œè®¾ç½®ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå½“ç”¨æˆ·ç‚¹å‡»ä¸‹æ‹‰èœå•æ˜¯ä¼šè°ƒç”¨ï¼Œå¯ç”¨äºä¿®æ”¹ values å±æ€§ textvariable ï¼Œä¸ºè¯¥å±æ€§è®¾ç½®ä¸€ä¸ªæ§åˆ¶å˜é‡ StringVar ç±»çš„å®ä¾‹ï¼Œå°±å¯ä»¥ç”¨ v.get() æ–¹æ³•å–å›è¾“å…¥æ¡†ä¸­å†…å®¹ï¼Œæˆ–è€…ç”¨ v.set(value) è®¾ç½®ï¼Œv å°±æ˜¯è¿™ä¸ªå®ä¾‹ validate ï¼Œè®¾ç½®æ£€æŸ¥è¾“å…¥æ¡†å†…å®¹çš„æ—¶æœº validatecommand ï¼Œè®¾ç½®ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œè´Ÿè´£æ£€æŸ¥è¾“å…¥æ¡†çš„å†…å®¹ valuesï¼Œè®¾ç½®ä¸€ä¸ªå­—ç¬¦ä¸²åºåˆ—ï¼Œä½œä¸ºä¸‹æ‹‰èœå•ä¸­çš„é€‰é¡¹ width ï¼Œè¾“å…¥æ¡†èƒ½å¤Ÿå®¹çº³çš„å­—ç¬¦æ•°ï¼Œé»˜è®¤æ˜¯ 20 style ï¼ŒåŸ Tkinter çš„æ ·å¼å±æ€§éƒ½è¢«è¿™ä¸ªå±æ€§ä»£æ›¿äº† ttk.Combobox æ”¯æŒæ‰€æœ‰ ttk çš„é€šç”¨æ–¹æ³•å’Œ tk.Entry çš„æ–¹æ³•ï¼Œæ­¤å¤–è¿˜æ”¯æŒï¼š\n.current([index]) , .set(value) ï¼Œè®¾ç½®ç©ºé—´è¾“å…¥æ¡†ä¸­çš„å€¼ä¸º value ttk.Combobox çš„çŠ¶æ€ä¼šæ˜¾ç¤ºä¸åŒçš„è¡Œä¸ºç‰¹æ€§ã€‚æ§ä»¶çŠ¶æ€ç”±é€šç”¨æ–¹æ³• .instate() å’Œ .state() è®¾ç½®ã€‚å¦‚æœæ§ä»¶å¤„äº disabled çŠ¶æ€ï¼Œç”¨æˆ·æ— æ³•æ”¹å˜æ§ä»¶çš„å†…å®¹ï¼›å¦‚æœç©ºé—´å¤„äº !disabled \u0026amp; readonly çŠ¶æ€ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ä¸‹æ‹‰èœå•æ”¹å˜ç©ºé—´å†…å®¹ï¼Œä½†ä¸èƒ½ç›´æ¥è¾“å…¥ã€‚\n10.4. ttk.Frame #æ¡†æ¶æ§ä»¶ï¼Œå‡½æ•°åŸå‹ï¼š\nw = ttk.Frame(parent, option=value, ...) 10.5. ttk.Label #æ ‡ç­¾æ§ä»¶ï¼Œå‡½æ•°åŸå‹ï¼š\nw = ttk.Label(parent, option=value, ...) 10.6. ttk.LabelFrame #å¸¦æ ‡ç­¾çš„æ¡†æ¶ï¼Œå‡½æ•°åŸå‹ï¼š\nw = ttk.LabelFrame(parent, option=value, ...) 10.7. ttk.Notebook #æ ‡ç­¾é¡µæ§ä»¶ï¼Œå‡½æ•°åŸå‹ï¼š\nw = ttk.Notebook(parent, option=value, ...) 10.8. ttk.Menubutton #ä¸‹æ‹‰èœå•ï¼Œå‡½æ•°åŸå‹ï¼š\nw = ttk.Menubutton(parent, option=value, ...) 11. ttk çš„æ ·å¼å’Œä¸»é¢˜ #ç»˜åˆ¶ ttk æ§ä»¶åŒ…å«ä¸‰ä¸ªå±‚é¢çš„æŠ½è±¡æ¦‚å¿µï¼š\ntheme è¡¨ç¤ºä¸€ä¸ªåº”ç”¨ä¸­æ‰€æœ‰æ§ä»¶çš„è®¾è®¡ä¸»é¢˜\nstyle æè¿°äº†ä¸€ç§æ§ä»¶æœ¬èº«çš„æ˜¾ç¤ºæ–¹å¼ï¼Œä¸€ä¸ª theme æ˜¯ç”±å¤šç§ style ç»„æˆçš„ï¼Œä½ å¯ä»¥ä½¿ç”¨å†…ç½®çš„ style ï¼Œä¹Ÿå¯ä»¥æ–°å»ºè‡ªå·±çš„ style ã€‚\næ¯ä¸ª style éƒ½æ˜¯æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ª element ç»„æˆçš„ï¼Œä¸€ä¸ªæŒ‰é’®çš„ style é€šå¸¸æœ‰å››ä¸ª element ï¼šå¤–è¾¹æ¡†ï¼Œèšç„¦æ—¶çš„é¢œè‰²å˜åŒ–ï¼Œå†…è¾¹è·ï¼ŒæŒ‰é’®æ ‡ç­¾ï¼ˆæ–‡æœ¬æˆ–è€…å›¾ç‰‡ï¼‰ï¼š\nä¸‹é¢ä¾æ¬¡è®¨è®ºå¦‚ä½•å¯»æ‰¾ã€ä½¿ç”¨å’Œå®šåˆ¶è¿™å‡ å±‚æ ·å¼ã€‚\n11.1. å¯»æ‰¾å¹¶ä½¿ç”¨ theme #ä¸æ ·å¼ç›¸å…³çš„æ“ä½œéƒ½éœ€è¦æ–°å»ºä¸€ä¸ª ttk.Style() ç±»çš„å®ä¾‹ï¼Œä¾‹å¦‚è·å–æ‰€æœ‰å¯ç”¨çš„ theme åˆ—è¡¨ï¼š\n\u0026gt;\u0026gt;\u0026gt; from tkinter import ttk \u0026gt;\u0026gt;\u0026gt; s=ttk.Style() \u0026gt;\u0026gt;\u0026gt; s.theme_names() ('aqua', 'clam', 'alt', 'default', 'classic') .theme_names() ä¼šè¿”å›ä¸€ä¸ªå…ƒç»„ï¼ŒåŒ…å«äº†æ‰€æœ‰å¯ç”¨çš„ theme ã€‚å¦‚æœè¦æŸ¥çœ‹å½“å‰é»˜è®¤çš„ theme ï¼Œç›´æ¥è°ƒç”¨ .theme_use() ï¼Œåœ¨å‚æ•°é‡ŒåŠ ä¸Š theme åå°±å¯ä»¥æ”¹å˜å½“å‰çš„ theme ï¼š\n\u0026gt;\u0026gt;\u0026gt; s.theme_use() 'aqua' \u0026gt;\u0026gt;\u0026gt; s.theme_use('default') \u0026gt;\u0026gt;\u0026gt; s.theme_use() 'default' 11.2. ä½¿ç”¨å’Œå®šåˆ¶ style #å¯¹äºä¸€ä¸ªç»™å®šçš„ theme ï¼Œä¸ºæ¯ä¸€ç§æ§ä»¶éƒ½å®šä¹‰äº†é»˜è®¤çš„ style ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªç±»ï¼Œæ¯ä¸ª style ç±»åå°±æ˜¯æ§ä»¶ååŠ ä¸Šå‰ç¼€ \u0026ldquo;T\u0026rdquo; ï¼Œä¸‹è¡¨æ˜¯ ttk æ§ä»¶å¯¹åº”çš„ style åç§°ï¼š\nWidget class Style name Button TButton Checkbutton TCheckbutton Combobox TCombobox Entry TEntry Frame TFrame Label TLabel LabelFrame TLabelFrame Menubutton TMenubutton Notebook TNotebook PanedWindow TPanedwindow (not TPanedWindow!) Progressbar Horizontal.TProgressbar or Vertical.TProgressbar, depending on the orient option. Radiobutton TRadiobutton Scale Horizontal.TScale or Vertical.TScale, depending on the orient option. Scrollbar Horizontal.TScrollbar or Vertical.TScrollbar, depending on the orient option. Separator TSeparator Sizegrip TSizegrip Treeview Treeview (not TTreview!) è¿è¡Œæ—¶å¯ä»¥è°ƒç”¨æ§ä»¶çš„ .winfo_class() æ–¹æ³•è·å¾—å½“å‰ä½¿ç”¨çš„ style ç±»åï¼š\n\u0026gt;\u0026gt;\u0026gt; b=ttk.Button(None) \u0026gt;\u0026gt;\u0026gt; b.winfo_class() 'TButton' style ç±»åæœ‰ä¸¤ç§æ ¼å¼ï¼š\nå¯¹åº”å†…ç½®çš„ sytle éƒ½æ˜¯ä¸€ä¸ªå•è¯ï¼Œä¾‹å¦‚ \u0026lsquo;TButton\u0026rsquo; æˆ–è€… \u0026lsquo;TFrame\u0026rsquo; åœ¨å†…ç½® style ä¹‹ä¸Šæ–°å»ºçš„ style é‡‡ç”¨è¿™æ ·çš„æ ¼å¼ï¼š \u0026rsquo;newName.oldName\u0026rsquo; ï¼Œä¾‹å¦‚ä¸ºè¾“å…¥æ—¥æœŸçš„ Entry æ§ä»¶æ–°å»ºä¸€ä¸ª style å¯ä»¥å‘½åä¸º \u0026lsquo;Date.TEntry\u0026rsquo; æ¯ä¸ª style éƒ½å®šä¹‰äº†ä¸€å¥—ç›¸åº”çš„å±æ€§ï¼Œä¾‹å¦‚æŒ‰é’®æœ‰ä¸€ä¸ª foreground å±æ€§ç”¨äºè®¾ç½®æŒ‰é’®ä¸Šæ–‡å­—çš„é¢œè‰²ã€‚å¯ä»¥è°ƒç”¨ ttk.Style() ç±»çš„ .configure() æ–¹æ³•è°ƒèŠ‚è¿™äº›å±æ€§ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ style ç±»åï¼Œä¹‹åæ˜¯è¦ä¿®æ”¹çš„å±æ€§å’Œç›¸åº”çš„å€¼ï¼Œä¾‹å¦‚æŠŠæŒ‰é’®ä¸Šçš„æ–‡å­—æ”¹æˆç»¿è‰²ï¼š\ns.configure('TButton', foreground='green') è¿™ä¸ªæ–¹æ³•è¿˜å¯ä»¥ç”¨æ¥æ–°å»º style ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å®šä¹‰æ–° style ç±»çš„åç§° \u0026rsquo;newName.oldName\u0026rsquo; ï¼Œä¾‹å¦‚æ–°å»ºä¸€ä¸ª Style ï¼ŒæŒ‰é’®ä¸Šçš„æ–‡å­—æ˜¯çº¢è¤è‰²ï¼š\ns = ttk.Style() s.configure('Kim.TButton', foreground='maroon') ç„¶åå°±å¯ä»¥ç”¨è¿™ä¸ªæ–°çš„ style æ–°å»ºä¸€ä¸ªæŒ‰é’®ï¼š\nself.b = ttk.Button(self, text='Friday', style='Kim.TButton',command=self._fridayHandler) ä½ ç”šè‡³å¯ä»¥æ„å»ºä¸€å¥—å¤šçº§ style ã€‚ä¾‹å¦‚æ–°å»ºä¸€ä¸ªåå« \u0026lsquo;Panic.Kim.TButton\u0026rsquo; çš„ style ï¼Œå®ƒä¼šç»§æ‰¿ \u0026lsquo;Kim.TButton\u0026rsquo; çš„æ‰€æœ‰å±æ€§ï¼Œttk è¦ä½¿ç”¨æŸä¸ªå±æ€§æ—¶ï¼Œé¦–å…ˆåœ¨ \u0026lsquo;Panic.Kim.TButton\u0026rsquo; å¯»æ‰¾ï¼Œå¦‚æœæ²¡æ‰¾åˆ°ï¼Œä¼šä¸Šæº¯åˆ° \u0026lsquo;Kim.TButton\u0026rsquo; ï¼Œå¦‚æœè¿˜æ‰¾ä¸åˆ°ï¼Œå†ä¸Šæº¯åˆ° \u0026lsquo;TButton\u0026rsquo; ä¸­å¯»æ‰¾ã€‚\nè¿˜å­˜åœ¨ä¸€ä¸ª root style å«åš \u0026lsquo;.\u0026rsquo; ï¼Œé…ç½®è¿™ä¸ª style çš„æŸä¸ªå±æ€§ä¼šå¯¹æ‰€æœ‰æ§ä»¶ç”Ÿæ•ˆã€‚å‡è®¾æˆ‘ä»¬æƒ³è¦æ‰€æœ‰çš„æ–‡æœ¬éƒ½ä½¿ç”¨ 12-point Helvetica å­—ä½“ï¼Œå¯ä»¥è¿™æ ·é…ç½®ï¼š\ns = ttk.Style() s.configure('.', font=('Helvetica', 12)) 11.3. element #ä¸€ä¸ªæ§ä»¶æ˜¯ç”±å¤šç§ element ç»„æˆçš„ï¼Œæ§ä»¶å°±åƒä¸€ä¸ªâ€œç©ºè…”â€ï¼Œè…”ä½“å†…çš„ç©ºé—´ç”± element å¡«å……ã€‚ä»¥ classic theme ä¸ºä¾‹ï¼Œä¸€ä¸ªæŒ‰é’®æ‹¥æœ‰å››ä¸ªåŒå¿ƒ element ï¼Œä»å¤–éƒ½å†…åˆ†åˆ«æ˜¯ focus highlight ï¼Œ border ï¼Œ padding å’Œ label ã€‚æ¯ä¸ª element éƒ½æœ‰ä¸€ä¸ª \u0026lsquo;sticky\u0026rsquo; å±æ€§ï¼Œå®ƒçš„ä½œç”¨æ˜¯å‘Šè¯‰è¿™ä¸ª element å¦‚ä½•å¡«å……å½“å‰çš„è…”ä½“ï¼Œå¦‚æœä¸€ä¸ª element çš„ sticky=\u0026lsquo;ew\u0026rsquo; ï¼Œæ„å‘³ç€è¿™ä¸ª element åº”è¯¥å·¦å³æ–¹å‘æ’‘å¼€ï¼Œç´§è´´è…”ä½“å·¦å³è¾¹ã€‚\nå¤§éƒ¨åˆ†å†…ç½®çš„ style ä½¿ç”¨ layout æ¦‚å¿µæ¥ç»„ç»‡è…”ä½“å†…çš„ element ï¼Œè¦è·å–æŸä¸ª style å†…çš„ element æ˜¾ç¤ºæ–¹å¼ï¼Œå¯ä»¥è°ƒç”¨ .layout() æ–¹æ³•ï¼š\nS.layout(styleName) è¯¥å‡½æ•°è¿”å›ä¸€ä¸ªåˆ—è¡¨ï¼Œåˆ—è¡¨å†…çš„å…ƒç´ éƒ½æ˜¯æè¿° element æ˜¾ç¤ºæ–¹å¼çš„å…ƒç»„ï¼Œå…ƒç»„çš„æ ¼å¼æ˜¯ (eltName, d) ï¼ŒeltName æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œ element çš„åç§°ï¼Œd æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œæè¿° element æ˜¾ç¤ºæ–¹å¼çš„ä¸€äº›å±æ€§ï¼Œæ¯”å¦‚ï¼š\n\u0026lsquo;sticky\u0026rsquo; ï¼Œå±æ€§å–å€¼æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæè¿°å½“å‰ element åœ¨ç›¸å¯¹çˆ¶ element çš„ä½ç½®ï¼Œå¯ä»¥ä¸ºç©ºï¼Œæˆ–è€…æœ‰ \u0026rsquo;n\u0026rsquo; ï¼Œ \u0026rsquo;s\u0026rsquo; ï¼Œ \u0026rsquo;e\u0026rsquo; å’Œ \u0026lsquo;w\u0026rsquo; å››ä¸ªå­—ç¬¦ç»„æˆï¼Œåˆ†åˆ«ä»£è¡¨å››ä¸ªæ–¹å¼çš„å¯¹é½æ–¹å¼ \u0026lsquo;side\u0026rsquo; ï¼Œå¦‚æœå½“å‰ element æ‹¥æœ‰å¤šä¸ªå­ element ï¼Œè¯¥å±æ€§çš„å–å€¼å®šä¹‰äº†è¿™äº›å­ element çš„å¯¹é½æ–¹å¼ï¼Œå¯é€‰ \u0026rsquo;left\u0026rsquo; ï¼Œ \u0026lsquo;right\u0026rsquo; ï¼Œ \u0026rsquo;top\u0026rsquo; æˆ–è€… \u0026lsquo;bottom\u0026rsquo; \u0026lsquo;children\u0026rsquo; ï¼Œå¦‚æœå½“å‰ element ä¸‹è¿˜æœ‰å­ element ï¼Œå¯ä»¥ä½¿ç”¨ç›¸åŒæ ¼å¼çš„åˆ—è¡¨æè¿° ä¸‹é¢ä»¥ classic theme çš„æŒ‰é’®æ§ä»¶ä¸ºä¾‹åˆ†æå®ƒçš„ Layoutï¼š\n\u0026gt;\u0026gt;\u0026gt; from tkinter import ttk \u0026gt;\u0026gt;\u0026gt; s = ttk.Style() \u0026gt;\u0026gt;\u0026gt; s.theme_use('classic') \u0026gt;\u0026gt;\u0026gt; b = ttk.Button(None,text=\u0026quot;Yo\u0026quot;) \u0026gt;\u0026gt;\u0026gt; bClass = b.winfo_class() \u0026gt;\u0026gt;\u0026gt; bClass 'TButton' \u0026gt;\u0026gt;\u0026gt; layout = s.layout('TButton') \u0026gt;\u0026gt;\u0026gt; layout [('Button.highlight', {'sticky': 'nswe', 'children': [('Button.border', {'sticky': 'nswe', 'border': '1', 'children': [('Button.padding', {'sticky': 'nswe', 'children': [('Button.label', {'sticky': 'nswe'})]})]})]})] è¿™é‡Œæˆ‘ä»¬æ–°å»ºäº†ä¸€ä¸ªæŒ‰é’®ï¼Œä½†æ˜¯æ²¡æœ‰æ˜¾ç¤ºå‡ºæ¥ï¼Œè¦è®©å®ƒåœ¨çª—å£æ˜¾ç¤ºéœ€è¦è°ƒç”¨ .grid() æ–¹æ³•ã€‚Button æ§ä»¶çš„ style æ˜¯ TButton ï¼Œå®ƒçš„ element åˆ†ä¸ºå››å±‚ï¼š\n[('Button.highlight', {'sticky': 'nswe', 'children': [('Button.border', {'sticky': 'nswe', 'border': '1', 'children': [('Button.padding', {'sticky': 'nswe', 'children': [('Button.label', {'sticky': 'nswe'})]} )]} )]} )] æœ‰å¤–åˆ°å†…ï¼š\næœ€å¤–å±‚æ˜¯ highlight ï¼Œsticky=\u0026lsquo;nswe\u0026rsquo; è¡¨ç¤ºå››ä¸ªæ–¹å‘éƒ½æ’‘æ»¡ ç¬¬äºŒå±‚æ˜¯ border ï¼Œå®ƒæœ‰ä¸€ä¸ª border=\u0026lsquo;1\u0026rsquo; çš„å±æ€§ï¼Œè¡¨ç¤ºè¾¹æ¡†å®½åº¦ä¸€ä¸ªåƒç´  ç¬¬ä¸‰å±‚æ˜¯ padding ï¼Œè¡¨ç¤ºå†…è¾¹è·ï¼Œé»˜è®¤æ˜¯ 0 æœ€é‡Œé¢æ˜¯ label ï¼Œæ˜¾ç¤ºæŒ‰é’®ä¸Šçš„æ–‡å­—æˆ–è€…å›¾ç‰‡ï¼Œä¹Ÿæ˜¯å››ä¸ªæ–¹å‘æ’‘æ»¡ æ¯ä¸ª element éƒ½ç”±ä¸€ä¸ªå­—å…¸æè¿°å„è‡ªçš„å±æ€§ï¼Œè¿™äº›å±æ€§çš„åå­—éƒ½æ˜¯æ²¿ç”¨è‡ª Tkinter ï¼Œéƒ½å¯ä»¥ç”¨ s.configure() æ–¹æ³•é…ç½®ã€‚è¦è·å–è¿™äº›å±æ€§çš„åå­—å¯ä»¥è°ƒç”¨ï¼š\nS.element_options(elementName) å‡½æ•°è¿”å›ä¸€ä¸ªåˆ—è¡¨ï¼š\n\u0026gt;\u0026gt;\u0026gt; d = s.element_options('Button.highlight') \u0026gt;\u0026gt;\u0026gt; d ('highlightcolor', 'highlightthickness') è¦æ‰¾å‡ºæŸä¸ªå±æ€§çš„å€¼å¯ä»¥è°ƒç”¨ï¼š\ns.lookup(layoutName, optName) ç»§ç»­å‰é¢çš„ä¾‹å­ï¼š\n\u0026gt;\u0026gt;\u0026gt; s.lookup('Button.highlight', 'highlightthickness') 1 \u0026gt;\u0026gt;\u0026gt; s.lookup('Button.highlight', 'highlightcolor') '#d9d9d9' \u0026gt;\u0026gt;\u0026gt; s.element_options('Button.label') ('compound', 'space', 'text', 'font', 'foreground', 'underline', 'width', 'anchor', 'justify', 'wraplength', 'embossed', 'image', 'stipple', 'background') \u0026gt;\u0026gt;\u0026gt; s.lookup('Button.label', 'foreground') 'black' 12. ttk çš„é€šç”¨æ–¹æ³• # w.cget(option) ï¼Œè¿”å›æŸä¸ªå±æ€§çš„å€¼\nw.configure(option=value, \u0026hellip;) ï¼Œè®¾ç½®æŸä¸ªå±æ€§çš„å€¼ï¼Œå¦‚æœæ²¡æœ‰å‚æ•°ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªå­—å…¸ï¼Œè®°å½•äº†è¯¥æ§ä»¶æ‰€æœ‰å±æ€§ï¼Œå±æ€§çš„å€¼ä¿æŒåœ¨ä¸€ä¸ªå…ƒç»„ï¼Œæ ¼å¼ (name, dbName, dbClass, default, current)ï¼Œä¾‹å¦‚ï¼š\n\u0026gt;\u0026gt;\u0026gt; from tkinter import ttk \u0026gt;\u0026gt;\u0026gt; b=ttk.Button(text=\u0026quot;Yo\u0026quot;) \u0026gt;\u0026gt;\u0026gt; b.configure() {'takefocus': ('takefocus', 'takeFocus', 'TakeFocus', '', 'ttk::takefocus'), 'command': ('command', 'command', 'Command', '', ''), 'default': ('default', 'default', 'Default', \u0026lt;index object: 'normal'\u0026gt;, \u0026lt;index object: 'normal'\u0026gt;), 'text': ('text', 'text', 'Text', '', 'Yo'), 'textvariable': ('textvariable', 'textVariable', 'Variable', '', ''), 'underline': ('underline', 'underline', 'Underline', -1, -1), 'width': ('width', 'width', 'Width', '', ''), 'image': ('image', 'image', 'Image', '', ''), 'compound': ('compound', 'compound', 'Compound', \u0026lt;index object: 'none'\u0026gt;, \u0026lt;index object: 'none'\u0026gt;), 'padding': ('padding', 'padding', 'Pad', '', ''), 'state': ('state', 'state', 'State', \u0026lt;index object: 'normal'\u0026gt;, \u0026lt;index object: 'normal'\u0026gt;), 'cursor': ('cursor', 'cursor', 'Cursor', '', ''), 'style': ('style', 'style', 'Style', '', ''), 'class': ('class', '', '', '', '')} .state(stateSpec=None) ï¼Œè·å–ã€è®¾ç½®æˆ–è€…æ¸…ç©ºå½“å‰çš„çŠ¶æ€\n13. ttk çš„æ§ä»¶çŠ¶æ€ #ttk çš„æ§ä»¶æœ‰ä¸€å¥— state flagsï¼Œç”¨äºæŒ‡ç¤ºæ§ä»¶çš„çŠ¶æ€ï¼Œè¿™äº›çŠ¶æ€éƒ½å¯ä»¥ç¼–ç¨‹æ‰“å¼€æˆ–è€…å…³é—­ï¼Œä¸‹è¡¨æ˜¯å„ç§çŠ¶æ€çš„å«ä¹‰ï¼š\nstate æè¿° active é¼ æ ‡æŒ‡é’ˆæ­£å¤„äºæ§ä»¶å†… alternate è¯¥çŠ¶æ€ä¸ºåº”ç”¨ç¨‹åºä¿ç•™ background Under Windows or MacOS, the widget is located in a window that is not the foreground window. disabled ç¦ç”¨æ§ä»¶ focus æ§ä»¶å¤„äºèšç„¦çŠ¶æ€ invalid æ§ä»¶çš„å†…å®¹æ— æ•ˆ pressed æ§ä»¶è¢«æŒ‰ä¸‹ readonly åªè¯» selected æ§ä»¶è¢«é€‰ä¸­ å¾ˆå¤šæ–¹æ³•éƒ½é€šè¿‡ä¸€ä¸ª stateSpec å‚æ•°æ¥è®¿é—® state ã€‚è¿™ä¸ªå‚æ•°å¯ä»¥æ˜¯ä»¥ä¸‹çš„å€¼ï¼š\nA single state name such as \u0026lsquo;pressed\u0026rsquo;. A ttk.Button widget is in this state, for example, when the mouse cursor is over the button and mouse button 1 is down. A single state name preceded with an exclamation point (!); this matches the widget state only when that state is off. For example, a stateSpec argument \u0026lsquo;!pressed\u0026rsquo; specifies a widget that is not currently being pressed. A sequence of state names, or state names preceded by an \u0026lsquo;!\u0026rsquo;. Such a stateSpec matches only when all of its components match. For example, a stateSpec value of (\u0026rsquo;!disabled\u0026rsquo;, \u0026lsquo;focus\u0026rsquo;) matches a widget only when that widget is not disabled and it has focus. 14. æ¨¡å—åŒ–ç¼–ç¨‹ #å‰é¢æˆ‘ä»¬éƒ½æ˜¯åœ¨ä¸»ç¨‹åºé‡Œï¼Œç”¨å‡½æ•°ä¸€æ­¥æ­¥æ–°å»ºæ§ä»¶ï¼Œç»˜åˆ¶ç•Œé¢ï¼Œå¦‚æœç•Œé¢å¾ˆå¤æ‚ï¼Œè¿™ç§æ–¹å¼å°±å˜çš„éå¸¸éº»çƒ¦ï¼Œç»“æ„ä¹Ÿä¸æ¸…æ™°ï¼Œéš¾ä»¥ç»´æŠ¤ã€‚ä¸€ä¸ªå¥½çš„ç¼–ç¨‹æ–¹æ³•åº”è¯¥æ¨¡å—åŒ–çš„ï¼ŒæŒ‰ç•Œé¢çš„å¸ƒå±€åˆ’åˆ†ä¸åŒçš„æ¨¡å—ï¼Œå®ç°ä¸åŒçš„ç±»ï¼Œæ¯ä¸ªç±»é‡Œé›†æˆäº†æ¨¡å—ä¸Šçš„æ‰€æœ‰æ§ä»¶ï¼Œå®ç°å¯¹æ§ä»¶çš„æ“ä½œæ–¹æ³•ï¼Œç„¶åè¿™ä¸ªæ¨¡å—å°±å¯ä»¥æ–°å»ºä¸åŒçš„å®ä¾‹ï¼Œæ”¾åœ¨ä¸åŒçš„ä½ç½®ã€‚é€šå¸¸ç”¨æˆ·æ–°å»ºçš„ç±»å¯ä»¥ä» tk.Frame ç»§æ‰¿ï¼Œä¸‹é¢æ˜¯ç®€å•çš„ä¾‹å­ï¼š\nimport tkinter as tk from tkinter import ttk class application(ttk.Frame): #æ–°å»º application ç±»ï¼Œç»§æ‰¿äº† ttk.Frame def __init__(self, parent=None): #åˆå§‹åŒ–å‡½æ•°ï¼Œæ ¹æ®æ¨¡å—æ‰€å¤„çš„ä½ç½®è®¾ç½®çˆ¶ç±»ï¼Œé»˜è®¤ä¸ºç©º ttk.Frame.__init__(self, parent) self.grid() #æ˜¾ç¤ºè¿™ä¸ªæ¨¡å— self._createWidgets() #æ–°å»ºæ¨¡å—ä¸Šçš„æ§ä»¶ def _createWidgets(self): self.button = ttk.Button(self, text='Quit', command=self.quit) self.button.grid() window = tk.Tk() #æ–°å»ºä¸€ä¸ªçª—å£ window.title('Sample application') app = application(window) #åœ¨çª—å£ä¸Šæ”¾ä¸€ä¸ª application æ¨¡å— window.mainloop() å‚è€ƒ # Tkinter 8.5 reference: a GUI for Python TkDocs pyinstaller Docs ","date":"2017 December 18","permalink":"/posts/2017/12/18/","section":"Posts","summary":"0. å¼€å§‹ #Tkinter æ˜¯ Python å†…ç½®çš„ GUI æ¡†æ¶ï¼Œå®‰è£…å Python åå³å¯ä½¿ç”¨ï¼š","title":"Tkinter å­¦ä¹ ç¬”è®°"},{"content":"1. sysconfig() #sysconfig() æ˜¯è·å–ç³»ç»Ÿè¿è¡Œæ—¶é…ç½®ä¿¡æ¯çš„å‡½æ•°ï¼ŒåŒ…æ‹¬å†…å­˜ã€CPU ç­‰ã€‚å‡½æ•°å£°æ˜ï¼š\n#include \u0026lt;unistd.h\u0026gt; long sysconf(int name); å‚æ•° name ç”¨äºæŒ‡ç¤ºè¦è·å–çš„ä¿¡æ¯ï¼Œé€šè¿‡è¿”å›å€¼å°†ç»“æœè¿”å›ã€‚æ–°å»ºä¸€ä¸ª test.c ï¼Œè·å–å½“å‰ç³»ç»Ÿçš„ä¿¡æ¯ï¼š\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;unistd.h\u0026gt; #define ONE_MB (1024 * 1024) int main() { printf(\u0026#34;The number of processors configured is :%ld\\n\u0026#34;, sysconf(_SC_NPROCESSORS_CONF)); printf(\u0026#34;The number of processors currently online (available) is :%ld\\n\u0026#34;, sysconf(_SC_NPROCESSORS_ONLN)); printf(\u0026#34;The pagesize: %ld\\n\u0026#34;, sysconf(_SC_PAGESIZE)); printf(\u0026#34;The number of pages: %ld\\n\u0026#34;, sysconf(_SC_PHYS_PAGES)); printf(\u0026#34;The number of available pages: %ld\\n\u0026#34;, sysconf(_SC_AVPHYS_PAGES)); printf(\u0026#34;The memory size: %lld MB\\n\u0026#34;, (long long)sysconf(_SC_PAGESIZE) * (long long)sysconf(_SC_PHYS_PAGES) / ONE_MB ); printf(\u0026#34;The number of files max opened:: %ld\\n\u0026#34;, sysconf(_SC_OPEN_MAX)); printf(\u0026#34;The number of ticks per second: %ld\\n\u0026#34;, sysconf(_SC_CLK_TCK)); printf(\u0026#34;The max length of host name: %ld\\n\u0026#34;, sysconf(_SC_HOST_NAME_MAX)); printf(\u0026#34;The max length of login name: %ld\\n\u0026#34;, sysconf(_SC_LOGIN_NAME_MAX)); return 0; } ç¼–è¯‘åæ‰§è¡Œï¼š\n$ gcc test.c $ ./a.out The number of processors configured is :1 The number of processors currently online (available) is :1 The pagesize: 4096 The number of pages: 221303 The number of available pages: 19370 The memory size: 864 MB The number of files max opened:: 1024 The number of ticks per second: 100 The max length of host name: 64 The max length of login name: 256 2. attribute #__attribute__ æ˜¯ GCC æä¾›çš„ä¸€ç§è¯­æ³•ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬åœ¨ç¼–è¯‘æ—¶å¯¹å£°æ˜çš„å‡½æ•°ã€å˜é‡å’Œç±»å‹åšä¸€äº›ç‰¹æ®Šå¤„ç†æˆ–è€…æ˜¯æ£€æŸ¥æ“ä½œï¼Œæå‡åŸç¨‹åºçš„æ€§èƒ½ã€‚è¯­æ³•æ ¼å¼ä¸º: __attribute__ ((attribute-list)) ï¼Œattribute-list æ˜¯æŒ‡ä»¤é›† , åˆ†ä¸ºä¸‰ç§ç±»å‹ï¼šå‡½æ•°å±æ€§ï¼Œå˜é‡å±æ€§ï¼Œç±»å‹å±æ€§ã€‚__attribute__ åº”è¯¥å‡ºç°åœ¨å‡½æ•°ã€å˜é‡å’Œç±»å‹å£°æ˜çš„ â€œ;â€ å‰ã€‚\n2.1. packed #packed ç”¨äºè®¾ç½®å˜é‡æˆ–è€…ç»“æ„ä½“æˆå‘˜ä»¥æœ€å°çš„å¯¹é½æ–¹å¼å¯¹é½ï¼Œå‡å°‘ç©ºé—´æµªè´¹ï¼Œä¾‹å¦‚ï¼š\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; struct foo1 { char a; int b[2]; }; struct foo2 { char a; int b[2]; } __attribute__((packed)); int main() { int s1 = sizeof(struct foo1); int s2 = sizeof(struct foo2); printf(\u0026#34;s1 = %d\\ns2 = %d\\n\u0026#34;,s1,s2); return 0; } è¿è¡Œç»“æœï¼š\ns1 = 12 s2 = 9 2.2. aligned(alignment) #aligned ç”¨äºæŒ‡å®šå˜é‡æˆ–è€…ç»“æ„ä½“æˆè¯­æŒ‰ç…§ alignment å­—èŠ‚å¤§å°å¯¹é½ã€‚å¦‚æœå¯¹é½é•¿åº¦æœ‰å¤§äº alignment çš„ï¼Œå°±æŒ‰ç…§æœ€å¤§å¯¹é½é•¿åº¦å¯¹é½ã€‚ä¾‹å¦‚ï¼š\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; struct foo1 { char a; int b[2]; }; struct foo2 { char a; int b[2] __attribute__((aligned(8))); }; int main() { int s1 = sizeof(struct foo1); int s2 = sizeof(struct foo2); printf(\u0026#34;s1 = %d\\ns2 = %d\\n\u0026#34;,s1,s2); return 0; } è¿è¡Œç»“æœï¼š\ns1 = 12 s2 = 16 2.3. constructor \u0026amp; destructor #å‡½æ•°å±æ€§ï¼Œè®¾ç½® constructor å¯ä»¥ä½¿å‡½æ•°åœ¨ main æ–¹æ³•ä¹‹å‰æ‰§è¡Œï¼Œè€Œè®¾ç½® destructor å¯ä»¥ä½¿å‡½æ•°åœ¨ main æ–¹æ³•ä¹‹åæ‰§è¡Œã€‚ä¾‹å¦‚ï¼š\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; void __attribute__((constructor)) fun1() { printf(\u0026#34;function 1\\n\u0026#34;); } void __attribute__((destructor)) fun2() { printf(\u0026#34;function 2\\n\u0026#34;); } int main() { printf(\u0026#34;Main\\n\u0026#34;); return 0; } è¿è¡Œç»“æœï¼š\nfunction 1 Main function 2 2.4. visibility #æ§åˆ¶ç¬¦å·å¯è§æ€§ï¼Œç”¨ä¸è®¾ç½®å‡½æ•°æ˜¯å¦è¢«å¯¼å‡ºï¼Œå¸¸ç”¨çš„æœ‰ä¸¤ä¸ªé€‰é¡¹ï¼š\n__attribute__((visibility(\u0026quot;default\u0026quot;))) ï¼Œç”¨å®ƒå®šä¹‰çš„ç¬¦å·å°†è¢«å¯¼å‡ºã€‚ __attribute__((visibility(\u0026quot;hidden\u0026quot;))) ï¼Œç”¨å®ƒå®šä¹‰çš„ç¬¦å·å°†ä¸è¢«å¯¼å‡ºï¼Œå…¶ä»–å¯¹è±¡æ— æ³•è°ƒç”¨ã€‚ 2.5 format #format ç”¨äºæ£€æŸ¥æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸å¯å˜å‚æ•° ... çš„åŒ¹é…æƒ…å†µï¼Œé˜²æ­¢å‡ºé”™ã€‚æ ‡å‡†è¯­æ³•æ˜¯ï¼š\nformat(archetype, string-index, first-to-check) archetype ç”¨äºæ£€æŸ¥æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ç±»å‹ï¼Œä¾‹å¦‚ printf å’Œ scanf ã€‚ string-index è¡¨ç¤ºä¼ å…¥å‡½æ•°çš„ç¬¬å‡ ä¸ªå‚æ•°æ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œä» 1 å¼€å§‹æ•°ã€‚ first-to-check è¡¨ç¤ºä»ä¼ å…¥å‡½æ•°çš„ç¬¬å‡ ä¸ªå‚æ•°å¼€å§‹æ£€æŸ¥ï¼Œä» 1 å¼€å§‹æ•°ã€‚ ä¾‹å¦‚ï¼š\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;stdarg.h\u0026gt; __attribute__((format(printf, 1, 2))) void mylog(const char *fmt, ...) { va_list ap; va_start(ap, fmt); (void)printf(fmt, ap); va_end(ap); } int main(void) { mylog(\u0026#34;value = %d\\n\u0026#34;, 8); mylog(\u0026#34;value = %d\\n\u0026#34;, \u0026#34;hello\u0026#34;); return 0; } ç¬¬äºŒæ¬¡è°ƒç”¨ mylog() æ—¶ï¼Œå› ä¸ºä¼ ç»™æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„å‚æ•° \u0026quot;hello\u0026quot; çš„ç±»å‹ä¸ç¬¦ï¼Œåœ¨ç¼–è¯‘ä¼šæŠ¥é”™ï¼š\n~$ gcc -Wall main.c -o main main.c: In function \u0026#39;main\u0026#39;: main.c:17:11: warning: format \u0026#39;%d\u0026#39; expects argument of type \u0026#39;int\u0026#39;, but argument 2 has type \u0026#39;char *\u0026#39; [-Wformat=] mylog(\u0026#34;value = %d\\n\u0026#34;, \u0026#34;hello\u0026#34;); 3. size_t #size_t æ˜¯ C/C++ æ ‡å‡†å®šä¹‰çš„æ•°æ®ç±»å‹ï¼Œæ— ç¬¦å·ï¼Œå®ƒåœ¨ä¸åŒçš„ç³»ç»Ÿä¸­å¤§å°æ˜¯ä¸ä¸€æ ·çš„ï¼Œ32 ä½ç³»ç»Ÿä¸­é€šå¸¸å®šä¹‰ä¸º unsigned int ï¼Œ4 Byte ï¼Œ64 ä½ç³»ç»Ÿä¸­é€šå¸¸å®šä¹‰ä¸º unsigned long ï¼Œ8 Byte ã€‚å®ƒçš„å«ä¹‰æ˜¯å½“å‰ç³»ç»Ÿå¯æ“ä½œçš„å†…å­˜æœ€å¤§å€¼ï¼Œé€šå¸¸ç”¨äºå†…å­˜ç›¸å…³çš„å˜é‡ï¼Œå¯ä»¥ç¡®ä¿ä¸ä¼šå› ä¸ºç±»å‹å¤ªå°å¯¼è‡´å˜é‡æº¢å‡ºï¼Œæé«˜ç¨‹åºçš„æœ‰æ•ˆæ€§å’Œå¯ç§»æ¤æ€§ã€‚ä¾‹å¦‚ï¼š\nvoid *malloc(size_t n) å¦‚æœæŠŠ n å®šä¹‰ä¸º unsigned int ï¼Œé‚£ä¹ˆåœ¨ 64 ä½ç³»ç»Ÿä¸­å°±æœ‰æº¢å‡ºçš„å¯èƒ½æ€§ã€‚å‚è€ƒä¸ºä»€ä¹ˆ size_t å¾ˆé‡è¦ ã€‚\n4. container_of #container_of æ˜¯ Linux å†…æ ¸å®šä¹‰çš„ä¸€ä¸ªå®ï¼Œåœ¨ linux/kernel.h ä¸­å£°æ˜ï¼Œå®ƒçš„ä½œç”¨æ˜¯é€šè¿‡ç»“æ„ä½“å˜é‡ä¸­æŸä¸ªæˆå‘˜çš„åœ°å€è·å¾—è¿™ä¸ªç»“æ„ä½“å˜é‡çš„åœ°å€ã€‚å®šä¹‰ï¼š\n#define container_of(ptr, type, member) ({ \\ const typeof( ((type *)0)-\u0026gt;member ) *__mptr = (ptr); \\ (type *)( (char *)__mptr - offsetof(type,member) );}) ä¸‰ä¸ªå‚æ•°åˆ†åˆ«è¡¨ç¤ºï¼š\nptr ï¼šç»“æ„ä½“æˆå‘˜å˜é‡ member çš„åœ°å€ type ï¼šç»“æ„ä½“ç±»å‹çš„åç§° member ï¼šç»“æ„ä½“ä¸­çš„æˆå‘˜å˜é‡çš„åç§° å®å®šä¹‰åŒ…å«ä¸¤æ¡è¯­å¥ï¼š\nconst typeof( ((type *)0)-\u0026gt;member ) *__mptr = (ptr); é¦–å…ˆå°† 0 è½¬åŒ–æˆ type ç±»å‹çš„æŒ‡é’ˆå˜é‡ï¼ˆæŒ‡å‘çš„åœ°å€ä¸º 0x0 ï¼‰ï¼Œç„¶åå†å¼•ç”¨ member æˆå‘˜ ((type *)0)-\u0026gt;member ) )ã€‚æ³¨æ„è¿™é‡Œçš„ typeof(x)ï¼Œæ˜¯è¿”å› x çš„æ•°æ®ç±»å‹ï¼Œé‚£ä¹ˆ typeof( ((type *)0)-\u0026gt;member ) å°±æ˜¯è¿”å› member æˆå‘˜çš„æ•°æ®ç±»å‹ã€‚é‚£ä¹ˆè¿™æ¡è¯­å¥æ•´ä½“å°±æ˜¯å®šä¹‰äº†ä¸€ä¸ª member æˆå‘˜çš„æ•°æ®ç±»å‹çš„æŒ‡é’ˆ __mptrï¼ŒæŒ‡å‘ ptr ï¼Œè€Œ ptr å°±æ˜¯ member çš„åœ°å€ã€‚\n(type *)( (char *)__mptr - offsetof(type,member) ); è¿™æ¡è¯­å¥ä¸­çš„ offsetof çš„ä½œç”¨æ˜¯è·å–ç»“æ„ä½“ä¸­æŸä¸ªæˆå‘˜çš„åç§»é‡ï¼Œé‚£ä¹ˆä» __mptr æŒ‡å‘çš„åœ°å€å‘å‰ offsetof ä¸ªå­—èŠ‚å°±æ˜¯ member æ‰€å±ç»“æ„ä½“å˜é‡çš„é¦–åœ°å€ã€‚offsetof çš„åŸå‹ï¼š\n#define offsetof(type, member) (size_t)\u0026amp;( ((type *)0)-\u0026gt;member ) type è¡¨ç¤ºç»“æ„ä½“çš„åç§°ï¼Œmember è¡¨ç¤ºæˆå‘˜å˜é‡çš„åç§°ã€‚(type *)0 å®šä¹‰äº†ä¸€ä¸ª type ç±»å‹çš„æŒ‡é’ˆï¼ŒæŒ‡å‘çš„åœ°å€æ˜¯ 0 ï¼Œé‚£ä¹ˆæˆå‘˜ member çš„åœ°å€å°±æ˜¯å®ƒåœ¨ç»“æ„ä½“å†…çš„åç§»é‡ã€‚\nä¸‹é¢è¿™ä¸ªå†ç¨‹å±•ç¤º container_of å’Œ offsetof çš„ç”¨æ³•ï¼š\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; #define offsetof(type, member) (size_t)\u0026amp;( ((type *)0)-\u0026gt;member ) #define container_of(ptr, type, member) ({ \\ const typeof( ((type *)0)-\u0026gt;member ) *__mptr = (ptr); \\ (type *)( (char *)__mptr - offsetof(type,member) );}) typedef struct foo { char a; int b; }foo; int main() { size_t off_set = 0; off_set = offsetof(foo, b); printf(\u0026#34;foo-\u0026gt;b offset: %lu\\n\u0026#34;,off_set); foo s ; printf(\u0026#34;s address : %lu\\n\u0026#34;,(size_t)\u0026amp;s); s.b = 10; foo *p = container_of(\u0026amp;(s.b), foo, b); printf(\u0026#34;p-\u0026gt;b value : %d\\n\u0026#34;, p-\u0026gt;b); printf(\u0026#34;p address : %lu\\n\u0026#34;, (size_t)p); return 0; } è¿è¡Œç»“æœï¼š\nfoo-\u0026gt;b offset: 4 s address : 140723509298320 p-\u0026gt;b value : 10 p address : 140723509298320 5. PID æ–‡ä»¶ #åœ¨ Linux ç³»ç»Ÿçš„ /var/run/ ç›®å½•ä¸‹å¯ä»¥çœ‹åˆ°å¾ˆå¤š *.pid æ–‡ä»¶ï¼Œå¾ˆå¤šç¨‹åºå¯åŠ¨åéƒ½ä¼šåœ¨è¯¥ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªè‡ªå·±çš„ PID æ–‡ä»¶ï¼Œè®°å½•è¯¥è¿›ç¨‹çš„ PID ï¼Œæ–¹ä¾¿ç®¡ç†è¿›ç¨‹ã€‚PID æ–‡ä»¶çš„å¦ä¸€ä¸ªä½œç”¨æ˜¯é˜²æ­¢è¿›ç¨‹å¯åŠ¨å¤šä¸ªå‰¯æœ¬ï¼Œè¿›ç¨‹å¯åŠ¨åæ–°å»º PID æ–‡ä»¶ï¼Œç„¶åä¸ºæ–‡ä»¶åŠ ç‹¬å çš„è®°å½•é”ï¼Œåªæœ‰è·å¾— PID æ–‡ä»¶å†™å…¥æƒé™ï¼ˆF_WRLCKï¼‰çš„è¿›ç¨‹æ‰å¯ä»¥å¯åŠ¨ï¼Œå¹¶å°†è‡ªèº«çš„ PID å†™å…¥æ–‡ä»¶ï¼Œé”å®šå¤±è´¥çš„è¿›ç¨‹å¯åŠ¨é€€å‡ºã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹ç¨‹ï¼š\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;unistd.h\u0026gt; #include \u0026lt;fcntl.h\u0026gt; #include \u0026lt;sys/types.h\u0026gt; #include \u0026lt;errno.h\u0026gt; #include \u0026lt;signal.h\u0026gt; #include \u0026lt;string.h\u0026gt; int run = 1; //é”å®šä¸€ä¸ªæ–‡ä»¶ï¼Œå‚æ•°æ˜¯æ–‡ä»¶æè¿°ç¬¦ï¼Œå‡ºé”™è¿”å› -1 int lockfile(int fd) { struct flock lock; lock.l_type = F_WRLCK; //ç‹¬å æ€§å†™é” lock.l_whence = SEEK_SET; //ä¸ºæ•´ä¸ªæ–‡ä»¶åŠ é” lock.l_start = 0; lock.l_len = 0; return fcntl(fd, F_SETLK, \u0026amp;lock); } //æ–°å»º PID æ–‡ä»¶å¹¶åŠ é”ï¼Œå‚æ•°æ˜¯ PID æ–‡ä»¶çš„è·¯å¾„å’Œå½“å‰è¿›ç¨‹çš„ PID ï¼Œå¤±è´¥è¿”å›è´Ÿæ•° int creat_pidfile(const char *pid_file, pid_t pid) { int fd = 0; fd = open(pid_file, O_RDWR|O_CREAT, (S_IRUSR | S_IWUSR | S_IRGRP | S_IROTH)); if(fd \u0026lt; 0) { printf(\u0026#34;ERROR: can not open pid file %s\\n\u0026#34;,pid_file); return -1; } if(lockfile(fd)\u0026lt;0) { if(errno==EACCES || errno==EAGAIN) { close(fd); printf(\u0026#34;WARNING: process already run\\n\u0026#34;); return 0; } printf(\u0026#34;ERROR: can not lock pid file: %s error: %s\\n\u0026#34;, pid_file, strerror(errno)); return -2; } if(dprintf(fd, \u0026#34;%d\u0026#34;, pid)\u0026lt;0) { close(fd); printf(\u0026#34;ERROR: write pid failed\\n\u0026#34;); return 0; } return fd; } int remove_pidfile(const char *pid_file, int fd) { close(fd); remove(pid_file); return 0; } void handle_sig(int signo) { if( (signo==SIGINT)|(signo==SIGTERM) ) run=0; } int main() { int fd = 0; const char *pid_file = \u0026#34;/var/run/test.pid\u0026#34;; fd = creat_pidfile(pid_file,getpid()); if(fd\u0026gt;0) close(fd); else { printf(\u0026#34;create pid file error\\n\u0026#34;); return -1; } signal(SIGINT,handle_sig); signal(SIGTERM,handle_sig); while(run) { sleep(5); } remove_pidfile(pid_file,fd); return 0; } 6. Debug #åœ¨æºæ–‡ä»¶é‡Œå£°æ˜ï¼š\n#ifdef __DEBUG__ #define DEBUG(format, ...) printr(\u0026#34;%03d: \u0026#34;format\u0026#34;\u0026#34;, __LINE__, ##__VA_ARGS__) #else #define DEBUG(format, ...) #endif è°ƒç”¨ DEBUG() çš„è¯­æ³•ä¸ printf() ä¸€æ ·ï¼Œç¼–è¯‘æ—¶åœ¨ gcc ä¸­å£°æ˜ -D __DEBUG__ å³å¯æ‰“å¼€è°ƒè¯•ä¿¡æ¯ã€‚\n","date":"2017 December 14","permalink":"/posts/2017/12/14/","section":"Posts","summary":"1. sysconfig() #sysconfig() æ˜¯è·å–ç³»ç»Ÿè¿è¡Œæ—¶é…ç½®ä¿¡æ¯çš„å‡½æ•°ï¼ŒåŒ…æ‹¬å†…å­˜ã€CPU ç­‰ã€‚å‡½æ•°å£°æ˜ï¼š","title":"Linux Program Tips"},{"content":"1. Soft Power #æ—©æœŸçš„è®¡ç®—æœºä¸»æ¿éƒ½æ˜¯ä½¿ç”¨ AT ç”µæºç®¡ç†æŠ€æœ¯ï¼ŒAT ç”µæºç³»ç»Ÿéå¸¸ç®€å•ï¼Œç”µæºé”®æ˜¯æœºæ¢°å¼å¼€å…³ï¼Œåªæœ‰å¼€é—­ä¸¤ç§çŠ¶æ€ï¼Œé—­åˆåç”µæµä»å¼€å…³ä¸Šæµè¿‡ä¸ºä¸»æ¿ä¾›ç”µï¼Œæ–­å¼€åä¸»æ¿ä¸Šçš„æ‰€æœ‰å™¨ä»¶åŒæ—¶æ–­ç”µï¼Œæ— æ³•å®ç°å¾…æœºã€è½¯å…³æœºç­‰åŠŸèƒ½ï¼Œè¿™ä¸ªæ—¶æœŸçš„ Windows ç³»ç»Ÿå…³æœºåä¼šä¸€ç›´æ˜¾ç¤ºä¸€æ¡ \u0026ldquo;It is now safe to turn off your computer\u0026rdquo; çš„ä¿¡æ¯ï¼Œå› ä¸ºæ“ä½œç³»ç»Ÿæ— æ³•åˆ‡æ–­ç”µæºã€‚è¿™æ—¶æœŸçš„ç”µæºå¯ä»¥å«åš Hard Power ï¼Œå› ä¸ºå…¨éƒ¨éƒ½æ˜¯ç¡¬ä»¶æ§åˆ¶çš„ã€‚\nåæ¥è‹±ç‰¹å°”æå‡ºäº† ATX ä¸»æ¿æ ‡å‡†ï¼Œå®ƒå¸¦æ¥äº† Soft Power ï¼Œå®ƒä½¿ç”¨çš„ ATX ç”µæºæ²¡æœ‰ç›´æ¥è¿åˆ°ç”µè„‘çš„å¼€å…³ï¼Œè€Œæ˜¯æ’åœ¨ä¸»æ¿ä¸Šï¼Œå¯ä»¥é€šè¿‡è½¯ä»¶æ§åˆ¶ï¼Œä¸‹é¢æ˜¯ ATX ä¸»æ¿ç”µæºæ¥å£çš„ä¿¡å·å®šä¹‰ï¼š\nå®ƒè¿˜å¸¦æ¥äº†ä¸¤ä¸ªé‡è¦çš„å˜åŒ–ï¼š\nå¤‡ä»½ç”µæºï¼šä¸»æ¿ç”µæºæ¥å£ä¸Šæœ‰ä¸€ä¸ª \u0026ldquo;+5VSB\u0026rdquo; æˆ–è€… \u0026ldquo;+5V Standby\u0026rdquo; çš„ä¿¡å·ï¼Œå³ä½¿è®¡ç®—æœºå·²ç»å…³æœºï¼Œè¿™ä¸ª 5V ä¿¡å·ä¹Ÿä¼šä¸€ç›´ä¾›ç»™ä¸»æ¿ï¼Œä¸»æ¿å¯ä»¥æŒç»­è¿è¡Œä¸€äº›æœ€ç®€å•çš„åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯å¾…æœºçŠ¶æ€ï¼Œæˆ‘ä»¬å¯ä»¥éšæ—¶å”¤é†’è®¡ç®—æœºã€‚è¯¥ä¿¡å·è¿˜æœ‰ä¸€ä¸ªä½œç”¨å°±æ˜¯æ›¿ä»£ CMOS ç”µæ± ã€‚ æ™ºèƒ½ç”µæºæ§åˆ¶ï¼šç”µæºæ¥å£è¿˜æœ‰ PS-ON å’Œ PW-OK/PS-RDY ä¿¡å·ï¼Œä»£è¡¨â€œç”µæºæ¥é€šâ€å’Œâ€œç”µæºå°±ç»ªâ€ã€‚ä½ å¯ä»¥è¯•è¯•å°† PS-ON ä¿¡å·ä¸åœ°çº¿çŸ­æ¥ï¼ŒATX ç”µæºä¼šç«‹å³å¯åŠ¨ï¼Œé£æ‰‡å¼€å§‹æ—‹è½¬ã€‚ä¸»æ¿ä¸ŠæŸä¸ªç”± +5VSB ä¾›ç”µçš„ç»„ä»¶å°±æ˜¯é€šè¿‡çŸ­æ¥ PS-ON å’Œåœ°æ¥å¯åŠ¨è®¡ç®—æœºçš„ã€‚ç”±äºç”µæºä¸­æœ‰äº›éƒ¨åˆ†å¯åŠ¨ä¸€æ®µæ—¶é—´åæ‰èƒ½ç¨³å®šï¼Œç”µæºå®Œå…¨ç¨³å®šåæ‰ä¼šæ‰“å¼€ PW-OK/PS-RDY ä¿¡å·ï¼Œä¸»æ¿ä¼šç­‰å¾…è¯¥ä¿¡å·æ‰“å¼€åæ‰å¼€å§‹å¼•åˆ°å¯åŠ¨ã€‚ æ‰€ä»¥ï¼Œè®¡ç®—æœºçš„ç”µæºé”®ä¸å†æ˜¯â€œæ‰“å¼€â€è®¡ç®—æœºï¼Œå®ƒè¿æ¥åœ¨ä¸»æ¿çš„åŸºæœ¬æ§åˆ¶å™¨ä¸Šï¼Œæ§åˆ¶å™¨æ£€æµ‹åˆ°ç”µæºé”®æŒ‰ä¸‹ï¼Œå†å¯åŠ¨ç”µæºï¼Œå¼•å¯¼ç³»ç»Ÿã€‚ç”µæºé”®ä¸å†æ˜¯å¯åŠ¨ç³»ç»Ÿçš„å”¯ä¸€æ–¹å¼ï¼Œæ‰©å±•æ€»çº¿ä¸Šçš„å…¶ä»–è®¾å¤‡ä¹Ÿå¯ä»¥ã€‚è¿™å¾ˆé‡è¦ï¼Œè®¡ç®—æœºå…³æœºæ—¶ï¼Œä»¥å¤ªç½‘é€‚é…å™¨è¿˜æ˜¯ä¿æŒæ‰“å¼€çš„ï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡ä»¥å¤ªç½‘è¿œç¨‹å¯åŠ¨è®¡ç®—æœºã€‚\n2. ç”µæºç®¡ç† #ç°åœ¨çš„è®¡ç®—æœºéƒ½é‡‡ç”¨äº† ACPI(Advanced Configuration and Power Interface) æŠ€æœ¯ï¼Œå®ƒæ˜¯è‹±ç‰¹å°”ç­‰å…¬å¸æå‡ºçš„æ“ä½œç³»ç»Ÿåº”ç”¨ç¨‹åºç®¡ç†æ‰€æœ‰ç”µæºç®¡ç†æ¥å£çš„è§„èŒƒï¼ŒåŒ…æ‹¬äº†è½¯ä»¶å’Œç¡¬ä»¶æ–¹é¢çš„è§„èŒƒï¼Œæ“ä½œç³»ç»Ÿçš„ç”µæºç®¡ç†åŠŸèƒ½é€šè¿‡è°ƒç”¨ ACPI æ¥å£ï¼Œå®ç°å¯¹ç¬¦åˆ ACPI è§„èŒƒçš„ç¡¬ä»¶è®¾å¤‡çš„ç”µæºç®¡ç†ï¼Œä¸‹é¢æ˜¯ç”µæºç®¡ç†ä¸ ACPI çš„å…¨å±€ç»“æ„å›¾ï¼š\nACPI æœ‰ä¸ªæ¦‚å¿µå«åš power states ï¼Œå¯ä»¥ç†è§£ä¸ºç”µæºçŠ¶æ€ï¼Œæ“ä½œç³»ç»Ÿå¯ä»¥é€šè¿‡åˆ‡æ¢è®¾å¤‡çš„ç”µæºçŠ¶æ€æ¥æ§åˆ¶åŠŸè€—ï¼Œä¸»æ¿çš„ç”µæºçŠ¶æ€æœ‰ï¼š\nG0ï¼šå·¥ä½œï¼ˆè®¡ç®—æœºå¤„äºå¼€æœºå·¥ä½œçŠ¶æ€ï¼‰ G1ï¼šç¡çœ ï¼ˆæ‚¨çš„è®¡ç®—æœºçš„å¾…æœºçŠ¶æ€ï¼Œåˆ†ä¸ºå‡ ä¸ªå­çŠ¶æ€ï¼‰ S1ï¼šCPU å’Œ RAM çš„ç”µæºä¿æŒæ‰“å¼€ï¼Œä½† CPU æœªæ‰§è¡ŒæŒ‡ä»¤ï¼Œ å¤–å›´è®¾å¤‡å…³é—­ S2ï¼šCPU å…³é—­ï¼ŒRAM ä¿æŒæ‰“å¼€ S3ï¼šæ‰€æœ‰ç»„ä»¶å…³é—­ï¼Œé™¤äº† RAM å’Œè§¦å‘æ¢å¤çš„è®¾å¤‡ï¼ˆé”®ç›˜ï¼‰ï¼Œ å½“ä½ å‘Šè¯‰æ“ä½œç³»ç»Ÿâ€œSleepâ€æ—¶ï¼Œå®ƒä¼šå…³é—­æ‰€æœ‰è¿›ç¨‹ï¼Œç„¶åè¿›å…¥è¿™ä¸ªæ¨¡å¼ã€‚ S4ï¼šä¼‘çœ ï¼Œå…³é—­æ‰€æœ‰ç»„ä»¶ã€‚ å½“æ‚¨å°†æ“ä½œç³»ç»Ÿå‘ŠçŸ¥ä¼‘çœ æ—¶ï¼Œå®ƒä¼šåœæ­¢è¿›ç¨‹ï¼Œå°† RAM çš„å†…å®¹ä¿å­˜åˆ°ç£ç›˜ï¼Œç„¶åè¿›å…¥æ­¤æ¨¡å¼ã€‚ G2ï¼šè½¯å…³ï¼Œè¿™å°±æ˜¯è®¡ç®—æœºçš„â€œå…³æœºâ€çŠ¶æ€ï¼Œ é™¤äº†å¯ä»¥è§¦å‘å¼•å¯¼çš„è®¾å¤‡ä¹‹å¤–ï¼Œå…¶ä»–ç”µæºå‡å·²å…³é—­ã€‚ G3ï¼šæœºæ¢°å…³é—­ï¼ŒATX ç”µæºæœ¬èº«éƒ½å·²ç»æ–­ç”µã€‚ ACPI ä¸º CPU å’Œè®¡ç®—æœºä¸Šçš„å…¶ä»–è®¾å¤‡éƒ½å®šä¹‰äº†ä¸åŒçš„ç”µæºçŠ¶æ€ã€‚\n3. é‡å¯ #å½“æˆ‘ä»¬åœ¨ Linux ç³»ç»Ÿä¸­æ‰§è¡Œ reboot å‘½ä»¤æ—¶ï¼Œå®ƒä¼šæ‰§è¡Œç³»ç»Ÿè°ƒç”¨ reboot() å‡½æ•°ï¼š\nint reboot(int magic, int magic2, int cmd, void *arg); å‡½æ•°å®šä¹‰åœ¨å†…æ ¸çš„ kernel/reboot.c æ–‡ä»¶ä¸­ï¼š\n/* * Reboot system call: for obvious reasons only root may call it, * and even root needs to set up some magic numbers in the registers * so that some mistake won't make this reboot the whole machine. * You can also set the meaning of the ctrl-alt-del-key here. * reboot doesn't sync: do that yourself before calling this. */ SYSCALL_DEFINE4(reboot, int, magic1, int, magic2, unsigned int, cmd, void __user *, arg) è¯¥å‡½æ•°æœ‰ä¸ª cmd å‚æ•°ï¼Œé€šè¿‡ä¸åŒçš„é€‰é¡¹è°ƒç”¨ç›¸åº”çš„å†…æ ¸å‡½æ•°å®ç°ä¸åŒçš„åŠŸèƒ½ï¼š\nLINUX_REBOOT_CMD_CAD_OFFï¼šç¦æ­¢ CAD ï¼Œ è¿™æ„å‘³ç€æ— æ³•é€šè¿‡ ctrl-alt-del ç»„åˆé”®äº§ç”Ÿ SIGINT ä¿¡å·è§¦å‘é‡å¯ã€‚ LINUX_REBOOT_CMD_CAD_ONï¼šä½¿èƒ½ CAD ï¼Œå¯ä»¥é€šè¿‡ ctrl-alt-del ç»„åˆé”®è§¦å‘é‡å¯ LINUX_REBOOT_CMD_HALTï¼šå…³é—­æ“ä½œç³»ç»Ÿ LINUX_REBOOT_CMD_KEXECï¼šé‡æ–°åŠ è½½å†…æ ¸ï¼Œå½“å†…æ ¸é…ç½®äº† CONFIG_KEXEC æ—¶æ‰æœ‰æ•ˆ LINUX_REBOOT_CMD_POWER_OFFï¼šå…³æœºï¼Œå…³é—­æ“ä½œç³»ç»Ÿï¼Œç„¶åè®©è®¡ç®—æœºçš„ç”µæºè¿›å…¥ G2 çŠ¶æ€ LINUX_REBOOT_CMD_RESTARTï¼šç«‹å³é‡å¯è®¡ç®—æœºï¼Œæ‰“å°ä¿¡æ¯ \u0026ldquo;Restarting system.\u0026rdquo; LINUX_REBOOT_CMD_RESTART2ï¼šç«‹å³é‡å¯è®¡ç®—æœºï¼Œ æ‰“å°ä¿¡æ¯ \u0026ldquo;Restarting system with command \u0026lsquo;%s\u0026rsquo;\u0026rdquo; LINUX_REBOOT_CMD_SW_SUSPENDï¼šä¼‘çœ ï¼Œå°†è¿è¡ŒçŠ¶æ€ä¿å­˜åˆ°ç¡¬ç›˜ï¼Œç³»ç»ŸæŒ‚èµ·ï¼Œå½“å†…æ ¸é…ç½®äº† CONFIG_HIBERNATION æ—¶æœ‰æ•ˆ å¯ä»¥çœ‹åˆ°ï¼Œé™¤äº†é‡å¯ ï¼Œreboot() å‡½æ•°è¿˜å¯ä»¥å®ç°åœæœºå’Œå…³æœºçš„åŠŸèƒ½ï¼Œæ‰€æœ‰ halt å’Œ poweroff å‘½ä»¤ä¹Ÿä¼šè°ƒç”¨è¯¥å‡½æ•°ã€‚ä»¥ Linux kernel 4.1 ä¸ºä¾‹ï¼Œç³»ç»Ÿé‡å¯çš„æµç¨‹å¦‚ä¸‹å›¾ï¼š\né‡å¯ä¼šè°ƒç”¨å†…æ ¸å‡½æ•° kernel_restart() ï¼Œå®šä¹‰åœ¨ kernel/reboot.c æ–‡ä»¶ä¸­ï¼š\nvoid kernel_restart(char *cmd) { kernel_restart_prepare(cmd); migrate_to_reboot_cpu(); syscore_shutdown(); if (!cmd) pr_emerg(\u0026quot;Restarting system\\n\u0026quot;); else pr_emerg(\u0026quot;Restarting system with command '%s'\\n\u0026quot;, cmd); kmsg_dump(KMSG_DUMP_RESTART); machine_restart(cmd); } EXPORT_SYMBOL_GPL(kernel_restart); ä¾æ¬¡å®Œæˆå¦‚ä¸‹å·¥ä½œ:\nkernel_restart_prepare(cmd)ï¼šå‘å…³å¿ƒç³»ç»Ÿé‡å¯çš„è¿›ç¨‹å‘å‡ºé€šçŸ¥ï¼Œå„è¿›ç¨‹ä¼šä¾æ¬¡å…³é—­ï¼Œç„¶åè®¾ç½®ç³»ç»ŸçŠ¶æ€ä¸º SYSTEM_RESTARTï¼Œå…³é—­æ‰€æœ‰å¤–éƒ¨è®¾å¤‡ã€‚ syscore_shutdow()ï¼šå…³é—­æ“ä½œç³»ç»Ÿæ ¸å¿ƒï¼Œæ¯”å¦‚ä¸­æ–­ machine_restart(cmd)ï¼šç¡¬ä»¶é‡ç½® åœ¨ x86 ç³»ç»Ÿä¸­ï¼Œmachine_restart() å‡½æ•°æœ€ç»ˆä¼šè°ƒç”¨ arch/x86/kernel/reboot.c æ–‡ä»¶ä¸­çš„ native_machine_emergency_restart() å‡½æ•°ï¼Œæ ¹æ®ä¸åŒçš„é‡ç½®æ–¹å¼ï¼Œæ‰§è¡Œç›¸åº”çš„ reboot ä»£ç ï¼š\nstatic void native_machine_emergency_restart(void) { ...... for (;;) { /* Could also try the reset bit in the Hammer NB */ switch (reboot_type) { case BOOT_ACPI: acpi_reboot(); reboot_type = BOOT_KBD; break; case BOOT_KBD: mach_reboot_fixups(); /* For board specific fixups */ for (i = 0; i \u0026lt; 10; i++) { kb_wait(); udelay(50); outb(0xfe, 0x64); /* Pulse reset low */ udelay(50); } if (attempt == 0 \u0026amp;\u0026amp; orig_reboot_type == BOOT_ACPI) { attempt = 1; reboot_type = BOOT_ACPI; } else { reboot_type = BOOT_EFI; } break; case BOOT_EFI: efi_reboot(reboot_mode, NULL); reboot_type = BOOT_BIOS; break; case BOOT_BIOS: machine_real_restart(MRR_BIOS); /* We're probably dead after this, but... */ reboot_type = BOOT_CF9_SAFE; break; case BOOT_CF9_FORCE: port_cf9_safe = true; /* Fall through */ case BOOT_CF9_SAFE: if (port_cf9_safe) { u8 reboot_code = reboot_mode == REBOOT_WARM ? 0x06 : 0x0E; u8 cf9 = inb(0xcf9) \u0026amp; ~reboot_code; outb(cf9|2, 0xcf9); /* Request hard reset */ udelay(50); /* Actually do the reset */ outb(cf9|reboot_code, 0xcf9); udelay(50); } reboot_type = BOOT_TRIPLE; break; case BOOT_TRIPLE: load_idt(\u0026amp;no_idt); __asm__ __volatile__(\u0026quot;int3\u0026quot;); /* We're probably dead after this, but... */ reboot_type = BOOT_KBD; break; } } } å¯ä»¥çœ‹å‡ºï¼Œè®¡ç®—æœºæœ‰å¤šç§æ–¹å¼å¯ä»¥é‡ç½®ç¡¬ä»¶ï¼Œåœ¨ä¸€ä¸ªæ— é™å¾ªç¯é‡Œé€ä¸€æ‰§è¡Œï¼Œå¦‚æœæˆåŠŸï¼Œæœºå™¨å°±ä¼šé‡å¯ï¼Œå¦åˆ™å°±åˆ‡æ¢åˆ°ä¸‹ä¸€ç§æ–¹æ³•ã€‚é»˜è®¤ä½¿ç”¨ ACPI æ–¹å¼ï¼Œå…¶æ¬¡è¿˜æœ‰ KBD ã€CF9ã€BIOSã€EFIç­‰ï¼Œä½¿ç”¨å“ªç§æ–¹å¼ä¸»è¦å–å†³äºå†…æ ¸å¼•å¯¼é€‰é¡¹ reboot çš„è®¾ç½®ï¼š\nreboot=[mode][,type][,force] å«ä¹‰ï¼š\nmode ç”¨äºæŒ‡å®šé‡å¯æ¨¡å¼ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä¸¤ç§æ¨¡å¼ä¹‹ä¸€ï¼šwarm (çƒ­é‡å¯ï¼Œè·³è¿‡å†…å­˜æ£€æµ‹)ï¼Œcold (å†·é‡å¯ï¼Œæ£€æµ‹å¹¶é‡æ–°åˆå§‹åŒ–æ‰€æœ‰ç¡¬ä»¶) type ç”¨äºæŒ‡å®šé‡å¯ç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹4ç§ç±»å‹ä¹‹ä¸€ï¼šbios (ä¸ºçƒ­é‡å¯ä½¿ç”¨ CPU reboot vector)ï¼Œacpi (ä¼˜å…ˆä½¿ç”¨ FADT ä¸­çš„ ACPI reset register ï¼Œè‹¥å¤±è´¥å†è½¬ä¸º kbd ï¼Œè¿™æ˜¯ç›®å‰å†…æ ¸çš„é»˜è®¤å€¼ï¼Œå®šä¹‰åœ¨ kernel/reboot.c æ–‡ä»¶ï¼š enum reboot_type reboot_type = BOOT_ACPI;)ï¼Œkbd (ä½¿ç”¨é”®ç›˜æ§åˆ¶å™¨å†·é‡å¯)ï¼Œ efi (ä¼˜å…ˆä½¿ç”¨ EFI æä¾›çš„ reset_system è¿è¡Œæ—¶æœåŠ¡,è‹¥å¤±è´¥å†è½¬ kbd ) ç»“å°¾çš„ \u0026ldquo;force\u0026rdquo; è¡¨ç¤ºåœ¨é‡å¯æ—¶ä¸åœç”¨å…¶å®ƒçš„ CPUï¼Œåœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥è®©rebootæ›´å¯é ã€‚ ç³»ç»Ÿå¯åŠ¨åï¼Œå¯ä»¥åœ¨ /proc/cmdline æ–‡ä»¶æŸ¥çœ‹å¯åŠ¨æ—¶ä½¿ç”¨çš„å¼•å¯¼é€‰é¡¹ä»¥å’Œå€¼ã€‚å¯ä»¥ä½¿ç”¨ \u0026ldquo;modinfo -p ${modulename}\u0026rdquo; å‘½ä»¤æ˜¾ç¤ºå¯åŠ è½½æ¨¡å—çš„æ‰€æœ‰å¯ç”¨é€‰é¡¹ã€‚å·²ç»åŠ è½½åˆ°å†…æ ¸ä¸­çš„æ¨¡å—ä¼šåœ¨ /sys/module/${modulename}/parameters/ ä¸­æ˜¾ç¤ºå‡ºå…¶é€‰é¡¹ï¼Œå¹¶ä¸”æŸäº›é€‰é¡¹çš„å€¼è¿˜å¯ä»¥åœ¨è¿è¡Œæ—¶é€šè¿‡ \u0026ldquo;echo -n ${value} \u0026gt; /sys/module/${modulename}/parameters/${parm}\u0026rdquo; è¿›è¡Œä¿®æ”¹ã€‚\n3.1. ACPI reset #ACPI è§„å®šäº†ä¸€ä¸ªç‰¹æ®Šçš„å¯„å­˜å™¨ reset registerï¼Œå®ƒå¯ä»¥ä½äº IO/Memoryã€æˆ–è€… PCI bus #0 ä¸Šçš„ä¸€ä¸ªè®¾å¤‡çš„é…ç½®ç©ºé—´ï¼Œé€šè¿‡å‘ reset register å†™å…¥ç‰¹å®šå€¼æ¥é‡ç½®è®¡ç®—æœºã€‚æ ¹æ® ACPI çš„è§„å®šï¼Œæ‰€æœ‰ç¡¬ä»¶å¿…é¡»åœ¨è¿™ä¸ªæœºåˆ¶ä¹‹åé‡ç½®ï¼Œä¸»æ¿æ”¶åˆ°è¯·æ±‚åè¦åšå¦‚ä¸‹å·¥ä½œï¼š\næ‰€æœ‰é€»è¾‘å¤ä½ã€‚ è¿™æ„å‘³ç€å°†ç›¸åº”çš„å¤ä½å‘½ä»¤å‘é€åˆ°åŒ…æ‹¬ CPUï¼Œå­˜å‚¨æ§åˆ¶å™¨ï¼Œå¤–å›´æ§åˆ¶å™¨ç­‰çš„å„ç§ç¡¬ä»¶ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™æ„å‘³ç€å‘è®¾å¤‡çš„ RST çº¿å‘é€å¤ä½ä¿¡å·ã€‚ ç„¶åå¼•å¯¼è®¡ç®—æœºã€‚ä¸»æ¿æ‰§è¡Œçš„æ­¥éª¤ä¸åˆšåˆšåœ¨æŒ‰ä¸‹ç”µæºé”®åå¼€æœºçš„æ­¥éª¤ç›¸åŒã€‚ å¦‚æœå†…æ ¸ä½¿èƒ½äº† ACPI ï¼Œå°±ä¼šé€šè¿‡ ACPI é‡ç½®ç¡¬ä»¶ï¼Œå®ç°çš„å‡½æ•°æ˜¯ acpi_reboot() ï¼Œå®šä¹‰åœ¨ drivers/acpi/reboot.c æ–‡ä»¶ï¼š\nvoid acpi_reboot(void) { struct acpi_generic_address *rr; struct pci_bus *bus0; u8 reset_value; unsigned int devfn; if (acpi_disabled) return; rr = \u0026amp;acpi_gbl_FADT.reset_register; /* ACPI reset register was only introduced with v2 of the FADT */ if (acpi_gbl_FADT.header.revision \u0026lt; 2) return; /* Is the reset register supported? The spec says we should be checking the bit width and bit offset, but Windows ignores these fields */ if (!(acpi_gbl_FADT.flags \u0026amp; ACPI_FADT_RESET_REGISTER)) return; reset_value = acpi_gbl_FADT.reset_value; /* The reset register can only exist in I/O, Memory or PCI config space on a device on bus 0. */ switch (rr-\u0026gt;space_id) { case ACPI_ADR_SPACE_PCI_CONFIG: /* The reset register can only live on bus 0. */ bus0 = pci_find_bus(0, 0); if (!bus0) return; /* Form PCI device/function pair. */ devfn = PCI_DEVFN((rr-\u0026gt;address \u0026gt;\u0026gt; 32) \u0026amp; 0xffff, (rr-\u0026gt;address \u0026gt;\u0026gt; 16) \u0026amp; 0xffff); printk(KERN_DEBUG \u0026quot;Resetting with ACPI PCI RESET_REG.\u0026quot;); /* Write the value that resets us. */ pci_bus_write_config_byte(bus0, devfn, (rr-\u0026gt;address \u0026amp; 0xffff), reset_value); break; case ACPI_ADR_SPACE_SYSTEM_MEMORY: case ACPI_ADR_SPACE_SYSTEM_IO: printk(KERN_DEBUG \u0026quot;ACPI MEMORY or I/O RESET_REG.\\n\u0026quot;); acpi_reset(); break; } } ACPI ç¼–ç¨‹æ¥å£çš„ FADT æ•°æ®ç»“æ„æè¿°äº† reset register ï¼š\n// 12 byte structure; see below for details struct GenericAddressStructure { uint8_t AddressSpace; uint8_t BitWidth; uint8_t BitOffset; uint8_t AccessSize; uint64_t Address; }; GenericAddressStructure ResetReg; uint8_t ResetValue; ç»“æ„æˆå‘˜ AddressSpace æŒ‡ç¤ºäº† reset register æ‰€å¤„çš„åœ°å€ç©ºé—´ï¼š\nValue Address Space 0 System Memory 1 System I/O 2 PCI Configuration Space Linux kernel ç”¨ æ•°æ®ç»“æ„ struct acpi_table_fadt å®ç°äº† FADTï¼Œå®šä¹‰åœ¨ include/acpi/actbl.h æ–‡ä»¶ï¼Œå¹¶å®šä¹‰äº†å˜é‡ acpi_gbl_FADT å­˜æ”¾æ‰€æœ‰æ•°æ®ã€‚å¦‚æœ reset register ä½äº Memory æˆ–è€… IO ï¼Œacpi_reboot() ä¼šè°ƒç”¨ acpi_reset() å‘ acpi_gbl_FADT.reset_register å†™å…¥ acpi_gbl_FADT.reset_value å®Œæˆé‡ç½®ã€‚å¦‚æœ reset register åœ¨ PCI é…ç½®ç©ºé—´ï¼Œéœ€è¦å…ˆæ‰¾åˆ°é…ç½®ç©ºé—´å†…çš„åœ°å€ï¼Œç„¶åå†™å…¥ acpi_gbl_FADT.reset_value ã€‚\n3.2. KBD #KBD æ˜¯ keyboard çš„ç¼©å†™ï¼Œè¿™æ˜¯é€šè¿‡é”®ç›˜æ§åˆ¶å™¨é‡ç½®è®¡ç®—æœºçš„æ–¹å¼ã€‚8042 æ˜¯æ—©æœŸ x86 è®¡ç®—æœºä¸Šçš„ PS/2 é”®ç›˜æ§åˆ¶å™¨ï¼Œ80 å¹´ä»£ IBM æ¨å‡ºæ­è½½ 80268 CPU çš„ PC/AT è®¡ç®—æœºæ—¶ï¼Œä¸ºäº†è§£å†³æŸäº›å…¼å®¹é—®é¢˜ï¼Œä¸ºå®ƒæ·»åŠ äº†å¾ˆå¤šä¸é”®ç›˜æ— å…³çš„åŠŸèƒ½ï¼Œæ¯”å¦‚é‡ç½® CPU ã€‚8024 çš„æ§åˆ¶å¯„å­˜å™¨ä½äº IO ç«¯å£ 0x64 ï¼Œå‘å®ƒå†™å…¥ 0xfe å°±å¯ä»¥é‡ç½® CPU ï¼š\noutb(0xfe, 0x64); ç”±äºå†å²åŸå› ï¼Œç›´åˆ°ä»Šå¤©ï¼Œx86 è®¡ç®—æœºä¸Šä¾ç„¶éœ€è¦å…¼å®¹ PC/AT æœºçš„ 8042ï¼Œè¿™ç§æ–¹å¼å‡ ä¹å¯ä»¥é‡å¯ä¸€åˆ‡ x86 è®¡ç®—æœºã€‚\n3.3. CF9 #ä¸»æ¿ä¸Šçš„å—æ¡¥èŠ¯ç‰‡ä¹Ÿæœ‰ç”µæºç®¡ç†çš„åŠŸèƒ½ï¼Œé€šè¿‡ IO ç«¯å£ 0xCF9 å—æ¡¥çš„ Reset Control Register ï¼Œä»¥è‹±ç‰¹å°”çš„å—æ¡¥èŠ¯ç‰‡ ICH10 ä¸ºä¾‹ï¼Œå¯„å­˜å™¨å®šä¹‰è¯¦æƒ…å¯ä»¥æŸ¥çœ‹èŠ¯ç‰‡çš„ Datesheetï¼š\nå†…æ ¸ä¸­æœ‰ä¸¤ç§é€‰æ‹©ï¼š\nå‘ IO Port CF9 å†™ 0x06ã€‚çƒ­é‡å¯ï¼Œè¿™ç§ reset æ–¹æ³•ä¸ä¼šä½¿ç³»ç»Ÿè®¾å¤‡æ‰ç”µï¼Œä»…ä»…å°† CPU å’Œç³»ç»Ÿè®¾å¤‡çš„ status å¹²å‡€å½»åº•çš„ reset ä¸€ ä¸‹ã€‚ å‘ IO Port CF9 å†™ 0x0Eã€‚å†·é‡å¯ï¼Œè¿™æ˜¯ä¸€ç§éå¸¸å½»åº•çš„ reset æ–¹æ³•ï¼Œç³»ç»Ÿçš„ç¡¬ä»¶ä¼šæ‰ç”µï¼Œç„¶åé‡æ–°ä¸Šç”µã€‚ 3.4. BIOS #è¿™ç§æ–¹å¼ä¼šè°ƒç”¨ä¸€æ®µæ±‡ç¼–ä»£ç ï¼Œä½¿ CPU è·³è½¬åˆ° BIOS çš„é‡ç½®ä»£ç å¤„ï¼Œç”± BIOS é‡å¯ç³»ç»Ÿï¼Œå®ç°æ–¹æ³•åœ¨ arch/x86/kernel/reboot.c æ–‡ä»¶çš„ machine_real_restart() å‡½æ•°ï¼š\n#ifdef CONFIG_X86_32 asm volatile(\u0026quot;jmpl *%0\u0026quot; : : \u0026quot;rm\u0026quot; (real_mode_header-\u0026gt;machine_real_restart_asm), \u0026quot;a\u0026quot; (type)); #else asm volatile(\u0026quot;ljmpl *%0\u0026quot; : : \u0026quot;m\u0026quot; (real_mode_header-\u0026gt;machine_real_restart_asm), \u0026quot;D\u0026quot; (type)); 3.5. EFI #è°ƒç”¨ EFI/UEFI æä¾›çš„æ¥å£å®ç°é‡å¯ã€‚\n4. å‚è€ƒ # How does a computer restart itself Debugging ACPI Power management ACPI Reboot Linux å†…æ ¸å¼•å¯¼é€‰é¡¹ç®€ä»‹ ","date":"2017 November 30","permalink":"/posts/2017/11/30/","section":"Posts","summary":"1. Soft Power #æ—©æœŸçš„è®¡ç®—æœºä¸»æ¿éƒ½æ˜¯ä½¿ç”¨ AT ç”µæºç®¡ç†æŠ€æœ¯ï¼ŒAT ç”µæºç³»ç»Ÿéå¸¸ç®€å•ï¼Œç”µæºé”®æ˜¯æœºæ¢°å¼å¼€å…³ï¼Œåªæœ‰å¼€é—­ä¸¤ç§çŠ¶æ€ï¼Œé—­åˆåç”µæµä»å¼€å…³ä¸Šæµè¿‡ä¸ºä¸»æ¿ä¾›ç”µï¼Œæ–­å¼€åä¸»æ¿ä¸Šçš„æ‰€æœ‰å™¨ä»¶åŒæ—¶æ–­ç”µï¼Œæ— æ³•å®ç°å¾…æœºã€è½¯å…³æœºç­‰åŠŸèƒ½ï¼Œè¿™ä¸ªæ—¶æœŸçš„ Windows ç³»ç»Ÿå…³æœºåä¼šä¸€ç›´æ˜¾ç¤ºä¸€æ¡ \u0026ldquo;It is now safe to turn off your computer\u0026rdquo; çš„ä¿¡æ¯ï¼Œå› ä¸ºæ“ä½œç³»ç»Ÿæ— æ³•åˆ‡æ–­ç”µæºã€‚è¿™æ—¶æœŸçš„ç”µæºå¯ä»¥å«åš Hard Power ï¼Œå› ä¸ºå…¨éƒ¨éƒ½æ˜¯ç¡¬ä»¶æ§åˆ¶çš„ã€‚","title":"è®¡ç®—æœºæ˜¯å¦‚ä½•å®ç°é‡å¯çš„"},{"content":"ä»¥ä¸€å° x86 ä¸»æœºä¸ºä¾‹ï¼Œç”¨ lsusb å¯ä»¥æŸ¥çœ‹å®ƒçš„æ‰€æœ‰ USB è®¾å¤‡ï¼š\n# lsusb Bus 001 Device 003: ID 1bc7:0021 Telit HE910 Bus 002 Device 002: ID 04e2:1410 Exar Corp. Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub Bus 002 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub åœ¨ sys æ–‡ä»¶ç³»ç»Ÿçš„ /sys/bus/usb/devices/ ç›®å½•ä¸‹å¯ä»¥çœ‹åˆ°æ‰€æœ‰ USB è®¾å¤‡çš„æ ‘å½¢ç»“æ„ï¼š\n/sys/bus/usb/devices# ls -l total 0 lrwxrwxrwx 1 root root 0 Nov 26 10:57 1-0:1.0 -\u0026gt; ../../../devices/pci0000:00/0000:00:14.3/usb1/1-0:1.0 lrwxrwxrwx 1 root root 0 Nov 26 10:57 1-2 -\u0026gt; ../../../devices/pci0000:00/0000:00:14.3/usb1/1-2 lrwxrwxrwx 1 root root 0 Nov 26 10:57 1-2:1.0 -\u0026gt; ../../../devices/pci0000:00/0000:00:14.3/usb1/1-2/1-2:1.0 lrwxrwxrwx 1 root root 0 Nov 26 10:57 1-2:1.1 -\u0026gt; ../../../devices/pci0000:00/0000:00:14.3/usb1/1-2/1-2:1.1 lrwxrwxrwx 1 root root 0 Nov 26 10:57 1-2:1.10 -\u0026gt; ../../../devices/pci0000:00/0000:00:14.3/usb1/1-2/1-2:1.10 lrwxrwxrwx 1 root root 0 Nov 26 10:57 1-2:1.11 -\u0026gt; ../../../devices/pci0000:00/0000:00:14.3/usb1/1-2/1-2:1.11 lrwxrwxrwx 1 root root 0 Nov 26 10:57 1-2:1.12 -\u0026gt; ../../../devices/pci0000:00/0000:00:14.3/usb1/1-2/1-2:1.12 lrwxrwxrwx 1 root root 0 Nov 26 10:57 1-2:1.13 -\u0026gt; ../../../devices/pci0000:00/0000:00:14.3/usb1/1-2/1-2:1.13 lrwxrwxrwx 1 root root 0 Nov 26 10:57 1-2:1.2 -\u0026gt; ../../../devices/pci0000:00/0000:00:14.3/usb1/1-2/1-2:1.2 lrwxrwxrwx 1 root root 0 Nov 26 10:57 1-2:1.3 -\u0026gt; ../../../devices/pci0000:00/0000:00:14.3/usb1/1-2/1-2:1.3 lrwxrwxrwx 1 root root 0 Nov 26 10:57 1-2:1.4 -\u0026gt; ../../../devices/pci0000:00/0000:00:14.3/usb1/1-2/1-2:1.4 lrwxrwxrwx 1 root root 0 Nov 26 10:57 1-2:1.5 -\u0026gt; ../../../devices/pci0000:00/0000:00:14.3/usb1/1-2/1-2:1.5 lrwxrwxrwx 1 root root 0 Nov 26 10:57 1-2:1.6 -\u0026gt; ../../../devices/pci0000:00/0000:00:14.3/usb1/1-2/1-2:1.6 lrwxrwxrwx 1 root root 0 Nov 26 10:57 1-2:1.7 -\u0026gt; ../../../devices/pci0000:00/0000:00:14.3/usb1/1-2/1-2:1.7 lrwxrwxrwx 1 root root 0 Nov 26 10:57 1-2:1.8 -\u0026gt; ../../../devices/pci0000:00/0000:00:14.3/usb1/1-2/1-2:1.8 lrwxrwxrwx 1 root root 0 Nov 26 10:57 1-2:1.9 -\u0026gt; ../../../devices/pci0000:00/0000:00:14.3/usb1/1-2/1-2:1.9 lrwxrwxrwx 1 root root 0 Nov 26 10:57 2-0:1.0 -\u0026gt; ../../../devices/pci0000:00/0000:00:14.4/usb2/2-0:1.0 lrwxrwxrwx 1 root root 0 Nov 26 10:57 2-1 -\u0026gt; ../../../devices/pci0000:00/0000:00:14.4/usb2/2-1 lrwxrwxrwx 1 root root 0 Nov 26 10:57 2-1:1.0 -\u0026gt; ../../../devices/pci0000:00/0000:00:14.4/usb2/2-1/2-1:1.0 lrwxrwxrwx 1 root root 0 Nov 26 10:57 2-1:1.1 -\u0026gt; ../../../devices/pci0000:00/0000:00:14.4/usb2/2-1/2-1:1.1 lrwxrwxrwx 1 root root 0 Nov 26 10:57 usb1 -\u0026gt; ../../../devices/pci0000:00/0000:00:14.3/usb1 lrwxrwxrwx 1 root root 0 Nov 26 10:57 usb2 -\u0026gt; ../../../devices/pci0000:00/0000:00:14.4/usb2 usb1 å’Œ usb2 æ˜¯ PCI æ€»çº¿ä¸Šçš„ä¸¤ä¸ª USB controller ï¼Œä¹Ÿå°±æ˜¯ä¸¤ä¸ª root hub ï¼Œå®ƒä»¬æ‰©å±•å‡ºä¸¤æ¡ USB æ€»çº¿ï¼Œè€Œå…¶ä»–è®¾å¤‡éƒ½æ˜¯è¿™ä¸¤æ¡æ€»çº¿ä¸‹çš„å­è®¾å¤‡ï¼Œå®ƒä»¬çš„å‘½åæ ¼å¼æ˜¯ æ ¹é›†çº¿å™¨å·-é›†çº¿å™¨ç«¯å£å·:é…ç½®.æ¥å£ï¼Œè¿›å…¥ usb2/1-2 ç›®å½•ï¼ŒæŸ¥çœ‹è®¾å¤‡å·ï¼š\n/sys/bus/usb/devices/usb1# cd 1-2/ /sys/bus/usb/devices/usb1/1-2# cat devnum 3 å¯ä»¥ç¡®è®¤ï¼Œ1-2 å°±æ˜¯è®¾å¤‡ Bus 001 Device 003: ID 1bc7:0021 Telit HE910 çš„æ–‡ä»¶å¤¹ï¼Œè¿™ä¸ªè®¾å¤‡å·æ˜¯ USB æ€»çº¿æšä¸¾è®¾å¤‡æ—¶è‡ªåŠ¨åˆ†é…çš„ï¼Œå¦‚æœæ‹”æ‰è®¾å¤‡é‡æ’ï¼Œè®¾å¤‡å·ä¼šé‡æ–°åˆ†é…ï¼Œè‡ªåŠ¨å‘åå¢é•¿ã€‚è®¾å¤‡ç›®å½•ä¸‹è¿˜æœ‰ä¸€äº›æœ‰ç”¨çš„æ–‡ä»¶ï¼š\nbusnumï¼šè®¾å¤‡æ¥å…¥çš„ USB æ€»çº¿å· idProductï¼šè®¾å¤‡ ID idVendorï¼šå‚å•† ID å‚è€ƒï¼š\nhttp://www.linux-usb.org/FAQ.html https://www.kernel.org/doc/Documentation/ABI/stable/sysfs-bus-usb ","date":"2017 November 28","permalink":"/posts/2017/11/28/","section":"Posts","summary":"ä»¥ä¸€å° x86 ä¸»æœºä¸ºä¾‹ï¼Œç”¨ lsusb å¯ä»¥æŸ¥çœ‹å®ƒçš„æ‰€æœ‰ USB è®¾å¤‡ï¼š","title":"Linux ç³»ç»Ÿçš„ USB è®¾å¤‡ç»“æ„"},{"content":"1. ç¡¬ä»¶ #PCI æ€»çº¿æ˜¯ä¸€ä¸ªå¹¶è¡Œæ€»çº¿ï¼Œä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸæœ‰ 32 ä¸ª bit ï¼ˆåæ‰©å±•åˆ° 64 bitï¼‰ åŒæ—¶ä¼ è¾“ï¼Œå¸¦å®½ 133MB/s ï¼ŒPCI è®¾å¤‡å…·æœ‰ç‹¬ç«‹çš„åœ°å€ç©ºé—´ï¼Œå«åš PCI æ€»çº¿åœ°å€ç©ºé—´ï¼Œé€šè¿‡ Host bridge éš”ç¦»å¤„ç†å™¨ç³»ç»Ÿçš„å­˜å‚¨å™¨åŸŸä¸ PCI æ€»çº¿åŸŸï¼Œä¸‹é¢æŒ‚åœ¨äº†ä¸€ä¸ª PCI æ€»çº¿æ ‘ï¼Œå…¸å‹çš„ç»“æ„å¦‚ä¸‹å›¾ï¼š\nPCI æ€»çº¿ä¸»è¦åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š\nPCI è®¾å¤‡ã€‚ç¬¦åˆ PCI æ€»çº¿æ ‡å‡†çš„è®¾å¤‡å°±è¢«ç§°ä¸º PCI è®¾å¤‡ï¼ŒPCI æ€»çº¿æ¶æ„ä¸­å¯ä»¥åŒ…å«å¤šä¸ª PCI è®¾å¤‡ã€‚å›¾ä¸­çš„ Audioã€LAN éƒ½æ˜¯ä¸€ä¸ª PCI è®¾å¤‡ã€‚PCI è®¾å¤‡åŒæ—¶ä¹Ÿåˆ†ä¸ºä¸»è®¾å¤‡å’Œç›®æ ‡è®¾å¤‡ä¸¤ç§ï¼Œä¸»è®¾å¤‡æ˜¯ä¸€æ¬¡è®¿é—®æ“ä½œçš„å‘èµ·è€…ï¼Œè€Œç›®æ ‡è®¾å¤‡åˆ™æ˜¯è¢«è®¿é—®è€…ã€‚ PCI æ€»çº¿ã€‚PCI æ€»çº¿åœ¨ç³»ç»Ÿä¸­å¯ä»¥æœ‰å¤šæ¡ï¼Œç±»ä¼¼äºæ ‘çŠ¶ç»“æ„è¿›è¡Œæ‰©å±•ï¼Œæ¯æ¡ PCI æ€»çº¿éƒ½å¯ä»¥è¿æ¥å¤šä¸ª PCI è®¾å¤‡/æ¡¥ï¼Œä¸Šå›¾ä¸­æœ‰ä¸¤æ¡ PCI æ€»çº¿ã€‚ PCI æ¡¥ã€‚å½“ä¸€æ¡ PCI æ€»çº¿çš„æ‰¿è½½é‡ä¸å¤Ÿæ—¶ï¼Œå¯ä»¥ç”¨æ–°çš„ PCI æ€»çº¿è¿›è¡Œæ‰©å±•ï¼Œè€Œ PCI æ¡¥åˆ™æ˜¯è¿æ¥ PCI æ€»çº¿ä¹‹é—´çš„çº½å¸¦ï¼Œå¦‚å›¾çš„ PCI-to-PCI Bridge ã€‚ åæœŸä¸ºäº†æé«˜æ•°æ®ä¼ è¾“é€Ÿç‡ï¼Œåˆæ¨å‡ºäº† PCIe æ€»çº¿ï¼Œæ”¹ä¸ºä¸²è¡Œæ€»çº¿ï¼Œå·®åˆ†ä¿¡å·ä¼ è¾“ï¼Œå¸¦å®½æå‡è‡³ 250MB/s ï¼Œæœ€æ–°çš„ PCIe 3.0 å·²ç»å¯ä»¥è¾¾åˆ° 8000MB/s ã€‚\n2. è½¯ä»¶ #åœ¨ PCI æ€»çº¿ä¸Šï¼Œé€šè¿‡ Bus number ï¼ŒDevice number å’Œ Function number æ ‡è¯†æ¯ä¸ª PCI è®¾å¤‡ï¼Œç®€ç§° BDF ï¼Œæ¯ä¸ª PCI è®¾å¤‡å†…æœ‰å•ç‹¬å­˜å‚¨ç©ºé—´ï¼Œå«åš PCI é…ç½®ç©ºé—´ã€‚å¯ä»¥é€šè¿‡ IO ç«¯å£ CONFIG_ADDRESS å’Œ CONFIG_DATA è¯»å– PCI é…ç½®ç©ºé—´ã€‚CONFIG_ADDRESS çš„åœ°å€æ˜¯ 0xCF8ï¼ŒCONFIG_DATA çš„åœ°å€æ˜¯ 0xCFCï¼Œä¸¤ä¸ªå¯„å­˜å™¨éƒ½ä¸º 32bitã€‚CONFIG_ADDRESS å¯„å­˜å™¨æ ¼å¼ï¼š\nbit31 æ˜¯ä½¿èƒ½å¯¹ PCI Bus CONFIG_DATA çš„è®¿é—®ï¼› bit 30ï½24 ä¸ºä¿ç•™ï¼Œä¸ºåªè¯»ï¼Œè®¿é—®æ—¶è¿”å›å€¼ä¸º 0ï¼› bit 23ï½16 æ˜¯Buså·ï¼› bit 15ï½10 æ˜¯è®¾å¤‡å·ï¼› bit 10ï½8 æ˜¯åŠŸèƒ½å·ï¼› bit 7ï½2 æ˜¯é…ç½®ç©ºé—´ä¸­çš„å¯„å­˜å™¨ï¼Œå•ä½ä¸º DWORDï¼› bit 1ï½0 ä¸ºåªè¯»ï¼Œè¯»å–æ—¶æ”¾å›ä¸º0ã€‚ ç›´æ¥æ“ä½œ IO ç«¯å£è¯»å– PCI é…ç½®ä¿¡æ¯åˆ†ä¸ºä¸¤æ­¥ï¼š\nå‘ CONFIG_ADDRESS å¯„å­˜å™¨å†™å…¥è¦è¯»/å†™çš„ä½ç½®ï¼› ä»CONFIG_DATAå¯„å­˜å™¨ï¼ˆç«¯å£0xCFCï¼‰è¯»/å†™æ‰€éœ€è¦æ•°æ®ã€‚ é…ç½®ç©ºé—´å…± 256 å­—èŠ‚ï¼ˆåœ°å€ 0x00~0xFFï¼‰ï¼Œ å‰ 64 å­—èŠ‚ï¼ˆåœ°å€ 0x00~0x3F ï¼‰æ˜¯æ‰€æœ‰ PCI è®¾å¤‡å¿…é¡»æ”¯æŒçš„ï¼š\né…ç½®ç©ºé—´éƒ½æ˜¯å°ç«¯å­˜å‚¨ã€‚Vendor ID æ˜¯å‚å•† ID ï¼Œä¸ºä¿è¯å”¯ä¸€æ€§ï¼Œéœ€è¦è®¾å¤‡å‚å•†å‘ PCI SIG ç”³è¯·è·å¾—ï¼ŒDevice ID ç”±å‚å•†è‡ªå®šä¹‰ã€‚ Base Address Registers ï¼ˆBARï¼‰ç”¨æ¥å®šä¹‰è¯¥è®¾å¤‡å ç”¨çš„ Memory/IO ç©ºé—´çš„ç±»å‹ã€èµ·å§‹åœ°å€å’Œå¤§å°ï¼ŒPCI è®¾å¤‡åšå¤šæœ‰å…­ä¸ª BARï¼ŒPCI æ¡¥æœ€å¤šæœ‰ä¸¤ä¸ª BAR ã€‚BAR åœ¨ bit0 æ¥è¡¨ç¤ºè¯¥è®¾å¤‡æ˜¯æ˜ å°„åˆ° memory è¿˜æ˜¯ IOï¼Œbar çš„ bit0 æ˜¯ readonly çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè®¾å¤‡å¯„å­˜å™¨æ˜¯æ˜ å°„åˆ° memory è¿˜æ˜¯ IO æ˜¯ç”±è®¾å¤‡åˆ¶é€ å•†å†³å®šçš„ï¼Œå…¶ä»–äººæ— æ³•ä¿®æ”¹ã€‚ç©ºé—´çš„å¤§å°å¯ä»¥ç”¨å¦‚ä¸‹æ–¹æ³•è¯»å–ï¼š\nå‘å¯„å­˜å™¨å†™ 0xFFFFFFFFï¼› è¯»å‡ºå¯„å­˜å™¨çš„å€¼ï¼Œå¹¶å–åï¼› å†åŠ  1 å°±æ˜¯è¯¥ç©ºé—´çš„å¤§å°ã€‚ ä¸‹é¢æ˜¯ BAR çš„ç»“æ„å›¾ï¼š\nPCI æšä¸¾æ˜¯ä¸ªä¸æ–­é€’å½’è°ƒç”¨å‘ç°æ–°è®¾å¤‡çš„è¿‡ç¨‹ï¼Œç³»ç»Ÿå¯åŠ¨æ—¶, ä» Host Bridge å¼€å§‹å¯»æ‰¾è®¾å¤‡å’Œæ¡¥ã€‚å‘ç°æ¡¥åè®¾ç½® Busï¼Œä¼šå‘ç°ä¸€ä¸ª PCI è®¾å¤‡å­æ ‘ï¼Œé€’å½’çš„è¿‡ç¨‹ä¸­ï¼ŒBIOS/UEFI (æˆ–è€… Linux å†…æ ¸, å¦‚æœé…ç½®æˆè¿™æ ·)ä¸æ¯ä¸ª PCI è®¾å¤‡è¿›è¡Œé…ç½®äº¤æ˜“, ä¸ºå…¶åˆ†é…å®‰å…¨çš„åœ°å€ç©ºé—´å’Œä¸­æ–­ç­‰èµ„æºã€‚åœ¨æ•´ä¸ªè¿‡ç¨‹ç»“æŸåï¼Œä¸€é¢—å®Œæ•´çš„èµ„æºåˆ†é…å®Œæ¯•çš„æ ‘å°±å»ºç«‹å¥½äº†ã€‚\nPCIe è§„èŒƒåœ¨ PCI è§„èŒƒçš„åŸºç¡€ä¸Šï¼Œå°†é…ç½®ç©ºé—´æ‰©å±•åˆ° 4KBã€‚åŸæ¥çš„ CF8/CFC æ–¹æ³•ä»ç„¶å¯ä»¥è®¿é—®æ‰€æœ‰PCIeè®¾å¤‡é…ç½®ç©ºé—´çš„å¤´255Bï¼Œä½†æ˜¯è¯¥æ–¹æ³•è®¿é—®ä¸äº†å‰©ä¸‹çš„ï¼ˆ255-4kï¼‰é…ç½®ç©ºé—´ã€‚\n3. Linux #3.1. user space #Linux ç³»ç»Ÿä¸‹æŸ¥è¯¢ PCI è®¾å¤‡ä¸»è¦ç”¨ lspci å‘½ä»¤å’Œ /sys æ–‡ä»¶ç³»ç»Ÿï¼Œä¸€ä¸ª x86 ä¸»æœºä¸ºä¾‹ï¼š\n# lspci 00:00.0 Host bridge: Intel Corporation Device 0958 00:14.0 SD Host controller: Intel Corporation Device 08a7 (rev 10) 00:14.1 Serial controller: Intel Corporation Device 0936 (rev 10) 00:14.2 USB controller: Intel Corporation Device 0939 (rev 10) 00:14.3 USB controller: Intel Corporation Device 0939 (rev 10) 00:14.4 USB controller: Intel Corporation Device 093a (rev 10) 00:14.5 Serial controller: Intel Corporation Device 0936 (rev 10) 00:14.6 Ethernet controller: Intel Corporation Device 0937 (rev 10) 00:14.7 Ethernet controller: Intel Corporation Device 0937 (rev 10) 00:15.0 Serial bus controller [0c80]: Intel Corporation Device 0935 (rev 10) 00:15.1 Serial bus controller [0c80]: Intel Corporation Device 0935 (rev 10) 00:15.2 Serial bus controller [0c80]: Intel Corporation Device 0934 (rev 10) 00:17.0 PCI bridge: Intel Corporation Device 11c3 00:17.1 PCI bridge: Intel Corporation Device 11c4 00:1f.0 ISA bridge: Intel Corporation Device 095e 01:00.0 Network controller: Intel Corporation Centrino Advanced-N 6205 [Taylor Peak] (rev 34) å‰é¢çš„æ•°å­—ä¾æ¬¡æ˜¯æ€»çº¿å·ï¼šè®¾å¤‡å·ï¼šåŠŸèƒ½å·ï¼Œç¬¬ä¸€ä¸ªè®¾å¤‡å°±æ˜¯ Host bridge ï¼Œ00:1f.0 ISA bridge æ˜¯ä¸€ä¸ª ISA æ¡¥ï¼Œé€šè¿‡ PCI æ‰©å±•äº†ä¸€ä¸ª ISA æ€»çº¿ï¼Œå¯ä»¥å…¼å®¹è¿‡æ—¶çš„ ISA æ€»çº¿è®¾å¤‡ã€‚æœ‰ä¸ªä¸¤ä¸ª PCI bridge ï¼š00:17.0 PCI bridge å’Œ 00:17.1 PCI bridge ï¼Œæ‰©å±•äº†ä¸¤æ¡ PCI æ€»çº¿ï¼Œä¹Ÿå°±æ˜¯è¯´è¯¥ä¸»æœºæœ‰ä¸‰æ¡ PCI æ€»çº¿ã€‚è€Œ 01:00.0 Network controller å°±æ˜¯ PCI Bus #1 ä¸‹çš„ä¸€ä¸ªè®¾å¤‡ã€‚å•ç‹¬æŸ¥çœ‹è¯¥è®¾å¤‡çš„è¯¦ç»†ä¿¡æ¯ï¼š\n# lspci -s 01:00.0 -vv 01:00.0 Network controller: Intel Corporation Centrino Advanced-N 6205 [Taylor Peak] (rev 34) Subsystem: Intel Corporation Centrino Advanced-N 6205 AGN Control: I/O- Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr- Stepping- SERR- FastB2B- DisINTx+ Status: Cap+ 66MHz- UDF- FastB2B- ParErr- DEVSEL=fast \u0026gt;TAbort- \u0026lt;TAbort- \u0026lt;MAbort- \u0026gt;SERR- \u0026lt;PERR- INTx- Latency: 0 Interrupt: pin A routed to IRQ 45 #ä¸­æ–­ç®¡è„šå’Œä¸­æ–­å· Region 0: Memory at 90000000 (64-bit, non-prefetchable) [size=8K] #è®¾å¤‡å ç”¨çš„åœ°å€ç©ºé—´ Capabilities: [c8] Power Management version 3 Flags: PMEClk- DSI+ D1- D2- AuxCurrent=0mA PME(D0+,D1-,D2-,D3hot+,D3cold+) Status: D0 NoSoftRst- PME-Enable- DSel=0 DScale=0 PME- Capabilities: [d0] MSI: Enable+ Count=1/1 Maskable- 64bit+ Address: 00000000fee0100c Data: 4191 Capabilities: [e0] Express (v1) Endpoint, MSI 00 DevCap: MaxPayload 128 bytes, PhantFunc 0, Latency L0s \u0026lt;512ns, L1 unlimited ExtTag- AttnBtn- AttnInd- PwrInd- RBE+ FLReset+ DevCtl: Report errors: Correctable- Non-Fatal- Fatal- Unsupported- RlxdOrd+ ExtTag- PhantFunc- AuxPwr- NoSnoop+ FLReset- MaxPayload 128 bytes, MaxReadReq 128 bytes DevSta: CorrErr+ UncorrErr- FatalErr- UnsuppReq+ AuxPwr+ TransPend- LnkCap: Port #0, Speed 2.5GT/s, Width x1, ASPM L0s L1, Latency L0 \u0026lt;4us, L1 \u0026lt;32us ClockPM+ Surprise- LLActRep- BwNot- LnkCtl: ASPM Disabled; RCB 64 bytes Disabled- Retrain- CommClk+ ExtSynch- ClockPM- AutWidDis- BWInt- AutBWInt- LnkSta: Speed 2.5GT/s, Width x1, TrErr- Train- SlotClk+ DLActive- BWMgmt- ABWMgmt- Capabilities: [100 v1] Advanced Error Reporting UESta: DLP- SDES- TLP- FCP- CmpltTO- CmpltAbrt- UnxCmplt- RxOF- MalfTLP- ECRC- UnsupReq- ACSViol- UEMsk: DLP- SDES- TLP- FCP- CmpltTO- CmpltAbrt- UnxCmplt- RxOF- MalfTLP- ECRC- UnsupReq- ACSViol- UESvrt: DLP+ SDES- TLP- FCP+ CmpltTO- CmpltAbrt- UnxCmplt- RxOF+ MalfTLP+ ECRC- UnsupReq- ACSViol- CESta: RxErr- BadTLP- BadDLLP- Rollover- Timeout- NonFatalErr+ CEMsk: RxErr- BadTLP- BadDLLP- Rollover- Timeout- NonFatalErr+ AERCap: First Error Pointer: 00, GenCap- CGenEn- ChkCap- ChkEn- Capabilities: [140 v1] Device Serial Number 10-0b-a9-ff-ff-b4-93-2c Kernel driver in use: iwlwifi #è®¾å¤‡é©±åŠ¨ Kernel modules: iwlwifi æŸ¥çœ‹è¯¥è®¾å¤‡çš„é…ç½®ç©ºé—´ï¼š\n# lspci -s 01:00.0 -x 01:00.0 Network controller: Intel Corporation Centrino Advanced-N 6205 [Taylor Peak] (rev 34) 00: 86 80 82 00 06 04 10 00 34 00 80 02 00 00 00 00 10: 04 00 00 90 00 00 00 00 00 00 00 00 00 00 00 00 20: 00 00 00 00 00 00 00 00 00 00 00 00 86 80 01 13 30: 00 00 00 00 c8 00 00 00 00 00 00 00 ff 01 00 00 é€šè¿‡ /sys æ–‡ä»¶ç³»ç»Ÿå¯ä»¥æŸ¥çœ‹æ›´å¤šä¿¡æ¯ï¼Œ/sys/bus/pci/ ç›®å½•åŒ…å«çš„ä¸»è¦æ–‡ä»¶ï¼š\ndevicesï¼šç›®å½•ï¼ŒåŒ…å«æ‰€æœ‰ PCI è®¾å¤‡çš„æ–‡ä»¶å¤¹ drivers ï¼šç›®å½•ï¼ŒåŒ…å«æ‰€æœ‰ PCI è®¾å¤‡æ‰€ç”¨çš„é©±åŠ¨ rescan : æ–‡ä»¶ï¼Œåªå†™ï¼Œå†™å…¥ä¸€ä¸ªéé›¶å€¼ä¼šå¯¼è‡´ç³»ç»Ÿé‡æ–°æ‰«ææ‰€æœ‰çš„ PCI æ€»çº¿è®¾å¤‡ åœ¨ /sys/bus/pci/devices ä¸‹å¯ä»¥æŸ¥çœ‹æ‰€æœ‰çš„ PCI æ€»çº¿è®¾å¤‡ï¼š\nroot@WR-IntelligentDevice:/sys/bus/pci/devices# ls -l total 0 lrwxrwxrwx 1 root root 0 Nov 26 10:57 0000:00:00.0 -\u0026gt; ../../../devices/pci0000:00/0000:00:00.0 lrwxrwxrwx 1 root root 0 Nov 26 10:57 0000:00:14.0 -\u0026gt; ../../../devices/pci0000:00/0000:00:14.0 lrwxrwxrwx 1 root root 0 Nov 26 10:57 0000:00:14.1 -\u0026gt; ../../../devices/pci0000:00/0000:00:14.1 lrwxrwxrwx 1 root root 0 Nov 26 10:57 0000:00:14.2 -\u0026gt; ../../../devices/pci0000:00/0000:00:14.2 lrwxrwxrwx 1 root root 0 Nov 26 10:57 0000:00:14.3 -\u0026gt; ../../../devices/pci0000:00/0000:00:14.3 lrwxrwxrwx 1 root root 0 Nov 26 10:57 0000:00:14.4 -\u0026gt; ../../../devices/pci0000:00/0000:00:14.4 lrwxrwxrwx 1 root root 0 Nov 26 10:57 0000:00:14.5 -\u0026gt; ../../../devices/pci0000:00/0000:00:14.5 lrwxrwxrwx 1 root root 0 Nov 26 10:57 0000:00:14.6 -\u0026gt; ../../../devices/pci0000:00/0000:00:14.6 lrwxrwxrwx 1 root root 0 Nov 26 10:57 0000:00:14.7 -\u0026gt; ../../../devices/pci0000:00/0000:00:14.7 lrwxrwxrwx 1 root root 0 Nov 26 10:57 0000:00:15.0 -\u0026gt; ../../../devices/pci0000:00/0000:00:15.0 lrwxrwxrwx 1 root root 0 Nov 26 10:57 0000:00:15.1 -\u0026gt; ../../../devices/pci0000:00/0000:00:15.1 lrwxrwxrwx 1 root root 0 Nov 26 10:57 0000:00:15.2 -\u0026gt; ../../../devices/pci0000:00/0000:00:15.2 lrwxrwxrwx 1 root root 0 Nov 26 10:57 0000:00:17.0 -\u0026gt; ../../../devices/pci0000:00/0000:00:17.0 lrwxrwxrwx 1 root root 0 Nov 26 10:57 0000:00:17.1 -\u0026gt; ../../../devices/pci0000:00/0000:00:17.1 lrwxrwxrwx 1 root root 0 Nov 26 10:57 0000:00:1f.0 -\u0026gt; ../../../devices/pci0000:00/0000:00:1f.0 lrwxrwxrwx 1 root root 0 Nov 26 10:57 0000:01:00.0 -\u0026gt; ../../../devices/pci0000:00/0000:00:17.0/0000:01:00.0 ç›®å½•åç§°çš„ç»“æ„æ˜¯ PCI åŸŸ:æ€»çº¿å·:è®¾å¤‡å·:åŠŸèƒ½å·ï¼ŒPCI åŸŸæ˜¯ Linux ä¸ºäº†å®¹çº³æ›´å¤šæ€»çº¿è®¾å¤‡è€Œæ·»åŠ çš„æ¦‚å¿µã€‚å¯ä»¥çœ‹å‡º 0000:01:00.0 æ˜¯ 0000:00:17.0 PCI æ¡¥æ‰©å±•çš„ PCI Bus #1 ä¸‹çš„è®¾å¤‡ï¼Œè€Œå…¶ä»–è®¾å¤‡éƒ½åœ¨ Host bridge ä¸‹ã€‚è¿›å…¥ç›®å½• 0000:01:00.0ï¼Œå¯ä»¥çœ‹åˆ° sys æ–‡ä»¶ç³»ç»Ÿå·²ç»æŠŠé…ç½®ç©ºé—´è§£æï¼Œå¹¶åˆ†åˆ«æ˜¾ç¤ºåˆ°å„ä¸ªæ–‡ä»¶ä¸­ï¼Œä¸»è¦æ–‡ä»¶çš„ç±»å‹å’ŒåŠŸèƒ½ï¼š\nclassï¼šPCI class (ascii, ro) configï¼šPCI é…ç½®ç©ºé—´ (binary, rw)ï¼Œå¯ä»¥ç”¨ hexdum å‘½ä»¤æŸ¥çœ‹ device\tï¼šPCI device id (ascii, ro) vendorï¼šPCI vendor id (ascii, ro) enableï¼šè®¾å¤‡æ˜¯å¦å·²ç»ä½¿èƒ½ï¼Œ1 è¡¨ç¤ºæ¿€æ´»ï¼Œ0 è¡¨ç¤ºç¦ç”¨ (ascii, rw) irqï¼šIRQ number (ascii, ro) removeï¼šä»å†…æ ¸ä¸­åˆ é™¤è¯¥è®¾å¤‡(ascii, wo) resourceï¼šPCI è®¾å¤‡åˆ†é…çš„å†…å­˜èµ„æº (ascii, ro) resource0..Nï¼šPCI resource N (binary, mmap, rw[1]) driverï¼šè®¾å¤‡é©±åŠ¨ï¼ˆdir, rw) æˆ‘ä»¬å¯ä»¥å‘ 0000:01:00.0/remove æ–‡ä»¶å†™ 1 ï¼Œåˆ é™¤è¯¥è®¾å¤‡ï¼Œå†å‘ 0000:00:17.0/rescan å†™ 1 ï¼Œé‡æ–°æ‰«ææ·»åŠ è¯¥è®¾å¤‡ï¼š\n/sys/bus/pci/devices# echo 1 \u0026gt; 0000\\:01\\:00.0/remove /sys/bus/pci/devices# ls 0000:00:00.0 0000:00:14.2 0000:00:14.5 0000:00:15.0 0000:00:17.0 0000:00:14.0 0000:00:14.3 0000:00:14.6 0000:00:15.1 0000:00:17.1 0000:00:14.1 0000:00:14.4 0000:00:14.7 0000:00:15.2 0000:00:1f.0 /sys/bus/pci/devices# echo 1 \u0026gt; 0000\\:00\\:17.0/rescan /sys/bus/pci/devices# ls 0000:00:00.0 0000:00:14.3 0000:00:14.7 0000:00:17.0 0000:00:14.0 0000:00:14.4 0000:00:15.0 0000:00:17.1 0000:00:14.1 0000:00:14.5 0000:00:15.1 0000:00:1f.0 0000:00:14.2 0000:00:14.6 0000:00:15.2 0000:01:00.0 åœ¨ driver ç›®å½•ä¸‹è®¿é—®è®¾å¤‡é©±åŠ¨ï¼Œä¾‹å¦‚ 01:00.0 Network controller æ˜¯ä¸€ä¸ª Wi-Fi ç½‘å¡ï¼Œå¯ä»¥çœ‹å‡ºå®ƒç”¨çš„é©±åŠ¨æ˜¯ iwlwifi ï¼š\n/sys/bus/pci/devices/0000:01:00.0/driver# ls -l total 0 lrwxrwxrwx 1 root root 0 Nov 29 10:02 0000:01:00.0 -\u0026gt; ../../../../devices/pci0000:00/0000:00:17.0/0000:01:00.0 --w------- 1 root root 4096 Nov 29 10:02 bind lrwxrwxrwx 1 root root 0 Nov 29 10:02 module -\u0026gt; ../../../../module/iwlwifi --w------- 1 root root 4096 Nov 29 10:02 new_id --w------- 1 root root 4096 Nov 29 10:02 remove_id --w------- 1 root root 4096 Nov 27 12:02 uevent --w------- 1 root root 4096 Nov 29 10:02 unbind åœ¨ module/parameters å¯ä»¥è¯»å–é©±åŠ¨çš„å„é¡¹å‚æ•°ï¼š\n/sys/bus/pci/devices/0000:01:00.0/driver/module/parametrs# ls -l total 0 -r--r--r-- 1 root root 4096 Nov 29 10:03 11n_disable -r--r--r-- 1 root root 4096 Nov 29 10:03 amsdu_size_8K -r--r--r-- 1 root root 4096 Nov 29 10:03 antenna_coupling -r--r--r-- 1 root root 4096 Nov 29 10:03 bt_coex_active -r--r--r-- 1 root root 4096 Nov 29 10:03 fw_restart -r--r--r-- 1 root root 4096 Nov 29 10:03 led_mode -r--r--r-- 1 root root 4096 Nov 29 10:03 nvm_file -r--r--r-- 1 root root 4096 Nov 29 10:03 power_level -r--r--r-- 1 root root 4096 Nov 29 10:03 power_save -r--r--r-- 1 root root 4096 Nov 29 10:03 swcrypto -r--r--r-- 1 root root 4096 Nov 29 10:03 wd_disable /sys/bus/pci/devices/0000:01:00.0/driver/module/parametrs# cat 11n_disable 0 3.2. kernel #Linux å†…æ ¸é€šè¿‡ CF8/CFC ç«¯å£è¯»å†™ PCI é…ç½®ç©ºé—´ï¼Œå®ç°å‡½æ•°æ˜¯ /arch/x86/pci/direct.c æ–‡ä»¶çš„ pci_conf1_read() å’Œ pci_conf1_write() ï¼š\n#define PCI_CONF1_ADDRESS(bus, devfn, reg) (0x80000000 | ((reg \u0026amp; 0xF00) \u0026lt;\u0026lt; 16) | (bus \u0026lt;\u0026lt; 16) | (devfn \u0026lt;\u0026lt; 8) | (reg \u0026amp; 0xFC)) static int pci_conf1_read(unsigned int seg, unsigned int bus, unsigned int devfn, int reg, int len, u32 *value) { unsigned long flags; if (seg || (bus \u0026gt; 255) || (devfn \u0026gt; 255) || (reg \u0026gt; 4095)) { *value = -1; return -EINVAL; } raw_spin_lock_irqsave(\u0026amp;pci_config_lock, flags); outl(PCI_CONF1_ADDRESS(bus, devfn, reg), 0xCF8); switch (len) { case 1: *value = inb(0xCFC + (reg \u0026amp; 3)); break; case 2: *value = inw(0xCFC + (reg \u0026amp; 2)); break; case 4: *value = inl(0xCFC); break; } raw_spin_unlock_irqrestore(\u0026amp;pci_config_lock, flags); return 0; } static int pci_conf1_write(unsigned int seg, unsigned int bus, unsigned int devfn, int reg, int len, u32 value) { unsigned long flags; if (seg || (bus \u0026gt; 255) || (devfn \u0026gt; 255) || (reg \u0026gt; 4095)) return -EINVAL; raw_spin_lock_irqsave(\u0026amp;pci_config_lock, flags); outl(PCI_CONF1_ADDRESS(bus, devfn, reg), 0xCF8); switch (len) { case 1: outb((u8)value, 0xCFC + (reg \u0026amp; 3)); break; case 2: outw((u16)value, 0xCFC + (reg \u0026amp; 2)); break; case 4: outl((u32)value, 0xCFC); break; } raw_spin_unlock_irqrestore(\u0026amp;pci_config_lock, flags); return 0; } è®¿é—® PCIe æ‰©å±•çš„é…ç½®ç©ºé—´éœ€è¦ç”¨ pci_conf2_read() å’Œ pci_conf2_write() å‡½æ•°ã€‚\n4. PCI è®¾å¤‡çš„æšä¸¾è¿‡ç¨‹ #ç³»ç»Ÿä¸Šç”µåï¼Œä¼šé‡‡ç”¨æ·±åº¦ä¼˜å…ˆç®—æ³•ï¼Œä» Host Bridge å¼€å§‹å¯¹æ‰€æœ‰çš„ PCI/PCIe è®¾å¤‡è¿›è¡Œæ‰«æï¼Œå…¶è¿‡ç¨‹ç®€è¦æ¥è¯´æ˜¯å¯¹æ¯ä¸€ä¸ªå¯èƒ½çš„åˆ†æ”¯è·¯å¾„æ·±å…¥åˆ°ä¸èƒ½å†æ·±å…¥ä¸ºæ­¢ï¼Œè€Œä¸”æ¯ä¸ªèŠ‚ç‚¹åªèƒ½è®¿é—®ä¸€æ¬¡ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸º PCI è®¾å¤‡æšä¸¾ã€‚æšä¸¾è¿‡ç¨‹ä¸­ï¼Œç³»ç»Ÿé€šè¿‡é…ç½®è¯»äº‹ç‰©åŒ…æ¥è·å–ä¸‹æ¸¸è®¾å¤‡çš„ä¿¡æ¯ï¼Œé€šè¿‡é…ç½®å†™äº‹ç‰©åŒ…å¯¹ä¸‹æ¸¸è®¾å¤‡è¿›è¡Œè®¾ç½®ã€‚ä»¥ä¸‹å›¾ä¸ºä¾‹ï¼š\nPCI è®¾å¤‡ä½“ç³»æ˜¯ä¸€ä¸ªæ ‘å½¢ç»“æ„ï¼ŒHost Bridge æ‰©å±•çš„æ€»çº¿ä¸º Bus 0 ï¼Œç„¶åä»å·¦å¼€å§‹å‘ä¸‹æœç´¢ï¼Œæ¯ä¸ª Bridge æ‰©å±•ä¸€æ¡æ€»çº¿ï¼Œä¾æ¬¡ä»¥æ•°å­—é¡ºåºä»å°åˆ°å¤§å‘½å Bus ID ï¼Œå‘ä¸‹åˆ°å°½å¤´åé€€å›ã€‚å¦‚æœå»æ‰äº†ä¸Šå›¾çš„ Bus 3 ï¼Œåé¢è®¾å¤‡çš„ Bus ID éƒ½ä¼šå‘ç”Ÿæ”¹å˜ï¼Œå¹¶å‘å‰é€’è¿›ã€‚\nåœ¨ Linux ç³»ç»Ÿä¸­ï¼Œå¯ä»¥ç”¨ lspci -t å‘½ä»¤æŸ¥è¯¢ç³»ç»Ÿæšä¸¾åˆ°çš„ PCI è®¾å¤‡ï¼Œç»“æœä»¥æ ‘å½¢æ˜¾ç¤ºä¾èµ–å…³ç³»ï¼Œä¾‹å¦‚ï¼š\nroot@localhost:~# lspci -t -v -[0000:00]-+-00.0 Intel Corporation Atom Processor Z36xxx/Z37xxx Series SoC Transaction Register +-02.0 Intel Corporation Atom Processor Z36xxx/Z37xxx Series Graphics \u0026amp; Display +-11.0 Intel Corporation Atom Processor Z36xxx/Z37xxx Series SDIO Controller +-12.0 Intel Corporation Atom Processor Z36xxx/Z37xxx Series SDIO Controller +-13.0 Intel Corporation Atom Processor E3800 Series SATA AHCI Controller +-17.0 Intel Corporation Atom Processor E3800 Series eMMC 4.5 Controller +-1a.0 Intel Corporation Atom Processor Z36xxx/Z37xxx Series Trusted Execution Engine +-1b.0 Intel Corporation Atom Processor Z36xxx/Z37xxx Series High Definition Audio Controller +-1c.0-[01]----00.0 Intel Corporation I210 Gigabit Network Connection +-1c.1-[02]----00.0 Intel Corporation I210 Gigabit Network Connection +-1c.2-[03]----00.0 Intel Corporation Wireless 3165 +-1c.3-[04]----00.0 Intel Corporation 82574L Gigabit Network Connection +-1d.0 Intel Corporation Atom Processor Z36xxx/Z37xxx Series USB EHCI +-1f.0 Intel Corporation Atom Processor Z36xxx/Z37xxx Series Power Control Unit \\-1f.3 Intel Corporation Atom Processor E3800 Series SMBus Controller root@localhost:~# lspci 00:00.0 Host bridge: Intel Corporation Atom Processor Z36xxx/Z37xxx Series SoC Transaction Register (rev 11) 00:02.0 VGA compatible controller: Intel Corporation Atom Processor Z36xxx/Z37xxx Series Graphics \u0026amp; Display (rev 11) 00:11.0 SD Host controller: Intel Corporation Atom Processor Z36xxx/Z37xxx Series SDIO Controller (rev 11) 00:12.0 SD Host controller: Intel Corporation Atom Processor Z36xxx/Z37xxx Series SDIO Controller (rev 11) 00:13.0 SATA controller: Intel Corporation Atom Processor E3800 Series SATA AHCI Controller (rev 11) 00:17.0 SD Host controller: Intel Corporation Atom Processor E3800 Series eMMC 4.5 Controller (rev 11) 00:1a.0 Encryption controller: Intel Corporation Atom Processor Z36xxx/Z37xxx Series Trusted Execution Engine (rev 11) 00:1b.0 Audio device: Intel Corporation Atom Processor Z36xxx/Z37xxx Series High Definition Audio Controller (rev 11) 00:1c.0 PCI bridge: Intel Corporation Atom Processor E3800 Series PCI Express Root Port 1 (rev 11) 00:1c.1 PCI bridge: Intel Corporation Atom Processor E3800 Series PCI Express Root Port 2 (rev 11) 00:1c.2 PCI bridge: Intel Corporation Atom Processor E3800 Series PCI Express Root Port 3 (rev 11) 00:1c.3 PCI bridge: Intel Corporation Atom Processor E3800 Series PCI Express Root Port 4 (rev 11) 00:1d.0 USB controller: Intel Corporation Atom Processor Z36xxx/Z37xxx Series USB EHCI (rev 11) 00:1f.0 ISA bridge: Intel Corporation Atom Processor Z36xxx/Z37xxx Series Power Control Unit (rev 11) 00:1f.3 SMBus: Intel Corporation Atom Processor E3800 Series SMBus Controller (rev 11) 01:00.0 Ethernet controller: Intel Corporation I210 Gigabit Network Connection (rev 03) 02:00.0 Ethernet controller: Intel Corporation I210 Gigabit Network Connection (rev 03) 03:00.0 Network controller: Intel Corporation Wireless 3165 (rev 81) 04:00.0 Ethernet controller: Intel Corporation 82574L Gigabit Network Connection å¯ä»¥çœ‹å‡ºï¼ŒBus 1~Bus 4 æ˜¯é€šè¿‡ 00:1c.0~00:1c.3 å››ä¸ª Bridge è®¾å¤‡æ‰©å±•çš„ã€‚\n5. å‚è€ƒ # æ·±å…¥PCIä¸PCIeä¹‹ä¸€ï¼šç¡¬ä»¶ç¯‡ æ·±å…¥PCIä¸PCIeä¹‹äºŒï¼šè½¯ä»¶ç¯‡ PCIe è®¾å¤‡çš„æšä¸¾è¿‡ç¨‹ PCI configuration space sysfs-pci.txt sysfs-bus-pci ","date":"2017 November 27","permalink":"/posts/2017/11/27/","section":"Posts","summary":"1. ç¡¬ä»¶ #PCI æ€»çº¿æ˜¯ä¸€ä¸ªå¹¶è¡Œæ€»çº¿ï¼Œä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸæœ‰ 32 ä¸ª bit ï¼ˆåæ‰©å±•åˆ° 64 bitï¼‰ åŒæ—¶ä¼ è¾“ï¼Œå¸¦å®½ 133MB/s ï¼ŒPCI è®¾å¤‡å…·æœ‰ç‹¬ç«‹çš„åœ°å€ç©ºé—´ï¼Œå«åš PCI æ€»çº¿åœ°å€ç©ºé—´ï¼Œé€šè¿‡ Host bridge éš”ç¦»å¤„ç†å™¨ç³»ç»Ÿçš„å­˜å‚¨å™¨åŸŸä¸ PCI æ€»çº¿åŸŸï¼Œä¸‹é¢æŒ‚åœ¨äº†ä¸€ä¸ª PCI æ€»çº¿æ ‘ï¼Œå…¸å‹çš„ç»“æ„å¦‚ä¸‹å›¾ï¼š","title":"x86 è®¡ç®—æœºçš„ PCI æ€»çº¿ç»“æ„"},{"content":"1. æ¦‚è¿° #Appweb æ˜¯ä¸€ä¸ªå¿«é€Ÿã€é«˜æ•ˆã€å®‰å…¨çš„å¼€æºåµŒå…¥å¼ web server ï¼ŒåŒæ—¶åŒ…å«äº† ESP web æ¡†æ¶å’Œä¸€ç³»åˆ—æ‰©å±•æ”¯æŒï¼Œå¯ä»¥æå¤§çš„ç¼©çŸ­å¼€æ”¾æ—¶é—´ï¼Œå®˜ç½‘ï¼šhttps://embedthis.com/ ï¼ŒåŒ…å«å¦‚ä¸‹ç»„ä»¶ï¼š\nHTTP web server ç¨‹åºå’Œåº“ HTTP client ç¨‹åºå’Œåº“ ç®¡ç†å’Œç›‘è§†è¿›ç¨‹ ESP web æ¡†æ¶ å¯é€‰çš„ CGIã€Ejscriptã€ESP å’Œ PHP æ¨¡å— SSL/TLS æ”¯æŒåŒ… æ–‡æ¡£å’Œæºç  ç‰¹æ€§ï¼š\nå¿«é€Ÿå¼€å‘ã€‚Appweb æä¾›æœ€ç®€å•ã€æœ€ä½æ¶ˆè€—çš„å¼€å‘ web åº”ç”¨æ–¹æ³•ï¼Œå®ƒåŒ…å«äº†åµŒå…¥å¼ web åº”ç”¨å¼€å‘æ‰€éœ€çš„å…¨éƒ¨ç‰¹æ€§ï¼Œæå¤§çš„ç¼©çŸ­äº†å¼€å‘æ—¶é—´ã€‚ æœ€å°çš„èµ„æºéœ€æ±‚ã€‚Appweb éå¸¸ç®€æ´å’Œå¿«é€Ÿï¼Œåªéœ€è¦æå°çš„ç³»ç»Ÿèµ„æºï¼Œæœ€å°åªéœ€ 2MB çš„å­˜å‚¨ç©ºé—´ï¼Œè¿è¡Œæ—¶æœ€å°‘åªéœ€ 1MB å†…å­˜ã€‚ å¯å®šåˆ¶çš„å¼€å‘ç¯å¢ƒã€‚Appweb é«˜åº¦æ¨¡å—åŒ–ï¼Œä½ å¯ä»¥åªé€‰æ‹©æ‰€éœ€çš„ç‰¹æ€§ï¼Œå¹¶ä¸”æ”¯æŒè¿è¡Œæ—¶æ¨¡å—åŠ è½½å’Œç¼–è¯‘æ—¶æ§åˆ¶ã€‚ å®‰å…¨å¯é ã€‚æ”¯æŒ SSL/TLSï¼Œæä¾›æœ€åŸºæœ¬çš„éªŒè¯ï¼Œæ²™ç›’é™åˆ¶ï¼Œè®¿é—®å’Œé”™è¯¯æ—¥å¿—ã€‚ æ€§èƒ½ã€‚äº‹ä»¶é©±åŠ¨çš„å¤šçº¿ç¨‹æ ¸å¿ƒæä¾›äº†æœ€å¿«çš„å“åº”ï¼Œã€‚ æ ‡å‡†åŒ–ã€‚Appweb æ”¯æŒ HTTP/1.0 ã€HTTP/1.1 ã€CGI/1.1 ã€SSL RFC 2246 ã€HTTP RFC 2617 ã€‚ å¯ç§»æ¤ã€‚Appweb æ”¯æŒ Linux ã€Windows ã€Mac OSX ï¼Œæ”¯æŒ ARM ã€MIPS ã€i386/X86/X86_64 ã€PowerPC ç­‰ã€‚ 2. å®‰è£… #Appweb ä»¥æºç å½¢å¼åœ¨ github ä¸Šå‘å¸ƒï¼šhttps://github.com/embedthis/appweb ï¼Œæ”¯æŒçš„è¿è¡Œç¯å¢ƒï¼š\nLinux â€” Linux 2.6 with GNU C/C++ Windows â€” Microsoft Windows 7 with Visual Studio 2010 or later Mac OS X â€” Mac OS X 10.8 (Mountain Lion) or later ä¸‹è½½åè§£å‹ï¼Œåœ¨æºç ç›®å½•ä¸‹æ‰§è¡Œ make ï¼Œç¼–è¯‘å®Œæˆåç”Ÿæˆçš„æ–‡ä»¶éƒ½åœ¨ build ç›®å½•ä¸‹:\n~/appweb-7.0.1 $ cd build/linux-x64-default/bin ~/appweb-7.0.1/build/linux-x64-default/bin $ ls appman ca.key libappweb.dylib libmpr-version.a self.crt appweb ec.crt libesp.dylib libmpr.dylib self.key appweb-esp ec.key libhttp.dylib libpcre.dylib test.crt authpass esp-compile.json libmbedtls.a makerom test.key ca.crt http libmpr-mbedtls.a roots.crt vcvars.bat ç„¶åæ‰§è¡Œ make install å®‰è£…åˆ°æœ¬åœ°ï¼Œå®‰è£…æ—¶æ‰§è¡Œçš„è„šæœ¬æ˜¯ projects/appweb-linux-default.mk ï¼ŒäºŒè¿›åˆ¶æ–‡ä»¶é»˜è®¤éƒ½å®‰è£…åœ¨ /usr/local/lib/appweb/ ç›®å½•ä¸‹ã€‚å®‰è£…å®Œæˆåä¼šè‡ªåŠ¨å¯åŠ¨ appweb ã€‚å¦‚æœæƒ³è¦éƒ¨ç½²åˆ°å…¶ä»–ç³»ç»Ÿï¼Œå¯ä»¥æ‰§è¡Œ make deploy ï¼Œä¼šå°†æ‰€æœ‰éœ€è¦å®‰è£…çš„æ–‡ä»¶éƒ½è¾“å‡ºåˆ° linux-x64-default ç›®å½•ä¸‹ã€‚å½“ç„¶è¿˜å¯ä»¥äº¤å‰ç¼–è¯‘ï¼Œå¸¸ç”¨ç³»ç»Ÿçš„ç¼–è¯‘æ–‡ä»¶éƒ½åœ¨ projects ç›®å½•ä¸‹ï¼Œå¯ä»¥ç”¨ ARCH è®¾ç½®ç›®æ ‡æœºçš„ CPU ï¼Œç”¨ CCã€CFLAGSã€DFLAGSã€LD å’Œ LDFLAGS ç­‰å‚æ•°è®¾ç½®è‡ªå·±çš„äº¤å‰ç¼–è¯‘å·¥å…·é“¾ã€‚å¸è½½å¯ä»¥ç”¨ make uninstall ã€‚\n3. è¿è¡Œ #å®‰è£…åï¼Œä¼šè‡ªåŠ¨åœ¨ /etc/init.d ä¸‹æ–°å»ºä¸€ä¸ª appweb æœåŠ¡ï¼Œappweb ä¼šä½œä¸ºç³»ç»Ÿå®ˆæŠ¤è¿›ç¨‹è‡ªåŠ¨å¯åŠ¨ï¼Œé”™è¯¯æ—¥å¿—ä½äº /var/log/appweb/ ç›®å½•ä¸‹ï¼š\n$ ps -ef | grep appweb root 6501 1 0 13:44 ? 00:00:00 /usr/local/bin/appman \u0026ndash;daemon \u0026ndash;program /usr/local/bin/appweb \u0026ndash;home /etc/appweb \u0026ndash;pidfile /var/run/appweb.pid run nobody 6505 6501 0 13:44 ? 00:00:00 /usr/local/bin/appweb \u0026ndash;log stdout:1 $ sudo lsof -i | grep appweb appweb 6505 nobody 6u IPv6 1444273 0t0 TCP *:http (LISTEN) appweb 6505 nobody 7u IPv6 1444274 0t0 TCP *:https (LISTEN)\nå¦‚æœå‘ç°å¯åŠ¨ä¸æˆåŠŸï¼Œå¯ä»¥æŸ¥çœ‹ä¸€ä¸‹ /etc/appweb/install.conf æ–‡ä»¶ï¼ŒæŠŠç¬¬ä¸€è¡Œå¼€å¤´çš„ -e å»æ‰ï¼Œç„¶åé‡å¯ã€‚å¯åŠ¨æˆåé€šè¿‡æµè§ˆå™¨è®¿é—®ä¸»æœº IP å³å¯æ˜¾ç¤ºé»˜è®¤é¡µé¢ï¼š\nAppweb æä¾›äº†ä¸€ä¸ªç®¡ç†å·¥å…· appman ï¼Œå®ƒå¯ä»¥å°† appweb ä½œä¸ºä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹å¯åŠ¨ï¼Œè¿˜å¯ä»¥ç®¡ç† appweb çš„è¿è¡Œã€‚appweb çš„è¯­æ³•æ˜¯ appweb [option] ï¼Œå¯ç”¨çš„é€‰é¡¹æœ‰ï¼š\n\u0026ndash;config filenameï¼ŒæŒ‡å®šé…ç½®æ–‡ä»¶æ›¿ä»£é»˜è®¤çš„ appweb.conf. \u0026ndash;chroot directory ï¼Œæ”¹å˜ Appweb è¿è¡Œçš„ç³»ç»Ÿæ ¹ç›®å½•ï¼Œå¯¼è‡´ Appweb æ— æ³•è®¿é—®è¯¥ç›®å½•ä¹‹å¤–çš„å…¶ä»–æ–‡ä»¶ã€‚ \u0026ndash;debuggerï¼Œå¯åŠ¨ debug. \u0026ndash;log logSpec ï¼ŒæŒ‡å®š log æ–‡ä»¶ã€‚æ­¤é€‰é¡¹ä¼šè¦†ç›–é…ç½®æ–‡ä»¶ä¸­çš„ ErrorLog ï¼ŒlogSpec çš„è¯­æ³•æ˜¯ logName[:logLevel][.maxSize] ã€‚å½“ log æ–‡ä»¶çš„å¤§å°è¶…è¿‡ maxSize æ—¶ï¼Œä¼šå°† log æ–‡ä»¶å¤‡ä»½ä¸º logName.old ï¼Œå†æ–°å»ºä¸€ä¸ª logName ã€‚logLevel æ˜¯ä¸€ä¸ª 0~9 çš„æ•°å­—ï¼Œ0 è¡¨ç¤ºæœ€å°‘çš„ log ä¿¡æ¯ã€‚è¯¥é€‰é¡¹å¯ä»¥ç¼©å†™ä¸º -l ã€‚ \u0026ndash;home directory ï¼ŒæŒ‡å®šæœåŠ¡å™¨çš„æ ¹ç›®å½•ï¼Œè¯¥ç›®å½•åŒ…å« Appweb çš„é…ç½®æ–‡ä»¶ã€‚ \u0026ndash;name uniqueName ï¼Œè®¾ç½®ç¨‹åºåç§°ï¼Œå½“åŒæ—¶è¿è¡Œå¤šä¸ª appweb å®ä¾‹æ—¶ï¼Œå¯ä»¥ä¸ºå½“å‰ç¨‹åºæŒ‡å®šå”¯ä¸€åç§°ã€‚ \u0026ndash;threads ï¼Œè®¾ç½®çº¿ç¨‹å·ã€‚ \u0026ndash;verbose ï¼Œ\u0026ndash;log stderr:2 çš„ç¼©å†™ï¼Œå¯ä»¥è¿›ä¸€æ­¥ç¼©å†™ä¸º -v ã€‚ \u0026ndash;version ï¼Œæ˜¾ç¤º appweb ç‰ˆæœ¬ã€‚ å¦‚æœå¯åŠ¨ appweb æ—¶æŒ‡å®šäº† IP å’Œç«¯å£ï¼Œå°±ä¸ä¼šå»è¯»å–é»˜è®¤çš„ appweb.conf æ–‡ä»¶ï¼Œè¯­æ³•æ˜¯ï¼š\nappweb [IP]:[PORT] [documents] å¦‚æœæ²¡æœ‰æŒ‡å®šç«¯å£ï¼Œé»˜è®¤ä¼šç›‘å¬ 80 ç«¯å£ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®š IPï¼Œé»˜è®¤ä¼šç›‘å¬æ‰€æœ‰ IP ã€‚documents ç”¨äºæŒ‡å®š web é¡µé¢çš„ç›®å½•ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šé…ç½®æ–‡ä»¶ï¼Œappweb ä¼šä½¿ç”¨ä¸€ä¸ªé»˜è®¤çš„æœ€ç®€é…ç½®ã€‚\n4. é…ç½® #appweb çš„é…ç½®æ–‡ä»¶ç®¡ç†ç€ç›‘å¬çš„ IP å’Œç«¯å£ï¼Œè¦åŠ è½½çš„æ¨¡å—ï¼ŒWeb é¡µé¢çš„ä½ç½®ï¼Œå¦‚ä½•è®°å½•æ—¥å¿—ç­‰ã€‚ç½®é¡¶çš„é…ç½®æ–‡ä»¶é»˜è®¤å«åš appweb.confï¼Œå…è®¸ç”¨ include è¯­å¥å¯¼å…¥å­é…ç½®æ–‡ä»¶ã€‚é…ç½®æ–‡ä»¶ä¸­æ¯ä¸€è¡Œè®¾ç½®ä¸€ä¸ªé€‰é¡¹ï¼Œç”¨äº•å· # è¡¨ç¤ºæ³¨é‡Šã€‚ä¸€ä»½é…ç½®æ–‡ä»¶æ˜¯ç”±å¤šç§é€‰é¡¹æ„æˆçš„ï¼š\nå…¨å±€é€‰é¡¹ Route é€‰é¡¹å— Virtual Host é€‰é¡¹å— æ¡ä»¶é€‰é¡¹å— æ²¡æœ‰è¢«ä»»ä½•é€‰é¡¹å—åŒ…å«çš„é€‰é¡¹å°±æ˜¯å…¨å±€é€‰é¡¹ï¼Œå®šä¹‰ä¸€äº› appweb çš„å…¨å±€å±æ€§ã€‚Route é€‰é¡¹å—ç”¨ \u0026lt;Route \u0026ldquo;URL\u0026rdquo;\u0026gt; æ ‡ç­¾æ ‡è¯†ï¼Œç”¨äºè®¾ç½®ç‰¹å®šçš„ URLï¼Œä¾‹å¦‚ï¼š\n\u0026lt;Route \u0026quot;/myapp/\u0026quot;\u0026gt; SetHandler esp \u0026lt;/Route\u0026gt; å®ƒè¡¨ç¤ºä»¥ \u0026ldquo;/myapp/\u0026rdquo; å¼€å¤´çš„ URL è¯·æ±‚è½¬ç»™ esp å¤„ç†ã€‚\nVirtual Host é€‰é¡¹å—ç”¨ æ ‡ç­¾æ ‡è¯†ï¼Œç”¨äºå®šä¹‰è™šæ‹Ÿå­æœåŠ¡ï¼Œå°†è™šæ‹Ÿå­æœåŠ¡çš„å†…å®¹ä¸ IP æˆ–è€…åŸŸåç»‘å®šï¼Œä¾‹å¦‚ï¼š\n\u0026lt;VirtualHost\u0026gt; ServerName www.mycorp.org Documents /var/www/mycorp ... \u0026lt;/VirtualHost\u0026gt; æ¡ä»¶é€‰é¡¹å—ç”¨ æ ‡ç­¾æ ‡è¯†ï¼Œè¯»å–é…ç½®æ–‡ä»¶æ—¶ä¼šåˆ¤æ–­ SYMBOL çš„å€¼ï¼Œå¦‚æœä¸º true å°±ä¼šåŠ è½½è¿™äº›é€‰é¡¹ï¼Œå¦åˆ™å°±ä¼šå¿½ç•¥ï¼Œä¾‹å¦‚ï¼š\n\u0026lt;if FILE_MODULE\u0026gt; LoadModule fileHandler mod_file \u0026lt;/if\u0026gt; appweb æ”¯æŒä¸¤ç§æ¡ä»¶é€‰é¡¹å—ï¼š\nBLD_DEBUG ï¼šå¦‚æœ appweb ä½¿èƒ½äº† DEBUG ï¼Œè¯¥ç¬¦å·ä¸º true NAME_MODULE ï¼šå¦‚æœä½¿èƒ½äº† NAME_MODULE æ¨¡å—ï¼Œè¯¥ç¬¦å·ä¸º true æ•´ä¸ªé…ç½®æ–‡ä»¶æ˜¯ä»å¤´åˆ°å°¾è¢«è¯»å–çš„ï¼Œæ‰€æœ‰è¦æ³¨æ„å„é€‰é¡¹çš„æ’åˆ—é¡ºåºã€‚è¯´æœ‰é€‰é¡¹çš„åˆ—è¡¨ï¼šhttps://embedthis.com/appweb/doc/users/directives.html\n5. å¼€å‘ #Appweb æä¾›äº†ä¸‰ç§åº”ç”¨å¼€å‘æ–¹å¼ï¼š\nå¼€å‘é¢å¤–çš„æ¨¡å—ï¼Œç”± appweb ç¨‹åºåŠ è½½ ç”¨ ESP web æ¡†æ¶å¼€å‘ä¸€ä¸ªåº”ç”¨ï¼Œæœ‰ appweb ç¨‹åºåŠ è½½ åœ¨è‡ªå·±çš„ç¨‹åºä¸­ä½¿ç”¨ Appweb çš„ HTTP library å¼€å‘åº”ç”¨ Appweb åŒ…å«äº†å››ä¸ªå¯åŠ è½½çš„æ¨¡å—ï¼šCGI ã€ESP ã€PHP å’Œ SSL ã€‚æˆ‘ä»¬å¯ä»¥å¼€å‘è‡ªå·±çš„æ¨¡å—ï¼Œæ‰©å±•åŠŸèƒ½ï¼Œappweb æ”¯æŒåŠ¨æ€åŠ è½½å’Œé™æ€é“¾æ¥ä¸¤ç§æ–¹å¼è°ƒç”¨æ¨¡å—ï¼Œä½¿ç”¨ C è¯­è¨€æ¥å£ã€‚æ–°å»ºä¸€ä¸ªæ¨¡å—æ—¶ï¼Œé¦–å…ˆè¦æ–°å»ºä¸€ä¸ªåˆå§‹åŒ–å‡½æ•°ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š\nmaNameInit(Http *http, MprModule *module) Name å¯ä»¥æ›¿æ¢æˆæ¨¡å—çš„åå­—ï¼Œç¬¬ä¸€ä¸ªå­—æ¯å¿…é¡»å¤§å†™ï¼Œä¾‹å¦‚ maCgiHandlerInit å¯ä»¥åšä¸º CgiHandler æ¨¡å—çš„åˆå§‹åŒ–æ¥å£ï¼Œappweb åŠ è½½ CgiHandler çš„æ—¶å€™é¦–å…ˆè°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚\næ–°å»ºè‡ªå·±çš„ Handler ï¼Œå¤„ç† Http è¯·æ±‚ã€‚Handler é€šå¸¸åŒ…å«åœ¨æ¨¡å—é‡Œï¼Œç„¶ååœ¨é…ç½®æ–‡ä»¶é‡Œè®¾ç½®ï¼Œç”¨ LoadModule å‘½ä»¤åŠ è½½æ¨¡å—ï¼Œæ¯ä¸€ä¸ª handler å¯¹åº”ä¸€ç§ Http è¯·æ±‚ï¼Œåœ¨ Route é€‰é¡¹å—é‡Œç”¨ AddHandler æˆ–è€… SetHandler å‘½ä»¤è®¾ç½®ï¼Œä¾‹å¦‚ï¼š\nLoadModule myHandler mod_my \u0026lt;Route /my/\u0026gt; SetHandler myHandler \u0026lt;/Route\u0026gt; ","date":"2017 November 24","permalink":"/posts/2017/11/24/","section":"Posts","summary":"1. æ¦‚è¿° #Appweb æ˜¯ä¸€ä¸ªå¿«é€Ÿã€é«˜æ•ˆã€å®‰å…¨çš„å¼€æºåµŒå…¥å¼ web server ï¼ŒåŒæ—¶åŒ…å«äº† ESP web æ¡†æ¶å’Œä¸€ç³»åˆ—æ‰©å±•æ”¯æŒï¼Œå¯ä»¥æå¤§çš„ç¼©çŸ­å¼€æ”¾æ—¶é—´ï¼Œå®˜ç½‘ï¼šhttps://embedthis.","title":"Appweb å­¦ä¹ ç¬”è®°"},{"content":"Seafile æ˜¯ä¸€æ¬¾å¼€æºçš„ä¼ä¸šäº‘ç›˜ï¼Œæ³¨é‡å¯é æ€§å’Œæ€§èƒ½ã€‚æ”¯æŒ Windows, Mac, Linux, iOS, Android å¹³å°ã€‚æ”¯æŒæ–‡ä»¶åŒæ­¥æˆ–è€…ç›´æ¥æŒ‚è½½åˆ°æœ¬åœ°è®¿é—®ï¼Œå›½äººå¼€å‘ï¼Œå®˜æ–¹ç½‘ç«™ï¼šhttps://www.seafile.com ã€‚\n1. éƒ¨ç½² Seafile æœåŠ¡å™¨ #æˆ‘çš„äº‘æœåŠ¡å™¨æ˜¯ Ubuntu Server 16.04.1 LTS 64ä½ ï¼Œæ–°å»ºä¸€ä¸ªå·¥ä½œç›®å½• ~/seafile ï¼Œä¸‹è½½æœ€æ–°çš„æœåŠ¡å™¨å®‰è£…åŒ… seafile-server_6.2.3_x86-64.tar.gz åˆ°è¯¥ç›®å½•ï¼Œç„¶ååœ¨è¯¥ç›®å½•ä¸‹åšå¦‚ä¸‹å·¥ä½œï¼š\nmkdir installed mv seafile-server_6.2.3_x86-64.tar.gz installed tar xvf installed/seafile-server_6.2.3_x86-64.tar.gz ç°åœ¨çš„ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š\n$ tree -L 2 . |-- installed | `-- seafile-server_6.2.3_x86-64.tar.gz |-- seafile-server-6.2.3 | |-- check_init_admin.py | |-- reset-admin.sh | |-- runtime | |-- seaf-fsck.sh | |-- seaf-fuse.sh | |-- seaf-gc.sh | |-- seafile | |-- seafile.sh | |-- seahub | |-- seahub.sh | |-- setup-seafile-mysql.py | |-- setup-seafile-mysql.sh | |-- setup-seafile.sh | `-- upgrade å®‰è£…å‰å…ˆç¡®è®¤å·²ç»å®‰è£…äº†å¦‚ä¸‹åŒ…ï¼Œä¹Ÿå¯ä»¥å®‰è£…æ˜¯æ ¹æ®æç¤ºè¡¥è£…ï¼š\npython 2.7 python-setuptools python-imaging python-ldap python-urllib3 sqlite3 ç„¶åå¼€å§‹å®‰è£…ï¼š\ncd seafile-server-6.2.3/ ./setup-seafile.sh æ ¹æ®æç¤ºé…ç½®å¦‚ä¸‹é€‰é¡¹ï¼š\nseafile server name ï¼Œseafile æœåŠ¡å™¨çš„åç§° seafile server ip or domain ï¼Œseafile æœåŠ¡å™¨çš„ IP æˆ–è€…åŸŸå seafile data dir ï¼Œseafile æ•°æ®å­˜æ”¾çš„ç›®å½• seafile fileserver port ï¼Œseafile æœåŠ¡ä½¿ç”¨çš„ TCP ç«¯å£ï¼Œé»˜è®¤æ˜¯ 8082 å®‰è£…æˆåŠŸåçš„ç›®å½•ç»“æ„æ˜¯è¿™æ ·çš„ï¼š\n$ tree -L 1 . |-- ccnet |-- conf |-- installed |-- seafile-server-6.2.3 |-- seafile-server-latest -\u0026gt; seafile-server-6.2.3 |-- seahub-data `-- seahub.db 6 directories, 1 file 2. å¯åŠ¨ Seafile æœåŠ¡å™¨ #åœ¨ seafile-server-latest ç›®å½•ä¸‹æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š\nå¯åŠ¨ seafile æœåŠ¡ï¼š ./seafile.sh start å¯åŠ¨ seahub æœåŠ¡ï¼š ./seahub.sh start \u0026lt;port\u0026gt; ï¼Œé»˜è®¤è¿è¡Œåœ¨ 8000 ç«¯å£ï¼Œç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶ä¼šè¦æ±‚æ–°å»ºä¸€ä¸ªç®¡ç†å‘˜è´¦æˆ· æœåŠ¡å¯åŠ¨å, æ‰“å¼€æµè§ˆå™¨å¹¶è¾“å…¥ä»¥ä¸‹åœ°å€:\nhttp://\u0026lt;server ip\u0026gt;:8000 åœ¨æ‰“å¼€çš„ç™»å½•ç•Œé¢ä¸Šè¾“å…¥ä¹‹å‰åˆ›å»ºçš„ç®¡ç†å‘˜å¸å·çš„ç”¨æˆ·å/å¯†ç å³å¯ã€‚å¦‚æœä¸æƒ³ç”¨ 8000 ç«¯å£ï¼Œå…ˆä¿®æ”¹ conf/ccnet.conf æ–‡ä»¶ä¸­çš„ SERVICE_URL ï¼Œå°†ç«¯å£å·æ”¹ä¸ºä½ æƒ³è¦çš„ï¼Œæ¯”å¦‚ 8001 :\nSERVICE_URL = http://\u0026lt;server ip\u0026gt;:8001 ç„¶åç”¨æ–°çš„ç«¯å£å·é‡å¯æœåŠ¡ã€‚\n3. å¼€æœºè‡ªå¯åŠ¨ #åˆ›å»º seafile çš„ systemd æœåŠ¡æ–‡ä»¶ï¼š\nsudo vim /etc/systemd/system/seafile.service å†…å®¹å¦‚ä¸‹ï¼Œå°† ${seafile_dir} æ›¿æ¢ä¸º seafile å®‰è£…è·¯å¾„ï¼Œå¹¶ä¸”å°† user å’Œ group æŒ‡å‘çœŸæ­£è¿è¡Œ seafile çš„ç”¨æˆ·ï¼š\n[Unit] Description=Seafile # add mysql.service or postgresql.service depending on your database to the line below After=network.target [Service] Type=oneshot ExecStart=${seafile_dir}/seafile-server-latest/seafile.sh start ExecStop=${seafile_dir}/seafile-server-latest/seafile.sh stop RemainAfterExit=yes User=seafile Group=seafile [Install] WantedBy=multi-user.target åˆ›å»º seahub çš„ systemd æœåŠ¡æ–‡ä»¶ï¼š\nsudo vim /etc/systemd/system/seahub.service å†…å®¹å¦‚ä¸‹ï¼Œå°† ${seafile_dir} æ›¿æ¢ä¸º seafile å®‰è£…è·¯å¾„ï¼Œ æ›¿æ¢éœ€è¦çš„ç«¯å£ï¼Œå¹¶ä¸”å°† user å’Œ group æŒ‡å‘çœŸæ­£è¿è¡Œ seafile çš„ç”¨æˆ·ï¼Œï¼š\n[Unit] Description=Seafile hub After=network.target seafile.service [Service] # change start to start-fastcgi if you want to run fastcgi ExecStart=${seafile_dir}/seafile-server-latest/seahub.sh start \u0026lt;port\u0026gt; ExecStop=${seafile_dir}/seafile-server-latest/seahub.sh stop User=seafile Group=seafile Type=oneshot RemainAfterExit=yes [Install] WantedBy=multi-user.target ä½¿èƒ½å¼€æœºè‡ªå¯åŠ¨ï¼š\nsudo systemctl enable seafile.service sudo systemctl enable seahub.service ","date":"2017 November 18","permalink":"/posts/2017/11/18/","section":"Posts","summary":"Seafile æ˜¯ä¸€æ¬¾å¼€æºçš„ä¼ä¸šäº‘ç›˜ï¼Œæ³¨é‡å¯é æ€§å’Œæ€§èƒ½ã€‚æ”¯æŒ Windows, Mac, Linux, iOS, Android å¹³å°ã€‚æ”¯æŒæ–‡ä»¶åŒæ­¥æˆ–è€…ç›´æ¥æŒ‚è½½åˆ°æœ¬åœ°è®¿é—®ï¼Œå›½äººå¼€å‘ï¼Œå®˜æ–¹ç½‘ç«™ï¼šhttps://www.","title":"ç”¨ seafile è‡ªå»ºäº‘å­˜å‚¨"},{"content":"Supervisor æ˜¯ä¸€ä¸ª Python ç¼–å†™çš„è¿›ç¨‹ç®¡ç†å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å®ç°è¿›ç¨‹çš„å¯åŠ¨ã€å…³é—­å’Œé‡å¯ï¼Œå¯ä»¥å¯¹å¤šä¸ªè¿›ç¨‹ç‹¬ç«‹ç®¡ç†ï¼Œæˆ–è€…åˆ†ç»„ç®¡ç†ï¼Œé€šå¸¸ç”¨äº Linux æœåŠ¡å™¨çš„è¿›ç¨‹ç®¡ç†ï¼Œå®˜æ–¹ç½‘ç«™ supervisord.org ã€‚æœ‰ä¸¤ä¸ªä¸»è¦çš„ç»„æˆéƒ¨åˆ†ï¼š\nsupervisordï¼Œè¿è¡Œ Supervisor æ—¶ä¼šå¯åŠ¨ä¸€ä¸ªè¿›ç¨‹ supervisordï¼Œå®ƒè´Ÿè´£å¯åŠ¨æ‰€ç®¡ç†çš„è¿›ç¨‹ï¼Œå¹¶å°†æ‰€ç®¡ç†çš„è¿›ç¨‹ä½œä¸ºè‡ªå·±çš„å­è¿›ç¨‹æ¥å¯åŠ¨ï¼Œè€Œä¸”å¯ä»¥åœ¨æ‰€ç®¡ç†çš„è¿›ç¨‹å‡ºç°å´©æºƒæ—¶è‡ªåŠ¨é‡å¯ã€‚ supervisorctlï¼Œå‘½ä»¤è¡Œç®¡ç†å·¥å…·ï¼Œå¯ä»¥ç”¨æ¥æ‰§è¡Œ stopã€startã€restart ç­‰å‘½ä»¤ï¼Œæ¥å¯¹è¿™äº›å­è¿›ç¨‹è¿›è¡Œç®¡ç†ã€‚ 1. å®‰è£… #å¯ä»¥ç”¨ pip å®‰è£…ï¼š\nsudo pip install supervisor å¦‚æœæ˜¯ Ubuntu ç³»ç»Ÿï¼Œä¹Ÿå¯ä»¥ç”¨ apt-get ï¼š\nsudo apt-get install supervisor 2. é…ç½® #å®‰è£…æˆåŠŸåï¼Œéœ€è¦æ‰‹åŠ¨ç”Ÿæˆä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå®‰è£…åŒ…æä¾›äº† echo_supervisord_conf å·¥å…·å®Œæˆè¿™é¡¹å·¥ä½œï¼š\nsudo echo_supervisord_conf \u0026gt; /etc/supervisord.conf å‡ºå»æ³¨é‡Šéƒ¨åˆ†ï¼Œä¸€äº›æœ‰ç”¨çš„é…ç½®é€‰é¡¹ï¼š\n[unix_http_server] file=/tmp/supervisor.sock ; UNIX socket æ–‡ä»¶ï¼Œsupervisorctl ä¼šä½¿ç”¨ [supervisord] logfile=/tmp/supervisord.log ; æ—¥å¿—æ–‡ä»¶ï¼Œé»˜è®¤æ˜¯ $CWD/supervisord.log logfile_maxbytes=50MB ; æ—¥å¿—æ–‡ä»¶å¤§å°ï¼Œè¶…å‡ºä¼š rotateï¼Œé»˜è®¤ 50MB logfile_backups=10 ; æ—¥å¿—æ–‡ä»¶ä¿ç•™å¤‡ä»½æ•°é‡é»˜è®¤ 10 loglevel=info ; æ—¥å¿—çº§åˆ«ï¼Œé»˜è®¤ infoï¼Œå…¶å®ƒ: debug,warn,trace pidfile=/tmp/supervisord.pid ; pid æ–‡ä»¶ nodaemon=false ; æ˜¯å¦åœ¨å‰å°å¯åŠ¨ï¼Œé»˜è®¤æ˜¯ falseï¼Œå³ä»¥ daemon çš„æ–¹å¼å¯åŠ¨ minfds=1024 ; å¯ä»¥æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦çš„æœ€å°å€¼ï¼Œé»˜è®¤ 1024 minprocs=200 ; å¯ä»¥æ‰“å¼€çš„è¿›ç¨‹æ•°çš„æœ€å°å€¼ï¼Œé»˜è®¤ 200 [rpcinterface:supervisor] supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface [supervisorctl] serverurl=unix:///tmp/supervisor.sock ; é€šè¿‡ UNIX socket è¿æ¥ supervisordï¼Œè·¯å¾„ä¸ unix_http_server éƒ¨åˆ†çš„ file ä¸€è‡´ ; åŒ…å«å…¶ä»–çš„é…ç½®æ–‡ä»¶ [include] files = relative/directory/*.ini ; å¯ä»¥æ˜¯ *.conf æˆ– *.ini åœ¨è¿™ä¸ªæ–‡ä»¶çš„æœ€åº•éƒ¨ï¼Œå¯ä»¥æ·»åŠ æˆ‘ä»¬è¦ç®¡ç†çš„è¿›ç¨‹ã€‚å‡è®¾æœ‰ä¸€ä¸ªå®šæ—¶æ‰“å°æ—¶é—´çš„è„šæœ¬ test.sh ï¼Œåœ¨ /home/ubuntu/ ç›®å½•ä¸‹ï¼š\n#!/bin/sh touch test.log while true : do date \u0026gt;\u0026gt; /home/ubuntu/test.log sleep 10 done æˆ‘ä»¬æŠŠå®ƒæ·»åŠ åˆ° supervisord ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ï¼š\n[program:test] directory=/home/ubuntu/ ; ç¨‹åºæ‰§è¡Œçš„ç›®å½• command=/home/ubuntu/test.sh ; æ‰§è¡Œç¨‹åºçš„å‘½ä»¤ autostart = true ; åœ¨ supervisord å¯åŠ¨çš„æ—¶å€™ä¹Ÿè‡ªåŠ¨å¯åŠ¨ startsecs = 5 ; å¯åŠ¨ 5 ç§’åæ²¡æœ‰å¼‚å¸¸é€€å‡ºï¼Œå°±å½“ä½œå·²ç»æ­£å¸¸å¯åŠ¨äº† autorestart = true ; ç¨‹åºå¼‚å¸¸é€€å‡ºåè‡ªåŠ¨é‡å¯ startretries = 3 ; å¯åŠ¨å¤±è´¥è‡ªåŠ¨é‡è¯•æ¬¡æ•°ï¼Œé»˜è®¤æ˜¯ 3 user = leon ; ç”¨å“ªä¸ªç”¨æˆ·å¯åŠ¨ redirect_stderr = true ; æŠŠ stderr é‡å®šå‘åˆ° stdoutï¼Œé»˜è®¤ false stdout_logfile_maxbytes = 20MB ; stdout æ—¥å¿—æ–‡ä»¶å¤§å°ï¼Œé»˜è®¤ 50MB stdout_logfile_backups = 20 ; stdout æ—¥å¿—æ–‡ä»¶å¤‡ä»½æ•° stdout_logfile = /var/log/usercenter_stdout.log ; stdout æ—¥å¿—æ–‡ä»¶ï¼Œéœ€è¦æ³¨æ„å½“æŒ‡å®šç›®å½•ä¸å­˜åœ¨æ—¶æ— æ³•æ­£å¸¸å¯åŠ¨ï¼Œæ‰€ä»¥éœ€è¦æ‰‹åŠ¨åˆ›å»ºç›®å½•ï¼ˆsupervisord ä¼šè‡ªåŠ¨åˆ›å»ºæ—¥å¿—æ–‡ä»¶ï¼‰ å…¶ä¸­ [program:test ä¸­çš„ test æ˜¯åº”ç”¨ç¨‹åºçš„å”¯ä¸€æ ‡è¯†ï¼Œä¸èƒ½é‡å¤ã€‚å¯¹è¯¥ç¨‹åºçš„æ‰€æœ‰æ“ä½œï¼ˆstart, restart ç­‰ï¼‰éƒ½é€šè¿‡åå­—æ¥å®ç°ã€‚è¦æ³¨æ„çš„æ˜¯ï¼ŒSupervisor åªèƒ½ç®¡ç†åœ¨å‰å°è¿è¡Œçš„ç¨‹åºï¼Œæ‰€ä»¥å¦‚æœåº”ç”¨ç¨‹åºæœ‰åå°è¿è¡Œçš„é€‰é¡¹ï¼Œéœ€è¦å…³é—­ã€‚é…ç½®æˆåŠŸåï¼Œå°±å¯ä»¥å¯åŠ¨ supervisord ï¼š\n~$ supervisord -c /etc/supervisord.conf ~$ ps -ef | grep super ubuntu 3667 1 0 16:52 ? 00:00:00 /usr/bin/python /usr/local/bin/supervisord -c /etc/supervisord.conf ~$ ps -ef | grep test ubuntu 3668 3667 0 16:52 ? 00:00:00 /bin/sh /home/ubuntu/test.sh 3. ç®¡ç† #Supervisorctl æ˜¯ supervisord çš„ä¸€ä¸ªå‘½ä»¤è¡Œå®¢æˆ·ç«¯å·¥å…·ï¼Œé€šè¿‡å®ƒå®ç°å¯¹ç¨‹åºçš„å¯åŠ¨å’Œåœæ­¢ï¼Œå¯ä»¥å•ç‹¬å…³é—­ä¸€ä¸ªç¨‹åºï¼š\n~$ supervisorctl stop test test: stopped å¦‚æœè¦ç®¡ç†æ‰€æœ‰ç¨‹åºï¼Œç”¨ä¿ç•™çš„åç§° all ï¼š\n~$ supervisorctl start all test: started ~$ supervisorctl status test test RUNNING pid 4277, uptime 0:00:20 å…¶ä»–çš„é€‰é¡¹ï¼š\nreread ï¼ƒ è¯»å–æœ‰æ›´æ–°ï¼ˆå¢åŠ ï¼‰çš„é…ç½®æ–‡ä»¶ï¼Œä¸ä¼šå¯åŠ¨æ–°æ·»åŠ çš„ç¨‹åº update ï¼ƒ é‡å¯é…ç½®æ–‡ä»¶ä¿®æ”¹è¿‡çš„ç¨‹åº é™¤äº† supervisorctl ä¹‹å¤–ï¼Œè¿˜å¯ä»¥é…ç½® supervisrod å¯åŠ¨ web ç®¡ç†ç•Œé¢ï¼Œè¿™ä¸ª web åå°ä½¿ç”¨ Basic Auth çš„æ–¹å¼è¿›è¡Œèº«ä»½è®¤è¯ã€‚é™¤äº†å•ä¸ªè¿›ç¨‹çš„æ§åˆ¶ï¼Œè¿˜å¯ä»¥é…ç½® groupï¼Œè¿›è¡Œåˆ†ç»„ç®¡ç†ã€‚ç»å¸¸æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ï¼ŒåŒ…æ‹¬ supervisord çš„æ—¥å¿—å’Œå„ä¸ª pragram çš„æ—¥å¿—æ–‡ä»¶ï¼Œç¨‹åº crash æˆ–æŠ›å‡ºå¼‚å¸¸çš„ä¿¡æ¯ä¸€åŠä¼šè¾“å‡ºåˆ° stderrï¼Œå¯ä»¥æŸ¥çœ‹ç›¸åº”çš„æ—¥å¿—æ–‡ä»¶æ¥æŸ¥æ‰¾é—®é¢˜ã€‚æ›´å¤šçš„ä¿¡æ¯å¯ä»¥æŸ¥çœ‹å®˜æ–¹çš„å¸®åŠ©æ–‡æ¡£ï¼šhttp://supervisord.org/index.html\n4. å¼€æœºå¯åŠ¨ #åœ¨ /etc/systemd/system ç›®å½•ä¸‹æ·»åŠ  supervisord.service æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\ncat supervisord.service [Unit] Description=supervisord # add mysql.service or postgresql.service depending on your database to the line below After=network.target [Service] Type=oneshot ExecStart=/usr/local/bin/supervisord -c /etc/supervisord.conf ExecStop=/usr/local/bin/supervisorctl shutdown ExecReload=/usr/local/bin/supervisorctl reload RemainAfterExit=yes User=ubuntu Group=ubuntu [Install] WantedBy=multi-user.target ç„¶åæ‰§è¡Œ systemctl enable supervisord.service ä½¿èƒ½è¯¥æœåŠ¡å¼€æœºå¯åŠ¨ã€‚\n","date":"2017 November 9","permalink":"/posts/2017/11/09/","section":"Posts","summary":"Supervisor æ˜¯ä¸€ä¸ª Python ç¼–å†™çš„è¿›ç¨‹ç®¡ç†å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å®ç°è¿›ç¨‹çš„å¯åŠ¨ã€å…³é—­å’Œé‡å¯ï¼Œå¯ä»¥å¯¹å¤šä¸ªè¿›ç¨‹ç‹¬ç«‹ç®¡ç†ï¼Œæˆ–è€…åˆ†ç»„ç®¡ç†ï¼Œé€šå¸¸ç”¨äº Linux æœåŠ¡å™¨çš„è¿›ç¨‹ç®¡ç†ï¼Œå®˜æ–¹ç½‘ç«™ supervisord.","title":"ç”¨ Supervisor ç®¡ç†è¿›ç¨‹"},{"content":"1. Python å¼€å‘ç¯å¢ƒ #ä¸º vscode å®‰è£… Python æ’ä»¶ï¼Œç„¶åé€‰æ‹© Python ç‰ˆæœ¬ï¼š\né€šè¿‡ shift+command+p ç»„åˆé”®æ‰“å¼€å‘½ä»¤æ§åˆ¶æ¿ é€‰æ‹© Python:Select Workspace Interpreter é€‰æ‹© Python ç‰ˆæœ¬ 2. åœ¨ç»ˆç«¯æ‰“å¼€ vscode #åœ¨ zsh ç»ˆç«¯é‡Œç”¨ vscode ç›´æ¥æ‰“å¼€å½“å‰ç›®å½•ï¼Œç¼–è¾‘é…ç½®æ–‡ä»¶ ~/.zshrc ï¼Œåœ¨æœ€ååŠ ä¸€è¡Œï¼š\nalias code='/Applications/Visual\\ Studio\\ Code.app/Contents/Resources/app/bin/code' ä¿å­˜åé‡å¯ç»ˆç«¯ï¼Œæ‰¾ä¸€ä¸ªé¡¹ç›®æ–‡ä»¶å¤¹ï¼Œç›´æ¥æ‰“å¼€ vscode ï¼š\n$ code . 3. è¿œç¨‹ FTP åŒæ­¥ #ftp-sync æ˜¯ä¸€ä¸ªè‡ªåŠ¨å°†æœ¬åœ°å·¥ä½œç›®å½•æ–‡ä»¶åŒæ­¥åˆ°è¿œç¨‹ FTP/SFTP æœåŠ¡å™¨çš„æ’ä»¶ã€‚å®‰è£…åå¯ä»¥é€šè¿‡ä¸‰ä¸ªå‘½ä»¤å®ŒæˆåŒæ­¥ï¼š\nFtp-sync: Initï¼Œåœ¨ .vscode ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªé»˜è®¤çš„ ftp-sync é…ç½®æ–‡ä»¶ Ftp-sync: Sync Local to Remoteï¼ŒåŒæ­¥æœ¬åœ°æ–‡ä»¶åˆ°è¿œç¨‹æœåŠ¡å™¨ Ftp-sync: Sync Remote to Localï¼ŒåŒæ­¥è¿œç¨‹æœåŠ¡å™¨çš„æ–‡ä»¶åˆ°æœ¬åœ°ç›®å½• 4. Align æ’ä»¶ #è¿™ä¸ªæ’ä»¶å¯ä»¥å¯¹é€‰ä¸­çš„ä»£ç è¿›è¡Œå¯¹é½æ“ä½œï¼Œé€‰ä¸­å‡ è¡Œä»£ç ï¼ŒæŒ‰ä¸‹ command+control+a ç»„åˆé”®å³å¯ã€‚\n5. Markdown #VScode åŸç”Ÿæ”¯æŒ Markdown é¢„è§ˆï¼Œå¿«æ·é”® command+k å†æŒ‰ v å°±å¯ä»¥åˆ†å±é¢„è§ˆã€‚è€Œ Markdown preview enhanced æ’ä»¶å¯ä»¥æä¾›æ›´å¥½çš„é¢„è§ˆæ•ˆæœå’Œå†™ä½œä½“éªŒï¼Œå¹¶ä¸”å¯ä»¥å¯¼å‡ºå„ç§æ ¼å¼ï¼ŒåŒ…æ‹¬ HTMLã€PDFã€Wordã€eBook ç­‰ã€‚\n6. è‡ªå®šä¹‰é¢œè‰²ä¸»é¢˜ #é»˜è®¤çš„é¢œè‰²ä¸»é¢˜éƒ½å®‰è£…åœ¨å®‰è£…è·¯å¾„ä¸‹çš„ resources/app/extensions/ ç›®å½•ä¸‹ï¼Œå®‰è£…çš„æ‰©å±•éƒ½æ”¾åœ¨ C:/Users/[username]/.vscode/extensions/ ç›®å½•ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä»é»˜è®¤çš„é¢œè‰²ä¸»é¢˜å¤åˆ¶ä¸€ä»½åˆ°æ‰©å±•å®‰è£…è·¯å¾„ä¸‹ï¼Œç„¶ååœ¨æ­¤åŸºç¡€ä¸Šä¿®æ”¹ã€‚æ¯”å¦‚å¤åˆ¶ä¸€ä»½ theme-solarized-dark ï¼Œé‡å‘½åä¸º theme-solarized-dark-custom ã€‚\nå¦‚æœæ˜¯ MacOS ï¼Œæ‰©å±•å®‰è£…ç›®å½•åœ¨ ~/.vscode/extensions/ ã€‚\n","date":"2017 November 7","permalink":"/posts/2017/11/07/","section":"Posts","summary":"1. Python å¼€å‘ç¯å¢ƒ #ä¸º vscode å®‰è£… Python æ’ä»¶ï¼Œç„¶åé€‰æ‹© Python ç‰ˆæœ¬ï¼š","title":"VScode ä½¿ç”¨ç¬”è®°"},{"content":"Mac é»˜è®¤å®‰è£…çš„æ˜¯ Python2.7 ï¼Œå†å®‰è£…ä¸€ä¸ª Python3.6 ï¼Œå°±å‡ºç°äº†ä¸¤ä¸ªç‰ˆæœ¬å…±å­˜çš„é—®é¢˜ï¼Œä¸åŒçš„é¡¹ç›®ã€ä¸åŒçš„ç¨‹åºè¦ç”¨ä¸åŒçš„ç‰ˆæœ¬ï¼Œå°±éœ€è¦åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼Œåˆ‡æ¢ç‰ˆæœ¬ã€‚Python3 æä¾›äº† pyvenv æ¨¡å—åŸç”Ÿæ”¯æŒè™šæ‹Ÿç¯å¢ƒï¼Œ\nè¦åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒï¼Œé¦–å…ˆå†³å®šä¸€ä¸ªä½ æƒ³è¦å­˜æ”¾çš„ç›®å½•ï¼Œæ¥ç€è¿è¡Œ pyvenv åé¢æºå¸¦ç€ç›®å½•å:\npyvenv tutorial-env å¦‚æœç›®å½•ä¸å­˜åœ¨çš„è¯ï¼Œè¿™å°†ä¼šåˆ›å»ºä¸€ä¸ª tutorial-env ç›®å½•ï¼Œå¹¶ä¸”ä¹Ÿåœ¨ç›®å½•é‡Œé¢åˆ›å»ºä¸€ä¸ªåŒ…å« Python è§£é‡Šå™¨ï¼Œæ ‡å‡†åº“ï¼Œä»¥åŠå„ç§é…å¥—æ–‡ä»¶çš„ Python â€œå‰¯æœ¬â€ã€‚ä¹‹åä½ å¿…é¡»æ¿€æ´»å®ƒï¼š\nsource tutorial-env/bin/activate æ¿€æ´»äº†è™šæ‹Ÿç¯å¢ƒä¼šæ”¹å˜ä½ çš„ shell æç¤ºç¬¦ï¼Œæ˜¾ç¤ºä½ æ­£åœ¨ä½¿ç”¨çš„è™šæ‹Ÿç¯å¢ƒï¼Œå¹¶ä¸”ä¿®æ”¹äº†ç¯å¢ƒå˜é‡ä»¥è‡´è¿è¡Œ python å°†ä¼šè®©ä½ å¾—åˆ°äº†ç‰¹å®šçš„ Python ç‰ˆæœ¬ï¼Œä»¥åç”¨ pip å®‰è£…çš„åŒ…éƒ½ä¼šæ”¾åœ¨è™šæ‹Ÿç¯å¢ƒçš„ç›®å½•ä¸‹ã€‚ä¾‹å¦‚:\n~$ python --version Python 2.7.10 ~$ source tutorial-env/bin/activate ~(tutorial-env) $ python --version Python 3.6.2 ~(tutorial-env) $ pip --version pip 9.0.1 from /Users/lishaocheng/Workspace/py3/lib/python3.6/site-packages (python 3.6) å¦‚æœè¦é€€å›åŸæ¥çš„ç¯å¢ƒï¼Œæ‰§è¡Œ exit æˆ–è€…å†å¼€ä¸€ä¸ªç»ˆç«¯å³å¯ã€‚\nå‚è€ƒï¼šè™šæ‹Ÿç¯å¢ƒå’ŒåŒ…\n","date":"2017 October 27","permalink":"/posts/2017/10/27/","section":"Posts","summary":"Mac é»˜è®¤å®‰è£…çš„æ˜¯ Python2.","title":"ç”¨ pyvenv åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ"},{"content":"1. è´­ä¹° VPS #æ¨è https://www.vultr.com ï¼Œæ³¨å†ŒæˆåŠŸåå…ˆå……å€¼ï¼ŒVultr æ”¯æŒä¿¡ç”¨å¡ã€æ¯”ç‰¹å¸å’Œæ”¯ä»˜å®ç­‰ï¼Œæ”¯ä»˜å®æ¯”è¾ƒæ–¹ä¾¿ï¼š\nå……å€¼å®Œæ¯•åï¼Œç‚¹å‡»å³ä¸Šè§’çš„è“è‰²åŠ å·è´­ä¹°æœåŠ¡å™¨ï¼Œç„¶åé€‰æ‹©æœåŠ¡å™¨ä½ç½®ã€ç³»ç»Ÿå’Œé…ç½®ï¼Œå›½å†…æ¨èä¸œäº¬ï¼š\né€‰æ‹© Ubuntu 16.04 ç³»ç»Ÿï¼Œ$5/æœˆçš„å¥—é¤ï¼Œå¯ä»¥å…ˆè´­ä¹°ä¸€ä¸ªæœˆè¯•ç”¨ï¼š\nä½¿èƒ½ç§æœ‰ IP ï¼š\nç‚¹å‡»å·¦ä¸‹è§’çš„ Deploy Now å®Œæˆè´­ä¹°ï¼Œç¨ç­‰ç‰‡åˆ»ï¼Œå®‰è£…å®Œæˆåï¼š\nç‚¹å‡»æœåŠ¡å™¨åç§°ï¼Œè¿›å…¥è¯¦æƒ…é¡µï¼Œè®°ä¸‹ IP Addressã€Username å’Œ Password ï¼š\nç°åœ¨å°±å¯ä»¥ç”¨ SSH å®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥ç‚¹å‡»å³ä¸Šç¬¬ä¸€ä¸ªå›¾æ ‡ View Console ï¼Œæ‰“å¼€ä¸€ä¸ª Console å¯¹è¯æ¡†ï¼Œè¾“å…¥ç”¨æˆ·åå’Œå¯†ç ç™»å½•ï¼š\n2. å®‰è£… SSR #æœ‰ä¸€ä¸ªä¸€é”®å®‰è£…çš„è„šæœ¬ï¼Œé¡¹ç›®ä¸»é¡µåœ¨ https://github.com/teddysun/shadowsocks_installï¼Œåœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š\nwget --no-check-certificate https://raw.githubusercontent.com/teddysun/shadowsocks_install/master/shadowsocksR.sh chmod +x shadowsocksR.sh ./shadowsocksR.sh 2\u0026gt;\u0026amp;1 | tee shadowsocksR.log æ ¹æ®æç¤ºé…ç½®ï¼š\næœåŠ¡å™¨ç«¯å£ï¼šè‡ªå·±è®¾å®šï¼ˆå¦‚ä¸è®¾å®šï¼Œé»˜è®¤ä¸º 8989ï¼‰ å¯†ç ï¼šè‡ªå·±è®¾å®šï¼ˆå¦‚ä¸è®¾å®šï¼Œé»˜è®¤ä¸º teddysun.comï¼‰ åŠ å¯†æ–¹å¼ï¼šè‡ªå·±è®¾å®šï¼ˆå¦‚ä¸è®¾å®šï¼Œé»˜è®¤ä¸º aes-256-cfbï¼‰ åè®®ï¼ˆProtocolï¼‰ï¼šè‡ªå·±è®¾å®šï¼ˆå¦‚ä¸è®¾å®šï¼Œé»˜è®¤ä¸º originï¼‰ æ··æ·†ï¼ˆobfsï¼‰ï¼šè‡ªå·±è®¾å®šï¼ˆå¦‚ä¸è®¾å®šï¼Œé»˜è®¤ä¸º plainï¼‰ å®‰è£…å®Œæˆåï¼Œè„šæœ¬ä¼šæç¤ºå¦‚ä¸‹,ï¼Œè®°ä½è‡ªå·±çš„é…ç½®ï¼š\nCongratulations, ShadowsocksR server install completed! Your Server IP :your_server_ip Your Server Port :your_server_port Your Password :your_password Your Protocol :your_protocol Your obfs :your_obfs Your Encryption Method:your_encryption_method Welcome to visit:https://shadowsocks.be/9.html Enjoy it! ShadowsocksR å·²ç»åŠ å…¥å¼€æœºè‡ªå¯åŠ¨ï¼ŒæŸ¥çœ‹è¿è¡ŒçŠ¶æ€ï¼š\n~# /etc/init.d/shadowsocks status ShadowsocksR (pid 28287) is running... å¦‚æœæƒ³è¦å¸è½½ï¼Œæ‰§è¡Œï¼š\n./shadowsocksR.sh uninstall 3. å®¢æˆ·ç«¯ # Windows å®¢æˆ·ç«¯ï¼šhttps://github.com/shadowsocksr-backup/shadowsocksr-csharp/releases Mac å®¢æˆ·ç«¯ï¼šhttps://github.com/shadowsocksr-backup/ShadowsocksX-NG/releases 4. æµ‹è¯• #æŸ¥çœ‹æœ¬åœ° IP å’Œæ‰€åœ¨çº¿è·¯ http://www.ipip.net/ip.html ï¼š\næµ‹è¯•å„çº¿è·¯ ping å»¶æ—¶ http://www.ipip.net/ping.php :\nè·¯ç”±è¿½è¸ª http://www.ipip.net/traceroute.php :\nå¦å¤–æœ‰ä¸€ä¸ªæµ‹è¯•è„šæœ¬ bench.sh ï¼Œç§‹æ°´é€¸å†°å¤§ç¥å†™çš„ï¼Œbench.sh æ—¢æ˜¯è„šæœ¬åï¼ŒåŒæ—¶åˆæ˜¯åŸŸåï¼Œä¸‹è½½æ‰§è¡ŒåŒæ­¥ï¼Œæ„Ÿè§‰å¾ˆå±Œï¼š\nwget -qO- bench.sh | bash å‚è€ƒï¼šhttps://teddysun.com/444.html\n5. åŠ é€Ÿ #ç›´æ¥è®¿é—®å¢ƒå¤– VPS çš„å»¶æ—¶æ™®éå¾ˆé«˜ï¼Œæœ‰äº›è¿˜ä¸ç¨³å®šï¼Œä¸¢åŒ…ç‡é£™å‡ã€‚è¿™æ—¶éœ€è¦é€šè¿‡æµ‹è¯•ï¼Œæ‰¾å‡ºè¿æ¥æ¯”è¾ƒå¿«çš„å¤§é™†èŠ‚ç‚¹ï¼Œç„¶åç§Ÿä¸€å°è¯¥èŠ‚ç‚¹ä¸Šçš„æœåŠ¡å™¨ï¼Œä½œä¸ºä¸­ç»§åŠ é€Ÿï¼Œæœ€ç»ˆçš„çº¿è·¯æ˜¯ï¼š\næœ¬åœ°PC \u0026lt;==\u0026gt; ä¸­ç»§æœåŠ¡å™¨ \u0026lt;==\u0026gt; SSR ä»£ç† \u0026lt;==\u0026gt; FreeInternet ç°åœ¨ä¸­ç»§æœåŠ¡å™¨ä¸Šå®‰è£… HAProxy ï¼Œè¿™æ˜¯ä¸€æ¬¾ HTTP/TCP è´Ÿè½½å‡è¡¡å™¨ï¼Œæ ¸å¿ƒåŠŸèƒ½å°±æ˜¯å°†å‰ç«¯çš„å¤§æµé‡è¯·æ±‚ï¼Œåˆ†æµåˆ°åç«¯çš„å„ä¸ªæœåŠ¡å™¨ä¸­ã€‚åŸç†ä¸æˆ‘ä»¬è¦å®ç°çš„ä»£ç†ä¸­ç»§éå¸¸ç±»ä¼¼ã€‚Haproxy ç›‘å¬ç‰¹å®šç«¯å£çš„è¯·æ±‚ï¼Œç„¶åå°†è¿™ä¸ªè¯·æ±‚è½¬å‘åˆ°åå°çš„æŸä¸€å°æœåŠ¡å™¨çš„ç«¯å£ä¸Šã€‚è¿™é‡Œä½¿ç”¨å®ƒå°†æˆ‘ä»¬å‘ç»™å®ƒçš„è¯·æ±‚è½¬å‘ç»™ SSR æœåŠ¡å™¨ã€‚ä»¥ Ubuntu ä¸ºä¾‹ï¼š\nsudo apt-get install haproxy å®‰è£…æˆåŠŸåï¼Œç¼–è¾‘é…ç½®æ–‡ä»¶ /etc/haproxy/haproxy.cfg ï¼Œç”¨å¦‚ä¸‹å†…å®¹æ›¿æ¢ ï¼š\nglobal ulimit-n 51200 defaults log global mode tcp option dontlognull timeout connect 5000 timeout client 50000 timeout server 50000 frontend ss-in bind *:relay_server_port default_backend ss-out backend ss-out server server1 proxy_server_ip:proxy_server_port maxconn 20480 relay_server_port æ˜¯ç”¨äºæœ¬åœ°ä¸ä¸­ç»§æœåŠ¡å™¨Bçš„è¿æ¥çš„ç«¯å£ã€‚proxy_server_ip æ˜¯ SSR ä»£ç†æœåŠ¡å™¨çš„ IP åœ°å€ï¼Œproxy_server_port æ˜¯ SSR ä»£ç†æœåŠ¡å™¨çš„ç›‘å¬ç«¯å£ã€‚\nç„¶åå°†æœ¬åœ°å®¢æˆ·ç«¯ä¸Šé…ç½®çš„æœåŠ¡å™¨ IP å’Œç«¯å£æ”¹æˆä¸­ç»§æœåŠ¡å™¨çš„ IP å’Œç«¯å£å³å¯ã€‚\n6. å‚è€ƒ #åˆ©ç”¨Haproxyè¿›è¡ŒSSä»£ç†ä¸­ç»§\n","date":"2017 October 17","permalink":"/posts/2017/10/17/","section":"Posts","summary":"1. è´­ä¹° VPS #æ¨è https://www.","title":"ç”¨ VPS è‡ªå»ºç§‘å­¦ä¸Šç½‘"},{"content":"1. è‡ªåŠ¨å¡«å…… #æœ‰æ—¶æˆ‘ä»¬éœ€è¦å°†ä¸€ä¸ªå•å…ƒæ ¼çš„å†…å®¹å¤åˆ¶åˆ°æ•´è¡Œï¼Œæˆ–è€…æ•´åˆ—ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€‰ä¸­å•å…ƒæ ¼ï¼Œç„¶åæ‹–åŠ¨è¾¹æ¡†çš„é»„ç‚¹å³å¯ï¼š\nå¦‚æœæƒ³è¦å¡«å……çš„å­—æ¯æˆ–è€…æ•°å­—è‡ªåŠ¨é€’å¢ï¼Œéœ€è¦å…ˆå°†å•å…ƒæ ¼çš„æ•°æ®æ ¼å¼æ¢æˆæ–‡æœ¬ï¼Œç„¶åå†æ‹–åŠ¨é»„ç‚¹ï¼š\n2. æ‹·è´æ ·å¼ #Numbers ä¹Ÿæœ‰ç±»ä¼¼å¾®è½¯ Office çš„æ ¼å¼åˆ·åŠŸèƒ½ï¼Œå«åšæ‹·è´/ç²˜è´´æ ·å¼ã€‚è¿™ä¸ªä¸¤ä¸ªåŠŸèƒ½å¯ä»¥åœ¨â€œæ ¼å¼â€èœå•æ ä¸­æ‰¾åˆ°ï¼Œå¯ä»¥å°†å®ƒä»¬æ·»åŠ åˆ°è‡ªå®šä¹‰å·¥å…·æ ä¸­ï¼Œæ–¹ä¾¿ä½¿ç”¨ï¼š\nç„¶åé€‰ä¸­ä¸€ä¸ªå•å…ƒæ ¼ï¼Œæ‹·è´/ç²˜è´´æ ·å¼å³å¯ï¼š\n3. å‡æ³• #Numbers çš„å…¬å¼å¯ä»¥ç”¨å‡å·ç›´æ¥å®ç°å‡æ³•ï¼Œå¦‚ä¸‹å®ç°äº†ä¸¤ä¸ªæ—¶é—´ç›¸å‡ï¼Œè®¡ç®—å‡ºæŒç»­æ—¶é—´ï¼š\n","date":"2017 September 23","permalink":"/posts/2017/09/23/","section":"Posts","summary":"1. è‡ªåŠ¨å¡«å…… #æœ‰æ—¶æˆ‘ä»¬éœ€è¦å°†ä¸€ä¸ªå•å…ƒæ ¼çš„å†…å®¹å¤åˆ¶åˆ°æ•´è¡Œï¼Œæˆ–è€…æ•´åˆ—ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€‰ä¸­å•å…ƒæ ¼ï¼Œç„¶åæ‹–åŠ¨è¾¹æ¡†çš„é»„ç‚¹å³å¯ï¼š","title":"Numbers ä½¿ç”¨æŠ€å·§"},{"content":"iperf æ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯/æœåŠ¡å™¨ç«¯å·¥ä½œæ¨¡å¼çš„ç½‘ç»œæ€§èƒ½æµ‹è¯•å·¥å…·ï¼Œç”¨äºæµ‹è¯• TCP æˆ–è€… UDP çš„ååé‡ï¼Œè®°å½•å»¶è¿Ÿã€ä¸¢åŒ…ç‡ã€MTUç­‰ä¿¡æ¯ã€‚\n1. è¯­æ³• #ç¼ºçœçŠ¶æ€ä¸‹ï¼Œiperf ä½¿ç”¨ TCP ä¼ è¾“åè®®ï¼ŒæœåŠ¡å™¨ç«¯çš„è¯­æ³•ï¼š\niperf -s -p [port] [ options ] åŠ  -D å‚æ•°å¯ä»¥åå°è¿è¡Œã€‚\nå®¢æˆ·ç«¯çš„è¯­æ³•ï¼š\niperf -c [server ip] -p [port] [options] å¸¸ç”¨çš„å‚æ•°æœ‰ï¼š\n-f [kmKM] ï¼Œåˆ†åˆ«ä»¥ Kbits ï¼Œ Mbits ï¼Œ KBytes ï¼Œ MBytes æ ¼å¼æ˜¾ç¤ºæŠ¥å‘Šï¼Œé»˜è®¤æ˜¯ Mbits ã€‚ -l ï¼Œè¯»å†™ç¼“å­˜åŒºçš„å¤§å°ï¼Œé»˜è®¤æ˜¯ 8KB ã€‚ -w ï¼Œè®¾ç½® TCP çš„çª—å£å¤§å°ã€‚ -t ï¼Œè®¾ç½®æµ‹è¯•æ—¶é—´ï¼Œé»˜è®¤æ˜¯ 10 ç§’ã€‚ -i ï¼Œæ‰“å°æŠ¥å‘Šçš„æ—¶é—´é—´éš”ï¼Œå•ä½æ˜¯ç§’ã€‚ -o ï¼Œè¾“å‡ºæ‰“å°ä¿¡æ¯åˆ°é—®é¢˜ã€‚ -u ï¼Œè®¾ç½®ä¸º UDP åè®®ï¼Œä¸¤ç«¯éƒ½è¦åŠ ã€‚ -b n[KM] ï¼Œè®¾ç½®ä½¿ç”¨ UDP åè®®æ—¶çš„å¸¦å®½ n bits/sec ï¼Œé»˜è®¤æ˜¯ 1Mbit/sec ã€‚ 2. æµ‹è¯• TCP çš„å¸¦å®½ #åŸç†æ¯”è¾ƒç®€å•ï¼Œåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å»ºç«‹ä¸‰æ¬¡æ¡æ‰‹è¿æ¥åï¼Œå®¢æˆ·ç«¯å¸¦å®½çš„å¤§å°ç­‰äºå‘é€çš„æ€»æ•°æ®é™¤ä»¥å‘é€çš„æ€»æ—¶é—´ã€‚å¯¹æœåŠ¡ç«¯æµ‹å¾—çš„å¸¦å®½ï¼Œåˆ™æ˜¯æ¥æ”¶çš„æ€»æ•°æ®é™¤ä»¥æ‰€èŠ±æ—¶é—´ã€‚æœåŠ¡å™¨ç«¯ï¼š\n$ iperf -s -p 8000 ------------------------------------------------------------ Server listening on TCP port 8000 TCP window size: 85.3 KByte (default) ------------------------------------------------------------ [ 4] local 10.104.231.137 port 8000 connected with 14.197.98.229 port 65237 [ ID] Interval Transfer Bandwidth [ 4] 0.0-10.0 sec 36.8 MBytes 30.7 Mbits/sec å®¢æˆ·ç«¯ï¼š\n$ iperf -c 118.89.16.224 -p 8000 -i 2 -t 10 ------------------------------------------------------------ Client connecting to 118.89.16.224, TCP port 8000 TCP window size: 128 KByte (default) ------------------------------------------------------------ [ 5] local 192.168.1.104 port 65237 connected with 118.89.16.224 port 8000 [ ID] Interval Transfer Bandwidth [ 5] 0.0- 2.0 sec 9.25 MBytes 38.8 Mbits/sec [ 5] 2.0- 4.0 sec 5.75 MBytes 24.1 Mbits/sec [ 5] 4.0- 6.0 sec 6.50 MBytes 27.3 Mbits/sec [ 5] 6.0- 8.0 sec 8.38 MBytes 35.1 Mbits/sec [ 5] 8.0-10.0 sec 6.75 MBytes 28.3 Mbits/sec [ 5] 0.0-10.0 sec 36.8 MBytes 30.8 Mbits/sec 3. æµ‹è¯• UDP çš„æ€§èƒ½ #å®¢æˆ·ç«¯å¯ä»¥ç”¨ -u è®¾ç½® UDP æ•°æ®æµçš„é€Ÿç‡ã€‚å®¢æˆ·ç«¯å‘é€æ•°æ®æ—¶ï¼Œå°†æ ¹æ®å®¢æˆ·ç«¯æä¾›çš„é€Ÿç‡è®¡ç®—æ•°æ®æŠ¥å‘é€ä¹‹é—´çš„æ—¶å»¶ã€‚\nå®¢æˆ·ç«¯è¿˜å¯ä»¥æŒ‡å®šå‘é€æ•°æ®æŠ¥çš„å¤§å°ã€‚æ¯ä¸ªå‘é€çš„æ•°æ®æŠ¥åŒ…å«ä¸€ä¸ª ID å·ï¼Œç”¨æ¥å”¯ä¸€æ ‡è¯†æŠ¥æ–‡ï¼ŒæœåŠ¡å™¨ç«¯æ ¹æ®è¯¥ ID å·æ¥ç¡®å®šæ•°æ®æŠ¥ä¸¢å¤±å’Œä¹±åºã€‚\nå½“æŠŠ UDP æŠ¥æ–‡å¤§å°è®¾ç½®å¯ä»¥å°†æ•´ä¸ªæŠ¥æ–‡æ”¾å…¥ IP å±‚çš„åŒ…å†…æ—¶ï¼Œé‚£ä¹ˆ UDP æ‰€æµ‹å¾—çš„æŠ¥æ–‡ä¸¢å¤±æ•°æ®å³ä¸º IP å±‚åŒ…çš„ä¸¢å¤±æ•°æ®ï¼Œè¿™æä¾›äº†ä¸€ä¸ªæœ‰æ•ˆçš„æµ‹è¯•åŒ…ä¸¢å¤±æƒ…å†µçš„æ–¹æ³•ã€‚\næ•°æ®æŠ¥ä¼ è¾“å»¶è¿ŸæŠ–åŠ¨ (Jitter)çš„æµ‹è¯•ç”±æœåŠ¡å™¨ç«¯å®Œæˆï¼Œå®¢æˆ·å‘é€çš„æŠ¥æ–‡æ•°æ®åŒ…å«æœ‰å‘é€æ—¶é—´æˆ³ï¼ŒæœåŠ¡å™¨ç«¯æ ¹æ®è¯¥æ—¶é—´ä¿¡æ¯å’Œæ¥æ”¶åˆ°æŠ¥æ–‡çš„æ—¶é—´æˆ³æ¥è®¡ç®—ä¼ è¾“å»¶è¿ŸæŠ–åŠ¨ã€‚ä¼ è¾“å»¶è¿ŸæŠ–åŠ¨åæ˜ ä¼ è¾“è¿‡ç¨‹ä¸­æ˜¯å¦å¹³æ»‘ã€‚ç”±äºå®ƒæ˜¯ä¸€ä¸ªç›¸å¯¹å€¼ï¼Œæ‰€ä»¥å¹¶ä¸éœ€è¦å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯æ—¶é—´åŒæ­¥ã€‚\næœåŠ¡å™¨ç«¯ï¼š\n$ iperf -u -s -p 1080 ------------------------------------------------------------ Server listening on UDP port 1080 Receiving 1470 byte datagrams UDP buffer size: 208 KByte (default) ------------------------------------------------------------ [ 3] local 10.104.231.137 port 1080 connected with 14.197.98.229 port 58756 [ ID] Interval Transfer Bandwidth Jitter Lost/Total Datagrams [ 3] 0.0-20.0 sec 2.50 MBytes 1.05 Mbits/sec 1.030 ms 0/ 1784 (0%) [ 3] 0.0-20.0 sec 1 datagrams received out-of-order å®¢æˆ·ç«¯ï¼š\n$ iperf -u -c 118.89.16.224 -p 1080 -i 5 -t 20 ------------------------------------------------------------ Client connecting to 118.89.16.224, UDP port 1080 Sending 1470 byte datagrams UDP buffer size: 9.00 KByte (default) ------------------------------------------------------------ [ 5] local 192.168.1.104 port 58756 connected with 118.89.16.224 port 1080 [ ID] Interval Transfer Bandwidth [ 5] 0.0- 5.0 sec 640 KBytes 1.05 Mbits/sec [ 5] 5.0-10.0 sec 640 KBytes 1.05 Mbits/sec [ 5] 10.0-15.0 sec 640 KBytes 1.05 Mbits/sec [ 5] 15.0-20.0 sec 640 KBytes 1.05 Mbits/sec [ 5] 0.0-20.0 sec 2.50 MBytes 1.05 Mbits/sec [ 5] Sent 1785 datagrams [ 5] Server Report: [ 5] 0.0-20.0 sec 2.50 MBytes 1.05 Mbits/sec 1.030 ms 0/ 1784 (0%) [ 5] 0.0-20.0 sec 1 datagrams received out-of-order ","date":"2017 August 1","permalink":"/posts/2017/08/01/","section":"Posts","summary":"iperf æ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯/æœåŠ¡å™¨ç«¯å·¥ä½œæ¨¡å¼çš„ç½‘ç»œæ€§èƒ½æµ‹è¯•å·¥å…·ï¼Œç”¨äºæµ‹è¯• TCP æˆ–è€… UDP çš„ååé‡ï¼Œè®°å½•å»¶è¿Ÿã€ä¸¢åŒ…ç‡ã€MTUç­‰ä¿¡æ¯ã€‚","title":"ç”¨ iperf æµ‹è¯•ç½‘ç»œæ€§èƒ½"},{"content":"netcat æ˜¯ä¸€ä¸ªä»»æ„ TCP å’Œ UDP è¿æ¥å’Œç›‘å¬çš„å·¥å…·ï¼Œæœ‰æ—¶åˆ«åä¹Ÿå« nc ã€‚å¯ä»¥ç”¨äºå„ç§ TCP æˆ– UDP ç›¸å…³çš„ä»»åŠ¡ï¼ŒåŒ…æ‹¬æ‰“å¼€ TCP è¿æ¥ï¼Œå‘é€ UDP æ•°æ®åŒ…ï¼Œç›‘å¬ä»»æ„ TCP å’Œ UDP ç«¯å£ï¼ŒåŒæ—¶æ”¯æŒ IPv4 å’Œ IPv6 ã€‚\n1. è¯­æ³• #netcat [option] ip port å¸¸ç”¨å‚æ•°ï¼š\n-e ï¼Œå»ºç«‹é“¾æ¥åæ‰§è¡Œå¤–éƒ¨ç¨‹åºã€‚ -l ï¼Œä½¿ netcat å¤„äºç›‘å¬çŠ¶æ€ã€‚ -u ï¼Œä½¿ç”¨ UDP ï¼Œç¼ºçœçŠ¶æ€ä¸‹æ˜¯ TCP åè®®ã€‚ -v ï¼Œè¾“å‡ºè¯¦ç»†ä¿¡æ¯ã€‚ -z ï¼Œæ‰§è¡Œç«¯å£æ‰«æã€‚å¯¹äº TCP ç«¯å£ï¼ˆç¼ºçœï¼‰ï¼Œå°è¯•åœ¨ä¸å‘é€æ•°æ®çš„æƒ…å†µä¸‹æ‰§è¡Œè¿æ¥æ‰«æï¼ˆå®Œæ•´ä¸‰è·¯ä¿¡å·æ¡æ‰‹ï¼‰ã€‚å¯¹äº UDP (â€“u)ï¼Œç¼ºçœæƒ…å†µä¸‹ä¼šå‘é€ç©º UDP åŒ…ã€‚ 2. ç«¯å£æ‰«æ #ç”¨äºæ‰«æè¿œç¨‹ä¸»æœºçš„æŸä¸ªç«¯å£æ˜¯å¦å¤„äºç›‘å¬çŠ¶æ€ï¼Œå‡è®¾ä¸€å°æœåŠ¡å™¨çš„ç«¯å£æƒ…å†µï¼š\n$ netstat -nlp (Not all processes could be identified, non-owned process info will not be shown, you would have to be root to see it all.) Active Internet connections (only servers) Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name tcp 0 0 0.0.0.0:8883 0.0.0.0:* LISTEN 19908/mosquitto tcp 0 0 0.0.0.0:8884 0.0.0.0:* LISTEN 19908/mosquitto tcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN - tcp6 0 0 :::8883 :::* LISTEN 19908/mosquitto tcp6 0 0 :::22 :::* LISTEN - å¯è§ TCP çš„ 22 ã€8883 å’Œ 8884 ç«¯å£å¤„äºç›‘å¬çŠ¶æ€ï¼Œåœ¨æœ¬åœ° PC ä¸Šæµ‹è¯• 22 ç«¯å£çš„è¿é€šæ€§ï¼š\n$ nc -zv 118.89.16.224 22 Connection to 118.89.16.224 port 22 [tcp/ssh] succeeded! è¿æ¥å¤±è´¥çš„æƒ…å†µï¼Œè¯´æ˜ç«¯å£æ²¡æœ‰è¢«ç›‘å¬ï¼š\n$ nc -zv 118.89.16.224 80 nc: connectx to 118.89.16.224 port 80 (tcp) failed: Connection refused å¦‚æœè¦æ‰«æ UDP ç«¯å£ï¼ŒåŠ ä¸Š -u å‚æ•°ï¼š\n$ nc -uvz 118.89.16.224 1080 Connection to 118.89.16.224 port 1080 [udp/*] succeeded! 3. åŒå‘é€šè®¯ #åœ¨ä¸€å°ä¸»æœºä¸Šå¼€å¯ç›‘å¬ï¼š\n$ netcat -l 8000 åœ¨å¦ä¸€å°ä¸»æœºä¸Šè¿æ¥\n$ nc 118.89.16.224 8000 ä¹‹ååœ¨ä¸€å°ä¸»æœºä¸Šè¾“å…¥çš„ä¿¡æ¯ï¼Œå°±ä¼šåœ¨å¦ä¸€å°ä¸»æœºä¸Šæ˜¾ç¤ºã€‚\nä½¿ç”¨ UDP çš„ä¾‹å­ï¼š\n$ netcat -lu 1080 $ nc -u 118.89.16.224 1080 ","date":"2017 July 31","permalink":"/posts/2017/07/31/","section":"Posts","summary":"netcat æ˜¯ä¸€ä¸ªä»»æ„ TCP å’Œ UDP è¿æ¥å’Œç›‘å¬çš„å·¥å…·ï¼Œæœ‰æ—¶åˆ«åä¹Ÿå« nc ã€‚å¯ä»¥ç”¨äºå„ç§ TCP æˆ– UDP ç›¸å…³çš„ä»»åŠ¡ï¼ŒåŒ…æ‹¬æ‰“å¼€ TCP è¿æ¥ï¼Œå‘é€ UDP æ•°æ®åŒ…ï¼Œç›‘å¬ä»»æ„ TCP å’Œ UDP ç«¯å£ï¼ŒåŒæ—¶æ”¯æŒ IPv4 å’Œ IPv6 ã€‚","title":"netcat åŸºæœ¬ç”¨æ³•"},{"content":" ç”¨ LeetCode ç»ƒä¹  Python ï¼Œéš¾åº¦éƒ½æ˜¯é€‰æ‹© Easy ã€‚\n1. Two Sum #Given an array of integers, return indices of the two numbers such that they add up to a specific target.\nYou may assume that each input would have exactly one solution, and you may not use the same element twice.\nExample:\nGiven nums = [2, 7, 11, 15], target = 9, Because nums[0] + nums[1] = 2 + 7 = 9, return [0, 1]. Answerï¼š\nclass Solution(object): def twoSum(self, nums, target): \u0026quot;\u0026quot;\u0026quot; :type nums: List[int] :type target: int :rtype: List[int] \u0026quot;\u0026quot;\u0026quot; for i in range(len(nums)): for j in range(i+1,len(nums)): if nums[i]+nums[j]==target: return [i,j] 2. Reverse Integer #Reverse digits of an integer.\nExample1: x = 123, return 321 Example2: x = -123, return -321\nNote:The input is assumed to be a 32-bit signed integer. Your function should return 0 when the reversed integer overflows.\nAnswer:\nclass Solution(object): def reverse(self, x): \u0026quot;\u0026quot;\u0026quot; :type x: int :rtype: int \u0026quot;\u0026quot;\u0026quot; temp=abs(x) res=0 while temp\u0026gt;0: res=res*10+temp%10 temp=temp//10 if x\u0026lt;0: res=-res if res\u0026gt;2147483647 or res\u0026lt;-2147483648 : res=0 return res 3. Palindrome Number #Determine whether an integer is a palindrome. Do this without extra space.\nåˆ¤æ–­ä¸€ä¸ªæ•´æ•°æ˜¯å¦æ˜¯å›æ–‡æ•°ï¼Œå°½å¯èƒ½çš„å°‘ç”¨é¢å¤–çš„å†…å­˜ç©ºé—´ã€‚ä¸€ä¸ªæ€è·¯æ˜¯å°†æ•°å­—æŠ˜åŠï¼Œå¯¹æ¯”ä¸¤åŠæ˜¯å¦ç›¸ç­‰ã€‚\nAnswer:\nclass Solution(object): def isPalindrome(self, x): \u0026quot;\u0026quot;\u0026quot; :type x: int :rtype: bool \u0026quot;\u0026quot;\u0026quot; if x\u0026lt;0 : return False if x//10==0 : return True if x%10==0 : return False s=0 while x\u0026gt;s : s=s*10+x%10 x=x//10 if x==s or x==s//10 : return True else : return False è¿˜æœ‰ä¸€ç§æ–¹æ³•æ˜¯è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œç„¶åä»å¤´å°¾å¼€å§‹å¯¹æ¯”å­—ç¬¦:\nclass Solution(object): def isPalindrome(self, x): \u0026quot;\u0026quot;\u0026quot; :type x: int :rtype: bool \u0026quot;\u0026quot;\u0026quot; x=str(x) l=len(x) for i in range(l): if x[i] != x[-1-i]: return False return True è¿˜å¯ä»¥åœ¨æ•°ç»„ä¸­åˆ©ç”¨ Python çš„å†’å·è¯­æ³•ï¼Œå°†æ•°å­—å‰åé¢ å€’ï¼Œç„¶ååˆ¤æ–­æ˜¯å¦ç›¸åŒï¼š\nclass Solution(object): def isPalindrome(self, x): \u0026quot;\u0026quot;\u0026quot; :type x: int :rtype: bool \u0026quot;\u0026quot;\u0026quot; x = str(x) if x == x[::-1]: return True else: return False 4. Roman to Integer #Given a roman numeral, convert it to an integer.\nInput is guaranteed to be within the range from 1 to 3999.\nAnswer:\nclass Solution(object): def romanToInt(self, s): \u0026quot;\u0026quot;\u0026quot; :type s: str :rtype: int \u0026quot;\u0026quot;\u0026quot; rtoi={'I':1,'V':5,'X':10,'L':50,'C':100,'D':500,'M':1000} buf=0 for i in range(len(s)-1): if rtoi[s[i]] \u0026lt; rtoi[s[i+1]]: buf=buf-rtoi[s[i]] else: buf=buf+rtoi[s[i]] buf=buf+rtoi[s[-1]] return buf 5. Longest Common Prefix #Write a function to find the longest common prefix string amongst an array of strings.\næ‰¾å‡ºå­—ç¬¦ä¸²æ•°ç»„ä¸­çš„æœ€é•¿å…¬å…±å‰ç¼€ï¼Œæ¯”å¦‚ array=[\u0026lsquo;abc\u0026rsquo;,\u0026lsquo;abcd\u0026rsquo;,\u0026lsquo;abe\u0026rsquo;]ï¼Œæœ€é•¿å…¬å…±å‰ç¼€å°±æ˜¯ \u0026lsquo;ab\u0026rsquo; ã€‚è¿™é“é¢˜çš„æ€è·¯æ˜¯å…ˆæ‰¾å‡ºæ•°ç»„ä¸­æœ€çŸ­çš„å­—ç¬¦ä¸²ï¼Œé•¿åº¦ä¸º max ï¼Œæœ€é•¿å…¬å…±å‰ç¼€ä¸å¯èƒ½è¶…è¿‡ max ï¼Œç„¶åéå† max æ¬¡å­—ç¬¦ä¸²æ•°ç»„ï¼Œä¾æ¬¡å¯¹æ¯”å‰ max ä¸ªå­—ç¬¦ã€‚\nAnswer:\nclass Solution(object): def longestCommonPrefix(self, strs): \u0026quot;\u0026quot;\u0026quot; :type strs: List[str] :rtype: str \u0026quot;\u0026quot;\u0026quot; res='' strs_len=len(strs) if strs_len\u0026lt;1: return res if strs_len==1: return strs[0] max=len(strs[0]) for i in range(strs_len): if len(strs[i])\u0026lt;max: max=len(strs[i]) if max\u0026lt;1: return res flag=0 for i in range(max): for j in range(1,strs_len): print i,j print strs[j][i] if strs[0][i]!=strs[j][i]: flag=1 break if flag==0: res+=strs[0][i] else: break return res 6. Valid Parentheses #Given a string containing just the characters \u0026lsquo;(\u0026rsquo;, \u0026lsquo;)\u0026rsquo;, \u0026lsquo;{\u0026rsquo;, \u0026lsquo;}\u0026rsquo;, \u0026lsquo;[\u0026rsquo; and \u0026lsquo;]\u0026rsquo;, determine if the input string is valid.\nThe brackets must close in the correct order, \u0026ldquo;()\u0026rdquo; and \u0026ldquo;()[]{}\u0026rdquo; are all valid but \u0026ldquo;(]\u0026rdquo; and \u0026ldquo;([)]\u0026rdquo; are not.\néªŒè¯æ‹¬å·æ˜¯å¦å®Œå…¨åŒ¹é…ã€‚æ€è·¯æ˜¯éå†æ•´ä¸ªå­—ç¬¦ä¸²ï¼Œé‡åˆ°å·¦æ‹¬å·å°±å‹æ ˆï¼Œé‡åˆ°å³æ‹¬å·å°±ä¸æ ˆå†…æ‹¬å·å¯¹æ¯”ï¼Œç©ºæ ˆæˆ–è€…ä¸åŒ¹é…å°±è¯´æ˜è¿™ä¸ªå­—ç¬¦ä¸²æ— æ•ˆã€‚\nAnswer:\nclass Solution(object): def isValid(self, s): \u0026quot;\u0026quot;\u0026quot; :type s: str :rtype: bool \u0026quot;\u0026quot;\u0026quot; if len(s)\u0026lt;2 or len(s)%2!=0 : return False a=[['{','[','('],['}',']',')']] b={'}':'{',']':'[',')':'('} t=[] for i in range(len(s)): if s[i] in a[0] : t.append(s[i]) else: if len(t)==0 : return False l=t.pop() if l!=b[s[i]] : return False if len(t)==0 : return True else : return False 7. Remove Duplicates from Sorted Array #Given a sorted array, remove the duplicates in place such that each element appear only once and return the new length.\nDo not allocate extra space for another array, you must do this in place with constant memory.\nFor example, Given input array nums = [1,1,2],\nYour function should return length = 2, with the first two elements of nums being 1 and 2 respectively. It doesn\u0026rsquo;t matter what you leave beyond the new length.\nAnswer:\nclass Solution(object): def removeDuplicates(self, nums): \u0026quot;\u0026quot;\u0026quot; :type nums: List[int] :rtype: int \u0026quot;\u0026quot;\u0026quot; i=0 while True : if i\u0026lt;len(nums)-1 : if nums[i]==nums[i+1] : nums.pop(i+1) else : i+=1 else : break return len(nums) 8. Remove Element #Given an array and a value, remove all instances of that value in place and return the new length.\nDo not allocate extra space for another array, you must do this in place with constant memory.\nThe order of elements can be changed. It doesn\u0026rsquo;t matter what you leave beyond the new length.\nExample:\nGiven input array nums = [3,2,2,3], val = 3\nYour function should return length = 2, with the first two elements of nums being 2.\nAnswer:\nclass Solution(object): def removeElement(self, nums, val): \u0026quot;\u0026quot;\u0026quot; :type nums: List[int] :type val: int :rtype: int \u0026quot;\u0026quot;\u0026quot; i=0 while i\u0026lt;len(nums): if nums[i]==val : nums.pop(i) else: i+=1 return len(nums) 9. Implement strStr() #Returns the index of the first occurrence of needle in haystack, or -1 if needle is not part of haystack.\nAnswer:\nclass Solution(object): def strStr(self, haystack, needle): \u0026quot;\u0026quot;\u0026quot; :type haystack: str :type needle: str :rtype: int \u0026quot;\u0026quot;\u0026quot; needle_len=len(needle) haystack_len=len(haystack) if needle_len==0 : return 0 i=0 while i+needle_len\u0026lt;=haystack_len : if needle==haystack[i:i+needle_len] : return i else : i+=1 return -1 å…¶å® Python ä¸ºå­—ç¬¦ä¸²æä¾›äº†ä¸€ä¸ª find() æ–¹æ³•:\nstring.find(str,beg=0,end=len(string)) ç”¨äºæŸ¥æ‰¾å­—ç¬¦ä¸² string å†…æ˜¯å¦åŒ…å«å¦ä¸€ä¸ªå­—ç¬¦ä¸² str ï¼Œå¦‚æœæ˜¯è¿”å›å¼€å§‹çš„ç´¢å¼•å€¼ï¼Œå¦åˆ™è¿”å› -1 ã€‚\n10. Search Insert Position #Given a sorted array and a target value, return the index if the target is found. If not, return the index where it would be if it were inserted in order.\nYou may assume no duplicates in the array.\nHere are few examples.\n[1,3,5,6], 5 â†’ 2 [1,3,5,6], 2 â†’ 1 [1,3,5,6], 7 â†’ 4 [1,3,5,6], 0 â†’ 0 Answer:\nclass Solution(object): def searchInsert(self, nums, target): \u0026quot;\u0026quot;\u0026quot; :type nums: List[int] :type target: int :rtype: int \u0026quot;\u0026quot;\u0026quot; for i in range(len(nums)) : if target\u0026lt;=nums[i] : return i return len(nums) 11. Count and Say #The count-and-say sequence is the sequence of integers with the first five terms as following:\n1. 1 2. 11 3. 21 4. 1211 5. 111221 1 is read off as one 1 or 11.\n11 is read off as two 1s or 21.\n21 is read off as one 2, then one 1 or 1211.\nGiven an integer n, generate the nth term of the count-and-say sequence.\nNote: Each term of the sequence of integers will be represented as a string.\nExample 1:\nInput: 1 Output: \u0026quot;1\u0026quot; Example 2:\nInput: 4 Output: \u0026quot;1211\u0026quot; Answer:\nclass Solution(object): def countAndSay(self, n): \u0026quot;\u0026quot;\u0026quot; :type n: int :rtype: str \u0026quot;\u0026quot;\u0026quot; s='1' for i in range(n-1) : pre=s[0] t='' count=0 for a in s : if pre==a : count+=1 else : t+=str(count) t+=pre count=1 pre=a t+=str(count) t+=pre s=t return s ","date":"2017 June 26","permalink":"/posts/2017/06/26/","section":"Posts","summary":"ç”¨ LeetCode ç»ƒä¹  Python ï¼Œéš¾åº¦éƒ½æ˜¯é€‰æ‹© Easy ã€‚","title":"LeetCode åˆ·é¢˜"},{"content":"list æ˜¯ä¸€ç§æœ‰åºçš„æ•°æ®é›†åˆï¼Œç´¢å¼•ä» 0 å¼€å§‹ï¼Œç±»ä¼¼ C è¯­è¨€ä¸­çš„æ•°ç»„ã€‚æ¯”å¦‚å®šä¹‰ä¸€ä¸ª list ï¼š\n\u0026gt;\u0026gt;\u0026gt; array=[2,3,4] \u0026gt;\u0026gt;\u0026gt; print array [2, 3, 4] \u0026gt;\u0026gt;\u0026gt; print array[0] 2 1. åŸºæœ¬æ“ä½œ #è·å– list å…ƒç´ çš„ä¸ªæ•°å¯ä»¥ç”¨ len() å‡½æ•°ï¼š\n\u0026gt;\u0026gt;\u0026gt; len(array) 3 æ‰€ä»¥ï¼Œæœ€åä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•æ˜¯ len()-1 ï¼Œè¿˜å¯ä»¥ç”¨ -1 åšç´¢å¼•ï¼Œç›´æ¥è·å–æœ€åä¸€ä¸ªå…ƒç´ ï¼Œä»¥æ­¤ç±»æ¨ï¼Œå¯ä»¥è·å–å€’æ•°ç¬¬äºŒä¸ªï¼Œå€’æ•°ç¬¬ä¸‰ä¸ªå…ƒç´ ï¼š\n\u0026gt;\u0026gt;\u0026gt; array[-1] 4 \u0026gt;\u0026gt;\u0026gt; array[-2] 3 è¿½åŠ ä¸€ä¸ªå…ƒç´ :\n\u0026gt;\u0026gt;\u0026gt; array.append(5) \u0026gt;\u0026gt;\u0026gt; array [2, 3, 4, 5] åœ¨æŒ‡å®šä½ç½®æ’å…¥ä¸€ä¸ªå…ƒç´ ï¼š\n\u0026gt;\u0026gt;\u0026gt; array.insert(1,9) \u0026gt;\u0026gt;\u0026gt; array [2, 9, 3, 4, 5] åˆ é™¤æŸä¸ªå…ƒç´ å¯ä»¥ç”¨ pop() å‡½æ•°ï¼Œå‚æ•°æ˜¯å…ƒç´ çš„ç´¢å¼•ï¼Œä¸å¸¦å‚æ•°çš„è¯ï¼Œé»˜è®¤åˆ é™¤æœ«å°¾çš„å…ƒç´ ï¼Œè¿”å›å€¼æ˜¯åˆ é™¤çš„å…ƒç´ çš„å†…å®¹ï¼š\n\u0026gt;\u0026gt;\u0026gt; array.pop() 5 \u0026gt;\u0026gt;\u0026gt; array [2, 9, 3, 4] \u0026gt;\u0026gt;\u0026gt; array.pop(1) 9 \u0026gt;\u0026gt;\u0026gt; array [2, 3, 4] è·å–æŸä¸ªå…ƒç´ çš„ä¸‹è¡¨,å¦‚æœæœ‰é‡å¤çš„å…ƒç´ ï¼Œåªè¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ çš„ä¸‹æ ‡ï¼š\n\u0026gt;\u0026gt;\u0026gt; a=[1,2,3,4,2] \u0026gt;\u0026gt;\u0026gt; a.index(1) 0 \u0026gt;\u0026gt;\u0026gt; a.index(2) 1 2. éå† #Pytion æä¾›äº†ä¸€ä¸ªå†…ç½®å‡½æ•° enumerate() ï¼Œå¯ç”¨äºéå†æ•°æ®ï¼š\nenumerate(iterable[, start]) ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ª list ï¼Œç¬¬äºŒä¸ªå¯é€‰å‚æ•°å…è®¸æˆ‘ä»¬è‡ªå®šä¹‰ä¸€ä¸ªè®¡æ•°å™¨ï¼Œä¾‹å¦‚ list ï¼š\n\u0026gt;\u0026gt;\u0026gt; array=['a','b','c','d'] \u0026gt;\u0026gt;\u0026gt; for c,v in enumerate(array): ... print c,v ... 0 a 1 b 2 c 3 d \u0026gt;\u0026gt;\u0026gt; for c,v in enumerate(array,1): ... print c,v ... 1 a 2 b 3 c 4 d å¦‚æœè¦ä»æŒ‡å®šç´¢å¼•å¼€å§‹éå†åˆ°ç»“å°¾ï¼Œå¯ä»¥åˆ©ç”¨ range() å‡½æ•°ï¼š\n\u0026gt;\u0026gt;\u0026gt; array=['a','b','c','d'] \u0026gt;\u0026gt;\u0026gt; for i in range(1,len(array)): ... print i,array[i] ... 1 b 2 c 3 d 3. åˆ‡ç‰‡ #æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬æƒ³è¦ç²¾ç¡®çš„é€‰å– list ä¸­çš„ä¸€éƒ¨åˆ†ï¼ŒPython æä¾›äº†ä¼˜é›…çš„åˆ‡ç‰‡è¯­æ³•ï¼š\nalist[beginğŸ”šstep] begin è¡¨ç¤ºåˆ‡ç‰‡çš„èµ·å§‹ä½ç½®ï¼Œç¼ºçœæ˜¯ list çš„å¼€å§‹ä½ç½® end è¡¨ç¤ºåˆ‡ç‰‡çš„ç»“æŸä½ç½®ï¼Œç¼ºçœæ˜¯ list çš„ç»“æŸä½ç½® step è¡¨ç¤ºæ­¥é•¿ï¼Œç¡®å®æ˜¯æ­£åºçš„ 1 ï¼Œé€†åºç”¨è´Ÿæ•°è¡¨ç¤º ä»¥å­—ç¬¦ä¸² hello ä¸ºä¾‹ï¼Œåˆ‡ç‰‡è¯­æ³•çš„åæ ‡å¦‚ä¸‹ï¼š\n0 1 2 3 4 5 +---+---+---+---+---+ | h | e | l | l | o | +---+---+---+---+---+ -6 -5 -4 -3 -2 -1 å¦‚æœè¦å–ä¸­é—´çš„ el :\n\u0026gt;\u0026gt;\u0026gt; a='hello' \u0026gt;\u0026gt;\u0026gt; a[1:3:1] 'el' \u0026gt;\u0026gt;\u0026gt; a[1:3] 'el' å°†å­—ç¬¦ä¸²é€†åºï¼š\n\u0026gt;\u0026gt;\u0026gt; a[::-1] 'olleh' \u0026gt;\u0026gt;\u0026gt; a[-1:-6:-1] 'olleh' å–å¤´å°¾ä¸¤ä¸ªå­—ç¬¦ï¼š\n\u0026gt;\u0026gt;\u0026gt; a[::4] 'ho' ","date":"2017 June 25","permalink":"/posts/2017/06/25/","section":"Posts","summary":"list æ˜¯ä¸€ç§æœ‰åºçš„æ•°æ®é›†åˆï¼Œç´¢å¼•ä» 0 å¼€å§‹ï¼Œç±»ä¼¼ C è¯­è¨€ä¸­çš„æ•°ç»„ã€‚æ¯”å¦‚å®šä¹‰ä¸€ä¸ª list ï¼š","title":"Python å¯¹ list çš„å¤„ç†"},{"content":"Paho JavaScript Client æ˜¯ä¸€ä¸ªç”¨ JavaScript å†™çš„ï¼ŒåŸºäºæµè§ˆå™¨çš„ MQTT Client åº“ï¼Œç”¨äºä½¿ç”¨ WebSockets åè®®è¿æ¥ MQTT Broker ã€‚\nå®˜ç½‘æ˜¯ http://www.eclipse.org/paho/clients/js/ GitHub æ˜¯ https://github.com/eclipse/paho.mqtt.javascript 1. å®‰è£… #é€šè¿‡ git å…‹éš†åˆ°æœ¬åœ°ï¼š\ngit clone https://github.com/eclipse/paho.mqtt.javascript.git é»˜è®¤å…‹éš†çš„æ˜¯ master åˆ†æ”¯ï¼Œæ˜¯æ­£å¼å‘å¸ƒçš„ç‰ˆæœ¬ï¼Œè¿œç¨‹è¿˜æœ‰ä¸€ä¸ª develop åˆ†æ”¯ï¼Œç”¨äºå¼€å‘æµ‹è¯•ï¼ŒåŒ…å«äº†ä¸€ä¸ªåŸºäº maven æ„å»ºçš„ç®€å•å®¢æˆ·ç«¯ï¼Œå¯ä»¥ç”¨äºå•å…ƒæµ‹è¯•ã€‚é¦–å…ˆè¦æ‰‹åŠ¨æ£€å‡ºï¼š\ngit checkout -b develop remotes/origin/develop ç„¶åå†æ„å»ºæµ‹è¯•ï¼š\n$ mvn $ cd src/tests $ mvn test -Dtest.server=iot.eclipse.com -Dtest.server.port=80 -Dtest.server.path=/ws ","date":"2017 June 13","permalink":"/posts/2017/06/13/","section":"Posts","summary":"Paho JavaScript Client æ˜¯ä¸€ä¸ªç”¨ JavaScript å†™çš„ï¼ŒåŸºäºæµè§ˆå™¨çš„ MQTT Client åº“ï¼Œç”¨äºä½¿ç”¨ WebSockets åè®®è¿æ¥ MQTT Broker ã€‚","title":"Paho JavaScript Client å­¦ä¹ ç¬”è®°"},{"content":"ä»¥ Telit HE910 æ¨¡å—ä¸ºä¾‹ï¼Œåœ¨ Linux ä¸‹çš„ AT å‘½ä»¤ç«¯å£æ˜¯ /dev/ttyACM3 ã€‚å¯ä»¥é€šè¿‡ pyserial åº“ç›´æ¥è¯»å†™ç«¯å£æ¥ä¸æ¨¡å—é€šä¿¡ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æ›´é«˜çº§çš„ python-gsmmodem ã€‚\n1. Pyserial #å¦‚æœè¦ç›´æ¥å‘é€ AT æŒ‡ä»¤ï¼Œéœ€è¦ä¸²å£è¯»å†™åº“ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„æ˜¯ pyserial ï¼ŒPython 2.7 é»˜è®¤æ²¡æœ‰å®‰è£…è¿™ä¸ªåº“ï¼Œéœ€è¦è‡ªè¡Œä¸‹è½½ï¼Œå‚è€ƒ https://pypi.python.org/pypi/pyserial/2.7ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š\n#!/usr/bin/python import serial ser=serial.Serial(port='/dev/ttyACM3', baudrate=115200, bytesize=8, parity='N', stopbits=1, timeout=1, xonxoff=False, rtscts=False, dsrdtr=False) cmd=\u0026quot;AT\\r\u0026quot; ser.write(cmd.encode()) msg=ser.read(64) print(msg) ä¿å­˜åˆ°æ–‡ä»¶ atcommand.py ï¼Œæ‰§è¡Œï¼š\n~# ./atcommand.py AT OK 2. Python-gsmmodem #2.1. ç®€ä»‹ #python-gsmmodem æ˜¯ä¸€ä¸ªç”¨äºæ§åˆ¶ GSM modem çš„ Python åŒ…ï¼ŒåŸºäº pyserial ï¼Œæä¾›äº† API å’Œä¸€äº›å‘½ä»¤è¡Œäº¤äº’å·¥å…·ã€‚åœ¨è¿™é‡Œä¸‹è½½ï¼Œç„¶åå®‰è£…ï¼šhttps://github.com/faucamp/python-gsmmodemã€‚å®ƒçš„æ–‡æ¡£åœ¨æºç çš„ docs ç›®å½•ä¸‹ï¼ŒSphinx æ ¼å¼ï¼Œä½ çš„ç”µè„‘éœ€è¦å®‰è£… Sphinx ï¼Œç„¶ååœ¨ docs ç›®å½•ä¸‹æ‰§è¡Œ make html å‘½ä»¤ï¼Œå°±ä¼šåœ¨ _build ç›®å½•ä¸‹ç”Ÿäº§ html æ ¼å¼çš„æ–‡æ¡£ï¼Œåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€å³å¯ã€‚python-gsmmodem æœ‰å¦‚ä¸‹å‡ ä¸ªç‰¹æ€§ï¼š\næä¾›äº†å‘é€çŸ­ä¿¡ã€æŸ¥è¯¢ä¿¡å·å¼ºåº¦ç­‰åŠŸèƒ½çš„ç®€å•æ–¹æ³•ã€‚ æä¾›äº†å¤„ç† USSD ä¸šåŠ¡å’Œè¯­éŸ³é€šè¯çš„ API ã€‚ é€šè¿‡å›è°ƒå‡½æ•°æ¥ç”µè¯ã€æ”¶çŸ­ä¿¡ã€‚ æ”¯æŒçŸ­ä¿¡çš„ PDU å’Œ Text æ¨¡å¼ã€‚ æ”¯æŒè·Ÿè¸ªçŸ­ä¿¡çŠ¶æ€æŠ¥å‘Šã€‚ åœ¨ Python çš„å¼‚å¸¸å¤„ç†ä¸­å°è£…äº† AT æŒ‡ä»¤çš„é”™è¯¯ä¿¡æ¯ã€‚ ç›´æ¥å‘æ¨¡å—å‘é€ AT æŒ‡ä»¤ï¼Œè¯»å–è¿”å›å€¼ã€‚ æä¾›æµ‹è¯•å¥—ä»¶ã€‚ è¯¥æ¨¡å—æä¾›äº†å‡ ä¸ªå·¥å…·ï¼š\nGSMTerm ï¼šä¸€ä¸ªç®€å•çš„ä¸²å£ç»ˆç«¯ï¼Œç”¨äºä¸ GSM modem é€šä¿¡ï¼Œå†…å»ºæœ‰ AT æŒ‡ä»¤å¸®åŠ©ã€‚å¯åŠ¨åï¼Œè¾“å…¥ help å¯ä»¥è·å–å¸®åŠ©ä¿¡æ¯ï¼Œå¯ä»¥æ‰§è¡Œ AT å‘½ä»¤ï¼Œè¿˜å¯ä»¥åŠ è½½å¤–éƒ¨è„šæœ¬ï¼š\n~# gsmterm.py -b 115200 /dev/ttyACM3 GSMTerm connected to /dev/ttyACM3 at 115200bps. Press CTRL+] or CTRL+D to exit. GSM\u0026gt; help == GSMTerm Help == Command History: Press the up \u0026amp; down arrow keys to move backwards or forwards through your command history. Command Completion: Press the TAB key to provide command completion suggestions. Press the TAB key after a command is fully typed (with or without a \u0026quot;=\u0026quot; character) to quickly see its syntax. Command Documentation: Type a command, followed with two quesetion marks to access its documentation, e.g. \u0026quot;\u0026lt;COMMAND\u0026gt;??\u0026quot;. Alternatively, precede the command with a question mark (\u0026quot;?\u0026lt;COMMAND\u0026gt;\u0026quot;), or type \u0026quot;help \u0026lt;COMMAND\u0026gt;\u0026quot;. List Available Commands: Type \u0026quot;ls [category]\u0026quot; to list the available AT commands known to GSMTerm for the given category (or all commands if no category is specified). Type \u0026quot;lscat\u0026quot; to see a list of categories. Load Script: Type \u0026quot;load \u0026lt;filename\u0026gt;\u0026quot; to load and execute a file containing AT commands, separated by newlines, e.g. \u0026quot;load ./myscript.txt\u0026quot;. To exit GSMTerm, press CTRL+] or CTRL+D. GSM\u0026gt; AT OK GSM\u0026gt; AT+CSQ?? Signal Quality (AT+CSQ) Category: Network Service Description: This command determines the received signal strength indication (\u0026lt;rssi\u0026gt;) and the channel bit error rate (\u0026lt;ber\u0026gt;) with or without a SIM card inserted Values: No parameters. Response Values: \u0026lt;rssi\u0026gt; 0: -113 dBm or less 1: -111 dBm 2 to 30: -109 to -53 dBm 31: -51dBm or greater 99: not known or not detectable \u0026lt;ber\u0026gt; 0...7: as RXQUAL values in the table GSM 05.08 Command Syntax: AT+CSQ sendsms.py ï¼šå‘é€çŸ­ä¿¡çš„å‘½ä»¤è¡Œè„šæœ¬ï¼Œæ‰§è¡Œ `` å¯ä»¥è·å–å¸®åŠ©ä¿¡æ¯ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š\n~# sendsms.py -i /dev/ttyACM3 -b 115200 13824741490 Connecting to GSM modem on /dev/ttyACM3... Checking for network coverage... Please type your message and press enter to send it: \u0026gt; Hello World! Sending SMS message... Message sent. identify-modem.py ï¼šç”¨äºè¿æ¥å’Œè°ƒè¯• GSM modem ã€‚\npython-gsmmodem ä¸»è¦æä¾›äº†å¦‚ä¸‹å‡ ä¸ªç¼–ç¨‹æ¨¡å—ï¼š\nserial_comms ï¼ŒåŸºäº pyserial ï¼Œæä¾›äº†ç”¨äºä½çº§åˆ«ä¸²å£é€šè®¯çš„ç±» SerialComms ã€‚ modem ï¼Œæä¾›äº†å‡ ä¸ªæ“ä½œ GSM modem çš„ç±»ï¼Œä¾‹å¦‚ GsmModem ï¼ŒSentSms ã€‚ exceptions ï¼Œæä¾›äº†ä¸€äº›é¢å¤–çš„æ–¹æ³•ï¼Œæ¯”å¦‚è¶…æ—¶å¤„ç†ï¼Œä¸­æ–­å¤„ç†ï¼Œä¾› GsmModem ä½¿ç”¨ã€‚ pdu ï¼Œæä¾›äº†å¯¹çŸ­ä¿¡è¿›è¡Œ PDU ç¼–ç çš„æ–¹æ³•ã€‚ 2.2. serial_comms #serial_comms çš„ä¸»ç±»æ˜¯ SerialComms ï¼Œä½¿ç”¨å‰å…ˆå¯¼å…¥ï¼š\nfrom serial_comms import GsmModem 2.3. modem #modem æ¨¡å—çš„ä¸»ç±»æ˜¯ GsmModem ç±»ï¼Œå®ƒçš„çˆ¶ç±»æ˜¯ SerialComms ï¼Œæä¾›äº†ä¸ GSM Modem äº¤äº’çš„å¤§éƒ¨åˆ†æ–¹æ³•ã€‚ä½¿ç”¨å‰è¦å…ˆä» modme æ¨¡å—å¯¼å…¥ï¼š\nfrom gsmmodem.modem import GsmModem GsmModem ç±»çš„æ„é€ å‡½æ•°ï¼š\nGsmModem(self, port, baudrate=115200, incomingCallCallbackFunc=None, smsReceivedCallbackFunc=None, smsStatusReportCallback=None) å‚æ•°çš„å«ä¹‰ï¼š\nport ï¼Œè®¾ç½® AT æŒ‡ä»¤ç«¯å£ baudrate ï¼Œæ³¢ç‰¹ç‡ incomingCallCallbackFunc ï¼Œå¤„ç†æ¥å¬ç”µè¯çš„å›è°ƒå‡½æ•° smsReceivedCallbackFunc ï¼Œå¤„ç†æ¥æ”¶çŸ­ä¿¡çš„å›è°ƒå‡½æ•° smsStatusReportCallback ï¼Œå¤„ç†çŸ­ä¿¡çŠ¶æ€æŠ¥å‘Šçš„å›è°ƒå‡½æ•° æ–°å»ºå®ä¾‹åï¼Œè¦å…ˆè¿æ¥ç«¯å£ï¼Œåˆå§‹åŒ– GSM Modemï¼š\nconnect(self, pin=None) è¿™ä¸ªå‡½æ•°ä¼šæ‰“å¼€ AT æŒ‡ä»¤ç«¯å£ï¼Œåˆå§‹åŒ– GSM Modem å’Œ SIM å¡ã€‚å‚æ•° pin ç”¨äºè®¾ç½® SIM å¡å†…çš„ PIN ç  ï¼Œå­—ç¬¦ä¸²ç±»å‹ï¼Œé€šå¸¸ SIM å¡æ²¡æœ‰å¯åŠ¨ PIN ç é”å®šï¼Œè®¾ä¸º None å³å¯ã€‚å¦‚æœ SIM å¡éœ€è¦ PIN ç è€Œè¿™é‡Œæ²¡æœ‰è®¾ç½®ï¼Œå‡½æ•°ä¼šæŠ›å‡º PinRequiredError å¼‚å¸¸ã€‚å¦‚æœ PIN ç è®¾ç½®é”™è¯¯ï¼Œå‡½æ•°ä¼šæŠ›å‡º IncorrectPinError å¼‚å¸¸ã€‚ç›¸åº”çš„ï¼Œç»“æŸæ—¶åº”è¯¥è°ƒç”¨ close() å…³é—­ä¸²å£ï¼Œè¿™æ˜¯ä» SerialComms ç±»ç»§æ‰¿çš„æ–¹æ³•ã€‚\næ–°è´­ä¹°çš„ SIM å¡èƒŒé¢æç¤ºä¸­ä¼šå†™æœ‰ PIN ç åˆå§‹å€¼ï¼Œä¹Ÿå¯ä»¥åœ¨è¿è¥å•†å®˜ç½‘æŸ¥è¯¢ä¿®æ”¹ï¼Œé€šå¸¸æ˜¯å››ä½æ•°å­—ã€‚PIN ç çš„ä½œç”¨æ˜¯å¢å¼º SIM å¡å®‰å…¨æ€§ï¼Œä¾‹å¦‚å¯ä»¥åœ¨æ‰‹æœºä¸Šä¸º SIM å¡å¯åŠ¨ PIN ç é”å®šï¼Œè¿™æ ·æ¯æ¬¡å¼€æœºéƒ½è¦è¾“å…¥ PIN ç ã€‚\nåˆå§‹åŒ–ä¹‹åï¼Œåº”è¯¥ç¡®è®¤ GSM Modem å·²ç»æˆåŠŸæ¥å…¥è¿è¥å•†ç½‘ç»œã€‚å¯ä»¥è°ƒç”¨ waitForNetworkCoverage() ï¼Œå®ƒä¼šå¼•èµ·é˜»å¡ï¼Œç›´åˆ°æˆåŠŸå…¥ç½‘ï¼Œæˆ–è€…è¶…æ—¶ï¼š\nwaitForNetworkCoverage(self, timeout=None) å‚æ•° timeout å¯ä»¥è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œint ç±»å‹ï¼Œå•ä½æ˜¯ç§’ã€‚è¶…æ—¶ä¼šæŠ›å‡º TimeoutException å¼‚å¸¸ï¼Œå¦‚æœæœ‰å…¶ä»–é”™è¯¯ï¼Œä¼šæŠ›å‡º InvalidStateException ã€‚è°ƒç”¨ç»“æŸåä¼šè¿”å›å½“å‰çš„ä¿¡å·å¼ºåº¦ã€‚\nè¿˜æœ‰ä¸€ä¸ªå•ç‹¬çš„å‡½æ•°ï¼Œå¯ä»¥è·å–ä¿¡å·å¼ºåº¦ï¼š\nsignalStrength(self) è¿”å›å€¼æ˜¯æ•´æ•°ï¼ŒèŒƒå›´åœ¨ 0~99 è¡¨ç¤ºä¿¡å·å¼ºåº¦ï¼Œ-1 è¡¨ç¤ºæœªçŸ¥ã€‚\nè¿˜æœ‰ä¸€äº›åŠŸèƒ½å‡½æ•°ï¼Œå¯ä»¥è·å– Modem çš„ä¸€äº›çŠ¶æ€ï¼Œè¿™äº›å‡½æ•°éƒ½æ˜¯æ‰§è¡Œç›¸å…³çš„ AT æŒ‡ä»¤ï¼Œå¦‚æœè¦æ‰§è¡Œå…¶ä»– AT æŒ‡ä»¤ï¼Œå¯ä»¥é€šè¿‡ SerialComms ç±»æä¾›çš„ wirte æ–¹æ³•ç›´æ¥å‘ Modem å‘é€ï¼š\nmanufacturer(self) ï¼Œè¿”å› Modem çš„å‚å®¶ä¿¡æ¯ model(self) ï¼Œè¿”å› Model çš„åç§° revision(self) ï¼Œ è¿”å› Modem çš„å›ºä»¶ç‰ˆæœ¬ imei(self) ï¼Œè¿”å› Modem çš„ IMEI ç¼–ç  imsi(self) ï¼Œè¿”å› SIM å¡çš„ IMSI ç¼–ç  networkName(self) ï¼Œè¿”å›å½“å‰ Modem æ‰€æ³¨å†Œçš„ç½‘ç»œçš„åç§° supportedCommands(self) ï¼Œè¿”å› Modem æ”¯æŒçš„ AT æŒ‡ä»¤çš„åˆ—è¡¨ è®¾ç½®çŸ­ä¿¡ç¼–ç çš„æ ¼å¼å¯ä»¥è°ƒç”¨ smsTextMode() ï¼š\nsmsTextMode(self, textMode) å‚æ•° textMode æ˜¯å¸ƒå°”å‹ï¼Œè®¾ä¸º True è¡¨ç¤º text æ ¼å¼ï¼Œå¦åˆ™ä¸º PDU æ ¼å¼ã€‚text æ ¼å¼æ˜¯æ˜æ–‡ä¼ è¾“ï¼Œä¸é€‚åˆä¼ è¾“ä¸­æ–‡ï¼Œå›½å†…ç›®å‰éƒ½æ˜¯ PDU æ ¼å¼ï¼Œåˆå§‹åŒ–æ—¶ï¼Œå·²ç»é»˜è®¤è®¾ä¸º PDU æ ¼å¼ã€‚\nå‘é€æ–‡æœ¬ç±»å‹çš„çŸ­ä¿¡å¯ä»¥ç”¨ sendSms() å‡½æ•°ï¼š\nsendSms(self, destination, text, waitForDeliveryReport=False, deliveryTimeout=15, sendFlash=False) å‚æ•°çš„å«ä¹‰ï¼š\ndestination ï¼Œå­—ç¬¦ä¸²ç±»å‹ï¼Œç›®æ ‡æ‰‹æœºçš„ç”µè¯å·ç  text ï¼Œè¦å‘é€çš„æ–‡æœ¬å†…å®¹ waitForDeliveryReport ï¼Œå¸ƒå°”å‹ï¼Œå¦‚æœè®¾ä¸º True ï¼Œå‡½æ•°ä¼šé˜»å¡ï¼ŒçŸ¥é“æ”¶åˆ°çŸ­ä¿¡çŠ¶æ€çš„è¿”å›æŠ¥å‘Š deliveryTimeout ï¼Œæ•´æ•°ï¼Œæˆ–è€…æµ®ç‚¹æ•°ï¼Œå½“ waitForDeliveryReport=True æ—¶æœ‰æ•ˆï¼Œè¡¨ç¤ºé˜»å¡è¶…æ—¶æ—¶é—´ã€‚ å¦‚æœå‘é€è¿‡ç¨‹è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼Œä¼šæŠ›å‡º CommandError å¼‚å¸¸ã€‚å¦‚æœè¶…æ—¶ï¼Œä¼šæŠ›å‡º TimeoutException å¼‚å¸¸ã€‚\n","date":"2017 June 1","permalink":"/posts/2017/06/01/","section":"Posts","summary":"ä»¥ Telit HE910 æ¨¡å—ä¸ºä¾‹ï¼Œåœ¨ Linux ä¸‹çš„ AT å‘½ä»¤ç«¯å£æ˜¯ /dev/ttyACM3 ã€‚å¯ä»¥é€šè¿‡ pyserial åº“ç›´æ¥è¯»å†™ç«¯å£æ¥ä¸æ¨¡å—é€šä¿¡ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æ›´é«˜çº§çš„ python-gsmmodem ã€‚","title":"ä½¿ç”¨ Python æ“ä½œ 3G æ¨¡å—"},{"content":"1. ç®€ä»‹ #Linux Test Projec æ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œç®€ç§° LTP ï¼Œè‡´åŠ›äºæä¾›ä¸€å¥—æµ‹è¯•å·¥å…·ï¼Œç”¨äºæµ‹è¯•å’ŒéªŒè¯ Linux å†…æ ¸çš„åŠŸèƒ½å’Œç¨³å®šæ€§ï¼Œå®˜ç½‘åœ°å€ï¼šhttps://linux-test-project.github.ioã€‚\n2. å®‰è£… #å®‰è£…å‰è¦å‡†å¤‡ gitã€gccã€automakeã€autoconfã€m4ã€bisonã€byaccã€flex ã€‚ç„¶åä» github å…‹éš†æºç ï¼š\n$ git clone https://github.com/linux-test-project/ltp.git $ cd ltp é…ç½®ã€ç¼–è¯‘ã€å®‰è£…ï¼Œæ–‡ä»¶éƒ½å®‰è£…åœ¨ /opt/ltp/ ç›®å½•ä¸‹ã€‚ï¼š\n$ ../configure $ make all $ make install $ cd /opt/ltp/ $ ls bin IDcheck.sh runltp runltplite.sh runtest scenario_groups share testcases testscripts ver_linux Version 3. ç»“æ„è¯´æ˜ #æ•´å¥—æµ‹è¯•å·¥å…·åˆ†ä¸ºä¸‰å¤§éƒ¨åˆ†ï¼šæµ‹è¯•è„šæœ¬ã€æµ‹è¯•é©±åŠ¨å’Œæµ‹è¯•ç”¨ä¾‹ã€‚æµ‹è¯•è„šæœ¬ä½äº testscripts/ ç›®å½•ä¸‹ï¼ŒåŒ…å«äº†æ–‡ä»¶ç³»ç»Ÿã€ç£ç›˜ã€å†…æ ¸ç­‰å„ç§æµ‹è¯•é¡¹ç›®çš„è„šæœ¬ï¼›æµ‹è¯•é©±åŠ¨ä½äº bin/ ç›®å½•ä¸‹ï¼Œä¸»è¦æ˜¯ä¸€äº›æµ‹è¯•ç”¨çš„è¾…åŠ©è„šæœ¬ï¼Œæ¯”å¦‚ ltp-pan å’Œ ltp-scanner ï¼›æµ‹è¯•ç”¨ä¾‹ä½äº testcase/ ç›®å½•ä¸‹ã€‚å…¶ä»–å„ç›®å½•å’Œæ–‡ä»¶çš„åŠŸèƒ½ï¼š\nIDcheck.sh ï¼Œæ£€æŸ¥ç³»ç»Ÿæ˜¯å¦ç¼ºå°‘æ‰§è¡Œ LTP æµ‹è¯•å¥—ä»¶æ‰€éœ€çš„ç”¨æˆ·å’Œç”¨æˆ·ç»„ï¼Œå¦‚æœç¼ºå°‘ï¼Œå°±è‡ªåŠ¨åˆ›å»ºã€‚ runltp ï¼Œæ‰§è¡Œ LTP æµ‹è¯•å¥—ä»¶çš„è„šæœ¬ã€‚ runltplite.sh ï¼Œç”¨äºæµ‹è¯• LTP å®‰è£…ï¼Œä¹Ÿå¯ç”¨äºæ‰§è¡Œå•é¡¹æµ‹è¯•ã€‚ runtest ï¼Œæµ‹è¯•é©±åŠ¨ï¼Œç”¨æˆ·è¿æ¥æµ‹è¯•è„šæœ¬å’Œæµ‹è¯•ç”¨ä¾‹ã€‚ share ï¼Œæµ‹è¯•è„šæœ¬çš„ä½¿ç”¨è¯´æ˜ã€‚ ver_linux ï¼Œæ‰“å°å½“å‰ç³»ç»Ÿå„é¡¹ä¿¡æ¯çš„è„šæœ¬ã€‚ LTP çš„æ‰§è¡ŒåŸç†æ˜¯ä»ä¸€ä¸ªæµ‹è¯•è„šæœ¬ä¸­è¯»å–æ‰€æµ‹æ¡ç›®éœ€è¦æ‰§è¡Œçš„å‘½ä»¤è¡Œï¼Œç„¶åç­‰å¾…è¯¥é¡¹æµ‹è¯•çš„ç»“æŸï¼Œå¹¶è®°å½•è¯¦ç»†çš„æµ‹è¯•è¾“å‡ºã€‚ç®€å•åœ°è¯´ï¼ŒLTP æµ‹è¯•å¥—ä»¶é€šè¿‡æ‰§è¡Œæµ‹è¯•è„šæœ¬ runltp (æˆ–ç€ runltplite.shï¼Œtestscripts å†…çš„æµ‹è¯•è„šæœ¬ï¼‰ï¼Œè°ƒç”¨é©±åŠ¨ç¨‹åº ltp-pan æ‰§è¡Œ testcases å†…çš„æµ‹è¯•é¡¹ç›®ï¼Œè¾“å‡ºæµ‹è¯•ç»“æœï¼Œå¹¶åˆ©ç”¨ ltp-scanner æ•´ç†æ•°æ®ã€‚é»˜è®¤çŠ¶æ€ä¸‹ ltp-pan ä¼šéšæœºçš„é€‰æ‹©ä¸€ä¸ªå‘½ä»¤è¡Œæ¥è¿è¡Œï¼Œå¯ä»¥æŒ‡å®šåœ¨åŒä¸€æ—¶é—´è¦æ‰§è¡Œæµ‹è¯•çš„æ¬¡æ•°ã€‚ltp-pan ä¼šè®°å½•æµ‹è¯•äº§ç”Ÿçš„è¯¦ç»†çš„æ ¼å¼å¤æ‚çš„è¾“å‡ºï¼Œä½†å®ƒä¸è¿›è¡Œæ•°æ®çš„æ•´ç†å’Œç»Ÿè®¡ï¼Œæ•°æ®æ•´ç†ç»Ÿè®¡çš„å·¥ä½œç”± ltp-scanner æ¥å®Œæˆï¼Œltp-scanner æ˜¯ä¸€ä¸ªæµ‹è¯•ç»“æœåˆ†æå·¥å…·ï¼Œå®ƒä¼šç†è§£ ltp-pan çš„è¾“å‡ºæ ¼å¼ï¼Œå¹¶é€šè¿‡è¡¨æ ¼çš„å½¢å¼æ€»ç»“æµ‹è¯• passed æˆ– failed çš„æƒ…å†µã€‚\næµ‹è¯•å¥—ä»¶çš„ä½¿ç”¨ #LTP æä¾›äº†ä¸¤ä¸ª runltp å’Œ runltplite.sh ã€‚runltp ç”¨äºéªŒè¯å†…æ ¸ã€‚è¿™ä¸ªè„šæœ¬ä¸²è¡Œåœ°è¿è¡Œä¸€ç»„æµ‹è¯•ï¼Œå¹¶æŠ¥å‘Šå…¨éƒ¨ç»“æœã€‚é»˜è®¤åœ°ï¼Œè¿™ä¸ªè„šæœ¬æ‰§è¡Œï¼š\næ–‡ä»¶ç³»ç»Ÿå‹åŠ›æµ‹è¯•ã€‚ ç¡¬ç›˜ I/O æµ‹è¯•ã€‚ å†…å­˜ç®¡ç†å‹åŠ›æµ‹è¯•ã€‚ IPC å‹åŠ›æµ‹è¯•ã€‚ SCHED æµ‹è¯•ã€‚ å‘½ä»¤åŠŸèƒ½çš„éªŒè¯æµ‹è¯•ã€‚ ç³»ç»Ÿè°ƒç”¨åŠŸèƒ½çš„éªŒè¯æµ‹è¯•ã€‚ LTP æä¾›çš„æµ‹è¯•å†…å®¹ä¸å®Œå…¨å†™å…¥ runltp ï¼Œæµ‹è¯•æ—¶å¯ä»¥æ ¹æ®éœ€æ±‚ä¿®æ”¹ runltp å¹¶æ·»åŠ å†…å®¹ã€‚\n","date":"2017 May 24","permalink":"/posts/2017/05/24/","section":"Posts","summary":"1. ç®€ä»‹ #Linux Test Projec æ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œç®€ç§° LTP ï¼Œè‡´åŠ›äºæä¾›ä¸€å¥—æµ‹è¯•å·¥å…·ï¼Œç”¨äºæµ‹è¯•å’ŒéªŒè¯ Linux å†…æ ¸çš„åŠŸèƒ½å’Œç¨³å®šæ€§ï¼Œå®˜ç½‘åœ°å€ï¼šhttps://linux-test-project.","title":"Linux Test Project å­¦ä¹ ç¬”è®°"},{"content":"Paho æ˜¯ä¸€ä¸ªå¼€æºçš„ MQTT å®¢æˆ·ç«¯é¡¹ç›®ï¼Œæä¾›å¤šç§è¯­è¨€çš„ MQTT å®¢æˆ·ç«¯å®ç°ï¼ŒåŒ…æ‹¬ Cã€C++ã€C#ã€Javaã€Pythonã€JavaScript ç­‰ï¼Œå®Œå…¨æ”¯æŒ MQTT v3.1 å’Œ v3.1.1 ã€‚Paho Python Client æ˜¯å®ƒçš„ Python è¯­è¨€ç‰ˆæœ¬ï¼Œæ”¯æŒ Python 2.7 å’Œ 3.x ã€‚æ›´å¤šç‰¹æ€§å¯ä»¥æŸ¥çœ‹ http://www.eclipse.org/paho/clients/python/ ï¼Œæºç å’Œæ–‡æ¡£åœ¨ https://github.com/eclipse/paho.mqtt.python ã€‚\nè¯¥é¡¹ç›®æä¾›äº†ä¸€ä¸ªæµ‹è¯•ç”¨çš„ MQTT broker ï¼šiot.eclipse.org ï¼Œç«¯å£ 1883 ï¼Œæ— å¯†ç ã€‚\n1. å®‰è£… #åœ¨ Python ç¯å¢ƒä¸­ç”¨ pip install paho-mqtt å‘½ä»¤å®‰è£…ï¼Œæˆ–è€…ä¸‹è½½æºç ï¼š\ngit clone https://github.com/eclipse/paho.mqtt.python.git cd org.eclipse.paho.mqtt.python.git python setup.py install ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œè¿æ¥ä¸€ä¸ª borker ï¼Œè®¢é˜…ç³»ç»Ÿé»˜è®¤è¯é¢˜ï¼Œè·å– broker çš„ç‰ˆæœ¬å·ï¼š\nimport paho.mqtt.client as mqtt def on_connect(client, userdata, flags, rc): print(\u0026quot;Connected with result code \u0026quot;+str(rc)) client.subscribe(\u0026quot;$SYS/broker/version\u0026quot;) def on_message(client, userdata, msg): print(msg.topic+\u0026quot; \u0026quot;+str(msg.payload)) client = mqtt.Client() client.on_connect = on_connect client.on_message = on_message client.connect(\u0026quot;iot.eclipse.org\u0026quot;, 1883, 60) client.loop_forever() ä¿å­˜åˆ° paho-mqtt.py æ–‡ä»¶ï¼Œæ‰§è¡Œï¼š\n$ python paho-mqtt.py Connected with result code 0 $SYS/broker/version mosquitto version 1.4.10 2. ç¼–ç¨‹ #paho.mqtt åŒ…æä¾›äº†ä¸‰ä¸ªç±»ï¼ŒClientã€Publish å’Œ Subscribeã€‚Publish å’Œ Subscribe æä¾›äº†ç®€å•çš„æ–¹æ³•ï¼Œä¸€æ¬¡æ€§çš„å‘é€æˆ–è€…æ¥æ”¶æ¶ˆæ¯ï¼Œä¸ä¼šä¿æŒè¿æ¥ã€‚Client åŒ…å«äº†æ–°å»ºå®¢æˆ·ç«¯ã€è¿æ¥ã€è®¢é˜…ã€å‘é€ã€å›è°ƒå‡½æ•°ç­‰æ–¹æ³•ã€‚é€šå¸¸çš„ç¼–ç¨‹æ­¥éª¤æ˜¯æ–°å»ºä¸€ä¸ª Client çš„å®ä¾‹ï¼Œç„¶åè°ƒç”¨å®ƒæä¾›çš„è¿æ¥ã€å‘å¸ƒå’Œè®¢é˜…ç­‰æ–¹æ³•ä¸ broker é€šè®¯ï¼š\næ–°å»ºä¸€ä¸ª Client å®ä¾‹ ç”¨ä¸€ä¸ª connect*() å‡½æ•°è¿æ¥ broker ç”¨ä¸€ä¸ª loop*() å‡½æ•°ï¼Œç»´æŒä¸ broker çš„è¿æ¥ ç”¨ subscribe() å‡½æ•°è®¢é˜…ä¸€ä¸ªè¯é¢˜ï¼Œæ¥æ”¶æ¶ˆæ¯ ç”¨ publish() å‡½æ•°å‘å¸ƒæ¶ˆæ¯ ç”¨ disconnect() å‡½æ•°æ–­å¼€è¿æ¥ ä¸‹é¢ä¸»è¦ä»‹ç» Client æä¾›çš„æ–¹æ³•ï¼Œä½¿ç”¨å‰å…ˆå¯¼å…¥ï¼š\nimport paho.mqtt.client as mqtt 2.1. åˆå§‹åŒ– #æ–°å»ºä¸€ä¸ª Client å®ä¾‹ï¼š\nClient(client_id=\u0026quot;\u0026quot;, clean_session=True, userdata=None, protocol=MQTTv311, transport=\u0026quot;tcp\u0026quot;) è¿™æ˜¯ Client ç±»çš„æ„é€ å‡½æ•°ï¼Œå‚æ•°çš„å«ä¹‰ï¼š\nclient_id ï¼Œè®¾ç½®å®¢æˆ·ç«¯çš„ ID ï¼Œåº”è¯¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¿æ¥æ—¶å‘ broker æäº¤ã€‚å¦‚æœä¸ºç©ºï¼Œä¼šéšæœºç”Ÿæˆä¸€ä¸ª id ï¼Œæ­¤æ—¶ï¼Œclean_session å¿…é¡»è®¾ä¸º True ã€‚ clean_session ï¼Œå¸ƒå°”å‹ï¼Œå¦‚æœä¸º True ï¼Œæ–­å¼€è¿æ¥æ—¶ï¼Œbroker ä¼šæ¸…é™¤å…³äºè¿™ä¸ª client çš„æ‰€æœ‰ä¿¡æ¯ã€‚å¦‚æœä¸º False ï¼Œæ–­å¼€è¿æ¥æ—¶ï¼Œbroker ä¼šä¿ç•™è¿™ä¸ªå®¢æˆ·ç«¯çš„è®¢é˜…ä¿¡æ¯å’Œæ¶ˆæ¯é˜Ÿåˆ—ã€‚ userdata ï¼Œç”¨æˆ·è‡ªå®šä¹‰çš„æ•°æ®ï¼Œå¯ä»¥æ˜¯ä»»ä½•ç±»å‹ï¼Œä¼ é€’ç»™å›è°ƒå‡½æ•°ã€‚å¯ä»¥ç”¨ user_data_set() å‡½æ•°æ›´æ–°ã€‚ protocol ï¼Œè®¾ç½® MQTT åè®®çš„ç‰ˆæœ¬ï¼ŒMQTTv31 æˆ–è€… MQTTv311 ã€‚ transport ï¼Œ ä¼ è¾“åè®®ï¼Œé»˜è®¤è¿˜æ˜¯ tcp ï¼Œå¯ä»¥è®¾ä¸º websockets ã€‚ æ„é€ å®ä¾‹ï¼š\nimport paho.mqtt.client as mqtt mqttc = mqtt.Client() å¯ä»¥è°ƒç”¨ reinitialise() é‡æ–°åˆå§‹åŒ– Client ï¼š\nreinitialise(client_id=\u0026quot;\u0026quot;, clean_session=True, userdata=None) 2.2. é…ç½® #è¿™äº›å‡½æ•°ç”¨æ¥è®¾ç½® Client çš„ä¸€äº›ç‰¹æ€§ï¼Œé€šå¸¸åœ¨è¿æ¥ broker ä¹‹å‰è°ƒç”¨ã€‚\nmax_inflight_messages_set(self, inflight) è¿™ä¸ªå‡½æ•°å¯ä»¥è®¾ç½®å½“ QoS\u0026gt;0 æ—¶ï¼Œæœ€å¤šå¯ä»¥å­˜åœ¨å‡ æ¡åŠ¨æ€æ¶ˆæ¯ï¼ˆå·²ç»å‘é€ï¼Œè¿˜æ²¡æœ‰ç¡®è®¤æˆåŠŸçš„æ¶ˆæ¯ï¼‰ã€‚é»˜è®¤æ˜¯ 20 ï¼Œå¢åŠ è¿™ä¸ªå€¼ä¼šå ç”¨æ›´å¤šçš„å†…å­˜ï¼Œä½†æ˜¯å¯ä»¥æå‡ååé‡ã€‚\nmax_queued_messages_set(self, queue_size) è¿™ä¸ªå‡½æ•°å¯ä»¥è®¾ç½®å½“ QoS\u0026gt;0 æ—¶ï¼Œå‘é€æ¶ˆæ¯é˜Ÿåˆ—çš„æœ€å¤§å€¼ï¼Œé»˜è®¤æ˜¯ 0 ï¼Œè¡¨ç¤ºæ— é™åˆ¶ã€‚å½“é˜Ÿåˆ—æ»¡æ—¶ï¼Œæ—§æ¶ˆæ¯ä¼šä¸¢å¼ƒã€‚\nmessage_retry_set(retry) å½“ Qos\u0026gt;0 æ—¶ï¼Œå¦‚æœå‘é€æ¶ˆæ¯åè¶…è¿‡ä¸€å®šæ—¶é—´è¿˜æ²¡æœ‰æ”¶åˆ°ç¡®è®¤æŠ¥æ–‡ï¼Œå°±è¦é‡å‘æ¶ˆæ¯ï¼Œè¿™ä¸ªå‡½æ•°ç”¨äºè®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ˜¯ç§’ã€‚é»˜è®¤æ˜¯ 5 ç§’ï¼Œé€šå¸¸ä¸ç”¨ä¿®æ”¹ã€‚\né…ç½® SSL è¯ä¹¦éªŒè¯çš„å‡½æ•°ï¼Œå¿…é¡»åœ¨ connect*() å‡½æ•°ä¹‹å‰è°ƒåŠ¨ã€‚å‡ ä¸ªå‚æ•°çš„å«ä¹‰ï¼š\nca_certs ï¼ŒæŒ‡å®š CA æ ¹è¯ä¹¦çš„è·¯å¾„ã€‚ certfile,keyfile ï¼ŒæŒ‡å®šå®¢æˆ·ç«¯ç§é’¥å’Œè¯ä¹¦çš„è·¯å¾„ã€‚ cert_reqs ï¼Œè®¾ç½®å®¢æˆ·ç«¯å¯¹ broker è¯ä¹¦çš„éœ€æ±‚ï¼Œé»˜è®¤æ˜¯ ssl.CERT_REQUIRED ï¼Œè¡¨ç¤º broker å¿…é¡»æä¾›ä¸€ä¸ªè¯ä¹¦ã€‚ tls_version ï¼Œè®¾ç½® SSL/TLS åè®®çš„ç‰ˆæœ¬ï¼Œé»˜è®¤æ˜¯ TLS v1 ã€‚ ciphers ï¼Œè®¾ç½®æœ¬æ¬¡è¿æ¥çš„åŠ å¯†å¯†ç ï¼Œé»˜è®¤æ˜¯ None ã€‚ è®¾ç½®ç”¨æˆ·åå’Œå¯†ç ï¼š\nusername_pw_set(username, password=None)\nè®¾ç½®é—å˜±ï¼š\nwill_set(topic, payload=None, qos=0, retain=False) å½“è¿™ä¸ª client æ–­å¼€è¿æ¥æ—¶ï¼Œbroker ä¼šå‘å¸ƒè¿™ä¸ªé—å˜±æ¶ˆæ¯ã€‚å‚æ•°çš„å«ä¹‰ï¼š\ntopic ï¼Œé—å˜±æ¶ˆæ¯çš„è¯é¢˜ payload ï¼Œé—å˜±æ¶ˆæ¯çš„å†…å®¹ï¼Œå­—ç¬¦ä¸²ç±»å‹ï¼Œå¦‚æœè®¾ä¸º None ï¼Œä¼šå‘é€ä¸€æ¡é•¿åº¦ä¸º 0 æ¶ˆæ¯ã€‚å¦‚æœè®¾ç½®äº† int æˆ–è€… float ç±»å‹çš„å€¼ï¼Œä¼šå½“åšå­—ç¬¦ä¸²å‘é€ï¼Œå¦‚æœä½ æƒ³å‘é€çœŸæ­£çš„ int æˆ–è€… float å€¼ï¼Œéœ€è¦ç”¨ struct.pack() ç”Ÿæˆæ¶ˆæ¯ã€‚ qos ï¼Œé—å˜±æ¶ˆæ¯çš„å®‰å…¨ç­‰çº§ retain ï¼Œå¦‚æœè®¾ä¸º True ï¼Œé—å˜±æ¶ˆæ¯ä¼šè¢«è®¾ä¸ºä¿ç•™æ¶ˆæ¯ å¦‚æœå‚æ•°è®¾ç½®é”™è¯¯ï¼Œå‡½æ•°ä¼šæŠ›å‡º ValueError å¼‚å¸¸ã€‚\n2.3. è¿æ¥ #æœ€åŸºæœ¬çš„è¿æ¥æ–¹æ³•æ˜¯ connect() ï¼š\nconnect(host, port=1883, keepalive=60, bind_address=\u0026quot;\u0026quot;) è¿æ¥åˆ° broker ï¼Œè¿™æ˜¯ä¸€ä¸ªé˜»å¡å‡½æ•°ï¼Œå‚æ•°çš„å«ä¹‰ï¼š\nhost ï¼Œbroker çš„ hostname æˆ–è€… IP port ï¼Œbroker çš„å¼€æ”¾ç«¯å£ï¼Œé»˜è®¤æ˜¯ 1883 ï¼Œå¦‚æœä½¿èƒ½äº† SSL/TLS ï¼Œç«¯å£å¯èƒ½æ˜¯ 8883 keepalive ï¼Œå¿ƒè·³é—´éš”ï¼Œå•ä½æ˜¯ç§’ï¼Œå¦‚æœ broker å’Œ client åœ¨è¿™æ®µæ—¶é—´å†…æ²¡æœ‰ä»»ä½•é€šè®¯ï¼Œclient ä¼šç»™ broker å‘é€ä¸€ä¸ª ping æ¶ˆæ¯ bind_address ï¼Œå¦‚æœ client çš„æœ¬åœ°è®¡ç®—æœºæœ‰å¤šä¸ªç½‘ç»œæ¥å£ï¼Œå¯ä»¥ç”¨è¿™ä¸ªå‚æ•°ç»‘å®šå…¶ä¸­çš„ä¸€ä¸ª client è°ƒç”¨è¯¥å‡½æ•°å‘èµ·è¿æ¥åï¼Œå¦‚æœæ”¶åˆ° broker å‘æ¥çš„ CONNACK æ¶ˆæ¯ï¼Œå°±ä¼šæ‰§è¡Œ on_connect() å›è°ƒå‡½æ•°ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ connect_async() å’Œ connect_srv() ä¸¤ç§å‡½æ•°å¯ä»¥è¿æ¥ broker ã€‚connect_async() éœ€è¦é…åˆ loop_start() å‡½æ•°ä»¥éé˜»å¡çš„æ–¹å¼è¿æ¥ brokerã€‚connect_srv() æ˜¯ä» SRV DNS è·å– broker çš„åœ°å€ï¼Œç„¶åå†è¿æ¥ã€‚\nè°ƒç”¨è¿‡ connect*() å‡½æ•°ä¹‹åï¼Œå¯ä»¥è°ƒç”¨ reconnect() ç”¨ç°æœ‰çš„å‚æ•°é‡æ–°è¿æ¥ã€‚è°ƒç”¨ disconnect() å‡½æ•°å¯ä»¥ä» broker æ–­å¼€è¿æ¥ï¼Œæ–­å¼€è¿æ¥åï¼Œä¼šæ‰§è¡Œ on_disconnect() å›è°ƒå‡½æ•°ã€‚\n2.4. ç½‘ç»œå¾ªç¯ #ç½‘ç»œå¾ªç¯çš„å‡½æ•°æœ‰å››ç§ï¼Œå®ƒä»¬è¿è¡Œåœ¨åå°ï¼Œå¤„ç†æ”¶å‘çš„æ¶ˆæ¯ã€‚æœ€åŸºæœ¬çš„æ˜¯ loop() ï¼š\nloop(timeout=1.0, max_packets=1) è¿™ä¸ªå‡½æ•°ä¼šé€šè¿‡ select() å‡½æ•°é˜»å¡ï¼Œç›´åˆ°æœ‰æ¶ˆæ¯éœ€è¦æ”¶å‘ï¼Œé˜»å¡çš„æ—¶é—´ç”¨ timeout å‚æ•°è®¾ç½®ï¼Œä¸èƒ½è¶…è¿‡å¿ƒè·³æ—¶é—´ keepalive ï¼Œå¦åˆ™ä½ çš„ client ä¼šå®šæ—¶ä» broker æ–­å¼€ã€‚max_packets å‚æ•°å·²ç»è¿‡æ—¶ï¼Œæ— éœ€è®¾ç½®ã€‚\nå¦ä¸€ä¸ªå¾ªç¯å‡½æ•°æ˜¯ loop_forever() ï¼Œå®ƒä¼šä¸€ç›´é˜»å¡ï¼Œç›´åˆ° client è°ƒç”¨äº† disconnect() ï¼Œå¹¶ä¸”ï¼Œå®ƒä¼šè‡ªåŠ¨é‡è¿ï¼š\nloop_forever(timeout=1.0, max_packets=1, retry_first_connection=False) timeout å’Œ max_packets å‚æ•°å·²ç»è¿‡æ—¶ï¼Œæ— éœ€è®¾ç½®ã€‚\n2.5. å‘å¸ƒ #publish(topic, payload=None, qos=0, retain=False) å‘æŒ‡å®šè¯é¢˜å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œå‚æ•°çš„å«ä¹‰ï¼š\ntopic ï¼Œè¿™æ¡æ¶ˆæ¯æ‰€å±çš„è¯é¢˜ payload ï¼Œæ¶ˆæ¯å†…å®¹ï¼Œå­—ç¬¦ä¸²ç±»å‹ï¼Œå¦‚æœè®¾ä¸º None ï¼Œä¼šå‘é€ä¸€æ¡é•¿åº¦ä¸º 0 æ¶ˆæ¯ã€‚å¦‚æœè®¾ç½®äº† int æˆ–è€… float ç±»å‹çš„å€¼ï¼Œä¼šå½“åšå­—ç¬¦ä¸²å‘é€ï¼Œå¦‚æœä½ æƒ³å‘é€çœŸæ­£çš„ int æˆ–è€… float å€¼ï¼Œéœ€è¦ç”¨ struct.pack() ç”Ÿæˆæ¶ˆæ¯ã€‚ qos ï¼Œæ¶ˆæ¯çš„å®‰å…¨ç­‰çº§ retain ï¼Œå¦‚æœè®¾ä¸º Ture ï¼Œè¿™æ¡æ¶ˆæ¯ä¼šè¢«è®¾ä¸ºä¿ç•™æ¶ˆæ¯ å¦‚æœå‚æ•°è®¾ç½®é”™è¯¯ï¼Œä¼šæŠ›å‡º ValueError å¼‚å¸¸ã€‚æ¶ˆæ¯å‘é€æˆåŠŸåï¼Œä¼šæ‰§è¡Œ on_publish() å›è°ƒå‡½æ•°ã€‚\n2.6. è®¢é˜… #subscribe(topic, qos=0) å‘ broker è®¢é˜…è¯é¢˜ï¼Œå‚æ•° topic è®¾ç½®è¯é¢˜åç§°ï¼Œqos è®¾ç½®å®‰å…¨ç­‰çº§ã€‚å¦‚æœåªè®¢é˜…ä¸€ä¸ªè¯é¢˜ï¼Œç›´æ¥è®¾ç½®ä¸¤ä¸ªå‚æ•°å³å¯ï¼Œä¾‹å¦‚ï¼š\nsubscribe((\u0026quot;my/topic\u0026quot;, 1)) å¦‚æœè¦è®¢é˜…å¤šä¸ªè¯é¢˜ï¼Œå¯ä»¥å°†æ¯ä¸ªè¯é¢˜æ”¾åœ¨ä¸€ä¸ªå…ƒç»„ä¸­ï¼Œå¤šä¸ªè¯é¢˜ç»„æˆä¸€ä¸ªåˆ—è¡¨ï¼š\nsubscribe([(\u0026quot;my/topic\u0026quot;, 0), (\u0026quot;another/topic\u0026quot;, 2)]) å½“ broker ç¡®è®¤è®¢é˜…æœ‰æ•ˆåï¼Œclient ä¼šæ‰§è¡Œ on_subscribe() å›è°ƒå‡½æ•°ã€‚å¦‚æœè¦å–æ¶ˆè®¢é˜…æŸä¸ªè¯é¢˜ï¼Œå¯ä»¥è°ƒç”¨ unsubscribe(topic) ï¼Œå‚æ•°æ˜¯å­—ç¬¦ä¸²å‹ï¼Œå¦‚æœæ˜¯å–æ¶ˆå¤šä¸ªè¯é¢˜ï¼Œå‚æ•°åº”è¯¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ã€‚å–æ¶ˆæˆåŠŸçš„è¯ï¼Œä¼šæ‰§è¡Œ on_unsubscribe() å›è°ƒå‡½æ•°ã€‚\n2.7. å›è°ƒå‡½æ•° #å½“ broker å¯¹ client çš„è¿æ¥è¯·æ±‚åšå‡ºå›åº”æ—¶ï¼Œä¼šè°ƒç”¨ on_connect() å›è°ƒå‡½æ•°ï¼Œå¯ä»¥åœ¨è¯¥å‡½æ•°ä¸­åˆ¤æ–­è¿æ¥æ˜¯å¦æˆåŠŸ:\non_connect(client, userdata, flags, rc) å‚æ•° client æ˜¯å½“å‰ client çš„å®ä¾‹ï¼Œuserdata æ˜¯ Client() æˆ– userdata_set() è®¾ç½®çš„ç”¨æˆ·æ•°æ®ã€‚flags æ˜¯ broker å‘é€çš„å›åº” flags ï¼Œå­—å…¸ç±»å‹ã€‚rc è¡¨ç¤ºè¿æ¥ç»“æœï¼Œæ•´æ•°å‹ï¼Œ0 è¡¨ç¤ºè¿æ¥æˆåŠŸï¼Œè¿æ¥å¤±è´¥å¯èƒ½çš„å€¼æœ‰ï¼š\n1 ï¼Œé”™è¯¯çš„åè®®ç‰ˆæœ¬ 2 ï¼Œæ— æ•ˆçš„ client ID 3 ï¼ŒæœåŠ¡å™¨ä¸å¯ç”¨ 4 ï¼Œé”™è¯¯çš„ç”¨æˆ·åæˆ–å¯†ç  5 ï¼Œæ— æ³•éªŒè¯ ä½¿ç”¨å®ä¾‹ï¼š\ndef on_connect(client, userdata, flags, rc): print(\u0026quot;Connection returned result: \u0026quot;+connack_string(rc)) mqttc.on_connect = on_connect ... å¯¹åº”çš„ï¼Œä¸ broker æ–­å¼€è¿æ¥åï¼Œä¼šæ‰§è¡Œ on_disconnect() å›è°ƒå‡½æ•°ï¼š\non_disconnect(client, userdata, rc) rc è¡¨ç¤ºæ–­å¼€è¿æ¥çš„çŠ¶æ€ï¼Œå¦‚æœæ˜¯ 0 ï¼Œè¡¨ç¤ºæ˜¯è°ƒç”¨äº† disconnect() å¼•èµ·çš„æ–­å¼€è¿æ¥ï¼Œå…¶ä»–ç»“æœè¡¨ç¤ºæ„å¤–æ–­å¼€ï¼Œæ¯”å¦‚ç½‘ç»œä¸­æ–­ã€‚ä½¿ç”¨å®ä¾‹ï¼š\ndef on_disconnect(client, userdata, rc): if rc != 0: print(\u0026quot;Unexpected disconnection.\u0026quot;) mqttc.on_disconnect = on_disconnect ... å½“ client æ¥æ”¶åˆ°å·²è®¢é˜…çš„è¯é¢˜çš„æ¶ˆæ¯æ—¶ï¼Œä¼šè°ƒç”¨ on_message() å›è°ƒå‡½æ•°ï¼Œåœ¨è¯¥å‡½æ•°ä¸­åˆ¤æ–­æ˜¯å“ªä¸ªè¯é¢˜çš„æ¶ˆæ¯ï¼Œå¹¶å¤„ç†æ¶ˆæ¯å†…å®¹ï¼š\non_message(client, userdata, message) å‚æ•° message æ˜¯ MQTTMessage ç±»çš„å®ä¾‹ï¼Œè¿™ä¸ªç±»åŒ…å«çš„æˆå‘˜æœ‰ topic ï¼Œpayload ï¼Œqos ï¼Œretain ã€‚ä½¿ç”¨å®ä¾‹ï¼š\ndef on_message(client, userdata, message): print(\u0026quot;Received message '\u0026quot; + str(message.payload) + \u0026quot;' on topic '\u0026quot; + message.topic + \u0026quot;' with QoS \u0026quot; + str(message.qos)) mqttc.on_message = on_message ... å¦‚æœè¦ç”¨é€šé…ç¬¦åŒæ—¶å¤„ç†å¤šä¸ªè¯é¢˜çš„æ¶ˆæ¯ï¼Œä¾‹å¦‚ç”¨ sensors/# åŒ¹é… sensors/temperature å’Œ sensors/humidity è¯é¢˜ï¼Œå¯ä»¥ç”¨ message_callback_add() è®¾ç½®å›è°ƒå‡½æ•°ï¼š\nmessage_callback_add(sub, callback) å‚æ•° sub æ˜¯ä¸€ä¸ªä½¿ç”¨é€šé…ç¬¦çš„è¯é¢˜è¿‡æ»¤å™¨ï¼Œå­—ç¬¦ä¸²å‹ï¼Œç”¨ callback å‚æ•°æŒ‡å®šå›æ‰å‡½æ•°ï¼Œä¸ on_message() ç›¸åŒçš„ç±»å‹ã€‚\nå¦‚æœåŒæ—¶è®¾ç½®äº† on_message() å’Œ message_callback_add() å›è°ƒå‡½æ•°ï¼Œä¼šé¦–å…ˆå¯»æ‰¾åˆé€‚çš„ message_callback_add() å®šä¹‰çš„è¯é¢˜è¿‡æ»¤å™¨ï¼Œå¦‚æœæ²¡æœ‰åŒ¹é…ï¼Œæ‰ä¼šè°ƒç”¨ on_message() ã€‚\n2.8. å®ä¾‹ #å‡è®¾ broker è¦æ±‚æä¾›ç”¨æˆ·åã€å¯†ç ã€è¯ä¹¦å’Œå¯†é’¥ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ client ä¾‹å­ï¼š\n$ cat path-mqtt.py #!/usr/bin/python import paho.mqtt.client as mqtt cafile = \u0026quot;/etc/mosquitto/ca/ca.crt\u0026quot; certfile = \u0026quot;/home/ubuntu/CA/client.crt\u0026quot; keyfile = \u0026quot;/home/ubuntu/CA/client.key\u0026quot; user = \u0026quot;guest\u0026quot; passwd = \u0026quot;12345678\u0026quot; server = \u0026quot;localhost\u0026quot; port = 8883 def on_connect(client, userdata, flags, rc): print(\u0026quot;Connected with result code \u0026quot;+str(rc)) client.subscribe(\u0026quot;$SYS/broker/version\u0026quot;) def on_message(client, userdata, msg): print(msg.topic+\u0026quot; \u0026quot;+str(msg.payload)) client = mqtt.Client() client.tls_set(cafile,certfile,keyfile) client.username_pw_set(user,passwd) client.on_connect = on_connect client.on_message = on_message client.connect(server, port, 60) client.loop_forever() æ‰§è¡Œï¼š\n$ ./path-mqtt.py Connected with result code 0 $SYS/broker/version mosquitto version 1.4.11 ","date":"2017 May 23","permalink":"/posts/2017/05/23/","section":"Posts","summary":"Paho æ˜¯ä¸€ä¸ªå¼€æºçš„ MQTT å®¢æˆ·ç«¯é¡¹ç›®ï¼Œæä¾›å¤šç§è¯­è¨€çš„ MQTT å®¢æˆ·ç«¯å®ç°ï¼ŒåŒ…æ‹¬ Cã€C++ã€C#ã€Javaã€Pythonã€JavaScript ç­‰ï¼Œå®Œå…¨æ”¯æŒ MQTT v3.","title":"Paho Python Client å­¦ä¹ ç¬”è®°"},{"content":"1. RSA åŠ å¯†ç®—æ³• #RSA æ˜¯ä¸€ç§éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼ŒåŒæ—¶ç”Ÿæˆä¸€å¯¹å¯†é’¥ï¼Œåˆ†ä¸ºå…¬é’¥å’Œç§é’¥ï¼Œå®ƒæœ‰å‡ ä¸ªé‡è¦çš„ç‰¹ç‚¹ï¼š\nå…¬é’¥å¯ä»¥å‘å¤–å‘å¸ƒç»™å¤šäººï¼Œç§é’¥å¿…é¡»å•ç‹¬ä¿ç•™ç¡®ä¿å®‰å…¨ ä½¿ç”¨ç§é’¥åŠ å¯†çš„ä¿¡æ¯åªèƒ½è¦å…¬é’¥è§£å¯†ï¼Œä½¿ç”¨å…¬é’¥åŠ å¯†çš„ä¿¡æ¯åªèƒ½ç”¨ç§é’¥è§£å¯† å¯†é’¥è¶Šé•¿ï¼Œè¢«ç ´è§£çš„éš¾åº¦è¶Šå¤§ï¼Œå¯é æ€§è¶Šé«˜ï¼Œæ™®é€šç”¨æˆ·åº”ä½¿ç”¨ 1024 ä½å¯†é’¥ï¼Œè¯ä¹¦è®¤è¯æœºæ„åº”è¯¥ä½¿ç”¨ 2048 ä½æˆ–ä»¥ä¸Š RSA åŠ å¯†ç®—æ³•æœ‰ä¸¤ä¸ªé‡è¦çš„åº”ç”¨ï¼šä¿¡æ¯åŠ å¯†å’Œæ•°å­—ç­¾åã€‚\n2. ä¿¡æ¯åŠ å¯† #å¦‚æœå°† RSA ç”¨äºæ•°æ®åŠ å¯†ï¼Œå¿…ç„¶ä¸å¸Œæœ›åˆ«äººçŸ¥é“æ•°æ®å†…å®¹ï¼Œåªæœ‰æˆ‘å¯ä»¥è§£å¯†ï¼Œè¿™æ—¶éœ€è¦ç”¨å…¬é’¥åŠ å¯†ï¼Œç§é’¥è§£å¯†ã€‚ä¾‹å¦‚ï¼Œæˆ‘ç”Ÿæˆäº†ä¸€å¯¹å¯†é’¥ï¼Œå°†å…¬é’¥åˆ†ç»™å¾ˆå¤šäººï¼Œç§é’¥è‡ªå·±ä¿ç•™ï¼ŒAlice æƒ³è¦ç»™æˆ‘å‘ä¿¡æ¯æ—¶ï¼Œå°±å¯ä»¥ç”¨è¿™ä¸ªå…¬é’¥åŠ å¯†ä¹‹åå‘ç»™æˆ‘ï¼Œåªæœ‰æˆ‘å¯ä»¥ç”¨ç§é’¥è§£å¯†ã€‚\nopenssl é›†æˆäº†å¤šç§åŠ å¯†ç®—æ³•å’Œä½¿ç”¨å·¥å…·ï¼Œç”Ÿæˆç§é’¥å’Œç›¸åº”çš„å…¬é’¥ï¼š\n~$ openssl genrsa -out rsa.key 1024 Generating RSA private key, 1024 bit long modulus .....................++++++ ....++++++ e is 65537 (0x10001) ~$ openssl rsa -in rsa.key -pubout -out rsa_pub.key writing RSA key ~$ cat rsa_pub.key -----BEGIN PUBLIC KEY----- MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDHZUoPjBXGA4trMaPosiDJkR3x JGfsZRZ7i6bjKjKmocc0umiFcOCFDrP1u4o90lXa/9XVzZ7OUIZSWCaCm/YQDxih oeXTAIPVeCHbfAb9kcE+GjRpCj7VTwN2e96rYyTwBMPdSsDmcdHUAXNJHpA6eST+ 7JE1OHAYGz33AbYhaQIDAQAB -----END PUBLIC KEY----- å‡è®¾æœ‰ä¸ªæ–‡ä»¶ hello ï¼Œå†…å®¹æ˜¯ hello ï¼Œç”¨å…¬é’¥åŠ å¯†ï¼Œå¹¶ç”ŸæˆåŠ å¯†æ–‡ä»¶ï¼Œç„¶åå†ç”¨ç§é’¥è§£å¯†ï¼š\n~$ cat hello hello ~$ openssl rsautl -encrypt -in hello -inkey rsa_pub.key -pubin -out hello.en ~$ ls hello hello.en rsa.key rsa_pub.key ~$ cat hello.en 6\u0026amp;'ï¿½ï¿½RM6..oï¿½q?Sï¿½Rï¿½Ïƒkï¿½(7ï¿½ï¿½ï¿½ï¿½*ï¿½ï¿½ï¿½ï¿½`ï¿½ï¿½/3ï¿½H_ï¿½iï¿½ï¿½fï¿½ï¿½X7\u0026quot;$Hï¿½#Uï¿½)Yï¿½-ï¿½:ï¿½ï¿½ï¿½ï¿½\\ï¿½ï¿½up Ï¸I2ï¿½\u0026gt;ï¿½Q\u0026quot;ï¿½ï¿½ï¿½ï¿½#ï¿½aï¿½ï¿½ï¿½ ï¿½0ï¿½ï¿½YBï¿½wF% ~$ openssl rsautl -decrypt -in hello.en -inkey rsa.key -out hello.de ~$ cat hello.de hello 3. æ•°å­—ç­¾å #RSA ç®—æ³•çš„å¦ä¸€ä¸ªåº”ç”¨æ˜¯æ•°å­—ç­¾åã€‚æ—¢ç„¶æ˜¯ç­¾åï¼Œå¿…ç„¶ä¸å¸Œæœ›åˆ«äººå†’å……æˆ‘ï¼Œåªæœ‰æˆ‘æ‰èƒ½å‘å¸ƒè¿™ä¸ªç­¾åï¼Œæ‰€æœ‰è¦ç”¨ç§é’¥ç­¾åï¼Œåˆ«äººæ”¶åˆ°åå¯ä»¥å…¬é’¥éªŒè¯ã€‚æ•°å­—ç­¾åçš„ç›®çš„æ˜¯ï¼š\nè¯æ˜æ¶ˆæ¯æ˜¯æˆ‘å‘çš„ã€‚ è¯æ˜æ¶ˆæ¯å†…å®¹å®Œæ•´ï¼Œæ²¡æœ‰è¢«ç¯¡æ”¹ã€‚ è¦å®ç°ä»¥ä¸Šä¸¤ç‚¹ï¼Œé€šå¸¸çš„åšæ³•æ˜¯ï¼ŒæŠŠåŸæ–‡åšä¸€æ¬¡ Hashï¼ˆmd5 æˆ–è€… sha1 ç­‰ï¼‰ï¼Œç”Ÿæˆçš„ Hash å€¼ä¹Ÿå«åšä¿¡æ¯æ‘˜è¦æˆ–è€…æŒ‡çº¹ï¼Œç”¨ç§é’¥å¯¹è¿™ä¸ªæŒ‡çº¹åŠ å¯†ä½œä¸ºç­¾åï¼Œå°†åŸæ–‡å’Œç­¾åä¸€èµ·å‘å¸ƒï¼Œåˆ«äººæ”¶åˆ°åï¼Œç”¨å…¬é’¥è§£å¯†ç­¾åå¾—åˆ°ä¸€æ®µ Hash å€¼ï¼Œå¦‚æœè§£å¯†æˆåŠŸï¼Œåˆ™è¯æ˜ä¿¡æ¯æ˜¯æˆ‘å‘çš„ï¼Œç„¶åå¯¹åŸæ–‡åšä¸€æ¬¡ Hashï¼Œå°†ç»“æœä¸å‰é¢é‚£ä¸€æ®µ Hash å€¼å¯¹æ¯”ï¼Œå¦‚æœä¸€è‡´ï¼Œå°±è¯æ˜åŸæ–‡æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚ä¸‹å›¾æ˜¯ç­¾åå’ŒéªŒè¯çš„å®Œæ•´è¿‡ç¨‹ï¼š\nç”¨ OpenSSL å®Œæˆä¸€æ¬¡ç­¾åå’ŒéªŒè¯ã€‚é¦–å…ˆï¼Œä½¿ç”¨ç§é’¥ã€sha1 ç®—æ³•ï¼Œå¯¹æ–‡ä»¶ hello ç­¾åï¼Œç”Ÿæˆç­¾åæ–‡ä»¶ sign ï¼š\n~$ openssl dgst -sign rsa.key -sha1 -out sign hello ç„¶åï¼Œä½¿ç”¨å…¬é’¥éªŒè¯ç­¾åå’ŒåŸæ–‡ï¼š\n~$ openssl dgst -verify rsa_pub.key -sha1 -signature sign hello Verified OK 4. æ•°å­—è¯ä¹¦ #ç”±äºå…¬é’¥æ˜¯å…¬å¼€çš„ï¼Œå­˜åœ¨è¢«ç¯¡æ”¹çš„å¯èƒ½ã€‚å‡å¦‚ Alice æœ¬æ¥æ‹¥æœ‰æˆ‘çš„å…¬é’¥ï¼Œå´è¢«ç¬¬ä¸‰æ–¹å·å·æ›¿æ¢æˆç¬¬ä¸‰æ–¹çš„å…¬é’¥ï¼Œè¿™æ ·ç¬¬ä¸‰æ–¹å°±å¯ä»¥å†’å……æˆ‘ï¼Œç”¨ä»–è‡ªå·±ç§é’¥ç”Ÿæˆæ•°å­—ç­¾åï¼Œå‘é€ç»™ Alice ï¼ŒAlice ç”¨å…¬é’¥éªŒè¯æˆåŠŸï¼Œä»¥ä¸ºæ˜¯æˆ‘çš„ç­¾åï¼Œä»è€Œè¢«æ¬ºéª—ã€‚\nä¸ºäº†åº”å¯¹è¿™ç§æƒ…å†µï¼Œå°±éœ€è¦æˆ‘å‘è¯ä¹¦ä¸­å¿ƒï¼ˆCertificate Authorityï¼Œç®€ç§° CA ï¼Œæ˜¯ä¸€ç§è´Ÿè´£å‘æ”¾å’Œç®¡ç†æ•°å­—è¯ä¹¦çš„ç¬¬ä¸‰æ–¹æƒå¨æœºæ„ï¼‰ç”³è¯·ä¸€ä»½æ•°å­—è¯ä¹¦ï¼ŒCA ä¼šæ”¶é›†æˆ‘çš„å…¬é’¥å’Œå…¶ä»–ç›¸å…³ä¿¡æ¯åšä¸€ä¸ªè¯ä¹¦ï¼Œå†ç”¨å®ƒçš„ç§é’¥å¯¹è¯ä¹¦åšæ•°å­—ç­¾åï¼Œç¡®ä¿è¯ä¹¦ä¸è¢«ç¯¡æ”¹ï¼ŒäºŒè€…åˆåœ¨ä¸€èµ·å³ä½¿ä¸€ä»½æ•°å­—è¯ä¹¦ï¼ˆDigital Certificateï¼‰ã€‚ä»¥åæˆ‘å†™ä¿¡çš„æ—¶å€™ï¼Œåœ¨ç­¾åçš„åŒæ—¶ï¼Œéƒ½ä¼šé™„ä¸Šè¿™å¼ æ•°å­—è¯ä¹¦ï¼ŒAlice æ”¶åˆ°åï¼Œç”¨ CA çš„å…¬é’¥éªŒè¯æ•°å­—ç­¾åï¼Œç¡®ä¿è¯ä¹¦æœ‰æ•ˆï¼Œè·å–æˆ‘çš„å…¬é’¥ï¼Œç„¶åç”¨å…¬é’¥å»éªŒè¯æ•°å­—ç­¾åã€‚\nè¿™æ ·åˆå¸¦æ¥ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä½•è·å– CA çš„å…¬é’¥ï¼Œå¹¶ä¿è¯ CA å…¬é’¥çš„å®‰å…¨ï¼ŸCA é™¤äº†ç»™åˆ«äººç­¾å‘è¯ä¹¦ï¼Œå®ƒä»¬ä¹Ÿæœ‰è‡ªå·±çš„è¯ä¹¦ï¼Œè¯ä¹¦å†…å« CA å…¬é’¥(æ˜æ–‡)å’Œç”¨ CA ç§é’¥ç”Ÿæˆçš„æ•°å­—ç­¾åï¼Œå¾®è½¯ç­‰æ“ä½œç³»ç»Ÿå‚å•†ä¼šé€‰å–ä¸€äº›ä¿¡ç”¨è‰¯å¥½ä¸”æœ‰ä¸€å®šå®‰å…¨è®¤è¯çš„ CA ï¼ŒæŠŠè¿™äº› CA çš„è¯ä¹¦é»˜è®¤å®‰è£…åœ¨æ“ä½œç³»ç»Ÿé‡Œï¼Œå¹¶è®¾ç½®ä¸ºæ“ä½œç³»ç»Ÿä¿¡ä»»çš„æ ¹è¯ä¹¦ï¼Œä»¥ macOS ä¸ºä¾‹ï¼š\nä»¥ https ä¸ºä¾‹ï¼Œå¦‚æœæŸç½‘ç«™çš„æ•°å­—è¯ä¹¦çš„ç­¾å‘æœºæ„ (CA) ä¸åœ¨æ“ä½œç³»ç»Ÿä¿¡ä»»åˆ—è¡¨é‡Œï¼Œç™»å½•æ—¶æµè§ˆå™¨å°±ä¼šè­¦å‘Šï¼Œæ¯”å¦‚ https://www.12306.cn ï¼š\nç°å®æƒ…å†µé€šå¸¸æ›´å¤æ‚ä¸€ç‚¹ï¼Œæˆ‘ä»¬ä¸ä¼šç›´æ¥æ‰¾åˆ°æ ¹è¯ä¹¦ç­¾å‘æœºæ„ï¼Œå¯èƒ½ä¼šå‘ä¸€ä¸ªä¸­çº§è¯ä¹¦ç­¾å‘æœºæ„ç”³è¯·è¯ä¹¦ï¼Œè€Œä»–ä»¬è‡ªå·±çš„è¯ä¹¦åˆé€šè¿‡æ ¹ CA ç­¾å‘ï¼Œè¿™å°±å½¢æˆäº†ä¸€ä¸ªè¯ä¹¦é“¾ï¼Œæµè§ˆå™¨éªŒè¯è¯ä¹¦æœ‰æ•ˆæ€§çš„æ—¶å€™ï¼Œä¹Ÿä¼šæ ¹æ®è¯ä¹¦ä¸­çš„ç­¾å‘è€…ä¿¡æ¯ï¼Œå±‚å±‚ä¸Šæº¯ï¼Œç›´åˆ°æ‰¾åˆ°å—ä¿¡ä»»çš„æ ¹ CA ï¼Œå†ç”¨ç›¸åº”çš„å…¬é’¥å‘ä¸‹å±‚å±‚éªŒè¯ã€‚ä»¥ google ä¸ºä¾‹ï¼Œåœ¨ chrome æµè§ˆå™¨ä¸­æ‰“å¼€ https://www.google.com.hk ï¼Œæ‰“å¼€å¼€å‘è€…å·¥å…·ï¼Œç‚¹å‡» Security æ ‡ç­¾é¡µä¸­çš„ View certificate æŒ‰é’®ï¼Œå°±å¯ä»¥çœ‹åˆ°è¿™ä¸ªç½‘ç«™çš„è¯ä¹¦è¯¦æƒ…ï¼š\nå¯ä»¥çœ‹åˆ°æ¯å±‚è¯ä¹¦çš„è¯¦æƒ…ï¼ŒåŒ…æ‹¬ç­¾å‘è€…ï¼Œæœ‰æ•ˆæœŸï¼Œå…¬é’¥çš„å†…å®¹å’Œç®—æ³•ï¼Œè¯ä¹¦æŒ‡çº¹çš„å†…å®¹å’Œç®—æ³•ç­‰ã€‚\nè¿™é‡Œæœ‰ä¸€ä¸ªé€šè¿‡ OpenSSL è‡ªå»º CA å¹¶é¢å‘è¯ä¹¦çš„è„šæœ¬ï¼šhttps://github.com/owntracks/tools/raw/master/TLS/generate-CA.shã€‚\n5. å‚è€ƒ # æ•°å­—ç­¾åæ˜¯ä»€ä¹ˆï¼Ÿ SSL/TLS åè®®è¿è¡Œæœºåˆ¶è¯¦è§£ SSL/TLSåŸç†è¯¦è§£ ","date":"2017 May 16","permalink":"/posts/2017/05/16/","section":"Posts","summary":"1. RSA åŠ å¯†ç®—æ³• #RSA æ˜¯ä¸€ç§éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼ŒåŒæ—¶ç”Ÿæˆä¸€å¯¹å¯†é’¥ï¼Œåˆ†ä¸ºå…¬é’¥å’Œç§é’¥ï¼Œå®ƒæœ‰å‡ ä¸ªé‡è¦çš„ç‰¹ç‚¹ï¼š","title":"RSA åŠ å¯†ç®—æ³•ä¸æ•°å­—è¯ä¹¦"},{"content":"0. å‡†å¤‡ # Raspberry Pi 3 Model B 32GB Class10 TF å¡ï¼ˆå®˜æ–¹æ¨è 8GB ä»¥ä¸Šï¼‰å’Œè¯»å¡å™¨ 5V2A USB ç”µæºï¼Œæ¯”å¦‚ iPad ç”µæºé€‚é…å™¨ microUSB ç”µæºçº¿ HDMI æ•°æ®çº¿ æ˜¾ç¤ºå™¨ USB é”®ç›˜ 1. å®‰è£…ç³»ç»Ÿ #ä¸‹è½½ Raspbian jessie lite ï¼š2017-04-10-raspbian-jessie-lite.img ï¼Œè¿™æ˜¯ä¸€ä¸ªå®˜æ–¹æ”¯æŒçš„ç²¾ç®€ç³»ç»Ÿï¼ŒåŸºäº Debian å¼€å‘ï¼Œåªæœ‰æ–‡æœ¬ç•Œé¢ã€‚\nå°† TF å¡æ’å…¥ MacBook ï¼Œåœ¨ç»ˆç«¯é‡Œç”¨ df å‘½ä»¤å¯ä»¥çœ‹åˆ° TF å¡å·²ç»è¢«æŒ‚è½½ï¼š\n[22:16]~/ â¯ df Filesystem 512-blocks Used Available Capacity iused ifree %iused Mounted on /dev/disk1 487830528 299357448 187961080 62% 1687373 4293279906 0% / devfs 377 377 0 100% 654 0 100% /dev map -hosts 0 0 0 100% 0 0 100% /net map auto_home 0 0 0 100% 0 0 100% /home /dev/disk3s1 60612608 226616 60385992 1% 76 4294967203 0% /Volumes/Pi ç„¶åå¸è½½ï¼š\n[22:39]~/ â¯ diskutil unmount /dev/disk3s1 Volume Pi on disk3s1 unmounted ä½¿ç”¨ dd å‘½ä»¤å°†ç³»ç»Ÿé•œåƒå†™å…¥:\n[23:43]~/ â¯ sudo dd bs=4m if=2017-04-10-raspbian-jessie-lite.img of=/dev/rdisk3 Password: 309+1 records in 309+1 records out 1297862656 bytes transferred in 112.203648 secs (11567027 bytes/sec) /dev/disk3s1 æ˜¯åˆ†åŒºï¼Œ/dev/disk3 æ˜¯å—è®¾å¤‡ï¼Œ/dev/rdisk3 æ˜¯åŸå§‹å­—ç¬¦è®¾å¤‡\nè¿™æ ·å°±å®‰è£…ç³»ç»Ÿå¥½äº†ï¼Œå†æ¬¡å¸è½½ï¼š\n[23:45]~/ â¯ df Filesystem 512-blocks Used Available Capacity iused ifree %iused Mounted on /dev/disk1 487830528 299358472 187960056 62% 1687450 4293279829 0% / devfs 380 380 0 100% 658 0 100% /dev map -hosts 0 0 0 100% 0 0 100% /net map auto_home 0 0 0 100% 0 0 100% /home /dev/disk3s1 82644 41524 41120 51% 0 0 100% /Volumes/boot [23:49]~/ â¯ diskutil unmount /dev/disk3s1 Volume boot on disk3s1 unmounted 2. ç¬¬ä¸€æ¬¡å¯åŠ¨ #å°† TF å¡æ’å…¥æ ‘è“æ´¾ï¼Œè¿æ¥ç”µæºã€æ˜¾ç¤ºå™¨ã€é”®ç›˜ï¼Œå³å¯å¯åŠ¨ã€‚å¯åŠ¨åè¾“å…¥ç”¨æˆ·å pi ï¼Œå¯†ç  raspberry ã€‚\n2.1. é…ç½®è¯­è¨€ã€æ—¶åŒºå’Œé”®ç›˜å¸ƒå±€ #æ‰§è¡Œ sudo raspi-config ï¼Œè¿›å…¥ 4 Localisation Options ï¼Œå¯¹ç³»ç»Ÿè¿›è¡Œæœ¬åœ°åŒ–é…ç½®ï¼š\nåœ¨ I1 Change Locale ä¸­è®¾ç½®æœ¬åœ°è¯­è¨€ï¼Œå–æ¶ˆ en_GB.UTF-8 UTF-8 ï¼Œé€‰ä¸­ en_US.UTF-8 UTF-8 ã€‚ åœ¨ I2 Change Timezone ä¸­è®¾ç½®æ—¶åŒºä¸º Asia ä¸‹çš„ Shanghai ã€‚ åœ¨ I3 Change Keyboard Layout è®¾ç½®é”®ç›˜å¸ƒå±€ï¼Œä¾æ¬¡é€‰æ‹© Generic 104-key PC \u0026gt; Other \u0026gt; English (US) \u0026gt; English (US) \u0026gt; The default for the keyboard layout \u0026gt; No compose key ã€‚ åœ¨ I4 Change Wi-fi Country ä¸­è®¾ç½®CN China å®Œæˆé…ç½®åï¼Œé€‰æ‹© Finish ï¼Œæ ¹æ®æç¤ºé‡å¯ç³»ç»Ÿï¼Œå¦‚æœæ²¡æœ‰æç¤ºï¼Œå¯ä»¥æ‰§è¡Œ sudo reboot é‡å¯ç³»ç»Ÿã€‚ 2.2. é…ç½® Wi-Fi #æ‰§è¡Œ wpa_passphrase [ssid] [password] å‘½ä»¤å°† Wi-Fi åç§°å’Œå¯†ç å†™å…¥é…ç½®æ–‡ä»¶ï¼š\npi@raspberrypi:~ $ sudo wpa_passphrase TP-Link_30BBB8 12345678 | sudo tee -a /etc/wpa_supplicant/wpa_supplicant.conf é‡å¯ä¸€ä¸‹ç³»ç»Ÿï¼Œå°±å¯ä»¥è¿ä¸Š Wi-Fi äº†ï¼Œä½¿ç”¨ iwconfig å‘½ä»¤æŸ¥çœ‹è¿æ¥æ˜¯å¦æˆåŠŸï¼Œå·²ç»è·å–çš„ IP ï¼š\npi@raspberrypi:~ $ iwconfig wlan0 IEEE 802.11bgn ESSID:\u0026quot;TP-Link_30BBB8\u0026quot; Mode:Managed Frequency:2.412 GHz Access Point: 8C:A6:DF:0C:7A:09 Bit Rate=28.8 Mb/s Tx-Power=31 dBm Retry short limit:7 RTS thr:off Fragment thr:off Power Management:on Link Quality=44/70 Signal level=-66 dBm Rx invalid nwid:0 Rx invalid crypt:0 Rx invalid frag:0 Tx excessive retries:2 Invalid misc:0 Missed beacon:0 lo no wireless extensions. eth0 no wireless extensions. pi@raspberrypi:~ $ ifconfig eth0 Link encap:Ethernet HWaddr b8:27:eb:11:9b:de inet6 addr: fe80::3f3:df2a:426d:ab83/64 Scope:Link UP BROADCAST MULTICAST MTU:1500 Metric:1 RX packets:0 errors:0 dropped:0 overruns:0 frame:0 TX packets:0 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:0 (0.0 B) TX bytes:0 (0.0 B) lo Link encap:Local Loopback inet addr:127.0.0.1 Mask:255.0.0.0 inet6 addr: ::1/128 Scope:Host UP LOOPBACK RUNNING MTU:65536 Metric:1 RX packets:0 errors:0 dropped:0 overruns:0 frame:0 TX packets:0 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1 RX bytes:0 (0.0 B) TX bytes:0 (0.0 B) wlan0 Link encap:Ethernet HWaddr b8:27:eb:44:ce:8b inet addr:192.168.1.103 Bcast:192.168.1.255 Mask:255.255.255.0 inet6 addr: fe80::dba8:37ce:716a:a85/64 Scope:Link UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:4429 errors:0 dropped:34 overruns:0 frame:0 TX packets:160 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:327762 (320.0 KiB) TX bytes:27347 (26.7 KiB) 2.3. å¼€å¯ SSH #ç³»ç»Ÿé»˜è®¤æ²¡æœ‰å¼€å¯ SSH ï¼Œéœ€è¦åœ¨ TF å¡çš„æ ¹ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªç©ºæ–‡ä»¶ SSH ï¼Œè¿™æ ·ç³»ç»Ÿå¯åŠ¨æ—¶å°±ä¼šå¯åŠ¨ SSH ï¼š\npi@raspberrypi:~ $ sudo touch /boot/ssh pi@raspberrypi:~ $ sudo reboot æŸ¥çœ‹ SSH æœåŠ¡æ˜¯å¦å¯åŠ¨ï¼š\npi@raspberrypi:~ $ systemctl status ssh â— ssh.service - OpenBSD Secure Shell server Loaded: loaded (/lib/systemd/system/ssh.service; enabled) Active: active (running) since Mon 2017-04-10 19:16:40 CST; 2min 2s ago Main PID: 697 (sshd) CGroup: /system.slice/ssh.service â””â”€697 /usr/sbin/sshd -D åœ¨ Mac çš„ç»ˆç«¯é‡Œæ‰§è¡Œ ssh pi@192.168.1.103 ç™»å½•æ ‘è“æ´¾ã€‚\nå¯ä»¥å®‰è£…ä¸€ä¸ª lrzsz ï¼Œæ–¹ä¾¿æœåŠ¡å™¨ç«¯ä¸å®¢æˆ·ç«¯çš„æ–‡ä»¶ä¼ è¾“ï¼šsudo apt-get install lrzsz\n2.4. æ›´æ¢æº #ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼š\npi@raspberrypi:~ $ sudo vi /etc/apt/sources.list æ³¨é‡Šæ‰åŸåœ°å€ï¼Œæ·»åŠ é˜¿é‡Œäº‘çš„æºåœ°å€ï¼š\ndeb http://mirrors.aliyun.com/raspbian/raspbian/ wheezy main non-free contrib deb-src http://mirrors.aliyun.com/raspbian/raspbian/ wheezy main non-free contrib ä¿å­˜æ–‡ä»¶åï¼Œæ›´æ–°ç³»ç»Ÿè½¯ä»¶ï¼š\npi@raspberrypi:~ $ sudo apt-get update æ¸…åçš„æºé€Ÿåº¦ä¹Ÿä¸é”™ï¼š\ndeb http://mirrors.tuna.tsinghua.edu.cn/raspbian/raspbian/ jessie main non-free contrib deb-src http://mirrors.tuna.tsinghua.edu.cn/raspbian/raspbian/ jessie main non-free contrib 2.5. æ›¿æ¢ Vim #ç³»ç»ŸåŸè£…çš„ Vim è¶…éš¾ç”¨ï¼Œå…ˆå¸è½½ï¼Œå†æŒ‰ç…§æ–°çš„ï¼š\npi@raspberrypi:~ $ sudo apt-get remove vim-common pi@raspberrypi:~ $ sudo apt-get install vim 2.6. è®¾ç½® SSH è¯ä¹¦ç™»å½• #æš´éœ²åœ¨å¤–å›´çš„å¯†ç ç™»å½•å®¹æ˜“å—åˆ°æ”»å‡»ï¼Œè€Œä¸”æ¯æ¬¡éƒ½è¦è¾“å¯†ç ï¼Œä¸å¤Ÿæ–¹ä¾¿ã€‚çœŸæ­£ç”Ÿäº§ç¯å¢ƒä¸­è¿˜æ˜¯ä½¿ç”¨è¯ä¹¦ç™»å½•ã€‚é…ç½®éœ€è¦å¦‚ä¸‹å‡ ä¸ªæ­¥éª¤ã€‚\nç”Ÿæˆä¸€å¯¹ç§˜é’¥ï¼Œä¸€è·¯å›è½¦é»˜è®¤ç”Ÿæˆid_rsaå’Œid_rsa.pubï¼Œå‰è€…æ˜¯ç§é’¥ï¼Œæ”¾åœ¨å®¢æˆ·ç«¯ï¼Œåè€…æ˜¯å…¬é’¥ï¼Œéœ€è¦æ”¾åœ¨sshæœåŠ¡å™¨ï¼š\npi@raspberrypi:~ $ ssh-keygen -t rsa Generating public/private rsa key pair. Enter file in which to save the key (/home/pi/.ssh/id_rsa): Created directory '/home/pi/.ssh'. Enter passphrase (empty for no passphrase): Enter same passphrase again: Your identification has been saved in /home/pi/.ssh/id_rsa. Your public key has been saved in /home/pi/.ssh/id_rsa.pub. The key fingerprint is: 63:c8:76:52:c1:14:bc:1b:8b:28:b2:02:7d:86:96:8f pi@raspberrypi The key's randomart image is: +---[RSA 2048]----+ | ++. | | o. | | .. | | . oo | | . o .=.S+ | |o * +..+o. | |.+ * | |o E . | |. | +-----------------+ pi@raspberrypi:~ $ cd .ssh/ pi@raspberrypi:~/.ssh $ ls id_rsa id_rsa.pub åœ¨æœåŠ¡å™¨ç«¯å°† id_rsa.pub æ·»åŠ åˆ° authorized_keys ï¼Œç„¶åé…ç½® ssh_config\npi@raspberrypi:~/.ssh $ cat id_rsa.pub \u0026gt;\u0026gt; ~/.ssh/authorized_keys pi@raspberrypi:~ $ vim /etc/ssh/ssh_config RSAAuthentication yes PubkeyAuthentication yes AuthorizedKeysFile %h/.ssh/authorized_keys æŠŠç§é’¥ id_rsa å‘é€åˆ°å®¢æˆ·ç«¯ï¼Œç”±äºæˆ‘æ˜¯ MacOS ï¼Œæ”¾åœ¨ ~/.ssh/ ç›®å½•ä¸‹ï¼Œæ›´åä¸º raspberry_pi ï¼Œåœ¨ ~/.ssh/config æ–‡ä»¶ä¸­æ·»åŠ ä¸€é¡¹é…ç½®ï¼š\nhost pi HostName 192.168.1.103 Port 22 User pi IdentityFile ~/.ssh/raspberry_pi åœ¨å®¢æˆ·ç«¯ä½¿ç”¨ ssh pi å³å¯ç™»å½•æ ‘è“æ´¾ã€‚\n2.7. ç³»ç»Ÿæ—¶é—´ #æ ‘è“æ´¾æ²¡æœ‰å®æ—¶æ—¶é’Ÿï¼Œæ‰€ä»¥æ¯æ¬¡å¯åŠ¨åè¦ç”¨ ntp å¯¹æ—¶ï¼Œå¦åˆ™æ—¶é—´ä¸å‡†ã€‚é»˜è®¤è®¾ç½®çš„ ntp æœåŠ¡å™¨è¿æ¥è¾ƒæ…¢ï¼Œå¯ä»¥æ·»åŠ ä¸€äº›å¢ƒå†…çš„ ntp æœåŠ¡å™¨ã€‚ç¼–è¾‘ /etc/ntp.conf æ–‡ä»¶ï¼Œæ‰¾åˆ°å¦‚ä¸‹ä¸¤è¡Œï¼š\n# You do need to talk to an NTP server or two (or three). #server ntp.your-provider.example åœ¨è¿™è¡Œåé¢æ·»åŠ ï¼š\nserver ntp.fudan.edu.cn iburst server time.asia.apple.com iburst server asia.pool.ntp.org iburst server ntp.nict.jp iburst server time.nist.gov iburst ä¿å­˜åé‡å¯ ntpd ï¼š\npi@raspberrypi:~ $ sudo systemctl restart ntp.service 2.8. é…ç½®ä»¥å¤ªç½‘ #æ ‘è“æ´¾æœ‰ä¸€ä¸ªä»¥å¤ªç½‘å¡ eth0 ï¼Œé»˜è®¤æ˜¯ dhcp æ–¹å¼è‡ªåŠ¨åˆ†é… IP ï¼Œè¦æ”¹æˆé™æ€ IP éœ€è¦ç¼–è¾‘ /etc/network/interfaces æ–‡ä»¶ï¼Œå°† eth0 çš„é…ç½®åˆ é™¤ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š\nauto eth0 iface eth0 inet static address 192.168.5.252 netmask 255.255.255.0 gateway 192.168.5.50 dns-nameservers 192.168.0.99 ä¿å­˜åé‡å¯ network æœåŠ¡ï¼š\npi@raspberrypi:~ $ sudo systemctl restart networking.service 3. ç¡¬ä»¶ç¼–ç¨‹å¼€å‘ #æ ‘è“æ´¾é€šè¿‡ 40 pin æ’é’ˆå¼•å‡º 26 è·¯ GPIO ï¼Œè¾“å‡ºé«˜ç”µå¹³ 3.3V ï¼Œéƒ¨åˆ† GPIO æœ‰å¤ç”¨åŠŸèƒ½ï¼ŒåŒ…æ‹¬ä¸€ä¸ªä¸¤çº¿ I2C ï¼Œä¸€ä¸ªå››çº¿ SPI ï¼Œä¸€ä¸ª UART ï¼Œä¿¡å·å®šä¹‰å¦‚ä¸‹ï¼š\nè¯»å†™ GPIO å¯ä»¥ç”¨ C è¯­è¨€æˆ–è€… Python ï¼Œå®˜æ–¹æ¨èçš„ Python GPIO æ˜¯ä¸€ä¸ªå°å‹ Python åº“ï¼Œä½†æ˜¯ä¸æ”¯æŒ SPI ã€I2C ç­‰ GPIO çš„å¤ç”¨åŠŸèƒ½ï¼Œä½¿ç”¨ C è¯­è¨€å¼€å‘çš„ WiringPi æ›´å—æ¬¢è¿ï¼šhttp://wiringpi.com/ ï¼Œå®ƒæä¾›äº†ä¸€ä¸ª C è¯­è¨€å¼€å‘åº“ï¼Œ API é£æ ¼ç±»ä¼¼ Arduino ï¼Œå¯ä»¥è®¿é—® GPIO ç®¡è„šçš„æ‰€æœ‰åŠŸèƒ½ï¼Œè¿˜æä¾›äº†ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…· gpio ï¼Œå¯ä»¥ç›´æ¥è®¿é—® GPIO ç®¡è„šã€‚\n3.1. ä¸‹è½½å®‰è£… #å…ˆæŒ‰ç…§ git ï¼Œç„¶åé€šè¿‡ git ä¸‹è½½æºç ï¼š\npi@raspberrypi:~ $ sudo apt-get install git pi@raspberrypi:~ $ git clone git://git.drogon.net/wiringPi å®‰è£…ï¼š\npi@raspberrypi:~ $ cd ~/wiringPi pi@raspberrypi:~ $ ./build æµ‹è¯•æ˜¯å¦å®‰è£…æˆåŠŸï¼š\npi@raspberrypi:~/wiringPi $ gpio -v gpio version: 2.44 Copyright (c) 2012-2017 Gordon Henderson This is free software with ABSOLUTELY NO WARRANTY. For details type: gpio -warranty Raspberry Pi Details: Type: Pi 3, Revision: 02, Memory: 1024MB, Maker: Sony * Device tree is enabled. * --\u0026gt; Raspberry Pi 3 Model B Rev 1.2 * This Raspberry Pi supports user-level GPIO access. 3.2. WiringPi çš„ç®¡è„šç¼–ç  #WiringPi çš„ GPIO ç®¡è„šç¼–å·ä¸è¿æ¥å™¨ä¸Šçš„ç¡¬ä»¶ç¡¬ä»¶ç¼–å·å¹¶ä¸ä¸€è‡´ï¼Œè·å–å½“å‰æ ‘è“æ´¾çš„ GPIO ç®¡è„šæè¿°çš„æ–¹æ³•æ˜¯ä½¿ç”¨ gpio å‘½ä»¤ï¼š\npi@raspberrypi:~/wiringPi $ gpio readall +-----+-----+---------+------+---+---Pi 3---+---+------+---------+-----+-----+ | BCM | wPi | Name | Mode | V | Physical | V | Mode | Name | wPi | BCM | +-----+-----+---------+------+---+----++----+---+------+---------+-----+-----+ | | | 3.3v | | | 1 || 2 | | | 5v | | | | 2 | 8 | SDA.1 | IN | 1 | 3 || 4 | | | 5v | | | | 3 | 9 | SCL.1 | IN | 1 | 5 || 6 | | | 0v | | | | 4 | 7 | GPIO. 7 | IN | 1 | 7 || 8 | 0 | IN | TxD | 15 | 14 | | | | 0v | | | 9 || 10 | 1 | IN | RxD | 16 | 15 | | 17 | 0 | GPIO. 0 | IN | 0 | 11 || 12 | 0 | IN | GPIO. 1 | 1 | 18 | | 27 | 2 | GPIO. 2 | IN | 0 | 13 || 14 | | | 0v | | | | 22 | 3 | GPIO. 3 | IN | 0 | 15 || 16 | 0 | IN | GPIO. 4 | 4 | 23 | | | | 3.3v | | | 17 || 18 | 0 | IN | GPIO. 5 | 5 | 24 | | 10 | 12 | MOSI | IN | 0 | 19 || 20 | | | 0v | | | | 9 | 13 | MISO | IN | 0 | 21 || 22 | 0 | IN | GPIO. 6 | 6 | 25 | | 11 | 14 | SCLK | IN | 0 | 23 || 24 | 1 | IN | CE0 | 10 | 8 | | | | 0v | | | 25 || 26 | 1 | IN | CE1 | 11 | 7 | | 0 | 30 | SDA.0 | IN | 1 | 27 || 28 | 1 | IN | SCL.0 | 31 | 1 | | 5 | 21 | GPIO.21 | IN | 1 | 29 || 30 | | | 0v | | | | 6 | 22 | GPIO.22 | IN | 1 | 31 || 32 | 0 | IN | GPIO.26 | 26 | 12 | | 13 | 23 | GPIO.23 | IN | 0 | 33 || 34 | | | 0v | | | | 19 | 24 | GPIO.24 | IN | 0 | 35 || 36 | 0 | IN | GPIO.27 | 27 | 16 | | 26 | 25 | GPIO.25 | IN | 0 | 37 || 38 | 0 | IN | GPIO.28 | 28 | 20 | | | | 0v | | | 39 || 40 | 0 | IN | GPIO.29 | 29 | 21 | +-----+-----+---------+------+---+----++----+---+------+---------+-----+-----+ | BCM | wPi | Name | Mode | V | Physical | V | Mode | Name | wPi | BCM | +-----+-----+---------+------+---+---Pi 3---+---+------+---------+-----+-----+ è¿™ä¸ªå‘½ä»¤ä¼šç”Ÿæˆä¸€å¼ å›¾ç‰‡ï¼Œæè¿°å½“å‰æ ‘è“æ´¾çš„ GPIO è¿æ¥å™¨ç®¡è„šä¸ WiringPi ä¸­çš„ç®¡è„šç¼–å·çš„æ˜ å°„å…³ç³»ï¼Œä¸Šå›¾æ˜¯ Raspberry Pi 3 Model B å‹çš„ã€‚\n3.3. GPIO #WiringPi æä¾›äº†å¤šä¸ªåˆå§‹åŒ–å‡½æ•°ï¼š\nint wiringPiSetup (void) ; int wiringPiSetupGpio (void) ; int wiringPiSetupPhys (void) ; int wiringPiSetupSys (void) ; ç¨‹åºå¼€å§‹çš„æ—¶å€™ï¼Œå¿…é¡»è°ƒç”¨å…¶ä¸­ä¸€ä¸ªï¼Œä¸”éœ€è¦ root æƒé™ã€‚é€šå¸¸è°ƒç”¨ wiringPiSetup(void) å³å¯ï¼Œå®ƒçš„ä½œç”¨æ˜¯åˆå§‹åŒ– WiringPi ç¼–ç¨‹ç¯å¢ƒå’Œ GPIO ç®¡è„šæ˜ å°„ã€‚wiringPiSetupGpio(void) å’Œ wiringPiSetupPhys(void) ä¼šç”¨æ ‘è“æ´¾çš„ GPIO ç¼–å·æˆ–è€…è¿æ¥å™¨ç®¡è„šç¼–å·æ›¿ä»£ WiringPi çš„ç¼–å·ï¼ŒwiringPiSetupSys(void) ä¼šç”¨ /sys/class/gpio æ¥å£æ¥ä»£æ›¿ç›´æ¥è®¿é—®ç¡¬ä»¶ï¼Œä¹Ÿç§°ä¸º sys æ¨¡å¼ï¼Œè¿™ä¸‰ä¸ªå‡½æ•°éƒ½å¾ˆå°‘ä½¿ç”¨ã€‚\nè®¿é—® GPIO ä¸»è¦éœ€è¦å¦‚ä¸‹å‡½æ•°ï¼Œè¿™äº›å‡½æ•°åœ¨ sys æ¨¡å¼ä¸‹éƒ½æ˜¯æ— æ•ˆçš„ï¼š\nvoid pinMode (int pin, int mode) ; è®¾ç½®æŸä¸ªç®¡è„šçš„æ¨¡å¼ä¸º INPUT, OUTPUT, PWM_OUTPUT æˆ–è€… GPIO_CLOCK ã€‚åªæœ‰ wiringPi pin 1 (BCM_GPIO 18) æ”¯æŒ PWM è¾“å‡º ï¼Œåªæœ‰ wiringPi pin 7 (BCM_GPIO 4) æ”¯æŒ CLOCK è¾“å‡ºã€‚\nvoid pullUpDnControl (int pin, int pud) ; è®¾ç½®æŸä¸ªè¾“å…¥ç®¡è„šçš„ä¸Šæ‹‰å’Œä¸‹æ‹‰ç”µé˜»ï¼ŒPUD_OFF è¡¨ç¤ºå…³é—­ä¸Šä¸‹æ‹‰ç”µé˜», PUD_DOWN è¡¨ç¤ºä¸‹æ‹‰åˆ°åœ°ï¼ŒPUD_UP è¡¨ç¤ºä¸Šæ‹‰å€’ 3.3V ï¼Œä¸Šä¸‹æ‹‰ç”µé˜»å¤§çº¦ 50KÎ© ã€‚\nvoid digitalWrite (int pin, int value) ; å‘æŸä¸ªè¾“å‡ºç®¡è„šå†™å€¼ï¼ŒHIGH è¡¨ç¤ºé«˜ç”µå¹³ï¼Œ LOW è¡¨ç¤ºä½ç”µå¹³ã€‚\nint digitalRead (int pin) ; è¯»å–æŸä¸ªè¾“å…¥ç®¡è„šçš„çŠ¶æ€ï¼Œè¿”å› HIGH è¡¨ç¤ºé«˜ç”µå¹³ï¼ŒLOW è¡¨ç¤ºä½ç”µå¹³ã€‚\n3.4. SPI #ç¼–ç¨‹è®¿é—® SPI å‰ï¼Œè¦ç”¨ gpio åŠ è½½ SPI é©±åŠ¨ï¼š\ngpio load spi ç¼–è¾‘ä»£ç æ—¶è¦åŒ…å«å¤´æ–‡ä»¶ï¼š\n#include \u0026lt;wiringPiSPI.h\u0026gt; ç¼–è¯‘æ—¶è¦æ‰‹åŠ¨é“¾æ¥ ï¼š -lwiringPi ã€‚\n3.5. UART #4. æ­å»º NAS æœåŠ¡ #4.1. ç¡¬ä»¶é…ç½® #å‡†å¤‡ä¸€å—ç§»åŠ¨ç¡¬ç›˜ï¼Œå› ä¸ºæ ‘è“æ´¾çš„ USB å£é©±åŠ¨èƒ½åŠ›æœ‰é™ï¼Œæœ€å¥½ç”¨åŒ USB å£æ•°æ®çº¿ï¼Œä¸ºç§»åŠ¨ç¡¬ç›˜ç‹¬ç«‹ä¾›ç”µï¼Œæ ¼å¼åŒ–ä¸º ext4 ï¼Œæˆ‘è¿™é‡Œçš„åˆ†åŒºæ˜¯ sda1 ï¼š\npi@raspberrypi:~ $ sudo fdisk /dev/sda -l Disk /dev/sda: 149.1 GiB, 160041885696 bytes, 312581808 sectors Units: sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 512 bytes / 512 bytes Disklabel type: dos Disk identifier: 0x9fd95492 Device Boot Start End Sectors Size Id Type /dev/sda1 2048 312581807 312579760 149.1G 83 Linux ä¸ºäº†è®©ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨æŒ‚åœ¨ç§»åŠ¨ç¡¬ç›˜ï¼Œéœ€è¦ä¿®æ”¹ /etc/fstab æ–‡ä»¶ï¼Œæ·»åŠ  sda1 çš„é…ç½®ï¼Œè®°å¾—ä¿®æ”¹å‰å…ˆå¤‡ä»½ï¼š\npi@raspberrypi:/etc $ cat fstab proc /proc proc defaults 0 0 PARTUUID=5b2de8de-01 /boot vfat defaults 0 2 PARTUUID=5b2de8de-02 / ext4 defaults,noatime 0 1 /dev/sda1 /home/pi/nas ext4 defaults,noatime 0 0 # a swapfile is not a swap partition, no line here # use dphys-swapfile swap[on|off] for that åˆ›å»ºæŒ‚åœ¨ç›®å½•ï¼š\npi@raspberrypi:~ $ mkdir /home/pi/nas é‡å¯åæŸ¥çœ‹æŒ‚è½½ä¿¡æ¯ï¼š\npi@raspberrypi:~ $ df Filesystem 1K-blocks Used Available Use% Mounted on /dev/root 29787900 1959324 26593012 7% / devtmpfs 469532 0 469532 0% /dev tmpfs 473864 0 473864 0% /dev/shm tmpfs 473864 12260 461604 3% /run tmpfs 5120 4 5116 1% /run/lock tmpfs 473864 0 473864 0% /sys/fs/cgroup /dev/mmcblk0p1 41322 20763 20559 51% /boot /dev/sda1 153705340 60864 145813600 1% /home/pi/nas 4.2. æ–‡ä»¶å…±äº« #Samba å¯ä»¥å®ç°æ ‘è“æ´¾ä¸Šçš„æ–‡ä»¶åœ¨å±€åŸŸç½‘å†…çš„å…±äº«ã€‚å®‰è£…å¿…è¦çš„æ–‡ä»¶ï¼š\npi@raspberrypi:~ $ sudo apt-get install samba samba-common-bin -y å¦‚æœåˆ†åŒºæ˜¯ NTFS æ ¼å¼ï¼Œéœ€è¦å®‰è£… NTFS æ”¯æŒï¼šsudo apt-get install ntfs-3g ã€‚å¦‚æœæ˜¯ exFAT æ ¼å¼ï¼Œåˆ™é€‰ç”¨å®‰è£… exfat-utils ã€‚\nåˆ›å»ºå…±äº«æ–‡ä»¶å¤¹ sharesï¼š\npi@raspberrypi:~ $ sudo mkdir /home/pi/nas/shares ç¼–è¾‘é…ç½®æ–‡ä»¶ /etc/samba/smb.conf ï¼Œæ›¿æ¢æˆå¦‚ä¸‹å†…å®¹ï¼š\n[global] security = user encrypt passwords = true guest account = nobody map to guest = bad user #======================= Share Definitions ======================= [share] comment = Guest access shares path = /home/pi/nas/shares/ browseable = yes writable = yes #read only = yes guest ok = yes public = yes [NAS-Data] comment = Nas data folder path = /home/pi/nas/ browseable = yes writable = yes valid users = root pi éœ€è¦ä¸º samba æ·»åŠ ä¸€ä¸ª pi è´¦æˆ·ï¼š\npi@raspberrypi:~/nas $ sudo smbpasswd -a pi New SMB password: Retype new SMB password: Added user pi. é‡å¯ samba æœåŠ¡ï¼Œç¡®ä¿å¯åŠ¨æˆåŠŸï¼š\npi@raspberrypi:~/nas $ sudo systemctl restart smbd.service pi@raspberrypi:~/nas $ sudo systemctl status smbd.service â— smbd.service - LSB: start Samba SMB/CIFS daemon (smbd) Loaded: loaded (/etc/init.d/smbd) Active: active (running) since Mon 2017-04-10 19:17:04 CST; 2s ago Process: 5272 ExecStop=/etc/init.d/smbd stop (code=exited, status=0/SUCCESS) Process: 5122 ExecReload=/etc/init.d/smbd reload (code=exited, status=0/SUCCESS) Process: 5313 ExecStart=/etc/init.d/smbd start (code=exited, status=0/SUCCESS) CGroup: /system.slice/smbd.service â”œâ”€5324 /usr/sbin/smbd -D â””â”€5329 /usr/sbin/smbd -D Apr 10 19:17:04 raspberrypi smbd[5313]: Starting SMB/CIFS daemon: smbd. Apr 10 19:17:04 raspberrypi systemd[1]: Started LSB: start Samba SMB/CIFS daemon (smbd). Apr 10 19:17:04 raspberrypi smbd[5324]: [2017/04/10 19:17:04.479386, 0] ../lib/util/become_daemon.c:124(daemon_ready) Apr 10 19:17:04 raspberrypi smbd[5324]: STATUS=daemon 'smbd' finished starting up and ready to serve connections åœ¨ MAC ä¸­æ‰“å¼€ Finder \u0026gt; å‰å¾€ \u0026gt; ç½‘ç»œ ï¼Œå°±å¯ä»¥çœ‹åˆ°æ ‘è“æ´¾çš„å…±äº«æ–‡ä»¶å¤¹ï¼Œè®¿é—® share å…±äº«ç›®å½•æ— éœ€å¯†ç ï¼Œè€Œ NAS-Data éœ€è¦å¯†ç éªŒè¯ï¼š\n4.3. FTP æœåŠ¡å™¨ #åœ¨æ ‘è“æ´¾ä¸Šå®‰è£… vsftpd ï¼š\npi@raspberrypi:~ $ sudo apt-get install vsftpd ç¼–è¾‘é…ç½®æ–‡ä»¶ /etc/vsftpd.conf ï¼Œä¿®æ”¹å¦‚ä¸‹é€‰é¡¹ï¼š\n#ç¦æ­¢åŒ¿åè®¿é—® anonymous_enable=NO #è®¾å®šæœ¬åœ°ç”¨æˆ·å¯ä»¥è®¿é—® local_enable=YES #è®¾å®šå¯ä»¥è¿›è¡Œå†™æ“ä½œ write_enable=YES #è®¾å®šä¸Šä¼ åæ–‡ä»¶çš„æƒé™æ©ç  local_umask=022 #è®¾å®šæ ¹ç›®å½• local_root=/home/pi/ ç”¨ ftp å®¢æˆ·ç«¯è½¯ä»¶ç™»å½•ï¼š\n5. ç§»æ¤ UCI #UCI æ˜¯ OpenWRT çš„ä¸€ä¸ªé…ç½®å·¥å…·ï¼Œæä¾› C è¯­è¨€ API å’Œ Shell å‘½ä»¤æ¥å£ï¼Œå¯ä»¥æ–¹ä¾¿çš„è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ã€‚uci çš„ç¼–è¯‘éœ€è¦ CMake ï¼Œå…ˆå®‰è£… CMake ï¼š\npi@raspberrypi:~ $ sudo apt-get install cmake å®‰è£… libluajit-dev ï¼Œå¦åˆ™ä¼šå‡ºç° lauxlib.h: No such file or directory è¿™æ ·çš„é”™è¯¯ :\npi@raspberrypi:~ $ sudo apt-get install libluajit-5.1-dev é€šè¿‡ git ä¸‹è½½ uci çš„æºç åŒ…ï¼š\npi@raspberrypi:~ $ git clone https://github.com/jkjuopperi/uci.git ç”¨ pkg-config æŸ¥è¯¢åˆšæ‰çš„ libluajit-dev çš„å¤´æ–‡ä»¶ç›®å½•ï¼š\npi@raspberrypi:~ $ pkg-config --cflags --libs luajit -I/usr/include/luajit-2.0 -lluajit-5.1 ç„¶åè¿›å…¥ uci ç›®å½•ï¼Œåœ¨ CMakeLists.txt æ–‡ä»¶ä¸­é å‰ä½ç½®æ·»åŠ å¦‚ä¸‹ä¸€è¡Œï¼ŒæŒ‡å®šå¤´æ–‡ä»¶ç›®å½•ï¼Œå¦åˆ™ç¼–è¯‘çš„æ—¶å€™æ‰¾ä¸åˆ°ï¼š\nINCLUDE_DIRECTORIES(\u0026quot;/usr/include/luajit-2.0/\u0026quot;) ä¿å­˜åå¼€å§‹ç¼–è¯‘å®‰è£…ï¼š\npi@raspberrypi:~/uci $ cmake . pi@raspberrypi:~/uci $ make pi@raspberrypi:~/uci $ sudo make install [ 27%] Built target uci-static [ 54%] Built target uci-shared [ 63%] Built target cli [ 72%] Built target cli-static [ 81%] Built target ucimap [ 90%] Built target ucimap-example [100%] Built target uci_lua Install the project... -- Install configuration: \u0026quot;\u0026quot; -- Installing: /usr/local/include/uci.h -- Installing: /usr/local/include/uci_config.h -- Installing: /usr/local/include/ucimap.h -- Installing: /usr/local/lib/libuci.so -- Installing: /usr/local/lib/libuci.a -- Installing: /usr/local/bin/uci -- Set runtime path of \u0026quot;/usr/local/bin/uci\u0026quot; to \u0026quot;\u0026quot; -- Installing: /usr/local/bin/uci-static -- Installing: /usr/local/lib/lua/5.1/uci.so -- Set runtime path of \u0026quot;/usr/local/lib/lua/5.1/uci.so\u0026quot; to \u0026quot;\u0026quot; å®‰è£…åéœ€è¦æ‰§è¡Œä¸€æ¬¡ sudo ldconfig -vï¼Œå¦åˆ™å¯èƒ½æ‰¾ä¸åˆ°æ–°è£…çš„åº“æ–‡ä»¶ï¼Œuci é»˜è®¤å°†é…ç½®æ–‡ä»¶æ”¾åœ¨ /etc/config ç›®å½•ä¸‹ï¼Œæ‰€ä»¥æ–°å»ºè¯¥ç›®å½•ï¼Œæ‰§è¡Œ uci ï¼Œå¦‚ä¸‹è¡¨ç¤ºå®‰è£…æˆåŠŸï¼š\npi@raspberrypi:~/uci $ uci Usage: uci [\u0026lt;options\u0026gt;] \u0026lt;command\u0026gt; [\u0026lt;arguments\u0026gt;] Commands: batch export [\u0026lt;config\u0026gt;] import [\u0026lt;config\u0026gt;] changes [\u0026lt;config\u0026gt;] commit [\u0026lt;config\u0026gt;] add \u0026lt;config\u0026gt; \u0026lt;section-type\u0026gt; add_list \u0026lt;config\u0026gt;.\u0026lt;section\u0026gt;.\u0026lt;option\u0026gt;=\u0026lt;string\u0026gt; show [\u0026lt;config\u0026gt;[.\u0026lt;section\u0026gt;[.\u0026lt;option\u0026gt;]]] get \u0026lt;config\u0026gt;.\u0026lt;section\u0026gt;[.\u0026lt;option\u0026gt;] set \u0026lt;config\u0026gt;.\u0026lt;section\u0026gt;[.\u0026lt;option\u0026gt;]=\u0026lt;value\u0026gt; delete \u0026lt;config\u0026gt;[.\u0026lt;section[.\u0026lt;option\u0026gt;]] rename \u0026lt;config\u0026gt;.\u0026lt;section\u0026gt;[.\u0026lt;option\u0026gt;]=\u0026lt;name\u0026gt; revert \u0026lt;config\u0026gt;[.\u0026lt;section\u0026gt;[.\u0026lt;option\u0026gt;]] reorder \u0026lt;config\u0026gt;.\u0026lt;section\u0026gt;=\u0026lt;position\u0026gt; Options: -c \u0026lt;path\u0026gt; set the search path for config files (default: /etc/config) -d \u0026lt;str\u0026gt; set the delimiter for list values in uci show -f \u0026lt;file\u0026gt; use \u0026lt;file\u0026gt; as input instead of stdin -L do not load any plugins -m when importing, merge data into an existing package -n name unnamed sections on export (default) -N don't name unnamed sections -p \u0026lt;path\u0026gt; add a search path for config change files -P \u0026lt;path\u0026gt; add a search path for config change files and use as default -q quiet mode (don't print error messages) -s force strict mode (stop on parser errors, default) -S disable strict mode -X do not use extended syntax on 'show' 6. Web å¼€å‘ #ä½¿ç”¨ Django + Nginx æ­å»ºä¸€ä¸ªé™æ€ç«™ç‚¹ã€‚\n6.1. å®‰è£… Nginx #å®‰è£… nginx ï¼Œå®‰è£…åä¼šè‡ªåŠ¨å¯åŠ¨ï¼š\npi@raspberrypi:~ $ sudo apt-get install nginx pi@raspberrypi:~ $ systemctl status nginx.service Ã¢â€”Â nginx.service - A high performance web server and a reverse proxy server Loaded: loaded (/lib/systemd/system/nginx.service; enabled) Active: active (running) since Tue 2017-09-26 22:32:43 CST; 16h ago Main PID: 756 (nginx) CGroup: /system.slice/nginx.service Ã¢â€Å“Ã¢â€â‚¬756 nginx: master process /usr/sbin/nginx -g daemon on; master_process on; Ã¢â€Å“Ã¢â€â‚¬757 nginx: worker process Ã¢â€Å“Ã¢â€â‚¬758 nginx: worker process Ã¢â€Å“Ã¢â€â‚¬759 nginx: worker process Ã¢â€â€Ã¢â€â‚¬760 nginx: worker process é€šè¿‡æµè§ˆå™¨è®¿é—®æ ‘è“æ´¾çš„ IP ï¼Œå¯ä»¥å¦‚ä¸‹é¡µé¢ï¼š\n6.2. å®‰è£… Django #å…ˆå®‰è£… pip ï¼š\npi@raspberrypi:~ $ curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py pi@raspberrypi:~ $ sudo python get-pip.py ç„¶åå®‰è£… Django æ¡†æ¶ï¼š\npi@raspberrypi:~ $ sudo pip install django 6.3. å®‰è£… uWSGI #å®‰è£… python-dev ï¼Œå¦åˆ™ä¸‹ä¸€æ­¥å®‰è£… uwsgi ä¼šå¤±è´¥ï¼š\npi@raspberrypi:~ $ sudo apt-get install python-dev å®‰è£… uwsgi ï¼š\npi@raspberrypi:~ $ sudo pip install uwsgi æ–°å»ºä¸€ä¸ª test.py æ–‡ä»¶ï¼Œå†™å…¥å¦‚ä¸‹ä»£ç ï¼š\n# test.py def application(env, start_response): start_response('200 OK', [('Content-Type','text/html')]) return [\u0026quot;Hello uWSGI\u0026quot;] # python2 ä¿å­˜åæ‰§è¡Œï¼š\npi@raspberrypi:~ $ uwsgi --http :8000 --wsgi-file test.py æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® http://localhost_ip:8000 ï¼Œæ˜¾ç¤º Hello uWSGIï¼Œè¯´æ˜ Web client - uWSGI - Python ä¸‰ä¸ªç¯èŠ‚æ˜¯ç•…é€šçš„ï¼š\n","date":"2017 May 9","permalink":"/posts/2017/05/09/","section":"Posts","summary":"0. å‡†å¤‡ # Raspberry Pi 3 Model B 32GB Class10 TF å¡ï¼ˆå®˜æ–¹æ¨è 8GB ä»¥ä¸Šï¼‰å’Œè¯»å¡å™¨ 5V2A USB ç”µæºï¼Œæ¯”å¦‚ iPad ç”µæºé€‚é…å™¨ microUSB ç”µæºçº¿ HDMI æ•°æ®çº¿ æ˜¾ç¤ºå™¨ USB é”®ç›˜ 1.","title":"RaspberryPi 3 ä½¿ç”¨ç¬”è®°"},{"content":"1. ä¸²å£ç®€ä»‹ #è¿™é‡Œçš„ä¸²å£æ˜¯æŒ‡ç¾å›½ç”µå­å·¥ä¸šè”ç›Ÿï¼ˆEIAï¼‰åˆ¶å®šçš„ä¸‰ç§ä¸²è¡Œæ•°æ®é€šä¿¡çš„æ¥å£æ ‡å‡†ï¼Œ RS-232 ã€RS-485 å’Œ RS422 ï¼ŒRS-232 æ˜¯å•ç«¯ä¿¡å·å…¨åŒå·¥ï¼ŒRS-485 æ˜¯å·®åˆ†ä¿¡å·åŠåŒå·¥ï¼ŒRS-422 æ˜¯å·®åˆ†ä¿¡å·å…¨åŒå·¥ã€‚å·®åˆ†ä¿¡å·çš„é€šä¿¡é€Ÿç‡æ›´é«˜ï¼Œé€šä¿¡è·ç¦»æ›´é•¿ï¼ŒRS-232 çš„é€šä¿¡è·ç¦»é€šå¸¸å°äº 15 ç±³ï¼Œè€Œ RS-485 å’Œ RS-422 å¯ä»¥è¾¾åˆ° 100 ç±³ä»¥ä¸Šã€‚\nä»¥ RS-232 ä¸ºä¾‹ï¼Œè®¾è®¡ä¹‹åˆæ˜¯ç”¨æ¥è¿æ¥è°ƒåˆ¶è§£è°ƒå™¨åšä¼ è¾“ä¹‹ç”¨ï¼Œä¹Ÿå› æ­¤å®ƒçš„è„šä½æ„ä¹‰é€šå¸¸ä¹Ÿå’Œè°ƒåˆ¶è§£è°ƒå™¨ä¼ è¾“æœ‰å…³ã€‚RS-232 çš„è®¾å¤‡å¯ä»¥åˆ†ä¸ºæ•°æ®ç»ˆç«¯è®¾å¤‡ï¼ˆDTEï¼ŒData Terminal Equipment, For example, PCï¼‰å’Œæ•°æ®é€šä¿¡è®¾å¤‡ï¼ˆDCEï¼ŒData Communication Equipmentï¼‰ä¸¤ç±»ï¼Œè¿™ç§åˆ†ç±»å®šä¹‰äº†ä¸åŒçš„çº¿è·¯ç”¨æ¥å‘é€å’Œæ¥å—ä¿¡å·ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè®¡ç®—æœºå’Œç»ˆç«¯è®¾å¤‡æœ‰DTEè¿æ¥å™¨ï¼Œè°ƒåˆ¶è§£è°ƒå™¨å’Œæ‰“å°æœºæœ‰DCEè¿æ¥å™¨ã€‚æ ‡å‡†çš„ 232 æ¥å£æœ‰ 25 é’ˆï¼Œä¸è¿‡å¸¸ç”¨çš„æ˜¯ 9 é’ˆçš„ DB-9 æ¥å£ï¼Œä¿¡å·å®šä¹‰å¦‚ä¸‹ï¼š\nè„šä½ ç®€å†™ æ„ä¹‰ è¯´æ˜ Pin1 DCD Carrier Detect è°ƒåˆ¶è§£è°ƒå™¨é€šçŸ¥ç”µè„‘æœ‰è½½æ³¢è¢«ä¾¦æµ‹åˆ°ã€‚ Pin2 RXD Receiver æ¥æ”¶æ•°æ®ã€‚ Pin3 TXD Transmit å‘é€æ•°æ®ã€‚ Pin4 DTR Data Terminal Ready ç”µè„‘å‘Šè¯‰è°ƒåˆ¶è§£è°ƒå™¨å¯ä»¥è¿›è¡Œä¼ è¾“ã€‚ Pin5 GND Ground åœ°çº¿ã€‚ Pin6 DSR Data Set Ready è°ƒåˆ¶è§£è°ƒå™¨å‘Šè¯‰ç”µè„‘ä¸€åˆ‡å‡†å¤‡å°±ç»ªã€‚ Pin7 RTS Request To Send ç”µè„‘è¦æ±‚è°ƒåˆ¶è§£è°ƒå™¨å°†æ•°æ®æäº¤ã€‚ Pin8 CTS Clear To Send è°ƒåˆ¶è§£è°ƒå™¨é€šçŸ¥ç”µè„‘å¯ä»¥ä¼ æ•°æ®è¿‡æ¥ã€‚ Pin9 RI Ring Indicator è°ƒåˆ¶è§£è°ƒå™¨é€šçŸ¥ç”µè„‘æœ‰ç”µè¯è¿›æ¥ã€‚ è¿™ä¸ªä¿¡å·è¯´æ˜æ˜¯ä» DTE è®¾å¤‡çš„è§’åº¦å‡ºå‘çš„ï¼ŒTXDã€DTR å’Œ RTS ä¿¡å·æ˜¯ç”± DTE äº§ç”Ÿçš„ï¼ŒRXDã€DSRã€CTSã€DCD å’Œ RI ä¿¡å·æ˜¯ç”± DCE äº§ç”Ÿçš„ã€‚\nRS-232 åœ¨å‘é€æ•°æ®æ—¶ï¼Œå¹¶ä¸éœ€è¦å¦å¤–ä½¿ç”¨ä¸€æ¡ä¼ è¾“çº¿æ¥å‘é€åŒæ­¥ä¿¡å·ï¼Œå°±èƒ½æ­£ç¡®çš„å°†æ•°æ®é¡ºåˆ©å‘é€åˆ°å¯¹æ–¹ï¼Œå› æ­¤å«åšâ€œå¼‚æ­¥ä¼ è¾“â€ï¼Œç®€ç§°UARTï¼ˆUniversal Asynchronous Receiver Transmitterï¼‰ï¼Œä¸è¿‡å¿…é¡»åœ¨æ¯ä¸€ç¬”æ•°æ®çš„å‰åéƒ½åŠ ä¸ŠåŒæ­¥ä¿¡å·ï¼ŒæŠŠåŒæ­¥ä¿¡å·ä¸æ•°æ®æ··å’Œä¹‹åï¼Œä½¿ç”¨åŒä¸€æ¡ä¼ è¾“çº¿æ¥ä¼ è¾“ã€‚æ¯”å¦‚æ•°æ® 11001010b è¢«ä¼ è¾“æ—¶ï¼Œæ•°æ®çš„å‰åå°±éœ€åŠ å…¥ Start(Lowï¼‰ä»¥åŠ Stopï¼ˆHighï¼‰ç­‰ä¸¤ä¸ªæ¯”ç‰¹ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒStartä¿¡å·å›ºå®šä¸ºä¸€ä¸ªæ¯”ç‰¹ï¼Œä½† Stop åœæ­¢æ¯”ç‰¹åˆ™å¯ä»¥æ˜¯ 1ã€1.5 æˆ–è€…æ˜¯ 2 æ¯”ç‰¹ï¼Œç”±æ”¶å‘åŒæ–¹è‡ªè¡Œé€‰æ‹©ï¼Œä½†å¿…é¡»ä¿æŒä¸€è‡´ã€‚å¸¸è§çš„è®¾ç½®åŒ…æ‹¬æ³¢ç‰¹ç‡ã€æ•°æ®ä½ã€å¥‡å¶æ ¡éªŒã€åœæ­¢ä½å’Œæµæ§åˆ¶ã€‚\næ³¢ç‰¹ç‡ (Baud) è¡¨ç¤ºä¸²å£çš„ä¼ è¾“é€Ÿç‡å«åšæ³¢ç‰¹ç‡ï¼ŒæŒ‡å•ä½æ—¶é—´å†…ä¼ è¾“ç¬¦å·çš„ä¸ªæ•°ï¼Œåœ¨è®¡ç®—æœºä¸Šï¼Œé€šå¸¸ä¸€ä¸ªç¬¦å·å°±æ˜¯ä¸€ä¸ªæ¯”ç‰¹ï¼Œæ‰€æœ‰å¯ä»¥ç†è§£ä¸º bit/s ã€‚å› ä¸º 5 çš„ ASCII ç æ˜¯ 01010101bï¼Œæ‰€ä»¥å¯ä»¥å‘é€è¿™ä¸ªå­—ç¬¦ï¼Œç„¶åç”¨ç¤ºæ³¢å™¨æµ‹é‡å‡ºä¸€ä¸ª bit çš„å‘¨æœŸï¼Œæ¢ç®—å‡ºæ³¢ç‰¹ç‡ã€‚å…¸å‹çš„æ³¢ç‰¹ç‡æ˜¯ 300, 1200, 2400, 9600, 19200, 115200 ç­‰ã€‚ æ•°æ®ä½ (Data) è¡¨ç¤ºä¸€ä¸ªæ•°æ®å¸§ä¸­æ•°æ®æ‰€å çš„é•¿åº¦ï¼Œå¯ä»¥è®¾ç½® 5ã€6ã€7 æˆ–è€… 8 bit ã€‚ å¥‡å¶æ ¡éªŒ (Parity) ç”¨æ¥éªŒè¯æ•°æ®çš„æ­£ç¡®æ€§ï¼Œä¸€èˆ¬ä¸ä½¿ç”¨ï¼Œå¦‚æœä½¿ç”¨ï¼Œé‚£ä¹ˆæ—¢å¯ä»¥åšå¥‡æ ¡éªŒï¼ˆOdd Parityï¼‰ä¹Ÿå¯ä»¥åšå¶æ ¡éªŒï¼ˆEven Parityï¼‰ã€‚å¥‡å¶æ ¡éªŒæ˜¯é€šè¿‡ä¿®æ”¹æ¯ä¸€å‘é€å­—èŠ‚ï¼ˆä¹Ÿå¯ä»¥é™åˆ¶å‘é€çš„å­—èŠ‚ï¼‰æ¥å·¥ä½œçš„ã€‚ åœæ­¢ä½ (Stop)ï¼Œæ˜¯åœ¨æ¯ä¸ªå­—èŠ‚ä¼ è¾“ä¹‹åå‘é€çš„ï¼Œå®ƒç”¨æ¥å¸®åŠ©æ¥å—ä¿¡å·æ–¹ç¡¬ä»¶é‡åŒæ­¥ï¼Œå¯ä»¥è®¾ç½® 1ã€1.5 æˆ–è€…æ˜¯ 2 bit ã€‚ æµæ§åˆ¶ (flow control) ï¼Œå½“éœ€è¦å‘é€æ¡æ‰‹ä¿¡å·æˆ–æ•°æ®å®Œæ•´æ€§æ£€æµ‹æ—¶éœ€è¦åˆ¶å®šå…¶ä»–è®¾ç½®ã€‚å¯ä»¥ä½¿ç”¨ç‰¹å®šçš„ç®¡è„šä¿¡å·ç»„åˆ RTS/CTS å’Œ DTR/DSR ï¼Œè¿™å«ç¡¬ä»¶æµæ§åˆ¶ï¼›æˆ–è€…ä¸ä½¿ç”¨è¿æ¥å™¨ç®¡è„šè€Œåœ¨æ•°æ®æµå†…æ’å…¥ç‰¹æ®Šå­—ç¬¦ XON/XOFF ï¼Œç§°ä¸ºè½¯ä»¶æµæ§åˆ¶ã€‚ RS-232 çš„é€»è¾‘1(mark)çš„ç”µå¹³ä¸º-3ï½-15Vï¼Œé€»è¾‘0(space)çš„ç”µå¹³ä¸º+3ï½+15Vï¼Œæ³¨æ„ç”µå¹³çš„å®šä¹‰åç›¸äº†ä¸€æ¬¡ã€‚ä¸€ä¸ªå…¸å‹çš„æ•°æ®å¸§ï¼š\n2. ä¸²å£æ“ä½œ #Linux ä¸­çš„ä¸²å£è®¾å¤‡æ–‡ä»¶é€šå¸¸æ˜¯ /dev/ttyS0ã€/dev/ttyS1 \u0026hellip; ï¼Œä½¿ç”¨ POSIX ç»ˆç«¯æ§åˆ¶æ¥å£ç¼–ç¨‹ï¼Œä¸²å£æ“ä½œæ‰€éœ€çš„å¤´æ–‡ä»¶ï¼š\n#include \u0026lt;stdio.h\u0026gt; /*æ ‡å‡†è¾“å…¥è¾“å‡ºå®šä¹‰*/ #include \u0026lt;stdlib.h\u0026gt; /*æ ‡å‡†å‡½æ•°åº“å®šä¹‰*/ #include \u0026lt;unistd.h\u0026gt; /*Unix æ ‡å‡†å‡½æ•°å®šä¹‰*/ #include \u0026lt;fcntl.h\u0026gt; /*æ–‡ä»¶æ§åˆ¶å®šä¹‰*/ #include \u0026lt;termios.h\u0026gt; /*POSIX ç»ˆç«¯æ§åˆ¶å®šä¹‰*/ #include \u0026lt;errno.h\u0026gt; /*é”™è¯¯å·å®šä¹‰*/ 2.1. æ‰“å¼€ä¸²å£ #ä¸²å£è®¾å¤‡ä¹Ÿæ˜¯æ–‡ä»¶ï¼Œå¯ä»¥ç”¨ open() å‡½æ•°è®¿é—®ã€‚å¯èƒ½é‡åˆ°çš„é—®é¢˜æ˜¯ Linux ç³»ç»Ÿç¦æ­¢æ™®é€šç”¨æˆ·è®¿é—®è®¾å¤‡æ–‡ä»¶ï¼Œè§£å†³æ–¹æ¡ˆåŒ…æ‹¬ä¿®æ”¹è®¾å¤‡æ–‡ä»¶çš„è®¿é—®æƒé™ï¼Œç”¨ root ç”¨æˆ·è¿è¡Œç¨‹åºï¼Œæˆ–è€…æ”¹å˜ç¨‹åºçš„ owner ã€‚å‡è®¾ä»»ä½•ç”¨æˆ·éƒ½å¯ä»¥è®¿é—®è®¾å¤‡æ–‡ä»¶ï¼Œæ‰“å¼€ä¸²å£çš„ä»£ç å¦‚ä¸‹ï¼š\nint open_port(void) { int fd; /* File descriptor for the port */ fd = open(\u0026quot;/dev/ttyS0\u0026quot;, O_RDWR | O_NOCTTY | O_NDELAY); if (fd == -1) perror(\u0026quot;open_port: Unable to open /dev/ttyS0\u0026quot;); else fcntl(fd, F_SETFL, 0); return (fd); } O_RDWR è¡¨ç¤ºå¯è¯»å¯å†™ï¼›O_NOCTTY è¡¨ç¤ºä¸ä¼šå°†è¿™ä¸ªä¸²å£ä½œä¸ºè¯¥è¿›ç¨‹çš„æ§åˆ¶ç»ˆç«¯ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®è¿™ä¸€é¡¹ï¼Œç¨‹åºä¼šå—åˆ°é”®ç›˜æ§åˆ¶ä¿¡å·çš„å½±å“ï¼›O_NDELAY è¡¨ç¤ºæ— éœ€ç­‰å¾…å¯¹æ–¹ä¸²å£å‡†å¤‡å®Œæ¯•ï¼Œä¹Ÿå°±æ˜¯ä¸ä¼šæ£€æŸ¥ DCD ä¿¡å·ï¼Œå¦åˆ™ä¼šä¸€ç›´ç­‰å¾… DCD ä¿¡å·å˜ä¸º space ã€‚\n2.2. è¯»å†™ä¸²å£ #è°ƒç”¨ write() å‡½æ•°å‘ä¸²å£å†™æ•°æ®å³å¯å®ç°å‘é€ï¼š\nn = write(fd, \u0026quot;ATZ\\r\u0026quot;, 4); wirte() å‡½æ•°è¿”å›æˆåŠŸå‘é€çš„å­—èŠ‚æ•°ï¼Œå¦‚æœå‘é€å¤±è´¥ä¼šè¿”å› -1 ã€‚\nä»ä¸²å£è¯»å–æ•°æ®ç¨æ˜¾å¤æ‚ã€‚å½“ä¸²å£é…ç½®ä¸º raw æ•°æ®æ¨¡å¼ï¼Œå¦‚æœä¸²å£çš„è¾“å…¥ç¼“å­˜åŒºæœ‰æ•°æ®ï¼Œread() å‡½æ•°è°ƒç”¨ä¼šç«‹å³è¯»å–å¹¶è¿”å›ï¼›å¦‚æœè¾“å…¥ç¼“å­˜åŒºæ²¡æœ‰æ•°æ®ï¼Œread() å‡½æ•°å¯èƒ½ä¼šé˜»å¡ï¼Œç­‰å¾…è¶…æ—¶ï¼Œæˆ–è€…è¿”å›é”™è¯¯ã€‚å¯ä»¥å°† read() å‡½æ•°è®¾ä¸ºéé˜»å¡æ¨¡å¼ï¼š\nfcntl(fd, F_SETFL, FNDELAY); è¿™æ ·ï¼Œå¦‚æœæ²¡æœ‰æ”¶åˆ°æ•°æ®ï¼Œread() ä¼šç«‹å³è¿”å› 0 ã€‚ä¹Ÿå¯ä»¥æ”¹å›é˜»å¡æ¨¡å¼ï¼š\nfcntl(fd, F_SETFL, 0); 2.3. å…³é—­ä¸²å£ #è°ƒç”¨ close() å‡½æ•°å…³é—­ä¸²å£ï¼š\nclose(fd); 2.4. ä¸€ä¸ªç®€å•çš„ä¸²å£æ”¶å‘ç¨‹åº #send.c ï¼Œå‘é€ä¸€ä¸ªå­—ç¬¦ä¸² â€œHello Worldâ€ã€‚\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; #include \u0026lt;string.h\u0026gt; #include \u0026lt;fcntl.h\u0026gt; #include \u0026lt;unistd.h\u0026gt; int main(int argc,char **argv) { int fd = 0; int ret = 0; char *device = \u0026quot;/dev/ttyS0\u0026quot;; char send_buf[20] = \u0026quot;Hello World\u0026quot;; int send_size = 0; fd = open(device,O_RDWR | O_NOCTTY | O_NDELAY ); //æ‰“å¼€ ttyS0ï¼Œé»˜è®¤ä¸ºé˜»å¡æ–¹å¼ if (fd == -1) perror(\u0026quot;open_port: Unable to open /dev/ttyS0\u0026quot;); else fcntl(fd, F_SETFL, 0);\tsend_size = strlen(send_buf); ret = write(fd,send_buf,send_size+1); //å°†å­—ç¬¦ä¸²ç»“å°¾çš„ \\0 ä¹Ÿå‘é€ if(ret \u0026lt; send_size) { printf(\u0026quot;write error\\n\u0026quot;); return -2; } printf(\u0026quot;Send %d characters\\n\u0026quot;,ret); write(fd,\u0026quot;\\n\u0026quot;,1); //æœ€åå‘é€ä¸€ä¸ªæ¢è¡Œç¬¦ close(fd);\treturn 0; } recv.c ï¼Œæ¥æ”¶å­—ç¬¦ä¸²ï¼Œread å‡½æ•°é‡åˆ°å›è½¦æˆ–æ¢è¡Œç¬¦æ‰ä¼šè¿”å›ã€‚\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; #include \u0026lt;string.h\u0026gt; #include \u0026lt;fcntl.h\u0026gt; #include \u0026lt;unistd.h\u0026gt; int main(int argc,char **argv) { int fd = 0; int ret = 0; char *device = \u0026quot;/dev/ttyS1\u0026quot;; char recv_buf[20]; int recv_size = 0; fd = open(device,O_RDWR | O_NOCTTY | O_NDELAY ); //æ‰“å¼€ ttyS1ï¼Œé»˜è®¤ä¸ºé˜»å¡æ–¹å¼ if (fd == -1) perror(\u0026quot;open_port: Unable to open /dev/ttyS1\u0026quot;); else fcntl(fd, F_SETFL, 0); recv_size = 20; ret = read(fd,recv_buf,recv_size); //é˜»å¡çš„è¯»å–æ•°æ® if(ret \u0026lt; 0) { perror(\u0026quot;read error\u0026quot;); return -2; } printf(\u0026quot;Receive %d character: %s\\n\u0026quot;,ret,recv_buf); close(fd); return 0; } Makefile ï¼š\nall:send recv send:send.c gcc -Wall -o $@ $\u0026lt; recv:recv.c gcc -Wall -o $@ $\u0026lt; clean: rm -rf send rm -rf recv è¿æ¥ ttyS0 å’Œ ttyS1 ï¼Œé¦–å…ˆæ‰§è¡Œ recv ï¼Œå› ä¸ºæ˜¯é˜»å¡æ–¹å¼ï¼Œrecv ä¼šä¸€ç›´ç­‰å¾…æ•°æ®ã€‚ç„¶ååœ¨å¦ä¸€ä¸ªç»ˆç«¯æ‰§è¡Œ send ï¼Œæ¥æ”¶å‡½æ•°å°±ä¼šæ˜¾ç¤ºæ¥æ”¶åˆ°çš„å­—ç¬¦ä¸²ã€‚\n3. ä¸²å£é…ç½® #é…ç½®ä¸²å£æ¶‰åŠåˆ°ä¸€ä¸ªç»“æ„å’Œä¸¤ä¸ªå‡½æ•°ï¼Œéœ€è¦åŒ…å«å¤´æ–‡ä»¶ termios.h :\n#include \u0026lt;termios.h\u0026gt; #define NCCS 32 struct termios { tcflag_t c_cflag; //æ§åˆ¶é€‰é¡¹ tcflag_t c_iflag; //è¾“å…¥é€‰é¡¹ tcflag_t c_oflag; //è¾“å‡ºé€‰é¡¹ tcflag_t c_lflag; //æœ¬åœ°é€‰é¡¹ cc_t c_line; cc_t c_cc[NCCS]; //æ§åˆ¶å­—ç¬¦ speed_t c_ispeed; //è¾“å…¥é€Ÿç‡ speed_t c_ospeed; //è¾“å‡ºé€Ÿç‡ }; int tcgetattr(int fd, struct termios *termios_p); //è·å–å½“å‰é…ç½®ï¼Œå¹¶ä¿å­˜åˆ° termios_p ä¸­ int tcsetattr(int fd, int option, const struct termios *termios_p); //å°† termios_p å†™å…¥é…ç½® tcsetattr() å‡½æ•°çš„ option å‚æ•°å¯ä»¥é€‰æ‹©ä¸‰ä¸ªå¸¸é‡ï¼š\nTCSANOW\tç«‹å³å†™å…¥é…ç½®ï¼Œæ— éœ€ç­‰å¾…æ•°æ®ä¼ è¾“å®Œæˆ TCSADRAIN\tç­‰å¾…æ•°æ®ä¼ è¾“ç»“æŸåå†æ›´æ”¹é…ç½® TCSAFLUSH\tåˆ·æ–°è¾“å…¥è¾“å‡ºç¼“å­˜ï¼Œç„¶åå†æ›´æ”¹é…ç½® 3.1. æ§åˆ¶é€‰é¡¹ #c_cflag æˆå‘˜ç”¨äºè®¾ç½®æ³¢ç‰¹ç‡ã€æ•°æ®ä½ã€æ ¡éªŒä½ã€åœæ­¢ä½å’Œç¡¬ä»¶æµæ§åˆ¶ï¼Œä¸‹é¢æ˜¯å¸¸ç”¨çš„å®ï¼Œä½äº bits/termios.h å¤´æ–‡ä»¶ã€‚\nCBAUD\tæ³¢ç‰¹ç‡çš„ä½æ©ç  B4800\t4800 baud B9600\t9600 baud B115200\t115,200 baud EXTA\tExternal rate clock EXTB\tExternal rate clock CSIZE\tæ•°æ®ä½çš„ä½æ©ç  CS5\t5 data bits CS6\t6 data bits CS7\t7 data bits CS8\t8 data bits CSTOPB\t2 stop bits (1 otherwise) CREAD\tä½¿èƒ½æ¥æ”¶ PARENB\tä½¿èƒ½æ ¡éªŒä½ï¼Œé»˜è®¤ä¸ºå¶æ ¡éªŒ PARODD\tè®¾ä¸ºå¥‡æ ¡éªŒ HUPCL\tHangup (drop DTR) on last close CLOCAL\tLocal line - do not change \u0026ldquo;owner\u0026rdquo; of port LOBLK\tBlock job control output CNEW_RTSCTS/CRTSCTS\tä½¿èƒ½ç¡¬ä»¶æµæ§åˆ¶ (æŸäº›å¹³å°ä¸æ”¯æŒ) åœ¨ä¼ ç»Ÿçš„POSIXç¼–ç¨‹ä¸­ï¼Œå½“ä¸è¿æ¥ä¸€ä¸ªæœ¬åœ°çš„ï¼ˆé€šè¿‡è°ƒåˆ¶è§£è°ƒå™¨ï¼‰æˆ–è€…è¿œç¨‹çš„ç»ˆç«¯ï¼ˆé€šè¿‡è°ƒåˆ¶è§£è°ƒå™¨ï¼‰æ—¶ï¼Œè¿™é‡Œæœ‰ä¸¤ä¸ªé€‰é¡¹åº”å½“ä¸€ç›´æ‰“å¼€ï¼Œä¸€ä¸ªæ˜¯ CLOCAL ï¼Œå¦ä¸€ä¸ªæ˜¯ CREAD ã€‚è¿™ä¸¤ä¸ªé€‰é¡¹å¯ä»¥ä¿è¯ä½ çš„ç¨‹åºä¸ä¼šå˜æˆç«¯å£çš„æ‰€æœ‰è€…ï¼Œè€Œç«¯å£æ‰€æœ‰è€…å¿…é¡»å»å¤„ç†å‘æ•£æ€§ä½œä¸šæ§åˆ¶å’ŒæŒ‚æ–­ä¿¡å·ï¼ŒåŒæ—¶è¿˜ä¿è¯äº†ä¸²è¡Œæ¥å£é©±åŠ¨ä¼šè¯»å–è¿‡æ¥çš„æ•°æ®å­—èŠ‚ã€‚\nä¸‹é¢ä¸€æ®µä»£ç å°†è®¾ç½®ä¸²å£ä¸º 9600 8N1 ï¼š\nstruct termios options; tcgetattr(fd,\u0026amp;options); options.c_cflag |= (CLOCAL|CREAD); options.c_cflag \u0026amp;= ~CBAUD; options.c_cflag |= B9600; options.c_cflag \u0026amp;= ~CSIZE; options.c_cflag |= CS8; options.c_cflag \u0026amp;= ~PARENB; options.c_cflag \u0026amp;= ~CSTOPB; tcsetattr(fd,TCSANOW,\u0026amp;options); æœ¬åœ°æ¨¡å¼\nc_lflag ç”¨äºæ§åˆ¶ä¸²å£é©±åŠ¨æ€æ ·æ§åˆ¶æ¥æ”¶å­—ç¬¦ã€‚å¸¸ç”¨çš„é€‰é¡¹ç”¨å¦‚ä¸‹å‡ ä¸ªã€‚\nICANON\nç”¨äºè®¾ç½®æ¥æ”¶å­—ç¬¦çš„å¤„ç†æ¨¡å¼ï¼Œå¦‚æœè®¾ç½®äº† ICANON æ ‡å¿—ï¼Œå°±å¯åŠ¨äº†æ ‡å‡†è¡Œè¾“å…¥æ¨¡å¼ï¼Œæ¥æ”¶çš„å­—ç¬¦ä¼šè¢«æ”¾å…¥ä¸€ä¸ªç¼“å†²ä¹‹ä¸­ï¼Œè¿™æ ·å¯ä»¥ç”¨äº¤äº’æ–¹å¼ç¼–è¾‘ç¼“å†²çš„å†…å®¹ï¼Œç›´åˆ°æ”¶åˆ°CR(carriage return)æˆ–è€…LF(line feed)å­—ç¬¦ã€‚è¿›å…¥è¯¥æ¨¡å¼æ—¶ï¼Œé€šå¸¸éœ€è¦å°† ECHO å’Œ ECHOE é€‰é¡¹æ‰“å¼€ï¼š\noptions.c_lflag |= (ICANON | ECHO | ECHOE); å¦‚æœæ¸…é™¤äº† ICANON ï¼Œå°±å¯åŠ¨äº†éæ ‡å‡†æ¨¡å¼ã€‚è¾“å…¥å­—ç¬¦åªæ˜¯è¢«åŸå°ä¸åŠ¨çš„æ¥æ”¶ã€‚è¿›å…¥è¯¥æ¨¡å¼æ—¶ï¼Œé€šå¸¸è¦å…³é—­ ECHO ã€ECHOE å’Œ ISIG é€‰é¡¹ï¼š\noptions.c_lflag \u0026amp;= ~(ICANON | ECHO | ECHOE | ISIG); ECHO\nä½¿èƒ½è¾“å…¥å­—ç¬¦å›æ˜¾ã€‚è®¾ç½®è¯¥æ ‡è¯†åï¼Œæ¥æ”¶åˆ°å­—ç¬¦åä¼šè‡ªåŠ¨å°†å­—ç¬¦è¿”å›åˆ°å‘é€ç«¯ã€‚\nä¸‹é¢çš„ç¨‹åºä¸­ï¼Œä¸ºæ¥æ”¶ç«¯çš„ä¸²å£è®¾ç½®äº†è¯¥æ ‡è¯†ï¼Œå‘é€ç«¯ write ä¹‹åç«‹å³ read ï¼Œå¯ä»¥è¯»åˆ°å›æ˜¾çš„å­—ç¬¦ï¼Œå›æ˜¾çš„å­—ç¬¦ä¸­æœ‰ä¸€ä¸ª ^@ ï¼Œè¡¨ç¤ºå­—ç¬¦ä¸²ç»“å°¾çš„ç©ºå­—ç¬¦ï¼Œè¿™æ˜¯å› ä¸ºè®¾ç½®äº† ECHOCTL æ ‡è¯†ï¼Œä»¥ ^char çš„æ–¹å¼å›æ˜¾æ§åˆ¶å­—ç¬¦ã€‚\nsend.cï¼š\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; #include \u0026lt;string.h\u0026gt; #include \u0026lt;fcntl.h\u0026gt; #include \u0026lt;unistd.h\u0026gt; #include \u0026lt;termios.h\u0026gt; int main(int argc,char **argv) { int fd = 0; int ret = 0; char *device = argv[1]; char send_buf[20] = \u0026quot;0123456789\u0026quot;; int send_size = 0; fd = open(device,O_RDWR | O_NOCTTY ); if(fd\u0026lt;=0) { printf(\u0026quot;open device error\\n\u0026quot;); return -1; } send_size = strlen(send_buf); ret = write(fd,send_buf,send_size+1); if(ret \u0026lt; send_size) { printf(\u0026quot;write error\\n\u0026quot;); return -2; } printf(\u0026quot;Send %d characters\\n\u0026quot;,ret); write(fd,\u0026quot;\\n\u0026quot;,1); //è¯»å–å›æ˜¾çš„å­—ç¬¦ ret = 0; memset(send_buf,0x00,20); ret = read(fd,send_buf,20); if(ret \u0026gt; 0) { printf(\u0026quot;ret = %d\\n\u0026quot;,ret); printf(\u0026quot;%s\\n\u0026quot;,send_buf); }\tclose(fd); return 0; } read.cï¼š\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; #include \u0026lt;string.h\u0026gt; #include \u0026lt;fcntl.h\u0026gt; #include \u0026lt;unistd.h\u0026gt; #include \u0026lt;termios.h\u0026gt; int main(int argc,char **argv) { int fd = 0; int ret = 0; char *device = argv[1]; char recv_buf[20]; int recv_size = 0; struct termios options;\tfd = open(device,O_RDWR | O_NOCTTY ); if(fd\u0026lt;=0) { printf(\u0026quot;open device error\\n\u0026quot;); return -1; } tcgetattr(fd,\u0026amp;options); options.c_lflag |= ICANON; options.c_lflag |= ECHO | ECHOCTL; tcsetattr(fd,TCSANOW,\u0026amp;options); recv_size = 12; ret = read(fd,recv_buf,recv_size); if(ret \u0026lt; 0) { perror(\u0026quot;read error\u0026quot;); return -2; } printf(\u0026quot;Receive %d character: %s\\n\u0026quot;,ret,recv_buf); close(fd); return 0; } è¿æ¥ ttyS0 å’Œ ttyS1 ï¼Œåœ¨ç¬¬ä¸€ä¸ªç»ˆç«¯æ‰§è¡Œ ./read /dev/ttyS0ï¼Œåœ¨ç¬¬äºŒä¸ªç»ˆç«¯æ‰§è¡Œ ./send /dev/ttyS1 å¯ä»¥çœ‹åˆ°å¦‚ä¸‹ç»“æœï¼š\nSend 11 characters ret = 13 0123456789^@ å¦‚æœæ¸…é™¤ ECHOCTL æ ‡è¯†ï¼Œæ‰§è¡Œçš„ç»“æœå¦‚ä¸‹ï¼š\nSend 11 characters ret = 12 0123456789 **æ³¨æ„ï¼Œ**å¦‚æœé€šè®¯åŒæ–¹éƒ½è®¾ç½®äº† ECHO æ ‡è¯†ï¼Œå¯èƒ½ä¼šé™·å…¥äº’ç›¸å›æ˜¾çš„æ­»å¾ªç¯ã€‚\nå…¶ä»–é€‰é¡¹\nISIG\tä½¿èƒ½ SIGINTR, SIGSUSP, SIGDSUSP, å’Œ SIGQUIT ä¿¡å· XCASE\tMap uppercase \\lowercase (obsolete) ECHOE\tEcho erase character as BS-SP-BS ECHOK\tæ¥æ”¶åˆ° kill å­—ç¬¦åå›æ˜¾ä¸€ä¸ªæ¢è¡Œç¬¦ã€‚ ECHONL\tå›æ˜¾æ¢è¡Œç¬¦(0x0A) NOFLSH\tDisable flushing of input buffers after interrupt or quit characters IEXTEN\tEnable extended functions ECHOPRT\tEcho erased character as character erased ECHOKE\tBS-SP-BS entire line on line kill FLUSHO\tOutput being flushed PENDIN\tRetype pending input at next read or input char TOSTOP\tSend SIGTTOU for background output è¾“å…¥æ¨¡å¼\nc_iflag ç”¨äºæ§åˆ¶æ¥æ”¶çš„æ•°æ®åœ¨ä¼ é€’ç»™ç¨‹åºä¹‹å‰çš„å¤„ç†æ–¹å¼ã€‚\nä½¿èƒ½å¥‡å¶æ ¡éªŒ\nå¦‚æœåœ¨ c_cflag ä¸­è®¾ç½®äº†å¥‡å¶æ ¡éªŒä½ï¼Œå°±è¦åœ¨è¿™é‡Œä½¿èƒ½å¥‡å¶æ ¡éªŒï¼š\noptions.c_iflag |= (INPCK | ISTRIP); INPCK è¡¨ç¤ºä½¿èƒ½å¥‡å¶æ ¡éªŒï¼ŒISTRIP è¡¨ç¤ºå°†æ•°æ®ä¸­çš„å¥‡å¶æ ¡éªŒä½å‰¥ç¦»ã€‚\nä½¿èƒ½è½¯ä»¶æµæ§åˆ¶\nè½¯ä»¶æµæ§åˆ¶å¯ä»¥é€šè¿‡IXONï¼ŒIXOFFå’ŒIXANYå¸¸é‡è®¾ç½®æˆæœ‰æ•ˆï¼š\noptions.c_iflag |= (IXON | IXOFF | IXANY); XON(start data)å’ŒXOFF(stop data)å­—ç¬¦åœ¨c_ccæ•°ç»„ä¸­å®šä¹‰ï¼Œå…³äºè½¯ä»¶æµæ§åˆ¶çš„è¯¦ç»†å†…å®¹åœ¨åé¢ä»‹ç»ã€‚\nå…¶ä»–é€‰é¡¹\nIGNPAR\tIgnore parity errors PARMRK\tMark parity errors IXON\tEnable software flow control (outgoing) IXOFF\tEnable software flow control (incoming) IXANY\tAllow any character to start flow again IGNBRK\tIgnore break condition BRKINT\tSend a SIGINT when a break condition is detected INLCR\tMap NL to CR IGNCR\tIgnore CR ICRNL\tMap CR to NL IUCLC\tMap uppercase to lowercase IMAXBEL\tEcho BEL on input line too long è¾“å‡ºæ¨¡å¼\nc_oflag ç”¨äºæ§åˆ¶ç”±ç¨‹åºå‘é€çš„æ•°æ®åœ¨ä¼ é€’ç»™ä¸²å£æˆ–å±å¹•ä¹‹å‰åšæ€æ ·çš„å¤„ç†ã€‚å¾ˆå¤šå¤„ç†æ–¹å¼å’Œè¾“å…¥æ¨¡å¼æ˜¯ç›¸å¯¹ã€‚\nè¦ä½¿ç”¨è¾“å‡ºæ¨¡å¼å¿…é¡»è®¾ç½® OPOST æ ‡è¯†ï¼Œå¦åˆ™å…¶ä»–æ ‡è¯†éƒ½ä¼šè¢«å¿½ç•¥ï¼Œæ•°æ®ä¼šä»¥åŸå§‹å½¢å¼å‘é€ã€‚\noptions.c_oflag |= OPOST; OPOST\tPostprocess output (not set = raw output) OLCUC\tMap lowercase to uppercase ONLCR\tMap NL to CR-NL OCRNL\tMap CR to NL NOCR\tNo CR output at column 0 ONLRET\tNL performs CR function OFILL\tUse fill characters for delay OFDEL\tFill character is DEL NLDLY\tMask for delay time needed between lines NL0\tNo delay for NLs NL1\tDelay further output after newline for 100 milliseconds CRDLY\tMask for delay time needed to return carriage to left column CR0\tNo delay for CRs CR1\tDelay after CRs depending on current column position CR2\tDelay 100 milliseconds after sending CRs CR3\tDelay 150 milliseconds after sending CRs TABDLY\tMask for delay time needed after TABs TAB0\tNo delay for TABs TAB1\tDelay after TABs depending on current column position TAB2\tDelay 100 milliseconds after sending TABs TAB3\tExpand TAB characters to spaces BSDLY\tMask for delay time needed after BSs BS0\tNo delay for BSs BS1\tDelay 50 milliseconds after sending BSs VTDLY\tMask for delay time needed after VTs VT0\tNo delay for VTs VT1\tDelay 2 seconds after sending VTs FFDLY\tMask for delay time needed after FFs FF0\tNo delay for FFs FF1\tDelay 2 seconds after sending FFs æ§åˆ¶å­—ç¬¦\næ§åˆ¶å­—ç¬¦éƒ½æ˜¯ä¸€äº›å­—ç¬¦ç»„åˆï¼Œä¾‹å¦‚ Ctrl+C ã€‚å½“ç”¨æˆ·é”®å…¥è¿™äº›ç»„åˆé”®æ—¶ï¼Œç»ˆç«¯ä¼šé‡‡å–ä¸€äº›ç‰¹æ®Šçš„å¤„ç†æ–¹å¼ã€‚termios ç»“æ„ä¸­çš„ c_cc æ•°ç»„æˆå‘˜å°†æ§åˆ¶å­—ç¬¦æ˜ å°„åˆ°å¯¹äºçš„æ”¯æŒå‡½æ•°ã€‚æ§åˆ¶å­—ç¬¦çš„ä½ç½®ç”¨ä¸€ä¸ªå®å®šä¹‰ï¼ˆå³æ•°ç»„ä¸‹æ ‡ï¼‰ã€‚\nc_cc ä¸­çš„æ§åˆ¶å­—ç¬¦çš„æ•°ç»„ä¸‹æ ‡ï¼š\nå¸¸é‡é”®å­—ç¬¦æè¿° VINTRCTRL-C VQUITCTRL-Z VERASEBackspase VKILLCTRL-U VEOFCTRL-D VEOLCTRL-D VSTARTCTRL-Q VSTOPCTRL-S VTIME VMIN VTIME å’Œ VMIN\nåªæœ‰åœ¨éæ ‡å‡†è¾“å…¥æ¨¡å¼æˆ–è€…æ²¡æœ‰é€šè¿‡open(2)å’Œfcntl(2)å‡½æ•°ä¼ é€’NDELAYé€‰é¡¹æ—¶ï¼Œè¿™ä¸¤ä¸ªå€¼æ‰æœ‰æ•ˆã€‚äºŒè€…ç»“åˆèµ·æ¥æ§åˆ¶å¯¹è¾“å…¥çš„è¯»å–ã€‚\n4. æµæ§åˆ¶ #5. UARTã€RS-232 ä¸ TTL #é€»è¾‘1(mark)çš„ç”µå¹³ä¸º-3ï½-15Vï¼Œé€»è¾‘0(space)çš„ç”µå¹³ä¸º+3ï½+15Vï¼Œæ³¨æ„ç”µå¹³çš„å®šä¹‰åç›¸äº†ä¸€æ¬¡ã€‚\nå‚è€ƒ #The Serial Programming Guide for POSIX Operating Systems\n","date":"2017 March 27","permalink":"/posts/2017/03/27/","section":"Posts","summary":"1. ä¸²å£ç®€ä»‹ #è¿™é‡Œçš„ä¸²å£æ˜¯æŒ‡ç¾å›½ç”µå­å·¥ä¸šè”ç›Ÿï¼ˆEIAï¼‰åˆ¶å®šçš„ä¸‰ç§ä¸²è¡Œæ•°æ®é€šä¿¡çš„æ¥å£æ ‡å‡†ï¼Œ RS-232 ã€RS-485 å’Œ RS422 ï¼ŒRS-232 æ˜¯å•ç«¯ä¿¡å·å…¨åŒå·¥ï¼ŒRS-485 æ˜¯å·®åˆ†ä¿¡å·åŠåŒå·¥ï¼ŒRS-422 æ˜¯å·®åˆ†ä¿¡å·å…¨åŒå·¥ã€‚å·®åˆ†ä¿¡å·çš„é€šä¿¡é€Ÿç‡æ›´é«˜ï¼Œé€šä¿¡è·ç¦»æ›´é•¿ï¼ŒRS-232 çš„é€šä¿¡è·ç¦»é€šå¸¸å°äº 15 ç±³ï¼Œè€Œ RS-485 å’Œ RS-422 å¯ä»¥è¾¾åˆ° 100 ç±³ä»¥ä¸Šã€‚","title":"Linux ä¸²å£ç¼–ç¨‹ç¬”è®°"},{"content":"Zmodem æ˜¯è·¨å¹³å°çš„æ–‡ä»¶ä¼ è¾“åè®®ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„åœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿä¹‹é—´æ¥ä¼ è¾“æ–‡ä»¶ã€‚lzrsz æ˜¯è¯¥åè®®çš„å®ç°æ–¹å¼ï¼šhttps://ohse.de/uwe/software/lrzsz.html ã€‚å®‰è£…åï¼Œåœ¨ Mac çš„ ITerm2 ä¸­ç”¨ SSH ç™»é™†è¿œç¨‹çš„ Linux ä¸»æœºï¼Œç„¶åç”¨ rz ã€sz å‘½ä»¤ä¼ è¾“æ–‡ä»¶ã€‚\nåœ¨ Ubuntu ä¸­å®‰è£…:\n$ sudo apt-get install lrzsz åœ¨ Mac ä¸­å®‰è£…ï¼š\n$ brew install lrzsz ä¸ºæ–¹ä¾¿ ITerm2 ä¸­ä½¿ç”¨ï¼Œéœ€è¦ä¸‹è½½ä¸¤ä¸ªè„šæœ¬ï¼š\ncd /usr/local/bin sudo wget https://raw.github.com/mmastrac/iterm2-zmodem/master/iterm2-send-zmodem.sh sudo wget https://raw.github.com/mmastrac/iterm2-zmodem/master/iterm2-recv-zmodem.sh sudo chmod 777 /usr/local/bin/iterm2-* ç„¶åæ‰“å¼€ ITerm2 ï¼Œç‚¹å‡» preferences \u0026gt; profiles ï¼Œé€‰ä¸­ Default ï¼Œåœ¨å³ä¾§çš„ Advanced æ ‡ç­¾é¡µä¸­ï¼Œç‚¹å‡» Tirggers æ¡†çš„ Edit æŒ‰é’®ï¼ŒæŒ‰å¦‚ä¸‹è®¾ç½®æ·»åŠ ä¸¤ä¸ªæ¡ç›®ï¼š\nRegular expression Action Parameters Instant rz waiting to receive.**B0100 Run Silent Coprocess /usr/local/bin/iterm2-send-zmodem.sh checked **B00000000000000 Run Silent Coprocess /usr/local/bin/iterm2-recv-zmodem.sh checked å‘è¿œç¨‹ Linux ä¸»æœºå‘é€æ–‡ä»¶ï¼š\nåœ¨ Ubuntu ä¸Šæ‰§è¡Œ rc åœ¨å¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­é€‰ä¸­è¦å‘é€çš„æ–‡ä»¶ ç­‰å¾…å‘é€å®Œæˆ æ¥æ”¶è¿œç¨‹ Linux å‘æ¥çš„æ–‡ä»¶ï¼š\nåœ¨ Ubuntu ä¸Šæ‰§è¡Œ sz filename1 filename2 ... åœ¨å¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­é€‰ä¸­æ¥æ”¶æ–‡ä»¶çš„ç›®å½• ç­‰å¾…æ¥æ”¶å®Œæˆã€‚ iterm2-send-zmodem.sh å†…å®¹ï¼š\n#!/bin/bash # Author: Matt Mastracci (matthew@mastracci.com) # AppleScript from http://stackoverflow.com/questions/4309087/cancel-button-on-osascript-in-a-bash-script # licensed under cc-wiki with attribution required # Remainder of script public domain osascript -e 'tell application \u0026quot;iTerm2\u0026quot; to version' \u0026gt; /dev/null 2\u0026gt;\u0026amp;1 \u0026amp;\u0026amp; NAME=iTerm2 || NAME=iTerm if [[ $NAME = \u0026quot;iTerm\u0026quot; ]]; then FILE=`osascript -e 'tell application \u0026quot;iTerm\u0026quot; to activate' -e 'tell application \u0026quot;iTerm\u0026quot; to set thefile to choose file with prompt \u0026quot;Choose a file to send\u0026quot;' -e \u0026quot;do shell script (\\\u0026quot;echo \\\u0026quot;\u0026amp;(quoted form of POSIX path of thefile as Unicode text)\u0026amp;\\\u0026quot;\\\u0026quot;)\u0026quot;` else FILE=`osascript -e 'tell application \u0026quot;iTerm2\u0026quot; to activate' -e 'tell application \u0026quot;iTerm2\u0026quot; to set thefile to choose file with prompt \u0026quot;Choose a file to send\u0026quot;' -e \u0026quot;do shell script (\\\u0026quot;echo \\\u0026quot;\u0026amp;(quoted form of POSIX path of thefile as Unicode text)\u0026amp;\\\u0026quot;\\\u0026quot;)\u0026quot;` fi if [[ $FILE = \u0026quot;\u0026quot; ]]; then echo Cancelled. # Send ZModem cancel echo -e \\\\x18\\\\x18\\\\x18\\\\x18\\\\x18 sleep 1 echo echo \\# Cancelled transfer else /usr/local/bin/sz \u0026quot;$FILE\u0026quot; -e -b sleep 1 echo echo \\# Received $FILE fi iterm2-recv-zmodem.sh å†…å®¹ï¼š\n#!/bin/bash # Author: Matt Mastracci (matthew@mastracci.com) # AppleScript from http://stackoverflow.com/questions/4309087/cancel-button-on-osascript-in-a-bash-script # licensed under cc-wiki with attribution required # Remainder of script public domain osascript -e 'tell application \u0026quot;iTerm2\u0026quot; to version' \u0026gt; /dev/null 2\u0026gt;\u0026amp;1 \u0026amp;\u0026amp; NAME=iTerm2 || NAME=iTerm if [[ $NAME = \u0026quot;iTerm\u0026quot; ]]; then FILE=`osascript -e 'tell application \u0026quot;iTerm\u0026quot; to activate' -e 'tell application \u0026quot;iTerm\u0026quot; to set thefile to choose folder with prompt \u0026quot;Choose a folder to place received files in\u0026quot;' -e \u0026quot;do shell script (\\\u0026quot;echo \\\u0026quot;\u0026amp;(quoted form of POSIX path of thefile as Unicode text)\u0026amp;\\\u0026quot;\\\u0026quot;)\u0026quot;` else FILE=`osascript -e 'tell application \u0026quot;iTerm2\u0026quot; to activate' -e 'tell application \u0026quot;iTerm2\u0026quot; to set thefile to choose folder with prompt \u0026quot;Choose a folder to place received files in\u0026quot;' -e \u0026quot;do shell script (\\\u0026quot;echo \\\u0026quot;\u0026amp;(quoted form of POSIX path of thefile as Unicode text)\u0026amp;\\\u0026quot;\\\u0026quot;)\u0026quot;` fi if [[ $FILE = \u0026quot;\u0026quot; ]]; then echo Cancelled. # Send ZModem cancel echo -e \\\\x18\\\\x18\\\\x18\\\\x18\\\\x18 sleep 1 echo echo \\# Cancelled transfer else cd \u0026quot;$FILE\u0026quot; /usr/local/bin/rz -E -e -b sleep 1 echo echo echo \\# Sent \\-\\\u0026gt; $FILE fi ","date":"2017 January 10","permalink":"/posts/2017/01/10/","section":"Posts","summary":"Zmodem æ˜¯è·¨å¹³å°çš„æ–‡ä»¶ä¼ è¾“åè®®ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„åœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿä¹‹é—´æ¥ä¼ è¾“æ–‡ä»¶ã€‚lzrsz æ˜¯è¯¥åè®®çš„å®ç°æ–¹å¼ï¼šhttps://ohse.","title":"åœ¨ ITerm2 ä¸­ä½¿ç”¨ Zmodem åè®®ä¼ è¾“æ–‡ä»¶"},{"content":"0. Package Control #ç”¨äºä¸‹è½½ã€ç®¡ç†æ’ä»¶çš„æ’ä»¶ï¼Œå®‰è£…æ–¹æ³•è§é¡¹ç›®ä¸»é¡µã€‚æœ‰æ—¶å®‰è£…åä¼šå‡ºç° â€œThere are no packages available for installationâ€ è¿™æ ·çš„é”™è¯¯ï¼Œè¿™æ˜¯å› ä¸ºæ— æ³•ä¸‹è½½æ’ä»¶èµ„æºåˆ—è¡¨æ–‡ä»¶ã€‚è§£å†³æ–¹æ³•æ˜¯åœ¨èœå•æ ä¸­é€‰æ‹© Preferences \u0026gt; Package Settings \u0026gt; Package Control \u0026gt; Settings-User ï¼Œåœ¨æ‰“å¼€çš„é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ï¼š\n\u0026quot;channels\u0026quot;: [ \u0026quot;https://gist.githubusercontent.com/stanwu/679f8af0c9a43f800974/raw/5e3561bfb8b3ddc92680052c89e73c7dabc92f94/channel_v3.json\u0026quot;, \u0026quot;https://web.archive.org/web/20150905194312/https://packagecontrol.io/channel_v3.json\u0026quot; ], 1. Predawn #ä¸€æ¬¾ä¸ºSublimeå’ŒAtomæ‰“é€ çš„æš—è‰²ä¸»é¢˜ï¼Œå¯ä»¥å®šä¹‰Tabçš„å¤§å°ï¼ŒSideBarå¤§å°ï¼ŒFindæ å¤§å°ï¼Œå¹¶æä¾›ä¸»é¢˜åŒæ¬¾çš„ICONã€‚\nå®‰è£…åé‡å¯ Sublime Text ï¼Œé€šè¿‡èœå•æ  Preferences -\u0026gt; Settings æ‰“å¼€ç”¨æˆ·é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ ï¼š\n\u0026quot;theme\u0026quot;: \u0026quot;predawn-DEV.sublime-theme\u0026quot;, //è½¯ä»¶ UI ä¸»é¢˜ \u0026quot;color_scheme\u0026quot;: \u0026quot;Packages/Predawn/predawn.tmTheme\u0026quot;, //ç¼–è¾‘å™¨é…è‰² \u0026quot;font_size\u0026quot;: 15, \u0026quot;predawn_findreplace_small\u0026quot;: true, //æŸ¥æ‰¾å¯¹è¯æ¡†è®¾ä¸ºæœ€å° \u0026quot;predawn_sidebar_small\u0026quot;: true, //ä¾§è¾¹æ è®¾ä¸ºæœ€å° \u0026quot;predawn_tabs_active_underline\u0026quot;: true, //ä½¿èƒ½å½“å‰æ ‡ç­¾é¡µé«˜äº® \u0026quot;predawn_tabs_small\u0026quot;: true, //æ ‡ç­¾é¡µè®¾ä¸ºæœ€å° æ›´å¤šé€‰é¡¹å¯ä»¥åœ¨é¡¹ç›®ä¸»é¡µæŸ¥çœ‹ã€‚\n2. SideBarFolder #æ‰“å¼€çš„æ–‡ä»¶å¤¹éƒ½å¤ªå¤šäº†ï¼Œå¯ä»¥ç”¨è¿™ä¸ªæ¥ç®¡ç†ï¼Œå®‰è£…åä¼šåœ¨èœå•æ å¤šä¸€ä¸ª Folders ã€‚\n3. SideBarEnhancements #æ‰©å±•å³é”®é€‰é¡¹ï¼š\n4. SublimeAStyleFormatter #ç®€å•å¥½ç”¨çš„ä»£ç æ ¼å¼åŒ–å·¥å…·ã€‚å®‰è£…åï¼Œå¯¹æ–‡ä»¶ç‚¹å‡»é¼ æ ‡å³é”®ï¼Œä¼šå‡ºç°æ ¼å¼åŒ–é€‰é¡¹ï¼Œå¯ä»¥å…¨æ–‡ä»¶æ ¼å¼åŒ–ï¼Œä¹Ÿå¯ä»¥å¯¹é€‰ä¸­çš„æ–‡æœ¬æ ¼å¼åŒ–ï¼š\nä¹Ÿå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®å¿«æ·é”®ï¼Œæœ€å¥½æ‰“å¼€ä¿å­˜æ—¶è‡ªåŠ¨æ ¼å¼åŒ–ï¼š\n// Auto format on file save \u0026quot;autoformat_on_save\u0026quot;: true, 5. Terminal #åœ¨å½“å‰æ–‡ä»¶å¤¹å†…æ‰“å¼€ Terminal ã€‚å®‰è£…åï¼Œå¯¹æ–‡ä»¶æˆ–è€…ç›®å½•ç‚¹é¼ æ ‡å³é”®ï¼Œä¼šå‡ºç° Open Terminal Here\u0026hellip; ï¼š\nå¿…é¡»åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®æ‰“å¼€ Terminal çš„å‘½ä»¤ï¼Œå¯¹äºåœ¨ Mac OS ä¸­çš„ iTerm2 æ‰“å¼€æ–°çš„æ ‡ç­¾é¡µï¼Œå¯ä»¥è¿™æ ·è®¾ç½®ï¼š\n\u0026quot;terminal\u0026quot;: \u0026quot;iTerm.sh\u0026quot;, \u0026quot;parameters\u0026quot;: [\u0026quot;--open-in-tab\u0026quot;] å¯¹äº iTerm2 V3 ï¼š\n\u0026quot;terminal\u0026quot;: \u0026quot;iTerm2-v3.sh\u0026quot; 6. Alignment #é€‰ä¸­åæŒ‰ command+control+a å°±å¯ä»¥ä½¿å…¶æŒ‰ç…§ç­‰å·å¯¹å…¶:\n7. C Improved #C è¯­è¨€è¯­æ³•é«˜äº®æ’ä»¶ã€‚å®‰è£…åæ‰“å¼€ä¸€ä¸ª C æºæ–‡ä»¶ï¼Œåœ¨èœå•æ ä¸­é€‰ä¸­ C Improved ï¼š\n8. Ctags #å¯»æ‰¾å‡½æ•°å’Œå˜é‡çš„å®šä¹‰ã€‚å®‰è£…æ’ä»¶åè¿˜è¦åœ¨ç³»ç»Ÿä¸­å®‰è£… Ctags ï¼š\nbrew install ctags é»˜è®¤å®‰è£…åœ¨ /usr/local/bin/ctags ã€‚åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ å‘½ä»¤è·¯å¾„å’Œå‚æ•°ï¼š\n\u0026quot;command\u0026quot;: \u0026quot;/usr/local/bin/ctags -R\u0026quot;, ç„¶ååœ¨å¯¹æºç ç›®å½•å³é”®é€‰æ‹© Rebuild Tags ï¼Œç”Ÿæˆç´¢å¼•æ–‡ä»¶ï¼š\nä¹‹åå†å‡½æ•°ä¸Šæ‚¬åœé¼ æ ‡ï¼Œå°±ä¼šå‡ºç°è¯¥å‡½æ•°å®šä¹‰çš„ä½ç½®ï¼Œç‚¹å‡»å¯è¿›å…¥ï¼š\næˆ–è€…å³é”®é€‰æ‹© Navigate to Definition :\nJump Back å¯ä»¥è·³å›è°ƒç”¨å¤„ã€‚é»˜è®¤å¿«æ·é”®æ˜¯ control+shift+å·¦é”® è·³è½¬åˆ°å®šä¹‰å¤„ï¼Œcontrol+shift+å³é”® è·³å›æ¥ã€‚\n9. made-of-code-themes #Markdown è¯­æ³•é«˜äº®é…è‰²ã€‚ä¸‹è½½åè§£å‹åˆ°åŒ…ç›®å½•ä¸‹ï¼Œç„¶åæ‰“å¼€ä¸€ä¸ª Markdown æ–‡ä»¶ï¼Œåœ¨èœå•ä¸­é€‰æ‹©è¯­æ³•é…ç½®ï¼š\nåœ¨æ‰“å¼€çš„ Markdown é…ç½®æ–‡ä»¶ä¸­æ·»åŠ è¯¥é…è‰²æ–‡ä»¶çš„è·¯å¾„ï¼š\n10. OmniMarkupPreviewer #å®æ—¶é¢„è§ˆ Markdown æ–‡ä»¶ã€‚å¯¹ Markdown æ–‡ä»¶å³é”®å°±ä¼šå‡ºç°åœ¨æµè§ˆå™¨ä¸­é¢„è§ˆã€å¯¼å‡º HTML æ–‡ä»¶ç­‰é€‰é¡¹ï¼š\nå¿«æ·é”®ï¼š\ncommand+option+O: Preview Markup in Browser. command+option+X: Export Markup as HTML. command+option+C: Copy Markup as HTML. 11. FileHeader #è‡ªåŠ¨ä¸ºæºç æ–‡ä»¶ç”Ÿæˆå¤´éƒ¨æ³¨é‡Šã€‚å¯ä»¥è‡ªå®šä¹‰æ³¨é‡Šå†…å®¹ï¼Œè‡ªåŠ¨è¯†åˆ«å„ç§è¯­è¨€çš„æ–‡ä»¶ã€‚\n12. Pretty JSON #æ ¼å¼åŒ– JSON ï¼Œç”¨æ³•æ˜¯é€‰ä¸­ JSON æ ¼å¼çš„æ–‡æœ¬ï¼Œç„¶åæŒ‰å¿«æ·é”®æ˜¯ cmd+ctrl+jï¼Œä¹Ÿå¯ä»¥ç›´æ¥æŒ‰å¿«æ·é”®å¯¹å…¨æ–‡ä»¶æ ¼å¼åŒ–ã€‚\n13. HTML-CSS-JS prettify #å¯ä»¥æ ¼å¼åŒ– HTMLã€CSS å’Œ JS æ–‡æœ¬ã€‚å®‰è£…åï¼Œé€‰ä¸­éœ€è¦æ ¼å¼åŒ–çš„æ–‡æœ¬ï¼ŒæŒ‰å¿«æ·é”® cmd+shift+h å³å¯å®Œæˆæ ¼å¼åŒ–ã€‚\nå‚è€ƒ # Sublime Textï¼šå­¦ä¹ èµ„æºç¯‡ï¼šhttp://www.jianshu.com/p/d1b9a64e2e37 ","date":"2017 January 7","permalink":"/posts/2017/01/07/","section":"Posts","summary":"0. Package Control #ç”¨äºä¸‹è½½ã€ç®¡ç†æ’ä»¶çš„æ’ä»¶ï¼Œå®‰è£…æ–¹æ³•è§é¡¹ç›®ä¸»é¡µã€‚æœ‰æ—¶å®‰è£…åä¼šå‡ºç° â€œThere are no packages available for installationâ€ è¿™æ ·çš„é”™è¯¯ï¼Œè¿™æ˜¯å› ä¸ºæ— æ³•ä¸‹è½½æ’ä»¶èµ„æºåˆ—è¡¨æ–‡ä»¶ã€‚è§£å†³æ–¹æ³•æ˜¯åœ¨èœå•æ ä¸­é€‰æ‹© Preferences \u0026gt; Package Settings \u0026gt; Package Control \u0026gt; Settings-User ï¼Œåœ¨æ‰“å¼€çš„é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ï¼š","title":"Sublime Text 3 å¸¸ç”¨æ’ä»¶"},{"content":"Markdown è¯­æ³•è§£å†³äº†æ–‡æœ¬ç¼–è¾‘æ—¶ï¼Œå†…å®¹ä¸æ ·å¼åˆ†ç¦»çš„é—®é¢˜ï¼Œè®©æˆ‘ä»¬æ›´ä¸“æ³¨äºå†…å®¹ï¼Œå°‘åœ¨æ’ç‰ˆä¸Šæµªè´¹æ—¶é—´ã€‚\nCmd Markdown è¿™æ¬¾ç¼–è¾‘å™¨æ‰©å±•äº† Markdown è¯­æ³•ï¼Œå®ç°äº†å¾ˆå¤šå®ç”¨çš„åŠŸèƒ½ï¼š\nå®æ—¶åŒæ­¥é¢„è§ˆ ç¼–ç¨‹è¯­è¨€é«˜äº®ï¼Œæ˜¾ç¤ºè¡Œå· æ”¯æŒç»˜åˆ¶è¡¨æ ¼ã€æµç¨‹å›¾ã€ç”˜ç‰¹å›¾ æ”¯æŒ LaTeX å…¬å¼ æ”¯æŒæ®µè½æ‰¹æ³¨ æ”¯æŒ Vim ç¼–è¾‘æ¨¡å¼ å¯å¯¼å‡º Html å’Œ PDF æ–‡ä»¶ æ”¯æŒäº‘ç«¯åŒæ­¥å­˜å‚¨ æä¾› Linuxã€Windowsã€Mac æ¡Œé¢ç«¯ç¼–è¾‘å™¨å’Œ Web ç«¯ç¼–è¾‘å™¨ ","date":"2016 December 24","permalink":"/posts/2016/12/24/","section":"Posts","summary":"Markdown è¯­æ³•è§£å†³äº†æ–‡æœ¬ç¼–è¾‘æ—¶ï¼Œå†…å®¹ä¸æ ·å¼åˆ†ç¦»çš„é—®é¢˜ï¼Œè®©æˆ‘ä»¬æ›´ä¸“æ³¨äºå†…å®¹ï¼Œå°‘åœ¨æ’ç‰ˆä¸Šæµªè´¹æ—¶é—´ã€‚","title":"æ¨èä¸€æ¬¾ Markdown ç¼–è¾‘å™¨"},{"content":"è¿™é‡Œçš„æ— çº¿ï¼ˆWirelessï¼‰æŒ‡æ— çº¿å±€åŸŸç½‘ï¼Œå®ƒçš„é€šç”¨æ ‡å‡†æ˜¯ IEEE 802.11 åè®®ï¼Œå®šä¹‰äº†æ•°æ®é“¾è·¯å±‚ï¼ˆMACå±‚ï¼‰å’Œç‰©ç†å±‚åè®®ï¼Œå·¥ä½œè½½æ³¢çš„é¢‘ç‡ä¸º 2.4GHz ï¼Œåˆ’åˆ†äº† 11 ä¸ªé¢‘é“ï¼Œæœ€æ–°çš„åè®®å·²ç»æœ‰ 5GHz çš„å·¥ä½œé¢‘ç‡ã€‚åè®®çš„æ¼”è¿›æ–¹å‘æ˜¯ 802.11a-\u0026gt;802.11b-\u0026gt;802.11g-\u0026gt;802.11n ã€‚\nè€Œ 802.11i æ˜¯ 802.11 çš„æ— çº¿å®‰å…¨åè®®ï¼Œå®ƒçš„æŠ€æœ¯å®ç°æ˜¯ WPA å’Œ WPA2 ï¼Œéƒ½æ˜¯å¼€æ”¾ç§˜é’¥è®¤è¯æ–¹å¼ï¼Œéƒ½å±äº Wi-Fi è”ç›Ÿï¼ŒWPA2 æ˜¯æ¯” WPA æ›´é«˜çº§çš„ä¸€ç§å®‰å…¨æ–¹å¼ï¼ŒRSN æ˜¯ WPA2 çš„åˆ«åã€‚PSK å’Œ 802.1X æ˜¯ä¸¤ç§æ— çº¿å®‰å…¨å®ç°çš„æ–¹å¼ï¼ŒPSK æ˜¯ä¸ªäººçº§åˆ«çš„ï¼Œè€Œ 802.1X æ˜¯ä¼ä¸šçº§åˆ«çš„ï¼Œè¾ƒä¸ºå¤æ‚ï¼Œä½†æ›´å®‰å…¨ã€‚TKIP å’Œ CCMP æ˜¯ä¸¤ç§æ•°æ®åŠ å¯†ç®—æ³•ï¼Œåœ¨ WPA å’Œ WPA2 ä¸­éƒ½å¯ä»¥ä½¿ç”¨ã€‚è€Œ AES æ˜¯ CCMP ç®—æ³•ä¸­çš„æ ¸å¿ƒç®—æ³•ï¼Œä¸”ç›®å‰æ¥çœ‹ï¼Œæ˜¯æœ€å¯é çš„åŠ å¯†ç®—æ³•ã€‚\nWi-Fi æ˜¯ä¸€ä¸ªå‚å•†è”ç›Ÿçš„æ ‡å¿—ï¼Œç›®çš„æ˜¯å»ºç«‹ä¸€ä¸ªç»Ÿä¸€çš„ã€åŸºäº IEEE 802.11 åè®®çš„æŠ€æœ¯å®ç°ã€‚å¯ä»¥ç®€å•æŠŠ Wi-Fi è®¾å¤‡ç†è§£ä¸ºç¬¦åˆ IEEE 802.11 åè®®æ ‡å‡†çš„è®¾å¤‡ã€‚\nLinux ç³»ç»Ÿä¸­çš„æ— çº¿ç½‘å¡é€šå¸¸ç”¨åˆ°ä¸¤ç§æ¨¡å¼ï¼Œä¸€ç§æ˜¯ Station æ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯ä½œä¸ºæ™®é€š Wi-Fi è®¾å¤‡å»è¿æ¥æ— çº¿è·¯ç”±å™¨ï¼›å¦ä¸€ç§æ˜¯ AccessPointï¼ˆAPï¼‰æ¨¡å¼ï¼Œå°±æ˜¯è®©æ— çº¿ç½‘å¡ä½œä¸º Wi-Fi çƒ­ç‚¹ï¼Œä¾›å…¶ä»– Wi-Fi è®¾å¤‡è¿æ¥ï¼Œè¿™éœ€è¦ç”¨åˆ° hostapd ï¼Œå¯ä»¥å‚è€ƒ http://shaocheng.li/post/blog/2016-01-01ï¼Œ è¿™é‡Œä¸»è¦è®² Station æ¨¡å¼ä¸‹æ— çº¿ç½‘å¡çš„æ“ä½œæ–¹å¼ã€‚å…³äºæ— çº¿æ“ä½œæ¨¡å¼ï¼šhttp://shaocheng.li/post/blog/2012-10-27-wireless-oprating-mode ã€‚\n1. ç¡¬ä»¶å’Œé©±åŠ¨ #å¤§éƒ¨åˆ†æ— çº¿ç½‘å¡æ˜¯ pci è®¾å¤‡ï¼Œä»¥ Intel 6205 ä¸ºä¾‹ï¼Œåœ¨ Fedora 21 ä¸­æŸ¥çœ‹ï¼š\n[root@localhost ~]# lspci 00:00.0 Host bridge: Intel Corporation Atom Processor Z36xxx/Z37xxx Series SoC Transaction Register (rev 0c) ... 01:00.0 Network controller: Intel Corporation Centrino Advanced-N 6205 [Taylor Peak] (rev 34) 04:00.0 Ethernet controller: Intel Corporation 82574L Gigabit Network Connection [root@localhost ~]# lspci -vk -s 01:00.0 01:00.0 Network controller: Intel Corporation Centrino Advanced-N 6205 [Taylor Peak] (rev 34) Subsystem: Intel Corporation Centrino Advanced-N 6205 AGN Flags: bus master, fast devsel, latency 0, IRQ 268 Memory at 90700000 (64-bit, non-prefetchable) [size=8K] Capabilities: [c8] Power Management version 3 Capabilities: [d0] MSI: Enable+ Count=1/1 Maskable- 64bit+ Capabilities: [e0] Express Endpoint, MSI 00 Capabilities: [100] Advanced Error Reporting Capabilities: [140] Device Serial Number 10-0b-a9-ff-ff-b4-99-00 Kernel driver in use: iwlwifi Kernel modules: iwlwifi å¯ä»¥çœ‹åˆ°å®ƒä½¿ç”¨çš„é©±åŠ¨æ˜¯ iwlwifi ï¼Œè¿™æ˜¯å½“å‰ Intel æ— çº¿èŠ¯ç‰‡çš„é€šç”¨é©±åŠ¨ï¼Œé’ˆå¯¹ä¸åŒçš„èŠ¯ç‰‡éœ€è¦ä¸åŒçš„å›ºä»¶ï¼Œå›ºä»¶åç§°çš„æ ¼å¼æ˜¯ iwlwifi-*.ucode ï¼Œå­˜æ”¾åœ¨ /lib/firmware/ ç›®å½•ä¸‹ã€‚åœ¨è¿™ä¸ªé¡µé¢å¯ä»¥æŸ¥çœ‹æ”¯æŒçš„èŠ¯ç‰‡å’Œå›ºä»¶ä¸‹è½½åˆ—è¡¨ï¼šhttps://wireless.wiki.kernel.org/en/users/drivers/iwlwifi ã€‚Linux å†…æ ¸å¯¹æ— çº¿è®¾å¤‡çš„æ”¯æŒä¹Ÿæ˜¯åˆ†å±‚çš„ç»“æ„ï¼Œæœ€ä¸Šå±‚é¢å‘ç”¨æˆ·ç©ºé—´çš„æ¥å£æ ‡å‡†æœ‰ä¸¤ä¸ªï¼Œnl80211 å’Œ wext ï¼Œnl80211 æ­£åœ¨é€æ­¥æ›¿ä»£ wext ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ /sys/module/iwlwifi/parameters/ ç›®å½•ä¸‹è¯»å–é©±åŠ¨çš„å„é¡¹å‚æ•°ï¼š\n/sys/module/iwlwifi/parameters# ls -l total 0 -r--r--r-- 1 root root 4096 Nov 29 10:03 11n_disable -r--r--r-- 1 root root 4096 Nov 29 10:03 amsdu_size_8K -r--r--r-- 1 root root 4096 Nov 29 10:03 antenna_coupling -r--r--r-- 1 root root 4096 Nov 29 10:03 bt_coex_active -r--r--r-- 1 root root 4096 Nov 29 10:03 fw_restart -r--r--r-- 1 root root 4096 Nov 29 10:03 led_mode -r--r--r-- 1 root root 4096 Nov 29 10:03 nvm_file -r--r--r-- 1 root root 4096 Nov 29 10:03 power_level -r--r--r-- 1 root root 4096 Nov 29 10:03 power_save -r--r--r-- 1 root root 4096 Nov 29 10:03 swcrypto -r--r--r-- 1 root root 4096 Nov 29 10:03 wd_disable å¦‚æœè¦ä¿®æ”¹æŸä¸ªå‚æ•°ï¼Œéœ€è¦åœ¨ /etc/modprobe.d/ ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª iwlwifi.conf æ–‡ä»¶ï¼Œç„¶åæ·»åŠ é€‰é¡¹ï¼Œæ¯”å¦‚ç¦ç”¨ 11n ï¼š\n/etc/modprobe.d# cat iwlwifi.conf options iwlwifi 11n_disable=1 ä¿®æ”¹åé‡æ–°åŠ è½½é©±åŠ¨ï¼Œæˆ–è€…é‡å¯ï¼Œå°±å¯ä»¥åœ¨ /sys/module/iwlwifi/parameters ç›®å½•ä¸‹éªŒè¯è¯¥é€‰é¡¹æ˜¯å¦å·²ç»è¢«ä¿®æ”¹ï¼š\n/sys/module/iwlwifi/parameters# cat 11n_disable 1 é©±åŠ¨å’Œå›ºä»¶åŠ è½½æˆåŠŸåï¼Œå°±ä¼šå‡ºç°è®¾å¤‡æ–‡ä»¶ï¼š\n[root@localhost ~]# iw dev phy#0 Interface wlp1s0 ifindex 3 wdev 0x1 addr 10:0b:a9:b4:99:00 type managed å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªæ— çº¿è®¾å¤‡çš„åç§°æ˜¯ phy#0 ï¼Œæ¥å£åç§°æ˜¯ wlp1s0 ï¼Œaddr æ®µå°±æ˜¯ mac åœ°å€ï¼Œå½“å‰çš„è®¾å¤‡ç±»å‹æ˜¯ managed ï¼Œä¹Ÿå°±æ˜¯ station æ¨¡å¼ã€‚ç”¨ ifconfig -a ä¹Ÿå¯ä»¥çœ‹åˆ°ã€‚\nå¯ä»¥é€šè¿‡å†…æ ¸ä¿¡æ¯æŸ¥è¯¢å½“å‰åŠ è½½çš„å›ºä»¶ç‰ˆæœ¬ï¼š\n[root@localhost ~]# dmesg | grep iwlwifi [27592.118803] iwlwifi 0000:03:00.0: Direct firmware load for iwlwifi-7265D-19.ucode failed with error -2 [27592.118837] iwlwifi 0000:03:00.0: Direct firmware load for iwlwifi-7265D-18.ucode failed with error -2 [27592.118890] iwlwifi 0000:03:00.0: Direct firmware load for iwlwifi-7265D-17.ucode failed with error -2 [27592.128638] iwlwifi 0000:03:00.0: loaded firmware version 16.242414.0 op_mode iwlmvm 2. iw å·¥å…· #iw æ˜¯ä¸€ä¸ªç®¡ç†æ— çº¿è®¾å¤‡çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œä½¿ç”¨ nl80211 æ¥å£æ ‡å‡†ï¼Œæ”¯æŒæ‰€æœ‰æœ€æ–°è¢«æ·»åŠ åˆ° Linux å†…æ ¸çš„æ— çº¿ç½‘å¡é©±åŠ¨ã€‚æ—§çš„ iwconfig å·¥å…·ä½¿ç”¨ wext æ¥å£æ ‡å‡†ã€‚\nç”¨ iw list å‘½ä»¤å¯ä»¥åˆ—å‡ºå½“å‰ç³»ç»Ÿä¸­æ‰€æœ‰æ— çº¿è®¾å¤‡çš„åŠŸèƒ½ç‰¹æ€§ã€‚å¦‚æœè¦çœ‹æŒ‡å®šç½‘å¡çš„ç‰¹æ€§ï¼Œè¯­æ³•æ˜¯ iw devicename info ï¼š\n[root@localhost ~]# iw phy#0 info Wiphy phy0 max # scan SSIDs: 20 max scan IEs length: 195 bytes Coverage class: 0 (up to 0m) Device supports RSN-IBSS. Supported Ciphers: * WEP40 (00-0f-ac:1) * WEP104 (00-0f-ac:5) * TKIP (00-0f-ac:2) * CCMP (00-0f-ac:4) Available Antennas: TX 0 RX 0 Supported interface modes: * IBSS * managed * AP * AP/VLAN * monitor ... Supported commands: * new_interface * set_interface * new_key * start_ap * new_station * new_mpath ... software interface modes (can always be added): * AP/VLAN * monitor ... Device supports TX status socket option. Device supports HT-IBSS. Device supports scan flush. è¿™ä¸ªä¿¡æ¯å¾ˆé•¿ï¼Œé¦–å…ˆçœ‹åˆ°æœ€å¤šå¯ä»¥æ‰«æ 20 ä¸ªçƒ­ç‚¹ï¼Œæ”¯æŒçš„åŠ å¯†ç®—æ³•æ˜¯ WEP ã€TKIPã€CCMPã€‚åœ¨ Supported interface modes æ®µå¯ä»¥çœ‹åˆ°è¯¥ç½‘å¡æ”¯æŒçš„æ¨¡å¼ï¼ŒåŒ…æ‹¬ AP ï¼Œåœ¨ software interface modes å¯ä»¥çœ‹åˆ°è¯¥ç½‘å¡æ”¯æŒè½¯ AP ã€‚åœ¨ Supported commands æ®µåˆ—å‡ºäº†è¯¥ç½‘å¡æ”¯æŒçš„å‘½ä»¤ï¼Œè¿™äº›éƒ½æ˜¯ nl80211 æ¥å£æä¾›çš„å‘½ä»¤ï¼Œå¯ä»¥åœ¨ Linux å†…æ ¸çš„ nl80211.c æ–‡ä»¶ä¸­çœ‹åˆ°ã€‚\nè¿è¡Œ iw dev wlp1s0 scan å¯ä»¥æ‰«æ Wi-Fi çƒ­ç‚¹ï¼Œå‰é¢˜æ˜¯æ¥å£å·²ç»æ¿€æ´»ï¼Œå¯ä»¥ç”¨ ifconfig wlp1s0 up ï¼Œå¦åˆ™ä¼šå¤±è´¥ï¼š\n[root@localhost ~]# iw dev wlp1s0 scan command failed: Network is down (-100) ä»¥æ‰«æåˆ°çš„ä¸€ä¸ªçƒ­ç‚¹ä¸ºä¾‹ï¼š\nBSS f4:ec:38:30:bb:b8(on wlp1s0) TSF: 2459924068 usec (0d, 00:40:59) freq: 2437 beacon interval: 100 TUs capability: ESS Privacy ShortPreamble ShortSlotTime (0x0431) signal: -51.00 dBm last seen: 1 ms ago SSID: TP-LINK_30BBB8 Supported rates: 1.0* 2.0* 5.5* 11.0* 6.0 9.0 12.0 18.0 DS Parameter set: channel 6 RSN: * Version: 1 * Group cipher: CCMP * Pairwise ciphers: CCMP * Authentication suites: PSK * Capabilities: 1-PTKSA-RC 1-GTKSA-RC (0x0000) WPA: * Version: 1 * Group cipher: CCMP * Pairwise ciphers: CCMP * Authentication suites: PSK ERP: \u0026lt;no flags\u0026gt; ... å¯ä»¥è¯»åˆ°å‡ ä¸ªæœ‰ç”¨çš„ä¿¡æ¯ï¼Œé¦–å…ˆæ˜¯ä¿¡å·å¼ºåº¦ signal:-51.00 dBm ï¼Œçƒ­ç‚¹çš„ SSID æ˜¯ TP-LINK_30BBB8 ï¼Œä½¿ç”¨çš„é¢‘é“æ˜¯ 6 ï¼Œè®¤è¯æ–¹å¼æ˜¯ WPA å’Œ RSN ï¼ˆå³ WPA2ï¼‰ï¼Œç§˜é’¥ç®¡ç†ç®—æ³•æ˜¯ PSK ï¼ŒåŠ å¯†ç®—æ³•æ˜¯ CCMP ã€‚\niw æ”¯æŒæ‰‹åŠ¨è¿æ¥æ— è®¤è¯æˆ–è€… WEP è®¤è¯çš„ Wi-Fi çƒ­ç‚¹ï¼Œè€Œä¸æ”¯æŒ WPA/WPA2 è®¤è¯çƒ­ç‚¹ã€‚å¦‚æœè¦åŠ å…¥æ— è®¤è¯çš„çƒ­ç‚¹ï¼Œæ‰§è¡Œ iw wlp1s0 connect \u0026lt;SSID\u0026gt; ã€‚å¯¹äº WEP è®¤è¯çš„çƒ­ç‚¹ï¼Œæ‰§è¡Œ iw wlp1s0 connect \u0026lt;SSID\u0026gt; [key 0:abcde d:1:6162636465] ã€‚è¿æ¥æˆåŠŸåï¼Œå¯ä»¥è®¾ç½®é™æ€ IP ï¼Œä¹Ÿå¯ä»¥ç”¨ dhclient åŠ¨æ€è·å– IP å’Œ DNS ã€‚æˆ‘ä»¬å¾ˆå°‘ç”¨ iw æ¥è¿æ¥ Wi-Fi ï¼Œé€šå¸¸æ˜¯ç”¨ wpa_supplicant ã€‚\nè¿˜æœ‰ä¸€ä¸ªåœ¨è°ƒè¯•æ—¶æœ‰ç”¨çš„å‘½ä»¤ iw event ï¼Œå®ƒå¯ä»¥ç›‘å¬ Wi-Fi è¿æ¥è¿‡ç¨‹ä¸­çš„æ‰€æœ‰äº‹ä»¶ã€‚å½“å¯åŠ¨ wpa_supplicant å»è¿æ¥ä¸€ä¸ªçƒ­ç‚¹æ—¶ï¼Œå¯ä»¥å¼€å¯è¯¥å‘½ä»¤ï¼Œå®ƒä¼šæ˜¾ç¤ºå®Œæ•´çš„è¿æ¥è¿‡ç¨‹ï¼ŒåŒ…æ‹¬æ‰«æã€åå•†ã€éªŒè¯ã€è¿æ¥ã€‚åŠ ä¸€ä¸ª -f é€‰é¡¹å¯ä»¥æ˜¾ç¤ºè¿æ¥è¿‡ç¨‹å‘é€çš„å¸§ï¼ŒåŠ  -t é€‰é¡¹å¯ä»¥æ˜¾ç¤ºæ¯ä¸ªæ­¥éª¤çš„æ—¶é—´ï¼š\n[root@localhost ~]# iw event -t 1478053617.986731: wlp1s0 (phy #0): scan started 1478053619.947956: wlp1s0 (phy #0): scan finished: 2412 2417 2422 2427 2432 2437 2442 2447 2452 2457 2462 2467 2472 5180 5200 5220 5240 5260 5280 5300 5320 5745 5765 5785 5805 5825, \u0026quot;\u0026quot; 1478053619.977751: wlp1s0: new station f4:ec:38:30:bb:b8 1478053619.988617: wlp1s0 (phy #0): auth f4:ec:38:30:bb:b8 -\u0026gt; 10:0b:a9:b4:99:00 status: 0: Successful 1478053620.043766: wlp1s0 (phy #0): assoc f4:ec:38:30:bb:b8 -\u0026gt; 10:0b:a9:b4:99:00 status: 0: Successful 1478053620.043992: wlp1s0 (phy #0): connected to f4:ec:38:30:bb:b8 æŸ¥çœ‹è¿æ¥çŠ¶æ€ï¼š\n[root@localhost ~]# iw wlp1s0 link Not connected. [root@localhost ~]# iw wlp1s0 link Connected to f4:ec:38:30:bb:b8 (on wlp1s0) SSID: TP-LINK_30BBB8 freq: 2437 RX: 6256 bytes (46 packets) TX: 1435 bytes (15 packets) signal: -59 dBm tx bitrate: 1.0 MBit/s bss flags: short-preamble short-slot-time dtim period: 1 beacon int: 100 SSID å­—æ®µè¡¨ç¤ºå½“å‰è¿æ¥çš„çƒ­ç‚¹åç§°ã€‚signal å­—æ®µè¡¨ç¤ºå½“å‰è¿æ¥çƒ­ç‚¹çš„ä¿¡å·å¼ºåº¦ï¼Œå®ƒæ˜¯ä¸ªè´Ÿæ•°ï¼Œè¶Šæ¥è¿‘ 0 ï¼Œè¡¨ç¤ºä¿¡å·è¶Šå¥½ï¼Œå°äº -113 å°±åŸºæœ¬æ²¡ä¿¡å·äº†ã€‚\næŸ¥çœ‹å½“å‰æ— çº¿è®¾å¤‡çš„ä½¿ç”¨æƒ…å†µï¼ŒåŒ…æ‹¬è¿›å‡ºæµé‡ç­‰ä¿¡æ¯ï¼š\n[root@localhost ~]# iw dev wlp1s0 station dump Station f4:ec:38:30:bb:b8 (on wlp1s0) inactive time: 175 ms rx bytes: 4635 rx packets: 31 tx bytes: 1095 tx packets: 11 tx retries: 49 tx failed: 2 signal: -68 dBm signal avg: -64 dBm tx bitrate: 1.0 MBit/s rx bitrate: 54.0 MBit/s MCS 3 40MHz authorized: yes authenticated: yes preamble: long WMM/WME: yes MFP: no TDLS peer: no iw è¿˜æœ‰å…¶ä»–é€‰é¡¹ï¼Œå¯ä»¥æ‰§è¡Œ iw help æŸ¥çœ‹ã€‚\n3. wpa_supplicant #wpa_supplicant æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå¼çš„ Wi-Fi è®¿é—®å®¢æˆ·ç«¯ç¨‹åºï¼Œæ”¯æŒ WEPã€WPA/WPA2 è®¤è¯æ–¹å¼ï¼Œåœ¨ Linux ä¸­ç”¨äºè‡ªåŠ¨è¿æ¥ Wi-Fi çƒ­ç‚¹ï¼Œæ”¯æŒæ–­çº¿åè‡ªåŠ¨é‡è¿ã€‚åŒæ—¶æ”¯æŒ nl80211 å’Œ wext ä¸¤ç§é©±åŠ¨æ¥å£ã€‚\nå¸¸ç”¨é€‰é¡¹ï¼š\n-B ï¼šè®© wpa_supplicant è¿è¡Œåœ¨åå°ï¼Œåœ¨ -i é€‰é¡¹å‰è®¾ç½®ã€‚ -c filename ï¼šé…ç½®æ–‡ä»¶çš„è·¯å¾„ï¼Œåœ¨ -i é€‰é¡¹å‰è®¾ç½®ã€‚ -D ï¼šè®¾ç½®ä½¿ç”¨çš„é©±åŠ¨ï¼Œå¯é€‰ nl80211 å’Œ wext ç­‰ï¼Œåœ¨ -i é€‰é¡¹å‰è®¾ç½®ã€‚ -i interface ï¼šç›‘å¬çš„æ— çº¿è®¾å¤‡æ¥å£åç§°ï¼Œè¿™é‡Œå¯ä»¥è®¾ä¸º wlp1s0 ã€‚ -d ï¼šå¢åŠ è°ƒè¯•ä¿¡æ¯ï¼Œ-dd å¯ä»¥æ˜¾ç¤ºæ›´å¤šã€‚ -t ï¼šåœ¨è°ƒè¯•ä¿¡æ¯ä¸­åŠ ä¸Šæ—¶é—´æˆ³ã€‚ -f filename ï¼šæ—¥å¿—æ–‡ä»¶çš„è·¯å¾„ã€‚ -P filename ï¼šPID æ–‡ä»¶çš„è·¯å¾„ã€‚ -q ï¼šå‡å°‘è°ƒè¯•ä¿¡æ¯ï¼Œ-qq å¯ä»¥æ˜¾ç¤ºçš„æ›´å°‘ã€‚ -u ï¼šä½¿èƒ½ DBus æ§åˆ¶æ¥å£ã€‚ -N ï¼šå¦‚æœæœ‰å¤šä¸ªæ— çº¿è®¾å¤‡ï¼Œå°±ç”¨ -N åˆ†éš”ï¼Œä¹‹åç»§ç»­è®¾ç½®ä¸‹ä¸€ä¸ªã€‚ä¾‹å¦‚ wpa_supplicant -c wpa1.conf -i wlan0 -D hostap -N -c wpa2.conf -i ath0 -D madwifi é…ç½®æ–‡ä»¶é€šå¸¸æ˜¯ /etc/wpa_supplicant/wpa_supplicant.conf ï¼Œå¯ä»¥åœ¨æ–‡ä»¶å†…è®¾ç½®å¤šä¸ª Wi-Fi çƒ­ç‚¹çš„è¿æ¥ä¿¡æ¯ï¼Œwpa_supplicant å¯åŠ¨åä¼šè‡ªåŠ¨é€‰æ‹©ä¸€ä¸ªæœ€å¥½çš„ç½‘ç»œï¼Œä¾æ®æ˜¯è®¤è¯æ–¹å¼ï¼ˆ WPA/WPA2 ä¼˜å…ˆï¼‰å’Œä¿¡å·å¼ºåº¦ã€‚å¦‚æœå®Œæ•´å®‰è£…äº† wpa_supplicant ï¼Œåœ¨ /usr/share/doc/wpa_supplicant/ ç›®å½•ä¸‹ä¼šæœ‰ä¸€ä¸ª wpa_supplicant.conf æ–‡ä»¶ï¼Œé‡Œé¢æœ‰å„ç§æƒ…å†µçš„è¯¦ç»†é…ç½®å’Œè¯´æ˜ã€‚è¯´å‡ ä¸ªå¸¸ç”¨çš„å…¨å±€é…ç½®é€‰é¡¹ï¼š\nctrl_interface=filename ï¼šè®¾ç½®æ§åˆ¶æ¥å£çš„è·¯å¾„ã€‚å¦‚æœè®¾ç½®äº†è¯¥å‚æ•°ï¼Œwpa_supplicant ä¼šæ‰“å¼€ä¸€ä¸ªæ§åˆ¶æ¥å£ï¼Œä¾›å¤–éƒ¨ç¨‹åºç®¡ç† wpa_supplicant ã€‚æ¨èè®¾ç½®ä¸º /var/run/wpa_supplicant ï¼Œwpa_supplicant ä¼šåœ¨æ­¤ç›®å½•ä¸‹ç”Ÿæˆ socket ï¼Œç”¨äºç›‘å¬å¤–éƒ¨ç¨‹åºçŠ¶æ€çš„è¯·æ±‚ã€‚ ap_scan ï¼šé€šå¸¸è®¾ä¸º 1 ã€‚ç”± wpa_supplicant å¯åŠ¨æ‰«æå’Œ AP é€‰æ‹©ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ä¸é…ç½®æ–‡ä»¶ä¸­ç›¸åŒ¹é…çš„ AP ï¼Œåˆ™åˆå§‹åŒ–ä¸€ä¸ªæ–°ç½‘ç»œï¼ˆå¦‚æœæœ‰é…ç½®ï¼‰ã€‚å¦å¤–å¯é€‰ 0 æˆ– 2 ã€‚ æ¯ä¸ª Wi-Fi çƒ­ç‚¹çš„è¿æ¥ä¿¡æ¯éƒ½é…ç½®åœ¨ä¸€ä¸ª network æ®µä¸­ï¼Œå‡ ä¸ªå¸¸ç”¨çš„é€‰é¡¹ï¼š\nkey_mgmt ï¼šç§˜é’¥ç®¡ç†ç®—æ³•ï¼Œå¯¹äº WPA/WPA2 ï¼Œæ ¹æ® Wi-Fi çƒ­ç‚¹çš„é…ç½®å¯é€‰ WPA-PSK å’Œ WPA-EAP ã€‚ ssid ï¼šçƒ­ç‚¹çš„ ssid ã€‚ psk ï¼šå¯¹äº WPA/WPA2 ï¼Œå¯†ç ä¸èƒ½è®¾ä¸ºæ˜ç ï¼Œéœ€è¦ç”¨ wpa_passphrase å‘½ä»¤ç”ŸæˆåŠ å¯†åçš„ 64 ä½åå…­è¿›åˆ¶æ•°ï¼Œè¯­æ³•æ˜¯ wpa_passphrase SSID password ã€‚ å‡å¦‚ç°åœ¨è¦è¿æ¥ä¸€ä¸ª WPA/WPA2 è®¤è¯çš„æ— çº¿è·¯ç”±å™¨ï¼Œé…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š\n[root@localhost ~]# wpa_passphrase TP-LINK_30BBB8 123456789 network={ ssid=\u0026quot;TP-LINK_30BBB8\u0026quot; #psk=\u0026quot;123456789\u0026quot; psk=b9ea0d09776bd4f4d8099b78ab91d924b97366562d620161a1b4ffb1ac99ae33 } [root@localhost ~]# cat /etc/wpa_supplicant/wpa_supplicant.conf ctrl_interface=/var/run/wpa_supplicant ap_scan=1 network={ ssid=\u0026quot;TP-LINK_30BBB8\u0026quot; key_mgmt=WPA-PSK #psk=\u0026quot;123456789\u0026quot; psk=b9ea0d09776bd4f4d8099b78ab91d924b97366562d620161a1b4ffb1ac99ae33 } å¯¹äºæ— è®¸è®¤è¯çš„çƒ­ç‚¹ï¼Œåªè®¾ç½® ssid å³å¯ ï¼š\nnetwork={ ssid=\u0026quot;MYSSID\u0026quot; key_mgmt=NONE } ç„¶åæ‰§è¡Œ wpa_supplicant å¼€å§‹è¿æ¥ï¼š\n[root@localhost ~]# wpa_supplicant -B -Dnl80211 -u -iwlp1s0 -c /etc/wpa_supplicant/wpa_supplicant.conf -f /var/log/wpa_supplicant.log -P /var/run/wpa_supplicant.pid è¿æ¥è¿‡ç¨‹å¯ä»¥æŸ¥çœ‹ log æ–‡ä»¶ï¼Œè¿æ¥æˆåŠŸåå¯ä»¥è®¾ç½®é™æ€ IP ï¼Œä¹Ÿå¯ä»¥ç”¨ dhclient è·å¾—åŠ¨æ€ IP ã€‚\n4. dhclient #DHCP åè®®æ˜¯ä¸€ç§é›†ä¸­ç®¡ç†å’Œè‡ªåŠ¨åˆ†é… IP åœ°å€çš„é€šä¿¡åè®®ï¼Œä½¿ç”¨ UDP åè®®å·¥ä½œã€‚DHCP ä½¿ç”¨äº†ç§Ÿçº¦çš„æ¦‚å¿µï¼Œå³è·å¾—çš„ IP åœ°å€çš„æœ‰æ•ˆæœŸã€‚ä¸€æ¬¡å…¸å‹çš„ DHCP å·¥ä½œå‘¨æœŸåˆ†ä¸ºå‘ç°ã€æä¾›ã€è¯·æ±‚ã€ç¡®è®¤ï¼Œå¦‚å›¾ï¼š\nä¸å†ç§Ÿç”¨ IP åï¼Œå®¢æˆ·ç«¯åº”è¯¥å‘ DHCP æœåŠ¡å™¨å‘é€ä¸€ä¸ªè¯·æ±‚ä»¥é‡Šæ”¾ DHCP èµ„æºï¼Œå¹¶æ³¨é”€å…¶IPåœ°å€ã€‚è¯¦æƒ…å¯ä»¥å‚è€ƒåŠ¨æ€ä¸»æœºè®¾ç½®åè®®\ndhclient æ˜¯ä¸€ä¸ª DHCP å®¢æˆ·ç«¯ç¨‹åºï¼Œç”¨äºä» DHCP æœåŠ¡å™¨è·å–åŠ¨æ€ IP ï¼Œé»˜è®¤æ”¯æŒ IPV4 ï¼Œä¹Ÿæ”¯æŒ IPV6 ã€‚æˆåŠŸè·å¾— IP åï¼Œç¨‹åºä¼šé©»ç•™åœ¨åå°ã€‚å¸¸ç”¨çš„é€‰é¡¹æœ‰ï¼š\n-lf ï¼šlease æ–‡ä»¶çš„è·¯å¾„ï¼Œé»˜è®¤æ˜¯ /var/lib/dhclient/dhclient.leases ï¼Œæ˜¯æˆåŠŸè·å– IP åçš„æ•°æ®åº“ã€‚ -pf ï¼šPID æ–‡ä»¶çš„è·¯å¾„ï¼Œé»˜è®¤æ˜¯ /var/run/dhclient.pid ã€‚ -cf ï¼šé…ç½®æ–‡ä»¶çš„è·¯å¾„. é»˜è®¤æ˜¯ /etc/dhcp/dhclient.conf ã€‚ -sf ï¼šç½‘ç»œé…ç½®è„šæœ¬æ–‡ä»¶çš„è·¯å¾„ã€‚é»˜è®¤æ˜¯ /sbin/dhclient-script ï¼ŒæˆåŠŸè·å– IP åä¼šæ‰§è¡Œè¯¥è„šæœ¬ï¼Œä¸»è¦ä½œç”¨æ˜¯é…ç½® IP ã€DNSã€å’Œé»˜è®¤è·¯ç”±ï¼Œè¿˜ä¼šè°ƒç”¨ /etc/dhcp/dhclient.d/ ä¸‹çš„ç”¨æˆ·è‡ªå®šä¹‰è„šæœ¬ã€‚ -q ï¼šä¿æŒå®‰é™ï¼Œä¸è¾“å‡ºä»»ä½•ä¿¡æ¯ã€‚ -timeout ï¼šè¶…æ—¶æ—¶é—´ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´è€Œæ— æ³•è·å¾— IP å³é€€å‡ºã€‚ -r ï¼šå‘Šè¯‰ dhclient é‡Šæ”¾è·å–çš„ IP ï¼Œé‡Šæ”¾åï¼Œåå°çš„ dhclient ä¼šé€€å‡ºã€‚ -d ï¼šè®© dhclient åœ¨å‰å°è¿è¡Œã€‚ é…ç½®æ–‡ä»¶é»˜è®¤æ˜¯ /etc/dhcp/dhclient.confï¼ŒåŒç›®å½•ä¸‹è¿˜æœ‰ä¸€ä¸ªåä¸º dhclient.d çš„æ–‡ä»¶å¤¹ï¼Œå¯ä»¥åœ¨ä¸‹é¢æ”¾ä¸€äº›è„šæœ¬ï¼Œä¾› dhclient-script è°ƒç”¨ï¼Œæ‰§è¡Œä¸€ä¸‹è·å– IP åçš„åŠ¨ä½œã€‚å¦‚æœå®‰è£…äº†å®Œæ•´çš„ç¨‹åºï¼Œåœ¨ /usr/share/doc/dhclient ç›®å½•ä¸‹ä¼šæœ‰é…ç½®æ–‡ä»¶çš„ä¾‹å­å’Œ dhclient.d ä¸‹è„šæœ¬æ–‡ä»¶çš„è¯´æ˜ã€‚\né’ˆå¯¹ wlp1s0 è¿™ä¸ªæ¥å£å†™ä¸€ä¸ªç®€å•çš„é…ç½®æ–‡ä»¶ï¼š\ntimeout 60; retry 60; reboot 10; select-timeout 5; initial-interval 2; reject 192.33.137.209; interface \u0026quot;wlp1s0\u0026quot; { send host-name â€œmy_pc\u0026quot;; send dhcp-lease-time 3600; request subnet-mask, broadcast-address, time-offset, routers,domain-search, domain-name, domain-name-servers, host-name; require subnet-mask, domain-name-servers,host-name; } è§£é‡Šä¸€ä¸‹è¿™äº›é…ç½®é€‰é¡¹ï¼š\ntimeout ï¼šè¶…æ—¶æ—¶é—´ï¼Œè¿™é‡Œè®¾ç½®æ˜¯ 60 ç§’ã€‚ä»å°è¯•ä¸ DHCP server è”ç³»å¼€å§‹ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´è¿˜æ²¡æœ‰è·å¾— IP ï¼Œå°±ç»“æŸè¿™æ¬¡åå•†ï¼Œåœ¨é‡è¯•é—´éš”åå†é‡å¯åå•†ã€‚ retry ï¼šé‡è¯•é—´éš”ï¼Œä¸€æ¬¡ä¸ DHCP server åå•†å¤±è´¥åï¼Œç»è¿‡è¿™ä¸ªæ—¶é—´åé‡å¯åå•†ï¼Œé»˜è®¤æ˜¯äº”åˆ†é’Ÿã€‚ reboot ï¼šå½“ dhclient å¯åŠ¨åï¼Œå®ƒä¼šé¦–å…ˆå°è¯•è¯·æ±‚ä¸Šä¸€æ¬¡è¿æ¥è¯¥ç½‘ç»œæ—¶è·å¾—çš„ IP ï¼Œå¦‚æœå¤±è´¥ï¼Œåˆ™ç»è¿‡è¿™ä¸ªæ—¶é—´ååœ¨å°è¯•è¯·æ±‚æ–° IP ï¼Œé»˜è®¤æ˜¯åç§’ã€‚ select-timeout ï¼šå¦‚æœæœ‰å¤šä¸ª DHCP server ä¸ºè¯¥ç½‘ç»œæä¾›æœåŠ¡ï¼Œclient å¯èƒ½è·å¾—å¤šä¸ª IP æè®®ï¼Œè€Œè¿™äº›æè®®æœ‰å…ˆåé¡ºåºï¼Œclient ä¼šåœ¨ select-timeout æ—¶é—´å†…æ¥æ”¶æè®®ï¼Œç„¶åé€‰æ‹©æœ€ä¼˜çš„ï¼ˆæ¯”å¦‚ä¸Šä¸€æ¬¡è·å¾—çš„ IP ï¼‰ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´ï¼Œå°±åœæ­¢æ¥æ”¶æ–°æè®®ã€‚é»˜è®¤æ˜¯é›¶ç§’ï¼Œå°±æ˜¯ç›´æ¥é‡‡ç”¨ç¬¬ä¸€ä¸ªæ¥æ”¶åˆ°çš„æè®®ã€‚ initial-interval ï¼šç¬¬ä¸€æ¬¡å°è¯•åˆ°è¾¾æœåŠ¡å™¨å’Œç¬¬äºŒæ¬¡å°è¯•åˆ°è¾¾æœåŠ¡å™¨çš„é—´éš”ã€‚ reject ï¼šæ‹’ç»æ¥è‡ªæŸäº› DHCP server çš„æè®®ã€‚å¯ä»¥æŒ‡å®šæŸä¸ª IP ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å­ç½‘æ©ç æŒ‡å®šæ‹’ç»æŸä¸ªç½‘æ®µï¼Œå¤šä¸ª IP ç”¨é€—å·åˆ†éš”ï¼Œä¾‹å¦‚ï¼šreject 192.168.0.0/16, 10.0.0.5; ã€‚ è®¾ç½®å®Œå…¨å±€é€‰é¡¹ï¼Œå°±å¯ä»¥å¯¹ç½‘å£è¿›è¡Œå•ç‹¬è®¾ç½®ï¼Œè¿™äº›é€‰é¡¹å¯ä»¥åœ¨ dhcp-options çš„ man æ‰‹å†Œä¸­æŸ¥æ‰¾ã€‚ä¸€ä¸ªé…ç½®æ–‡ä»¶å¯ä»¥ä¸ºå¤šä¸ªç½‘å£é…ç½®ä¸åŒçš„è¡Œä¸ºï¼Œè¯­æ³•æ˜¯ interface \u0026quot;name\u0026quot; { declarations ... } ï¼Œname å°±æ˜¯ç½‘å£åç§°ï¼ŒèŠ±æ‹¬å·å†…ä¸ºå®ƒçš„é…ç½®é€‰é¡¹ï¼š\nsend host-name ï¼šå‘æœåŠ¡å™¨å‘é€æœ¬æœºçš„åç§°ã€‚ send dhcp-lease-time ï¼šå‘Šè¯‰æœåŠ¡å™¨è¯·æ±‚çš„ IP ç§ŸæœŸï¼Œè¿™é‡Œè®¾ç½®äº† 3600 ç§’ã€‚ request ï¼šè¯·æ±‚æœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€æŒ‡å®šé€‰é¡¹çš„å€¼ï¼Œé€šå¸¸ä¸ç”¨è®¾ç½®ï¼Œç¼ºçœå·²ç»è¯·æ±‚äº†å¾ˆå¤šå¿…è¦é€‰é¡¹ã€‚ require ï¼šåˆ—å‡ºäº†å¿…é¡»å‘æœåŠ¡å™¨å‘é€çš„é€‰é¡¹ï¼Œä»¥ä¾¿æ¥æ”¶è¦çº¦ï¼Œè¦å‘é€çš„å€¼ç”¨ send è¯­å¥è®¾ç½®ã€‚æ²¡æœ‰ç¼ºçœå€¼ã€‚ æœ‰äº†é…ç½®æ–‡ä»¶åï¼Œæ‰§è¡Œ dhclient å³å¯ã€‚ä¸ DHCP server åå•†æˆåŠŸåï¼Œä¼šå°†è·å–çš„ IP ç­‰ä¿¡æ¯ä¿å­˜åˆ° dhclient.leases æ–‡ä»¶ï¼Œè¿™æ˜¯ DHCP client ç§Ÿèµæ•°æ®åº“ï¼Œå¦‚æœæœ‰å¤šæ¡æ•°æ®ï¼Œæœ€åä¸€å¤©æœ‰æ•ˆã€‚\n[root@localhost ~]# cat /var/lib/dhclient/dhclient.leases default-duid \u0026quot;\\000\\001\\000\\001\\037\\234\\226n\\020\\013\\251\\264\\231\\000\u0026quot;; lease { interface \u0026quot;wlp1s0\u0026quot;; fixed-address 192.168.1.105; option subnet-mask 255.255.255.0; option routers 192.168.1.1; option dhcp-lease-time 7200; option dhcp-message-type 5; option domain-name-servers 192.168.1.1; option dhcp-server-identifier 192.168.1.1; renew 1 2016/10/24 08:59:57; rebind 1 2016/10/24 09:51:49; expire 1 2016/10/24 10:06:49; } ç„¶å dhclient ä¼šè°ƒç”¨ dhclient-script æ–‡ä»¶ï¼Œå®ƒçš„ä½œç”¨ä¿®æ”¹ç½‘å£ IP ã€ä¿®æ”¹é»˜è®¤è·¯ç”±ã€æ›¿æ¢ /etc/resolv.conf æ–‡ä»¶ï¼Œè¿˜ä¼šè°ƒç”¨ /etc/dhcp/dhclient.d/ ä¸‹çš„ç”¨æˆ·è‡ªå®šä¹‰è„šæœ¬ï¼Œè¯¦æƒ…å¯ä»¥æŸ¥çœ‹ dhclient-script çš„ man æ‰‹å†Œã€‚\nå¦‚æœè¦æ˜¯å¦é‡Šæ”¾ IP ï¼Œæ‰§è¡Œ dhclient -r ã€‚\næœ€åè¡¥å……ä¸€ç‚¹ï¼Œåœ¨ç›®å‰çš„ Linux å‘è¡Œç‰ˆä¸­ï¼Œå·²ç»æœ‰é›†æˆåŒ–çš„ç½‘å¡ç®¡ç†å·¥å…·ï¼Œæ¯”å¦‚ NetworkManager ï¼Œå¯ä»¥ç»Ÿä¸€çš„ç®¡ç†ä»¥å¤ªç½‘ã€Wi-Fiã€3Gç­‰ç½‘å¡è®¾å¤‡ï¼Œç®€åŒ–äº†å¾ˆå¤šæ­¥éª¤ï¼Œæ¯”è¾ƒæ–¹ä¾¿ï¼Œå½“ç„¶åº•å±‚è¿˜æ˜¯è°ƒç”¨è¿™äº›åŸºæœ¬çš„ç¨‹åºã€‚\n5. å›½åˆ«ä»£ç é—®é¢˜ #ä¸åŒçš„å›½å®¶å’Œåœ°åŒºå¯¹ Wi-Fi çš„åˆæ³•é¢‘æ®µæœ‰ä¸åŒçš„è¦æ±‚ï¼ŒWi-Fi æ¨¡å—éƒ½æ”¯æŒè®¾ç½®å›½åˆ«ä»£ç ï¼Œä½¿æ¨¡å—ä½¿ç”¨åˆæ³•çš„é¢‘æ®µã€‚å¯ä»¥é€šè¿‡ iw å‘½ä»¤è¯»å–å½“å‰æ¨¡å—è®¾ç½®çš„å›½åˆ«ä»£ç ä¸åˆæ³•é¢‘æ®µï¼š\nroot@localhost:~# iw reg get country CN: DFS-FCC (2402 - 2482 @ 40), (N/A, 20), (N/A) (5170 - 5250 @ 80), (N/A, 23), (N/A) (5250 - 5330 @ 80), (N/A, 23), (0 ms), DFS (5735 - 5835 @ 80), (N/A, 30), (N/A) (57240 - 59400 @ 2160), (N/A, 28), (N/A) (59400 - 63720 @ 2160), (N/A, 44), (N/A) (63720 - 65880 @ 2160), (N/A, 28), (N/A) åœ¨ Linux ç³»ç»Ÿé‡Œé€šå¸¸æ˜¯é€šè¿‡é…ç½®æ–‡ä»¶è¿™ç§ç›¸åº”çš„é©±åŠ¨å‚æ•°ï¼š\nroot@localhost:~# cat /etc/default/crda # Set REGDOMAIN to a ISO/IEC 3166-1 alpha2 country code so that iw(8) may set # the initial regulatory domain setting for IEEE 802.11 devices which operate # on this system. # # Governments assert the right to regulate usage of radio spectrum within # their respective territories so make sure you select a ISO/IEC 3166-1 alpha2 # country code suitable for your location or you may infringe on local # legislature. See `/usr/share/zoneinfo/zone.tab\u0026#39; for a table of timezone # descriptions containing ISO/IEC 3166-1 alpha2 country codes. REGDOMAIN=CN root@localhost:~# cat /etc/modprobe.d/iwlwifi.conf # /etc/modprobe.d/iwlwifi.conf # iwlwifi will dyamically load either iwldvm or iwlmvm depending on the # microcode file installed on the system. When removing iwlwifi, first # remove the iwl?vm module and then iwlwifi. remove iwlwifi \\ (/sbin/lsmod | grep -o -e ^iwlmvm -e ^iwldvm -e ^iwlwifi | xargs /sbin/rmmod) \\ \u0026amp;\u0026amp; /sbin/modprobe -r mac80211 options iwlwifi lar_disable=1 root@localhost:~# cat /etc/modprobe.d/cfg80211.conf options cfg80211 ieee80211_regdom=\u0026#34;CN\u0026#34; å‚è€ƒ # https://wireless.wiki.kernel.org man æ‰‹å†Œ ","date":"2016 October 26","permalink":"/posts/2016/10/26/","section":"Posts","summary":"è¿™é‡Œçš„æ— çº¿ï¼ˆWirelessï¼‰æŒ‡æ— çº¿å±€åŸŸç½‘ï¼Œå®ƒçš„é€šç”¨æ ‡å‡†æ˜¯ IEEE 802.","title":"Linux Wireless HowTo"},{"content":"Linux ä¸­ 3G æ¨¡å—çš„å±‚æ¬¡ç»“æ„ï¼š\nç¡¬ä»¶æ¨¡å—å°±æ˜¯ 3G æ¨¡å—ï¼Œé€šå¸¸é€šè¿‡ USB æ€»çº¿æ¥å…¥è®¡ç®—æœºã€‚å†…æ ¸ä¸­çš„ 3G æ¨¡å—é©±åŠ¨å¯ä»¥åœ¨åº”ç”¨å±‚ç”Ÿæˆä¸²è¡Œè®¾å¤‡ï¼Œä¾‹å¦‚ ttyUSB*ã€ttyACM* ç­‰ã€‚3G æ¨¡å—çš„æ‹¨å·è¿æ¥è¿‡ç¨‹éµå¾ª ppp åè®®ï¼Œå®ƒæä¾›äº†é€šè¿‡ä¸²è¡Œç‚¹å¯¹ç‚¹é“¾è·¯ä¼ è¾“æ•°æ®æŠ¥çš„æ–¹æ³•ï¼ŒLinux å†…æ ¸é›†æˆäº† ppp åè®®æ ˆï¼Œpppd ç¨‹åºæ˜¯ ppp åè®®åœ¨ç”¨æˆ·ç©ºé—´çš„å®ˆæŠ¤è¿›ç¨‹ï¼Œchat ç¨‹åºè´Ÿè´£é€šè¿‡ä¸²è¡Œè®¾å¤‡ä¸ pppd ä¹‹é—´çš„é€šä¿¡ã€‚\n1. ç¡¬ä»¶å’Œé©±åŠ¨ #å¤§éƒ¨åˆ† 3G æ¨¡å—æ˜¯æŒ‚åœ¨ USB æ€»çº¿ä¸Šï¼Œä»¥ Telit HE910 æ¨¡å—ä¸ºä¾‹ï¼Œè¿™æ˜¯ä¸€ä¸ªæ”¯æŒ WCDMA ï¼Œå³è”é€š 3G çš„æ¨¡å— ï¼š\n[root@localhost ~]# lsusb Bus 001 Device 006: ID 09da:0260 A4Tech Co., Ltd. KV-300H Isolation Keyboard Bus 001 Device 005: ID 0424:2514 Standard Microsystems Corp. USB 2.0 Hub Bus 001 Device 004: ID 1bc7:0021 Telit Wireless Solutions HE910 Linux ç³»ç»ŸåŒ…å«ä¸€ä¸ªé€šç”¨çš„ USB é©±åŠ¨ CDC_ACMï¼Œå¾ˆå¤š 3G æ¨¡å—éƒ½ç”¨å®ƒæ¥é©±åŠ¨ï¼ŒHE910 å°±æ˜¯è¿™æ ·ã€‚é©±åŠ¨åŠ è½½æˆåŠŸåä¼šåˆ›å»ºå¤šä¸ª tty è®¾å¤‡æ–‡ä»¶ï¼Œå…¶ä¸­ä¸¤ä¸ªæ¯”è¾ƒé‡è¦ï¼š\n/dev/ttyACM0: PPP è¿æ¥å’Œ AT æŒ‡ä»¤çš„é€šç”¨æ¥å£ /dev/ttyACM3: AT æŒ‡ä»¤æ¥å£ ä¸åŒçš„æ¨¡å—æ‰€ç”¨é©±åŠ¨å¯èƒ½ä¸åŒï¼Œå…·ä½“æƒ…å†µè¦æŸ¥çœ‹æ¨¡å—çš„ä½¿ç”¨æ‰‹å†Œã€‚Linux å†…æ ¸è¦æ”¯æŒ ppp åè®®ï¼Œè¿™å·²ç»æ˜¯ç°åœ¨ Linux çš„é»˜è®¤é…ç½®ã€‚\n2. AT æŒ‡ä»¤ #å¯¹ 3G æ¨¡å—æ‰§è¡Œ AT æŒ‡ä»¤ç”¨å¾ˆå¤šæ–¹å¼ï¼Œæœ€ç®€å•çš„æ˜¯ç”¨ cat å’Œ echo å‘½ä»¤ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªç»ˆç«¯æ‰§è¡Œ cat \u0026lt; /dev/ttyACM3ï¼Œå®ƒä¼šæŒç»­ç›‘å¬è¯¥ç«¯å£çš„è¿”å›ä¿¡æ¯ï¼Œç„¶ååœ¨å¦ä¸€ä¸ªç»ˆç«¯ç”¨ echo å‘ /dev/ttyACM3 å‘é€ AT æŒ‡ä»¤ï¼Œåœ¨ cat ä¸­å°±å¯ä»¥çœ‹åˆ°è¿”å›ï¼š\n#Terminal 1 [root@localhost ~]# cat \u0026lt; /dev/ttyACM3 OK #Terminal 2 [root@localhost ~]# echo -en \u0026quot;AT\\r\u0026quot; \u0026gt; /dev/ttyACM3 å¸¸ç”¨çš„æ˜¯ minicom ï¼Œå¯ä»¥ç”¨äºäº¤äº’è°ƒè¯•ï¼š\n[root@localhost ~]# minicom -D /dev/ttyACM3 -b 115200 Welcome to minicom 2.7 OPTIONS: I18n Compiled on Aug 17 2014, 17:34:01. Port /dev/ttyACM3, 15:39:12 Press CTRL-A Z for help on special keys AT OK ATZ OK AT+CSQ +CSQ: 3,3 è¿˜ç”¨ä¸€ä¸ªçº¯å‘½ä»¤è¡Œå·¥å…· comgt ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„é›†æˆåˆ°å…¶ä»–ç¨‹åºä¸­ï¼Œè¿˜æ”¯æŒè„šæœ¬æ‰§è¡Œä¸€ç³»åˆ— AT æŒ‡ä»¤ï¼Œå®Œæˆå¤æ‚çš„åŠŸèƒ½ã€‚ä¸€èˆ¬ Linux ç³»ç»Ÿéƒ½æ²¡æœ‰å®‰è£…ï¼Œéœ€è¦ä¸‹è½½ç¼–è¯‘ï¼šhttps://sourceforge.net/projects/comgt/ ã€‚ è¿™æœ‰æˆ‘å†™çš„ä¸€ç¯‡æ–‡æ¡£ï¼šhttp://shaocheng.li/post/blog/2015-09-09\nAT æŒ‡ä»¤åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†æ˜¯é€šç”¨æ ‡å‡†çš„æŒ‡ä»¤ï¼Œå„ä¸ªæ¨¡å—éƒ½ä¸€æ ·ï¼›å¦ä¸€éƒ¨åˆ†æ˜¯å„å‚å•†ä¸ºè‡ªå®¶æ¨¡å—è‡ªå®šä¹‰çš„æ‰©å±•æŒ‡ä»¤ï¼Œè¯¦ç»†ä¿¡æ¯å¯ä»¥æŸ¥çœ‹æ¨¡å—çš„ AT æŒ‡ä»¤æ‰‹å†Œã€‚ä»¥ HE910 ä¸ºä¾‹ï¼Œä»‹ç»å‡ ä¸ªå¸¸ç”¨æŒ‡ä»¤ã€‚\nATZ ï¼Œè½¯é‡å¯ 3G æ¨¡å—ã€‚\nAT+CGMI ï¼Œè¯»å–æ¨¡å—å‚å•†ï¼š\nAT+CGMI Telit AT+CGMM ï¼Œè¯»å–æ¨¡å—åç§°ï¼š\nAT+CGMM HE910-D AT+CGSN ï¼Œè¯»å–æ¨¡å—çš„ IMEIï¼š\nAT+CGSN 351579053301782 AT+CGMR ï¼Œè¯»å–æ¨¡å—çš„å›ºä»¶ç‰ˆæœ¬ï¼š\nAT+CGMR\u0026quot; 12.00.024 AT+CIMI ï¼ŒæŸ¥è¯¢ IMSI ã€‚IMSI æ˜¯å›½é™…ç§»åŠ¨ç”¨æˆ·è¯†åˆ«ç ï¼Œå‚¨å­˜åœ¨ SIM å¡ä¸­ï¼Œæ¯å¼  SIM å¡éƒ½ä¸ä¸€æ ·ï¼Œé€šå¸¸æ˜¯åäº”ä½æ•°å­—ï¼Œç”±ä¸‰æ®µç»„æˆã€‚å‰ä¸‰ä½æ˜¯å›½å®¶ä»£ç ï¼ˆMCCï¼Œä¸­å›½æ˜¯ 460ï¼‰ã€‚ä¹‹åçš„ä¸¤ä½æˆ–è€…ä¸‰ä½æ˜¯ç§»åŠ¨ç½‘ç»œä»£ç ï¼ˆMNC)ï¼Œç”¨äºæ ‡è¯†ä¸åŒçš„è¿è¥å•†ç½‘ç»œï¼Œä¸­å›½ç§»åŠ¨ä½¿ç”¨ 00ã€02ã€07ï¼ˆä¸åŒçš„å·ç å¯ä»¥åŒºåˆ†ä¸åŒçš„å·æ®µï¼‰ï¼Œä¸­å›½è”é€šä½¿ç”¨ 01ã€06ã€09ï¼Œä¸­å›½ç”µä¿¡ä½¿ç”¨ 03ã€05ã€11ï¼Œæ›´å¤šçš„å¯ä»¥æŸ¥çœ‹è¿™é‡Œã€‚æœ€åæ˜¯ç”¨æˆ·è¯†åˆ«ç ï¼ˆMSINï¼‰ï¼Œç”±è¿è¥å•†è‡ªå®šä¹‰ã€‚\nAT+CIMI 460019048517149 AT+CSQ ï¼Œè·å–ä¿¡å·å¼ºåº¦ï¼Œä¿¡å·å¼ºåº¦ä¸æ˜¯å¦æ’ SIM å¡æ— å…³ï¼š\nAT+CSQ +CSQ: 15,1 ç¬¬ä¸€ä¸ªæ•°å­—è¡¨ç¤ºä¿¡å·è½»åº¦ï¼Œå–å€¼0~31ï¼Œæ•°å­—è¶Šå¤§ä¿¡å·è¶Šå¥½ï¼Œ99 è¡¨ç¤ºæœªçŸ¥æˆ–ä¸å¯æ£€æµ‹ï¼Œæ¢ç®—æ–¹å¼ï¼š CSQ å€¼=ï¼ˆæ¥æ”¶ä¿¡å·å¼ºåº¦ dBm + 113ï¼‰/2 ï¼š\nAT+CPIN? ï¼Œå¯ä»¥ç”¨æ¥æŸ¥çœ‹ SIM å¡æ˜¯å¦æ’å¥½ï¼Œæ’å¥½ä¼šè¿”å› READY ï¼š\nAT+CPIN? +CPIN: READY OK AT+CNUM ï¼ŒæŸ¥çœ‹ç”µè¯å·ç ï¼Œå‰ææ˜¯å·ç å·²ç»å­˜å‚¨åœ¨ SIM ä¸­ ï¼š\nAT+CNUM +CNUM: \u0026quot;\u0026quot;,\u0026quot;+8618589041260\u0026quot;,145 OK AT+WS46=[] ï¼Œé€‰æ‹©æ— çº¿ç½‘ç»œ,ä¸‰ä¸ªæ•°å­—åˆ†åˆ«æ˜¯ 2G onlyã€3G onlyã€3G first ã€‚\nAT#PSNT? ï¼ŒæŸ¥è¯¢å½“å‰çš„ç½‘ç»œç±»å‹ï¼Œè¿”å›çš„æ•°æ®æ ¼å¼æ˜¯ #PSNT: \u0026lt;mode\u0026gt;,\u0026lt;nt\u0026gt; ï¼š\nAT#PSNT? #PSNT: 0,3 OK æ•°æ®çš„å«ä¹‰ï¼š\n\u0026lt;mode\u0026gt; 0 - PSNT unsolicited result code disabled 1 - PSNT unsolicited result code enabled \u0026lt;nt\u0026gt; - network type 0 - GPRS network 1 - EGPRS network 2 - WCDMA network 3 - HSDPA network 4 - unknown or not registered. AT#RFSTS ï¼Œè¯»å–å½“å‰çš„ç½‘ç»œçŠ¶æ€ï¼Œæ•°æ®æ¯”è¾ƒå¤šï¼Œå…·ä½“å«ä¹‰éœ€è¦æŸ¥çœ‹æ‰‹å†Œï¼š\nAT#RFSTS #RFSTS: \u0026quot;460 01\u0026quot;,10713,64,-4.5,-89,-80,A53F,02,-128,64,19,4,2,,17030E9,\u0026quot;460010892513284\u0026quot;,\u0026quot;CHN-UNICOM\u0026quot;,3,0 OK AT æŒ‡ä»¤å¯èƒ½è¿”å›é”™è¯¯ä»£ç ï¼Œä¸‹é¢å¸¸è§é”™è¯¯ä»£ç çš„å«ä¹‰ï¼š\nCME ERROR: 0\tPhone failure CME ERROR: 1\tNo connection to phone CME ERROR: 2\tPhone adapter link reserved CME ERROR: 3\tOperation not allowed CME ERROR: 4\tOperation not supported CME ERROR: 5\tPH_SIM PIN required CME ERROR: 6\tPH_FSIM PIN required CME ERROR: 7\tPH_FSIM PUK required CME ERROR: 10\tSIM not inserted CME ERROR: 11\tSIM PIN required CME ERROR: 12\tSIM PUK required CME ERROR: 13\tSIM failure CME ERROR: 14\tSIM busy CME ERROR: 15\tSIM wrong CME ERROR: 16\tIncorrect password CME ERROR: 17\tSIM PIN2 required CME ERROR: 18\tSIM PUK2 required CME ERROR: 20\tMemory full CME ERROR: 21\tInvalid index CME ERROR: 22\tNot found CME ERROR: 23\tMemory failure CME ERROR: 24\tText string too long CME ERROR: 25\tInvalid characters in text string CME ERROR: 26\tDial string too long CME ERROR: 27\tInvalid characters in dial string CME ERROR: 30\tNo network service CME ERROR: 31\tNetwork timeout CME ERROR: 32\tNetwork not allowed, emergency calls only CME ERROR: 40\tNetwork personalization PIN required CME ERROR: 41\tNetwork personalization PUK required CME ERROR: 42\tNetwork subset personalization PIN required CME ERROR: 43\tNetwork subset personalization PUK required CME ERROR: 44\tService provider personalization PIN required CME ERROR: 45\tService provider personalization PUK required CME ERROR: 46\tCorporate personalization PIN required CME ERROR: 47\tCorporate personalization PUK required CME ERROR: 48\tPH-SIM PUK required CME ERROR: 100\tUnknown error CME ERROR: 103\tIllegal MS CME ERROR: 106\tIllegal ME CME ERROR: 107\tGPRS services not allowed CME ERROR: 111\tPLMN not allowed CME ERROR: 112\tLocation area not allowed CME ERROR: 113\tRoaming not allowed in this location area CME ERROR: 126\tOperation temporary not allowed CME ERROR: 132\tService operation not supported CME ERROR: 133\tRequested service option not subscribed CME ERROR: 134\tService option temporary out of order CME ERROR: 148\tUnspecified GPRS error CME ERROR: 149\tPDP authentication failure CME ERROR: 150\tInvalid mobile class CME ERROR: 256\tOperation temporarily not allowed CME ERROR: 257\tCall barred CME ERROR: 258\tPhone is busy CME ERROR: 259\tUser abort CME ERROR: 260\tInvalid dial string CME ERROR: 261\tSS not executed CME ERROR: 262\tSIM Blocked CME ERROR: 263\tInvalid block CME ERROR: 527\tPlease wait, and retry your selection later (Specific Modem Sierra) CME ERROR: 528\tLocation update failure â€“ emergency calls only (Specific Modem Sierra) CME ERROR: 529\tSelection failure â€“ emergency calls only (Specific Modem Sierra) CME ERROR: 772\tSIM powered down 3. pppd #pppd æ˜¯ ppp åè®®çš„å®ˆæŠ¤è¿›ç¨‹ï¼Œå…¨ç§°ç‚¹å¯¹ç‚¹åè®®å®ˆæŠ¤è¿›ç¨‹ã€‚å®ƒçš„ man æ‰‹å†Œæä¾›äº†è¯¦ç»†ä½¿ç”¨è¯´æ˜ï¼Œè¿™é‡Œæœ‰ä¸­æ–‡ç‰ˆï¼šhttps://docs.oracle.com/cd/E56344_01/html/E54077/pppd-1m.html ã€‚è¯­æ³•æ˜¯ï¼š\npppd [option] å¸¸ç”¨çš„é€‰é¡¹ï¼š\ntty_name ï¼šæŒ‡å®šç”¨äº ppp æ‹¨å·çš„ä¸²è¡Œè®¾å¤‡ï¼Œé€šå¸¸æ˜¯ /dev/ ç›®å½•ä¸‹çš„ tty è®¾å¤‡ï¼Œå¯¹äº HE910 åº”è¯¥è®¾ä¸º /dev/ttyACM0 ã€‚ speed : æŒ‡å®šä¸²å£æ³¢ç‰¹ç‡ï¼Œåè¿›åˆ¶æ•°ï¼Œå¸¸ç”¨çš„æœ‰9600ã€19200ã€115200ã€460800ã€‚ damand ï¼šä»…åœ¨æœ‰æ•°æ®é€šä¿¡æ—¶å¯åŠ¨é“¾è·¯ï¼Œè¯¥é€‰é¡¹éšå«äº† persist é€‰é¡¹ã€‚ persist ï¼šè¿æ¥ç»ˆæ­¢åç¨‹åºä¸é€€å‡ºï¼Œå¹¶å°è¯•é‡æ–°æ‰“å¼€è¿æ¥ï¼Œä¹Ÿå°±æ˜¯æ‰çº¿é‡è¿ã€‚ debug ï¼šå¯ç”¨è¿æ¥è°ƒè¯•å·¥å…·ã€‚å¦‚æœæŒ‡å®šäº†æ­¤é€‰é¡¹ï¼Œåˆ™ pppd å°†ä»¥å¯é˜…è¯»æ ¼å¼è®°å½•æ‰€å‘é€æˆ–æ¥æ”¶çš„æ‰€æœ‰æ§åˆ¶åŒ…çš„å†…å®¹ã€‚ dump ï¼šæŒ‡å®šæ­¤é€‰é¡¹åï¼Œpppd ä¼šæ‰“å°æ‰€æœ‰å·²ç»è®¾ç½®çš„é€‰é¡¹çš„å€¼ã€‚ crtscts ï¼šä½¿ç”¨ç¡¬ä»¶æµé‡æ§åˆ¶ï¼ˆå³ RTS/CTSï¼‰æ¥æ§åˆ¶ä¸²è¡Œç«¯å£ä¸Šçš„æ•°æ®æµã€‚ lock ï¼šä¸ºä¸²è¡Œè®¾å¤‡åŠ é”ï¼Œç¡®ä¿å¯¹è®¾å¤‡çš„ç‹¬å è®¿é—®ã€‚ user username ï¼šå‘å¯¹ç­‰æ–¹è¯æ˜èº«ä»½çš„ç”¨æˆ·åã€‚ password password ï¼š å‘å¯¹ç­‰æ–¹è¯æ˜èº«ä»½çš„å¯†ç ã€‚ defaultroute ï¼šæ‹¨å·æˆåŠŸå®Œæˆæ—¶ï¼Œå‘ç³»ç»Ÿè·¯ç”±è¡¨æ·»åŠ ä¸€ä¸ªç¼ºçœè·¯ç”±ã€‚ usepeerdns ï¼šå‘å¯¹ç­‰æ–¹è¯·æ±‚æœ€å¤šä¸¤ä¸ª DNS æœåŠ¡å™¨åœ°å€ã€‚ nodetach ï¼šè®¾ç½®è¯¥é€‰é¡¹åï¼Œpppd å°†ä¿æŒå‰å°è¿è¡Œï¼Œé»˜è®¤æ˜¯åå°è¿è¡Œã€‚ logfile filename ï¼šå°†æ—¥å¿—ä¿¡æ¯é™„åŠ åˆ°æ–‡ä»¶ filename ã€‚ connect script ï¼šä½¿ç”¨ç”± script æŒ‡å®šçš„å¯æ‰§è¡Œæ–‡ä»¶æˆ– shell å‘½ä»¤æ¥è®¾ç½®ä¸²è¡Œè®¾å¤‡ã€‚æ­¤è„šæœ¬é€šå¸¸å°†ä½¿ç”¨ chat(1M) ç¨‹åºæ‹¨æ‰“è°ƒåˆ¶è§£è°ƒå™¨å¹¶å¯åŠ¨è¿œç¨‹ PPP ä¼šè¯ã€‚ disconnect script ï¼šåœ¨ pppd ç»ˆæ­¢é“¾è·¯åï¼Œè¿è¡Œç”± script æŒ‡å®šçš„å¯æ‰§è¡Œæ–‡ä»¶æˆ– shell å‘½ä»¤ã€‚ call filename ï¼šä» /etc/ppp/peers/ ä¸‹çš„ filename æ–‡ä»¶ä¸­è¯»å–é€‰é¡¹ã€‚ä¸Šé¢è¿™äº›é€‰é¡¹å¯ä»¥åœ¨æ‰§è¡Œå‘½ä»¤æ˜¯è®¾ç½®ï¼Œä¹Ÿå¯ä»¥æ”¾åœ¨ /etc/ppp/peers/ ç›®å½•ä¸‹çš„è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ä¸­ï¼Œç”¨ call é€‰é¡¹è°ƒç”¨ã€‚ local_IP_address:remote_IP_address : è®¾ç½®æœ¬åœ°å’Œ/æˆ–è¿œç¨‹æ¥å£ IP åœ°å€ã€‚ä¸¤è€…éƒ½å¯ä»¥çœç•¥ï¼Œä½†å†’å·æ˜¯å¿…éœ€çš„ã€‚IP åœ°å€å¯ä»¥é€šè¿‡ä¸»æœºåæ¥æŒ‡å®šï¼Œä¹Ÿå¯ä»¥é€šè¿‡åè¿›åˆ¶ç‚¹è®°æ³•æ¥æŒ‡å®šï¼Œä¾‹å¦‚ï¼š:10.1.2.3ã€‚ç¼ºçœæœ¬åœ°åœ°å€æ˜¯ç³»ç»Ÿçš„ç¬¬ä¸€ä¸ª IP åœ°å€ï¼Œé™¤éæä¾›äº† noipdefault é€‰é¡¹ã€‚å¦‚æœæœªåœ¨ä»»ä½•é€‰é¡¹ä¸­æŒ‡å®šè¿œç¨‹åœ°å€ï¼Œåˆ™å°†ä»å¯¹ç­‰æ–¹è·å–è¿œç¨‹åœ°å€ã€‚å› æ­¤ï¼Œåœ¨ç®€å•æƒ…å†µä¸‹ï¼Œæ­¤é€‰é¡¹ä¸æ˜¯å¿…éœ€çš„ã€‚å¦‚æœé€šè¿‡æ­¤é€‰é¡¹æŒ‡å®šäº†æœ¬åœ°å’Œ/æˆ–è¿œç¨‹ IP åœ°å€ï¼Œåˆ™ pppd åœ¨ IPCP åå•†ä¸­å°†ä¸ä¼šæ¥å—æ¥è‡ªå¯¹ç­‰æ–¹çš„ä¸åŒå€¼ï¼Œé™¤éåˆ†åˆ«æŒ‡å®šäº† ipcp-accept-local å’Œ/æˆ– ipcp-accept-remote é€‰é¡¹ã€‚ noipdefault : ç¦ç”¨æœªæŒ‡å®šæœ¬åœ° IP åœ°å€æ—¶çš„ç¼ºçœè¡Œä¸ºï¼Œå³é€šè¿‡ä¸»æœºåç¡®å®šæœ¬åœ° IP åœ°å€ï¼ˆå¦‚æœå¯è¡Œï¼‰ã€‚æŒ‡å®šäº†æ­¤é€‰é¡¹æ—¶ï¼Œå¯¹ç­‰æ–¹åœ¨ IPCP åå•†æœŸé—´å¿…é¡»æä¾›æœ¬åœ° IP åœ°å€ï¼ˆé™¤éåœ¨å‘½ä»¤è¡Œä¸Šæˆ–é€‰é¡¹æ–‡ä»¶ä¸­æ˜¾å¼æŒ‡å®šäº†è¯¥åœ°å€ï¼‰ã€‚æœªæŒ‡å®šè¯¥é€‰é¡¹æ—¶ï¼Œå¯èƒ½è¢«è®¾ç½®ç¼ºçœåœ°å€ï¼Œè€Œå¯¼è‡´æ‹¨å·å¤±è´¥ï¼Œæ¯”å¦‚sent [IPCP ConfReq id=0x2 \u0026lt;addr 192.168.199.152\u0026gt; \u0026lt;ms-dns1 0.0.0.0\u0026gt; \u0026lt;ms-dns2 0.0.0.0\u0026gt;] ã€‚ åœ¨ /etc/ppp/peers/ ä¸‹æ–°å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå‘½åä¸º wcdma ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\n/dev/ttyACM0 115200 dump debug lcp-echo-failure 3 lcp-echo-interval 3 # user \u0026quot;card\u0026quot; # password \u0026quot;card\u0026quot; defaultroute ipcp-accept-local ipcp-accept-remote crtscts usepeerdns novj nobsdcomp novjccomp nopcomp noaccomp lock show-password logfile /var/log/pppd.log connect \u0026quot;/usr/sbin/chat -v -f /etc/ppp/peers/he910_connect\u0026quot; å¯¹äº user å’Œ password ï¼Œç”µä¿¡ 3G æ˜¯æœ‰ç”¨æˆ·åå’Œå¯†ç çš„ï¼Œç§»åŠ¨å’Œè”é€šä¸ºç©ºï¼Œæ‰€ä»¥æœ€å¥½ä¸è¦è®¾ç½®ï¼Œå¯ä»¥ç”¨äº•å·æ³¨é‡Šæ‰ï¼Œæ›¾ç»é‡åˆ°è¿‡éšæ„è®¾ç½®è¿™ä¸¤ä¸ªå€¼åï¼Œè¿æ¥è¢«æ‹’ç»çš„æƒ…å†µã€‚æœ€åå¯åŠ¨è¿æ¥ç”¨çš„æ˜¯ chat ï¼Œè´Ÿè´£ä¸ 3G æ¨¡å—çš„ä¸²å£é€šä¿¡ï¼Œæ‹¨æ‰“è¿è¥å•†çš„è°ƒåˆ¶è§£è°ƒå™¨ï¼Œç›®çš„æ˜¯å»ºç«‹ pppd å®ˆæŠ¤è¿›ç¨‹å’Œè¿œç¨‹ pppd è¿›ç¨‹ä¹‹é—´çš„è¿æ¥ï¼Œå¦‚æœç¨‹åºæ‰§è¡Œé”™è¯¯ï¼Œä¼šè¿”å›é”™è¯¯çŠ¶æ€ä»£ç ï¼Œä»£ç çš„å«ä¹‰å¯ä»¥åœ¨ man æ‰‹å†Œä¸­æŸ¥æ‰¾ã€‚chat é€šè¿‡ -f é€‰é¡¹æŒ‡å®šä¸€ä¸ªè„šæœ¬ï¼Œè„šæœ¬çš„å†…å®¹å°±æ˜¯æ‰§è¡Œä¸€äº› AT æŒ‡ä»¤è®¾ç½®æ‹¨å·ç›¸å…³å‚æ•°ã€‚è¿™ä¸ªè„šæœ¬å¦‚ä½•è®¾ç½®ä¹Ÿå¯ä»¥åœ¨æ¨¡å—è½¯ä»¶æ‰‹å†Œé‡Œæ‰¾åˆ°ï¼Œä»¥ HE910 ä¸ºä¾‹ï¼š\n[root@localhost ppp]# cat /etc/ppp/peers/he910_connect #!/bin/sh # init TIMEOUT 30 \u0026quot;\u0026quot; ATZ # Connection to the network '' AT+CGDCONT=1,\u0026quot;IP\u0026quot;,\u0026quot;3gnet\u0026quot; # Dial the number. OK ATD*99# # The modem is waiting for the following answer CONNECT '' AT+CGDCONT æŒ‡ä»¤æ˜¯è®¾ç½®æ‹¨å·çš„å„é¡¹å‚æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯è®¾ç½® PDP ç±»å‹ï¼ŒIP è¡¨ç¤º Internet Protocol ï¼›ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯è®¾ç½® APN ï¼ˆæ¥å…¥ç‚¹åç§°ï¼‰ï¼Œç”±è¿è¥å•†å†³å®šã€‚ ATD æŒ‡ä»¤æ˜¯è®¾ç½®æ‹¨å·å·ç ï¼Œè¿™ä¸ªå€¼ç”±è¿è¥å•†å†³å®šã€‚ CONNECT æŒ‡ä»¤è¡¨ç¤ºå¼€å§‹æ‹¨å·ï¼Œå¹¶ç­‰å¾…å›åº”ã€‚ ä¸‹é¢æ˜¯é’ˆå¯¹ä¸åŒè¿è¥å•†çš„å„é¡¹å‚æ•°è®¾ç½®åˆ—è¡¨ï¼š\nè¿è¥å•†ï¼ˆISPï¼‰ APN æ‹¨å·å·ç  ç”¨æˆ·å å¯†ç  ä¸­å›½è”é€š WCDMA (China Unicom) 3GNET *99# ç©º ç©º ä¸­å›½ç”µä¿¡ CDMA2000 (China Telecom) EVDOç½‘ç»œ ç©º #777 ctnet@mycdma.cn vnet.mobi ä¸­å›½ç§»åŠ¨ TD-SCDMA (China Mobile) CMNET 981# ç©º ç©º ä¸­å›½ç§»åŠ¨ GPRS (China Mobile) CMNET *99***1# ç©º ç©º 4G æ¨¡å—æ‹¨å·çš„è®¾ç½®éƒ½æ²¡æœ‰ç”¨æˆ·åå’Œå¯†ç ï¼Œæ‹¨å·å·ç éƒ½ç”¨ *99# ï¼Œåœ¨æ‹¨å·å‰è¦åˆå§‹åŒ–æ¨¡å—ï¼Œä½¿ç”¨ AT^SYSCFG æˆ–è€… AT^SYSCFGEX æŒ‡ä»¤å°†ç½‘ç»œè¿æ¥é¡ºåºè®¾ä¸º LTE ä¼˜å…ˆã€‚\nè®¾ç½®å®Œæ¯•åï¼Œæ‰§è¡Œ pppd call wcdma ï¼Œç¨‹åºä¼šè‡ªåŠ¨åˆ° /etc/ppp/peers/ ç›®å½•ä¸‹è°ƒç”¨åä¸º wcdma é…ç½®æ–‡ä»¶ï¼Œç„¶åå¼€å§‹æ‹¨å·ï¼Œæ•´ä¸ªè¿‡ç¨‹å¯ä»¥åœ¨æ—¥å¿—æ–‡ä»¶ä¸­æŸ¥çœ‹ã€‚æ‹¨å·æˆåŠŸåä¼šè·å¾— IP å’Œ DNS ï¼ŒDNS ä¿å­˜åœ¨ /var/run/ppp/resolv.conf æ–‡ä»¶ä¸­ã€‚ä¹‹åä¼šè°ƒç”¨ /etc/ppp/ip-up è„šæœ¬æ–‡ä»¶ ï¼š\n[root@localhost ppp]# cat /etc/ppp/ip-up #!/bin/bash # This file should not be modified -- make local changes to # /etc/ppp/ip-up.local instead PATH=/sbin:/usr/sbin:/bin:/usr/bin export PATH LOGDEVICE=$6 REALDEVICE=$1 [ -f /etc/sysconfig/network-scripts/ifcfg-${LOGDEVICE} ] \u0026amp;\u0026amp; /etc/sysconfig/network-scripts/ifup-post --realdevice ${REALDEVICE} ifcfg-${LOGDEVICE} /etc/ppp/ip-up.ipv6to4 ${LOGDEVICE} [ -x /etc/ppp/ip-up.local ] \u0026amp;\u0026amp; /etc/ppp/ip-up.local \u0026quot;$@\u0026quot; exit 0 è¿™ä¸ªè„šæœ¬å…ˆæ‰§è¡Œäº† ifup-post è„šæœ¬ï¼Œä½œç”¨æ˜¯é…ç½® IP ï¼Œé»˜è®¤è·¯ç”±ç­‰ç½‘ç»œå‚æ•°ã€‚ç„¶åæ‰§è¡Œäº† ip-up.local è„šæœ¬ï¼Œè¯¥è„šæœ¬é€šå¸¸ä¸å­˜åœ¨ï¼Œå¯ä»¥å°† /usr/share/doc/ppp/scripts/ip-up.local.add å¤åˆ¶è¿‡æ¥æ”¹åï¼Œè¿™ä¸ªè„šæœ¬çš„ä½œç”¨æ˜¯ï¼Œå¦‚æœåœ¨æ‰§è¡Œ pppd æ—¶è®¾ç½®äº† usepeerdns ï¼Œå°±ç”¨ /var/run/ppp/resolv.conf æ›¿æ¢å½“å‰çš„ DNS ã€‚\n[root@localhost ppp]# cat ip-up.local.add # # This sample code shows you one way to modify your setup to allow automatic # configuration of your resolv.conf for peer supplied DNS addresses when using # the `usepeerdns' option. # # In my case I just added this to my /etc/ppp/ip-up.local script. You may need to # create an executable script if one does not exist. # # Nick Walker (nickwalker@email.com) # . /etc/sysconfig/network-scripts/network-functions if [ -n \u0026quot;$USEPEERDNS\u0026quot; -a -f /var/run/ppp/resolv.conf ]; then rm -f /var/run/ppp/resolv.prev if [ -f /etc/resolv.conf ]; then cp /etc/resolv.conf /var/run/ppp/resolv.prev rscf=/var/run/ppp/resolv.new grep domain /var/run/ppp/resolv.prev \u0026gt; $rscf grep search /var/run/ppp/resolv.prev \u0026gt;\u0026gt; $rscf if [ -f /var/run/ppp/resolv.conf ]; then cat /var/run/ppp/resolv.conf \u0026gt;\u0026gt; $rscf fi change_resolv_conf $rscf rm -f $rscf else change_resolv_conf /var/run/ppp/resolv.conf fi fi 4. wvdial #wvdial æ˜¯ä¸€ä¸ªæ™ºèƒ½ ppp æ‹¨å·å·¥å…·ï¼Œæ›¿æ¢äº† chat ï¼Œç®€åŒ–äº†æ‹¨å·çš„æ­¥éª¤ï¼Œå¯ä»¥ä¸€æ­¥å®ç°æ‹¨å·ã€å¯åŠ¨ pppd ã€æœ€ç»ˆè¿æ¥äº’è”ç½‘ã€‚å®ƒå¸¦æœ‰ä¸€ä¸ªé…ç½®å·¥å…· wvdialconf ï¼Œç”¨äºæ¢æµ‹å½“å‰ç³»ç»Ÿä¸­ 3G æ¨¡å—çš„ä¸²å£ï¼Œç„¶åç”Ÿæˆä¸€ä¸ªé…ç½®æ–‡ä»¶ /etc/wvdial.conf ã€‚è¿˜æ˜¯ä»¥ HE910 ä¸ºä¾‹ï¼Œç”Ÿæˆçš„é…ç½®æ–‡ä»¶ï¼š\n[root@localhost ~]# cat /etc/wvdial.conf [Dialer Defaults] Init2 = ATQ0 V1 E1 S0=0 \u0026amp;C1 \u0026amp;D2 +FCLASS=0 Modem Type = USB Modem ; Phone = \u0026lt;Target Phone Number\u0026gt; ISDN = 0 ; Username = \u0026lt;Your Login Name\u0026gt; Init1 = ATZ ; Password = \u0026lt;Your Password\u0026gt; Modem = /dev/ttyACM0 Baud = 460800 åªéœ€è¦ä¿®æ”¹è´¦å·ã€å¯†ç å’Œæ‹¨å·å·ç å³å¯ï¼Œæ³¨æ„è¦æŠŠå‰é¢çš„åˆ†å·å»æ‰ï¼š\n[root@localhost ~]# cat /etc/wvdial.conf [Dialer Defaults] Init2 = ATQ0 V1 E1 S0=0 \u0026amp;C1 \u0026amp;D2 +FCLASS=0 Modem Type = USB Modem Phone = *99# ISDN = 0 Username = \u0026quot;card\u0026quot; Init1 = ATZ Password = \u0026quot;card\u0026quot; Modem = /dev/ttyACM0 Baud = 460800 é…ç½®æ–‡ä»¶çš„å…¶ä»–é€‰é¡¹å¯ä»¥æŸ¥çœ‹ wvdial.conf çš„ man æ‰‹å†Œï¼Œè¿™äº›å‚æ•°æœ€ç»ˆä¼šä¼ é€’ç»™ pppd ã€‚ç„¶åæ‰§è¡Œ wvdial ï¼š\n[root@localhost ~]# wvdial --\u0026gt; WvDial: Internet dialer version 1.61 --\u0026gt; Initializing modem. --\u0026gt; Sending: ATZ ATZ OK --\u0026gt; Sending: ATQ0 V1 E1 S0=0 \u0026amp;C1 \u0026amp;D2 +FCLASS=0 ATQ0 V1 E1 S0=0 \u0026amp;C1 \u0026amp;D2 +FCLASS=0 OK --\u0026gt; Modem initialized. --\u0026gt; Sending: ATDT*99# --\u0026gt; Waiting for carrier. ATDT*99# CONNECT --\u0026gt; Carrier detected. Waiting for prompt. ~[7f]}#@!}!}!} }8}\u0026quot;}\u0026amp;} } } } }#}$@#}%}\u0026amp;_}8[14][14]}'}\u0026quot;}(}\u0026quot;[1f]P~ --\u0026gt; PPP negotiation detected. --\u0026gt; Starting pppd at Thu Nov 3 17:36:51 2016 --\u0026gt; Pid of pppd: 3393 --\u0026gt; Using interface ppp0 --\u0026gt; local IP address 10.228.54.19 --\u0026gt; remote IP address 10.228.54.19 --\u0026gt; primary DNS address 210.21.196.6 --\u0026gt; secondary DNS address 221.5.88.88 é»˜è®¤ä¼šè‡ªåŠ¨è®¾ç½® default route å’Œ DNS ã€‚å¦‚æœæ²¡æœ‰è‡ªåŠ¨æ›¿æ¢ DNS ï¼Œåº”è¯¥æ˜¯æ²¡æœ‰ /etc/ppp/ip-up.local æ–‡ä»¶ï¼Œå¯ä»¥å¤åˆ¶ä¸€ä¸ªè¿‡æ¥ã€‚æŸ¥çœ‹ pppd è¿›ç¨‹ï¼Œçœ‹çœ‹éƒ½æ‰§è¡Œäº†å“ªäº›å‚æ•°ï¼š\n[root@localhost ~]# ps -ef | grep pppd root 955 954 0 09:02 pts/1 00:00:00 /usr/sbin/pppd 460800 modem crtscts defaultroute usehostname -detach user card noipdefault call wvdial usepeerdns idle 0 logfd 6 remotename 0 root 982 799 0 09:03 pts/0 00:00:00 grep --color=auto pppd [root@localhost ~]# route Kernel IP routing table Destination Gateway Genmask Flags Metric Ref Use Iface default 0.0.0.0 0.0.0.0 U 0 0 0 ppp0 192.168.5.0 0.0.0.0 255.255.255.0 U 0 0 0 enp4s0 è¿™ä¸ªç¨‹åºæ˜¯å‰å°è¿è¡Œçš„ï¼Œç”¨ Ctrl-C é”®å¯ä»¥é€€å‡ºã€‚\n","date":"2016 October 25","permalink":"/posts/2016/10/25/","section":"Posts","summary":"Linux ä¸­ 3G æ¨¡å—çš„å±‚æ¬¡ç»“æ„ï¼š","title":"Linux 3G Module HowTo"},{"content":"NetworkManager æ˜¯ç›®å‰ Linux ç³»ç»Ÿä¸­æä¾›ç½‘ç»œè¿æ¥ç®¡ç†æœåŠ¡çš„ä¸€å¥—è½¯ä»¶ï¼Œä¹Ÿæ”¯æŒä¼ ç»Ÿçš„ ifcfg ç±»å‹é…ç½®æ–‡ä»¶ã€‚æ ¸å¿ƒæ˜¯ NetworkManager å®ˆæŠ¤è¿›ç¨‹ï¼Œè¿˜æä¾›äº†å‘½ä»¤è¡Œå·¥å…· nmcli ï¼Œä»¥åŠå›¾å½¢ç•Œé¢é…ç½®å·¥å…·ã€‚NetworkManager å¯ç”¨äºä»¥ä¸‹è¿æ¥ç±»å‹ï¼šä»¥å¤ªç½‘ã€VLANã€ç½‘æ¡¥ã€ç»‘å®šã€æˆç»„ã€Wi-Fiã€ç§»åŠ¨å®½å¸¦ï¼ˆæ¯”å¦‚ç§»åŠ¨ç½‘ç»œ 3Gï¼‰åŠ IP-over-InfiniBandã€‚åœ¨è¿™äº›è¿æ¥ç±»å‹ä¸­ï¼ŒNetworkManager å¯é…ç½®ç½‘ç»œåˆ«åã€IP åœ°å€ã€é™æ€è·¯ç”±å™¨ã€DNS ä¿¡æ¯åŠ VPN è¿æ¥ä»¥åŠå¾ˆå¤šå…·ä½“è¿æ¥å‚æ•°ã€‚æœ€åï¼ŒNetworkManager é€šè¿‡ D-bus æä¾› APIï¼ŒD-Bus å…è®¸åº”ç”¨ç¨‹åºæŸ¥è¯¢å¹¶æ§åˆ¶ç½‘ç»œé…ç½®åŠçŠ¶æ€ã€‚\nå¯åŠ¨ã€åœæ­¢ã€æŸ¥çœ‹ NetworkManager æœåŠ¡ï¼š\n[root@localhost ~]# systemctl start|stop|restart|status NetworkManager NetworkManager çš„é…ç½®æ–‡ä»¶å’Œè„šæœ¬ä¿å­˜åœ¨ /etc/sysconfig/ ç›®å½•ä¸­ã€‚å¤§å¤šæ•°ç½‘ç»œé…ç½®ä¿¡æ¯éƒ½ä¿å­˜åœ¨è¿™é‡Œï¼ŒVPNã€ç§»åŠ¨å®½å¸¦åŠ PPPoE é…ç½®é™¤å¤–ï¼Œè¿™äº›é…ç½®ä¿å­˜åœ¨ /etc/NetworkManager/ å­ç›®å½•ä¸­ã€‚ä¾‹å¦‚ï¼Œæ¥å£çš„å…·ä½“ä¿¡æ¯æ˜¯ä¿å­˜åœ¨ /etc/sysconfig/network-scripts/ ç›®å½•ä¸‹çš„ ifcfg-* æ–‡ä»¶ä¸­ã€‚å…¨å±€è®¾ç½®ä½¿ç”¨ /etc/sysconfig/network æ–‡ä»¶\nåœ¨å‘½ä»¤è¡Œä¸­ï¼Œå¯ä»¥ä½¿ç”¨ nmcli å·¥å…·ä¸ NetworkManager è¿›è¡Œäº¤äº’ã€‚ä¾‹å¦‚ï¼Œä¿®æ”¹äº†æŸä¸ª ifcfg-* æ–‡ä»¶åï¼Œéœ€è¦æ‰‹åŠ¨è½½å…¥ï¼Œå¯ä»¥æ‰§è¡Œï¼š\n[root@localhost ~]# nmcli connection load /etc/sysconfig/network-scripts/ifcfg-ifname å¦‚æœè¦é‡æ–°è½½å…¥å…¨éƒ¨é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥æ‰§è¡Œ ï¼š\n[root@localhost ~]# nmcli connection reload å¯ä»¥æ‰§è¡Œ nmcli help æŸ¥çœ‹è¯¥å‘½ä»¤çš„è¯­æ³•ï¼Œå‘½ä»¤çš„å„ç§å‚æ•°éƒ½å¯ä»¥ç”¨ Tab é”®è¡¥å…¨ã€‚\n[root@localhost ~]# nmcli help Usage: nmcli [OPTIONS] OBJECT { COMMAND | help } OPTIONS -t[erse] ç®€æ´è¾“å‡º -p[retty] ç¾åŒ–è¾“å‡º -m[ode] tabular|multiline è¾“å‡ºæ¨¡å¼ -f[ields] \u0026lt;field1,field2,...\u0026gt;|all|common æŒ‡å®šå­—æ®µè¾“å‡º -e[scape] yes|no æŒ‡å®šåˆ†éš”ç¬¦ -n[ocheck] ä¸æ£€æµ‹ç‰ˆæœ¬ -a[sk] è¯¢é—®ç¼ºå¤±å‚æ•° -w[ait] \u0026lt;seconds\u0026gt; è®¾ç½®è¶…æ—¶ç­‰å¾…å®Œæˆæ“ä½œ -v[ersion] æ˜¾ç¤ºç‰ˆæœ¬ -h[elp] è·å¾—å¸®åŠ© OBJECT g[eneral] å¸¸è§„ç®¡ç† n[etworking] å…¨é¢çš„ç½‘ç»œæ§åˆ¶ r[adio] æ— çº¿ç½‘ç»œç®¡ç† c[onnection] ç½‘ç»œè¿æ¥ç®¡ç† d[evice] ç½‘ç»œè®¾å¤‡ç®¡ç† a[gent] ç½‘ç»œä»£ç†ç®¡ç† åˆ—å‡ºæ‰€æœ‰çš„ç½‘ç»œè®¾å¤‡ï¼š\n[root@localhost ~]# nmcli device show GENERAL.DEVICE: enp4s0 GENERAL.TYPE: ethernet GENERAL.HWADDR: 00:1D:F3:51:95:4D GENERAL.MTU: 1500 GENERAL.STATE: 100 (connected) GENERAL.CONNECTION: enp4s0 GENERAL.CON-PATH: /org/freedesktop/NetworkManager/ActiveConnection/0 WIRED-PROPERTIES.CARRIER: on IP4.ADDRESS[1]: ip = 192.168.5.242/24, gw = 0.0.0.0 IP6.ADDRESS[1]: ip = fe80::21d:f3ff:fe51:954d/64, gw = :: GENERAL.DEVICE: ttyACM3 GENERAL.TYPE: gsm GENERAL.HWADDR: (unknown) GENERAL.MTU: 0 GENERAL.STATE: 30 (disconnected) GENERAL.CONNECTION: -- GENERAL.CON-PATH: -- GENERAL.DEVICE: lo GENERAL.TYPE: loopback GENERAL.HWADDR: 00:00:00:00:00:00 GENERAL.MTU: 65536 GENERAL.STATE: 10 (unmanaged) GENERAL.CONNECTION: -- GENERAL.CON-PATH: -- æŸ¥çœ‹æ‰€æœ‰ç½‘ç»œè®¾å¤‡çš„çŠ¶æ€ï¼š\n[root@localhost ~]# nmcli device status DEVICE TYPE STATE CONNECTION enp4s0 ethernet connected enp4s0 ttyACM3 gsm disconnected -- lo loopback unmanaged -- æŸ¥çœ‹æ‰€æœ‰çš„ç½‘ç»œè¿æ¥ï¼š\n[root@localhost ~]# nmcli connection show NAME UUID TYPE DEVICE enp4s0 f056272b-e28a-4e69-8264-af9fccfbf45d 802-3-ethernet enp4s0 å¯ä»¥çœ‹åˆ°ï¼Œæœ¬æœºæœ‰ä¸€ä¸ªä»¥å¤ªç½‘å¡å’Œä¸€ä¸ª 3G ç½‘å¡ï¼Œåªæœ‰ä»¥å¤ªç½‘ä½¿èƒ½äº†è¿æ¥ï¼Œ3G ç½‘å¡å¤„äºæœªè¿æ¥çŠ¶æ€ã€‚TYPE å­—æ®µè¡¨ç¤ºè¿æ¥ç±»å‹ï¼Œæ”¯æŒçš„å€¼æœ‰ï¼šadsl, bond, bond-slave, bridge, bridge-slave, bluetooth, cdma, ethernet, gsm, infiniband, olpc-mesh, team, team-slave, vlan, wifi, wimaxã€‚å¯ä»¥åœ¨æ–°å»ºæˆ–è€…ç¼–è¾‘è¿æ¥æ—¶ç”¨ type å‚æ•°è®¾ç½®ï¼ŒæŒ‰ Tab é”®æŸ¥çœ‹è¯¥åˆ—è¡¨ï¼Œæˆ–æŸ¥çœ‹ nmcli(1) man page ä¸­çš„ TYPE_SPECIFIC_OPTIONS åˆ—è¡¨ã€‚\nDEVICE è¡¨ç¤ºè®¾å¤‡åç§°ï¼Œå¦‚æœæ˜¯ä»¥å¤ªç½‘æˆ–è€…WiFiï¼Œå°±æ˜¯ç”¨ ifconfig -a çœ‹åˆ°çš„åç§°ã€‚CONNECTION è¡¨ç¤ºè¿æ¥åç§°ï¼Œè¿™æ˜¯åœ¨è¿æ¥é…ç½®æ–‡ä»¶çš„åç§°ï¼Œè¿™é‡Œçš„ä»¥å¤ªç½‘é…ç½®æ–‡ä»¶æ˜¯ ifcfg-enp4s0 ã€‚å¯ä»¥åœ¨æ–°å»ºè¿æ¥æ—¶ç”¨ con-name å‚æ•°è®¾ç½®ã€‚\n1. ä»¥å¤ªç½‘ #æ–°å»ºä¸€ä¸ªä»¥å¤ªç½‘è¿æ¥ï¼Œä½¿ç”¨åŠ¨æ€ IP ï¼š\n[root@localhost ~]# nmcli connection add type ethernet con-name connection-name ifname interface-name è¿™æ ·ä¼šåœ¨ /etc/sysconfig/network-scripts/ ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª ifcfg-* é…ç½®æ–‡ä»¶ã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¿€æ´»ä»¥å¤ªç½‘è¿æ¥ï¼š\n[root@localhost ~]# nmcli con up my-office Connection successfully activated (D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/5) ç”¨å¦‚ä¸‹å‘½ä»¤å¯ä»¥æŸ¥çœ‹è¯¥è¿æ¥çš„è¯¦ç»†ä¿¡æ¯ï¼š\n[root@localhost ~]# nmcli connection show enp4s0 2. 3G ç½‘å¡ #æŸ¥çœ‹è¿™ä¸ªè®¾å¤‡çš„è¯¦æƒ…ï¼š\n[root@localhost ~]# nmcli device show ttyACM3 GENERAL.DEVICE: ttyACM3 GENERAL.TYPE: gsm GENERAL.HWADDR: (unknown) GENERAL.MTU: 0 GENERAL.STATE: 30 (disconnected) GENERAL.CONNECTION: -- GENERAL.CON-PATH: -- æ–°å»ºä¸€ä¸ª 3G ç½‘å¡çš„è¿æ¥ï¼š\n[root@localhost ~]# nmcli connection add type gsm ifname ttyACM3 user 3gnet password 3gnet apn 3gnet Connection 'gsm-ttyACM3' (d15e8860-6dc1-4aa5-b579-b898e651a984) successfully added. è¿™ä¼šåœ¨ /etc/NetworkManager/system-connections/ ä¸‹ç”Ÿæˆä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå¹¶ä¸”ä¼šè‡ªåŠ¨è¿æ¥ï¼Œç”Ÿæˆä¸€ä¸ª ppp0 çš„ç½‘ç»œè®¾å¤‡ï¼š\n[root@localhost ~]# cat gsm-ttyACM3 [connection] id=gsm-ttyACM3 uuid=7561e339-43b7-4e7f-bc2c-5886b5a97afc interface-name=ttyACM3 type=gsm [gsm] number=*99# username=3gnet password=3gnet apn=3gnet [root@localhost ~]# nmcli device status DEVICE TYPE STATE CONNECTION enp4s0 ethernet connected enp4s0 ttyACM3 gsm connected gsm-ttyACM3 ppp0 unknown connected ppp0 lo loopback unmanaged -- ~]# nmcli connection show NAME UUID TYPE DEVICE ppp0 9e55469f-b362-4122-8031-aa18360a8d75 generic ppp0 gsm-ttyACM3 7561e339-43b7-4e7f-bc2c-5886b5a97afc gsm ttyACM3 enp4s0 f056272b-e28a-4e69-8264-af9fccfbf45d 802-3-ethernet enp4s0 è¦å–æ¶ˆè‡ªåŠ¨è¿æ¥ï¼Œéœ€è¦å°† autoconnect è®¾ä¸º false ï¼š\n[root@localhost ~]# nmcli connection modify gsm-ttyACM3 connection.autoconnect false [root@localhost ~]# cat /etc/NetworkManager/system-connections/gsm-ttyACM3 [connection] id=gsm-ttyACM3 uuid=86f38b5b-31e3-4250-8304-c94a8fe7ac29 interface-name=ttyACM3 type=gsm autoconnect=false [gsm] number=*99# username=3gnet password=3gnet apn=3gnet 3. WiFi #ç”¨å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹å¯è®¿é—®çš„ WiFi çƒ­ç‚¹ï¼š\n[root@localhost ~]# nmcli device wifi list * SSID MODE CHAN RATE SIGNAL BARS SECURITY SBSon Infra 4 54 Mbit/s 84 Ã¢â€“â€šÃ¢â€“â€Ã¢â€“â€ Ã¢â€“Ë† WPA1 WPA2 TP-LINK_3 Infra 1 54 Mbit/s 77 Ã¢â€“â€šÃ¢â€“â€Ã¢â€“â€ _ WPA2 readtime Infra 1 54 Mbit/s 70 Ã¢â€“â€šÃ¢â€“â€Ã¢â€“â€ _ WPA2 sbstest Infra 1 54 Mbit/s 59 Ã¢â€“â€šÃ¢â€“â€Ã¢â€“â€ _ WPA1 WPA2 Xiaomi Infra 1 54 Mbit/s 57 Ã¢â€“â€šÃ¢â€“â€Ã¢â€“â€ _ WPA2 wifi-360 Infra 6 54 Mbit/s 47 Ã¢â€“â€šÃ¢â€“â€__ WPA2 æ–°å»ºä¸€ä¸ªåä¸º wifi-con çš„ WiFi è¿æ¥ï¼š\n[root@localhost ~]# nmcli connection add con-name wifi-con ifname wlp1s0 type wifi ssid TP-LINK_3 Connection 'wifi-con' (7c5ae676-a2c7-49df-a37b-d93787be2b72) successfully added. è®¾ç½®åŠ å¯†æ–¹å¼ä¸º WPA2 ï¼Œå¹¶è®¾ç½®å¯†ç ï¼š\n[root@localhost ~]# nmcli connection modify wifi-con wifi-sec.key-mgmt wpa-psk [root@localhost ~]# nmcli connection modify wifi-con wifi-sec.psk 87654321 æ¿€æ´»è¯¥è¿æ¥ï¼š\n[root@localhost ~]# nmcli connection up wifi-con Connection successfully activated (D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/3) [root@localhost ~]# iwconfig lo no wireless extensions. enp4s0 no wireless extensions. wlp1s0 IEEE 802.11abgn ESSID:\u0026quot;TP-LINK_3\u0026quot; Mode:Managed Frequency:2.412 GHz Access Point: 64:09:80:64:2F:8E Bit Rate=1 Mb/s Tx-Power=15 dBm Retry short limit:7 RTS thr:off Fragment thr:off Encryption key:off Power Management:off Link Quality=44/70 Signal level=-66 dBm Rx invalid nwid:0 Rx invalid crypt:0 Rx invalid frag:0 Tx excessive retries:3 Invalid misc:20 Missed beacon:0 ","date":"2016 October 13","permalink":"/posts/2016/10/13/","section":"Posts","summary":"NetworkManager æ˜¯ç›®å‰ Linux ç³»ç»Ÿä¸­æä¾›ç½‘ç»œè¿æ¥ç®¡ç†æœåŠ¡çš„ä¸€å¥—è½¯ä»¶ï¼Œä¹Ÿæ”¯æŒä¼ ç»Ÿçš„ ifcfg ç±»å‹é…ç½®æ–‡ä»¶ã€‚æ ¸å¿ƒæ˜¯ NetworkManager å®ˆæŠ¤è¿›ç¨‹ï¼Œè¿˜æä¾›äº†å‘½ä»¤è¡Œå·¥å…· nmcli ï¼Œä»¥åŠå›¾å½¢ç•Œé¢é…ç½®å·¥å…·ã€‚NetworkManager å¯ç”¨äºä»¥ä¸‹è¿æ¥ç±»å‹ï¼šä»¥å¤ªç½‘ã€VLANã€ç½‘æ¡¥ã€ç»‘å®šã€æˆç»„ã€Wi-Fiã€ç§»åŠ¨å®½å¸¦ï¼ˆæ¯”å¦‚ç§»åŠ¨ç½‘ç»œ 3Gï¼‰åŠ IP-over-InfiniBandã€‚åœ¨è¿™äº›è¿æ¥ç±»å‹ä¸­ï¼ŒNetworkManager å¯é…ç½®ç½‘ç»œåˆ«åã€IP åœ°å€ã€é™æ€è·¯ç”±å™¨ã€DNS ä¿¡æ¯åŠ VPN è¿æ¥ä»¥åŠå¾ˆå¤šå…·ä½“è¿æ¥å‚æ•°ã€‚æœ€åï¼ŒNetworkManager é€šè¿‡ D-bus æä¾› APIï¼ŒD-Bus å…è®¸åº”ç”¨ç¨‹åºæŸ¥è¯¢å¹¶æ§åˆ¶ç½‘ç»œé…ç½®åŠçŠ¶æ€ã€‚","title":"NetworkManager ä½¿ç”¨ç¬”è®°"},{"content":"1. ç®€ä»‹ #BitBake æ˜¯ç”¨ Python å†™çš„ä¸€ä¸ªç¨‹åºï¼Œå®ƒæ˜¯ OpenEmbedded æ„å»ºç³»ç»Ÿæ—¶ä½¿ç”¨çš„ç”Ÿäº§å·¥å…·ï¼Œç°åœ¨æœ‰å¾ˆå¤šåµŒå…¥å¼ç³»ç»Ÿéƒ½æ˜¯åœ¨ä½¿ç”¨ï¼Œæ¯”å¦‚Yocto ã€WindRiver Linux ç­‰ã€‚å®ƒæ˜¯ä¸€ä¸ªå¤šä»»åŠ¡å¼•æ“ï¼Œå¯ä»¥å¹¶è¡Œæ‰§è¡Œ shell å’Œ Python ä»»åŠ¡ï¼Œæ¯ä¸ªä»»åŠ¡å•å…ƒæ ¹æ®é¢„å®šä¹‰çš„å…ƒæ•°æ®æ¥ç®¡ç†æºç ã€é…ç½®ã€ç¼–è¯‘ã€æ‰“åŒ…ï¼Œå¹¶æœ€ç»ˆå°†æ¯ä¸ªä»»åŠ¡ç”Ÿæˆçš„æ–‡ä»¶é›†åˆæˆä¸ºç³»ç»Ÿé•œåƒã€‚ä¾‹å¦‚è¦ä»æºç æ„å»ºä¸€ä¸ª Linux ç³»ç»Ÿï¼Œéœ€è¦æ­å»ºä¸€ä¸ªç”Ÿäº§ç¯å¢ƒï¼Œç„¶åä¾æ¬¡ç”Ÿæˆ Grubã€Kernelã€å„ç§åº“æ–‡ä»¶ã€å„ç§å¯æ‰§è¡Œæ–‡ä»¶ï¼Œç„¶åé›†åˆåˆ°ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿé‡Œã€‚å¦‚æœä½ ç©è¿‡ LFS ï¼Œå°±ä¼šäº†è§£è¿™ä¸ªè¿‡ç¨‹çš„å¤æ‚æ€§ã€‚BitBake å­˜åœ¨çš„æ„ä¹‰å°±æ˜¯æä¾›äº†ä¸€ä¸ªé«˜æ•ˆçš„å·¥å…·ï¼Œå°†è¿™ä¸ªè¿‡ç¨‹æ ‡å‡†åŒ–ã€æµç¨‹åŒ–ã€‚BitBake ä¸ GNU Make çš„å…³ç³»å°±åƒ GNU Make ä¹‹äº GCC ï¼Œè¿ä½œæ–¹å¼ä¹Ÿç±»ä¼¼ GNU Make ï¼Œåˆæœ‰å¾ˆå¤šä¸åŒï¼š\nBitBake æ ¹æ®é¢„å…ˆå®šä¹‰çš„å…ƒæ•°æ®æ‰§è¡Œä»»åŠ¡ï¼Œè¿™äº›å…ƒæ•°æ®å®šä¹‰äº†æ‰§è¡Œä»»åŠ¡æ‰€éœ€çš„å˜é‡ï¼Œæ‰§è¡Œä»»åŠ¡çš„è¿‡ç¨‹ï¼Œä»¥åŠä»»åŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œå®ƒä»¬å­˜å‚¨åœ¨ recipe(.bb)ã€append(.bbappend)ã€configuration(.conf)ã€include(.inc) å’Œ class(.bbclass) æ–‡ä»¶ä¸­ã€‚ BitBake åŒ…å«ä¸€ä¸ªæŠ“å–å™¨ï¼Œç”¨äºä»ä¸åŒçš„ä½ç½®è·å–æºç ï¼Œä¾‹å¦‚æœ¬åœ°æ–‡ä»¶ã€æºç æ§åˆ¶å™¨(git)ã€ç½‘ç«™ç­‰ã€‚ æ¯ä¸€ä¸ªä»»åŠ¡å•å…ƒçš„ç»“æ„é€šè¿‡ recipe æ–‡ä»¶æè¿°ï¼Œæè¿°çš„ä¿¡æ¯æœ‰ä¾èµ–å…³ç³»ã€æºç ä½ç½®ã€ç‰ˆæœ¬ä¿¡æ¯ã€æ ¡éªŒå’Œã€è¯´æ˜ç­‰ç­‰ã€‚ BitBake åŒ…å«äº†ä¸€ä¸ª C/S çš„æŠ½è±¡æ¦‚å¿µï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œæˆ–è€… XML-RPC ä½¿ç”¨ï¼Œæ‹¥æœ‰å¤šç§ç”¨æˆ·æ¥å£ã€‚ å‡ ä¸ªæ¦‚å¿µï¼š\nRecipe ã€‚Recipe æ–‡ä»¶æ˜¯æœ€åŸºæœ¬çš„å…ƒæ•°æ®æ–‡ä»¶ï¼Œæ¯ä¸ªä»»åŠ¡å•å…ƒå¯¹åº”ä¸€ä¸ª Recipe æ–‡ä»¶ï¼Œåç¼€æ˜¯ .bb ï¼Œè¿™ç§æ–‡ä»¶ä¸º BitBake æä¾›çš„ä¿¡æ¯åŒ…æ‹¬è½¯ä»¶åŒ…çš„åŸºæœ¬ä¿¡æ¯ï¼ˆä½œè€…ã€ç‰ˆæœ¬ã€Licenseç­‰ï¼‰ã€ä¾èµ–å…³ç³»ã€æºç çš„ä½ç½®å’Œè·å–æ–¹æ³•ã€è¡¥ä¸ã€é…ç½®å’Œç¼–è¯‘æ–¹æ³•ã€å¦‚ä½•æ‰“åŒ…å’Œå®‰è£…ã€‚ Configuration ã€‚Configuration æ–‡ä»¶çš„åç¼€æ˜¯ .conf ï¼Œå®ƒä¼šåœ¨å¾ˆå¤šåœ°æ–¹å‡ºç°ï¼Œå®šä¹‰äº†å¤šç§å˜é‡ï¼ŒåŒ…æ‹¬ç¡¬ä»¶æ¶æ„é€‰é¡¹ã€ç¼–è¯‘å™¨é€‰é¡¹ã€é€šç”¨é…ç½®é€‰é¡¹ã€ç”¨æˆ·é…ç½®é€‰é¡¹ã€‚ä¸» Configuration æ–‡ä»¶æ˜¯ bitbake.conf ï¼Œä»¥ Yocto ä¸ºä¾‹ï¼Œä½äº ./poky/meta/conf/bitbake.conf ï¼Œå…¶ä»–éƒ½åœ¨æºç æ ‘çš„ conf ç›®å½•ä¸‹ã€‚ Classes ã€‚Class æ–‡ä»¶çš„åç¼€æ˜¯ .bbclass ï¼Œå®ƒçš„å†…å®¹æ˜¯å…ƒæ•°æ®æ–‡ä»¶ä¹‹é—´çš„å…±äº«ä¿¡æ¯ã€‚BitBake æºç æ ‘éƒ½æºè‡ªä¸€ä¸ªå«åš base.bbclass çš„æ–‡ä»¶ï¼Œåœ¨ Yocto ä¸­ä½äº ./poky/meta/classes/base.bbclass ï¼Œå®ƒä¼šè¢«æ‰€æœ‰çš„ recipe å’Œ class æ–‡ä»¶è‡ªåŠ¨åŒ…å«ã€‚å®ƒåŒ…å«äº†æ ‡å‡†ä»»åŠ¡çš„åŸºæœ¬å®šä¹‰ï¼Œä¾‹å¦‚è·å–ã€è§£å‹ã€é…ç½®ã€ç¼–è¯‘ã€å®‰è£…ã€æ‰“åŒ…ï¼Œæœ‰äº›å®šä¹‰åªæ˜¯æ¡†æ¶ï¼Œå†…å®¹æ˜¯ç©ºçš„ã€‚ Layers ã€‚Layer è¢«ç”¨æ¥åˆ†ç±»ä¸åŒçš„ä»»åŠ¡å•å…ƒã€‚æŸäº›ä»»åŠ¡å•å…ƒæœ‰å…±åŒçš„ç‰¹æ€§ï¼Œå¯ä»¥æ”¾åœ¨ä¸€ä¸ª Layer ä¸‹ï¼Œæ–¹ä¾¿æ¨¡å—åŒ–ç»„ç»‡å…ƒæ•°æ®ï¼Œä¹Ÿæ–¹ä¾¿æ—¥åä¿®æ”¹ã€‚ä¾‹å¦‚è¦å®šåˆ¶ä¸€å¥—æ”¯æŒç‰¹å®šç¡¬ä»¶çš„ç³»ç»Ÿï¼Œå¯ä»¥æŠŠä¸ä½å±‚ç›¸å…³çš„å•å…ƒæ”¾åœ¨ä¸€ä¸ª layer ä¸­ï¼Œè¿™å«åš Board Support Package(BSP) Layer ã€‚ Append ã€‚Append æ–‡ä»¶çš„åç¼€æ˜¯ .bbappend ï¼Œç”¨äºæ‰©å±•æˆ–è€…è¦†ç›– recipe æ–‡ä»¶çš„ä¿¡æ¯ã€‚BitBake å¸Œæœ›æ¯ä¸€ä¸ª append æ–‡ä»¶éƒ½æœ‰ä¸€ä¸ªç›¸å¯¹åº”çš„ recipe æ–‡ä»¶ï¼Œä¸¤ä¸ªæ–‡ä»¶ä½¿ç”¨åŒæ ·çš„æ–‡ä»¶åï¼Œåªæ˜¯åç¼€ä¸åŒï¼Œä¾‹å¦‚ formfactor_0.0.bb å’Œ formfactor_0.0.bbappend ã€‚å‘½å append æ–‡ä»¶æ—¶ï¼Œå¯ä»¥ç”¨ç™¾åˆ†å·ï¼ˆ%ï¼‰æ¥é€šé… recipe æ–‡ä»¶åã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªåä¸º busybox_1.21.%.bbappend çš„ apend æ–‡ä»¶å¯ä»¥å¯¹åº”ä»»ä½•åä¸º busybox_1.21.x.bb çš„ recipe æ–‡ä»¶è¿›è¡Œæ‰©å±•å’Œè¦†ç›–ï¼Œæ–‡ä»¶åä¸­çš„ x å¯ä»¥ä¸ºä»»ä½•å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚ busybox_1.21.1.bbã€busybox_1.21.2.bb \u0026hellip; é€šå¸¸ç”¨ç™¾åˆ†å·æ¥é€šé…ç‰ˆæœ¬å·ã€‚ BitBake å‘½ä»¤çš„è¯­æ³•å¯ä»¥æ‰§è¡Œ bitbake -h æŸ¥çœ‹ã€‚-b ç”¨äºæŒ‡å®š recipe æ–‡ä»¶ï¼Œ-c ç”¨äºæŒ‡å®šè¦æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šä»»åŠ¡ï¼Œä¼šæŒ‰ç…§ recipe æ–‡ä»¶å®Œæ•´çš„æ‰§è¡Œä¸€æ¬¡ä»è·å–æºç åˆ°ç¼–è¯‘æ‰“åŒ…çš„è¿‡ç¨‹ã€‚è¦ç¼–è¯‘ä¸€ä¸ªåä¸º foo_1.0.bb çš„åŒ…ï¼Œå¯ä»¥æ‰§è¡Œï¼š\n$ bitbake -b foo_1.0.bb å¯ä»¥ä¸ç”¨ -b ï¼Œè€Œåªå†™åŒ…çš„åå­—ï¼Œä¸åŠ ä¸‹åˆ’çº¿åçš„ç‰ˆæœ¬å·å’Œåç¼€ï¼Œç®€åŒ–ä¸ºï¼š\n$ bitbake foo å¦‚æœè¦æ‰§è¡Œæ¸…é™¤ä»»åŠ¡ï¼š\n$ bitbake foo -c clean 2. å·¥ä½œæµç¨‹ #è¿è¡Œ BitBake çš„ä¸»è¦ç›®çš„æ˜¯ç”Ÿæˆä¸€ä¸ªä¸œè¥¿ï¼Œä¾‹å¦‚å®‰è£…åŒ…ã€å†…æ ¸ã€é“¾æ¥åº“ã€æˆ–è€…ä¸€ä¸ªå®Œæ•´çš„ Linux ç³»ç»Ÿå¯åŠ¨é•œåƒï¼ˆåŒ…æ‹¬ bootloaderã€kernelã€æ ¹æ–‡ä»¶ç³»ç»Ÿï¼‰ã€‚å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡ä½¿ç”¨ bitbake å‘½ä»¤çš„æŸäº›å‚æ•°ï¼Œåªæ‰§è¡Œç”Ÿæˆè¿‡ç¨‹ä¸­çš„æŸä¸ªæ­¥éª¤ï¼Œä¾‹å¦‚ç¼–è¯‘ã€è·å–æˆ–æ¸…é™¤æ•°æ®ã€æˆ–è€…åªè¿”å›ç¼–è¯‘ç¯å¢ƒçš„ä¿¡æ¯ã€‚\nç®€å•è¯´ä¸€ä¸‹ä½¿ç”¨ BitBake ç”Ÿæˆç³»ç»Ÿé•œåƒçš„çš„æ‰§è¡Œè¿‡ç¨‹ã€‚\n2.1 åˆ†æåŸºæœ¬å…ƒæ•°æ® #åŸºæœ¬å…ƒæ•°æ®ç”±å¤šä¸ªæ–‡ä»¶ç»„æˆï¼ŒåŒ…æ‹¬ bblayers.conf æ–‡ä»¶ï¼ˆå®šä¹‰é¡¹ç›®æ‰€éœ€çš„ layersï¼‰ã€æ¯ä¸ª layer çš„ layer.conf æ–‡ä»¶ã€ä»¥åŠ bitbake.conf æ–‡ä»¶ã€‚æ•°æ®å†…å®¹æœ‰å¦‚ä¸‹å‡ ç±»ï¼š\nRecipesï¼šç‰¹å®šè½¯ä»¶åŒ…çš„è¯¦æƒ…ã€‚ Class Dataï¼šé€šç”¨æ„å»ºä¿¡æ¯çš„æŠ½è±¡æ€»ç»“ã€‚ Configuration Dataï¼šé’ˆå¯¹ç‰¹å®šæœºå™¨çš„è®¾ç½®ï¼Œç›¸å½“äºç²˜åˆå‰‚ï¼ŒæŠŠæ‰€æœ‰è½¯ä»¶é›†åˆåˆ°ä¸€èµ·ã€‚ åŸºæœ¬å…ƒæ•°æ®éƒ½å…·æœ‰å…¨å±€å±æ€§ï¼Œæ‰€æœ‰å®ƒä»¬å¯¹æ‰€æœ‰çš„ recipes éƒ½æœ‰æ•ˆã€‚\né¦–å…ˆï¼ŒBitBake ä¼šå…ˆæœç´¢å½“å‰å·¥ä½œç›®å½•ä¸‹çš„ conf/bblayers.conf æ–‡ä»¶ã€‚è¯¥æ–‡ä»¶åŒ…å«ä¸€ä¸ª BBLAYERS å˜é‡ï¼Œå®ƒä¼šåˆ—å‡ºæ‰€æœ‰é¡¹ç›®æ‰€éœ€çš„ layer çš„ç›®å½•ã€‚åœ¨ BBLAYERS æ‰€åˆ—å‡ºçš„ layer ç›®å½•ä¸­ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ª conf/layer.conf æ–‡ä»¶ï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ä¼šæœ‰ä¸€ä¸ª LAYERDIR å˜é‡ï¼Œå®ƒè®°å½•äº†è¯¥ layer çš„å®Œæ•´è·¯å¾„ã€‚è¿™äº› layer.conf æ–‡ä»¶ä¼šè‡ªåŠ¨æ„å»ºä¸€äº›å…³é”®çš„å˜é‡ï¼Œä¾‹å¦‚ BBPATH å’Œ BBFILES ã€‚BBPATH è®°å½•äº† conf å’Œ classes ç›®å½•ä¸‹çš„ configuration å’Œ classes æ–‡ä»¶çš„ä½ç½®ï¼ŒBBFILES åˆ™ç”¨äºå®šä½ .bb å’Œ .bbappdend æ–‡ä»¶ã€‚å¦‚æœæ‰¾ä¸åˆ° bblayers.conf æ–‡ä»¶ï¼ŒBitBake ä¼šè®¤ä¸ºç”¨æˆ·å·²ç»åœ¨ç¯å¢ƒå˜é‡ä¸­è®¾ç½®äº† BBPATH å’Œ BBFILES ã€‚\nå…¶æ¬¡ï¼ŒBitBake ä¼šåœ¨ BBPATH è®°å½•çš„ä½ç½®ä¸­å¯»æ‰¾ conf/bitbake.conf æ–‡ä»¶ã€‚è¯¥é…ç½®æ–‡ä»¶åŒ…å«äº†\nå‚è€ƒ #BitBake User Manual Yocto å®ç”¨ç¬”è®°\n","date":"2016 September 12","permalink":"/posts/2016/09/12/","section":"Posts","summary":"1. ç®€ä»‹ #BitBake æ˜¯ç”¨ Python å†™çš„ä¸€ä¸ªç¨‹åºï¼Œå®ƒæ˜¯ OpenEmbedded æ„å»ºç³»ç»Ÿæ—¶ä½¿ç”¨çš„ç”Ÿäº§å·¥å…·ï¼Œç°åœ¨æœ‰å¾ˆå¤šåµŒå…¥å¼ç³»ç»Ÿéƒ½æ˜¯åœ¨ä½¿ç”¨ï¼Œæ¯”å¦‚Yocto ã€WindRiver Linux ç­‰ã€‚å®ƒæ˜¯ä¸€ä¸ªå¤šä»»åŠ¡å¼•æ“ï¼Œå¯ä»¥å¹¶è¡Œæ‰§è¡Œ shell å’Œ Python ä»»åŠ¡ï¼Œæ¯ä¸ªä»»åŠ¡å•å…ƒæ ¹æ®é¢„å®šä¹‰çš„å…ƒæ•°æ®æ¥ç®¡ç†æºç ã€é…ç½®ã€ç¼–è¯‘ã€æ‰“åŒ…ï¼Œå¹¶æœ€ç»ˆå°†æ¯ä¸ªä»»åŠ¡ç”Ÿæˆçš„æ–‡ä»¶é›†åˆæˆä¸ºç³»ç»Ÿé•œåƒã€‚ä¾‹å¦‚è¦ä»æºç æ„å»ºä¸€ä¸ª Linux ç³»ç»Ÿï¼Œéœ€è¦æ­å»ºä¸€ä¸ªç”Ÿäº§ç¯å¢ƒï¼Œç„¶åä¾æ¬¡ç”Ÿæˆ Grubã€Kernelã€å„ç§åº“æ–‡ä»¶ã€å„ç§å¯æ‰§è¡Œæ–‡ä»¶ï¼Œç„¶åé›†åˆåˆ°ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿé‡Œã€‚å¦‚æœä½ ç©è¿‡ LFS ï¼Œå°±ä¼šäº†è§£è¿™ä¸ªè¿‡ç¨‹çš„å¤æ‚æ€§ã€‚BitBake å­˜åœ¨çš„æ„ä¹‰å°±æ˜¯æä¾›äº†ä¸€ä¸ªé«˜æ•ˆçš„å·¥å…·ï¼Œå°†è¿™ä¸ªè¿‡ç¨‹æ ‡å‡†åŒ–ã€æµç¨‹åŒ–ã€‚BitBake ä¸ GNU Make çš„å…³ç³»å°±åƒ GNU Make ä¹‹äº GCC ï¼Œè¿ä½œæ–¹å¼ä¹Ÿç±»ä¼¼ GNU Make ï¼Œåˆæœ‰å¾ˆå¤šä¸åŒï¼š","title":"BitBake ä½¿ç”¨ç¬”è®°"},{"content":"åŸæ–‡ï¼šStart Developing iOS Apps (Swift)\nTranslated by Bob\n2016-05-06\nBlogï¼šhttp://shaocheng.li\n1. Get Start #1.1. Jump Right In #è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ iPad/iPhone App å¼€å‘å…¥é—¨æ–‡æ¡£ã€‚è¿™ä¸€ç³»åˆ—è¯¾ç¨‹å¯ä»¥é€æ­¥æŒ‡å¯¼ä½ å†™å‡ºç¬¬ä¸€ä¸ª App ï¼ŒåŒ…æ‹¬å·¥å…·çš„ä½¿ç”¨ã€ä¸»è¦æ¦‚å¿µå’Œå®è·µã€‚\næ¯ä¸€èŠ‚è¯¾éƒ½åŒ…å«ä¸€ä¸ªæ•™ç¨‹å’Œä½ éœ€è¦äº†è§£çš„æ¦‚å¿µã€‚å¸¦é¢†ä½ ä¸€æ­¥ä¸€æ­¥åˆ›å»ºä¸€ä¸ªç®€å•çš„å¯è¿è¡Œ iOS App ã€‚\nåœ¨æ„å»º APP çš„è¿‡ç¨‹ä¸­ï¼Œä½ ä¼šå­¦ä¹ åˆ° iOS App å¼€å‘ä¸­æ‰€éœ€çš„æ¦‚å¿µï¼Œæ›´æ·±å…¥çš„ç†è§£ Swift è¯­è¨€ï¼Œäº†è§£åˆ° Xcode å¾ˆå¤šæœ‰ç”¨çš„ç‰¹æ€§ã€‚\n####About The Lessons\nåœ¨è¿™äº›è¯¾ç¨‹ä¸­ï¼Œä½ å°†æ„å»ºä¸€ä¸ªåå« FoodTracker çš„ App ã€‚App ä¸­ä¼šæ˜¾ç¤ºä¸€ä»½ç¾é£Ÿåˆ—è¡¨ï¼ŒåŒ…å«ç¾é£Ÿçš„åç§°ã€è¯„ä»·å’Œå›¾ç‰‡ã€‚ç”¨æˆ·å¯ä»¥æ·»åŠ ä¸€ä¸ªæ–°çš„ç¾é£Ÿã€åˆ é™¤æˆ–è€…ç¼–è¾‘å·²ç»å­˜åœ¨çš„ç¾é£Ÿã€‚æ·»åŠ æˆ–è€…ç¼–è¾‘æ—¶ï¼Œä¼šè¿›å…¥ä¸€ä¸ªæ–°çš„é¡µé¢ï¼Œé‚£é‡Œå¯ä»¥å¡«å†™ç¾é£Ÿçš„åç§°ã€è¯„ä»·å’Œå›¾ç‰‡ã€‚\nç¬¬ä¸€èŠ‚è¯¾æ˜¯ playground ï¼Œplayground æ˜¯ Xcode çš„ä¸€ç§æ–‡ä»¶ï¼Œå¯ä»¥è®©ä½ åœ¨ç¼–è¾‘ä»£ç çš„åŒæ—¶ï¼Œç«‹å³çœ‹åˆ°ä»£ç æ‰§è¡Œçš„ç»“æœã€‚å…¶ä½™çš„è¯¾ç¨‹éƒ½æ˜¯ Xcode project æ–‡ä»¶ã€‚æ¯èŠ‚è¯¾çš„ç»“å°¾æä¾›ä¸‹è½½ï¼Œä½ å¯ä»¥ä¸‹è½½åæ£€æŸ¥ã€‚\n####Get the Tools\nè¦å¼€å‘æœ¬è¯¾ç¨‹ä¸­çš„ iOS App ï¼Œéœ€è¦ä¸€ä¸ª Mac ç”µè„‘(OSX 10.10 ä»¥ä¸Šç‰ˆæœ¬ï¼‰ï¼Œè¿è¡Œæœ€æ–°çš„ Xcode ï¼ŒXcode åŒ…å«äº†è®¾è®¡ã€å¼€å‘å’Œè°ƒè¯• iOS App æ‰€éœ€çš„æ‰€æœ‰ç‰¹æ€§ã€‚ Xcode è¿˜åŒ…å« iOS SDK ï¼Œå®ƒæä¾›äº† iOS å¼€å‘ä¸­æ‰€éœ€çš„å·¥å…·ã€ç¼–è¯‘å™¨å’Œæ¡†æ¶ã€‚\næœ¬è¯¾ç¨‹ä½¿ç”¨ Xcode 7.0 å’Œ iOS SDK 9.0 ã€‚\n1.2. Learn the Essentials of Swift #####Swift Language\nThe Swift Programming Language ä¸­æ–‡ç‰ˆ\n####Swift and Cocoa Touch\nCocoa Touch æ˜¯å¼€å‘ iOS App çš„æ¡†æ¶ï¼ŒSwift å¯ä»¥ä¸ä¹‹æ— ç¼è¿æ¥ã€‚æœ¬èŠ‚è¯¾å°†å¸®åŠ©ä½ äº†è§£æ€æ ·åœ¨ Swift è¯­è¨€ä¸­ä½¿ç”¨ Cocoa Touch ã€‚\nç›®å‰ä¸ºæ­¢ï¼Œä½ ç”¨åˆ°çš„éƒ½æ˜¯æ¥è‡ª Swift æ ‡å‡†åº“çš„æ•°æ®ç±»å‹ï¼Œä¾‹å¦‚ String å’Œ Array ï¼š\nlet sampleString: String = \u0026quot;hello\u0026quot; let sampleArray: Array = [1, 2, 3.1415, 23, 42] åœ¨ Xcode ä¸­ï¼ŒæŒ‰ä½ Option é”®å•å‡»æ•°æ®ç±»å‹ã€‚\nè¦å¼€å‘ iOS Appï¼Œåªæœ‰æ ‡å‡†åº“æ˜¯ä¸å¤Ÿçš„ã€‚æœ€å¸¸ç”¨çš„ iOS App å¼€å‘æ¡†æ¶æ˜¯ UIKit ã€‚UIKit åŒ…å«äº†å¤§é‡æœ‰ç”¨çš„ UI ç±»ã€‚\nè¦è®¿é—® UIKit ï¼Œå…ˆå¯¼å…¥æ¨¡å—ï¼š\nimport UIKit ä¹‹åå°±å¯ä»¥ç”¨ Swift è¯­æ³•è°ƒç”¨ UIKit çš„ç±»å‹å’Œæ–¹æ³•ï¼š\nlet redSquare = UIView(frame: CGRect(x: 0, y: 0, width: 44, height: 44)) redSquare.backgroundColor = UIColor.redColor() ä½ ä¼šåœ¨åé¢çš„ç« èŠ‚é‡åˆ°å¾ˆå¤š UIKit çš„ç±»ã€‚\n2. Building the UI #2.1. Build a Basic UI #æœ¬èŠ‚è¯¾å¸¦ä½ ç†Ÿæ‚‰ Xcode ã€‚ä½ å°†ç†Ÿæ‚‰ Xcode é¡¹ç›®çš„ç»“æ„ï¼Œå¹¶å­¦ä¹ å¦‚ä½•ä½¿ç”¨åŸºæœ¬çš„é¡¹ç›®æ§ä»¶ã€‚é€šè¿‡è¿™èŠ‚è¯¾ï¼Œä½ è¦ä¸º FoodTracker åˆ¶ä½œä¸€ä¸ªç®€å•çš„ UI ï¼Œå°±åƒä¸‹é¢è¿™æ ·ï¼š\n####Learning Objectives\nè¿™èŠ‚è¯¾çš„å­¦ä¹ ç›®æ ‡æ˜¯ï¼š\nåœ¨ Xcode ä¸­æ–°å»ºä¸€ä¸ªé¡¹ç›®ã€‚ ç†Ÿæ‚‰é¡¹ç›®æ¨¡æ¿ä¸­ä¸»è¦æ–‡ä»¶çš„åŠŸèƒ½ã€‚ åœ¨ Xcode ä¸­æ‰“å¼€æ–‡ä»¶ï¼Œå¹¶åœ¨å„ä¸ªæ–‡ä»¶ä¹‹é—´åˆ‡æ¢ã€‚ åœ¨æ¨¡æ‹Ÿå™¨ä¸­è¿è¡Œ App ã€‚ æ·»åŠ ã€ç§»åŠ¨ UI å…ƒç´ ï¼Œæ”¹å˜å…ƒç´ çš„å°ºå¯¸ã€‚ ç¼–è¾‘ UI å…ƒç´ çš„å±æ€§ã€‚ ç”¨ç¼©ç•¥å›¾æŸ¥çœ‹å’Œé‡æ–°å¸ƒç½® UI å…ƒç´ ã€‚ é¢„è§ˆ UI ç•Œé¢ã€‚ æ›´åŠ ç”¨æˆ·è®¾å¤‡çš„å¤§å°è‡ªåŠ¨å¸ƒå±€ UI ã€‚ ####Create a New Project\nXcode åŒ…å«è‹¥å¹²å†…å»ºçš„ App æ¨¡æ¿ï¼Œæ”¯æŒå¸¸ç”¨çš„é›†ä¸­ iOS App ï¼Œä¾‹å¦‚ Gameã€Single View Application ã€‚è¿™äº›æ¨¡æ¿å¤§éƒ¨åˆ†å·²ç»é…ç½®å¥½äº†ç•Œé¢å’Œæºç æ–‡ä»¶ï¼Œæœ¬èŠ‚è¯¾å°±æ˜¯ä»æœ€åŸºç¡€çš„ Single View Application æ¨¡æ¿å¼€å§‹ã€‚\næ‰“å¼€ Xcode ï¼Œæ¬¢è¿ç•Œé¢å¦‚ä¸‹ï¼š\nå¦‚æœæ²¡æœ‰å‡ºç°æ¬¢è¿ç•Œé¢ï¼Œè€Œæ˜¯ç›´æ¥æ‰“å¼€äº†é¡¹ç›®çª—å£ï¼Œä¸è¦ç´§å¼ ï¼Œå¯èƒ½ä¹‹å‰å·²ç»åˆ›å»ºæˆ–æ‰“å¼€è¿‡ä¸€ä¸ªé¡¹ç›®ï¼Œç›´æ¥åˆ°ä¸€ä¸‹æ­¥ï¼Œé€šè¿‡èœå•æ æ–°å»ºé¡¹ç›®å³å¯ã€‚\nåœ¨æ¬¢è¿ç•Œé¢ç‚¹å‡»â€œCreate a new Xcode projectâ€ï¼Œæˆ–è€…åœ¨èœå•ä¸­é€‰æ‹© File \u0026gt; New \u0026gt; Project ã€‚Xcode ä¼šæ‰“å¼€ä¸€ä¸ªæ–°çª—å£ä¾›ä½ é€‰æ‹©æ¨¡æ¿ã€‚\nåœ¨å·¦è¾¹å¯¹è¯æ¡†ä¸­çš„ iOS æ ‡ç­¾ä¸‹é€‰æ‹© Application ã€‚\nåœ¨ä¸»å¯¹è¯æ¡†ä¸­é€‰æ‹© Single View Application ï¼Œç„¶åç‚¹å‡» Next ã€‚\nåœ¨æ–°å‡ºç°çš„å¯¹è¯æ¡†ä¸­ï¼Œè®¾ç½® App çš„åç§°å’Œå…¶ä»–é€‰é¡¹ï¼š\nProduct Name: FoodTracker ã€‚App çš„åç§°ã€‚ Organization Name: å…¬å¸æˆ–ç»„ç»‡çš„åç§°ï¼Œå¯ä»¥ä¸å¡«ã€‚ Organization Identifier: å…¬å¸æˆ–ç»„ç»‡çš„æ ‡è¯†ç ï¼Œå¯ä»¥ä¸å¡«ã€‚ Bundle Identifier: è¯¥é¡¹æ˜¯æ ¹æ®å‰ä¸¤é¡¹çš„å†…å®¹è‡ªåŠ¨ç”Ÿæˆçš„ã€‚ Language: Swift Devices: Universal ã€‚Universal è¡¨ç¤ºè¯¥ App å¯ä»¥åŒæ—¶è¿è¡Œåœ¨ iPhone å’Œ iPad ã€‚ Use Core Data: Unselected. Include Unit Tests: Selected. Include UI Tests: Unselected. ç‚¹å‡» Next ã€‚\nåœ¨å‡ºç°çš„å¯¹è¯æ¡†ä¸­ï¼Œé€‰æ‹©é¡¹ç›®ä¿å­˜çš„ä½ç½®ï¼Œç‚¹å‡» Create ã€‚Xcode ä¼šåœ¨ workspace çª—å£æ‰“å¼€æ–°å»ºçš„é¡¹ç›®ã€‚\nåœ¨ wrokspace çª—å£ï¼Œæœ‰å¯èƒ½çœ‹åˆ°ä¸€æ¡è­¦å‘Šä¿¡æ¯ â€œNo code signing identities foundâ€ ï¼Œæ„æ€ä½ è¿˜æ²¡æœ‰ç”¨ Xcode åšè¿‡ iOS å¼€æ”¾ï¼Œä¸è¦ç´§ï¼Œè¿™èŠ‚è¯¾åï¼Œè¿™æ¡è­¦å‘Šå°±ä¼šæ¶ˆå¤±ã€‚\n####Get Familiar with Xcode\nXcode æ‹¥æœ‰å¼€æ”¾ App æ‰€éœ€çš„ä¸€åˆ‡ã€‚å®ƒä¸ä»…ç»„ç»‡äº†æ‰€æœ‰çš„é¡¹ç›®æ–‡ä»¶ï¼Œè¿˜æä¾›äº†ä»£ç ç¼–è¾‘å™¨å’Œ UI æ§ä»¶ï¼Œå…è®¸ä½ åˆ›å»ºå’Œå…è®¸ App ï¼Œè¿˜æä¾›äº†ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„è°ƒè¯•å™¨ã€‚\nèŠ±ä¸€ç‚¹æ—¶é—´ç†Ÿæ‚‰ä¸€ä¸‹ Xcode workspace çš„ä¸»ç•Œé¢ã€‚ç•Œé¢ä¸­çš„è¿™äº›åŒºåŸŸåœ¨æ¥ä¸‹æ¥çš„è¯¾ç¨‹ä¸­éƒ½ä¼šç”¨åˆ°ã€‚ä¸å¿…å®Œå…¨æŒæ¡ï¼Œåœ¨åé¢çš„è¯¾ç¨‹ä¸­é‡åˆ°æ—¶ï¼Œä¼šæœ‰è¯¦ç»†è®²è§£ã€‚\n####Run Simulator\nç”±äºæ˜¯åŸºäºæ¨¡æ¿æ–°å»ºçš„é¡¹ç›®ï¼ŒåŸºæœ¬çš„ App ç¯å¢ƒä»¥åŠè‡ªåŠ¨ç”Ÿæˆäº†ã€‚å³ä½¿ä½ ä¸å†™ä»»ä½•ä»£ç ï¼Œä¹Ÿå¯ä»¥ç›´æ¥è¿è¡Œè¿™ä¸ª Single View Application æ¨¡æ¿ã€‚\nå¯ä»¥ç”¨ Simulator ï¼ˆæ¨¡æ‹Ÿå™¨ï¼‰æ¥è¿è¡Œ App ï¼Œå®ƒå¯ä»¥è®©ä½ é¢„è§ˆ App è¿è¡Œåœ¨è®¾å¤‡ä¸Šçš„æ ·å­å’Œè¡Œä¸ºäº¤äº’ã€‚\nSimulator å¯ä»¥æ¨¡æ‹Ÿå¤šç§è®¾å¤‡ï¼Œä¾‹å¦‚å„ç§å°ºå¯¸çš„ iPhoneã€iPad ã€‚æœ¬èŠ‚è¯¾ä½¿ç”¨ iPhone 6 ã€‚\nåœ¨æœ€ä¸Šå±‚ Toolbar ä¸­çš„ Scheme èœå•ä¸­é€‰æ‹© iPhone 6 ã€‚Scheme èœå•ç”¨äºè®¾ç½® App è¿è¡Œçš„è®¾å¤‡ã€‚\nç‚¹å‡»å·¦ä¸Šè§’çš„ Run æŒ‰é’®ã€‚\nä¹Ÿå¯ä»¥é€‰æ‹© Product \u0026gt; Run ï¼Œæˆ–è€…ç›´æ¥æŒ‰ Command-R ã€‚\nå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è¿è¡Œ App ï¼ŒXcode ä¼šè¯¢é—®ä½ æ˜¯å¦è¦æ‰“å¼€ Mac ç”µè„‘çš„å¼€å‘æ¨¡å¼ã€‚å¼€å‘æ¨¡å¼ä¸‹ä¼šå…è®¸ Xcode è®¿é—® debug ç‰¹æ€§æ—¶ä¸ç”¨æ¯æ¬¡éƒ½è¾“å…¥å¯†ç ã€‚ç‚¹å‡» Enable ã€‚\nå¦‚æœä½ é€‰æ‹©äº† Don\u0026rsquo;t Enable ï¼Œåé¢å°±è¦æŒ‰æç¤ºè¾“å…¥å¯†ç ã€‚\nè§‚å¯Ÿ Toolbar ï¼Œç­‰å¾…æ„å»ºè¿‡ç¨‹ç»“æŸã€‚Xcode ä¼šåœ¨ Activity viewer ä¸­æ˜¾ç¤ºæ„å»ºè¿‡ç¨‹çš„ä¿¡æ¯ã€‚\næ„å»ºå®Œæˆåï¼ŒSimulator ä¼šè‡ªåŠ¨è¿è¡Œã€‚ç¬¬ä¸€æ¬¡éœ€è¦èŠ±ä¸€ç‚¹æ—¶é—´ã€‚\nSimulator åœ¨ iPhone 6 æ¨¡å¼ä¸‹æ‰“å¼€ï¼Œç„¶ååœ¨æ¨¡æ‹Ÿå‡ºçš„ iPhone ä¸­å¯åŠ¨ä½ çš„ App ã€‚å¯åŠ¨çš„è¿‡ç¨‹ä¸­ï¼Œä¼šçœ‹åˆ° App çš„åå­—ã€‚\nç„¶åï¼Œå°±ä¼šçœ‹åˆ°ï¼š\nç°åœ¨ï¼Œè¿™ä¸ªæ¨¡æ¿è¿˜æ²¡æœ‰ä»»ä½•å†…å®¹ï¼Œåªæ˜¾ç¤ºä¸€ä¸ªç©ºç™½ç•Œé¢ã€‚å…¶ä»–çš„æ¨¡æ¿ä¼šæœ‰æ›´å¤æ‚çš„ç‰¹æ€§ã€‚ç†è§£å„ç§æ¨¡æ¿çš„ç”¨é€”ï¼Œå¯¹å¼€å‘ App æ˜¯å¾ˆé‡è¦çš„ã€‚\nå¿«é€Ÿå¯åŠ¨ Simulator å¯ä»¥é€‰æ‹© Simulator \u0026gt; Quit Simulator ï¼Œæˆ–è€…æŒ‰ Command-Q ã€‚\n####Review the Source Code\nSingle View Application æ¨¡æ¿æ¥è‡ªäºå‡ ä¸ªæºç æ–‡ä»¶ï¼Œå®ƒä»¬è®¾ç½®äº† App çš„ç¯å¢ƒã€‚é¦–å…ˆçœ‹ä¸€ä¸‹ AppDelegate.swift æ–‡ä»¶ã€‚\nåœ¨ navigator area ä¸­æ‰“å¼€ project navigator ã€‚\nproject navigator æ˜¾ç¤ºäº†è¯¥é¡¹ç›®çš„æ‰€æœ‰æ–‡ä»¶ã€‚å¦‚æœä½ çš„ project navigator æ²¡æœ‰æ‰“å¼€ï¼Œåœ¨ navigator selector ä¸­ç‚¹å‡»æœ€å·¦çš„æŒ‰é’®ï¼Œæˆ–è€…é€‰æ‹© View \u0026gt; Navigators \u0026gt; Show Project Navigator ã€‚\nç‚¹å‡» project navigator ä¸­å·¦è¾¹çš„å€’ä¸‰è§’å¯ä»¥å±•å¼€æ‰€æœ‰æ–‡ä»¶ã€‚\né€‰æ‹© AppDelegate.swift ã€‚Xcode ä¼šåœ¨ Editor area ä¸­æ‰“å¼€æºç æ–‡ä»¶ã€‚\næˆ–è€…åŒå‡» AppDelegate.swift ï¼Œåœ¨ä¸€ä¸ªç‹¬ç«‹çš„çª—å£ä¸­æ‰“å¼€ã€‚\nAppDelegate.swift æ–‡ä»¶æœ‰ä¸¤ä¸ªä¸»è¦çš„åŠŸèƒ½ï¼š\nä¸º App æä¾›å…¥å£ï¼Œå¹¶è¿è¡Œäº†ä¸€ä¸ªä¼ é€’è¾“å…¥äº‹ä»¶çš„å¾ªç¯ã€‚è¿™é¡¹å·¥ä½œæ˜¯ç”± UIApplicationMain å±æ€§(@UIApplicationMain)å®Œæˆçš„ï¼Œ å®ƒä½äºæ–‡ä»¶å¼€å¤´å¤„. UIApplicationMain æ–°å»ºäº†ä¸€ä¸ª application å¯¹è±¡ï¼Œå®ƒè´Ÿè´£ç®¡ç† App çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå’Œ app delegate å¯¹è±¡ã€‚ å®šä¹‰ AppDelegate ç±», å®ƒæ˜¯ app delegate å¯¹è±¡çš„ç±»å‹ã€‚ app delegate åˆ›å»ºäº† App çš„çª—å£ï¼Œæä¾›äº†ä¸€ä¸ªå“åº” App çŠ¶æ€è½¬æ¢çš„åœ°æ–¹ã€‚ä½ å¯ä»¥åœ¨ AppDelegate ç±»ä¸­å†™ä¸€äº›è‡ªå®šä¹‰çš„ä»£ç ã€‚ AppDelegate ç±»åªåŒ…å«ä¸€ä¸ªå±æ€§ï¼šwindow ï¼Œapp delegate ç”¨è¿™ä¸ªå±æ€§è·Ÿè¸ª App çš„çª—å£ã€‚window æ˜¯å¯é€‰ç±»å‹ï¼ˆoptionalï¼‰ï¼Œæ‰€æœ‰å®ƒå¯èƒ½æ²¡æœ‰å€¼ï¼ˆnilï¼‰ã€‚\nvar window: UIWindow? AppDelegate ç±»è¿˜åŒ…å«äº†å‡ ä¸ªé‡è¦çš„æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•ç”¨äº application å¯¹è±¡ä¸ app delegate è¿›è¡Œå¯¹è¯ã€‚\nfunc application(application: UIApplication, didFinishLaunchingWithOptions launchOptions: [NSObject: AnyObject]?) -\u0026gt; Bool func applicationWillResignActive(application: UIApplication) func applicationDidEnterBackground(application: UIApplication) func applicationWillEnterForeground(application: UIApplication) func applicationDidBecomeActive(application: UIApplication) func applicationWillTerminate(application: UIApplication) å½“ App çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶â€”â€”ä¾‹å¦‚å¯åŠ¨ã€è½¬å…¥åå°ã€é€€å‡ºâ€”â€” application å¯¹è±¡å°±ä¼šè°ƒç”¨ AppDelegate ä¸­ç›¸åº”çš„æ–¹æ³•åšå‡ºå›åº”ã€‚æ— éœ€ä¸“é—¨åˆ¤æ–­è¿™äº›æ–¹æ³•æ˜¯å¦è¢«è°ƒç”¨ï¼Œapplication å¯¹è±¡ä¼šå¸®ä½ å®Œæˆè¿™ä¸ªå·¥ä½œã€‚\nè¿™äº›æ–¹æ³•æ¨¡æ¿éƒ½æ˜¯ç©ºå®ç°ï¼Œå¯ä»¥åœ¨é‡Œé¢æ·»åŠ è‡ªå®šä¹‰çš„ä»£ç ï¼Œå½“å®ƒä»¬è¢«è°ƒç”¨æ—¶å°±ä¼šæ‰§è¡Œã€‚è¿™èŠ‚è¯¾ä¸ä¼šç”¨åˆ°è‡ªå®šä¹‰çš„ appdelegate ä»£ç ï¼Œæ‰€æœ‰ä¸ç”¨ä¿®æ”¹ AppDelegate.swift æ–‡ä»¶ã€‚\nSingle View Application æ¨¡æ¿è¿˜æœ‰ä¸€ä¸ªæºæ–‡ä»¶ ViewController.swift ã€‚åœ¨é¡¹ç›®å¯¼èˆªå™¨ä¸­é€‰æ‹© ViewController.swift æŸ¥çœ‹æ–‡ä»¶å†…å®¹ã€‚\nè¿™ä¸ªæ–‡ä»¶ä¸­å®šä¹‰äº†ä¸€ä¸ª UIViewController çš„å­ç±» ViewController ã€‚è¿™ä¸ªç±»ç»§æ‰¿äº† UIViewController çš„æ‰€æœ‰è¡Œä¸ºã€‚è¦è¦†ç›–æˆ–è€…æ‰©å±•è¿™äº›è¡Œä¸ºï¼Œéœ€è¦é‡å†™ UIViewController ä¸­å®šä¹‰çš„æ–¹æ³•ï¼ˆä¾‹å¦‚ ViewController.swift ä¸­é‡å†™äº† viewDidLoad() å’Œ didReceiveMemoryWarning() æ–¹æ³•ï¼‰ï¼Œæˆ–è€…è‡ªå®šä¹‰æ–°çš„æ–¹æ³•ã€‚\nè™½ç„¶æ¨¡æ¿è‡ªå¸¦äº† didReceiveMemoryWarning() æ–¹æ³•ï¼Œè¿™èŠ‚è¯¾å¹¶ä¸ä¼šç”¨åˆ°ï¼Œæ‰€æœ‰åˆ æ‰å®ƒã€‚\nç°åœ¨ï¼Œä½ çš„ ViewController.swift æ–‡ä»¶å˜æˆäº†ï¼š\nimport UIKit class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() // Do any additional setup after loading the view, typically from a nib. } } ç¨åä¼šåœ¨è¿™ä¸ªæ–‡ä»¶ä¸­å†™ä½ è‡ªå·±çš„ä»£ç ã€‚\n####Open Your Storyboard\nç°åœ¨å¯ä»¥åœ¨ storyboard ä¸Šå·¥ä½œäº†ã€‚Storyboard æ˜¯ App ç•Œé¢çš„è™šæ‹Ÿè¡¨ç°ï¼Œå®ƒå±•ç¤ºäº† App å±å¹•ä¸Šæ˜¾ç¤ºçš„å†…å®¹å’Œå†…å®¹ä¹‹é—´çš„äº¤äº’å…³ç³»ã€‚æˆ‘ä»¬ç”¨ storyboard è®¾è®¡ App çš„ç•Œé¢å’Œäº¤äº’æµç¨‹ã€‚ä½ å¯ä»¥åœ¨è®¾è®¡è¿‡ç¨‹ä¸­æ¸…æ¥šçš„çœ‹åˆ° App çš„æ ·å­å’Œäº¤äº’å…³ç³»ï¼Œå¹¶ä¸”å¯ä»¥éšæ—¶åšå‡ºåšå‡ºæ‰€è§å³æ‰€å¾—çš„ä¿®æ”¹ã€‚\nåœ¨é¡¹ç›®å¯¼èˆªå™¨ä¸­é€‰æ‹© Main.storyboard ï¼ŒXcode å°±ä¼šåœ¨ Interface Builder ä¸­æ‰“å¼€ storyboard ã€‚storyboard çš„èƒŒæ™¯æ˜¯ç©ºç™½çš„ï¼Œå¯ä»¥åœ¨ä¸Šé¢æ·»åŠ å¸ƒç½®å„ç§ UI å…ƒç´ ã€‚\nç°åœ¨è¿™ä¸ª storyboard ä¸ŠåŒ…å«äº†ä¸€ä¸ªåœºæ™¯ï¼Œç›¸å½“äºä½ çš„ App æ˜¾ç¤ºåœ¨æ‰‹æœºå±å¹•ä¸Šçš„æ ·å­ã€‚åœºæ™¯å·¦è¾¹çš„é‚£ä¸ªç®­å¤´å«åš storyboard entry point ï¼Œè¡¨ç¤ºè¿™ä¸ªåœºæ™¯æ˜¯ App å¯åŠ¨æ—¶ç¬¬ä¸€ä¸ªåŠ è½½çš„ã€‚ç°åœ¨è¿™ä¸ªåœºæ™¯åªæœ‰ä¸€ä¸ªç•Œé¢ï¼Œç”± view controller ç®¡ç†ã€‚ä½ ä¼šå­¦åˆ°æ›´å¤šå…³äº view å’Œ view controller çš„ä½¿ç”¨è§„åˆ™ã€‚\nå½“ä½ åœ¨ iPhone 6 æ¨¡æ‹Ÿå™¨ä¸Šè¿è¡Œè¿™ä¸ª App æ—¶ï¼Œè¿™ä¸ªåœºæ™¯ä¸Šçš„ç•Œé¢å°±æ˜¯æœ€ç»ˆåœ¨è®¾å¤‡å±å¹•ä¸Šçœ‹åˆ°çš„æ ·å­ã€‚ä½†æ˜¯ä¼šå‘ç°ï¼Œè¿™ä¸ªåœºæ™¯çš„å¤§å°å½¢çŠ¶ä¸ iPhone 6 çš„å±å¹•å°ºå¯¸å¹¶ä¸åŒ¹é…ã€‚è¿™æ˜¯å› ä¸ºï¼Œè¿™ä¸ªåœºæ™¯æ˜¯å¯¹äºæ‰€æœ‰å¯æ”¯æŒè®¾å¤‡çš„ä¸€èˆ¬åŒ–è¡¨ç¤ºï¼Œæœ€ç»ˆè¿è¡Œåœ¨å…·ä½“è®¾å¤‡ä¸Šæ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒæ•´åˆ°åˆé€‚çš„å°ºå¯¸ã€‚\n####Build the Basic UI\nç°åœ¨å¯ä»¥å¼€å§‹æ„å»ºåŸºæœ¬çš„ç•Œé¢ï¼Œåšä¸€ä¸ªæ·»åŠ æ–°èœçš„åŠŸèƒ½ã€‚\nXcode æä¾›äº†ä¸€ä¸ªåº“ï¼ŒåŒ…å«äº†æŒ‰é’®ã€æ–‡æœ¬æ¡†ç­‰å¯ä»¥æ·»åŠ åˆ°ç•Œé¢ä¸Šçš„å…ƒç´ ï¼Œè¿˜æœ‰ä¸€äº›ä¸ä¼šæ˜¾ç¤ºå‡ºæ¥çš„ã€å®šä¹‰ App è¡Œä¸ºçš„å…ƒç´ ï¼Œä¾‹å¦‚ view controller å’Œæ‰‹åŠ¿è¯†åˆ«ã€‚\nå‡ºç°åœ¨ UI ä¸Šå…ƒç´ è¢«ç§°ä½œ view ã€‚å®ƒä»¬ä¸ºç”¨æˆ·å‘ˆç° App çš„å†…å®¹ã€‚view è¿˜æœ‰å¤šç§å…§å»ºçš„è¡Œä¸ºï¼ŒåŒ…æ‹¬åœ¨å±å¹•ä¸Šæ˜¾ç¤ºè‡ªèº«ï¼Œå¯¹ç”¨æˆ·è¾“å…¥åšå‡ºååº”ã€‚\niOS ä¸­çš„ View å¯¹è±¡çš„ç±»å‹éƒ½æ˜¯ UIView æˆ–å®ƒçš„å­ç±»ã€‚å¾ˆå¤š UIView å­ç±»éƒ½æœ‰è‡ªå·±ç‹¬ç‰¹çš„æ˜¾ç¤ºæ–¹å¼å’Œè¡Œä¸ºã€‚ç°åœ¨ï¼Œæˆ‘ä»¬åœ¨åœºæ™¯ä¸­æ·»åŠ ä¸€ä¸ªæ–‡æœ¬åŸŸï¼Œå®ƒå±äº UITextField ç±»ã€‚ä¸€ä¸ªæ–‡æœ¬åŸŸå…è®¸ç”¨æˆ·è¾“å…¥ä¸€è¡Œæ–‡æœ¬ï¼Œè¿™é‡Œç”¨å®ƒæ¥è¾“å…¥ä¸€é“èœçš„åå­—ã€‚\næ‰“å¼€å¯¹è±¡åº“ï¼ˆObject libraryï¼‰ã€‚\næ‰“å¼€å¯¹è±¡åº“çš„æŒ‰é’®ä½äºå³è¾¹çš„ utility area ã€‚å¦‚æœæ²¡æœ‰çœ‹åˆ°å¯¹è±¡åº“ï¼Œå•å‡»å®ƒçš„æŒ‰é’®ï¼Œåº“é€‰æ‹©æ¡çš„å·¦èµ·ç¬¬ä¸‰ä¸ªæŒ‰é’®ã€‚ï¼ˆæˆ–è€…åœ¨èœå•ä¸­é€‰æ‹© View \u0026gt; Utilities \u0026gt; Show Object Library)\nä¼šå‡ºç°ä¸€ä¸ªåˆ—è¡¨ï¼Œåˆ—å‡ºäº†æ¯ä¸ªå¯¹è±¡çš„åå­—ã€æè¿°ã€å›¾æ ‡ã€‚\nåœ¨å¯¹è±¡åº“çš„ Filter field ä¸­è¾“å…¥ text field å°±å¯ä»¥æ‰¾åˆ°å®ƒã€‚\nå°† text field å¯¹è±¡æ‹–åˆ°åœºæ™¯ä¸­ã€‚\nå¯ä»¥åœ¨ Editor \u0026gt; Canvas \u0026gt; Zoom ä¸­é€‰æ‹©æ”¾å¤§æˆ–ç¼©å°åœºæ™¯ã€‚\næŠŠ text field æ‹–åˆ°åœºæ™¯ä¸ŠåŠéƒ¨åˆ†ï¼Œå·¦è¾¹çº¿å¯¹é½çš„ä½ç½®ã€‚å¦‚å›¾ï¼š\nè“è‰²çš„å¯¹é½çº¿ä¼šå¸®åŠ©ä½ å®šä½ã€‚å¯¹é½çº¿åªæœ‰åœ¨æ‹–åŠ¨æˆ–æ”¹å˜å¯¹è±¡å¤§å°æ˜¯æ‰èƒ½çœ‹åˆ°ï¼›å½“ä½ æ”¾å¼€å¯¹è±¡æ—¶å®ƒå°±æ¶ˆå¤±äº†ã€‚\nå¦‚æœæœ‰å¿…è¦ï¼Œå•å‡» text field ï¼Œæ¿€æ´» resize handleã€‚\nResize handle æ˜¯å‡ºç°åœ¨ UI å…ƒç´ å››å‘¨çš„ç™½è‰²å°æ–¹æ¡†ï¼Œæ‹–åŠ¨å®ƒå¯ä»¥æ”¹å˜å…ƒç´ çš„å¤§å°ã€‚é€šè¿‡å•å‡»å…ƒç´ å¯ä»¥è¯¥å…ƒç´ çš„ resize handle ã€‚å¦‚ä¸‹å›¾è¿™æ ·ï¼Œå·²ç»å•å‡»é€‰ä¸­çš„å…ƒç´ å¯ä»¥æ”¹å˜å¤§å°ã€‚\næ”¹å˜ text field å·¦å³è¾¹æ¡†çš„ä½ç½®ï¼Œç›´åˆ°å‡ºç°ä¸‰æ¡å¯¹é½çº¿ï¼šå·¦è¾¹å¯¹é½çº¿ã€æ°´å¹³æ–¹å‘ä¸­å¿ƒå¯¹é½çº¿ã€å³è¾¹å¯¹é½çº¿ã€‚\nå°½ç®¡åœºæ™¯ä¸Šå·²ç»æœ‰äº†æ–‡æœ¬åŸŸï¼Œä½†æ˜¯æ²¡æœ‰ help ä¿¡æ¯å‘Šè¯‰ç”¨æˆ·è¿™é‡Œåº”è¯¥å¡«ä»€ä¹ˆã€‚ç”¨ Text field çš„ Placeholder å‘Šè¯‰ç”¨æˆ·åœ¨è¿™é‡Œå¡«å…¥èœåã€‚\nåœ¨ utility area ä¸­æ‰“å¼€ Text field çš„å±æ€§æ£€æŸ¥å™¨ï¼ˆAttributes inspectorï¼‰ï¼Œåœ¨è¿™é‡Œå¯ä»¥ç¼–è¾‘ storyboard ä¸­å¯¹è±¡çš„å±æ€§ã€‚\næ‰¾åˆ° Placeholder ï¼Œè¾“å…¥ Enter meal name ã€‚\næŒ‰å›è½¦é”®å°±å¯ä»¥åœ¨æ–‡æœ¬åŸŸä¸­çœ‹åˆ°åˆšæ‰è¾“å…¥çš„æ–‡æœ¬ã€‚\nç°åœ¨çš„ç•Œé¢æ˜¯è¿™æ ·çš„ï¼š\nå½“ç”¨æˆ·é€‰ä¸­æ–‡æœ¬åŸŸæ—¶ä¼šæ˜¾ç¤ºç³»ç»Ÿé”®ç›˜ï¼Œè¿™é‡Œè¦é…ç½®ä¸€ä¸‹ç³»ç»Ÿé”®ç›˜çš„å±æ€§ï¼Œ\né€‰ä¸­æ–‡æœ¬åŸŸã€‚ åœ¨å±æ€§æ£€æŸ¥å™¨ä¸­æ‰¾åˆ° Return Key å¹¶é€‰æ‹© Done ã€‚è¿™ä¸ªè®¾ç½®ä¼šå°†é”®ç›˜çš„ Return é”®æ”¹ä¸º Done é”®ã€‚ åœ¨å±æ€§æ£€æŸ¥å™¨ä¸­å‹¾é€‰ Auto-enable Return Key ã€‚è¿™æ ·çš„è¯ï¼Œå¦‚æœæ–‡æœ¬åŸŸä¸­æ²¡æœ‰è¾“å…¥æ–‡æœ¬ï¼Œç”¨æˆ·æ˜¯æ— æ³•ç‚¹å‡» Done é”®çš„ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿ç”¨æˆ·ä¸èƒ½è®¾ç½®ç©ºçš„èœåã€‚ ä¸‹ä¸€æ­¥ï¼Œåœ¨åœºæ™¯é¡¶éƒ¨æ·»åŠ ä¸€ä¸ªæ ‡ç­¾ï¼ˆUILabelï¼‰ã€‚æ ‡ç­¾æ²¡æœ‰äº¤äº’ï¼Œåªèƒ½æ˜¾ç¤ºä¸€æ®µé™æ€æ–‡æœ¬ã€‚ä¸ºäº†å¸®åŠ©ä½ ç†è§£æ€æ ·å®šä¹‰ UI ä¸Šå…ƒç´ ä¹‹é—´çš„äº¤äº’ï¼Œä½ è¦é…ç½®è¿™ä¸ªæ ‡ç­¾ï¼Œè®©å®ƒæ˜¾ç¤ºç”¨æˆ·åœ¨æ–‡æœ¬åŸŸä¸­è¾“å…¥çš„æ–‡å­—ã€‚è¿™æ ·å¯ä»¥ç»ƒä¹ å¦‚ä½•è·å–å¹¶å¤„ç†æ–‡æœ¬åŸŸä¸­çš„è¾“å…¥ä¿¡æ¯ã€‚\nåœ¨å¯¹è±¡åº“ä¸­è¾“å…¥ lable ï¼Œå¿«é€Ÿæ‰¾åˆ° Label å¯¹è±¡ã€‚\næŠŠ Label å¯¹è±¡æ‹–åˆ°åœºæ™¯ä¸­ã€‚\næŠŠæ ‡ç­¾æ‹–åˆ°æ–‡æœ¬åŸŸçš„å·¦ä¸Šæ–¹ä½ç½®ï¼Œå·¦å¯¹é½ï¼Œå¦‚å›¾ï¼š\nåŒå‡»æ ‡ç­¾ï¼Œè¾“å…¥ Meal Name ã€‚\næŒ‰å›è½¦é”®ï¼Œæ–°æ–‡æœ¬å°±ä¼šæ˜¾ç¤ºåœ¨æ ‡ç­¾ä¸­ã€‚\nåœºæ™¯å˜æˆäº†è¿™ä¸ªæ ·å­ï¼š\nç°åœ¨ï¼Œæ·»åŠ ä¸€ä¸ªæŒ‰é’®ï¼ˆUIButtonï¼‰ã€‚æŒ‰é’®æ˜¯å¯äº¤äº’çš„ï¼Œæ‰€æœ‰ï¼Œç”¨æˆ·å¯ä»¥ç‚¹å‡»ï¼Œç„¶åè§¦å‘å®šä¹‰å¥½çš„äº‹ä»¶ã€‚è¿™é‡Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªé‡ç½®æ ‡ç­¾æ–‡æœ¬çš„äº‹ä»¶ã€‚\nåœ¨å¯¹è±¡åº“é‡Œè¾“å…¥ button æŸ¥æ‰¾ Button å¯¹è±¡ã€‚\næŠŠ Button æ‹–åˆ°åœºæ™¯ä¸­ã€‚\nå°†æŒ‰é’®æ‹–åˆ°æ–‡æœ¬åŸŸçš„ä¸‹æ–¹ï¼Œå·¦å¯¹é½ï¼Œå¦‚å›¾ï¼š\nåŒå‡»æŒ‰é’®ï¼Œè¾“å…¥ Set Default Label Text ã€‚\næŒ‰å›è½¦æ˜¾ç¤ºæ–°æ–‡æœ¬ã€‚\næ­¤æ—¶ï¼Œä½ çš„åœºæ™¯å˜æˆäº†è¿™æ ·ï¼š\n![](~/23-59-04.jpg) åœ¨ Outline view ä¸­å¯ä»¥çœ‹åˆ°å·²ç»æ·»åŠ åˆ°åœºæ™¯ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œå¸®åŠ©ä½ ç†è§£è¿™äº›å…ƒç´ æ˜¯å¦‚ä½•åœ¨åœºæ™¯ä¸­å¸ƒç½®çš„ã€‚\nåœ¨ storyboard ä¸­æ‰¾åˆ° Outline view æŒ‰é’®ï¼š\nå¦‚æœæ²¡æœ‰çœ‹åˆ° Outline view ï¼Œè¯·å•å‡»å·¦ä¸‹çš„ Outline view toggle ã€‚ è¯¥æŒ‰é’®å¯ä»¥æ˜¾ç¤ºæˆ–éšè— Outline view ã€‚\nOutline view å¯ä»¥è®©ä½ çœ‹æ¸… storyboard ä¸­ç»™ä¸ªå¯¹è±¡çš„å±‚æ¬¡å…³ç³»ã€‚åœ¨è¿™ä¸ªç­‰çº§ç»“æ„ä¸­å¯çœ‹åˆ°æ–‡æœ¬åŸŸã€æ ‡ç­¾ã€æŒ‰é’®ã€‚ä¸ºä»€ä¹ˆä½ æ·»åŠ çš„è¿™äº›å…ƒç´ éƒ½ä½äº View ä¸‹ï¼Œè€Œä¸æ˜¯å…¶ä»–çš„ view ï¼Ÿ\nview ä¸åªæ˜¯æ˜¾ç¤ºè‡ªå·±å’Œæ¥å—ç”¨æˆ·è¾“å…¥ï¼Œå®ƒä»¬è¿˜å¯ä»¥ä½œä¸ºå…¶ä»– view çš„å®¹å™¨ã€‚æ’åˆ—åœ¨è¿™ä¸ªç­‰çº§ç»“æ„ä¸­çš„ view ç§°ä½œ view hierarchy ã€‚å®ƒå®šä¹‰äº† views ä¹‹é—´çš„å¸ƒå±€å…³ç³»ã€‚ä¸€ä¸ª view é‡Œé¢çš„å…¶ä»– views å«åš subviews ï¼Œå®ƒçš„ä¸Šä¸€å±‚ view å«åš superview ã€‚ä¸€ä¸ª view å¯ä»¥æœ‰å¤šä¸ª subview ï¼Œä½†åªèƒ½æœ‰ä¸€ä¸ª superview ã€‚\né€šå¸¸ï¼Œæ¯ä¸ªåœºæ™¯éƒ½æœ‰è‡ªå·±çš„ view hierarchy ã€‚æ¯ä¸ª view hierarchy çš„é¡¶éƒ¨æ˜¯ä¸€ä¸ª content view ã€‚ç°åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œcontent view å°±æ˜¯ View ã€‚ä½ åœ¨è¿™ä¸ªåœºæ™¯ä¸­æ·»åŠ çš„ view éƒ½å°†æ˜¯ View çš„ subview ã€‚\n####Preview Your Interface\nå®šæœŸé¢„è§ˆä½ çš„ App ï¼Œæ£€æŸ¥ä¸€ä¸‹è®¾è®¡ç»“æœæ˜¯å¦ç¬¦åˆé¢„æœŸã€‚ç”¨ assistant editor å¯ä»¥åœ¨ä¸»ç¼–è¾‘å™¨å‚è¾¹æ˜¾ç¤ºä¸€ä¸ªå­ç¼–è¾‘å™¨ï¼Œå¯ä»¥åœ¨è¿™é‡Œé¢„è§ˆ App çš„ç”¨æˆ·ç•Œé¢ã€‚\nç‚¹å‡»å³ä¸Šè§’çš„ Assistant æŒ‰é’®æ‰“å¼€ assistant editor ã€‚\nå¦‚æœæƒ³è¦æ›´å¤šçš„å·¥ä½œç©ºé—´ï¼Œå¯ä»¥åœ¨å³ä¸Šè§’çš„å·¥å…·æ¡ä¸­éšè— Navigator å’Œ Utilities ï¼Œè¿˜å¯ä»¥éšè— outline view ã€‚\nåœ¨ assistant editor é¡¶éƒ¨çš„é€‰æ‹©å™¨ä¸­é€‰æ‹© Automatic \u0026gt; Preview \u0026gt; Main.storyboard(Preview) ã€‚\nåœ¨é¢„è§ˆä¸­å¯ä»¥çœ‹åˆ°ï¼Œæ–‡æœ¬åŸŸçš„å³è¾¹æ²¡æœ‰å®Œå…¨æ˜¾ç¤ºï¼Œè¶…å‡ºäº†æœ‰è¾¹æ¡†ã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿ\næˆ‘ä»¬æ„å»ºçš„æ˜¯ä¸€ä¸ªå¯ä»¥é€‚åº”å„ç§å°ºå¯¸ iPhone å’Œ iPad çš„ç•Œé¢ã€‚åœ¨ storyboard ä¸­çœ‹åˆ°çš„æ˜¯ç•Œé¢å¤§æ¦‚çš„æ ·å­ã€‚ç°åœ¨ï¼Œéœ€è¦è®¾ç½®è¿™ä¸ªç•Œé¢ä¸Šçš„å…ƒç´ åœ¨ä¸åŒå¤§å°çš„å±å¹•ä¸Šè¯¥å¦‚ä½•è°ƒæ•´ã€‚ä¾‹å¦‚ï¼Œå½“ç•Œé¢ç¼©å°åˆ° iPhone å¤§å°æ—¶ï¼Œæ–‡æœ¬åŸŸä¹Ÿè¦ç›¸åº”çš„ç¼©å°ã€‚å½“ç•Œé¢æ”¾å¤§é“ iPad å¤§å°æ—¶ï¼Œæ–‡æœ¬åŸŸä¹Ÿè¦æ”¾å¤§ã€‚å¯ä»¥ç”¨ Auto Layout è®¾ç½®è¿™äº›è¡Œä¸ºã€‚\n####Adopt Auto Layout\nAuto Layout æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å¸ƒå±€å¼•æ“ï¼Œå¯ä»¥å¸®åŠ©ä½ è½»æ¾çš„è®¾è®¡å…¼å®¹å¸ƒå±€ã€‚ä½ åªéœ€è¦å‘Šè¯‰ Auto Layout æƒ³è¦å¦‚ä½•æ‘†æ”¾åœºæ™¯ä¸­çš„å…ƒç´ ï¼Œå¼•æ“å°±ä¼šè‡ªåŠ¨ä»¥æœ€ä¼˜çš„æ–¹å¼å®ç°ä½ çš„æ„å›¾ã€‚æè¿°ä½ çš„æ„å›¾è¦ç”¨åˆ° constraints ï¼Œä½¿ç”¨å®ƒæ¥æè¿°å…ƒç´ çš„ç›¸å¯¹ä½ç½®ï¼Œå…ƒç´ çš„å¤§å°ï¼Œå…ƒç´ ä¹‹é—´çš„ç¼©æ”¾å…³ç³»ã€‚\né…åˆ Auto Layout å·¥ä½œçš„å·¥å…·æ˜¯ stack viewï¼ˆUIStackViewï¼‰ã€‚stack view æä¾›äº†ä¸€ä¸ªé«˜æ•ˆçš„æ–¹å¼åœ¨æ°´å¹³æˆ–å‚ç›´æ–¹å‘æ’å¸ƒå¤šä¸ªå…ƒç´ ã€‚Stack view è®©ä½ å€ŸåŠ© Auto Layout çš„åŠ›é‡ï¼Œåˆ›å»ºå¯ä»¥é€‚åº”è®¾å¤‡æ–¹å‘ã€å±å¹•å¤§å°ã€æˆ–å„ç§ç©ºé—´å˜åŒ–çš„ UI ã€‚\nå¯ä»¥è½»æ¾çš„å°†å·²ç»å­˜åœ¨çš„ UI å…ƒç´ åŒ…å«åˆ°ä¸€ä¸ª stack view ï¼Œç„¶åè®¾å®šå¿…è¦çš„é™åˆ¶ï¼Œä½¿å¾— stack view åœ¨å„ç§æƒ…å†µä¸‹éƒ½èƒ½æ­£ç¡®çš„æ˜¾ç¤ºã€‚\nç‚¹å‡»å³ä¸Šè§’çš„ Standard æŒ‰é’®å›åˆ°ä¸»ç¼–è¾‘å™¨ã€‚\næŒ‰ä½ Shift é”®ï¼ŒåŒæ—¶é€‰ä¸­æ–‡æœ¬åŸŸã€æ ‡ç­¾å’ŒæŒ‰é’®ã€‚\nåœ¨ç”»å¸ƒçš„å³ä¸‹è§’é€‰æ‹© Stack æŒ‰é’®ã€‚ï¼ˆæˆ–è€…é€‰æ‹© Editor \u0026gt; Embed In \u0026gt; Stack View)\nXcode ä¼šå°†è¿™äº› UI å…ƒç´ åŒ…å«åˆ°ä¸€ä¸ª stack view ä¸­ã€‚Xcode ä¼šåˆ†æç°åœ¨çš„å¸ƒå±€ï¼Œè®¡ç®—å‡ºè¿™äº›å…ƒç´ åº”è¯¥æ²¿å‚ç›´æ–¹å‘å æ”¾ã€‚\nå¦‚æœæœ‰å¿…è¦ï¼Œæ‰“å¼€ Outline view ï¼Œé€‰æ‹© Stack View å¯¹è±¡ã€‚\nåœ¨å±æ€§æ£€æŸ¥å™¨çš„ spacing ä¸­è¾“å…¥ 12 ï¼ŒæŒ‰å›è½¦ã€‚ä½ ä¼šçœ‹åˆ° UI å…ƒç´ çš„çºµå‘ç©ºé—´è¢«æ‹‰é•¿äº†ã€‚\nåœ¨ç”»å¸ƒå³ä¸‹è§’æ‰“å¼€ Pin èœå•ã€‚\nåœ¨ â€œSpacing to nearest neighborâ€ ä¸Šæ–¹ï¼Œç‚¹å‡»é€‰ä¸­ä¸¤ä¸ªæ¨ªå‘é™åˆ¶å’Œçºµå‘é¡¶éƒ¨é™åˆ¶ã€‚é€‰ä¸­åä¼šå˜æˆçº¢è‰²ã€‚\nè¿™äº›é™åˆ¶è¡¨ç¤ºå½“å‰çš„ stack view ä¸å‘¨è¾¹ view çš„è¾¹ç¼˜çš„è·ç¦»ã€‚é€‰ä¸­äº† â€œConstrain to marginsâ€ï¼Œè¡¨ç¤ºè¿™äº›è·ç¦»é™åˆ¶æ˜¯ç›¸å¯¹äº margins çš„ï¼Œmargins æ˜¯å¤–è¾¹è·ï¼Œæ˜¯ view è¾¹ç¼˜å¤–çš„ä¸€åœˆç©ºç™½ã€‚\nåœ¨å·¦å³ä¸¤ä¸ªæ¡†ä¸­è¾“å…¥ 0 ï¼Œåœ¨ä¸Šé¢çš„æ¡†ä¸­è¾“å…¥ 60 ã€‚\nåœ¨ Update Frames ä¸‹æ‹‰èœå•ä¸­é€‰æ‹© Items of New Constraints ã€‚å¦‚ä¸‹å›¾ï¼š\nåœ¨ Pin èœå•ä¸­ç‚¹å‡» Add 3 Constraints æŒ‰é’®ã€‚\nç•Œé¢å°±ä¼šå˜æˆè¿™ä¸ªæ ·å­ï¼š\nä½ ä¼šæ³¨æ„åˆ°æ–‡æœ¬åŸŸå¹¶æ²¡æœ‰æ‰©å¤§åˆ°åœºæ™¯å³è¾¹ç¼˜ï¼Œä¸‹é¢è§£å†³è¿™ä¸ªé—®é¢˜ã€‚\nåœ¨ storyboard ä¸­é€‰ä¸­æ–‡æœ¬åŸŸã€‚\nåœ¨ç”»å¸ƒçš„å³ä¸‹è§’æ‰“å¼€ Pin èœå•ã€‚\nåœ¨ â€œSpacing to nearest neighborâ€ ä¸Šæ–¹ï¼Œå•å‡»é€‰ä¸­ä¸¤ä¸ªæ°´å¹³æ–¹å‘çš„é™åˆ¶ï¼Œå®ƒä»¬ä¼šå˜æˆçº¢è‰²ã€‚\nåœ¨å·¦å³ä¸¤ä¸ªæ¡†ä¸­è¾“å…¥ 0 ã€‚\nåœ¨ Update Frames ä¸‹æ‹‰èœå•ä¸­é€‰æ‹© Item of New Constraints ï¼Œå¦‚å›¾ï¼š\nåœ¨ Pin èœå•ä¸­ç‚¹å‡» Add 2 Constraints æŒ‰é’®ã€‚\né€‰ä¸­æ–‡æœ¬åŸŸåï¼Œåœ¨ utility area ä¸­æ‰“å¼€ Size inspector ã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œç¼–è¾‘å¯¹è±¡çš„å¤§å°å’Œä½ç½®ã€‚\nåœ¨ Intrinsic Size çš„ä¸‹æ‹‰èœå•ä¸­é€‰æ‹© Placeholderã€‚å®ƒä½äº Size inspector çš„åº•éƒ¨ï¼Œä½ è¦å¾€ä¸‹ç¿»æ‰èƒ½çœ‹åˆ°ã€‚æ–‡æœ¬åŸŸçš„å¤§å°ç”±å®ƒçš„å†…å®¹å†³å®šï¼Œé€šè¿‡å®šä¹‰ Intrinsic content size æ¥è®¾å®šå†…å®¹çš„æœ€å°æ•°é‡ï¼Œå†…å®¹ç”¨å ä½ç¬¦ï¼ˆPlaceholderï¼‰å¡«å……ã€‚è¿™æ—¶ï¼Œæ–‡æœ¬åŸŸçš„å†…å®¹åªæ˜¯å ä½ç¬¦ç»„æˆçš„å­—ç¬¦ä¸²ï¼Œä½†æ˜¯ç”¨æˆ·è¾“å…¥çš„å†…å®¹å¯ä»¥æ¯”å ä½ç¬¦æ›´é•¿ã€‚\nç°åœ¨åœºæ™¯ç•Œé¢å¦‚ä¸‹ï¼š\næ£€æŸ¥æ—¶é—´ï¼šåœ¨æ¨¡æ‹Ÿå™¨ä¸­è¿è¡Œ App ã€‚æ–‡æœ¬åŸŸå®Œå…¨ä¸ä¼šè¶…å‡ºå±å¹•è¾¹ç•Œäº†ã€‚ä½ å¯ä»¥ç‚¹å‡»æ–‡æœ¬åŸŸå†…éƒ¨ï¼Œç„¶åç”¨é”®ç›˜è¾“å…¥ä¸€äº›æ–‡æœ¬ï¼ˆå¯ä»¥æŒ‰ Command-K åˆ‡æ¢åˆ°è½¯é”®ç›˜ï¼‰ã€‚å¦‚æœæ—‹è½¬è®¾å¤‡ï¼ˆCommand-Left æˆ– Command-Rightï¼‰ï¼Œæˆ–è€…åœ¨å¦ä¸€ç§è®¾å¤‡ä¸Šè¿è¡Œ App ï¼Œæ–‡æœ¬åŸŸä¼šéšç€å±å¹•çš„å˜åŒ–è€Œä¼¸ç¼©åˆ°åˆé€‚çš„å¤§å°ã€‚æ³¨æ„ï¼ŒæŠŠå±å¹•æ¨ªè¿‡æ¥çš„æ—¶å€™çŠ¶æ€æ ä¼šæ¶ˆå¤±ã€‚\nå¦‚æœæ²¡æœ‰å¾—åˆ°ä½ æœŸæœ›çš„ç»“æœï¼Œå¯ä»¥ä½¿ç”¨ Auto Layout è°ƒè¯•åŠŸèƒ½æ¥è§£å†³é—®é¢˜ã€‚ç‚¹å‡» Resolve Auto Layout Issues å›¾æ ‡ï¼Œé€‰æ‹© Reset to Suggested Constraints ï¼ŒXcode ä¼šå°†ç•Œé¢è°ƒæ•´åˆ°ä¸€ä¸ªåˆé€‚çš„è®¾å®šã€‚æˆ–è€…ç‚¹å‡» Resolve Auto Layout Issues å›¾æ ‡ï¼Œé€‰æ‹© Clear Constraintsï¼ŒXcode ä¼šåˆ é™¤ UI å…ƒç´ çš„æ‰€æœ‰é™åˆ¶ï¼Œç„¶åå°±å¯ä»¥é‡æ–°è®¾ç½®ã€‚\nè™½ç„¶æ²¡æœ‰åœ¨è¿™ä¸ªåœºæ™¯ä¸Šåšå¤šå°‘å·¥ä½œï¼Œä½†æ˜¯å·²ç»æœ‰ä¸¤åŸºæœ¬çš„ UI å’ŒåŠŸèƒ½ã€‚è¦ç¡®ä¿ä½ çš„å¸ƒå±€æ˜¯å¥å£®çš„ï¼Œå¹¶ä¸”å¯æ‰©å±•ï¼Œä¸ºåé¢çš„å‡çº§æ‰“ä¸‹åšå®çš„åŸºç¡€ã€‚\n","date":"2016 May 6","permalink":"/posts/2016/05/06/","section":"Posts","summary":"åŸæ–‡ï¼šStart Developing iOS Apps (Swift)","title":"Start Developing iOS Apps (Swift)"},{"content":"1. ç®€ä»‹ #æ™´å¤©é’Ÿæ˜¯ä¸€ç³»åˆ—å¤©æ°”é¢„æµ‹äº§å“çš„æ€»ç§°ï¼Œå®ƒä»¬ä¸»è¦æå–äºç¾å›½å›½å®¶å¤§æ°”æµ·æ´‹å±€/æ°”å€™ç¯å¢ƒé¢„æµ‹å±€(NOAA/NCEP)çš„â€œå…¨çƒé¢„æµ‹ç³»ç»Ÿâ€(Global Forecast System, GFS)æ•°å€¼æ¨¡å¼ã€‚ç”±å¶æ³‰å¿—å¼€å‘ï¼Œç›®å‰ç”±ä¸­å›½ç§‘å­¦é™¢ä¸Šæµ·å¤©æ–‡å°ä¸­å›½å¤©æ–‡ç§‘æ™®ç½‘æä¾›ç¡¬ä»¶åŠç½‘ç»œæ”¯æŒã€‚\n2. ä½¿ç”¨ #åŸŸåæ˜¯ http://7timer.org ï¼ŒIP è®¿é—® http://202.127.24.18/ ã€‚åŸŸåä¸å¤ªç¨³å®šï¼Œé€šå¸¸ç”¨ IP è®¿é—® ã€‚ç”±äºå®ƒä½¿ç”¨çš„æ˜¯ Google åœ°å›¾ï¼Œæ‰€æœ‰è¦å¼€å¯ç¿»å¢™ä»£ç†ï¼Œè¿˜è¦é€‰æ‹©è‹±æ–‡ï¼Œå¦åˆ™å°±çœ‹ä¸åˆ°åœ°å›¾äº†ã€‚\næˆ‘é€šå¸¸ç”¨å®ƒæ¥æŸ¥çœ‹å¤©æ–‡ç”¨é€”çš„å¤©æ°”é¢„æŠ¥ã€‚åœ¨åœ°å›¾ä¸Šå•å‡»é€‰ç‚¹ï¼Œç„¶åé€‰æ‹© ASTRO ï¼š\nå°±å¯ä»¥çœ‹åˆ°å¤©æ–‡ç”¨é€”çš„ä¸‰å¤©å¤©æ°”é¢„æŠ¥ï¼š\nå„ç§å›¾æ ‡çš„å«ä¹‰ï¼š\n3. API #æœ‰ä¸¤ç§ API ï¼šå›¾è¡¨ API å’Œç¨‹åº API ã€‚\nå›¾è¡¨ API #è°ƒç”¨å›¾è¡¨ API å°†ä¼šè¿”å›ç±»ä¼¼æ™´å¤©é’Ÿç½‘ç«™æ‰€è§çš„é¢„æŠ¥å›¾è¡¨ï¼ŒAPI æ˜¯ä¸€ä¸ª URL ï¼Œè¿”å›çš„å›¾è¡¨ä¸ºPNGæ ¼å¼ï¼Œç›´æ¥ç”¨æµè§ˆå™¨è®¿é—®å¦‚ä¸‹ URL å³å¯ï¼š\nhttp://202.127.24.18/v4/bin/astro.php?lon=113.17\u0026amp;lat=23.09\u0026amp;ac=0\u0026amp;lang=en\u0026amp;unit=metric\u0026amp;output=internal\u0026amp;tzshift=0\nå¯ä»¥é€šè¿‡å‚æ•°æ¥æ§åˆ¶è¿”å›ç»“æœï¼Œè¿™äº›å‚æ•°çš„å«ä¹‰ï¼š\nlon, lat - æŒ‡å®šåœ°ç‚¹çš„ç»çº¬åº¦ï¼Œå¿…é¡»æ˜¯æµ®ç‚¹æ•°ã€‚ ac â€“ é«˜åº¦æ”¹æ­£ï¼Œåªå¯¹å¤©æ–‡ç”¨é€”é¢„æŠ¥æœ‰æ•ˆã€‚å¯å– 0ï¼ˆé»˜è®¤ï¼‰ã€2 æˆ– 7ã€‚åªé€‚ç”¨äºå›¾è¡¨ APIã€‚ lang â€“ è¯­è¨€ï¼Œen è¡¨ç¤ºè‹±æ–‡ï¼Œzh-CN è¡¨ç¤ºä¸­æ–‡ã€‚åªé€‚ç”¨äºå›¾è¡¨ API ã€‚ unit â€“ å…¬åˆ¶æˆ–è‹±åˆ¶ï¼Œmetric/imperial ã€‚å¯¹ç¨‹åº API æ— æ•ˆã€‚ output â€“ å¯è®¾å®šä¸º internalï¼ˆå›¾è¡¨è¾“å‡ºï¼‰ã€xml æˆ– jsonï¼ˆç¨‹åº API ï¼‰ã€‚ tzshift â€“ æ—¶åŒºå¾®è°ƒï¼Œå¯å– 0ã€1 æˆ– -1ã€‚å¯¹ç¨‹åº API æ— æ•ˆã€‚ product â€“ ä¸ºç¨‹åº API é€‰æ‹©äº§å“ï¼Œåº”ä¸º astroï¼ˆå¤©æ–‡ç”¨é€”ï¼‰, civil, civillight, meteo æˆ– two ã€‚ ç¨‹åº API #ç¨‹åº API è‹¥è¢«æˆåŠŸè°ƒç”¨ï¼Œå°†ä¼šè¿”å›ä¸€ç³»åˆ—æ•°æ®ã€‚è¿™äº›æ•°æ®ä½¿ç”¨ XML æˆ– JSON æ ¼å¼å°è£…ï¼Œå…¶åœ°å€åˆ†åˆ«ä¸ºï¼š\nXML: http://202.127.24.18v4/bin/api.pl?lon=118.093\u0026amp;lat=24.468\u0026amp;product=astro\u0026amp;output=xml JSON: http://202.127.24.18/v4/bin/api.pl?lon=118.093\u0026amp;lat=24.468\u0026amp;product=astro\u0026amp;output=json\nproduct è®¾ä¸º astro æ—¶ï¼Œä¼šè¿”å›å¤©æ–‡ç”¨é€”çš„æ•°æ®ï¼Œè¿”å›å€¼çš„å«ä¹‰ï¼š\nå˜é‡ è¿”å›å€¼ å®šä¹‰ äº‘é‡ 1 0%-6% 2 6%-19% 3 19%-31% 4 31%-44% 5 44%-56% 6 56%-69% 7 69%-81% 8 81%-94% 9 94%-100% æŠ¬å‡æŒ‡æ•° -10 å°äº-7 -6 -7è‡³-5 -4 -5è‡³-3 -1 -3è‡³0 2 0è‡³4 6 4è‡³8 10 8è‡³11 15 å¤§äº11 2ç±³æ°”æ¸© -76è‡³60 -76æ‘„æ°åº¦è‡³+60æ‘„æ°åº¦ è§†å®åº¦ 1 \u0026lt;0.5\u0026quot; 2 0.5\u0026quot;-0.75\u0026quot; 3 0.75\u0026quot;-1\u0026quot; 4 1\u0026quot;-1.25\u0026quot; 5 1.25\u0026quot;-1.5\u0026quot; 6 1.5\u0026quot;-2\u0026quot; 7 2\u0026quot;-2.5\u0026quot; 8 \u0026gt;2.5\u0026quot; é€æ˜åº¦ 1 \u0026lt;0.3 2 0.3-0.4 3 0.4-0.5 4 0.5-0.6 5 0.6-0.7 6 0.7-0.85 7 0.85-1 8 \u0026gt;1 2ç±³ç›¸å¯¹æ¹¿åº¦ -4 0%-5% -3 5%-10% -2 10%-15% -1 15%-20% 0 20%-25% 1 25%-30% 2 30%-35% 3 35%-40% 4 40%-45% 5 45%-50% 6 50%-55% 7 55%-60% 8 60%-65% 9 65%-70% 10 70%-75% 11 75%-80% 12 80%-85% 13 85%-90% 14 90%-95% 15 95%-99% 16 100% 10ç±³é£é€Ÿ 1 ä½äº0.3ç±³/ç§’ï¼ˆæ— é£ï¼‰ 2 0.3-3.4ç±³/ç§’ï¼ˆ1-2çº§ï¼‰ 3 3.4-8.0ç±³/ç§’ï¼ˆ3-4çº§ï¼‰ 4 8.0-10.8ç±³/ç§’ï¼ˆ5çº§ï¼‰ 5 10.8-17.2ç±³/ç§’ï¼ˆ6-7çº§ï¼‰ 6 17.2-24.5ç±³/ç§’ï¼ˆ8-9çº§ï¼‰ 7 24.5-32.6ç±³/ç§’ï¼ˆ10-11çº§ï¼‰ 8 è¶…è¿‡32.6ç±³/ç§’ï¼ˆ12çº§æˆ–ä»¥ä¸Šï¼‰ é™æ°´ç±»å‹ snowï¼ˆé›ªï¼‰ã€rainï¼ˆé›¨ï¼‰ã€noneï¼ˆæ— ï¼‰ æ— æ•ˆå€¼ -9999 æ— æ•ˆå€¼ ","date":"2016 April 6","permalink":"/posts/2016/04/06/","section":"Posts","summary":"1. ç®€ä»‹ #æ™´å¤©é’Ÿæ˜¯ä¸€ç³»åˆ—å¤©æ°”é¢„æµ‹äº§å“çš„æ€»ç§°ï¼Œå®ƒä»¬ä¸»è¦æå–äºç¾å›½å›½å®¶å¤§æ°”æµ·æ´‹å±€/æ°”å€™ç¯å¢ƒé¢„æµ‹å±€(NOAA/NCEP)çš„â€œå…¨çƒé¢„æµ‹ç³»ç»Ÿâ€(Global Forecast System, GFS)æ•°å€¼æ¨¡å¼ã€‚ç”±å¶æ³‰å¿—å¼€å‘ï¼Œç›®å‰ç”±ä¸­å›½ç§‘å­¦é™¢ä¸Šæµ·å¤©æ–‡å°ä¸­å›½å¤©æ–‡ç§‘æ™®ç½‘æä¾›ç¡¬ä»¶åŠç½‘ç»œæ”¯æŒã€‚","title":"æ™´å¤©é’Ÿ Documentation"},{"content":"è“ç‰™ 4.0 ç‰ˆæœ¬æ¨å‡ºäº†ä½åŠŸè€—è§„èŒƒï¼Œç®€ç§° BLE (Bluetooth Low Energy)ï¼Œå¾ˆå¤šå°å‹è®¾å¤‡ï¼Œä¾‹å¦‚å°ç±³æ‰‹ç¯ï¼Œéƒ½æ˜¯ä½¿ç”¨ä½åŠŸè€—è“ç‰™ã€‚è¦ä¸è¿™ç±»æ¨¡å—è¿æ¥ï¼Œä¸»è®¾å¤‡çš„è“ç‰™æ¨¡å—å¿…é¡»æ”¯æŒä½åŠŸè€—ï¼Œä¾‹å¦‚ intel 2230 ï¼š\nç°åœ¨æœ‰ä¸€ä¸ª BLE çš„é€ä¼ æ¨¡å—ï¼Œä¼šä¸æ–­çš„å‘å‡ºæ•°æ®ï¼Œæˆ‘çš„ä¸»æœºå®‰è£…äº† Linux ï¼Œä½¿ç”¨ intel 2230 æ¥æ”¶æ•°æ®ã€‚åè®®æ ˆä¾ç„¶æ˜¯ BlueZ ã€‚\n1. GATT åè®® #BLE è¿æ¥éƒ½æ˜¯å»ºç«‹åœ¨ GATT åè®®ä¹‹ä¸Šçš„ã€‚ä»‹ç» GATT ä¹‹å‰ï¼Œéœ€è¦äº†è§£ GAPï¼ˆGeneric Access Profileï¼‰ã€‚å®ƒåœ¨ç”¨æ¥æ§åˆ¶è®¾å¤‡è¿æ¥å’Œå¹¿æ’­ã€‚GAP ä½¿ä½ çš„è®¾å¤‡è¢«å…¶ä»–è®¾å¤‡å¯è§ï¼Œå¹¶å†³å®šäº†ä½ çš„è®¾å¤‡æ˜¯å¦å¯ä»¥æˆ–è€…æ€æ ·ä¸åˆåŒè®¾å¤‡è¿›è¡Œäº¤äº’ã€‚GAP ç»™è®¾å¤‡å®šä¹‰äº†è‹¥å¹²è§’è‰²ï¼Œå…¶ä¸­ä¸»è¦çš„ä¸¤ä¸ªæ˜¯ï¼šå¤–å›´è®¾å¤‡ï¼ˆPeripheralï¼‰å’Œä¸­å¿ƒè®¾å¤‡ï¼ˆCentralï¼‰ï¼Œå¤–è®¾å¿…é¡»ä¸åœçš„å‘å¤–å¹¿æ’­ï¼Œè®©ä¸­å¿ƒè®¾å¤‡çŸ¥é“å®ƒçš„å­˜åœ¨ã€‚ä¸­å¿ƒè®¾å¤‡æ‰«æåˆ°å¤–è®¾åï¼Œå‘èµ·å¹¶å»ºç«‹ GATT è¿æ¥ã€‚\nGATT è¿æ¥æ˜¯ç‹¬å çš„ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ª BLE å¤–è®¾åŒæ—¶åªèƒ½è¢«ä¸€ä¸ªä¸­å¿ƒè®¾å¤‡è¿æ¥ã€‚ä¸€æ—¦å¤–è®¾è¢«è¿æ¥ï¼Œå®ƒå°±ä¼šé©¬ä¸Šåœæ­¢å¹¿æ’­ã€‚ä¸­å¿ƒè®¾å¤‡å’Œå¤–è®¾éœ€è¦åŒå‘é€šä¿¡çš„è¯ï¼Œå”¯ä¸€çš„æ–¹å¼å°±æ˜¯å»ºç«‹ GATT è¿æ¥ã€‚ä¸€ä¸ªå¤–è®¾åªèƒ½è¿æ¥ä¸€ä¸ªä¸­å¿ƒè®¾å¤‡ï¼Œè€Œä¸€ä¸ªä¸­å¿ƒè®¾å¤‡å¯ä»¥è¿æ¥å¤šä¸ªå¤–è®¾ã€‚GATT å®šä¹‰ BLE é€šä¿¡çš„åŒæ–¹æ˜¯ C/S å…³ç³»ï¼Œå¤–è®¾ä½œä¸ºæœåŠ¡ç«¯ï¼ˆServerï¼‰ï¼Œä¹Ÿå«ä»è®¾å¤‡ï¼ˆSlaveï¼‰ï¼Œä¸­å¿ƒè®¾å¤‡æ˜¯å®¢æˆ·ç«¯ï¼ˆClientï¼‰ï¼Œä¹Ÿå«ä¸»è®¾å¤‡ï¼ˆMasterï¼‰ã€‚æ‰€æœ‰çš„é€šä¿¡äº‹ä»¶ï¼Œéƒ½æ˜¯ç”± Client å‘èµ·è¯·æ±‚ï¼ŒServer ä½œå‡ºå“åº”ã€‚ä½† GATT è¿˜æœ‰ä¸¤ä¸ªç‰¹æ€§ï¼šnotification å’Œ indicationã€‚è¿™æ„å‘³ç€ server å¯ä»¥ä¸»åŠ¨å‘å‡ºé€šçŸ¥å’ŒæŒ‡ç¤ºï¼Œä½¿ client ç«¯ä¸ç”¨è½®è¯¢ã€‚\nGATT æ˜¯ä¸€ä¸ªåœ¨è“ç‰™è¿æ¥ä¹‹ä¸Šçš„å‘é€å’Œæ¥æ”¶å¾ˆçŸ­çš„æ•°æ®æ®µçš„é€šç”¨è§„èŒƒï¼ˆATTï¼‰ï¼Œè¿™äº›å¾ˆçŸ­çš„æ•°æ®æ®µè¢«ç§°ä¸ºå±æ€§ï¼ˆAttributeï¼‰ã€‚ä¸€ä¸ª attribute ç”±ä¸‰ç§å…ƒç´ ç»„æˆï¼š\nä¸€ä¸ª16ä½çš„å¥æŸ„ï¼ˆhandleï¼‰ ä¸€ä¸ªå®šé•¿çš„å€¼ï¼ˆvalueï¼‰ ä¸€ä¸ª UUIDï¼Œå®šä¹‰äº† attribute çš„ç±»å‹ï¼Œvalue çš„æ„ä¹‰å®Œå…¨ç”± UUID å†³å®šã€‚ attribute çš„ handle å…·æœ‰å”¯ä¸€æ€§ï¼Œä»…ç”¨ä½œåŒºåˆ†ä¸ç”¨çš„ attributeï¼ˆå› ä¸ºå¯èƒ½æœ‰å¾ˆå¤šä¸åŒçš„ attribute æ‹¥æœ‰ç›¸åŒçš„ UUIDï¼‰\nAttribute åªå­˜å‚¨åœ¨ Server ç«¯ï¼Œå¤šä¸ª attribute æ„æˆä¸€ä¸ª characteristicï¼ˆç‰¹å¾å€¼ï¼‰ï¼Œä¸€ä¸ªæˆ–å¤šä¸ª characteristic æ„æˆä¸€ä¸ª Service (æœåŠ¡)ï¼Œä¸€ä¸ª BLE è®¾å¤‡å¯ä»¥æœ‰å¤šä¸ª Service ï¼ŒService æ˜¯æŠŠæ•°æ®åˆ†æˆä¸€ä¸ªä¸ªçš„ç‹¬ç«‹é€»è¾‘é¡¹ã€‚\nä¸€ä¸ª GATT Service å§‹äº UUID ä¸º 0x2800 çš„ attribute ï¼Œç›´åˆ°ä¸‹ä¸€ä¸ª UUID ä¸º 0x2800 çš„ attribute ä¸ºæ­¢ã€‚èŒƒå›´å†…çš„æ‰€æœ‰ attribute éƒ½å±äºè¯¥æœåŠ¡çš„ã€‚ä¾‹å¦‚ï¼Œä¸€å°æœ‰ä¸‰ç§æœåŠ¡çš„è®¾å¤‡æ‹¥æœ‰å¦‚ä¸‹æ‰€ç¤ºçš„ attribute å¸ƒå±€ï¼š\nHandle UUID Description Value 0x0100 0x2800 Service A definition 0x1816 (UUID) \u0026hellip; \u0026hellip; Service details \u0026hellip; 0x0150 0x2800 Service B definition 0x18xx \u0026hellip; \u0026hellip; Service details \u0026hellip; 0x0300 0x2800 Service C definition 0x18xx \u0026hellip; \u0026hellip; Service details \u0026hellip; handle å…·æœ‰å”¯ä¸€æ€§ï¼Œå±äº Service B çš„ attribute çš„ handle èŒƒå›´è‚¯å®šè½åœ¨ 0x0151 å’Œ 0x02ff ä¹‹ä¸­ã€‚é‚£ä¹ˆï¼Œæˆ‘å¦‚ä½•çŸ¥é“ä¸€ä¸ª Service æ˜¯æ¸©åº¦æ£€æµ‹ï¼Œè¿˜æ˜¯ GPS å‘¢ï¼Ÿé€šè¿‡è¯»å–è¯¥ Service çš„ attribute çš„ value ã€‚UUID ä¸º 0x2800 çš„ attribute ä½œä¸º Service çš„èµ·å§‹æ ‡å¿—ï¼Œå®ƒçš„ value å°±æ˜¯è¯¥æœåŠ¡çš„ UUID ï¼Œæ˜¯è¯¥æœåŠ¡çš„å”¯ä¸€æ ‡è¯†ï¼Œè¡¨ç¤ºäº†è¯¥æœåŠ¡çš„ç±»å‹ã€‚UUID æœ‰ 16 bit çš„ï¼Œæˆ–è€… 128 bit çš„ã€‚16 bit çš„ UUID æ˜¯å®˜æ–¹é€šè¿‡è®¤è¯çš„ï¼Œéœ€è¦è´­ä¹°ï¼Œ128 bit æ˜¯è‡ªå®šä¹‰çš„ï¼Œè¿™ä¸ªå°±å¯ä»¥è‡ªå·±éšä¾¿è®¾ç½®ã€‚\næ¯ä¸ª Service éƒ½åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ª characteristicï¼ˆç‰¹å¾å€¼ï¼‰ã€‚è¿™äº› characteristic è´Ÿè´£å­˜å‚¨ Service çš„æ•°æ®å’Œè®¿é—®æƒé™ã€‚æ¯ä¸ª Characteristic ç”¨ 16 bit æˆ–è€… 128 bit çš„ UUID å”¯ä¸€æ ‡è¯†ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªæ¸©åº¦è®¡ï¼ˆserviceï¼‰ä¸€èˆ¬ä¼šæœ‰ä¸€ä¸ªåªè¯»çš„â€œæ¸©åº¦â€characteristicï¼Œå’Œä¸€ä¸ªå¯è¯»å†™çš„â€œæ—¥æœŸæ—¶é—´â€characteristicï¼š\nHandle UUID Description Value 0x0100 0x2800 Thermometer service definition UUID 0x1816 0x0101 0x2803 Characteristic: temperature UUID 0x2A2B,Value handle: 0x0102 0x0102 0x2A2B Temperature value 20 degrees 0x0110 0x2803 Characteristic: date/time UUID 0x2A08,Value handle: 0x0111 0x0111 0x2A08 Date/Time 1/1/1980 12:00 å¯ä»¥çœ‹åˆ°ï¼Œhandle 0x0101 å®šä¹‰äº†ä¸€ä¸ªâ€œæ¸©åº¦â€ characteristic ï¼Œè¯¥ characteristic çš„ UUID æ˜¯ 0x2A2Bï¼Œå®ƒçš„å€¼ä½äº handle 0x0102 ã€‚\né™¤äº† valueï¼Œè¿˜å¯ä»¥åœ¨ characteristic çš„é™„åŠ  attribute é‡Œè·å–åˆ°å…¶å®ƒä¿¡æ¯ã€‚è¿™äº›é™„åŠ çš„ attribute ç§°ä¸º descriptor ã€‚ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬æˆ‘ä»¬éœ€è¦æ˜ç¡®æ¸©åº¦è®¡çš„è®¡é‡å•ä½æ—¶ï¼Œå¯ä»¥é€šè¿‡æ·»åŠ ä¸€ä¸ª descriptor æ¥å®ç°ï¼š\nHandle UUID Description Value 0x0100 0x2800 Thermometer service definition UUID 0x1816 0x0101 0x2803 Characteristic: temperature UUID 0x2A2B,Value handle: 0x0102 0x0102 0x2A2B Temperature value 20 degrees 0x0104 0x2A1F Descriptor: unit Celsius 0x0110 0x2803 Characteristic: date/time UUID 0x2A08,Value handle: 0x0111 0x0111 0x2A08 Date/Time 1/1/1980 12:00 GATT çŸ¥é“ handle 0x0104 æ˜¯å±äº characteristic 0x0101 çš„ descriptorï¼Œå› ä¸ºï¼š\nå®ƒä¸æ˜¯ä¸€ä¸ª value attributeï¼Œå› ä¸º value attribute å·²ç»æŒ‡æ˜æ˜¯ handle 0x0102 å®ƒåˆšå¥½åœ¨ 0x0103..0x010F çš„èŒƒå›´å†…ï¼Œä¸¤ä¸ª characteristic ä¹‹é—´ æ¯ä¸ª service éƒ½å¯ä»¥è‡ªå®šä¹‰ desctiptorï¼ŒGATT å·²ç»é¢„å®šä¹‰äº†ä¸€ç³»åˆ—å¸¸ç”¨çš„ desctiptor ï¼š\næ•°æ®æ ¼å¼å’Œè¡¨è¾¾æ–¹å¼ å¯è¯»æ€§æè¿° æœ‰æ•ˆèŒƒå›´ æ‰©å±•å±æ€§ å…¶ä¸­ä¸€ä¸ªå¾ˆé‡è¦çš„ descriptor æ˜¯ client characteristic configuration ï¼Œç®€ç§° CCC descriptor ï¼Œå®ƒçš„ UUID æ˜¯ 0x2902 ï¼Œæœ‰ä¸€ä¸ªå¯è¯»æ€§çš„ 16 ä½ Value ï¼Œä½ä¸¤ä½å·²ç»è¢«å ç”¨ï¼Œç”¨äºé…ç½® characteristic çš„ notification å’Œ indication ï¼š\nBit 0 è®¾ä¸º 1 è¡¨ç¤ºä½¿èƒ½ Notification Bit 1 è®¾ä¸º 1 è¡¨ç¤ºä½¿èƒ½ Indication å¯¹äºå…·æœ‰ Notify å±æ€§çš„ characteristic ï¼Œä½¿èƒ½ Notification åï¼Œæ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ä¼šä¸»åŠ¨é€šçŸ¥ Client ç«¯ï¼ŒClient ç«¯åªè¦ç›‘å¬å³å¯ã€‚\n2. Linux ä¸­çš„æ“ä½œ #åœ¨ BlueZ ä¸­å°±è¦ç”¨ hcitool lescan å‘½ä»¤æ‰«æä½åŠŸè€—è“ç‰™è®¾å¤‡ï¼š\nroot@WR-IntelligentDevice:~# hcitool lescan LE Scan ... 20:91:48:6B:65:08 (unknown) 20:91:48:6B:65:08 SPP_2091486B6508 gatttool æ˜¯ç”¨æ¥è®¿é—® BLE è®¾å¤‡çš„å‘½ä»¤ï¼Œç”¨ gatttool -b 20:91:48:6B:65:08 -I æ‰“å¼€ä¸€ä¸ªä¸è¿œç¨‹è®¾å¤‡çš„ä¼šè¯ï¼Œ-I è¡¨ç¤ºäº¤äº’æ¨¡å¼ï¼š\nroot@WR-IntelligentDevice:~# gatttool -b 20:91:48:6B:65:08 -I [ ][20:91:48:6B:65:08][LE]\u0026gt; help help Show this help exit Exit interactive mode quit Exit interactive mode connect [address [address type]] Connect to a remote device disconnect Disconnect from a remote device primary [UUID] Primary Service Discovery characteristics [start hnd [end hnd [UUID]]] Characteristics Discovery char-desc [start hnd] [end hnd] Characteristics Descriptor Discovery char-read-hnd \u0026lt;handle\u0026gt; [offset] Characteristics Value/Descriptor Read by handle char-read-uuid \u0026lt;UUID\u0026gt; [start hnd] [end hnd] Characteristics Value/Descriptor Read by UUID char-write-req \u0026lt;handle\u0026gt; \u0026lt;new value\u0026gt; Characteristic Value Write (Write Request) char-write-cmd \u0026lt;handle\u0026gt; \u0026lt;new value\u0026gt; Characteristic Value Write (No response) sec-level [low | medium | high] Set security level. Default: low mtu \u0026lt;value\u0026gt; Exchange MTU for GATT/ATT [ ][20:91:48:6B:65:08][LE]\u0026gt; connect è¡¨ç¤ºè¿æ¥è¿œç¨‹è®¾å¤‡ï¼Œè¿æ¥æˆåŠŸåï¼Œæç¤ºç¬¦ç­¾åçš„çŠ¶æ€ä¼šæ˜¾ç¤º \u0026ldquo;CON\u0026rdquo; :\n[ ][20:91:48:6B:65:08][LE]\u0026gt; connect [CON][20:91:48:6B:65:08][LE]\u0026gt; primary å‘½ä»¤ä¼šåˆ—å‡ºè¿œç¨‹è®¾å¤‡ä¸Šæ‰€æœ‰çš„ Service ï¼Œæ¯ä¸ªæœåŠ¡æ‰€åœ¨çš„ handle èŒƒå›´:\n[CON][20:91:48:6B:65:08][LE]\u0026gt; primary [CON][20:91:48:6B:65:08][LE]\u0026gt; attr handle: 0x0001, end grp handle: 0x000b uuid: 00001800-0000-1000-8000-00805f9b34fb attr handle: 0x000c, end grp handle: 0x000f uuid: 00001801-0000-1000-8000-00805f9b34fb attr handle: 0x0010, end grp handle: 0x0017 uuid: 0000fee7-0000-1000-8000-00805f9b34fb attr handle: 0x0018, end grp handle: 0x001b uuid: 0000fee0-0000-1000-8000-00805f9b34fb attr handle: 0x001c, end grp handle: 0x0024 uuid: f000ffc0-0451-4000-b000-000000000000 attr handle: 0x0025, end grp handle: 0x002f uuid: 0000ccc0-0000-1000-8000-00805f9b34fb attr handle: 0x0030, end grp handle: 0xffff uuid: 0000180a-0000-1000-8000-00805f9b34fb ç”¨ primary fee7 æŸ¥çœ‹ UUID ä¸º 0xfee7 çš„ Service ï¼Œæ‰§è¡Œ characteristics 0x0010 0x0017 å¯ä»¥å‘ç°å®ƒæœ‰ä¸‰ä¸ª characteristics ï¼š\n[CON][20:91:48:28:26:AF][LE]\u0026gt; primary fee7 [CON][20:91:48:28:26:AF][LE]\u0026gt; Starting handle: 0x0010 Ending handle: 0x0017 [CON][20:91:48:28:26:AF][LE]\u0026gt; characteristics 0x0010 0x0017 [CON][20:91:48:28:26:AF][LE]\u0026gt; handle: 0x0011, char properties: 0x20, char value handle: 0x0012, uuid: 0000fec8-0000-1000-8000-00805f9b34fb handle: 0x0014, char properties: 0x0a, char value handle: 0x0015, uuid: 0000fec7-0000-1000-8000-00805f9b34fb handle: 0x0016, char properties: 0x02, char value handle: 0x0017, uuid: 0000fec9-0000-1000-8000-00805f9b34fb char properties è¡¨ç¤º characteristic çš„å±æ€§ï¼Œchar value handle è¡¨ç¤º characteristic çš„å€¼æ‰€åœ¨çš„ attribute çš„ handle ã€‚ä¸‹é¢æ˜¯ characteristic properties çš„è¯´æ˜ï¼š\nç°åœ¨è¿œç¨‹è®¾å¤‡ä¸Šæœ‰ä¸€ä¸ªé€ä¼ æœåŠ¡æ˜¯ 0xFEE0, ä¼ è¾“æ•°æ®çš„ç‰¹å¾å€¼æ˜¯ 0xFEE1 ï¼Œå¯ä»¥ç”¨å¦‚ä¸‹æ–¹å¼æŸ¥çœ‹ï¼š\n[CON][20:91:48:6B:65:08][LE]\u0026gt; primary 0xfee0 [CON][20:91:48:6B:65:08][LE]\u0026gt; Starting handle: 0x0018 Ending handle: 0x001b [CON][20:91:48:6B:65:08][LE]\u0026gt; characteristics 0x0018 0x001b [CON][20:91:48:6B:65:08][LE]\u0026gt; handle: 0x0019, char properties: 0x14, char value handle: 0x001a, uuid: 0000fee1-0000-1000-8000-00805f9b34fb [CON][20:91:48:6B:65:08][LE]\u0026gt; char-desc 0x0018 0x001b [CON][20:91:48:6B:65:08][LE]\u0026gt; handle: 0x0018, uuid: 2800 handle: 0x0019, uuid: 2803 handle: 0x001a, uuid: fee1 handle: 0x001b, uuid: 2902 é¦–å…ˆæ‰§è¡Œ primary 0xfee0 ï¼Œå‘ç°è¯¥æœåŠ¡åŒ…å« handle 0x0018 åˆ° handle 0x001b ä¹‹é—´çš„ attribute ã€‚ç„¶åç”¨ characteristics 0x0018 0x001b å‘ç°è¯¥æœåŠ¡æœ‰ä¸€ä¸ª characteristic ï¼Œå®ƒçš„å€¼åœ¨ handle 0x001a ï¼Œå±æ€§æ˜¯ 0x14 ï¼Œè¡¨ç¤ºå¯å†™æ— å›å¤/é€šçŸ¥ï¼ˆWrite without response/Notifyï¼‰ã€‚æœ€åç”¨ char-desc 0x0018 0x001b åˆ—å‡ºè¯¥ç‰¹å¾å€¼çš„æ‰€æœ‰ Descriptor ï¼Œæœ€åä¸€ä¸ª UUID ä¸º 0x2902 ï¼Œæ˜¯ä¸€ä¸ª CCC Descriptor ï¼Œè¯»å–å®ƒå½“å‰çš„å€¼ï¼š\n[CON][20:91:48:28:26:AF][LE]\u0026gt; char-read-hnd 0x001b [CON][20:91:48:28:26:AF][LE]\u0026gt; Characteristic value/descriptor: 00 00 é€šè¿‡ handle è¯»å†™çš„å¥½å¤„æ˜¯å‡†ç¡®ï¼Œå› ä¸º handle å…·æœ‰å”¯ä¸€æ€§ã€‚å¦‚æœæ‰§è¡Œ char-read-uuid 0x2902 ï¼Œå°±ä¼šå‘ç°åˆ—å‡ºäº†å¾ˆå¤šä¸ª attribute ã€‚\nå½“å‰çš„å€¼æ˜¯ 0 ï¼Œè¿™ä¸ª characteristic çš„å±æ€§æ˜¯ Notify ï¼Œæ‰€ä»¥è¦å‘ handle 0x001b å†™å…¥ 0x0100 ï¼ˆX86 æ˜¯å°ç«¯ï¼‰ï¼Œä½¿èƒ½ Notify ï¼Œç„¶åå°±ä¼šä¸åœçš„æ”¶åˆ°æ•°æ®ï¼š\n[CON][20:91:48:28:26:AF][LE]\u0026gt; char-write-req 0x001b 0100 [CON][20:91:48:28:26:AF][LE]\u0026gt; Characteristic value was written successfully Notification handle = 0x001a value: 41 47 3a 20 37 30 34 38 20 37 30 39 35 20 36 30 20 2d 31 37 [CON][20:91:48:28:26:AF][LE]\u0026gt; Notification handle = 0x001a value: 20 2d 32 31 33 20 39 34 36 20 2d 39 33 30 20 2d 31 39 36 20 [CON][20:91:48:28:26:AF][LE]\u0026gt; Notification handle = 0x001a value: 39 33 38 20 2d 39 33 30 0a 41 47 3a 20 37 30 34 31 20 37 31 [CON][20:91:48:28:26:AF][LE]\u0026gt; åœ¨éäº¤äº’æ¨¡å¼ä¸‹ï¼Œç”¨ --listen é€‰é¡¹å¯åŠ¨ç›‘å¬æ¨¡å¼æ¥æ¥æ”¶é€šçŸ¥ï¼š\nroot@WR-IntelligentDevice:~# gatttool -b 20:91:48:28:26:AF --char-write-req --handle=0x001b --value=0100 --listen Characteristic value was written successfully Notification handle = 0x001a value: 32 30 37 32 20 35 33 32 39 20 34 32 39 35 20 41 47 3a 20 2d Notification handle = 0x001a value: 32 30 37 36 20 35 33 32 36 20 34 33 30 30 20 41 47 3a 20 2d Notification handle = 0x001a value: 32 30 37 38 20 35 33 32 37 20 34 33 30 35 20 41 47 3a 20 2d 3. å‚è€ƒ #Introduction to Bluetooth Low Energy Get started with Bluetooth Low Energy GATT Specifications Bluetooth: ATT and GATT\n","date":"2016 April 5","permalink":"/posts/2016/04/05/","section":"Posts","summary":"è“ç‰™ 4.","title":"Linux ä¸‹è°ƒè¯•ä½åŠŸè€—è“ç‰™çš„ç¬”è®°"},{"content":"1. ç®€ä»‹ #BlueZ æ˜¯ Linux å®˜æ–¹çš„è“ç‰™åè®®æ ˆï¼Œå®˜ç½‘åœ°å€ï¼š\u0026lt;www.bluez.org\u0026gt; ã€‚\nBlueZ çš„ä»£ç ç”±ä¸¤ä¸ªéƒ¨åˆ†ç»„æˆï¼šå†…æ ¸ä»£ç å’Œç”¨æˆ·ç©ºé—´ç¨‹åºã€‚å†…æ ¸ä»£ç åŒ…æ‹¬é©±åŠ¨å’Œæ ¸å¿ƒåè®®æ ˆï¼Œç”¨æˆ·ç©ºé—´ç¨‹åºåŒ…æ‹¬åº”ç”¨ç¨‹åºæ¥å£å’Œæ“ä½œè“ç‰™è®¾å¤‡çš„å·¥å…·ã€‚BlueZ çš„ä½“ç³»ç»“æ„å¦‚ä¸‹å›¾ï¼š\næˆ‘ä½¿ç”¨çš„ç‰ˆæœ¬æ˜¯ bluez-4.101 ã€‚\n2. æ‰«æ #ä¸‹é¢è¿™ä¸ªä¾‹ç¨‹å±•ç¤ºäº†æœç´¢è“ç‰™è®¾å¤‡çš„è¿‡ç¨‹ï¼Œå¹¶æ˜¾ç¤ºè®¾å¤‡åç§°å’Œåœ°å€ã€‚\n//samplescan.c #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; #include \u0026lt;unistd.h\u0026gt; #include \u0026lt;sys/socket.h\u0026gt; #include \u0026lt;bluetooth/bluetooth.h\u0026gt; #include \u0026lt;bluetooth/hci.h\u0026gt; #include \u0026lt;bluetooth/hci_lib.h\u0026gt; int main(int argc, char **argv) { inquiry_info *ii = NULL; int max_rsp, num_rsp; int dev_id, sock, len, flags; int i; char addr[19] = { 0 }; char name[248] = { 0 }; dev_id = hci_get_route(NULL); sock = hci_open_dev( dev_id ); if (dev_id \u0026lt; 0 || sock \u0026lt; 0) { perror(\u0026quot;opening socket\u0026quot;); exit(1); } len = 8; max_rsp = 255; flags = IREQ_CACHE_FLUSH; ii = (inquiry_info*)malloc(max_rsp * sizeof(inquiry_info)); num_rsp = hci_inquiry(dev_id, len, max_rsp, NULL, \u0026amp;ii, flags); if( num_rsp \u0026lt; 0 ) perror(\u0026quot;hci_inquiry\u0026quot;); for (i = 0; i \u0026lt; num_rsp; i++) { ba2str(\u0026amp;(ii+i)-\u0026gt;bdaddr, addr); memset(name, 0, sizeof(name)); if (hci_read_remote_name(sock, \u0026amp;(ii+i)-\u0026gt;bdaddr, sizeof(name), name, 0) \u0026lt; 0) strcpy(name, \u0026quot;[unknown]\u0026quot;); printf(\u0026quot;%s %s\\n\u0026quot;, addr, name); } free( ii ); close( sock ); return 0; } ç¼–è¯‘ gcc -o simplescan simplescan.c -lbluetooth\nbdaddr_t æ˜¯å­˜å‚¨è“ç‰™è®¾å¤‡åœ°å€çš„åŸºæœ¬æ•°æ®ç»“æ„ï¼š\ntypedef struct { uint8_t b[6]; } __attribute__((packed)) bdaddr_t; BlueZ ä¸­çš„æ‰€æœ‰è“ç‰™åœ°å€éƒ½å­˜æ”¾åœ¨ bdaddr_t ï¼ŒåŒæ—¶æä¾›äº†ä¸¤ä¸ªå‡½æ•°ç”¨äºåœ°å€å­—ç¬¦ä¸²ä¸ bdaddr_t ä¹‹é—´çš„è½¬æ¢ï¼š\nint str2ba( const char *str, bdaddr_t *ba ); int ba2str( const bdaddr_t *ba, char *str ); åœ°å€å­—ç¬¦ä¸²çš„ç»“æ„åº”è¯¥æ˜¯ XX:XX:XX:XX:XX:XX ï¼ŒXX æ˜¯ä¸€ä¸ªåå…­è¿›åˆ¶æ•°ï¼Œstr2ba å‡½æ•°å°†å®ƒè½¬æ¢åˆ° 6 Byte çš„ bdaddr_t ä¸­ã€‚ba2str çš„ä½œç”¨ç›¸åã€‚\n","date":"2016 March 23","permalink":"/posts/2016/03/23/","section":"Posts","summary":"1. ç®€ä»‹ #BlueZ æ˜¯ Linux å®˜æ–¹çš„è“ç‰™åè®®æ ˆï¼Œå®˜ç½‘åœ°å€ï¼š\u0026lt;www.","title":"BlueZ è“ç‰™ç¼–ç¨‹ç¬”è®°"},{"content":"æœ¦èƒ§ä¸­ï¼Œå¥½åƒé†’äº†ã€‚\næŠ¬çœ¼çœ‹çª—å¤–ï¼Œå¤©è¿˜é»‘ï¼Œ\næ‹¿èµ·æ‰‹æœºï¼Œæ‰äº”ç‚¹ã€‚\néšçº¦å¬åˆ°ä»€ä¹ˆå£°éŸ³ï¼Œåº”è¯¥æ˜¯æ¥¼ä¸Šå§ï¼Œ\næŒç»­ä¸æ–­ï¼Œè¶Šæ¥è¶Šæ¸…æ™°â€¦\nè¿™å£°éŸ³è®©æˆ‘æƒ³èµ·å»å¹´å…»è¿‡çš„ä¸€åªçŒ«ã€‚\næœ‰å¤©æ™šä¸Šï¼Œä¸çŸ¥é“å®ƒä»å“ªå¼„æ¥ä¸€ä¸ªæ ¸æ¡ƒï¼Œè‡ªå·±æ‰‘ç€ç©å„¿ï¼Œæ ¸æ¡ƒåœ¨åœ°æ¿ä¸Šæ»šæ¥æ»šå»ï¼Œæ ¼æ¥æ¥åœ°å“â€¦\næˆ‘æ¸…é†’äº†ï¼Œç­‰äº†ä¸€ä¼šå„¿ï¼Œé‚£å£°éŸ³è¿˜åœ¨ï¼Œå°±åœ¨æˆ‘å®¶é‡Œã€‚\nèµ·åºŠï¼Œç©¿é‹ï¼Œæ¥åˆ°å®¢å…ï¼Œå£°éŸ³æ¶ˆå¤±äº†â€¦\næˆ‘æ‰“å¼€æ‰€æœ‰æˆ¿é—´çš„ç¯ï¼Œåœ¨å¨æˆ¿çš„åœ°æ¿ä¸Šï¼Œå‘ç°äº†ä¸€ä¸ªæ ¸æ¡ƒã€‚\nâ€¦â€¦\næˆ‘å®¶ä»æ²¡ä¹°è¿‡æ ¸æ¡ƒï¼Œé‚£ä¸ªæ ¸æ¡ƒè¢«çŒ«æ»šåˆ°äº†åºŠåº•ä¸‹ï¼Œåæ¥çŒ«èµ°äº†ï¼Œæ ¸æ¡ƒä¸€ç›´ç•™åœ¨é‚£ã€‚\n","date":"2016 February 23","permalink":"/posts/2016/02/23/","section":"Posts","summary":"æœ¦èƒ§ä¸­ï¼Œå¥½åƒé†’äº†ã€‚","title":"æ ¸æ¡ƒ"},{"content":"åœ¨ Linux ç³»ç»Ÿä¸­å­˜åœ¨å„ç§æ—¥å¿—æ–‡ä»¶ï¼Œä¾‹å¦‚ä¿å­˜å¯åŠ¨ä¿¡æ¯å’Œå†…æ ¸ä¿¡æ¯çš„ /var/log/dmesg ï¼Œä¿å­˜ç³»ç»Ÿæ—¥å¿—çš„ /var/log/syslog ç­‰ã€‚å¦‚æœè¿ç»­è¿è¡Œæ—¶é—´å¤ªé•¿ï¼Œè¿™äº›æ—¥å¿—ä¼šè¶Šæ¥è¶Šå¤§ï¼Œæœ€ç»ˆå æ®å¤ªå¤šç³»ç»Ÿç©ºé—´ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦å®šæœŸæ¸…ç†ç³»ç»Ÿæ—¥å¿—ã€‚Logrotate çš„ä¸»è¦åŠŸèƒ½å°±æ˜¯å®šæ—¶å°†æ—§çš„æ—¥å¿—æ–‡ä»¶å½’æ¡£ï¼ŒåŒæ—¶åˆ›å»ºä¸€ä¸ªæ–°çš„ç©ºçš„æ—¥å¿—æ–‡ä»¶ï¼Œå½’æ¡£çš„æ–‡ä»¶å¯ä»¥é€‰æ‹©å‹ç¼©æˆ–è€…å‘é€åˆ°æŒ‡å®šçš„é‚®ç®±ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åšè½®æ›¿ï¼ˆrotateï¼‰ï¼š\nLogrotate æ˜¯åŸºäº cron è¿è¡Œçš„ï¼Œä»–çš„è„šæœ¬æ˜¯ /etc/cron.daily/logrotate :\n#!/bin/sh /usr/sbin/logrotate /etc/logrotate.conf EXITVALUE=$? if [ $EXITVALUE != 0 ]; then /usr/bin/logger -t logrotate \u0026quot;ALERT exited abnormally with [$EXITVALUE]\u0026quot; fi exit 0 cron ç”¨äºè®¾ç½®å‘¨æœŸæ€§è¢«æ‰§è¡Œçš„æŒ‡ä»¤ï¼Œæ˜¯è¿è¡Œåœ¨åå°çš„å®ˆæŠ¤è¿›ç¨‹ã€‚\nLogrotate çš„ä¸»é…ç½®æ–‡ä»¶æ˜¯ /etc/logrotate.conf ï¼š\n# see \u0026quot;man logrotate\u0026quot; for details # rotate log files weekly weekly # keep 4 weeks worth of backlogs rotate 4 # create new (empty) log files after rotating old ones create # use date as a suffix of the rotated file dateext # uncomment this if you want your log files compressed #compress # RPM packages drop log rotation information into this directory include /etc/logrotate.d # no packages own wtmp and btmp -- we'll rotate them here /var/log/wtmp { monthly create 0664 root utmp minsize 1M rotate 1 } /var/log/btmp { missingok monthly create 0600 root utmp rotate 1 } # system-specific logs may be also be configured here. å…¶ä¸­ï¼Œä»¥ # å¼€å¤´çš„éƒ½æ˜¯æ³¨é‡Šã€‚include /etc/logrotate.d ä¹‹å‰çš„æ˜¯é»˜è®¤é…ç½®ï¼Œå…¨å±€æœ‰æ•ˆã€‚ä¹‹åä»¥èŠ±æ‹¬å·åŒ…å›´çš„æ˜¯é’ˆå¯¹å•ä¸ªæ–‡ä»¶çš„é…ç½®ï¼Œè¿™é‡Œçš„é…ç½®é¡¹ä¼šè¦†ç›–é»˜è®¤é…ç½®ã€‚é…ç½®é¡¹çš„å«ä¹‰ï¼š\nweekly è¡¨ç¤ºæ¯å‘¨å¯¹æ—¥å¿—æ–‡ä»¶è¿›è¡Œä¸€æ¬¡è½®æ›¿ï¼Œç±»ä¼¼çš„å¯é€‰é¡¹è¿˜æœ‰ monthly ï¼ˆæ¯æœˆä¸€æ¬¡ï¼Œé€šå¸¸æ˜¯æ¯æœˆçš„ç¬¬ä¸€å¤©ï¼‰ï¼Œdailyï¼ˆæ¯å¤©ä¸€æ¬¡ï¼‰ ã€‚ rotate 4 è¡¨ç¤ºä¿ç•™æœ€è¿‘å››æ¬¡çš„å½’æ¡£ï¼Œä¹‹å‰çš„å…¨éƒ¨æ¸…é™¤ã€‚ create è¡¨ç¤ºè½®æ›¿åç«‹å³åˆ›å»ºæ–°çš„ç©ºçš„æ—¥å¿—æ–‡ä»¶ï¼Œå®ƒå¯ä»¥å¸¦ä¸‰ä¸ªå‚æ•°ï¼šmode owner group ï¼Œåˆ†åˆ«è¡¨ç¤ºæ–°æ–‡ä»¶çš„æƒé™ã€æ‰€æœ‰è€…å’Œç”¨æˆ·ç»„ï¼Œä¾‹å¦‚ create 0600 root utmpã€‚ dateext è¡¨ç¤ºä¸ºå½’æ¡£åçš„æ–‡ä»¶åæ·»åŠ æ—¥æœŸä¿¡æ¯ï¼Œæ—¥æœŸçš„æ ¼å¼ç”± dateformat é€‰é¡¹è®¾ç½®ã€‚ compress è¡¨ç¤ºå‹ç¼©å½’æ¡£æ–‡ä»¶ï¼Œæ³¨é‡Šæ‰è¿™ä¸ªé…ç½®é¡¹å°±è¡¨ç¤ºä¸å‹ç¼©ã€‚ å¦å¤–ï¼Œåœ¨ /etc/logrotate.d/ ç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶ä¼šè¢«è¯»å…¥åˆ° /etc/logrotate.d ï¼Œæˆ‘ä»¬è‡ªè¡Œæ·»åŠ çš„é…ç½®æ–‡ä»¶éƒ½å¯ä»¥æ”¾åœ¨è¿™é‡Œã€‚\n","date":"2016 January 21","permalink":"/posts/2016/01/21/","section":"Posts","summary":"åœ¨ Linux ç³»ç»Ÿä¸­å­˜åœ¨å„ç§æ—¥å¿—æ–‡ä»¶ï¼Œä¾‹å¦‚ä¿å­˜å¯åŠ¨ä¿¡æ¯å’Œå†…æ ¸ä¿¡æ¯çš„ /var/log/dmesg ï¼Œä¿å­˜ç³»ç»Ÿæ—¥å¿—çš„ /var/log/syslog ç­‰ã€‚å¦‚æœè¿ç»­è¿è¡Œæ—¶é—´å¤ªé•¿ï¼Œè¿™äº›æ—¥å¿—ä¼šè¶Šæ¥è¶Šå¤§ï¼Œæœ€ç»ˆå æ®å¤ªå¤šç³»ç»Ÿç©ºé—´ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦å®šæœŸæ¸…ç†ç³»ç»Ÿæ—¥å¿—ã€‚Logrotate çš„ä¸»è¦åŠŸèƒ½å°±æ˜¯å®šæ—¶å°†æ—§çš„æ—¥å¿—æ–‡ä»¶å½’æ¡£ï¼ŒåŒæ—¶åˆ›å»ºä¸€ä¸ªæ–°çš„ç©ºçš„æ—¥å¿—æ–‡ä»¶ï¼Œå½’æ¡£çš„æ–‡ä»¶å¯ä»¥é€‰æ‹©å‹ç¼©æˆ–è€…å‘é€åˆ°æŒ‡å®šçš„é‚®ç®±ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åšè½®æ›¿ï¼ˆrotateï¼‰ï¼š","title":"Logrotate"},{"content":"Openemu æ˜¯ä¸€æ¬¾å¤šåŠŸèƒ½æ¸¸æˆæœºæ¨¡æ‹Ÿå™¨è½¯ä»¶ï¼Œå¯ä»¥åœ¨ Mac ä¸Šæ¨¡æ‹Ÿå¤šç§æ¸¸æˆæœºï¼Œä»æ—©æœŸçš„ GBA åˆ°ç´¢å°¼çš„ PSP ï¼Œæœ‰äº†å®ƒï¼Œæˆ‘å°±å¯ä»¥åœ¨ Mac ä¸Šç©è¶…çº§é©¬é‡Œå¥¥é¡¶è˜‘è‡äº†ã€‚\nä½ å¯ä»¥åœ¨å®˜ç½‘ Openemu.org ä¸‹è½½ï¼Œè§£å‹åå³å¯è¿è¡Œã€‚æ¨¡æ‹Ÿå™¨æ²¡æœ‰è‡ªå¸¦æ¸¸æˆï¼Œå¯ä»¥åœ¨ Homebrew ä¸­æµè§ˆä¸‹è½½ï¼Œä½†æ˜¯å¯é€‰æ‹©çš„å¹¶ä¸å¤šã€‚å¦ä¸€ä¸ªç½‘ç«™ emuparadise.me æä¾›äº†å¤§é‡çš„æ¸¸æˆ ROM ï¼Œæˆ‘åœ¨è¿™é‡Œå¯ä»¥æœç´¢é©¬é‡Œå¥¥ï¼š\nç„¶åä¸‹è½½ã€è§£å‹ï¼Œå°†æ¸¸æˆ ROM æ‹–æ‹½åˆ°æ¨¡æ‹Ÿå™¨ç•Œé¢å³å¯å®Œæˆå®‰è£…ã€‚\n","date":"2016 January 10","permalink":"/posts/2016/01/10/","section":"Posts","summary":"Openemu æ˜¯ä¸€æ¬¾å¤šåŠŸèƒ½æ¸¸æˆæœºæ¨¡æ‹Ÿå™¨è½¯ä»¶ï¼Œå¯ä»¥åœ¨ Mac ä¸Šæ¨¡æ‹Ÿå¤šç§æ¸¸æˆæœºï¼Œä»æ—©æœŸçš„ GBA åˆ°ç´¢å°¼çš„ PSP ï¼Œæœ‰äº†å®ƒï¼Œæˆ‘å°±å¯ä»¥åœ¨ Mac ä¸Šç©è¶…çº§é©¬é‡Œå¥¥é¡¶è˜‘è‡äº†ã€‚","title":"Openemu on Mac"},{"content":" ä»¥å‰åªæ˜¯ç”¨ lsof å‘½ä»¤æŸ¥çœ‹æŸä¸ªæ–‡ä»¶è¢«é‚£äº›è¿›ç¨‹æ‰“å¼€äº†ï¼Œç›´åˆ°çœ‹äº†è¿™ç¯‡æ–‡ç« ï¼šAn lsof Primer ï¼Œå±•ç¤ºäº† lsof å¼ºå¤§çš„ä¸€é¢ã€‚ç½‘ä¸Šæœ‰å¾ˆå¤šç¿»è¯‘ï¼Œæ‰¾ä¸åˆ°åŸå§‹ç‰ˆæœ¬äº†ï¼Œæˆ‘ä¿®æ”¹äº†ä¸€äº›åœ°æ–¹ã€‚\nlsof æ˜¯ç³»ç»Ÿç®¡ç†/å®‰å…¨çš„é«˜çº§å·¥å…·ï¼ˆÃ¼ber-toolï¼‰ã€‚å¤§å¤šæ•°æ—¶å€™ï¼Œæˆ‘ç”¨å®ƒæ¥è·å–ç³»ç»Ÿä¸­ä¸ç½‘ç»œè¿æ¥ç›¸å…³çš„ä¿¡æ¯ï¼Œä½†é‚£åªæ˜¯è¿™ä¸ªå¼ºå¤§æœ‰å°ä¼—çš„å‘½ä»¤çš„ç¬¬ä¸€æ­¥ã€‚å°†è¿™ä¸ªå·¥å…·ç§°ä¹‹ä¸º lsof çœŸæ˜¯åå‰¯å…¶å®ï¼Œå› ä¸ºå®ƒæ˜¯æŒ‡â€œåˆ—å‡ºæ‰“å¼€çš„æ–‡ä»¶ï¼ˆlists openfilesï¼‰â€ã€‚åˆ‡è®°ï¼Œåœ¨ Unix ä¸­ä¸€åˆ‡ï¼ˆåŒ…æ‹¬ç½‘ç»œå¥—æ¥å­—ï¼‰éƒ½æ˜¯æ–‡ä»¶ã€‚\næœ‰è¶£çš„æ˜¯ï¼Œlsof ä¹Ÿæ˜¯æœ‰ç€æœ€å¤šå¼€å…³çš„ Linux/Unix å‘½ä»¤ä¹‹ä¸€ã€‚å®ƒæœ‰é‚£ä¹ˆå¤šçš„å¼€å…³ï¼Œè®¸å¤šé€‰é¡¹æ”¯æŒä½¿ç”¨ - å’Œ + å‰ç¼€ã€‚\nusage: [-?abhlnNoOPRstUvV] [+|-c c] [+|-d s] [+D D] [+|-f[cgG]] [-F [f]] [-g [s]] [-i [i]] [+|-L [l]] [+|-M] [-o [o]] [-p s] [+|-r [t]] [-S [t]] [-T [t]] [-u s] [+|-w] [-x [fl]] [--] [names] å¦‚ä½ æ‰€è§ï¼Œlsof æœ‰ç€å®åœ¨æ˜¯ä»¤äººæƒŠè®¶çš„é€‰é¡¹æ•°é‡ã€‚ä½ å¯ä»¥ä½¿ç”¨å®ƒæ¥è·å¾—ç³»ç»Ÿä¸Šçš„è®¾å¤‡ä¿¡æ¯ï¼Œäº†è§£æŒ‡å®šçš„ç”¨æˆ·åœ¨æŒ‡å®šçš„åœ°ç‚¹æ­£åœ¨ç¢°ä»€ä¹ˆä¸œè¥¿ï¼Œç”šè‡³æ˜¯ä¸€ä¸ªè¿›ç¨‹æ­£åœ¨ä½¿ç”¨ä»€ä¹ˆæ–‡ä»¶æˆ–ç½‘ç»œè¿æ¥ã€‚\nå¯¹äºæˆ‘ï¼Œlsof æ›¿ä»£äº† netstat å’Œ ps çš„å…¨éƒ¨å·¥ä½œã€‚å®ƒå¸¦æ¥é‚£äº›å·¥å…·çš„æ‰€æœ‰åŠŸèƒ½ï¼Œè€Œä¸”è¦æ¯”é‚£äº›å·¥å…·è¿˜å¤šå¾—å¤šã€‚é‚£ä¹ˆï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒçš„ä¸€äº›åŸºæœ¬èƒ½åŠ›å§ã€‚\n1. å…³é”®é€‰é¡¹ #ç†è§£ä¸€äº›å…³äº lsof å·¥ä½œæ–¹å¼çš„å…³é”®ç‚¹æ˜¯å¾ˆé‡è¦çš„ã€‚æœ€é‡è¦çš„æ˜¯ï¼Œå½“ä½ ç»™å®ƒä¼ é€’é€‰é¡¹æ—¶ï¼Œé»˜è®¤è¡Œä¸ºæ˜¯å¯¹ç»“æœè¿›è¡Œâ€œæˆ–â€è¿ç®—ã€‚å› æ­¤ï¼Œå¦‚æœä½ æ­£æ˜¯ç”¨ -i æ¥æ‹‰å‡ºä¸€ä¸ªç«¯å£åˆ—è¡¨ï¼ŒåŒæ—¶åˆç”¨ -p æ¥æ‹‰å‡ºä¸€ä¸ªè¿›ç¨‹åˆ—è¡¨ï¼Œé‚£ä¹ˆé»˜è®¤æƒ…å†µä¸‹ä½ ä¼šè·å¾—ä¸¤è€…çš„ç»“æœã€‚\nä¸‹é¢è¿™äº›éœ€è¦ç‰¢è®°ï¼š\né»˜è®¤ : æ²¡æœ‰é€‰é¡¹æ—¶ï¼Œlsof åˆ—å‡ºæ´»è·ƒè¿›ç¨‹çš„æ‰€æœ‰æ‰“å¼€æ–‡ä»¶ ç»„åˆ : å¯ä»¥å°†é€‰é¡¹ç»„åˆåˆ°ä¸€èµ·ï¼Œå¦‚-abcï¼Œä½†è¦æ³¨æ„å“ªäº›é€‰é¡¹éœ€è¦å‚æ•° -a : ç»“æœè¿›è¡Œâ€œä¸â€è¿ç®—ï¼ˆè€Œä¸æ˜¯â€œæˆ–â€ï¼‰ -l : åœ¨è¾“å‡ºæ˜¾ç¤ºç”¨æˆ· ID è€Œä¸æ˜¯ç”¨æˆ·å -h : è·å¾—å¸®åŠ©ä¿¡æ¯ -t : ä»…è·å–è¿›ç¨‹ ID -U : è·å– UNIX å¥—æ¥å­—åœ°å€ -F : æ ¼å¼åŒ–è¾“å‡ºç»“æœï¼Œç”¨äºå…¶å®ƒå‘½ä»¤ã€‚å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼æ ¼å¼åŒ–ï¼Œå¦‚ -F pcfnï¼ˆç”¨äºè¿›ç¨‹ idã€å‘½ä»¤åã€æ–‡ä»¶æè¿°ç¬¦ã€æ–‡ä»¶åï¼Œå¹¶ä»¥ç©ºç»ˆæ­¢ï¼‰ 2. è·å–ç½‘ç»œä¿¡æ¯ #æ­£å¦‚æˆ‘æ‰€è¯´çš„ï¼Œæˆ‘ä¸»è¦ç”¨ lsof è·å–å…³äºç³»ç»Ÿå’Œç½‘ç»œäº¤äº’çš„ä¿¡æ¯ã€‚è¿™é‡Œæä¾›äº†å…³äºæ­¤ä¿¡æ¯çš„ä¸€äº›ä¸»é¢˜ã€‚\n2.1. ä½¿ç”¨ -i æ˜¾ç¤ºæ‰€æœ‰è¿æ¥ #æœ‰äº›äººå–œæ¬¢ç”¨ netstat æ¥è·å–ç½‘ç»œè¿æ¥ï¼Œä½†æ˜¯æˆ‘æ›´å–œæ¬¢ä½¿ç”¨ lsof æ¥è¿›è¡Œæ­¤é¡¹å·¥ä½œã€‚è·å–çš„ä¿¡æ¯ä»¥å¾ˆç›´è§‚çš„æ–¹å¼å‘ˆç°ï¼Œæˆ‘ä»…ä»…åªéœ€æ”¹å˜æˆ‘çš„è¯­æ³•ï¼Œå°±å¯ä»¥é€šè¿‡åŒæ ·çš„å‘½ä»¤æ¥è·å–æ›´å¤šä¿¡æ¯ã€‚\n# lsof -i COMMAND PID USER FD TYPE DEVICE SIZE NODE NAME dhcpcd 6061 root 4u IPv4 4510 UDP *:bootpc sshd 7703 root 3u IPv6 6499 TCP *:ssh (LISTEN) sshd 7892 root 3u IPv6 6757 TCP 10.10.1.5:ssh-\u0026gt;192.168.1.5:49901 (ESTABLISHED) 2.2. ä½¿ç”¨ -i 6 ä»…è·å– IPv6 æµé‡ ## lsof -i 6 2.3. ä»…æ˜¾ç¤º TCP è¿æ¥ï¼ˆåŒç†å¯è·å¾— UDP è¿æ¥ï¼‰ #å¯ä»¥é€šè¿‡åœ¨ -i åæä¾›å¯¹åº”çš„åè®®æ¥ä»…ä»…æ˜¾ç¤º TCP æˆ–è€… UDP è¿æ¥ä¿¡æ¯ã€‚\n# lsof -iTCP COMMAND PID USER FD TYPE DEVICE SIZE NODE NAME sshd 7703 root 3u IPv6 6499 TCP *:ssh (LISTEN) sshd 7892 root 3u IPv6 6757 TCP 10.10.1.5:ssh-\u0026gt;192.168.1.5:49901 (ESTABLISHED) 2.4. ä½¿ç”¨ -i:port æ¥æ˜¾ç¤ºä¸æŒ‡å®šç«¯å£ç›¸å…³çš„ç½‘ç»œä¿¡æ¯ #ä½ ä¹Ÿå¯ä»¥é€šè¿‡ç«¯å£æœç´¢ï¼Œè¿™å¯¹äºè¦æ‰¾å‡ºä»€ä¹ˆé˜»æ­¢äº†å¦å¤–ä¸€ä¸ªåº”ç”¨ç»‘å®šåˆ°æŒ‡å®šç«¯å£å®åœ¨æ˜¯å¤ªæ£’äº†ã€‚\n# lsof -i :22 COMMAND PID USER FD TYPE DEVICE SIZE NODE NAME sshd 7703 root 3u IPv6 6499 TCP *:ssh (LISTEN) sshd 7892 root 3u IPv6 6757 TCP 10.10.1.5:ssh-\u0026gt;192.168.1.5:49901 (ESTABLISHED) 2.5. ä½¿ç”¨ @host æ¥æ˜¾ç¤ºæŒ‡å®šåˆ°æŒ‡å®šä¸»æœºçš„è¿æ¥ #è¿™å¯¹äºä½ åœ¨æ£€æŸ¥æ˜¯å¦å¼€æ”¾è¿æ¥åˆ°ç½‘ç»œä¸­æˆ–äº’è”ç½‘ä¸ŠæŸä¸ªæŒ‡å®šä¸»æœºçš„è¿æ¥æ—¶ååˆ†æœ‰ç”¨ã€‚\n# lsof -i@172.16.12.5 sshd 7892 root 3u IPv6 6757 TCP 10.10.1.5:ssh-\u0026gt;172.16.12.5:49901 (ESTABLISHED) 2.6. ä½¿ç”¨ @host:port æ˜¾ç¤ºåŸºäºä¸»æœºä¸ç«¯å£çš„è¿æ¥ #ä½ ä¹Ÿå¯ä»¥ç»„åˆä¸»æœºä¸ç«¯å£çš„æ˜¾ç¤ºä¿¡æ¯ã€‚\n# lsof -i@172.16.12.5:22 sshd 7892 root 3u IPv6 6757 TCP 10.10.1.5:ssh-\u0026gt;172.16.12.5:49901 (ESTABLISHED) 2.7. æ‰¾å‡ºç›‘å¬ç«¯å£ #æ‰¾å‡ºæ­£ç­‰å€™è¿æ¥çš„ç«¯å£ã€‚\n# lsof -i -sTCP:LISTEN ä¹Ÿå¯ä»¥ç”¨ grep ç­›é€‰å‡ºä¿¡ã€‚\n# lsof -i | grep -i LISTEN iTunes 400 daniel 16u IPv4 0x4575228 0t0 TCP *:daap (LISTEN) 2.8. æ‰¾å‡ºå·²å»ºç«‹çš„è¿æ¥ #ä½ ä¹Ÿå¯ä»¥æ˜¾ç¤ºä»»ä½•å·²ç»è¿æ¥çš„è¿æ¥ã€‚\n# lsof -i -sTCP:ESTABLISHED ä¹Ÿå¯ä»¥é€šè¿‡ grep ç­›é€‰ã€‚\n# lsof -i | grep -i ESTABLISHED firefox-b 169 daniel 49u IPv4 0t0 TCP 1.2.3.3:1863-\u0026gt;1.2.3.4:http (ESTABLISHED) 3. ç”¨æˆ·ä¿¡æ¯ #ä½ ä¹Ÿå¯ä»¥è·å–å„ç§ç”¨æˆ·çš„ä¿¡æ¯ï¼Œä»¥åŠå®ƒä»¬åœ¨ç³»ç»Ÿä¸Šæ­£å¹²ç€çš„äº‹ï¼ŒåŒ…æ‹¬å®ƒä»¬çš„ç½‘ç»œæ´»åŠ¨ã€å¯¹æ–‡ä»¶çš„æ“ä½œç­‰ã€‚\n3.1. ä½¿ç”¨ -u æ˜¾ç¤ºæŒ‡å®šç”¨æˆ·æ‰“å¼€äº†ä»€ä¹ˆ ## lsof -u daniel -- snipped -- Dock 155 daniel txt REG 14,2 2798436 823208 /usr/lib/libicucore.A.dylib Dock 155 daniel txt REG 14,2 1580212 823126 /usr/lib/libobjc.A.dylib Dock 155 daniel txt REG 14,2 2934184 823498 /usr/lib/libstdc++.6.0.4.dylib Dock 155 daniel txt REG 14,2 132008 823505 /usr/lib/libgcc_s.1.dylib Dock 155 daniel txt REG 14,2 212160 823214 /usr/lib/libauto.dylib -- snipped -- 3.2. ä½¿ç”¨ -u user æ¥æ˜¾ç¤ºé™¤æŒ‡å®šç”¨æˆ·ä»¥å¤–çš„å…¶å®ƒæ‰€æœ‰ç”¨æˆ·æ‰€åšçš„äº‹æƒ… ## lsof -u ^daniel -- snipped -- Dock 155 jim txt REG 14,2 2798436 823208 /usr/lib/libicucore.A.dylib Dock 155 jim txt REG 14,2 1580212 823126 /usr/lib/libobjc.A.dylib Dock 155 jim txt REG 14,2 2934184 823498 /usr/lib/libstdc++.6.0.4.dylib Dock 155 jim txt REG 14,2 132008 823505 /usr/lib/libgcc_s.1.dylib Dock 155 jim txt REG 14,2 212160 823214 /usr/lib/libauto.dylib -- snipped -- 3.3. æ€æ­»æŒ‡å®šç”¨æˆ·æ‰€åšçš„ä¸€åˆ‡äº‹æƒ… #å¯ä»¥æ¶ˆç­æŒ‡å®šç”¨æˆ·è¿è¡Œçš„æ‰€æœ‰ä¸œè¥¿ï¼Œè¿™çœŸä¸é”™ã€‚\n# kill -9 `lsof -t -u daniel` 4. å‘½ä»¤å’Œè¿›ç¨‹ #å¯ä»¥æŸ¥çœ‹æŒ‡å®šç¨‹åºæˆ–è¿›ç¨‹ç”±ä»€ä¹ˆå¯åŠ¨ï¼Œè¿™é€šå¸¸ä¼šå¾ˆæœ‰ç”¨ï¼Œè€Œä½ å¯ä»¥ä½¿ç”¨lsofé€šè¿‡åç§°æˆ–è¿›ç¨‹IDè¿‡æ»¤æ¥å®Œæˆè¿™ä¸ªä»»åŠ¡ã€‚ä¸‹é¢åˆ—å‡ºäº†ä¸€äº›é€‰é¡¹ï¼š\n4.1. ä½¿ç”¨ -c æŸ¥çœ‹æŒ‡å®šçš„å‘½ä»¤æ­£åœ¨ä½¿ç”¨çš„æ–‡ä»¶å’Œç½‘ç»œè¿æ¥ ## lsof -c syslog-ng COMMAND PID USER FD TYPE DEVICE SIZE NODE NAME syslog-ng 7547 root cwd DIR 3,3 4096 2 / syslog-ng 7547 root rtd DIR 3,3 4096 2 / syslog-ng 7547 root txt REG 3,3 113524 1064970 /usr/sbin/syslog-ng -- snipped -- 4.2. ä½¿ç”¨ -p æŸ¥çœ‹æŒ‡å®šè¿›ç¨‹IDå·²æ‰“å¼€çš„å†…å®¹ ## lsof -p 10075 -- snipped -- sshd 10068 root mem REG 3,3 34808 850407 /lib/libnss_files-2.4.so sshd 10068 root mem REG 3,3 34924 850409 /lib/libnss_nis-2.4.so sshd 10068 root mem REG 3,3 26596 850405 /lib/libnss_compat-2.4.so sshd 10068 root mem REG 3,3 200152 509940 /usr/lib/libssl.so.0.9.7 sshd 10068 root mem REG 3,3 46216 510014 /usr/lib/liblber-2.3 sshd 10068 root mem REG 3,3 59868 850413 /lib/libresolv-2.4.so sshd 10068 root mem REG 3,3 1197180 850396 /lib/libc-2.4.so sshd 10068 root mem REG 3,3 22168 850398 /lib/libcrypt-2.4.so sshd 10068 root mem REG 3,3 72784 850404 /lib/libnsl-2.4.so sshd 10068 root mem REG 3,3 70632 850417 /lib/libz.so.1.2.3 sshd 10068 root mem REG 3,3 9992 850416 /lib/libutil-2.4.so -- snipped -- 4.3. ä½¿ -t é€‰é¡¹åªè¿”å› PID ## lsof -t -c Mail 350 5. æ–‡ä»¶å’Œç›®å½• #é€šè¿‡æŸ¥çœ‹æŒ‡å®šæ–‡ä»¶æˆ–ç›®å½•ï¼Œä½ å¯ä»¥çœ‹åˆ°ç³»ç»Ÿä¸Šæ‰€æœ‰æ­£ä¸å…¶äº¤äº’çš„èµ„æºâ€”â€”åŒ…æ‹¬ç”¨æˆ·ã€è¿›ç¨‹ç­‰ã€‚\næ˜¾ç¤ºä¸æŒ‡å®šç›®å½•äº¤äº’çš„æ‰€æœ‰ä¸€åˆ‡\n# lsof /var/log/messages/ COMMAND PID USER FD TYPE DEVICE SIZE NODE NAME syslog-ng 7547 root 4w REG 3,3 217309 834024 /var/log/messages æ˜¾ç¤ºä¸æŒ‡å®šæ–‡ä»¶äº¤äº’çš„æ‰€æœ‰ä¸€åˆ‡\n# lsof /home/daniel/firewall_whitelist.txt 6. é«˜çº§ç”¨æ³• #ä¸ tcpdump ç±»ä¼¼ï¼Œå½“ä½ å¼€å§‹ç»„åˆæŸ¥è¯¢æ—¶ï¼Œå®ƒå°±æ˜¾ç¤ºäº†å®ƒå¼ºå¤§çš„åŠŸèƒ½ã€‚\n6.1. æ˜¾ç¤º daniel è¿æ¥åˆ° 1.1.1.1 æ‰€åšçš„ä¸€åˆ‡ ## lsof -u daniel -i @1.1.1.1 bkdr 1893 daniel 3u IPv6 3456 TCP 10.10.1.10:1234-\u0026gt;1.1.1.1:31337 (ESTABLISHED) 6.2. åŒæ—¶ä½¿ç”¨ -t å’Œ -c é€‰é¡¹ä»¥ç»™è¿›ç¨‹å‘é€ HUP ä¿¡å· ## kill -HUP `lsof -t -c sshd` 6.3. æ˜¾ç¤ºæŸä¸ªç«¯å£èŒƒå›´å†…æ‰“å¼€çš„è¿æ¥ ## lsof -i @fw.google.com:2150=2180 7. ç»“å°¾ #æœ¬å…¥é—¨æ•™ç¨‹åªæ˜¯ç®¡çª¥äº† lsof åŠŸèƒ½çš„ä¸€æ–‘ï¼Œè¦æŸ¥çœ‹å®Œæ•´å‚è€ƒï¼Œè¿è¡Œ man lsof å‘½ä»¤æˆ–æŸ¥çœ‹åœ¨çº¿ç‰ˆæœ¬ã€‚å¸Œæœ›æœ¬æ–‡å¯¹ä½ æœ‰æ‰€åŠ©ç›Šï¼Œä¹Ÿéšæ—¶æ¬¢è¿ä½ çš„è¯„è®ºå’ŒæŒ‡æ­£ã€‚\nlsofæ‰‹å†Œé¡µï¼šhttp://www.netadmintools.com/html/lsof.man.html\n","date":"2016 January 8","permalink":"/posts/2016/01/08/","section":"Posts","summary":"ä»¥å‰åªæ˜¯ç”¨ lsof å‘½ä»¤æŸ¥çœ‹æŸä¸ªæ–‡ä»¶è¢«é‚£äº›è¿›ç¨‹æ‰“å¼€äº†ï¼Œç›´åˆ°çœ‹äº†è¿™ç¯‡æ–‡ç« ï¼šAn lsof Primer ï¼Œå±•ç¤ºäº† lsof å¼ºå¤§çš„ä¸€é¢ã€‚ç½‘ä¸Šæœ‰å¾ˆå¤šç¿»è¯‘ï¼Œæ‰¾ä¸åˆ°åŸå§‹ç‰ˆæœ¬äº†ï¼Œæˆ‘ä¿®æ”¹äº†ä¸€äº›åœ°æ–¹ã€‚","title":"lsof å‘½ä»¤å…¥é—¨"},{"content":"1. About #hostapd æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨ Linux ç”¨æˆ·ç©ºé—´çš„ daemon ç¨‹åºï¼Œå®ƒå¯ä»¥å°† IEEE 802.11 æ— çº¿ç½‘å¡åˆ‡æ¢ä¸º AP æ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯å®ç°è½¯ AP åŠŸèƒ½ï¼Œå¹¶æä¾› IEEE 802.1X/WPA/WPA2/EAP/RADIUS çš„è®¤è¯æœåŠ¡ã€‚å®ƒä½¿ç”¨ nl80211 æ¥å£ä¸å†…æ ¸è¿›è¡Œé€šä¿¡ï¼Œæ”¯æŒåŸºäº mac80211 æ¡†æ¶çš„æ— çº¿é©±åŠ¨ã€‚ä¸‹é¢æ˜¯ Linux çš„æ— çº¿ç½‘ç»œæ¶æ„ï¼š\nIEEE 802.11 æ˜¯ç°åœ¨çš„æ— çº¿å±€åŸŸç½‘é€šç”¨çš„æ ‡å‡†ï¼Œæˆ‘ä»¬é€šå¸¸æŠŠå®ƒä¸ Wi-Fi æ··ä¸ºä¸€è°ˆã€‚ mac80211 æ˜¯ Linux å†…æ ¸çš„ 802.11 æ— çº¿è®¾å¤‡é©±åŠ¨æ¡†æ¶ï¼Œintel çš„æ— çº¿ç½‘å¡é©±åŠ¨ iwlwifi å°±æ˜¯åŸºäºè¿™ä¸ªæ¡†æ¶ã€‚ cfg80211 æ˜¯ Linux å†…æ ¸ä¸­é…ç½®å’Œç®¡ç† 802.11 æ— çº¿è®¾å¤‡çš„æ¥å£ï¼Œä¸ FullMAC é©±åŠ¨, mac80211 é©±åŠ¨ä¸€èµ·å·¥ä½œã€‚ nl80211 å’Œ wext æ˜¯ä¸¤ç§é¢å‘ç”¨æˆ·ç©ºé—´çš„æ¥å£æ ‡å‡†ï¼Œç”¨äºåœ¨ç”¨æˆ·ç©ºé—´é…ç½®å’Œç®¡ç† 802.11 æ— çº¿è®¾å¤‡ï¼Œå†…æ ¸çš„ cfg80211 ä¸€èµ·å·¥ä½œï¼Œç›®å‰ä¸¤ç§æ ‡å‡†åŒæ—¶å­˜åœ¨äºå†…æ ¸ä¸­ï¼Œnl80211 æ­£åœ¨é€æ­¥æ›¿ä»£ wext ï¼Œhostapd åªæ”¯æŒ nl80211 ã€‚ iw å°±æ˜¯ä¸€ä¸ªä½¿ç”¨ nl80211 æ¥å£çš„å‘½ä»¤ï¼Œç”¨å®ƒå¯ä»¥æŸ¥çœ‹å’Œé…ç½®æ— çº¿ç½‘å¡ï¼Œæ”¯æŒ nl80211 æ ‡å‡†ï¼Œä¸æ”¯æŒè€çš„ wext æ ‡å‡†ã€‚ç”¨ iw list å¯ä»¥è·å–å½“å‰æ— çº¿ç½‘å¡çš„å…¨éƒ¨ç‰¹æ€§ï¼Œåœ¨ Supported interface modes å’Œ software interface modes ä¸­çœ‹åˆ°æ— çº¿ç½‘å¡æ˜¯å¦æ”¯æŒ AP æ¨¡å¼ï¼Œå·²ç» AP ç±»å‹ï¼š\nroot@WR-IntelligentDevice:~# iw list Wiphy phy0 ...... Supported interface modes: * IBSS * managed * AP * AP/VLAN * monitor * P2P-client * P2P-GO software interface modes (can always be added): * AP/VLAN * monitor ...... ç”¨ ethtool å·¥å…·å¯ä»¥ç¡®å®šç½‘å¡ä½¿ç”¨çš„é©±åŠ¨ï¼š\nroot@WR-IntelligentDevice:~# ethtool -i wlan0 driver: iwlwifi version: 3.4.91-WR5.0.1.24_standard_IDP- firmware-version: 18.168.6.1 bus-info: 0000:01:00.0 supports-statistics: yes supports-test: no supports-eeprom-access: no supports-register-dump: no supports-priv-flags: no æŸ¥çœ‹è¿æ¥åœ¨ AP ä¸Šçš„ç»ˆç«¯ï¼š\nroot@WR-IntelligentDevice:~# iw dev wlan0 station dump Station bc:6c:21:6e:04:c3 (on wlan0) inactive time: 20 ms rx bytes: 159304 rx packets: 2076 tx bytes: 4368817 tx packets: 3068 tx retries: 293 tx failed: 2 signal: -41 dBm signal avg: -40 dBm tx bitrate: 54.0 MBit/s authorized: yes authenticated: yes preamble: short WMM/WME: no MFP: no TDLS peer: no 2. é…ç½® #hostapd çš„é…ç½®æ–‡ä»¶æ˜¯ /etc/hostapd.conf ï¼Œè¿™ä¸ªæ–‡ä»¶é‡Œæœ‰è¯¦ç»†çš„é…ç½®è¯´æ˜ï¼Œä¸‹é¢æ˜¯ä¸€äº›å¸¸ç”¨é€‰é¡¹ã€‚\n2.1. æ— çº¿æ¥å£ # interfaceï¼šæ— çº¿ç½‘å¡çš„è®¾å¤‡èŠ‚ç‚¹åç§°ï¼Œå°±æ˜¯ iwconfig çœ‹åˆ°çš„åç§°ï¼Œä¾‹å¦‚ wlan0 ã€‚ bridgeï¼šæŒ‡å®šæ‰€å¤„ç½‘æ¡¥ï¼Œå¯¹äºä¸€ä¸ªåŒæ—¶æ¥å…¥å…¬ç½‘ã€æä¾›å†…éƒ¨ç½‘å’Œæ— çº¿æ¥å…¥çš„è·¯ç”±å™¨æ¥è¯´ï¼Œè®¾å®šç½‘æ¡¥å¾ˆæœ‰å¿…è¦ ã€‚ driverï¼šè®¾å®šæ— çº¿é©±åŠ¨ï¼Œæˆ‘è¿™é‡Œæ˜¯ nl80211 ã€‚ 2.2. æ— çº¿ç¯å¢ƒ # ssidï¼šè¿™ä¸ªæ— çº¿æ¥å…¥ç‚¹å¯¹å¤–æ˜¾ç¤ºçš„åç§° ã€‚ hw_modeï¼šæŒ‡å®š802.11åè®®ï¼Œa = IEEE 802.11a, b = IEEE 802.11b, g = IEEE 802.11g ã€‚è¿™ä¸ªé€‰é¡¹æ˜¯æ ¹æ®ç¡¬ä»¶ç‰¹æ€§è®¾ç½®çš„ï¼Œg æ˜¯æœ€å¸¸ç”¨çš„è®¾ç½®ï¼Œå®ƒå‘ä¸‹å…¼å®¹ b ã€‚ channelï¼šè®¾å®šä¿¡é“ï¼Œå¿…é¡»æ˜¯ hw_mode æŒ‡å®šåè®®èƒ½å¤Ÿæ”¯æŒçš„ä¿¡é“ã€‚ä¿¡é“çš„é€‰æ‹©åº”è¯¥é¿å…ä¸åŒåŒºåŸŸå†…çš„å…¶ä»– AP çš„ä¿¡é“äº§ç”Ÿé‡å ï¼Œè¿™ä¸ 802.11 æ ‡å‡†çš„ä¿¡é“åˆ’åˆ†æœ‰å…³ï¼Œåœ¨ 802.11b/g ä¸­ï¼Œ83.5MHz çš„å¸¦å®½åˆ’åˆ†äº† 14 ä¸ªä¿¡é“ï¼Œç›¸é‚»çš„å¤šä¸ªä¿¡é“å­˜åœ¨é¢‘ç‡é‡å ï¼Œæ•´ä¸ªé¢‘æ®µå†…åªæœ‰ 1ã€6ã€11 ï¼Œä¸‰ä¸ªä¿¡é“äº’ä¸å¹²æ‰°ã€‚ 2.3. è®¤è¯ä¸åŠ å¯† # ignore_broadcast_ssid: ä½¿èƒ½/ç¦æ­¢å¹¿æ’­ SSID ã€‚\nmacaddr_aclï¼šå¯é€‰ï¼ŒæŒ‡å®š MAC åœ°å€è¿‡æ»¤è§„åˆ™ï¼Œ0 è¡¨ç¤ºé™¤ç¦æ­¢åˆ—è¡¨å¤–éƒ½å…è®¸ï¼Œ1 è¡¨ç¤ºé™¤å…è®¸åˆ—è¡¨å¤–éƒ½ç¦æ­¢ï¼Œ2 è¡¨ç¤ºä½¿ç”¨å¤–éƒ¨ RADIUS æœåŠ¡å™¨ã€‚\naccept_mac_fileï¼šæŒ‡å®š MAC å…è®¸åˆ—è¡¨æ–‡ä»¶è·¯å¾„ã€‚\ndeny_mac_fileï¼šæŒ‡å®š MAC ç¦æ­¢åˆ—è¡¨æ–‡ä»¶è·¯å¾„ã€‚\nauth_algs: æŒ‡å®šè®¤è¯ç®—æ³•ï¼Œä½ä¸¤ä½æœ‰æ•ˆï¼Œ0 è¡¨ç¤ºç¦æ­¢ï¼Œ1 è¡¨ç¤ºä½¿èƒ½ã€‚bit0 è¡¨ç¤ºå¼€æ”¾ç³»ç»Ÿè®¤è¯ï¼ˆOSAï¼‰ï¼Œbit1 è¡¨ç¤ºå…±äº«å¯†é’¥è®¤è¯ï¼ˆSKAï¼‰ï¼Œå¦‚æœè®¾ä¸º 3 ï¼Œè¡¨ç¤ºä¸¤ç§è®¤è¯æ–¹å¼éƒ½æ”¯æŒã€‚\nwpa: æŒ‡å®šåŠ å¯†ç®—æ³•ï¼Œä½ä¸¤ä½æœ‰æ•ˆï¼Œ0 è¡¨ç¤ºç¦æ­¢ï¼Œ1 è¡¨ç¤ºä½¿èƒ½ã€‚bit0 è¡¨ç¤º wpaï¼Œbit1 è¡¨ç¤º wpa2 ï¼Œå¦‚æœè®¾ä¸º 3 ï¼Œè¡¨ç¤º WPA/WPA2 åŠ å¯†æ–¹å¼ã€‚\nwpa_passphrase: å…±äº«ç§˜é’¥ï¼Œå°±æ˜¯æˆ‘ä»¬è¿æ¥ Wi-Fi æ—¶è¾“å…¥çš„å¯†ç ã€‚\nwpa_pskï¼šå¯¹å…±äº«ç§˜é’¥åŠ å¯†åçš„ 64 ä½åå…­è¿›åˆ¶æ•°ã€‚å¯ä»¥é€šè¿‡ wpa_passphrase å‘½ä»¤è·å¾—ï¼š\nroot@WR-IntelligentDevice:~# wpa_passphrase usage: wpa_passphrase \u0026lt;ssid\u0026gt; [passphrase] If passphrase is left out, it will be read from stdin root@WR-IntelligentDevice:~# wpa_passphrase TP-Link password network={ ssid=\u0026quot;TP-Link\u0026quot; #psk=\u0026quot;password\u0026quot; psk=895b209c4c7ff1ea45d079eb5b04155cc1793669c6dc08470157c23fa6532694 } wpa_key_mgmt: æŒ‡å®šç§˜é’¥ç®¡ç†ç®—æ³•ï¼Œå¯é€‰ WPA-PSK å’Œ WPA-EAP ã€‚\nwpa_pairwise: WPA çš„åŠ å¯†é€‰é¡¹ï¼Œå¯é€‰ TKIP å’Œ CCMP ã€‚\nrsn_pairwise: WPA2 å’Œ RSN çš„åŠ å¯†é€‰é¡¹ï¼Œå¯é€‰ TKIP å’Œ CCMP ã€‚\nå…³äºè®¤è¯ç®—æ³•ï¼š\nå¼€æ”¾ç³»ç»Ÿè®¤è¯ï¼ˆOpen system authenticationï¼‰\nå¼€æ”¾ç³»ç»Ÿè®¤è¯æ˜¯ç¼ºçœä½¿ç”¨çš„è®¤è¯æœºåˆ¶ï¼Œä¹Ÿæ˜¯æœ€ç®€å•çš„è®¤è¯ç®—æ³•ï¼Œå³ä¸è®¤è¯ã€‚å¦‚æœè®¤è¯ç±»å‹è®¾ç½®ä¸ºå¼€æ”¾ç³»ç»Ÿè®¤è¯ï¼Œåˆ™æ‰€æœ‰è¯·æ±‚è®¤è¯çš„å®¢æˆ·ç«¯éƒ½ä¼šé€šè¿‡è®¤è¯ã€‚å¼€æ”¾ç³»ç»Ÿè®¤è¯åŒ…æ‹¬ä¸¤ä¸ªæ­¥éª¤ï¼šç¬¬ä¸€æ­¥æ˜¯æ— çº¿å®¢æˆ·ç«¯å‘èµ·è®¤è¯è¯·æ±‚ï¼Œç¬¬äºŒæ­¥APç¡®å®šæ— çº¿å®¢æˆ·ç«¯æ˜¯å¦é€šè¿‡æ— çº¿é“¾è·¯è®¤è¯å¹¶å›åº”è®¤è¯ç»“æœã€‚å¦‚æœè®¤è¯ç»“æœä¸ºâ€œæˆåŠŸâ€ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯æˆåŠŸé€šè¿‡äº†APçš„é“¾è·¯è®¤è¯ã€‚\nå…±äº«å¯†é’¥è®¤è¯ï¼ˆshared key authenticationï¼‰\nå…±äº«å¯†é’¥è®¤è¯æ˜¯é™¤å¼€æ”¾ç³»ç»Ÿè®¤è¯ä»¥å¤–çš„å¦å¤–ä¸€ç§é“¾è·¯è®¤è¯æœºåˆ¶ã€‚å…±äº«å¯†é’¥è®¤è¯éœ€è¦å®¢æˆ·ç«¯å’Œè®¾å¤‡ç«¯é…ç½®ç›¸åŒçš„å…±äº«å¯†é’¥ã€‚å…±äº«å¯†é’¥è®¤è¯çš„è®¤è¯è¿‡ç¨‹ä¸ºï¼šå®¢æˆ·ç«¯å…ˆå‘APå‘é€è®¤è¯è¯·æ±‚ï¼ŒAPç«¯ä¼šéšæœºäº§ç”Ÿä¸€ä¸ªChallengeï¼ˆå³ä¸€ä¸ªå­—ç¬¦ä¸²ï¼‰å‘é€ç»™å®¢æˆ·ç«¯ï¼›å®¢æˆ·ç«¯ä¼šå°†æ¥æ”¶åˆ°ChallengeåŠ å¯†åå†å‘é€ç»™APï¼›APæ¥æ”¶åˆ°è¯¥æ¶ˆæ¯åï¼Œå¯¹è¯¥æ¶ˆæ¯è§£å¯†ï¼Œç„¶åå¯¹è§£å¯†åçš„å­—ç¬¦ä¸²å’ŒåŸå§‹å­—ç¬¦ä¸²è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœç›¸åŒï¼Œåˆ™è¯´æ˜å®¢æˆ·ç«¯é€šè¿‡äº†Shared Keyé“¾è·¯è®¤è¯ï¼›å¦åˆ™Shared Keyé“¾è·¯è®¤è¯å¤±è´¥ã€‚\n3. è¿è¡Œ #root@WR-IntelligentDevice:/etc# hostapd -h hostapd v2.3 User space daemon for IEEE 802.11 AP management, IEEE 802.1X/WPA/WPA2/EAP/RADIUS Authenticator Copyright (c) 2002-2014, Jouni Malinen \u0026lt;j@w1.fi\u0026gt; and contributors usage: hostapd [-hdBKtv] [-P \u0026lt;PID file\u0026gt;] [-e \u0026lt;entropy file\u0026gt;] \\ [-g \u0026lt;global ctrl_iface\u0026gt;] [-G \u0026lt;group\u0026gt;] \\ \u0026lt;configuration file(s)\u0026gt; options: -h show this usage -d show more debug messages (-dd for even more) -B run daemon in the background -e entropy file -g global control interface path -G group for control interfaces -P PID file -K include key data in debug messages -t include timestamps in some debug messages -v show hostapd version åˆ†äº«ä¸€ä¸ªåœ¨ Ubuntu 12.04 ä¸‹è®¾ç½®æ— çº¿ AP çš„è„šæœ¬ install_wifi_access_point.sh ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\n#!/bin/bash ### Setup a wifi Access Point on Ubuntu 12.04 (or its derivatives). ### make sure that this script is executed from root if [ $(whoami) != 'root' ] then echo \u0026quot; This script should be executed as root or with sudo: sudo $0 \u0026quot; exit 1 fi ############################################################## ## Check whether the wireless card supports Access Point mode ############################################################## ### make sure that iw is installed apt-get -y install iw ### check that AP is supported supports_access_point=$(iw list | sed -n -e '/* AP$/p') if [ \u0026quot;$supports_access_point\u0026quot; = '' ] then echo \u0026quot;AP is not supported by the driver of the wireless card.\u0026quot; echo \u0026quot;This script does not work for this driver.\u0026quot; exit 1 fi ############################################################## ## Setup and host a network ############################################################## ### install hostapd apt-get -y install hostapd ### it should not start automatically on boot update-rc.d hostapd disable ### get ssid and password ssid=$(hostname --short) read -p \u0026quot;The name of your hosted network (SSID) [$ssid]: \u0026quot; input ssid=${input:-$ssid} password='1234567890' read -p \u0026quot;The password of your hosted network [$password]: \u0026quot; input password=${input:-$password} ### get wifi interface rfkill unblock wifi # enable wifi in case it is somehow disabled (thanks to Darrin Wolf for this tip) wifi_interface=$(lshw -quiet -c network | sed -n -e '/Wireless interface/,+12 p' | sed -n -e '/logical name:/p' | cut -d: -f2 | sed -e 's/ //g') ### create /etc/hostapd/hostapd.conf cat \u0026lt;\u0026lt;EOF \u0026gt; /etc/hostapd/hostapd.conf interface=$wifi_interface driver=nl80211 ssid=$ssid hw_mode=g channel=1 macaddr_acl=0 auth_algs=1 ignore_broadcast_ssid=0 wpa=3 wpa_passphrase=$password wpa_key_mgmt=WPA-PSK wpa_pairwise=TKIP rsn_pairwise=CCMP EOF ### modify /etc/default/hostapd cp -n /etc/default/hostapd{,.bak} sed -i /etc/default/hostapd \\ -e '/DAEMON_CONF=/c DAEMON_CONF=\u0026quot;/etc/hostapd/hostapd.conf\u0026quot;' ################################################ ## Set up DHCP server for IP address management ################################################ ### make sure that the DHCP server is installed apt-get -y install isc-dhcp-server ### it should not start automatically on boot update-rc.d isc-dhcp-server disable ### set the INTERFACES on /etc/default/isc-dhcp-server cp -n /etc/default/isc-dhcp-server{,.bak} sed -i /etc/default/isc-dhcp-server \\ -e \u0026quot;/INTERFACES=/c INTERFACES=\\\u0026quot;$wifi_interface\\\u0026quot;\u0026quot; ### modify /etc/dhcp/dhcpd.conf cp -n /etc/dhcp/dhcpd.conf{,.bak} sed -i /etc/dhcp/dhcpd.conf \\ -e 's/^option domain-name/#option domain-name/' \\ -e 's/^option domain-name-servers/#option domain-name-servers/' \\ -e 's/^default-lease-time/#default-lease-time/' \\ -e 's/^max-lease-time/#max-lease-time/' sed -i /etc/dhcp/dhcpd.conf \\ -e '/subnet 10.10.0.0 netmask 255.255.255.0/,+4 d' cat \u0026lt;\u0026lt;EOF \u0026gt;\u0026gt; /etc/dhcp/dhcpd.conf subnet 10.10.0.0 netmask 255.255.255.0 { range 10.10.0.2 10.10.0.16; option domain-name-servers 8.8.4.4, 208.67.222.222; option routers 10.10.0.1; } EOF ################################################# ## Create a startup script ################################################# cat \u0026lt;\u0026lt;EOF \u0026gt; /etc/init.d/wifi_access_point #!/bin/bash ext_interface=\\$(ip route | grep default | cut -d' ' -f5) function stop_wifi_ap { ### stop services dhcpd and hostapd service isc-dhcp-server stop service hostapd stop ### disable IP forwarding echo 0 \u0026gt; /proc/sys/net/ipv4/ip_forward iptables -t nat -D POSTROUTING -s 10.10.0.0/16 -o \\$ext_interface -j MASQUERADE 2\u0026gt;/dev/null ### remove the static IP from the wifi interface if grep -q 'auto $wifi_interface' /etc/network/interfaces then sed -i /etc/network/interfaces -e '/auto $wifi_interface/,\\$ d' sed -i /etc/network/interfaces -e '\\$ d' fi ### restart network manager to takeover wifi management service network-manager restart } function start_wifi_ap { stop_wifi_ap sleep 3 ### see: https://bugs.launchpad.net/ubuntu/+source/wpa/+bug/1289047/comments/8 nmcli nm wifi off rfkill unblock wlan ### give a static IP to the wifi interface ip link set dev $wifi_interface up ip address add 10.10.0.1/24 dev $wifi_interface ### protect the static IP from network-manger restart echo \u0026gt;\u0026gt; /etc/network/interfaces echo 'auto $wifi_interface' \u0026gt;\u0026gt; /etc/network/interfaces echo 'iface $wifi_interface' inet static \u0026gt;\u0026gt; /etc/network/interfaces echo 'address 10.10.0.1' \u0026gt;\u0026gt; /etc/network/interfaces echo 'netmask 255.255.255.0' \u0026gt;\u0026gt; /etc/network/interfaces ### enable IP forwarding echo 1 \u0026gt; /proc/sys/net/ipv4/ip_forward iptables -t nat -A POSTROUTING -s 10.10.0.0/16 -o \\$ext_interface -j MASQUERADE ### start services dhcpd and hostapd service hostapd start service isc-dhcp-server start } ### start/stop wifi access point case \u0026quot;\\$1\u0026quot; in start) start_wifi_ap ;; stop) stop_wifi_ap ;; esac EOF chmod +x /etc/init.d/wifi_access_point ### make sure that it is stopped on boot sed -i /etc/rc.local \\ -e '/service wifi_access_point stop/ d' sed -i /etc/rc.local \\ -e '/^exit/ i service wifi_access_point stop' ### display usage message echo \u0026quot; ====================================== Wifi Access Point installed. You can start and stop it with: service wifi_access_point start service wifi_access_point stop \u0026quot; 4. å‚è€ƒ # https://wireless.wiki.kernel.org/en/users/Documentation/hostapd http://blog.csdn.net/myarrow/article/details/7930131 http://www.cnblogs.com/zhuwenger/archive/2011/03/11/1980294.html https://github.com/hotice/AP-Hotspot ","date":"2016 January 1","permalink":"/posts/2016/01/01/","section":"Posts","summary":"1. About #hostapd æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨ Linux ç”¨æˆ·ç©ºé—´çš„ daemon ç¨‹åºï¼Œå®ƒå¯ä»¥å°† IEEE 802.","title":"hostapd HOWTO"},{"content":"1. é…ç½® #git çš„å…¨å±€é…ç½®æ–‡ä»¶æ˜¯ç”¨æˆ·ç›®å½•ä¸‹çš„ .gitconfig æ–‡ä»¶ã€‚è®¾ç½®ç”¨æˆ·ä¿¡æ¯ï¼š\ngit config [--global] user.name \u0026quot;[name]\u0026quot; git config [--global] user.email \u0026quot;[email address]\u0026quot; 2. åˆ›å»ºæ–°ä»“åº“ # åœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»ºæ–°ä»“åº“ git init å…‹éš†è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„ä»“åº“ git clone [url] åˆ›å»ºæ–°ä»“åº“æ—¶ä¼šç”Ÿæˆ .git æ–‡ä»¶å¤¹ï¼ŒåŒ…å«äº†è¯¥ä»“åº“çš„æ‰€æœ‰é…ç½®æ–‡ä»¶ã€‚\n3. å·¥ä½œæµ #æºç ç›®å½•ç§°ä¸ºå·¥ä½œåŒº workspace ,æœ¬åœ°ä»“åº“å«åš Repository ï¼Œè¿œç¨‹ä»“åº“å«åš Remote ï¼Œåœ¨æœ¬åœ°ä»“åº“å’Œå·¥ä½œåŒºä¹‹é—´å­˜åœ¨ä¸€ä¸ªæš‚å­˜åŒº Index ã€‚é€šå¸¸çš„å·¥ä½œæµç¨‹æ˜¯ä¿®æ”¹æºç ã€æ”¾å…¥æš‚å­˜åŒºã€æäº¤åˆ°ä»“åº“ã€æ¨é€åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼š\n4. æ·»åŠ  add # æ·»åŠ å½“å‰ç›®å½•çš„æ‰€æœ‰æ–‡ä»¶åˆ°æš‚å­˜åŒº git add . æ·»åŠ æŒ‡å®šæ–‡ä»¶åˆ°æš‚å­˜åŒº git add [file1] [file2] ... æ·»åŠ æŒ‡å®šç›®å½•åˆ°æš‚å­˜åŒºï¼ŒåŒ…æ‹¬å­ç›®å½• git add [dir] 5. åˆ é™¤ delete # åˆ é™¤å·¥ä½œåŒºæ–‡ä»¶ï¼Œå¹¶ä¸”å°†è¿™æ¬¡åˆ é™¤æ”¾å…¥æš‚å­˜åŒº git rm [file1] [file2] ... åœæ­¢è¿½è¸ªæŒ‡å®šæ–‡ä»¶ï¼Œä½†è¯¥æ–‡ä»¶ä¼šä¿ç•™åœ¨å·¥ä½œåŒº git rm --cached [file] æ”¹åæ–‡ä»¶ï¼Œå¹¶ä¸”å°†è¿™ä¸ªæ”¹åæ”¾å…¥æš‚å­˜åŒº git mv [file-original] [file-renamed] 6. æäº¤ commit # æäº¤æš‚å­˜åŒºåˆ°ä»“åº“åŒº git commit -m [message] æäº¤æš‚å­˜åŒºçš„æŒ‡å®šæ–‡ä»¶åˆ°ä»“åº“åŒº git commit [file1] [file2] ... -m [message] æäº¤å·¥ä½œåŒºè‡ªä¸Šæ¬¡commitä¹‹åçš„å˜åŒ–ï¼Œç›´æ¥åˆ°ä»“åº“åŒº git commit -a æäº¤æ—¶æ˜¾ç¤ºæ‰€æœ‰diffä¿¡æ¯ git commit -v ä½¿ç”¨ä¸€æ¬¡æ–°çš„commitï¼Œæ›¿ä»£ä¸Šä¸€æ¬¡æäº¤ï¼Œå¦‚æœä»£ç æ²¡æœ‰ä»»ä½•æ–°å˜åŒ–ï¼Œåˆ™ç”¨æ¥æ”¹å†™ä¸Šä¸€æ¬¡commitçš„æäº¤ä¿¡æ¯ git commit --amend -m [message] commit ä¹‹åï¼Œå°±ä¼šåœ¨ git è®°å½•ä¸­å½¢æˆä¸€ä¸ªæ–°çš„ç‰ˆæœ¬ã€‚\n7. æŸ¥çœ‹ä¿¡æ¯ # æ˜¾ç¤ºå·¥ä½œåŒºä¸­æœ‰å˜æ›´çš„æ–‡ä»¶ git status æ˜¾ç¤ºå½“å‰åˆ†æ”¯çš„ç‰ˆæœ¬å†å² git log æ˜¾ç¤ºç‰ˆæœ¬å†å²ï¼Œä»¥åŠæ¯æ¬¡ commit å‘ç”Ÿå˜æ›´çš„æ–‡ä»¶ git log --stat æ˜¾ç¤ºæŸæ¬¡æäº¤çš„å…ƒæ•°æ®å’Œå†…å®¹å˜åŒ– git show [commit] æ˜¾ç¤ºæŸæ¬¡æäº¤å‘ç”Ÿå˜åŒ–çš„æ–‡ä»¶ git show --name-only [commit] æ˜¾ç¤ºæŸæ¬¡æäº¤æ—¶ï¼ŒæŸä¸ªæ–‡ä»¶çš„å†…å®¹ git show [commit]:[filename] æ˜¾ç¤ºå·¥ä½œåŒºç›¸å¯¹æš‚å­˜åŒºçš„å·®å¼‚ git diff æ˜¾ç¤ºå·¥ä½œåŒºç›¸å¯¹æš‚å­˜åŒºï¼Œé‚£äº›æ–‡ä»¶æ–‡ä»¶è¢«æ”¹åŠ¨äº† git diff --stat æ˜¾ç¤ºæš‚å­˜åŒºç›¸å¯¹ä¸Šä¸€ä¸ªcommitçš„å·®å¼‚ git diff --cached [file] æ˜¾ç¤ºå·¥ä½œåŒºç›¸å¯¹å½“å‰åˆ†æ”¯æœ€æ–°commitä¹‹é—´çš„å·®å¼‚ git diff HEAD æ˜¾ç¤ºä¸¤ä¸ªåˆ†æ”¯ä¹‹é—´çš„å·®å¼‚ git diff [commit] [commit] æ˜¾ç¤ºä¸¤ä¸ªåˆ†æ”¯ä¹‹é—´çš„å·®å¼‚ git diff [first-branch] [second-branch] 8. å›é€€ # æ¢å¤æš‚å­˜åŒºçš„æŒ‡å®šæ–‡ä»¶åˆ°å·¥ä½œåŒº git checkout [file] æ¢å¤æŸä¸ªcommitçš„æŒ‡å®šæ–‡ä»¶åˆ°å·¥ä½œåŒº git checkout [commit] [file] æ¢å¤ä¸Šä¸€ä¸ªcommitçš„æ‰€æœ‰æ–‡ä»¶åˆ°å·¥ä½œåŒº git checkout . é‡ç½®æš‚å­˜åŒºçš„æŒ‡å®šæ–‡ä»¶åˆ°ä¸Šä¸€æ¬¡commitä¿æŒä¸€è‡´ï¼Œä½†å·¥ä½œåŒºä¸å˜ git reset [file] é‡ç½®å½“æœŸåˆ†æ”¯çš„ HARD ã€æš‚å­˜åŒºã€å·¥ä½œåŒºåˆ°æŒ‡å®šçš„ commit git reset --hard [commit] é‡ç½®å½“å‰åˆ†æ”¯çš„ HARDã€æš‚å­˜åŒºåˆ°æŒ‡å®šçš„ commit ï¼Œä½†å·¥ä½œåŒºä¸å˜ git reset â€“soft [commit] 9. è¿œç¨‹åŒæ­¥ # ä¸Šä¼ æœ¬åœ°æŒ‡å®šåˆ†æ”¯åˆ°è¿œç¨‹ä»“åº“ git push [remote] [branch] ä¸‹è½½è¿œç¨‹ä»“åº“çš„æ‰€æœ‰å˜åŠ¨ git fetch [remote] 10. è¡¥ä¸ #å°† git diff è¾“å‡ºçš„ä¿¡æ¯ä¿å­˜åˆ°æ–‡ä»¶ï¼Œå°±æ˜¯ä¸€ä¸ªæ ‡å‡†è¡¥ä¸ï¼Œè¦ç”Ÿæˆ git ä¸“ç”¨è¡¥ä¸ï¼Œéœ€è¦ git format-patch å‘½ä»¤ï¼š\nå°†æœ€åä¸€ä¸ª commit ç”Ÿæˆè¡¥ä¸ git format-patch -1 å°†æœ€åä¸¤ä¸ª commit åˆ†åˆ«ç”Ÿæˆè¡¥ä¸ git format-patch -2 ç”¨ git apply åº”ç”¨è¡¥ä¸æ–‡ä»¶ï¼Œå®ƒåªä¼šä¿®æ”¹å·¥ä½œåŒºï¼Œè¿˜è¦æ‰‹åŠ¨æäº¤ï¼š\nåº”ç”¨ä¸€ä¸ª git è¡¥ä¸å¹¶æ£€æŸ¥æ˜¯å¦æˆåŠŸ git apply --check [patch file] 11. ç‰ˆæœ¬å· #ç‰ˆæœ¬å·ä»¥å°å†™å­—æ¯ v å¼€å¤´ï¼Œæ ¼å¼æ˜¯ï¼šä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·-ä¿®è®¢ç‰ˆæœ¬å·-SHA ã€‚\nå¤§çš„åŠŸèƒ½å˜æ›´å‡çº§ä¸»ç‰ˆæœ¬å·ï¼Œå°çš„åŠŸèƒ½å˜æ›´å‡çº§æ¬¡ç‰ˆæœ¬å·ï¼Œæ­£å¼å‘å¸ƒå‰çš„ä¸»ç‰ˆæœ¬å·å¯ä»¥æ˜¯ 0 ï¼Œè¿™æ ·ç¬¬ä¸€æ¬¡å‘å¸ƒæ—¶çš„ç‰ˆæœ¬å·å°±æ˜¯ v1.0ã€‚ä¿®è®¢ç‰ˆæœ¬å·ä¸æ¶‰åŠåŠŸèƒ½æ›´æ–°ï¼Œå®ƒæ˜¯æŒ‡ä¸Šæ¬¡æ ‡è®°ä¸»æ¬¡ç‰ˆæœ¬å·ä¹‹åçš„ä¿®å¤ Bug æ¬¡æ•°ã€‚æ¯æ¬¡é‡æ–°æ ‡è®°ä¸»æ¬¡ç‰ˆæœ¬å·ä¹‹åï¼Œä¿®è®¢ç‰ˆæœ¬å·é‡ç½®ã€‚SHA æ˜¯æœ¬æ¬¡ commit çš„ SHA å€¼çš„å‰å‡ ä½\nä¸»ç‰ˆæœ¬å·å’Œæ¬¡ç‰ˆæœ¬å·éœ€è¦ç”¨ git tag æ ‡è®°ï¼Œè€Œä¿®è®¢æ¬¡æ•°å’Œ SHA å¯ä»¥ç”± git è‡ªåŠ¨è®°å½•ã€‚ä¸¾ä¾‹ï¼Œä¸€æ¬¡æœ¬åœ° commit ä¹‹åï¼Œä½¿ç”¨ git tag ä¸ºæœ¬æ¬¡æäº¤æ ‡è®°ç‰ˆæœ¬å·ï¼š\n$ git log commit d3b0c251d0546194659a7a121f6404b9e28b1229 Author: lishaocheng \u0026lt;lishaocheng@*.com.cn\u0026gt; Date: Fri Nov 18 15:42:49 2016 +0800 v1.0 release $ git tag -a v1.0 -m \u0026quot;v1.0 release\u0026quot; æŸ¥çœ‹å½“å‰ç‰ˆæœ¬å·ï¼š\n$ git describe v1.0 $ git describe --long v1.0-0-gd3b0c25 ç¬¬ä¸€æ¬¡å‘å¸ƒï¼Œæ²¡æœ‰ä¿®è®¢ï¼Œæ‰€ä»¥ä¿®è®¢ç‰ˆæœ¬å·ä¸º 0 ã€‚SHA ä¸­çš„ g æ˜¯ git çš„ç¼©å†™ï¼Œåé¢æœ¬æ¬¡ commit çš„ SHA å€¼å‰å‡ ä½ã€‚ æ¨é€æ—¶ä½¿ç”¨ \u0026ndash;tags å¸¦ä¸Šæ‰€æœ‰çš„æœ¬åœ°æ ‡ç­¾ï¼š\n$ git push --tags origin master Counting objects: 9, done. Delta compression using up to 4 threads. Compressing objects: 100% (7/7), done. Writing objects: 100% (9/9), 445.64 KiB | 0 bytes/s, done. Total 9 (delta 0), reused 0 (delta 0) To 192.168.5.253:lishaocheng/ftp_transfer.git 95105d6..d3b0c25 master -\u0026gt; master * [new tag] v1.0 -\u0026gt; v1.0 å¦‚æœå‘ç°äº† Bug ï¼Œéœ€è¦ä¿®æ”¹ï¼Œå°± clone åˆ°æœ¬åœ°ï¼Œä¿®æ”¹å commit ï¼Œç„¶åæŸ¥çœ‹ç‰ˆæœ¬å·ï¼š\n$ git describe v1.0-1-g740c0c4 ä¿®è®¢ç‰ˆæœ¬å·å˜æˆäº† 1 ï¼ŒSHA å˜æˆäº†æœ¬æ¬¡çš„ commit ã€‚ç„¶åæ¨é€ï¼š\n$ git push --tags origin master 12. ä½¿ç”¨SSH Key #åœ¨å®¢æˆ·ç«¯æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ç”Ÿæˆä¸€ä¸ªå¯†é’¥å¯¹ï¼š\nssh-keygen -t ed25519 -C \u0026#34;lishaocheng_20220201\u0026#34; -t é€‰é¡¹æŒ‡å®šäº†åŠ å¯†ç±»å‹ï¼Œæˆ‘ä»¬é€‰æ‹© ed25519 ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©å…¶ä»–ç±»å‹ã€‚\n-C é€‰é¡¹æ˜¯è®¾ç½®å¯†é’¥å¯¹çš„æ³¨é‡Šï¼Œæˆ‘ä¹ æƒ¯è®¾ç½®ç”¨æˆ·åå’Œæ—¥æœŸã€‚\nè®¾ç½®ä¸€ä¸ªä¾¿äºè®°å¿†çš„æ–‡ä»¶åï¼Œå¯†ç å¯ä»¥è·³è¿‡ï¼Œç”Ÿæˆçš„å¯†é’¥å¯¹æ–‡ä»¶ä½äºå½“å‰ç›®å½•ä¸‹ï¼Œåç¼€ä¸º .pub çš„æ–‡ä»¶æ˜¯å…¬é’¥ï¼Œå¦ä¸€ä¸ªæ˜¯ç§é’¥ï¼ŒæŠŠä¸¤ä¸ªæ–‡ä»¶å¤åˆ¶åˆ° ~/.ssh/ ç›®å½•ä¸‹ï¼ŒæŠŠå…¬é’¥æ–‡ä»¶çš„å†…å®¹æ·»åŠ åˆ° git æœåŠ¡å™¨ã€‚\næ²¡æ¬¡ä½¿ç”¨ git å‰ï¼Œéœ€è¦æ·»åŠ key ã€‚\n$ eval \u0026#34;$(ssh-agent -s)\u0026#34; $ ssh-add.exe ~/.ssh/lishaocheng_20220201 æ‰‹åŠ¨æ·»åŠ  key æ¯”è¾ƒéº»çƒ¦ï¼Œå¯ä»¥å°†è¿™ä¸ªè¿‡ç¨‹å†™å…¥ ssh çš„é…ç½®æ–‡ä»¶ã€‚æ–°å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼š\ntouch ~/.ssh/config æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š\nHost 192.168.0.202 Hostname 192.168.0.202 Port 3022 User lishaocheng PreferredAuthentications publickey IdentityFile ~/.ssh/lishaocheng_20220201 Host æ˜¯æœåŠ¡å™¨çš„åç§°ï¼Œå¯ç”¨ä»»æ„å­—ç¬¦ä¸²ï¼Œè¿™é‡Œè®¾ç½®ä¸ºæœåŠ¡å™¨ IP\nHostname å¿…é¡»è®¾ç½®ä¸ºæœåŠ¡å™¨ IP æˆ–è€…åŸŸå Port æ˜¯æœåŠ¡å™¨ SSH çš„ç«¯å£\nUser æ˜¯ç”¨æˆ·å\nPreferredAuthentications è®¾ä¸ºå…¬é’¥éªŒè¯\nIdentityFile è®¾ç½®ç§é’¥æ–‡ä»¶çš„è·¯å¾„\nä¹‹åä½¿ç”¨ git çš„æ—¶å€™ï¼Œå°±ä¸ç”¨æ‰‹åŠ¨æ·»åŠ  key äº†ã€‚\n13. å‚è€ƒ # Git ç®€æ˜æŒ‡å— å¸¸ç”¨ Git å‘½ä»¤æ¸…å• å›¾è§£ Git ","date":"2015 December 29","permalink":"/posts/2015/12/29/","section":"Posts","summary":"1. é…ç½® #git çš„å…¨å±€é…ç½®æ–‡ä»¶æ˜¯ç”¨æˆ·ç›®å½•ä¸‹çš„ .","title":"Git ç¬”è®°"},{"content":"Swift # The Swift Programming Language ä¸­æ–‡ç‰ˆ å¦‚æœæ²¡æœ‰è‹¹æœç”µè„‘ï¼Œå¯ç”¨ swift åœ¨çº¿ç¼–è¯‘å™¨ ä½¿ç”¨ Playground å¿«é€Ÿç»ƒä¹  Swift è¯­æ³• ","date":"2015 November 30","permalink":"/posts/2015/11/30/","section":"Posts","summary":"Swift # The Swift Programming Language ä¸­æ–‡ç‰ˆ å¦‚æœæ²¡æœ‰è‹¹æœç”µè„‘ï¼Œå¯ç”¨ swift åœ¨çº¿ç¼–è¯‘å™¨ ä½¿ç”¨ Playground å¿«é€Ÿç»ƒä¹  Swift è¯­æ³• ","title":"å­¦ä¹  Swift\u0026iOS"},{"content":"1. What is IPv6 #IPv6 æ˜¯ä¸ºäº†è§£å†³ IPv4 åœ°å€èµ„æºæ—¥æ¸æ¯ç«­çš„é—®é¢˜ï¼Œä½¿ç”¨çš„æ˜¯ 128bit åœ°å€ï¼Œå¯ä»¥æä¾›æ›´å¤šçš„åœ°å€ç©ºé—´ã€‚IPv6 åœ°å€ä»¥ 16bit ä¸ºä¸€ç»„ï¼Œæ¯ç»„ç”¨å†’å·éš”å¼€ï¼Œå¯ä»¥åˆ†ä¸ºå…«ç»„ï¼Œæ¯ç»„ä»¥ 4 ä¸ªåå…­è¿›åˆ¶æ•°è¡¨ç¤ºï¼Œå…± 32 ä¸ªåå…­è¿›åˆ¶æ•°ï¼Œä¾‹å¦‚ 2001:0db8:85a3:08d3:1319:8a2e:0370:7344 æ˜¯ä¸€ä¸ªåˆæ³•çš„ IPv6 åœ°å€ï¼Œå®ƒåˆå¯ä»¥åˆ†ä¸ºä¸¤ä¸ªé€»è¾‘éƒ¨åˆ†ï¼šä¸€ä¸ª 64 ä½çš„ç½‘ç»œå‰ç¼€å’Œä¸€ä¸ª 64 ä½çš„ä¸»æœºåœ°å€ã€‚\nIPv6 ä¸­çš„ loopback interface å®šä¹‰ä¸º 0000:0000:0000:0000:0000:0000:0000:0001 ï¼Œä¹Ÿå¯ä»¥è¡¨ç¤ºä¸º ::1 ï¼Œå› ä¸ºæ¯ç»„ä¸­çš„å‰å¯¼ 0 å¯ä»¥çœç•¥ï¼Œä¸€å¯¹è¿ç»­çš„å†’å·è¡¨ç¤ºå¤šç»„ 0 ï¼Œä¸€ä¸ª IPv6 åœ°å€ä¸­å…è®¸å‡ºç°ä¸€å¯¹è¿å†’å·ã€‚\nIPv4 ä½å€å¯ä»¥å¾ˆå®¹æ˜“çš„è½¬åŒ–ä¸º IPv6 æ ¼å¼ã€‚å¦‚æœ IPv4 çš„ä¸€ä¸ªåœ°å€ä¸º135.75.43.52ï¼ˆåå…­è¿›åˆ¶ä¸º 0x874B2B34 ï¼‰ï¼Œå®ƒå¯ä»¥è¢«è½¬åŒ–ä¸º0000:0000:0000:0000:0000:ffff:874B:2B34 æˆ–è€… ::ffff:874B:2B34 ã€‚åŒæ—¶ï¼Œè¿˜å¯ä»¥ä½¿ç”¨æ··åˆç¬¦å·ï¼ˆIPv4-compatible addressï¼‰ï¼Œåˆ™åœ°å€å¯ä»¥ä¸º ::ffff:135.75.43.52 ã€‚\n2. Linux support #é¦–å…ˆéœ€è¦å†…æ ¸æ”¯æŒï¼Œ2.6 ä¹‹åçš„å†…æ ¸éƒ½æ”¯æŒ IPv6 ï¼Œåœ¨ 3.x ç‰ˆæœ¬ä¸­ï¼Œé€šå¸¸é»˜è®¤å·²ç»ç¼–è¯‘å…¥å†…æ ¸ï¼š\nå¦‚æœ IPv6 ç¼–è¯‘æˆäº†æ¨¡å—ï¼Œå¯ä»¥ç”¨ modprobe ipv6 å‘½ä»¤åŠ è½½ã€‚å†…æ ¸æ”¯æŒåå°±å¯ä»¥åœ¨ /proc æ–‡ä»¶ç³»ç»Ÿä¸­çœ‹åˆ° if_net6 æ–‡ä»¶ï¼š\nè¦å°†ç½‘å£é…ç½®æˆ IPv6 ï¼Œä¹Ÿéœ€è¦é…ç½®å‘½ä»¤æ”¯æŒ IPv6 ï¼Œå¯ä»¥ç”¨å¦‚ä¸‹å‘½ä»¤æ£€æŸ¥ ifconfig æ˜¯å¦æ”¯æŒ IPv6 :\n~# ifconfig -? 2\u0026gt;\u0026amp; 1 | grep -qw 'inet6' \u0026amp;\u0026amp; echo \u0026quot;utility 'ifconfig' is IPv6-ready\u0026quot; æ£€æŸ¥ route æ˜¯å¦æ”¯æŒ IPv6 :\n~# route -? 2\u0026gt;\u0026amp; 1 | grep -qw 'inet6' \u0026amp;\u0026amp; echo \u0026quot;utility 'route' is IPv6-ready\u0026quot; 3. Configuration #ä¸ºç½‘å£æ·»åŠ ä¸€ä¸ª IPv6 åœ°å€ ï¼š\nå¯ä»¥ç”¨ del å‚æ•°åˆ é™¤ ï¼šifconfig eth0 inet6 del 2001:0db8:0:f101::1/64\n4. Test #å¯ä»¥ç”¨ IPv6 å¯ä»¥ç”¨ ping6 å‘½ä»¤ï¼Œä¾‹å¦‚æµ‹è¯• loopback interface ï¼š\nping6 çš„ -I å‚æ•°å¯ä»¥æŒ‡å®šç½‘å£ï¼Œä¾‹å¦‚è¦æµ‹è¯• eth0 å¯ä»¥ç”¨ ping6 -I eth0 fe80::2e0:18ff:fe90:9205 ã€‚\næµ‹è¯•è·¯ç”±çš„ traceroute å‘½ä»¤ä¹Ÿæœ‰ IPv6 ç‰ˆæœ¬ï¼š traceroute6 ã€‚\n5. å‚è€ƒ #http://tldp.org/HOWTO/Linux+IPv6-HOWTO/index.html\n","date":"2015 November 27","permalink":"/posts/2015/11/27/","section":"Posts","summary":"1. What is IPv6 #IPv6 æ˜¯ä¸ºäº†è§£å†³ IPv4 åœ°å€èµ„æºæ—¥æ¸æ¯ç«­çš„é—®é¢˜ï¼Œä½¿ç”¨çš„æ˜¯ 128bit åœ°å€ï¼Œå¯ä»¥æä¾›æ›´å¤šçš„åœ°å€ç©ºé—´ã€‚IPv6 åœ°å€ä»¥ 16bit ä¸ºä¸€ç»„ï¼Œæ¯ç»„ç”¨å†’å·éš”å¼€ï¼Œå¯ä»¥åˆ†ä¸ºå…«ç»„ï¼Œæ¯ç»„ä»¥ 4 ä¸ªåå…­è¿›åˆ¶æ•°è¡¨ç¤ºï¼Œå…± 32 ä¸ªåå…­è¿›åˆ¶æ•°ï¼Œä¾‹å¦‚ 2001:0db8:85a3:08d3:1319:8a2e:0370:7344 æ˜¯ä¸€ä¸ªåˆæ³•çš„ IPv6 åœ°å€ï¼Œå®ƒåˆå¯ä»¥åˆ†ä¸ºä¸¤ä¸ªé€»è¾‘éƒ¨åˆ†ï¼šä¸€ä¸ª 64 ä½çš„ç½‘ç»œå‰ç¼€å’Œä¸€ä¸ª 64 ä½çš„ä¸»æœºåœ°å€ã€‚","title":"Linux IPv6 HOWTO"},{"content":"1. è“ç‰™ç®€ä»‹ #è“ç‰™æ˜¯ä¸€ç§æ”¯æŒè®¾å¤‡çŸ­è·ç¦»é€šä¿¡çš„æ— çº¿ç”µæŠ€æœ¯ï¼Œä½¿ç”¨ 2.4GHz é¢‘æ®µï¼Œæ•°æ®é€Ÿç‡ä¸º1Mbps ã€‚é‡‡ç”¨æ—¶åˆ†å¤ç”¨æ–¹æ¡ˆå®ç°å…¨åŒå·¥ä¼ è¾“ã€‚\nè“ç‰™æŠ€æœ¯å°†è®¾å¤‡åˆ†ä¸ºä¸¤ç§ï¼šä¸»è®¾å¤‡å’Œä»è®¾å¤‡ã€‚\nè“ç‰™ä¸»è®¾å¤‡çš„ç‰¹ç‚¹ï¼šä¸»è®¾å¤‡ä¸€èˆ¬å…·æœ‰è¾“å…¥ç«¯ã€‚åœ¨è¿›è¡Œè“ç‰™åŒ¹é…æ“ä½œæ—¶ï¼Œç”¨æˆ·é€šè¿‡è¾“å…¥ç«¯å¯è¾“å…¥éšæœºçš„åŒ¹é…å¯†ç æ¥å°†ä¸¤ä¸ªè®¾å¤‡åŒ¹é…ã€‚è“ç‰™æ‰‹æœºã€å®‰è£…æœ‰è“ç‰™æ¨¡å—çš„ PC ç­‰éƒ½æ˜¯ä¸»è®¾å¤‡ã€‚ï¼ˆä¾‹å¦‚ï¼šè“ç‰™æ‰‹æœºå’Œè“ç‰™ PC è¿›è¡ŒåŒ¹é…æ—¶ï¼Œç”¨æˆ·å¯åœ¨è“ç‰™æ‰‹æœºä¸Šä»»æ„è¾“å…¥ä¸€ç»„æ•°å­—ï¼Œç„¶ååœ¨è“ç‰™PCä¸Šè¾“å…¥ç›¸åŒçš„ä¸€ç»„æ•°å­—ï¼Œæ¥å®Œæˆè¿™ä¸¤ä¸ªè®¾å¤‡ä¹‹é—´çš„åŒ¹é…ã€‚ï¼‰\nè“ç‰™ä»è®¾å¤‡ç‰¹ç‚¹ï¼šä»è®¾å¤‡ä¸€èˆ¬ä¸å…·å¤‡è¾“å…¥ç«¯ã€‚å› æ­¤ä»è®¾å¤‡åœ¨å‡ºå‚æ—¶ï¼Œåœ¨å…¶è“ç‰™èŠ¯ç‰‡ä¸­ï¼Œå›ºåŒ–æœ‰ä¸€ä¸ª4ä½æˆ–6ä½æ•°å­—çš„åŒ¹é…å¯†ç ã€‚è“ç‰™è€³æœºç­‰éƒ½æ˜¯ä»è®¾å¤‡ã€‚ï¼ˆä¾‹å¦‚ï¼šè“ç‰™ PC ä¸è“ç‰™è€³æœºåŒ¹é…æ—¶ï¼Œç”¨æˆ·å°†è“ç‰™è€³æœºä¸Šçš„åŒ¹é…å¯†ç è¾“å…¥åˆ°è“ç‰™ PC ä¸Šï¼Œå®ŒæˆåŒ¹é…ã€‚ï¼‰\nè“ç‰™è®¾å¤‡çš„å‘¼å«è¿‡ç¨‹ï¼š\nè“ç‰™ä¸»ç«¯è®¾å¤‡å‘èµ·å‘¼å«ï¼Œé¦–å…ˆæ˜¯æŸ¥æ‰¾ï¼Œæ‰¾å‡ºå‘¨å›´å¤„äºå¯è¢«æŸ¥æ‰¾çš„è“ç‰™è®¾å¤‡ï¼Œæ­¤æ—¶ä»ç«¯è®¾å¤‡éœ€è¦å¤„äºå¯è¢«æŸ¥æ‰¾çŠ¶æ€ã€‚ ä¸»ç«¯è®¾å¤‡æ‰¾åˆ°ä»ç«¯è“ç‰™è®¾å¤‡åï¼Œä¸ä»ç«¯è“ç‰™è®¾å¤‡è¿›è¡Œé…å¯¹ï¼Œæ­¤æ—¶éœ€è¦è¾“å…¥ä»ç«¯è®¾å¤‡çš„ PIN ç ã€‚ é…å¯¹å®Œæˆåï¼Œä»ç«¯è“ç‰™è®¾å¤‡ä¼šè®°å½•ä¸»ç«¯è®¾å¤‡çš„ä¿¡ä»»ä¿¡æ¯ï¼Œæ­¤æ—¶ä¸»ç«¯å³å¯å‘ä»ç«¯è®¾å¤‡å‘èµ·å‘¼å«ï¼Œæ ¹æ®åº”ç”¨ä¸åŒï¼Œå¯èƒ½æ˜¯ACLæ•°æ®é“¾è·¯å‘¼å«æˆ–SCOè¯­éŸ³é“¾è·¯å‘¼å«ï¼Œå·²é…å¯¹çš„è®¾å¤‡åœ¨ä¸‹æ¬¡å‘¼å«æ—¶ï¼Œä¸å†éœ€è¦é‡æ–°é…å¯¹ã€‚ å·²é…å¯¹çš„è®¾å¤‡ï¼Œåšä¸ºä»ç«¯çš„è“ç‰™è€³æœºä¹Ÿå¯ä»¥å‘èµ·å»ºé“¾è¯·æ±‚ï¼Œä½†åšæ•°æ®é€šè®¯çš„è“ç‰™æ¨¡å—ä¸€èˆ¬ä¸å‘èµ·å‘¼å«ã€‚ é“¾è·¯å»ºç«‹æˆåŠŸåï¼Œä¸»ä»ä¸¤ç«¯ä¹‹é—´å³å¯è¿›è¡ŒåŒå‘çš„æ•°æ®é€šè®¯ã€‚åœ¨é€šä¿¡çŠ¶æ€ä¸‹ï¼Œä¸»ç«¯å’Œä»ç«¯è®¾å¤‡éƒ½å¯ä»¥å‘èµ·æ–­é“¾ï¼Œæ–­å¼€è“ç‰™é“¾è·¯ã€‚ è“ç‰™åè®®æ ˆï¼š\nRFCOMM å«åšç”µç¼†æ›¿ä»£åè®®ï¼Œå®ƒåœ¨è“ç‰™åŸºå¸¦åè®®ä¸Šä»¿çœŸ RS-232 æ§åˆ¶å’Œæ•°æ®ä¿¡å·ï¼Œä¸ºä½¿ç”¨ä¸²è¡Œçº¿ä¼ é€æœºåˆ¶çš„ä¸Šå±‚åè®®ï¼ˆå¦‚ OBEX ï¼‰æä¾›æœåŠ¡ã€‚ OBEX å«åšå¯¹è±¡äº¤æ¢åè®®ï¼Œé‡‡ç”¨ç®€å•çš„å’Œè‡ªå‘çš„æ–¹å¼äº¤æ¢ç›®æ ‡ï¼Œç”¨äºä¼ è¾“æ–‡ä»¶ã€‚ 2. Linux å¯¹è“ç‰™çš„æ”¯æŒ #2.6 ä¹‹åçš„å†…æ ¸éƒ½æä¾›äº†è“ç‰™æ”¯æŒï¼Œé€šå¸¸éƒ½å·²ç»æ˜¯é»˜è®¤çš„è®¾ç½®ï¼š\n[*] Networking support ---\u0026gt; [CONFIG_NET] \u0026lt;/M\u0026gt; Bluetooth subsystem support ---\u0026gt; [CONFIG_BT] \u0026lt;*/M\u0026gt; RFCOMM protocol support [CONFIG_BT_RFCOMM] [*] RFCOMM TTY support [CONFIG_BT_RFCOMM_TTY] \u0026lt;*/M\u0026gt; BNEP protocol support [CONFIG_BT_BNEP] [*] Multicast filter support [CONFIG_BT_BNEP_MC_FILTER] [*] Protocol filter support [CONFIG_BT_BNEP_PROTO_FILTER] \u0026lt;*/M\u0026gt; HIDP protocol support [CONFIG_BT_HIDP] Bluetooth device drivers ---\u0026gt; (Select the appropriate drivers for your Bluetooth hardware) \u0026lt;*/M\u0026gt; RF switch subsystem support ---\u0026gt; [CONFIG_RFKILL] Linux å®˜æ–¹çš„è“ç‰™åè®®æ ˆæ˜¯ BlueZ ï¼ŒBlueZ åŒ…æ‹¬ ï¼š\nHCI Core HCI UART, USB and Virtual HCI device drivers L2CAP module Configuration and testing utilities BlueZ åŒ…æä¾›äº†è“ç‰™ç¼–ç¨‹åº“å’Œå„ç§å·¥å…·ï¼š\nbccmd : is used to issue BlueCore commands to Cambridge Silicon Radio devices. bluemoon : is a Bluemoon configuration utility. bluetoothctl : is the interactive Bluetooth control program. bluetoothd : is the Bluetooth daemon. btmon : provides access to the Bluetooth subsystem monitor infrastructure for reading HCI traces. ciptool : is used to set up, maintain, and inspect the CIP configuration of the Bluetooth subsystem in the Linux kernel. hciattach : is used to attach a serial UART to the Bluetooth stack as HCI transport interface. hciconfig : is used to configure Bluetooth devices. hcidump : reads raw HCI data coming from and going to a Bluetooth device and prints to screen commands, events and data in a human-readable form. hcitool : is used to configure Bluetooth connections and send some special command to Bluetooth devices. hex2hcd : is used to convert a file needed by Broadcom devices to hcd (Broadcom bluetooth firmware) format. l2ping : is used to send a L2CAP echo request to the Bluetooth MAC address given in dotted hex notation. l2test : is L2CAP testing program. rctest : is used to test RFCOMM communications on the Bluetooth stack. rfcomm : is used to set up, maintain, and inspect the RFCOMM configuration of the Bluetooth subsystem in the Linux kernel. sdptool : is used to perform SDP queries on Bluetooth devices. libbluetooth.so : contains the BlueZ 4 API functions. å®‰è£…äº† BlueZ ä¹‹åï¼Œé…ç½®æ–‡ä»¶éƒ½åœ¨ /etc/bluetooth ç›®å½•ä¸‹ã€‚\n3. åœ¨ Linux ä¸­é…ç½®è“ç‰™ #ä½¿ç”¨çš„æ¨¡å—æ˜¯ Intel 2330 ï¼ŒåŒæ—¶æ”¯æŒ WIFI å’Œ Bluetooth ã€‚è°ƒè¯•å‰åº”è¯¥å…ˆä¸‹è½½æ¨¡å—çš„å›ºä»¶ iwlwifi-2030-6.ucode ï¼Œæ”¾å…¥ç³»ç»Ÿçš„ /lib/fireware ç›®å½•ä¸‹ï¼Œç³»ç»ŸåŠ è½½é©±åŠ¨ iwlwifi æ—¶ä¼šè‡ªåŠ¨æŸ¥æ‰¾ã€‚ä½¿ç”¨çš„ç³»ç»Ÿæ˜¯ yocto linux ï¼Œè¿è¡Œåœ¨ Intel Quark å¹³å°çš„ä¸»æ¿ã€‚\nç³»ç»Ÿå¯åŠ¨åå¯ä»¥æŸ¥çœ‹è®¾å¤‡ï¼š\nroot@WR-IntelligentDevice:~# lsusb Bus 001 Device 002: ID 0424:2514 Standard Microsystems Corp. USB 2.0 Hub Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub Bus 002 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub Bus 001 Device 003: ID 8087:07da Intel Corp. åº”è¯¥åŠ è½½çš„é©±åŠ¨ï¼š\nroot@WR-IntelligentDevice:~# lsmod | grep bt bluetooth 200527 6 rfcomm,hidp,btusb btusb 11506 0 å¦‚æœé©±åŠ¨åŠ è½½æˆåŠŸï¼Œä¼šå‡ºç°è“ç‰™çš„è®¾å¤‡èŠ‚ç‚¹ï¼Œä½¿ç”¨ hciconfig å‘½ä»¤æŸ¥çœ‹ï¼š\nroot@WR-IntelligentDevice:~# hciconfig -a hci0: Type: BR/EDR Bus: USB BD Address: 00:15:00:A1:E3:83 ACL MTU: 310:10 SCO MTU: 64:8 DOWN RX bytes:495 acl:0 sco:0 events:22 errors:0 TX bytes:369 acl:0 sco:0 commands:22 errors:0 Features: 0xff 0xff 0x8f 0xfe 0xdb 0xff 0x5b 0x87 Packet type: DM1 DM3 DM5 DH1 DH3 DH5 HV1 HV2 HV3 Link policy: RSWITCH HOLD SNIFF PARK Link mode: SLAVE ACCEPT å¯ä»¥çœ‹åˆ°è®¾å¤‡çš„çŠ¶æ€æ˜¯ DOWN ï¼Œè¡¨ç¤ºè“ç‰™è¿˜æ²¡æœ‰å¯åŠ¨ã€‚æ‰‹åŠ¨å¯åŠ¨è“ç‰™ï¼Œå¯ä»¥çœ‹åˆ°è“ç‰™çŠ¶æ€å˜ä¸º UP RUNNING ï¼Œè€Œä¸”æ˜¯ä»è®¾å¤‡ï¼š\nroot@WR-IntelligentDevice:~# hciconfig hci0 up root@WR-IntelligentDevice:~# hciconfig -a hci0: Type: BR/EDR Bus: USB BD Address: 00:15:00:A1:E3:83 ACL MTU: 310:10 SCO MTU: 64:8 UP RUNNING RX bytes:990 acl:0 sco:0 events:44 errors:0 TX bytes:738 acl:0 sco:0 commands:44 errors:0 Features: 0xff 0xff 0x8f 0xfe 0xdb 0xff 0x5b 0x87 Packet type: DM1 DM3 DM5 DH1 DH3 DH5 HV1 HV2 HV3 Link policy: RSWITCH HOLD SNIFF PARK Link mode: SLAVE ACCEPT Name: 'PC Controller App v1.4' Class: 0x000000 Service Classes: Unspecified Device Class: Miscellaneous, HCI Version: 4.0 (0x6) Revision: 0x1ebd LMP Version: 4.0 (0x6) Subversion: 0xfc00 Manufacturer: Intel Corp. (2) æ›´å¥½çš„æ–¹æ³•æ˜¯ç”¨ bluetoothd å¯åŠ¨è“ç‰™ï¼Œ bluetoothd æ˜¯ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹ï¼Œå¯åŠ¨æ—¶ä¼šæ ¹æ® /etc/bluetooth/ ä¸‹çš„é…ç½®æ–‡ä»¶åˆå§‹åŒ–è“ç‰™ï¼Œç›´æ¥æ‰§è¡Œ bluetoothd ã€‚\n3.1 è¿æ¥æ‰‹æœºè“ç‰™ #æ‰“å¼€æ‰‹æœºçš„è“ç‰™ï¼Œæµ‹è¯•ç”¨çš„æ˜¯å°ç±³æ‰‹æœºã€‚è¿™é‡Œè¦æ³¨æ„ä¸€ç‚¹ï¼Œæ‰‹æœºä¸Šçš„è“ç‰™åœ¨æ‰“å¼€åä¼šæœ‰ä¸€æ®µæ—¶é—´å¤„äºå¯æ£€æµ‹çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯å…¶ä»–è“ç‰™è®¾å¤‡å¯ä»¥æ‰«æåˆ°å®ƒï¼Œä¹‹åä¼šå…³é—­å¯æ£€æµ‹æ€§ï¼Œè¿™æ®µæ—¶é—´çš„é•¿çŸ­é€šå¸¸å¯ä»¥è®¾ç½®ï¼Œæœ‰çš„æ‰‹æœºåœ¨ç†„å±æ—¶ä¹Ÿä¼šå…³é—­è“ç‰™çš„å¯æ£€æµ‹æ€§ã€‚\nç„¶åæ‰«æä¸€ä¸‹å‘¨è¾¹çš„è“ç‰™è®¾å¤‡ï¼š\nroot@WR-IntelligentDevice:~# hcitool scan Scanning ... A2:CF:49:FD:99:AF MI-ONE Plus scan ç”¨äºæ‰«æç»å…¸è“ç‰™è®¾å¤‡ï¼Œå¦‚æœæ˜¯ä½åŠŸè€—è“ç‰™è®¾å¤‡ï¼ˆBLEï¼‰ï¼Œä¾‹å¦‚æ‰‹ç¯ä¹‹ç±»ï¼Œè¦ ç”¨ lescan é€‰é¡¹ï¼Œè°ƒè¯• BLE è®¾å¤‡è¦ç”¨ gatttool å·¥å…·ã€‚\næµ‹è¯•èƒ½å¦è¿é€šï¼š\nroot@WR-IntelligentDevice:~# l2ping -i hci0 -c 4 A2:CF:49:FD:99:AF Ping: A2:CF:49:FD:99:AF from 00:15:00:A1:E3:83 (data size 44) ... 44 bytes from A2:CF:49:FD:99:AF id 0 time 25.03ms 44 bytes from A2:CF:49:FD:99:AF id 1 time 25.32ms 44 bytes from A2:CF:49:FD:99:AF id 2 time 26.96ms 44 bytes from A2:CF:49:FD:99:AF id 3 time 27.06ms 4 sent, 4 received, 0% loss åˆ©ç”¨ SDP åè®®ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æŸ¥çœ‹æ¯ä¸ªè®¾å¤‡éƒ½æœ‰åŠŸèƒ½ï¼Œèƒ½æä¾›ä»€ä¹ˆæœåŠ¡ï¼Œæ¯ç§åŸºäº RFCOMM çš„æœåŠ¡éƒ½ä½¿ç”¨æŸç§åè®®ï¼Œå æ®å“ªä¸ªâ€œé¢‘é“ (channel)â€ï¼Œè¿™æ˜¯ä½¿ç”¨æœåŠ¡æ—¶çš„ä¸€ä¸ªé‡è¦å‚æ•°ï¼Œå…ˆçœ‹çœ‹è‡ªå·±ï¼š\nroot@WR-IntelligentDevice:~# sdptool browse local Browsing FF:FF:FF:00:00:00 ... Service Name: SIM Access Server Service RecHandle: 0x10000 Service Class ID List: \u0026quot;SIM Access\u0026quot; (0x112d) \u0026quot;Generic Telephony\u0026quot; (0x1204) Protocol Descriptor List: \u0026quot;L2CAP\u0026quot; (0x0100) \u0026quot;RFCOMM\u0026quot; (0x0003) Channel: 8 Profile Descriptor List: \u0026quot;SIM Access\u0026quot; (0x112d) Version: 0x0101 Service Name: Headset Audio Gateway Service RecHandle: 0x10001 Service Class ID List: \u0026quot;Headset Audio Gateway\u0026quot; (0x1112) \u0026quot;Generic Audio\u0026quot; (0x1203) Protocol Descriptor List: \u0026quot;L2CAP\u0026quot; (0x0100) \u0026quot;RFCOMM\u0026quot; (0x0003) Channel: 12 Profile Descriptor List: \u0026quot;Headset\u0026quot; (0x1108) Version: 0x0102 Service Name: Hands-Free Audio Gateway Service RecHandle: 0x10002 Service Class ID List: \u0026quot;Handsfree Audio Gateway\u0026quot; (0x111f) \u0026quot;Generic Audio\u0026quot; (0x1203) Protocol Descriptor List: \u0026quot;L2CAP\u0026quot; (0x0100) \u0026quot;RFCOMM\u0026quot; (0x0003) Channel: 13 Profile Descriptor List: \u0026quot;Handsfree\u0026quot; (0x111e) Version: 0x0105 Service Name: Audio Source Service RecHandle: 0x10003 Service Class ID List: \u0026quot;Audio Source\u0026quot; (0x110a) Protocol Descriptor List: \u0026quot;L2CAP\u0026quot; (0x0100) PSM: 25 \u0026quot;AVDTP\u0026quot; (0x0019) uint16: 0x102 Profile Descriptor List: \u0026quot;Advanced Audio\u0026quot; (0x110d) Version: 0x0102 Service Name: AVRCP TG Service RecHandle: 0x10004 Service Class ID List: \u0026quot;AV Remote Target\u0026quot; (0x110c) Protocol Descriptor List: \u0026quot;L2CAP\u0026quot; (0x0100) PSM: 23 \u0026quot;AVCTP\u0026quot; (0x0017) uint16: 0x103 Profile Descriptor List: \u0026quot;AV Remote\u0026quot; (0x110e) Version: 0x0104 Service Name: AVRCP CT Service RecHandle: 0x10005 Service Class ID List: \u0026quot;AV Remote\u0026quot; (0x110e) Protocol Descriptor List: \u0026quot;L2CAP\u0026quot; (0x0100) PSM: 23 \u0026quot;AVCTP\u0026quot; (0x0017) uint16: 0x103 Profile Descriptor List: \u0026quot;AV Remote\u0026quot; (0x110e) Version: 0x0100 Service Name: Dial-Up Networking Service RecHandle: 0x10006 Service Class ID List: \u0026quot;Dialup Networking\u0026quot; (0x1103) \u0026quot;Generic Networking\u0026quot; (0x1201) Protocol Descriptor List: \u0026quot;L2CAP\u0026quot; (0x0100) \u0026quot;RFCOMM\u0026quot; (0x0003) Channel: 1 Profile Descriptor List: \u0026quot;Dialup Networking\u0026quot; (0x1103) Version: 0x0100 å†çœ‹çœ‹æ‰‹æœºçš„è“ç‰™æœåŠ¡ï¼š\nroot@WR-IntelligentDevice:~# sdptool browse A2:CF:49:FD:99:AF Browsing A2:CF:49:FD:99:AF ... Service RecHandle: 0x10000 Service Class ID List: \u0026quot;PnP Information\u0026quot; (0x1200) Profile Descriptor List: \u0026quot;PnP Information\u0026quot; (0x1200) Version: 0x0102 Service Name: Audio Source Service RecHandle: 0x10001 Service Class ID List: \u0026quot;Audio Source\u0026quot; (0x110a) Protocol Descriptor List: \u0026quot;L2CAP\u0026quot; (0x0100) PSM: 25 \u0026quot;AVDTP\u0026quot; (0x0019) uint16: 0x102 Profile Descriptor List: \u0026quot;Advanced Audio\u0026quot; (0x110d) Version: 0x0102 Service Name: AVRCP TG Service RecHandle: 0x10002 Service Class ID List: \u0026quot;AV Remote Target\u0026quot; (0x110c) Protocol Descriptor List: \u0026quot;L2CAP\u0026quot; (0x0100) PSM: 23 \u0026quot;AVCTP\u0026quot; (0x0017) uint16: 0x103 Profile Descriptor List: \u0026quot;AV Remote\u0026quot; (0x110e) Version: 0x0100 Service Name: Voice Gateway Service RecHandle: 0x10003 Service Class ID List: \u0026quot;Handsfree Audio Gateway\u0026quot; (0x111f) \u0026quot;Generic Audio\u0026quot; (0x1203) Protocol Descriptor List: \u0026quot;L2CAP\u0026quot; (0x0100) \u0026quot;RFCOMM\u0026quot; (0x0003) Channel: 10 Profile Descriptor List: \u0026quot;Handsfree\u0026quot; (0x111e) Version: 0x0105 Service Name: Voice Gateway Service RecHandle: 0x10004 Service Class ID List: \u0026quot;Headset Audio Gateway\u0026quot; (0x1112) \u0026quot;Generic Audio\u0026quot; (0x1203) Protocol Descriptor List: \u0026quot;L2CAP\u0026quot; (0x0100) \u0026quot;RFCOMM\u0026quot; (0x0003) Channel: 11 Profile Descriptor List: \u0026quot;Headset\u0026quot; (0x1108) Version: 0x0102 Service Name: OBEX Object Push Service RecHandle: 0x10005 Service Class ID List: \u0026quot;OBEX Object Push\u0026quot; (0x1105) Protocol Descriptor List: \u0026quot;L2CAP\u0026quot; (0x0100) \u0026quot;RFCOMM\u0026quot; (0x0003) Channel: 12 \u0026quot;OBEX\u0026quot; (0x0008) Profile Descriptor List: \u0026quot;OBEX Object Push\u0026quot; (0x1105) Version: 0x0100 Service Name: OBEX Phonebook Access Server Service RecHandle: 0x10006 Service Class ID List: \u0026quot;Phonebook Access - PSE\u0026quot; (0x112f) Protocol Descriptor List: \u0026quot;L2CAP\u0026quot; (0x0100) \u0026quot;RFCOMM\u0026quot; (0x0003) Channel: 19 \u0026quot;OBEX\u0026quot; (0x0008) Profile Descriptor List: \u0026quot;Phonebook Access\u0026quot; (0x1130) Version: 0x0100 ä½¿ç”¨ openobex åŒ…æä¾›çš„ obex_test å·¥å…·ï¼Œåœ¨ yocto çš„å®˜ç½‘å¯ä»¥ä¸‹è½½åˆ° recipes æ–‡ä»¶å’Œè¡¥ä¸ã€‚æˆ–è€…åœ¨ä¸‹è½½æºç ï¼šhttps://github.com/zuckschwerdt/openobex\n3.2 è¿æ¥è“ç‰™è€³æœº #å…ˆå¯åŠ¨æœ¬åœ°çš„è“ç‰™æœåŠ¡å¹¶é…ç½®ï¼š\nroot@WR-IntelligentDevice:~# bluetoothd root@WR-IntelligentDevice:~# hciconfig hci0 noencrypt root@WR-IntelligentDevice:~# hciconfig hci0 piscan root@WR-IntelligentDevice:~# hciconfig hci0 name \u0026quot;bluez4\u0026quot; root@WR-IntelligentDevice:~# hciconfig hci0 pageto 65535 ç„¶åå¯åŠ¨è“ç‰™è€³æœºï¼Œä½¿ä¹‹å¤„äºå¯æ£€æµ‹çŠ¶æ€ï¼Œç„¶åæ‰«æï¼š\nroot@WR-IntelligentDevice:~# hcitool scan Scanning ... 50:C9:71:AA:E0:AE JABRA EASYGO å‡†å¤‡ä¸€ä¸ª test.wav çš„éŸ³é¢‘æ–‡ä»¶ï¼Œç„¶åç”¨å¦‚ä¸‹è„šæœ¬æµ‹è¯•è“ç‰™è€³æœºï¼š\n#!/bin/sh local mac=\u0026quot;50:C9:71:AA:E0:AE\u0026quot; local asoundconf=\u0026quot;/etc/asound.conf\u0026quot; #add service sdptool add a2snk sdptool add a2src sdptool add avrct sdptool add avrtg sdptool add hf sdptool add hs echo \u0026quot;\u0026quot; \u0026gt;\u0026gt; $asoundconf echo \u0026quot;pcm.bluetooth{\u0026quot; \u0026gt;\u0026gt; $asoundconf echo \u0026quot; type bluetooth\u0026quot; \u0026gt;\u0026gt; $asoundconf echo \u0026quot; device $mac\u0026quot; \u0026gt;\u0026gt; $asoundconf echo \u0026quot; profile \\\u0026quot;hifi\\\u0026quot;\u0026quot; \u0026gt;\u0026gt; $asoundconf echo \u0026quot;}\u0026quot; \u0026gt;\u0026gt; $asoundconf echo \u0026quot;Bind to $mac ...\u0026quot; simple-agent hci0 $mac || { echo \u0026quot;simple-agent failed!\u0026quot; exit 1 } echo \u0026quot;Connect $mac ...\u0026quot; bluez-test-audio connect $mac || { echo \u0026quot;audio connect failed!\u0026quot; exit 1 } echo \u0026quot;Connection result ...\u0026quot; hcitool con echo \u0026quot;Play audio ...\u0026quot; aplay -D bluetooth ./test.wav æ­£å¸¸æƒ…å†µä¼šæ‰“å°å¦‚ä¸‹ä¿¡æ¯ï¼Œè“ç‰™è€³æœºå¯ä»¥å¬åˆ°éŸ³é¢‘å†…å®¹ï¼š\nAudio sink service registered Audio source service registered Remote control service registered Remote target service registered Handsfree service registered Headset service registered Bind to 50:C9:71:AA:E0:AE ... Release New device (/org/bluez/3319/hci0/dev_50_C9_71_AA_E0_AE) Connect 50:C9:71:AA:E0:AE ... Connection result ... Connections: \u0026lt; ACL 50:C9:71:AA:E0:AE handle 34 state 1 lm MASTER AUTH ENCRYPT Play audio ... Playing WAVE './test.wav' : Signed 16 bit Little Endian, Rate 44100 Hz, Stereo ","date":"2015 October 22","permalink":"/posts/2015/10/22/","section":"Posts","summary":"1. è“ç‰™ç®€ä»‹ #è“ç‰™æ˜¯ä¸€ç§æ”¯æŒè®¾å¤‡çŸ­è·ç¦»é€šä¿¡çš„æ— çº¿ç”µæŠ€æœ¯ï¼Œä½¿ç”¨ 2.","title":"Linux ä¸‹è°ƒè¯•è“ç‰™æ¨¡å—çš„ç¬”è®°"},{"content":"comgtå¸®åŠ©æ–‡æ¡£\ncomgt æ˜¯ä¸€ä¸ª GPRS/EDGE/3G/HSDPA å’Œ 3G/GPRS æ¨¡å—é…ç½®å·¥å…·ã€‚å®ƒæ›´åƒæ˜¯ä¸€ä¸ªè„šæœ¬è¯­è¨€è§£é‡Šå™¨ï¼Œé€šè¿‡è°ƒç”¨å†…å»ºã€æˆ–è€…å¤–éƒ¨è„šæœ¬ä¸ GPRS å’Œ 3G æ¨¡å—é€šè®¯ã€‚\nè¯­æ³• #comgt -d device -ehstvVx script\nå‚æ•° # -d device ï¼šæŒ‡å®šæ¨¡å—çš„é€šè®¯å£ï¼Œä¾‹å¦‚ /dev/ttyUSB2 æˆ– /dev/modem -e ï¼šæ‰“å¼€ä¸²å£é€šä¿¡çš„ echo -h ï¼šæ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ -s ï¼šåœ¨å¤–éƒ¨è„šæœ¬æ‰§è¡Œå‰ï¼Œä¸è¦è¿è¡Œå†…å»ºçš„é»˜è®¤è„šæœ¬ -t ï¼šä½¿ç”¨å¤‡ç”¨çº¿è·¯ç»ˆç«¯ -v ï¼šè¿è¡Œè¯¦ç»†æ¨¡å¼ï¼Œä¼šæ˜¾ç¤ºè¯¦ç»†çš„é€šè®¯è¿‡ç¨‹ -V ï¼šæ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯ -x ï¼šå°†å†…å»ºå’Œå¤–éƒ¨è„šæœ¬ä¸­çš„æ³¢ç‰¹ç‡ 115200 æ”¹ä¸º 57600 å†…å»ºè„šæœ¬ # comgt ï¼šè¿è¡Œé»˜è®¤çš„å†…å»ºè„šæœ¬ã€‚å¦‚æœè¿è¡Œ comgt æ—¶æ²¡æœ‰æŒ‡å®šä»»ä½•è„šæœ¬ï¼Œä¾‹å¦‚ comgt -d /dev/ttyS1 ,å®ƒä¼šä¾æ¬¡æ‰§è¡Œå‡ ä¸ªå†…å»ºçš„è„šæœ¬ PIN ã€regã€sig ã€‚ comgt help ï¼šåˆ—å‡ºæ‰€æœ‰å¸®åŠ©ä¿¡æ¯ã€‚ comgt info ï¼šåˆ—å‡ºå½“å‰æ¨¡å—çš„é…ç½®ã€‚ comgt sig ï¼šè·å–ä¿¡å·å¼ºåº¦ã€‚ comgt reg ï¼šæ˜¾ç¤ºæ³¨å†ŒçŠ¶æ€ã€‚ comgt 3G ï¼šå°†æ¨¡å—è®¾ä¸º 3G only (UMTS/HSDPA) æ¨¡å¼ã€‚ comgt 2G ï¼šå°†æ¨¡å—è®¾ä¸º 2G only (GSM/GPRS/EDGE) æ¨¡å¼ã€‚ comgt 3G2G ï¼šå°†æ¨¡å—è®¾ä¸º 3G preferred (UMTS/HSDPA and GSM/GPRS/EDGE) æ¨¡å¼ å¤–éƒ¨è„šæœ¬ #ä»¥ sendmsg.gcom ä¸ºä¾‹ï¼Œè¯¥è„šæœ¬å®ç°äº†å‘é€çŸ­ä¿¡çš„åŠŸèƒ½ï¼š\nopengt set com 115200n81 set comecho off set senddelay 0.02 waitquiet 0.2 0.2 flash 0.1 :start send \u0026quot;AT+CMGF=1^m\u0026quot; get 1 \u0026quot;\u0026quot; $s print $s send \u0026quot;AT+CSCS=GSM^m\u0026quot; get 1 \u0026quot;\u0026quot; $s print $s send \u0026quot;AT+CSMP=17,168,0,0^m\u0026quot; get 1 \u0026quot;\u0026quot; $s print $s print \u0026quot;Input message:\\n\u0026quot; input $m send \u0026quot;AT+CMGS=+8613824741490^m\u0026quot; send $m+\u0026quot;^Z\u0026quot; get 1 \u0026quot;\u0026quot; $s print $s :continue exit 0 opengt æ®µç”¨äºè®¾ç½®ä¸²å£çš„å„é¡¹å‚æ•°,ä¹‹åä¼šä¸€æ¬¡æ‰§è¡Œ start æ®µçš„å‘½ä»¤ï¼Œè¿™é‡Œæ¶‰åŠåˆ°å‡ ä¸ªå¸¸ç”¨çš„å‘½ä»¤ï¼š\nsend : å‘ä¸²å£å‘é€å­—ç¬¦ä¸²ã€‚è¿™ä¸ªå­—ç¬¦åº”è¯¥ä»¥ ^m ç»“å°¾ï¼Œè¡¨ç¤ºä¸€ä¸ªå›è½¦ç¬¦ã€‚å‡ ä¸ªå­—ç¬¦ä¸²å¯ä»¥ç”¨åŠ å·è¿æ¥ã€‚æœ‰æ—¶ä¸€ä¸ª AT å‘½ä»¤åä¼šç­‰å¾…ç”¨æˆ·è¾“å…¥ï¼Œæ¯”å¦‚ AT+CMGS åä¼šç­‰å¾…è¾“å…¥çŸ­ä¿¡å†…å®¹ï¼Œæ­¤æ—¶ç»§ç»­è°ƒç”¨ send å‘½ä»¤å³å¯ã€‚^Z è¡¨ç¤º Ctrl+Z ç»„åˆé”®ã€‚ input : ç­‰å¾…ç”¨æˆ·è¾“å…¥ï¼Œè¾“å…¥çš„å­—ç¬¦ä¸²æ”¾å…¥å˜é‡ $x ä¸­ã€‚ print : åœ¨ç»ˆç«¯æ‰“å°ä¸€è¡Œå­—ç¬¦ä¸²ã€‚ get : è·å–ä¸²å£è¿”å›ä»å­—ç¬¦ä¸²ã€‚è¯­æ³•æ˜¯ get timeout \u0026quot;terminators\u0026quot; $string æ‰§è¡Œè¯¥è„šæœ¬ï¼š\ngcom -d /dev/ttyUSB2 -s sendmsg.gcom ","date":"2015 September 9","permalink":"/posts/2015/09/09/","section":"Posts","summary":"comgtå¸®åŠ©æ–‡æ¡£","title":"Linux å‘½ä»¤è¡Œä¸‹çš„ 3G æ¨¡å—é…ç½®å·¥å…· comgt"},{"content":"å¸¸è§çš„ GPS æ•°æ®æ–‡ä»¶æ ¼å¼æœ‰ GPSã€CVSã€KML ç­‰ï¼Œè¿™äº›æ•°æ®æ ¼å¼æœ¬èº«å¹¶ä¸å¤æ‚ï¼ŒåŸºæœ¬éƒ½æ˜¯å¯¹åæ ‡ç‚¹çš„é›†åˆï¼Œå¤§éƒ¨åˆ† GPS è®°å½•ä»ªéƒ½æ”¯æŒå¤šç§æ ¼å¼çš„æ•°æ®æ–‡ä»¶çš„å¯¼å…¥å’Œå¯¼å‡ºã€‚ä½†æ˜¯æœ‰æ—¶è¿˜æ˜¯éœ€è¦åšæ ¼å¼è½¬æ¢ï¼Œæ¯”å¦‚ Google Earth åªæ”¯æŒ KML æ ¼å¼å¯¼å…¥ã€‚æ‰€ä»¥ï¼Œæˆ‘å‡†å¤‡åšä¸€ä¸ª GPS æ•°æ®æ ¼å¼è½¬æ¢å·¥å…·ï¼Œä½¿ç”¨ Pythonï¼Œåšä¸€ä¸ªåŸºäºå‘½ä»¤è¡Œçš„å·¥å…·ã€‚\n1. GPX #GPXï¼ˆGPS eXchange Formatï¼ŒGPSäº¤æ¢æ ¼å¼ï¼‰æ˜¯ä¸€ä¸ªXMLæ ¼å¼ï¼Œå®ƒå¯ä»¥ç”¨æ¥æè¿°è·¯ç‚¹ã€è½¨è¿¹ã€è·¯ç¨‹ã€‚è¿™ä¸ªæ ¼å¼æ˜¯å…è´¹çš„ï¼Œå¯ä»¥åœ¨ä¸éœ€è¦ä»˜ä»»ä½•è®¸å¯è´¹ç”¨çš„å‰æä¸‹ä½¿ç”¨ã€‚å®ƒçš„æ ‡ç­¾ä¿å­˜ä½ç½®ï¼Œæµ·æ‹”å’Œæ—¶é—´ã€‚\nåœ¨GPXä¸­ï¼Œä¸€ä¸ªæ²¡æœ‰é¡ºåºå…³ç³»çš„ç‚¹é›†åˆï¼Œå«è·¯ç‚¹ã€‚ä¸€ä¸ªæœ‰é¡ºåºçš„ç‚¹çš„é›†åˆå«è½¨è¿¹æˆ–è€…è·¯ç¨‹ã€‚è½¨è¿¹æ˜¯ä¸€ä¸ªäººæ›¾ç»èµ°è¿‡çš„è®°å½•ï¼Œè·¯ç¨‹æ˜¯ä¸€ä¸ªå»ºè®®çš„ä¸‹ä¸€æ­¥è¦èµ°çš„åœ°æ–¹ã€‚æ‰€ä»¥ï¼Œä¸€èˆ¬æ¥è®²ï¼Œè½¨è¿¹é‡Œçš„ç‚¹ï¼ŒåŒ…å«æ—¶é—´ä¿¡æ¯ï¼Œè·¯ç¨‹é‡Œçš„ç‚¹ï¼Œæ²¡æœ‰æ—¶é—´ä¿¡æ¯ã€‚\næœ€å°çš„ä¸€ä¸ªGPXæ–‡ä»¶ï¼Œä»…ä»…åŒ…å«ä¸€ä¸ªç»çº¬åº¦åæ ‡çš„ç‚¹ï¼Œå…¶å®ƒçš„éƒ½æ˜¯å¯é€‰çš„ã€‚\nGPX 1.1 : http://www.topografix.com/GPX/1/1/\n2. CSV #CSV ï¼ˆComma-Separated Valuesï¼Œé€—å·åˆ†éš”å€¼ï¼‰ æ–‡ä»¶æ ¼å¼å¹¶æ²¡æœ‰é€šç”¨çš„æ ‡å‡†ï¼Œå…¶æ–‡ä»¶ä»¥çº¯æ–‡æœ¬å½¢å¼å­˜å‚¨è¡¨æ ¼æ•°æ®ï¼ˆæ•°å­—å’Œæ–‡æœ¬ï¼‰ã€‚çº¯æ–‡æœ¬æ„å‘³ç€è¯¥æ–‡ä»¶æ˜¯ä¸€ä¸ªå­—ç¬¦åºåˆ—ï¼Œä¸å«å¿…é¡»åƒäºŒè¿›åˆ¶æ•°å­—é‚£æ ·è¢«è§£è¯»çš„æ•°æ®ã€‚CSV æ–‡ä»¶ç”±ä»»æ„æ•°ç›®çš„è®°å½•ç»„æˆï¼Œè®°å½•é—´ä»¥æŸç§æ¢è¡Œç¬¦åˆ†éš”ï¼›æ¯æ¡è®°å½•ç”±å­—æ®µç»„æˆï¼Œå­—æ®µé—´çš„åˆ†éš”ç¬¦æ˜¯å…¶å®ƒå­—ç¬¦æˆ–å­—ç¬¦ä¸²ï¼Œæœ€å¸¸è§çš„æ˜¯é€—å·æˆ–åˆ¶è¡¨ç¬¦ã€‚CSV æ–‡ä»¶æ˜¯çº¯æ–‡æœ¬æ–‡ä»¶ï¼Œä½†æ˜¯å¯ä»¥ç›´æ¥ç”¨ Office Excel è½¯ä»¶æ‰“å¼€ã€‚\nä¸‹å›¾æ˜¯ä¸€ä¸ª CSV æ ¼å¼çš„ GPS è½¨è¿¹æ•°æ®æ–‡ä»¶ï¼Œæ¯æ¡è®°å½•æœ‰ä¸‰ä¸ªå­—æ®µï¼Œåˆ†åˆ«è¡¨ç¤ºç»åº¦ã€çº¬åº¦ã€æµ·æ‹”ã€‚ï¼ˆæ³¨ï¼šåŒ—çº¬ä¸ºæ­£ï¼Œå—çº¬ä¸ºè´Ÿï¼Œä¸œç»ä¸ºæ­£ï¼Œè¥¿ç»ä¸ºè´Ÿï¼‰\nå¯¹ CSV æ•°æ®è¯»å†™å¯ä»¥ç›´æ¥è°ƒç”¨ Python çš„ csv æ¨¡å— ï¼šhttps://docs.python.org/2/library/csv.html\ncsv æ¨¡å—å®šä¹‰äº†å¦‚ä¸‹å‡ ä¸ªå‡½æ•°ï¼š\ncsv.reader(csvfile, dialect=\u0026lsquo;excel\u0026rsquo;, **fmtparams)\næ”¹å‡½æ•°ä¼šéå† csvfile ä¸­çš„æ¯ä¸€è¡Œï¼Œç„¶åè¿”å›ä¸€ä¸ª reader å¯¹è±¡ï¼Œ csvfile å¯ä»¥æ˜¯ä»»ä½•æ”¯æŒ iterator åè®®çš„å¯¹è±¡ï¼Œæ¯æ¬¡è°ƒç”¨å®ƒçš„ next() æ–¹æ³•éƒ½ä¼šè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚\n3. KML #KML ä¹Ÿæ˜¯åŸºäº XML è¯­æ³•çš„æ ‡è®°è¯­è¨€ï¼Œæ˜¯ Google Earth ç‰¹æœ‰çš„æ ¼å¼ï¼Œå®ƒä¸ä»…å¯ä»¥è®°å½• GPS è½¨è¿¹ï¼Œè¿˜å¯ä»¥æ ‡è®°å¾ˆå¤šåœ°ç†æ•°æ®ï¼ŒåŒ…æ‹¬ç‚¹ã€çº¿ã€é¢ã€å¤šè¾¹å½¢ã€å¤šé¢ä½“ç­‰ç­‰ã€‚\n","date":"2015 September 8","permalink":"/posts/2015/09/08/","section":"Posts","summary":"å¸¸è§çš„ GPS æ•°æ®æ–‡ä»¶æ ¼å¼æœ‰ GPSã€CVSã€KML ç­‰ï¼Œè¿™äº›æ•°æ®æ ¼å¼æœ¬èº«å¹¶ä¸å¤æ‚ï¼ŒåŸºæœ¬éƒ½æ˜¯å¯¹åæ ‡ç‚¹çš„é›†åˆï¼Œå¤§éƒ¨åˆ† GPS è®°å½•ä»ªéƒ½æ”¯æŒå¤šç§æ ¼å¼çš„æ•°æ®æ–‡ä»¶çš„å¯¼å…¥å’Œå¯¼å‡ºã€‚ä½†æ˜¯æœ‰æ—¶è¿˜æ˜¯éœ€è¦åšæ ¼å¼è½¬æ¢ï¼Œæ¯”å¦‚ Google Earth åªæ”¯æŒ KML æ ¼å¼å¯¼å…¥ã€‚æ‰€ä»¥ï¼Œæˆ‘å‡†å¤‡åšä¸€ä¸ª GPS æ•°æ®æ ¼å¼è½¬æ¢å·¥å…·ï¼Œä½¿ç”¨ Pythonï¼Œåšä¸€ä¸ªåŸºäºå‘½ä»¤è¡Œçš„å·¥å…·ã€‚","title":"ç”¨ Python è§£æ GPS è½¨è¿¹æ•°æ®"},{"content":" Keep an eye on what is happening on your machine and in the World\nhttp://tracesof.net/uebersicht/\nAt a Glance #Ãœbersicht lets you run system commands and display their output on your desktop in little containers, called widgets. Widgets are written using HTML5, which means they\nare easy to write and customize can show data in tables, charts, graphs \u0026hellip; you name it can react to different screen sizes The following screenshots give you a glimpse of Ãœbersicht in action:\nRolling your own #Widgets are written in CoffeeScript or plain JavaScript. A minimal widget, written in CoffeeScript looks like this:\ncommand: \u0026quot;echo Hello World!\u0026quot; refreshFrequency: 5000 # ms render: (output) -\u0026gt; \u0026quot;\u0026lt;h1\u0026gt;#{output}\u0026lt;/h1\u0026gt;\u0026quot; style: \u0026quot;\u0026quot;\u0026quot; left: 20px top: 20px color: #fff \u0026quot;\u0026quot;\u0026quot; Please visit the GitHub page for the full documentation : https://github.com/felixhageloh/uebersicht\n","date":"2015 August 29","permalink":"/posts/2015/08/29/","section":"Posts","summary":"Keep an eye on what is happening on your machine and in the World","title":"å¯è‡ªå®šä¹‰çš„ Mac æ¡Œé¢æ‰©å±• UÌˆbersicht"},{"content":"About #http://freegeoip.net provides a public HTTP API for software developers to search the geolocation of IP addresses. It uses a database of IP addresses that are associated to cities along with other relevant information like time zone, latitude and longitude.\nYou\u0026rsquo;re allowed up to 10,000 queries per hour by default. Once this limit is reached, all of your requests will result in HTTP 403, forbidden, until your quota is cleared.\nThe freegeoip web server is free and open source so if the public service limit is a problem for you, download it and run your own instance.\nAPI #The HTTP API takes GET requests in the following schema:\nfreegeoip.net/{format}/{IP_or_hostname} Supported formats are: csv, xml, json and jsonp. If no IP or hostname is provided, then your own IP is looked up.\nExamples # CSV\nfreegeoip.net/csv/8.8.8.8 XML\nfreegeoip.net/xml/4.2.2.2 JSON\nfreegeoip.net/json/github.com è¦è·å–æœ¬æœºçš„å…¬ç½‘ IP å¯ä»¥ç”¨ http://httpbin.org æä¾›çš„æœåŠ¡ã€‚åœ¨ Linux ä¸­åªéœ€ curl http://httpbin.org/ip å³å¯è¿”å›æœ¬æœºçš„å…¬ç½‘ IP ï¼š\n~$ curl http://httpbin.org/ip { \u0026quot;origin\u0026quot;: \u0026quot;218.18.232.122\u0026quot; } å…¶ä»–ç±»ä¼¼åŠŸèƒ½çš„ç½‘ç«™è¿˜æœ‰ï¼š\nhttp://ip-api.com/ https://ipstack.com/ ","date":"2015 August 22","permalink":"/posts/2015/08/22/","section":"Posts","summary":"About #http://freegeoip.","title":"è·å¾— IP æ‰€åœ¨åœ°çš„ç½‘ç«™ freegeoip.net"},{"content":"1. MQTT ä»‹ç» #http://mqtt.org/\nMQTT æ˜¯ä¸€ä¸ªè½»å‹åè®®ï¼Œä½¿ç”¨åŸºäº TCP/IP åè®®çš„å‘å¸ƒ/è®¢é˜…æ¶ˆæ¯è½¬å‘æ¨¡å¼ï¼Œä¸“é—¨ç”¨äºæœºå™¨å¯¹æœºå™¨ (M2M) é€šä¿¡ã€‚ MQTT åè®®çš„ä¸­å¿ƒæ˜¯ MQTT æœåŠ¡å™¨æˆ–ä»£ç† (broker) ï¼Œæ”¯æŒå‘å¸ƒç¨‹åºå’Œè®¢é˜…ç¨‹åºè¿›è¡Œè®¿é—®ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\nç”¨æˆ·å¯ä»¥ä½¿ç”¨ MQTT æ„å»ºä¸€ä¸ªä¼ æ„Ÿå™¨ç½‘ç»œï¼Œå…¶ä¸­å„ç§ä¼ æ„Ÿå™¨éƒ½èƒ½å¤Ÿä»¥å…¶ä¼ æ„Ÿå™¨ç‹¬æœ‰çš„æ¶ˆæ¯å½¢å¼å‘å¸ƒä¼ æ„Ÿå™¨å€¼ã€‚ è®¢é˜…ç¨‹åºèƒ½å¤Ÿè®¢é˜…ä¸åŒçš„æ¶ˆæ¯ï¼Œä»¥æ®æ­¤é‡‡å–æªæ–½ã€‚ MQTT ä»£ç†å°†å¤„ç†ä»å‘å¸ƒç¨‹åºåˆ°è®¢é˜…ç¨‹åºçš„è½¬å‘æ¶ˆæ¯ã€‚\nå¦‚æœå·²ç»æœ‰äº†ä¸€ä¸ª broker ï¼Œå¯ä»¥ç›´æ¥ç”¨ MQTT å®¢æˆ·ç«¯è½¯ä»¶æµ‹è¯•ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªè·¨å¹³å°çš„ MQTT å®¢æˆ·ç«¯ MQTT.fx ã€‚\n2. Mosquitto #mosquitto æ˜¯ä¸€ä¸ªå¼€æºçš„ MQTT broker ï¼Œç›®å‰æ”¯æŒ v3.1 å’Œ v3.1.1 åè®® ï¼ŒåŒæ—¶æä¾›äº†ä¸€ä¸ª C è¯­è¨€åŠ¨æ€é“¾æ¥åº“ libmosquitto ï¼Œç”¨äºå®ç° mqtt å®¢æˆ·ç«¯ï¼š\nhttp://mosquitto.org/documentation/\nä¸‹è½½ mosquitto-1.4.2.tar.gz åï¼Œè§£å‹ï¼Œç„¶åæ‰§è¡Œ make ï¼Œmake install ã€‚å³å¯å¾—åˆ°å‡ ä¸ªäºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ï¼š\nmosquitto : mqtt broker mosquitto_passwd : ç®¡ç† mosquitto å¯†ç æ–‡ä»¶çš„å‘½ä»¤è¡Œå·¥å…· mosquitto_sub : mqtt è®¢é˜…è€…ç¨‹åº mosquitto_pub ï¼š mqtt å‘å¸ƒè€…ç¨‹åº ç›¸å…³çš„é…ç½®æ–‡ä»¶å®‰è£…åœ¨ /etc/mosquitto/ ç›®å½•ä¸‹ã€‚åœ¨ Ubuntu ä¸‹å¯ä»¥ç›´æ¥å®‰è£… sudo apt-get install mosquitto ã€‚\nç°åœ¨æµ‹è¯•ä¸€ä¸‹å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ç¨‹åºã€‚ä¸ºäº†æµ‹è¯•æ–¹ä¾¿ï¼Œå°†å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ç¨‹åºéƒ½åœ¨æœ¬æœºï¼Œä½¿ç”¨ localhost è¿æ¥ã€‚æ‰§è¡Œ mosquitto -v å¯åŠ¨ broker ï¼Œ-v å‚æ•°è¡¨ç¤ºæ‰“å°å‡ºè¿è¡Œä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°é»˜è®¤ä½¿ç”¨çš„ç«¯å£æ˜¯1883 :\nå¦‚æœä½ çš„ç³»ç»Ÿå‡ºç°å¦‚ä¸‹é—®é¢˜ï¼Œå°±éœ€è¦æ·»åŠ ä¸€ä¸ª mosquitto ç”¨æˆ·ï¼š\nå¯ä»¥ä½¿ç”¨ systemd è®© mosquitto è‡ªåŠ¨å¯åŠ¨ï¼Œæ·»åŠ å¦‚ä¸‹é…ç½®æ–‡ä»¶ï¼š\nubuntu@VM-231-137-ubuntu:/etc/systemd/system$ cat mosquitto.service [Unit] Description=Mosquitto MQTT Broker ConditionPathExists=/etc/mosquitto/mosquitto.conf After=network.target [Service] ExecStart=/usr/local/sbin/mosquitto -c /etc/mosquitto/mosquitto.conf ExecReload=/bin/kill -HUP $MAINPID User=mosquitto Restart=on-failure RestartSec=10 [Install] WantedBy=multi-user.target ç„¶ååœ¨ç¬¬äºŒä¸ªç»ˆç«¯å¯åŠ¨è®¢é˜…è€…ç¨‹åº: mosquitto_sub -h localhost -t test -vï¼Œç”¨ -h å‚æ•°æŒ‡å®šæœåŠ¡å™¨ IP ï¼Œç”¨ -t å‚æ•°æŒ‡å®šè®¢é˜…çš„è¯é¢˜ã€‚\nåœ¨ç¬¬ä¸‰ä¸ªç»ˆç«¯å¯åŠ¨å‘å¸ƒè€…ç¨‹åº: mosquitto_pub -h localhost -t test -m \u0026quot;Hello world\u0026quot;ï¼Œç”¨ -m å‚æ•°æŒ‡å®šè¦å‘å¸ƒçš„ä¿¡æ¯å†…å®¹ï¼Œç„¶ååœ¨è®¢é˜…è€…çš„ç»ˆç«¯å°±å¯ä»¥çœ‹åˆ°ç”± broker æ¨é€çš„ä¿¡æ¯ï¼š\nåœ¨ broker çš„ç»ˆç«¯ä¹Ÿå¯ä»¥çœ‹åˆ°å¤„ç†ä¿¡æ¯çš„è¿‡ç¨‹ï¼š\nmosquitto è¯­æ³•æ˜¯\nmosquitto [-c config file] [ -d | --daemon ] [-p port number] [-v] -c æ˜¯æŒ‡å®šé…ç½®æ–‡ä»¶çš„è·¯å¾„ï¼Œé»˜è®¤ä¸éœ€è¦é…ç½®æ–‡ä»¶ã€‚ -d è¡¨ç¤ºä½œä¸ºå®ˆæŠ¤è¿›ç¨‹è¿è¡Œåœ¨åå°ã€‚ -p ç”¨æ¥æŒ‡å®šç›‘å¬çš„ç«¯å£ï¼Œé»˜è®¤æ˜¯ 1883 ï¼Œä½¿ç”¨ TCP è¿æ¥ï¼Œå¦‚æœè¦ä½¿ç”¨ UDP è¿æ¥ï¼Œéœ€è¦è®¾ä¸º 1884ã€‚ -v è¡¨ç¤ºç”Ÿæˆè¯¦ç»†çš„è¿è¡Œæ—¥å¿—ï¼Œç­‰ä»·äºé…ç½®æ–‡ä»¶ä¸­å°† log_type è®¾ä¸º all ã€‚ mosquitto é»˜è®¤æ˜¯ä¸éœ€è¦é…ç½®æ–‡ä»¶çš„ï¼Œå®ƒä¼šå¯¹æ‰€æœ‰çš„é€‰é¡¹é‡‡ç”¨é»˜è®¤å€¼ï¼Œæ¯”å¦‚ç”¨æˆ·åå’Œå¯†ç ã€‚é»˜è®¤ä¸éœ€è¦ç”¨æˆ·åå’Œå¯†ç ï¼Œå¦‚æœéœ€è¦ï¼Œå¯ä»¥ç”¨ mosquitto_passwd æ–°å»ºç”¨æˆ·å’Œå¯†ç ï¼Œå¹¶ç®¡ç†ï¼Œè¯­æ³•æ˜¯ï¼š\nmosquitto_passwd [ -c | -D ] passwordfile username mosquitto_passwd -b passwordfile username password mosquitto_passwd -U passwordfile -c è¡¨ç¤ºæ–°å»ºä¸€ä¸ªå¯†ç æ–‡ä»¶ï¼Œå¦‚æœæ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œä¼šè¢«è¦†ç›–ï¼Œç”¨æˆ·åä¸­ä¸èƒ½åŒ…å«å†’å·ï¼Œå› ä¸ºå¯†ç æ–‡ä»¶ä¸­ç”¨æˆ·åå’Œå¯†ç æ˜¯ç”¨å†’å·éš”å¼€çš„ã€‚æ‰§è¡Œä¹‹åä¼šè¦æ±‚è®¾ç½®å¯†ç ï¼Œè¾“å…¥å†…å®¹ä¸å¯è§ï¼Œå¯†ç ä»¥åŠ å¯† hash å€¼çš„æ–¹å¼å­˜å‚¨åœ¨å¯†ç æ–‡ä»¶ä¸­ã€‚ -D è¡¨ç¤ºåˆ é™¤ç”¨æˆ·åã€‚ -b è¡¨ç¤ºåœ¨å‘½ä»¤è¡Œä¸­ï¼Œä»¥æ˜æ–‡æ–¹å¼è®¾ç½®å¯†ç ã€‚ -U ç”¨æ¥å°†å¯†ç æ–‡ä»¶ä¸­çš„æ˜æ–‡å¯†ç æ”¹æˆåŠ å¯†æ ¼å¼ã€‚å¦‚æœæ–‡ä»¶ä¸­çš„å¯†ç å·²ç»æ˜¯ hash å€¼ï¼Œåƒä¸‡ä¸è¦ç”¨è¿™ä¸ªé€‰é¡¹ï¼Œå¦åˆ™å®ƒä¼šå¯¹ hash å€¼å†åšä¸€æ¬¡è¿ç®—ï¼Œç„¶åä¿®æ”¹å¯†ç æ–‡ä»¶ã€‚ è®¾å¥½å¯†ç åï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½® allow_anonymous false å†ç”¨ password_file æŒ‡å®šå¯†ç æ–‡ä»¶çš„è·¯å¾„å°±å¯ä»¥ä½¿ç”¨äº†ã€‚é…ç½®æ–‡ä»¶å¯ä»¥æ”¾åœ¨ä»»ä½•ä½ç½®ï¼Œåªè¦ mosquitt èƒ½æ‰¾åˆ°å®ƒã€‚é…ç½®æ–‡ä»¶ä¸­ï¼Œæ¯ä¸€è¡Œè®¾ç½®ä¸€ä¸ªé€‰é¡¹ï¼Œé€‰é¡¹åç§°å’Œå€¼ç”¨ç©ºæ ¼éš”å¼€ï¼Œç”¨äº•å·å¯ä»¥æ³¨é‡Šã€‚å®‰è£…å¥½çš„ mosquitto åœ¨ /etc/mosquitto/ ç›®å½•ä¸‹æœ‰é…ç½®æ–‡ä»¶å’Œå¯†ç æ–‡ä»¶çš„ä¾‹å­ï¼Œå¤åˆ¶ä¸€ä»½çš†å¯ä½¿ç”¨ï¼š\n$ ls /etc/mosquitto/ aclfile.example mosquitto.conf.example pskfile.example pwfile.example å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡è®¢é˜… $SYS å±‚çš„ä¸»é¢˜æ¥è·å– broker çš„ä¿¡æ¯ï¼Œè¿™äº›ä¸»é¢˜æ¯ sys_interval ç§’æ›´æ–°ä¸€æ¬¡ï¼Œå¦‚æœ sys_interval è®¾ä¸º 0 åˆ™ä¸ä¼šå‘é€ï¼Œæ ‡è®°ä¸º static çš„ä¸»é¢˜åªä¼šä¸ºæ¯ä¸ªè®¢é˜…è€…å‘é€ä¸€æ¬¡ã€‚å¦‚æœæ˜¯åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨ï¼Œè¦ç”¨åæ–œæ æŠŠ $SYS ä½œä¸ºæ™®é€šå­—ç¬¦ä¸²ä¼ é€’ç»™å®¢æˆ·ç«¯ï¼Œå¦åˆ™ $SYS ä¼šè¢«å½“åšç¯å¢ƒå˜é‡æ¥å¤„ç†ã€‚\n$SYS/broker/bytes/received ï¼Œbroker ä»å¯åŠ¨å¼€å§‹æ”¶åˆ°çš„æ€»å­—èŠ‚æ•°ã€‚ $SYS/broker/bytes/sent ï¼Œbroker ä»å¯åŠ¨å¼€å§‹å‘é€çš„æ€»å­—èŠ‚æ•°ã€‚ $SYS/broker/clients/connected, $SYS/broker/clients/active (ä¸å»ºè®®ä½¿ç”¨)ï¼Œå½“å‰è¿æ¥çš„å®¢æˆ·ç«¯æ•°ç›®ã€‚ $SYS/broker/clients/expired ï¼Œç”±äº persistent_client_expiration é€‰é¡¹è¿‡æœŸè€Œæ–­å¼€çš„å®¢æˆ·ç«¯æ•°é‡ã€‚ $SYS/broker/clients/disconnected, $SYS/broker/clients/inactive (ä¸å»ºè®®ä½¿ç”¨)ï¼Œæ‰€æœ‰æ–­å¼€çš„å·²æ³¨å†Œå®¢æˆ·ç«¯ï¼ˆåŒ…æ‹¬æ¸…é™¤è¿›ç¨‹ï¼‰çš„æ•°é‡ã€‚ $SYS/broker/clients/maximum ï¼Œè¿‡å»æ‰€æœ‰æ—¶é—´æ‰€è¿æ¥çš„æœ€å¤§å®¢æˆ·ç«¯æ•°é‡ï¼ˆä»æœåŠ¡å™¨å¼€æœºå¼€å§‹ï¼‰ã€‚ $SYS/broker/clients/total ï¼Œæ‰€æœ‰è¿æ¥è¿‡çš„å®¢æˆ·ç«¯æ•°é‡(åŒ…æ‹¬æ´»è·ƒçš„å®¢æˆ·ç«¯å’Œå·²ç»æ–­å¼€çš„å®¢æˆ·ç«¯æ•°é‡)ã€‚ $SYS/broker/connection/# ï¼Œå½“ä»£ç†æœåŠ¡å™¨è¢«é…ç½®ä¸ºæ¡¥æ¥æ¨¡å¼çš„æ—¶å€™, é€šå¸¸åšæ³•æ˜¯æä¾›ä¸€ç§çŠ¶æ€è¯é¢˜æ¥åªæ˜¯è¿æ¥çš„çŠ¶æ€ï¼Œè¿™ä¸ªè¯é¢˜é»˜è®¤ä¸º $SYS/broker/connection/ï¼Œ å¦‚æœæ•°å€¼ä¸º1ï¼Œè¯æ˜è¿æ¥æ˜¯æ´»è·ƒçš„,ä¸º0è¯æ˜è¿æ¥ä¸æ´»è·ƒ. æŸ¥çœ‹æ¡¥æ¥ä¸€èŠ‚æ¥è·å–æ›´å¤šä¿¡æ¯ã€‚ $SYS/broker/heap/current size ï¼Œmosquitto å½“å‰ä½¿ç”¨çš„æœ€å¤§å†…å­˜ï¼Œè¯·æ³¨æ„ï¼Œç”±äºç¼–è¯‘æ—¶å€™çš„é€‰æ‹©è¿™ä¸ªè¯é¢˜å¯èƒ½ä¸å¯ç”¨ã€‚ $SYS/broker/heap/maximum size ï¼Œmosquitto æ›¾ç»ä½¿ç”¨çš„æœ€å¤§å†…å­˜ï¼Œè¯·æ³¨æ„ï¼Œç”±äºç¼–è¯‘æ—¶å€™çš„é€‰æ‹©è¿™ä¸ªè¯é¢˜å¯èƒ½ä¸å¯ç”¨ã€‚ $SYS/broker/load/connections/+ ï¼Œä¸åŒçš„æ—¶é—´é—´éš”å†…ä»£ç†æœåŠ¡å™¨æ”¶åˆ°è¿æ¥æ•°æ®åŒ…çš„å¹³å‡æ•°é‡ï¼Œ æœ€åçš„+å¯ä»¥ä¸º 5åˆ†é’Ÿã€10åˆ†é’Ÿã€15åˆ†é’Ÿã€‚ $SYS/broker/load/bytes/received/+ ï¼Œä¸åŒçš„æ—¶é—´é—´éš”å†…ä»£ç†æœåŠ¡å™¨æ”¶åˆ°çš„å¹³å‡æ¯”ç‰¹æ•°ï¼Œ æœ€åçš„+å¯ä»¥ä¸º 5åˆ†é’Ÿã€10åˆ†é’Ÿã€15åˆ†é’Ÿã€‚ $SYS/broker/load/bytes/sent/+ ï¼Œä¸åŒçš„æ—¶é—´é—´éš”å†…ä»£ç†æœåŠ¡å™¨å‘é€çš„å¹³å‡æ¯”ç‰¹æ•°ï¼Œ æœ€åçš„+å¯ä»¥ä¸º 5åˆ†é’Ÿã€10åˆ†é’Ÿã€15åˆ†é’Ÿã€‚ $SYS/broker/load/messages/received/+ ï¼Œä¸åŒçš„æ—¶é—´é—´éš”å†…ä»£ç†æœåŠ¡å™¨æ”¶åˆ°å„ç§ç±»å‹æ•°æ®åŒ…çš„å¹³å‡æ•°é‡ï¼Œ æœ€åçš„+å¯ä»¥ä¸º 5åˆ†é’Ÿã€10åˆ†é’Ÿã€15åˆ†é’Ÿã€‚ $SYS/broker/load/messages/sent/+ ï¼Œä¸åŒçš„æ—¶é—´é—´éš”å†…ä»£ç†æœåŠ¡å™¨å‘é€å„ç§ç±»å‹æ•°æ®åŒ…çš„å¹³å‡æ•°é‡ï¼Œ æœ€åçš„+å¯ä»¥ä¸º 5åˆ†é’Ÿã€10åˆ†é’Ÿã€15åˆ†é’Ÿã€‚ $SYS/broker/load/publish/dropped/+ ï¼Œä¸åŒçš„æ—¶é—´é—´éš”å†…ä»£ç†æœåŠ¡å™¨å‘å¸ƒæ•°æ®åŒ…ä¸¢å¤±çš„æ•°é‡ï¼Œ æœ€åçš„+å¯ä»¥ä¸º 5åˆ†é’Ÿã€10åˆ†é’Ÿã€15åˆ†é’Ÿã€‚ $SYS/broker/load/publish/received/+ ï¼Œä¸åŒçš„æ—¶é—´é—´éš”å†…ä»£ç†æœåŠ¡å™¨å‘å¸ƒæ•°æ®åŒ…è¢«æ”¶åˆ°çš„å¹³å‡æ•°é‡ï¼Œ æœ€åçš„+å¯ä»¥ä¸º 5åˆ†é’Ÿã€10åˆ†é’Ÿã€15åˆ†é’Ÿã€‚ $SYS/broker/load/publish/sent/+ ï¼Œä¸åŒçš„æ—¶é—´é—´éš”å†…ä»£ç†æœåŠ¡å™¨å‘å¸ƒçš„æ•°æ®åŒ…è¢«å‘é€çš„å¹³å‡æ•°é‡ï¼Œ æœ€åçš„+å¯ä»¥ä¸º 5åˆ†é’Ÿã€10åˆ†é’Ÿã€15åˆ†é’Ÿã€‚ $SYS/broker/load/sockets/+ ï¼Œä¸åŒçš„æ—¶é—´é—´éš”å†…ä»£ç†æœåŠ¡å™¨æ‰“å¼€socketè¿æ¥å¹³å‡æ•°é‡ï¼Œ æœ€åçš„+å¯ä»¥ä¸º 5åˆ†é’Ÿã€10åˆ†é’Ÿã€15åˆ†é’Ÿã€‚ $SYS/broker/messages/inflight ï¼Œå…·æœ‰QoS\u0026gt;0æ­£åœ¨ç­‰å¾…çš„ç¡®è®¤æ¶ˆæ¯çš„æ•°é‡ã€‚ $SYS/broker/messages/received ï¼Œä»ä»£ç†æœåŠ¡å™¨å¼€æœºå¼€å§‹æ”¶åˆ°çš„æ¶ˆæ¯æ€»æ•°ã€‚ $SYS/broker/messages/sent ï¼Œä»æœåŠ¡å™¨å¼€æœºå¼€å§‹æ‰€å‘é€çš„å„ç§ç±»å‹æ¶ˆæ¯çš„æ€»æ•°ã€‚ $SYS/broker/messages/stored ï¼Œåœ¨æ¶ˆæ¯å­˜å‚¨æœºåˆ¶ä¸­ä¿ç•™çš„æ¶ˆæ¯æ€»æ•°ï¼ŒåŒ…æ‹¬å®¢æˆ·ç«¯ä¿ç•™æ¶ˆæ¯å’ŒæŒä¹…å®¢æˆ·ç«¯çš„é˜Ÿåˆ—æ¶ˆæ¯ã€‚ $SYS/broker/publish/messages/dropped ï¼Œ ç”±äºé˜Ÿåˆ—æœºåˆ¶æˆ–è€…ä¼ è¾“é™åˆ¶æ‰€ä¸¢å¼ƒæ•°æ®åŒ…çš„æ•°é‡. å‚ç…§mosquitto.conf çš„ max_inflight_messages å’Œ max_queued_messages é€‰é¡¹è·å–æ›´å¤šè§£é‡Šã€‚ $SYS/broker/publish/messages/received ï¼Œä»ä»£ç†æœåŠ¡å™¨å¼€æœºå¼€å§‹å‘å¸ƒçš„ä¿¡æ¯è¢«æ”¶åˆ°æ€»æ•°ã€‚ $SYS/broker/publish/messages/sent ï¼Œä»ä»£ç†æœåŠ¡å™¨å¼€æœºå¼€å§‹å‘å¸ƒçš„ä¿¡æ¯æ€»æ•°ã€‚ $SYS/broker/retained messages/count ï¼Œä»£ç†æœåŠ¡å™¨ä¸­æ´»è·ƒçš„ä¿ç•™æ¶ˆæ¯çš„æ€»æ•°ã€‚ $SYS/broker/subscriptions/count ï¼Œä»£ç†æœåŠ¡å™¨ä¸­æ´»è·ƒçš„è®¢é˜…çš„æ€»æ•°ã€‚ $SYS/broker/timestamp ï¼Œä»£ç†æœåŠ¡å™¨ç¼–è¯‘çš„æ—¶é—´æˆ³. Static. $SYS/broker/uptime ï¼ŒæœåŠ¡å™¨åˆè®¡åœ¨çº¿æ—¶é—´ï¼ˆä»¥ç§’è®¡ï¼‰ã€‚ $SYS/broker/version ï¼Œä»£ç†æœåŠ¡å™¨ç‰ˆæœ¬. Static. 3. å®‰å…¨æ€§ #MQTT åè®®æ²¡æœ‰å¯¹å®‰å…¨æ€§è®¾ç½®å¼ºåˆ¶æ ‡å‡†ï¼Œåªæ˜¯åœ¨ç¬¬äº”ç« æå‡ºäº†å»ºè®®ï¼Œæä¾›åˆé€‚çš„å®‰å…¨åŠŸèƒ½æ˜¯å®ç°è€…çš„è´£ä»»ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œmosquitto ä¸éœ€è¦ä»»ä½•éªŒè¯ï¼Œç”¨æˆ·å¯ä»¥åŒ¿åè¿æ¥ã€‚å¦‚æœè®¾ç½®äº† allow_anonymous false ï¼Œå®¢æˆ·ç«¯å¿…é¡»æä¾›æ­£ç¡®çš„ç”¨æˆ·åå’Œå¯†ç è¿›è¡ŒéªŒè¯ï¼Œè¿æ¥æ—¶åº”è¯¥å°†ç”¨æˆ·åå’Œå¯†ç åŠ å¯†ä¼ è¾“ï¼Œå¦åˆ™æœ‰è¢«æ‹¦æˆªçš„å±é™©ã€‚æ­¤å¤–ï¼Œmosquitto è¿˜æä¾›åŸºäº SSL/TLS è¯ä¹¦çš„å®‰å…¨éªŒè¯ï¼Œä½¿ç”¨ OpenSSL ä½œä¸º SSL/TLS çš„å®ç°ã€‚\n3.1. SSL/TLS #æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªè„šæœ¬https://github.com/owntracks/tools/raw/master/TLS/generate-CA.sh è‡ªå»º CA å¹¶é¢å‘è¯ä¹¦ï¼š\n$ wget https://github.com/owntracks/tools/raw/master/TLS/generate-CA.sh . $ ./generate-CA.sh ç”Ÿæˆçš„æ–‡ä»¶ï¼š\nca.crt ï¼ŒCA æ ¹è¯ä¹¦ localhost.crt ï¼Œmosquitto æœåŠ¡å™¨ä¸Šçš„è¯ä¹¦ localhost.key ï¼Œmosquitto æœåŠ¡å™¨ä¸Šçš„å¯†é’¥ å°†è¿™ä¸‰ä¸ªæ–‡ä»¶å¤åˆ¶åˆ° /etc/mosquitto/certificates/ ç›®å½•ä¸‹ã€‚ç„¶åä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå¼€å¯ SSL/TLS ï¼š\nport 8883 cafile /etc/mosquitto/certificates/ca.crt certfile /etc/mosquitto/certificates/localhost.crt keyfile /etc/mosquitto/certificates/localhost.key require_certificate true å¯åŠ¨ mosquitto :\n$ mosquitto -c /etc/mosquitto/mosquitto.conf -v 1495335112: mosquitto version 1.4.11 (build date 2017-05-20 17:44:03+0800) starting 1495335112: Config loaded from /etc/mosquitto/mosquitto.conf. 1495335112: Opening ipv4 listen socket on port 8883. 1495335112: Opening ipv6 listen socket on port 8883. å†ç”¨æ ¹è¯ä¹¦ä¸ºå®¢æˆ·ç«¯ç”Ÿæˆå¯†é’¥å’Œè¯ä¹¦ï¼š\n$ openssl genrsa -out client.key 2048 $ openssl req -new -out client.csr -key ./client.key $ openssl x509 -req -in client.csr -CA ca.crt -CAkey ca.key -CAserial ./ca.srl -out client.crt -days 3650 -addtrust clientAuth å°†æ ¹è¯ä¹¦ ca.crt ã€å®¢æˆ·ç«¯å¯†é’¥ client.key ã€è¯ä¹¦ client.crt å‘é€ç»™å®¢æˆ·ç«¯ï¼Œæœ¬åœ°æµ‹è¯•çš„è¯ï¼Œç›´æ¥è¿æ¥ localhost :\n$ mosquitto_sub -h localhost -p 8883 -t \\$SYS/broker/bytes/\\# -v --cafile ca.crt --cert client.crt --key client.key $SYS/broker/bytes/received 0 $SYS/broker/bytes/sent 0 å¦‚æœè®¾ç½®äº† require_certificate false ï¼Œå°±æ˜¯ SSL å•å‘è®¤è¯ï¼Œå®¢æˆ·ç«¯åªéœ€æä¾› cafileï¼Œä¹Ÿæ— éœ€è®¾ç½® \u0026ndash;cert å’Œ \u0026ndash;key ã€‚å¦‚æœè®¾ç½®äº† allow_anonymous false ï¼Œè¿˜è¦æä¾›ç”¨æˆ·åå’Œå¯†ç ï¼Œå¦åˆ™ä¼šå®¢æˆ·ç«¯ä¼šæŠ¥é”™ï¼š\n$ mosquitto_sub -h localhost -p 8883 -t \\$SYS/broker/bytes/\\# -v --cafile ca.crt --cert client.crt --key client.key Connection Refused: not authorised. 3.2. WebSockets with SSL/TLS #mosquitto ç¼–è¯‘æ—¶é»˜è®¤æ˜¯ä¸æ”¯æŒ WebSockets çš„ï¼Œéœ€è¦åœ¨ config.mk ä¸­å°† WITH_LIBWEBSOCDETS:=no æ”¹ä¸º yes ã€‚åœ¨é…ç½®æ–‡ä»¶ä¸­è¿½åŠ  WebSockets çš„é€‰é¡¹ï¼Œå¹¶åŠ ä¸Šç”¨æˆ·åå’Œå¯†ç ï¼š\nlistener 8884 protocol websockets password_file /etc/mosquitto/mosquitto.password ç„¶åé‡å¯ mosquitto ã€‚å¯ä»¥åœ¨ http://www.hivemq.com/demos/websocket-client/ é¡µé¢æµ‹è¯•ï¼Œè¿™æ˜¯ä¸€ä¸ª Websockets Client ã€‚è¾“å…¥ mosquitto æœåŠ¡å™¨çš„ IP ã€ç«¯å£ã€ç”¨æˆ·åå’Œå¯†ç ï¼Œå³å¯è¿æ¥ï¼Œç„¶åæ·»åŠ è®¢é˜…è¯é¢˜ï¼š\n4. libmosquitto åº“ #å…³äºå®¢æˆ·ç«¯çš„ç¼–ç¨‹å¯ä»¥å‚è€ƒ mosquitto_sub å’Œ mosquitto_pub çš„æºç ã€‚libmosquitto API æ–‡æ¡£ï¼šhttp://mosquitto.org/api/files/mosquitto-h.html\n4.1. è·å–åº“ç‰ˆæœ¬ #libmosquitto æ˜¯ C è¯­è¨€å…±äº«åº“ï¼Œå¯ä»¥åˆ›å»º MQTT å®¢æˆ·ç«¯ç¨‹åºã€‚æ‰€æœ‰çš„ API å‡½æ•°éƒ½æœ‰ mosquitto_ å‰ç¼€ã€‚\nint mosquitto_lib_version(int *major,int *minor,int *revision); è·å–åº“çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œè¿”å›åˆ°ä¸‰ä¸ªå‚æ•°ä¸­ã€‚\n4.2. åˆå§‹åŒ–å’Œæ¸…é™¤ #int mosquitto_lib_init();\tint mosquitto_lib_cleanup();\tä½¿ç”¨ libmosquitto åº“å‡½æ•°å‰ï¼Œè¦å…ˆè°ƒç”¨ mosquitto_lib_init() åˆå§‹åŒ–ï¼›ä½¿ç”¨ libmosquitto åº“åï¼Œè¦è°ƒç”¨ mosquitto_lib_cleanup() å®Œæˆæ¸…é™¤å·¥ä½œã€‚\n4.3. æ„å»ºå’Œé‡Šæ”¾å®¢æˆ·ç«¯ #struct mosquitto *mosquitto_new(const char *id, bool clean_session, void *userdata);\tæ–°å»ºä¸€ä¸ª mosquitto å®¢æˆ·ç«¯å®ä¾‹ã€‚è°ƒç”¨æˆåŠŸæ—¶ï¼Œè¿”å›ä¸€ä¸ª struct mosquitto æŒ‡é’ˆï¼Œå¤±è´¥æ—¶è¿”å› NULL æŒ‡é’ˆï¼Œå¹¶äº§ç”Ÿé”™è¯¯ä»£ç ï¼Œå¯ä»¥ç”¨ mosquitto_strerror() å‡½æ•°è·å–é”™è¯¯ä»£ç çš„å«ä¹‰ã€‚ç¬¬ä¸€ä¸ªå‚æ•°éœ€è¦ä¼ é€’ä¸€ä¸ªå­—ç¬¦ä¸²ä½œä¸º client ID ï¼Œå¦‚æœè®¾ä¸º NULL ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªéšæœº ID ã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯å¸ƒå°”å‹ï¼Œå¦‚æœè®¾ä¸º false ï¼Œå½“ client æ–­å¼€è¿æ¥åï¼Œbroker ä¼šä¿ç•™è¯¥ client çš„è®¢é˜…å’Œæ¶ˆæ¯ï¼Œç›´åˆ°å†æ¬¡è¿æ¥æˆåŠŸï¼›å¦‚æœè®¾ä¸º true ï¼Œclient æ–­å¼€è¿æ¥åï¼Œbroker ä¼šå°†æ‰€æœ‰çš„è®¢é˜…å’Œæ¶ˆæ¯åˆ é™¤ã€‚ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ä¼ é€’ç»™å›è°ƒå‡½æ•°çš„ç”¨æˆ·æ•°æ®ã€‚\né‡Šæ”¾ä¸€ä¸ª mosquitto å®¢æˆ·ç«¯å¯¹è±¡ï¼š\nvoid mosquitto_destroy(struct mosquitto *mosq);\tè¿˜ç”¨ä¸€ä¸ªå‡½æ•° mosquitto_reinitialise() å¯ä»¥é‡æ–°åˆå§‹åŒ–ä¸€ä¸ªå·²ç»å­˜åœ¨çš„å®¢æˆ·ç«¯å®ä¾‹ã€‚\n4.4. éªŒè¯å’Œç¼–ç  #å¦‚æœ broker è¦æ±‚æä¾›ç”¨æˆ·åå’Œå¯†ç ï¼Œå¯ä»¥é€šè¿‡å‡½æ•°è®¾ç½®æä¾›ï¼Œç”¨æˆ·åå’Œå¯†ç éƒ½æ˜¯é€šè¿‡å­—ç¬¦ä¸²ä¼ é€’çš„ï¼š\nint mosquitto_username_pw_set(\tstruct mosquitto *\tmosq, const char *username, const char *password ); 4.5. å‘å¸ƒ #int mosquitto_publish(\tstruct mosquitto *mosq, int *mid, const char *topic, int payloadlen, const void *payload, int qos, bool retain\t); å‘å¸ƒä¸€ä¸ªæ¶ˆæ¯ã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ client å®ä¾‹ã€‚ç¬¬äºŒä¸ªå‚æ•°è¦æŒ‡å‘ä¸€ä¸ªæ•´æ•°ï¼Œä¸èƒ½ä¸º NULL ï¼Œå®ƒä¼šè¢«å½“åšè¿™ä¸ªæ¶ˆæ¯çš„ ID ã€‚payloadlen è¡¨ç¤ºæ¶ˆæ¯çš„é•¿åº¦ï¼Œ*playload è¡¨ç¤ºæ¶ˆæ¯çš„å†…å®¹ã€‚ qos è¡¨ç¤ºæœåŠ¡è´¨é‡ï¼Œretain è¡¨ç¤ºæ˜¯å¦ä¿ç•™ä¿¡æ¯ï¼Œè¯¦ç»†å«ä¹‰å¯ä»¥æŸ¥çœ‹ MQTT åè®®çš„ 3.1 èŠ‚ï¼Œå¯¹ PUBLISH æ§åˆ¶æŠ¥æ–‡çš„è¯¦ç»†æè¿°ã€‚\n4.6. è®¢é˜… #int mosquitto_subscribe( struct mosquitto *mosq, int *mid, const char *sub, int qos\t); å‘ broker å‘é€ SUBSCRIBE æŠ¥æ–‡è¯·æ±‚è®¢é˜…ä¸€ä¸ªè¯é¢˜ã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ client å®ä¾‹ã€‚ç¬¬äºŒä¸ªå‚æ•°å¦‚æœä¸ä¸º NULL ï¼Œå‡½æ•°ä¼šæŠŠå®ƒä½œä¸ºè¯¥è¯é¢˜æ¶ˆæ¯çš„ ID ï¼Œå®ƒå¯ä»¥ç”¨äºè®¢é˜…å›è°ƒå‡½æ•°ã€‚ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯è¯é¢˜åç§°ã€‚ç¬¬å››ä¸ªå‚æ•°æ˜¯å‘ broker è¯·æ±‚çš„æœåŠ¡è´¨é‡ï¼š\n0 è¡¨ç¤ºæœ€å¤šåˆ†å‘ä¸€æ¬¡ï¼Œæ¶ˆæ¯çš„åˆ†å‘ä¾èµ–äºåº•å±‚ç½‘ç»œçš„èƒ½åŠ›ã€‚æ¥æ”¶è€…ä¸ä¼šå‘é€å“åº”ï¼Œå‘é€è€…ä¹Ÿä¸ä¼šé‡è¯•ã€‚æ¶ˆæ¯å¯èƒ½é€è¾¾ä¸€æ¬¡ä¹Ÿå¯èƒ½æ ¹æœ¬æ²¡é€è¾¾ã€‚ 1 è¡¨ç¤ºç¡®ä¿æ¶ˆæ¯è‡³å°‘é€è¾¾ä¸€æ¬¡ï¼Œéœ€è¦å‘å¸ƒè€…å’Œè®¢é˜…è€…åŒæ–¹åœ¨æŠ¥æ–‡ä¸­ç¡®è®¤ï¼Œå¯èƒ½é‡å¤ã€‚ 2 è¡¨ç¤ºä»…åˆ†å‘ä¸€æ¬¡ï¼Œè¿™æ˜¯æœ€é«˜ç­‰çº§çš„æœåŠ¡è´¨é‡ï¼Œæ¶ˆæ¯ä¸¢å¤±å’Œé‡å¤éƒ½æ˜¯ä¸å¯æ¥å—çš„ã€‚ä½¿ç”¨è¿™ä¸ªæœåŠ¡è´¨é‡ç­‰çº§ä¼šæœ‰é¢å¤–çš„å¼€é”€ã€‚ è°ƒç”¨æˆåŠŸä¼šè¿”å› MOSQ_ERR_SUCCESS ï¼Œä½†è¿™ä¸ä»£è¡¨è®¢é˜…æˆåŠŸã€‚å…³äºæ¶ˆæ¯è´¨é‡çš„è¯¦æƒ…å¯ä»¥æŸ¥çœ‹ MQTT åè®®çš„ 4.3 èŠ‚ã€‚\nå–æ¶ˆè®¢é˜…çš„å‡½æ•°æ˜¯ï¼š\nint mosquitto_unsubscribe( struct mosquitto *mosq, int *mid, const char *sub, ); 4.7. é—å˜± #ç®€å•çš„è¯´ï¼Œå½“ broker æ£€æµ‹åˆ°ç½‘ç»œæ•…éšœã€å®¢æˆ·ç«¯å¼‚å¸¸ç­‰é—®é¢˜ï¼Œéœ€è¦å…³é—­æŸä¸ªå®¢æˆ·ç«¯çš„è¿æ¥æ—¶ï¼Œå¯ä»¥å‘è¯¥å®¢æˆ·ç«¯å‘å¸ƒä¸€æ¡æ¶ˆæ¯ï¼Œå«åšé—å˜±æ¶ˆæ¯ã€‚é»˜è®¤æ˜¯æ²¡æœ‰é—å˜±æ¶ˆæ¯çš„ï¼Œéœ€è¦ç”¨å‡½æ•°è®¾ç½®é—å˜±æ¶ˆæ¯çš„è¯é¢˜ã€å†…å®¹ã€æœåŠ¡è´¨é‡ç­‰ï¼Œåœ¨è¿æ¥æ—¶ç”±å®¢æˆ·ç«¯å‘Šè¯‰ broker ï¼š\nint mosquitto_will_set(struct\tmosquitto *mosq, const char *topic, int payloadlen, const void *payload, int qos, bool retain ); è¯¥å‡½æ•°å¿…é¡»åœ¨ mosquitto_connect() ä¹‹å‰è°ƒç”¨ã€‚å¯¹åº”çš„æ¸…é™¤é—å˜±çš„å‡½æ•°æ˜¯ï¼š\nint mosquitto_will_clear(struct mosquitto *mosg); 4.8. è¿æ¥å’Œæ–­å¼€ #int mosquitto_connect(\tstruct mosquitto *mosq, const char *host, int port, int keepalive, ); è¿æ¥ä¸€ä¸ª broker ã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ client å®ä¾‹ã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯ broker çš„ IP æˆ–è€… hostname ã€‚ç¬¬ä¸‰å‚æ•°æ˜¯è¿æ¥çš„ç«¯å£ï¼Œé€šå¸¸æ˜¯ 1883 ã€‚ç¬¬å››ä¸ªå‚æ•°æ˜¯ä¿æŒè¿æ¥çš„æ—¶é—´é—´éš”ï¼Œå•ä½æ˜¯ç§’ï¼Œå…³äºè¿™ä¸ªå‚æ•°çš„è¯¦ç»†å«ä¹‰å¯ä»¥æŸ¥çœ‹ MQTT åè®®çš„ CONNECT æŠ¥æ–‡æ ¼å¼ã€‚è¿æ¥æˆåŠŸä¼šè¿”å› MOSQ_ERR_SUCCESS ã€‚\nè¯¥å‡½æ•°è¿˜æœ‰ä¸€äº›æ‰©å±•ï¼Œæ¯”å¦‚å¯ä»¥ç»‘å®šæœ¬åœ°ç½‘ç»œæ¥å£çš„ mosquitto_connect_bind ã€‚å¦‚æœè°ƒç”¨äº†è¿™ä¸¤ä¸ªå‡½æ•°è¿æ¥ broker ï¼Œå°±å¿…é¡»ä½¿ç”¨ mosquitto_loop() æˆ–è€… mosquitto_loop_forever() å¯åŠ¨ç½‘ç»œå¾ªç¯ã€‚è¿˜æœ‰ä¸€äº›éé˜»å¡çš„è¿æ¥å‡½æ•°ï¼Œä¾‹å¦‚ mosquitto_connect_async()ï¼Œè°ƒç”¨å®ƒä»¬çš„æ—¶å€™ï¼Œå¿…é¡»ä½¿ç”¨ mosquitto_loop_start() å¯åŠ¨ç½‘ç»œå¾ªç¯ã€‚æ–­å¼€è¿æ¥å¯ä»¥è°ƒç”¨ int mosquitto_disconnect(struct mosquitto *mosq) ï¼Œæ­¤å¤–è¿˜æœ‰é‡è¿å‡½æ•° mosquitto_reconnect()ã€‚\n4.9. ç½‘ç»œå¾ªç¯ #int mosquitto_loop(struct mosquitto *mosq, int timeout, int max_packets ); å®¢æˆ·ç«¯ä¸»ç½‘ç»œå¾ªç¯ï¼Œå¿…é¡»è°ƒç”¨è¯¥å‡½æ•°æ¥ä¿æŒ client å’Œ broker ä¹‹é—´çš„é€šè®¯ã€‚æ”¶åˆ°æˆ–è€…å‘é€æ¶ˆæ¯æ—¶ï¼Œå®ƒä¼šè°ƒç”¨ç›¸åº”çš„å›è°ƒå‡½æ•°å¤„ç†ã€‚å½“ QoS\u0026gt;0 æ—¶ï¼Œå®ƒè¿˜ä¼šå°è¯•é‡å‘æ¶ˆæ¯ã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ client å®ä¾‹ã€‚timeout æ˜¯é˜»å¡ç­‰å¾…æ—¶é—´ï¼Œå•ä½æ˜¯å¾®å¦™ï¼Œè®¾ä¸º 0 è¡¨ç¤ºç«‹å³è¿”å›ï¼Œè®¾ä¸ºè´Ÿæ•°è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼ 1000ms ã€‚max_packets ç›®å‰æ²¡æœ‰ä½¿ç”¨ï¼Œè®¾ä¸º 1 å³å¯ã€‚\né€šå¸¸ä¸ä¼šç›´æ¥è°ƒç”¨ mosquitto_loop() ã€‚å¦‚æœç¨‹åºé‡Œåªä¼šè¿è¡Œä¸€ä¸ª MQTT client çš„å¾ªç¯ï¼Œå¯ä»¥è°ƒç”¨ mosquitto_loop_forever() ï¼Œå‚æ•°å®Œå…¨ç›¸åŒ:\nint mosquitto_loop_forever(struct mosquitto *mosq, int timeout, int max_packets ); å®ƒä¼šåœ¨ä¸€ä¸ªé˜»å¡çš„æ— é™å¾ªç¯é‡Œè°ƒç”¨ mosquitto_loop() ï¼Œå¦‚æœä»æœåŠ¡å™¨æ‰çº¿äº†ï¼Œå®ƒä¼šè‡ªåŠ¨é‡è¿ã€‚ç›´åˆ°åœ¨æŸä¸ªå›è°ƒå‡½æ•°ä¸­è°ƒç”¨äº† mosquito_disconnect() ï¼Œè¯¥å‡½æ•°æ‰ä¼šè¿”å›ã€‚\nå¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨ mosquitto_loop_start() ï¼Œè°ƒç”¨ä¸€æ¬¡å°±ä¼šæ–°å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œåœ¨çº¿ç¨‹é‡Œä¸åœçš„è°ƒç”¨ mosquitto_loop() æ¥å¤„ç†ç½‘ç»œä¿¡æ¯ã€‚\nå¦‚æœè¦å°† mosquitto å®¢æˆ·ç«¯æ“ä½œä¸æ‚¨è‡ªå·±çš„ select() è°ƒç”¨é›†æˆï¼Œè¯·ä½¿ç”¨ mosquitto_socket()ï¼Œmosquitto_loop_read()ï¼Œmosquitto_loop_write() å’Œ mosquitto_loop_misc() å‡½æ•°ã€‚\n4.10. å›è°ƒå‡½æ•° #è®¾ç½®ä¸åŒçš„å›è°ƒå‡½æ•°ï¼Œmosquitt_loop() ä¼šæ ¹æ®ä¸åŒçš„æƒ…å†µï¼Œè°ƒç”¨ç›¸åº”çš„å›æ‰å‡½æ•°ã€‚\n####ç¡®è®¤è¿æ¥å›è°ƒå‡½æ•°\nvoid mosquitto_connect_callback_set(struct mosquitto *mosq,\tvoid (*on_connect)(struct mosquitto *mosq, void *obj, int rc) ); å½“ client è¯·æ±‚è¿æ¥åï¼Œbroker ä¼šå›åº”ä¸€æ¡ CONNECK æ¶ˆæ¯ï¼ˆç¡®è®¤è¿æ¥è¯·æ±‚ï¼‰ï¼Œclient æ”¶åˆ°åä¼šè°ƒç”¨å›è°ƒå‡½æ•°ã€‚æˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªå›è°ƒå‡½æ•°é‡Œåˆ¤æ–­è¿æ¥æ˜¯å¦æˆåŠŸï¼ŒæˆåŠŸåå†è°ƒç”¨ mosquitto_subscribe() è®¢é˜…è¯é¢˜ï¼Œå¯ä»¥ä¾æ¬¡è®¢é˜…å¤šä¸ªè¯é¢˜ã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç”¨ mosquitto_new() å‡½æ•°æ–°å»ºçš„ client å®ä¾‹ã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯å›è°ƒå‡½æ•°ã€‚å›è°ƒå‡½æ•°çš„ä¸‰ä¸ªå‚æ•°ï¼š\nmosq ï¼Œclient å®ä¾‹ obj ï¼Œ mosquitto_new() å‡½æ•°æä¾›çš„ç”¨æˆ·æ•°æ® rc ï¼Œbroker å›åº”çš„ä»£ç ï¼Œ0 è¡¨ç¤ºè¿æ¥æˆåŠŸï¼Œå…¶ä»–å€¼è¡¨ç¤ºæ‹’ç»è¿æ¥ï¼Œå¯ä»¥ç”¨ mosquitto_connack_string() å‡½æ•°è·å–ä»£ç çš„å«ä¹‰ã€‚ ####æ–­å¼€è¿æ¥å›è°ƒå‡½æ•°\nvoid mosquitto_disconnect_callback_set(struct mosquitto *mosq, void (*on_disconnect)(struct mosquitto *mosq, void *obj, int rc) ); å½“ client ä¸ broker æ–­å¼€è¿æ¥åï¼Œä¼šè°ƒç”¨è¿™é‡Œè®¾ç½®çš„å‡½æ•°ã€‚å›è°ƒå‡½æ•°ä¸­çš„ rc è¡¨ç¤ºæ–­å¼€è¿æ¥çš„åŸå› ï¼Œ0 è¡¨ç¤º client è°ƒç”¨äº† mosquitt_disconnect() ï¼Œå…¶ä»–å€¼éƒ½è¡¨ç¤ºæœªçŸ¥åŸå› ã€‚æˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªå‡½æ•°é‡Œåˆ¤æ–­å®¢æˆ·ç«¯æ˜¯å¦æ„å¤–æ‰çº¿ã€‚\n####æ¶ˆæ¯å›è°ƒå‡½æ•°\nvoid mosquitto_message_callback_set( struct mosquitto *mosq, void (*on_message)(struct mosquitto *mosq, void *obj, const struct mosquitto_message *message) ); å½“ client æ”¶åˆ° broker å‘æ¥çš„æ¶ˆæ¯æ—¶ä¼šè°ƒç”¨å®ƒã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ client å®ä¾‹ã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯å›è°ƒå‡½æ•°ï¼Œå®ƒçš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯ mosquitto_new() å‡½æ•°æä¾›çš„ç”¨æˆ·æ•°æ®ã€‚ç¬¬ä¸‰ä¸ªå‚æ•°ä¿å­˜äº†æ”¶åˆ°çš„æ¶ˆæ¯ï¼Œå›æ‰å‡½æ•°é€€å‡ºåè¿™ä¸ªæŒ‡é’ˆæŒ‡å‘çš„å†…å­˜å°±ä¼šè¢«é‡Šæ”¾ï¼Œå®ƒçš„å®šä¹‰æ˜¯ï¼š\nstruct mosquitto_message{ int mid; char *topic; //æ¶ˆæ¯è¯é¢˜ void *payload; //æ¶ˆæ¯å†…å®¹ï¼ŒMQTT ä¸­å«åšæœ‰æ•ˆè½½è· int payloadlen; //æ¶ˆæ¯çš„é•¿åº¦ï¼Œå•ä½æ˜¯å­—èŠ‚ int qos; //æœåŠ¡è´¨é‡ bool retain; //æ˜¯å¦ä¿ç•™æ¶ˆæ¯ }; qos å’Œ retain çš„è¯¦ç»†å«ä¹‰å¯ä»¥æŸ¥çœ‹ MQTT åè®®çš„ 3.1 èŠ‚ï¼Œå¯¹ PUBLISH æ§åˆ¶æŠ¥æ–‡çš„è¯¦ç»†æè¿°ã€‚\n####è®¢é˜…å›è°ƒå‡½æ•°\nvoid mosquitto_subscribe_callback_set(struct mosquitto *mosq, void (*on_subscribe)(struct mosquitto *mosq, void *obj, int mid, int qos_count, const int *granted_qos) ); broker æ”¶åˆ°è®¢é˜…è¯·æ±‚åï¼Œä¼šå‘ client å‘é€ä¸€ä¸ª SUBACK æŠ¥æ–‡ä½œä¸ºå›åº”ï¼Œclient æ”¶åˆ°åå°±ä¼šè°ƒç”¨è¿™é‡Œè®¾ç½®çš„å‡½æ•°ï¼Œå¯ä»¥åœ¨å›è°ƒå‡½æ•°é‡Œåˆ¤æ–­è®¢é˜…æ˜¯å¦æˆåŠŸã€‚å›è°ƒå‡½æ•°ä¸­ï¼Œ mid è¡¨ç¤ºæ¶ˆæ¯ ID ï¼Œgranted_qos æŒ‡å‘ä¸€ä¸ªæ•°ç»„ï¼Œé‡Œé¢å­˜æ”¾çš„æ˜¯æ¯ä¸€ä¸ªå·²ç»æ‰¹å‡†çš„è®¢é˜…çš„ QoS ï¼Œqos_count è¡¨ç¤º granted_qos æ•°ç»„çš„å¤§å°ã€‚\n####å–æ¶ˆè®¢é˜…å›è°ƒå‡½æ•°\nvoid mosquitto_unsubscribe_callback_set(struct mosquitto *mosq, void (*on_unsubscribe)(struct mosquitto *mosq, void *obj, int mid) ); broker æ”¶åˆ°å–æ¶ˆè®¢é˜…çš„è¯·æ±‚åï¼Œä¼šæƒ³ client å‘é€ä¸€ä¸ª UNSUBACK æŠ¥æ–‡ä½œä¸ºå›åº”ï¼Œclient æ”¶åˆ°åå°±ä¼šè°ƒç”¨è¿™é‡Œè®¾ç½®çš„å‡½æ•°ã€‚\n####æ—¥å¿—å›è°ƒå‡½æ•°\nvoid mosquitto_log_callback_set(struct mosquitto *mosq, void (*on_log)(struct mosquitto *mosq, void *obj, int level, const char *str) ); å½“ libmosquitto äº§ç”Ÿæ—¥å¿—ä¿¡æ¯æ—¶ä¼šè°ƒç”¨è¿™é‡Œè®¾ç½®çš„å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å›è°ƒå‡½æ•°ä¸­æ‰“å°è¿™äº›æ—¥å¿—ã€‚level è¡¨ç¤ºæ—¥å¿—ä¿¡æ¯çš„ç­‰çº§ï¼ŒåŒ…æ‹¬ MOSQ_LOG_INFOã€MOSQ_LOG_NOTICEã€MOSQ_LOG_WARNINGã€MOSQ_LOG_ERR å’Œ MOSQ_LOG_DEBUG ã€‚str æ˜¯æ—¥å¿—ä¿¡æ¯çš„å†…å®¹ã€‚\n5. åè®° #å…¶å®ï¼Œç›®å‰å¯é€‰çš„ MQTT Borker å¾ˆå¤šï¼Œé™¤äº† mosquitto ï¼Œè¿˜æœ‰ Apache Apolloï¼Œæ”¯æŒå¤šç§åè®®ï¼Œè¿˜æœ‰å›½äººå¼€å‘ emqttï¼Œå·ç§°æ˜¯ç™¾ä¸‡çº§åˆ†å¸ƒå¼å¼€æºç‰©è”ç½‘MQTTæ¶ˆæ¯æœåŠ¡å™¨ã€‚è¿˜æœ‰ä¸€ä¸ªè·Ÿå¥½ç”¨çš„ MQTT client â€”â€” paho ï¼Œä¹Ÿæ˜¯å¼€æºäº§å“ï¼Œæ”¯æŒå¤šç§è¯­è¨€ï¼ŒåŒ…æ‹¬ C ã€C++ã€Pythonã€Javaã€JavaScript ç­‰ã€‚\n6. å‚è€ƒ # MQTT åè®®ä¸­æ–‡ç‰ˆ MQTT å…¥é—¨ç¯‡ MQTT è¿›é˜¶ç¯‡ MQTT å®‰å…¨ç¯‡ MQTT å®æˆ˜ç¯‡ mosquitto åè®®ä¹‹ mosquitto(8) â€“ the broker Mosquitto SSL Configuration ","date":"2015 August 11","permalink":"/posts/2015/08/11/","section":"Posts","summary":"1. MQTT ä»‹ç» #http://mqtt.","title":"MQTT åè®®å’Œ mosquitto"},{"content":"Python çš„æ ‡å‡†åº“æä¾›äº†ä¸¤ä¸ªæ¨¡å—æ”¯æŒå¤šçº¿ç¨‹ï¼šthread å’Œ threading ï¼Œthread æ˜¯ä½çº§æ¨¡å—ï¼Œthreading æ˜¯å¯¹ thread è¿›è¡Œäº†å°è£…çš„é«˜çº§æ¨¡å—ï¼Œé€šå¸¸ç›´æ¥ç”¨ threading æ¨¡å—ã€‚\nthreading åº“ï¼šhttps://docs.python.org/2/library/threading.html\n1. åˆ›å»ºçº¿ç¨‹ #threading æ¨¡å—å®šä¹‰äº† Thread å¯¹è±¡ï¼Œåˆ›å»ºä¸€ä¸ªçº¿ç¨‹å°±æ˜¯åˆ›å»ºä¸€ä¸ª Thread å®ä¾‹ï¼Œç”¨ name å‚æ•°æŒ‡å®šçº¿ç¨‹çš„åç§°ï¼Œç”¨ target å‚æ•°æŒ‡å®šè¯¥çº¿ç¨‹æ‰§è¡Œçš„å‡½æ•°ã€‚ç„¶åè°ƒç”¨ start() æ–¹æ³•å¼€å§‹æ‰§è¡Œï¼Œjoin() æ–¹æ³•çš„ä½œç”¨æ˜¯ç­‰å¾…çº¿ç¨‹ç»“æŸï¼Œå®ƒå¯ä»¥å¸¦ä¸€ä¸ªå‚æ•°ï¼Œè¡¨ç¤ºè¶…æ—¶æ—¶é—´ï¼š\nimport threading,time def loop(): print \u0026quot;this a thread\u0026quot; n=0 while n\u0026lt;5: print \u0026quot;n = %d\u0026quot; %(n) n=n+1 time.sleep(1) print \u0026quot;thread exit\u0026quot; print \u0026quot;thread running...\u0026quot; t=threading.Thread(target=loop) t.start() t.join() print \u0026quot;thread ended\u0026quot; æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡åˆ›å»ºè‡ªå·±çš„çº¿ç¨‹ç±»æ¥ä½¿ç”¨å¤šçº¿ç¨‹ï¼Œè¿™ä¸ªç±»éœ€è¦ç»§æ‰¿ threading.Thread ,ç„¶åé‡å†™ Thread å¯¹è±¡çš„ run() æ–¹æ³•ï¼Œrun() æ–¹æ³•å°±æ˜¯è¿™ä¸ªçº¿ç¨‹è¦å®ç°çš„åŠŸèƒ½ï¼Œè°ƒç”¨ start() æ–¹æ³•å°±ä¼šæ‰§è¡Œ run() ï¼Œä¾‹å¦‚ï¼š\nimport threading,time class my_thread(threading.Thread): def __init__(self,t_name): self.n=0 threading.Thread.__init__(self,name=t_name) def run(self): while self.n\u0026lt;5: print self.getName(),\u0026quot;:\u0026quot;,self.n self.n=self.n+1 time.sleep(1) def main(): t=my_thread('thread_a') t.start() t.join() if __name__=='__main__': main() è¾“å‡ºç»“æœæ˜¯ï¼š\nthread_a : 0 thread_a : 1 thread_a : 2 thread_a : 3 thread_a : 4 threading æä¾›äº†ä¸€ä¸ªå±æ€§ deamon ï¼Œé»˜è®¤å€¼æ˜¯ False ï¼Œè¡¨ç¤ºè¿™ä¸ªçº¿ç¨‹ä¸æ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼Œå½“ä¸»çº¿ç¨‹é€€å‡ºæ—¶ï¼Œè¯¥çº¿ç¨‹ä¹Ÿä¼šé€€å‡ºã€‚å¦‚æœè®¾ä¸º True ï¼Œè¿™ä¸ªçº¿ç¨‹å°±æ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼Œå½“ä¸»çº¿ç¨‹é€€å‡ºæ—¶ï¼Œè¯¥çº¿ç¨‹å¯ä»¥ç»§ç»­è¿è¡Œã€‚\n2. çº¿ç¨‹åŒæ­¥ #å½“å¤šä¸ªçº¿ç¨‹è®¿é—®å…±äº«èµ„æºæ—¶ï¼Œéœ€è¦å®ç°çº¿ç¨‹é—´çš„åŒæ­¥ï¼Œthreading æä¾›äº†å¤šä¸ªå¯¹è±¡å®ç°ä¸åŒçš„åŒæ­¥åŠŸèƒ½ã€‚\n2.1 Lock #Lock å¯¹è±¡æ˜¯æœ€åŸºæœ¬çš„åŒæ­¥æ–¹å¼ï¼Œç›¸å½“äºäº’æ–¥é”ã€‚ä½¿ç”¨æ—¶ï¼Œå…ˆåˆ›å»ºä¸€ä¸ªé”ï¼Œç„¶ååœ¨è®¿é—®å…±äº«èµ„æºæ—¶è°ƒç”¨ acquire() æ–¹æ³•è·å–é”ï¼Œè®¿é—®å®Œæ¯•å†è°ƒç”¨ release() æ–¹æ³•é‡Šæ”¾é”ã€‚\nacquire() æ–¹æ³•æœ‰ä¸€ä¸ªå‚æ•° blocking ï¼Œé»˜è®¤å€¼ä¸º True ï¼Œè¡¨ç¤ºè¯¥å‡½æ•°ä¼šé˜»å¡ï¼Œç›´åˆ°è·å–é”ï¼›å¦‚æœè®¾ä¸º False ï¼Œè¡¨ç¤ºéé˜»å¡ï¼Œå‡½æ•°ä¼šç«‹å³è¿”å›ã€‚\nrelease() æ–¹æ³•ä¼šé‡Šæ”¾å½“å‰çš„é”ï¼Œå¦‚æœè¿™ä¸ªé”æœ¬æ¥å°±æ²¡è¢«è·å–ï¼Œä¼šæŠ›å‡º ThreadError å¼‚å¸¸ï¼›\nimport threading,time n=0 lock=threading.Lock() def add_num(): global n while True: lock.acquire() n=n+1 n=n-1 print n lock.release() time.sleep(1) print \u0026quot;thread running...\u0026quot; t1=threading.Thread(target=add_num) t2=threading.Thread(target=add_num) t1.start() t2.start() t1.join() t2.join() print \u0026quot;thread ended\u0026quot; 2.2 RLock #Lock é”æ˜¯ä¸èƒ½åµŒå¥—ç”³è¯·çš„ï¼Œå¦åˆ™å¿…ç„¶æ­»é”ã€‚Threading æ¨¡å—æä¾›äº†å¦ä¸€ä¸ªå¯¹è±¡ RLock ï¼Œå¯é‡å…¥çš„äº’æ–¥é”ã€‚è¯¥å¯¹è±¡å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ª Lock å¯¹è±¡å’Œä¸€ä¸ªå¼•ç”¨è®¡æ•°ï¼Œè®°å½• acquire çš„æ¬¡æ•°ï¼Œå¯ä»¥å¤šæ¬¡ acquire ï¼Œacquire å’Œ release å¿…é¡»ä¸¥æ ¼é…å¯¹ï¼Œæ‰€æœ‰çš„ acquire æœ€åå¿…é¡»éƒ½ release ã€‚\nimport threading,time n=0 lock=threading.RLock() def add_num(): global n while True: if lock.acquire(): n=n+1 print \u0026quot;1 \u0026quot;,n if lock.acquire(): n=n-1 print \u0026quot;2 \u0026quot;,n lock.release() lock.release() time.sleep(1) print \u0026quot;thread running...\u0026quot; t=threading.Thread(target=add_num) t.start() t.join() print \u0026quot;thread ended\u0026quot; 2.3 Condition #Condition å¯ä»¥ç§°ä¸ºæ¡ä»¶å˜é‡ã€‚å®ƒçš„æ„é€ å‡½æ•°éœ€è¦ä¸€ä¸ª Lock å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œå¦‚æœæ²¡æœ‰è¿™ä¸ªå‚æ•°ï¼ŒCondition å°†åœ¨å†…éƒ¨è‡ªè¡Œåˆ›å»ºä¸€ä¸ª Rlock å¯¹è±¡ï¼Œæ‰€æœ‰å®ƒä¾ç„¶å¯ä»¥è°ƒç”¨ acquire() å’Œ release() æ–¹æ³•ã€‚å®ƒè¿˜æä¾›äº† wait() å’Œ notify() æ–¹æ³•ã€‚\nå½“ä¸€ä¸ªçº¿ç¨‹ç”¨ acquire() è·å–äº†ä¸€ä¸ªæ¡ä»¶å˜é‡ï¼Œå¯ä»¥è°ƒç”¨ wait() ä½¿çº¿ç¨‹æ”¾å¼ƒè¿™ä¸ªé”ï¼Œè¿›å…¥é˜»å¡çŠ¶æ€ï¼Œç›´åˆ°å…¶ä»–çº¿ç¨‹ç”¨åŒä¸€ä¸ªæ¡ä»¶å˜é‡çš„ notify() æ–¹æ³•å”¤é†’å®ƒã€‚wait() æ–¹æ³•æœ‰ä¸€ä¸ª timeout å‚æ•°å¯ä»¥è®¾ç½®é˜»å¡è¶…æ—¶ã€‚notify() æ–¹æ³•çš„å‚æ•° n è¡¨ç¤ºå”¤é†’ n ä¸ªçº¿ç¨‹ï¼Œé»˜è®¤å€¼æ˜¯ 1 ã€‚å¦‚æœæ˜¯è°ƒç”¨ notifyAll() æ–¹æ³•ï¼Œå°†ä¼šå”¤é†’è¯¥æ¡ä»¶å˜é‡ä¸Šé˜»å¡çš„æ‰€æœ‰çº¿ç¨‹ã€‚\nä¸‹é¢æ˜¯ä¸€ä¸ªç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„ä¾‹ç¨‹ï¼š\nimport threading x=0 con = threading.Condition() class Producer(threading.Thread): def __init__(self, t_name): threading.Thread.__init__(self, name=t_name) def run(self): global x con.acquire() if x \u0026gt; 0: con.wait() else: for i in range(5): x=x+1 print \u0026quot;producing...\u0026quot; + str(x) con.notify() print x con.release() class Consumer(threading.Thread): def __init__(self, t_name): threading.Thread.__init__(self, name=t_name) def run(self): global x con.acquire() if x == 0: print 'consumer wait...' con.wait() else: for i in range(5): x=x-1 print \u0026quot;consuming...\u0026quot; + str(x) con.notify() print x con.release() print 'start consumer' c=Consumer('consumer') print 'start producer' p=Producer('producer') p.start() c.start() p.join() c.join() print x 3. Timer #Timer æ˜¯ Thread çš„å­ç±»ï¼Œå¯ä»¥å®ç°å®šæ—¶æ‰§è¡ŒæŸä¸ªå‡½æ•°çš„åŠŸèƒ½ã€‚Timer çš„æ„é€ æ–¹æ³•å¦‚ä¸‹ï¼š\nclass threading.Timer(interval, function, args=[], kwargs={}) fuction ä¼šåœ¨ Timer å¯åŠ¨å interval ç§’å¼€å§‹æ‰§è¡Œï¼Œargs å’Œ kwargs è¡¨ç¤ºä¼ å…¥ fuction çš„å‚æ•°å’Œå¯å˜å‚æ•°ã€‚æ„é€ äº† Timer çš„å®ä¾‹åï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨ start() æ–¹æ³•å¯åŠ¨ Timer ã€‚è°ƒç”¨ cancel() æ–¹æ³•å¯ä»¥åœæ­¢ Timer ï¼Œå¹¶åœæ­¢ Timer å¯åŠ¨çš„å‡½æ•°ã€‚\nä¸‹é¢è¿™ä¸ªä¾‹ç¨‹ä¼šåœ¨å¯åŠ¨ Timer å 5 ç§’æ˜¯æ‰§è¡Œ hello å‡½æ•°ï¼š\nimport threading def hello(arg): print \u0026quot;Hello World\u0026quot; print arg t=threading.Timer(5,hello,[\u0026quot;Yes\u0026quot;]) t.start() ","date":"2015 July 27","permalink":"/posts/2015/07/27/","section":"Posts","summary":"Python çš„æ ‡å‡†åº“æä¾›äº†ä¸¤ä¸ªæ¨¡å—æ”¯æŒå¤šçº¿ç¨‹ï¼šthread å’Œ threading ï¼Œthread æ˜¯ä½çº§æ¨¡å—ï¼Œthreading æ˜¯å¯¹ thread è¿›è¡Œäº†å°è£…çš„é«˜çº§æ¨¡å—ï¼Œé€šå¸¸ç›´æ¥ç”¨ threading æ¨¡å—ã€‚","title":"Python çš„å¤šçº¿ç¨‹"},{"content":"1.ä»€ä¹ˆæ˜¯ JSON #JSON ä»‹ç»ï¼šhttp://json.org/json-zh.html\nJSON æ˜¯ JavaScript å¯¹è±¡è¡¨ç¤ºæ³•è¯­æ³•çš„å­é›†ï¼Œæ˜¯ä¸€ç§è½»é‡çº§çš„æ•°æ®äº¤æ¢æ ¼å¼ã€‚ä¸€ä¸ª JSON å¯¹è±¡æ˜¯ â€œåç§°:å€¼â€ å¯¹çš„æ— åºé›†åˆï¼Œç”¨èŠ±æ‹¬å·åŒ…å«ï¼Œâ€œåç§°:å€¼â€ å¯¹åŒ…å«ä¸€ä¸ªå­—æ®µåç§°ï¼ˆåœ¨åŒå¼•å·ä¸­ï¼‰ï¼Œç„¶åè·Ÿä¸€ä¸ªå†’å·ï¼Œæœ€åæ˜¯å€¼ï¼Œä¾‹å¦‚ï¼š\n{ \u0026quot;name\u0026quot;: \u0026quot;sample_app\u0026quot;, \u0026quot;cmd\u0026quot;: [\u0026quot;python\u0026quot;, \u0026quot;$MOD/sample.py\u0026quot;, \u0026quot;-c\u0026quot;, \u0026quot;$MOD/init.cfg\u0026quot;], \u0026quot;depends\u0026quot;: [\u0026quot;modbus_USBV0\u0026quot;, \u0026quot;cloud_client\u0026quot;, \u0026quot;defaultdb\u0026quot;], \u0026quot;version\u0026quot;: \u0026quot;1.0.0\u0026quot; } è¿™é‡Œçš„å€¼å¯ä»¥æ˜¯ï¼š\næ•°å­—ï¼ˆæ•´æ•°æˆ–æµ®ç‚¹æ•°ï¼‰ å­—ç¬¦ä¸²ï¼ˆåœ¨åŒå¼•å·ä¸­ï¼‰ é€»è¾‘å€¼ï¼ˆtrue æˆ– falseï¼‰ æ•°ç»„ï¼ˆåœ¨æ–¹æ‹¬å·ä¸­ï¼‰ å¯¹è±¡ï¼ˆåœ¨èŠ±æ‹¬å·ä¸­ï¼‰ null 2.json åº“ #Python æä¾›äº† json åº“ï¼ˆhttps://docs.python.org/2/library/json.htmlï¼‰ï¼Œå¯ä»¥å®Œæˆå¯¹ JSON å¯¹è±¡çš„ç¼–è§£ç ï¼ˆencoding and decodingï¼‰ï¼Œå°±æ˜¯ JSON å¯¹è±¡è½¬æ¢ä¸º Python çš„æ•°æ®ç»“æ„ï¼Œæˆ–è€…é€†è¿‡ç¨‹ï¼š\nJSON Python Object dict string string number int,long,float array list,tuple true True false False null None åŸºæœ¬æ“ä½œ #dumps æ–¹æ³•å¯ä»¥å°† Python æ•°æ®è½¬æ¢ä¸º JSON æ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œç„¶åè¿”å›ï¼Œä¾‹å¦‚ï¼š\n\u0026gt;\u0026gt;\u0026gt; import json \u0026gt;\u0026gt;\u0026gt; obj={ 'name':'Bob', 'data':(1,3) } \u0026gt;\u0026gt;\u0026gt; encodedjson=json.dumps(obj) \u0026gt;\u0026gt;\u0026gt; print obj {'data': (1, 3), 'name': 'Bob'} \u0026gt;\u0026gt;\u0026gt; print encodedjson {\u0026quot;data\u0026quot;: [1, 3], \u0026quot;name\u0026quot;: \u0026quot;Bob\u0026quot;} \u0026gt;\u0026gt;\u0026gt; print type(encodedjson) \u0026lt;type 'str'\u0026gt; ä»è¾“å‡ºç»“æœçœ‹ï¼Œå…ƒç»„è½¬æ¢ä¸ºäº†æ•°ç»„ï¼Œå­—ç¬¦ä¸²æ”¹æˆäº†åŒå¼•å·ã€‚\nloads æ–¹æ³•å¯ä»¥å°† JSON æ ¼å¼çš„å­—ç¬¦ä¸²è½¬æ¢ä¸º Python çš„ dict ç»“æ„ï¼Œä¾‹å¦‚ï¼š\n\u0026gt;\u0026gt;\u0026gt; import json \u0026gt;\u0026gt;\u0026gt; jsoncode='{ \u0026quot;name\u0026quot;:\u0026quot;Bob\u0026quot;,\u0026quot;data\u0026quot;:[1,2,3] }' \u0026gt;\u0026gt;\u0026gt; obj=json.loads(jsoncode) \u0026gt;\u0026gt;\u0026gt; print obj {u'data': [1, 2, 3], u'name': u'Bob'} \u0026gt;\u0026gt;\u0026gt; print type(obj) \u0026lt;type 'dict'\u0026gt; \u0026gt;\u0026gt;\u0026gt; print obj['name'] Bob è½¬æ¢åçš„å­—ç¬¦ä¸²å‰éƒ½å¸¦æœ‰ u å­—ç¬¦ï¼Œè¡¨ç¤ºè¿™ä¸ªå­—ç¬¦ä¸²æ˜¯ Unicode ç¼–ç ï¼Œå¹¶ä¸ä¼šå½±å“ dict çš„ä½¿ç”¨ã€‚\nEncoders and Decoders #json æ¨¡å—æä¾›äº†ä¸¤ä¸ªå­ç±» JSONDecoder å’Œ JSONEncoder ï¼Œè´Ÿè´£ JSON çš„è§£ç å’Œç¼–ç ã€‚\nJSONDecoder æ˜¯è§£ç å™¨ï¼Œæä¾›äº†ä¸¤ç§æ–¹æ³•ï¼š\ndecode(s) ï¼Œå°† JSON ç»“æ„çš„å­—ç¬¦ä¸² s è½¬æ¢ä¸º Python ç»“æ„ï¼Œå¹¶è¿”å›ã€‚ raw_decode(s) ï¼Œ åŒæ ·æ˜¯è§£ç ï¼Œä½†æ˜¯ä¼šè¿”å›ä¸¤ä¸ªå€¼ï¼Œç¬¬ä¸€ä¸ªæ˜¯è§£ç åçš„ Python ç»“æ„ï¼Œç¬¬äºŒä¸ªå€¼è¡¨ç¤ºè§£ç ç»“æŸæ—¶ï¼Œèµ°åˆ°äº† s çš„å“ªä¸ªä½ç½®ï¼Œè¿™ä¸ªæ–¹æ³•é€‚ç”¨äº s çš„æœ«å°¾æœ‰æ— æ•ˆæ•°æ®çš„æƒ…å†µã€‚ ä¾‹å¦‚ï¼š\n\u0026gt;\u0026gt;\u0026gt; import json \u0026gt;\u0026gt;\u0026gt; file=open(\u0026quot;package.cfg\u0026quot;) \u0026gt;\u0026gt;\u0026gt; text=file.read() \u0026gt;\u0026gt;\u0026gt; print text { \u0026quot;name\u0026quot;: \u0026quot;sample_app\u0026quot;, \u0026quot;cmd\u0026quot;: [\u0026quot;python\u0026quot;, \u0026quot;$MOD/sample.py\u0026quot;, \u0026quot;-c\u0026quot;, \u0026quot;$MOD/init.cfg\u0026quot;], \u0026quot;depends\u0026quot;: [\u0026quot;modbus_USBV0\u0026quot;, \u0026quot;cloud_client\u0026quot;, \u0026quot;defaultdb\u0026quot;], \u0026quot;version\u0026quot;: \u0026quot;1.0.0\u0026quot; } hello \u0026gt;\u0026gt;\u0026gt; obj,raw=json.JSONDecoder().raw_decode(text) \u0026gt;\u0026gt;\u0026gt; print obj {u'depends': [u'modbus_USBV0', u'cloud_client', u'defaultdb'], u'cmd': [u'python', u'$MOD/sample.py', u'-c', u'$MOD/init.cfg'], u'name': u'sample_app', u'version': u'1.0.0'} \u0026gt;\u0026gt;\u0026gt; print raw 166 \u0026gt;\u0026gt;\u0026gt; obj=json.JSONDecoder().decode(text) Traceback (most recent call last): File \u0026quot;\u0026lt;stdin\u0026gt;\u0026quot;, line 1, in \u0026lt;module\u0026gt; File \u0026quot;/usr/lib/python2.7/json/decoder.py\u0026quot;, line 369, in decode raise ValueError(errmsg(\u0026quot;Extra data\u0026quot;, s, end, len(s))) ValueError: Extra data: line 8 column 1 - line 9 column 1 (char 168 - 174) package.cfg çš„æœ«å°¾æœ‰æ— æ•ˆçš„å­—ç¬¦ hello ï¼Œç”¨ raw_decode() å¯ä»¥å¿½ç•¥å¹¶è§£ç ï¼Œç”¨ decode() å°±ä¼šæŠ¥é”™ã€‚\nJSONEncoder æ˜¯ç¼–ç å™¨ï¼Œæä¾›äº† encode(o) æ–¹æ³•ï¼Œå¯ä»¥å°† Python ç»“æ„ o è½¬æ¢ä¸º JSON ç»“æ„çš„å­—ç¬¦ä¸²ï¼Œå¹¶è¿”å›ã€‚\n","date":"2015 July 21","permalink":"/posts/2015/07/21/","section":"Posts","summary":"1.ä»€ä¹ˆæ˜¯ JSON #JSON ä»‹ç»ï¼šhttp://json.","title":"Python å¯¹ JSON çš„å¤„ç†"},{"content":"1. æ—¶åŒº #Linux ç³»ç»Ÿä¸­é€šè¿‡ /etc/localtime æ–‡ä»¶è®¾ç½®ç³»ç»Ÿæ—¶åŒºï¼Œæ‰€æœ‰çš„æ—¶åŒºæ–‡ä»¶åœ¨ /usr/share/zoneinfo/ ç›®å½•ä¸‹\nå¦‚æœè¦ä¿®æ”¹æ—¶åŒºï¼Œç›´æ¥å°† /usr/share/zoneinfo/ ä¸‹çš„ç›¸åº”æ—¶åŒºæ–‡ä»¶å¤åˆ¶åˆ° /etc/ ä¸‹ï¼Œæ”¹åä¸º localtime å³å¯ã€‚\n2. ç³»ç»Ÿæ—¶é—´çš„æ˜¾ç¤ºå’Œè®¾ç½® #å¸¸ç”¨çš„æ˜¾ç¤ºæˆ–è®¾ç½®ç³»ç»Ÿæ—¶é—´çš„å‘½ä»¤æ˜¯ date ã€‚\nç›´æ¥æ‰§è¡Œ date å°±å¯ä»¥æ˜¾ç¤ºå½“å‰çš„æ—¥æœŸæ—¶é—´å’Œæ—¶åŒºï¼Œå¦‚æœè¦æ ¼å¼åŒ–æ˜¾ç¤ºï¼Œéœ€è¦ç”¨åŠ å·æŒ‡å®šæ ¼å¼åŒ–å‚æ•°ï¼Œä¾‹å¦‚æŒ‰ â€œå¹´-æœˆ-æ—¥ æ—¶:åˆ†:ç§’â€å½“å‰æ—¶é—´ï¼š\n~# date +\u0026quot;%Y-%m-%d %H:%M:%S\u0026quot; 2015-07-01 11:00:40 è®¾ç½®æ—¶é—´éœ€è¦ç”¨ -s å‚æ•°ï¼Œä¾‹å¦‚ï¼š\n~# date -s \u0026quot;20150701 12:03:00\u0026quot; Wed Jul 1 12:03:00 HKT 2015 æŸ¥çœ‹ç¡¬ä»¶æ—¶é’Ÿçš„æ—¶é—´ç”¨ hwclockå‘½ä»¤ï¼š\n~# hwclock Wed Jul 1 11:09:54 2015 -0.127600 seconds å°†ç³»ç»Ÿæ—¶é—´å†™å…¥ç¡¬ä»¶æ—¶é’Ÿï¼š\n~# hwclock --systohc è¯»å–ç¡¬ä»¶æ—¶é’Ÿè®¾ç½®ç³»ç»Ÿæ—¶é—´ï¼š\n~# hwclock --hctosys 3. Cè¯­è¨€çš„æ—¶é—´è½¬æ¢ #Cè¯­è¨€å¯¹æ—¶é—´çš„å¤„ç†å‡½æ•°å¤§éƒ¨åˆ†åœ¨ \u0026lt;time.h\u0026gt; å¤´æ–‡ä»¶ã€‚\nå‡½æ•° time ä¼šè¿”å›ä» â€1970 å¹´ 1 æœˆ 1 æ—¥ 0 ç‚¹â€œ åˆ°å½“å‰çš„ç§’æ•°ï¼Œå¦‚æœå‚æ•° t ä¸ä¸ºç©ºï¼Œä¹Ÿä¼šå­˜å‚¨åœ¨è¯¥æŒ‡é’ˆæŒ‡å‘çš„å†…å­˜é‡Œã€‚å¤±è´¥ä¼šè¿”å› -1 ã€‚å‡½æ•°åŸå‹ï¼š\ntime_t time(time_t *t); time è¿”å›çš„æ—¶é—´å¯è¯»æ€§ä¸å¥½ï¼Œå¦‚æœè¦çœ‹åˆ°ç±»ä¼¼ â€2014 å¹´ 12 æœˆ 7 æ—¥â€œ è¿™æ ·çš„æ˜¾ç¤ºï¼Œéœ€è¦å°†å…¶è½¬æ¢ã€‚ç”¨ localtime å‡½æ•°å¯ä»¥å°† time_t ç±»å‹è½¬æ¢ä¸ºæœ¬åœ°æ—¶é—´ï¼Œå­˜å‚¨åœ¨ tm ç»“æ„ä¸­ï¼š\nstruct tm { int tm_sec; /* Seconds (0-60) */ int tm_min; /* Minutes (0-59) */ int tm_hour; /* Hours (0-23) */ int tm_mday; /* Day of the month (1-31) */ int tm_mon; /* Month (0-11) */ int tm_year; /* Year since 1900 */ int tm_wday; /* Day of the week (Sunday = 0)*/ int tm_yday; /* Day in the year (0-365; 1 Jan = 0)*/ int tm_isdst; /* Daylight saving time flag \u0026gt; 0: DST is in effect; = 0: DST is not effect; \u0026lt; 0: DST information not available */ }; struct tm *localtime(const time_t *timep); tm ç»“æ„çš„æ ¼å¼å°±å¾ˆæ¸…æ™°äº†ï¼Œè¿˜å¯ä»¥è¿›ä¸€æ­¥å°†è¿™ä¸ªç»“æ„æŒ‰ç…§æŒ‡å®šçš„æ ¼å¼è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œè¿™éœ€è¦ strftime å‡½æ•°ï¼š\nsize_t strftime(char *outstr, size_t maxsize, const char *format, const struct tm *timeptr); strftime ä¼šå°† timeptr ç»“æ„æŒ‰ç…§ format æŒ‡å®šçš„æ ¼å¼è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œå¹¶å­˜å‚¨åœ¨ outstr ä¸­ã€‚maxsize æŒ‡å®š outstr çš„å­—èŠ‚æ•°ã€‚format çš„å¸¸ç”¨æ ¼å¼å‘½ä»¤æœ‰ ï¼š\n%y ä¸å¸¦ä¸–çºªçš„åè¿›åˆ¶å¹´ä»½ï¼ˆå€¼ä»0åˆ°99ï¼‰ %Y å¸¦ä¸–çºªéƒ¨åˆ†çš„ååˆ¶å¹´ä»½ %m åè¿›åˆ¶è¡¨ç¤ºçš„æœˆä»½ %B æœˆä»½çš„å…¨ç§° %b æœˆä»½çš„ç®€å†™ %d åè¿›åˆ¶è¡¨ç¤ºçš„æ¯æœˆçš„ç¬¬å‡ å¤© %H 24å°æ—¶åˆ¶çš„å°æ—¶ %I 12å°æ—¶åˆ¶çš„å°æ—¶ %M åæ—¶åˆ¶è¡¨ç¤ºçš„åˆ†é’Ÿæ•° %S åè¿›åˆ¶çš„ç§’æ•° %x æ ‡å‡†çš„æ—¥æœŸä¸² %X æ ‡å‡†çš„æ—¶é—´ä¸² è·å–ç³»ç»Ÿæ—¶é—´å¹¶æ ¼å¼åŒ–æ˜¾ç¤ºçš„ä¾‹ç¨‹ï¼š\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;time.h\u0026gt; int main () { time_t sys_time; struct tm * local_time; char time_buf[30]; time(\u0026amp;sys_time); local_time=localtime(\u0026amp;sys_time); strftime(time_buf,30,\u0026quot;%Y-%m-%d %H:%M:%S\u0026quot;,local_time); printf(\u0026quot;NOW:%s\\n\u0026quot;,time_buf); return 0; } è¯¥ç¨‹åºçš„è¾“å‡ºï¼š\nNOW:2015-07-01 11:53:59 4. Cè¯­è¨€çš„æ—¶é—´æµ‹é‡ #Cè¯­è¨€æä¾›äº† gettimeofday å‡½æ•°ï¼Œå®ƒä¼šè¿”å›ä» 1970 å¹´ 1 æœˆ 1 æ—¥ 0 ç‚¹åˆ°ç°åœ¨çš„æ—¶é—´ï¼Œç²¾ç¡®åˆ°å¾®ç§’ï¼Œä¿å­˜åœ¨ timeval ç»“æ„ä¸­ï¼Œå‡½æ•°åŸå‹ï¼š\n#include \u0026lt;sys/time.h\u0026gt; int gettimeofday(struct timeval *tv, struct timezone *tz); struct timeval { time_t tv_sec; /* seconds */ suseconds_t tv_usec; /* microseconds */ }; æ³¨ï¼šç¬¬äºŒä¸ªå‚æ•°å·²ç»åºŸæ­¢ï¼Œä¼ å…¥ NULL å³å¯ã€‚\nä¾‹å¦‚ï¼Œè®¡ç®—è¾“å‡º Hello world çš„è€—æ—¶ï¼š\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;sys/time.h\u0026gt; int main () { struct timeval start_time,end_time; gettimeofday(\u0026amp;start_time,NULL); printf(\u0026quot;Hello world\\n\u0026quot;); gettimeofday(\u0026amp;end_time,NULL); printf(\u0026quot;%ld s %ld us\\n\u0026quot;,end_time.tv_sec-start_time.tv_sec,end_time.tv_usec-start_time.tv_usec); return 0; } è¯¥ç¨‹åºçš„è¾“å‡ºï¼š\nHello world 0 s 41 us 5. è®¡æ—¶å™¨ #è¦å®šæ—¶æ‰§è¡ŒæŸæ®µä»£ç ï¼Œæœ€ç®€å•çš„æ–¹æ³•æ˜¯ç”¨ sleep å‡½æ•°ï¼Œå®ƒä¼šä½¿è¿›ç¨‹æŒ‚èµ·ä¸€æ®µæ—¶é—´ï¼Œå•ä½æ˜¯ç§’ï¼Œæ›´ç²¾ç¡®çš„ç¡çœ éœ€è¦è°ƒç”¨ usleep å‡½æ•°ï¼Œå®ƒå•ä½æ˜¯å¾®ç§’ ã€‚\næ›´å¥½çš„æ–¹æ³•æ˜¯ä½¿ç”¨ POSIX Timer ã€‚POSIX Timer å¯ä»¥ä¸ºä¸€ä¸ªè¿›ç¨‹è®¾ç½®å¤šä¸ªè®¡æ—¶å™¨ï¼Œæ—¶é—´åˆ°è¾¾åï¼Œå¯ä»¥é€šè¿‡ä¿¡å·æˆ–å…¶ä»–æ–¹å¼é€šçŸ¥è¿›ç¨‹ï¼Œæœ€é«˜å¯ä»¥è¾¾åˆ°çº³ç§’çº§åˆ«çš„ç²¾åº¦ã€‚\næ¶‰åŠçš„å‡½æ•°ï¼š\ntimer_create ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ Timerï¼›å¹¶ä¸”æŒ‡å®šå®šæ—¶å™¨åˆ°æ—¶é€šçŸ¥æœºåˆ¶ timer_delete ï¼šåˆ é™¤ä¸€ä¸ª Timer timer_gettime ï¼šGet the time remaining on a POSIX.1b interval timer timer_settime ï¼šå¼€å§‹æˆ–è€…åœæ­¢æŸä¸ªå®šæ—¶å™¨ã€‚ timer_getoverrun ï¼šè·å–ä¸¢å¤±çš„å®šæ—¶é€šçŸ¥ä¸ªæ•°ã€‚ åˆ›å»º Timer #ä½¿ç”¨ Posix Timer çš„åŸºæœ¬æµç¨‹å¾ˆç®€å•ï¼Œé¦–å…ˆè°ƒç”¨ timer_create å‡½æ•°åˆ›å»ºä¸€ä¸ª Timerã€‚å‡½æ•°åŸå‹ï¼š\nint timer_create(clockid_t clockid, struct sigevent *sevp, timer_t *timerid); åˆ›å»ºçš„æ—¶å€™éœ€è¦æŒ‡å®šè¯¥ Timer çš„ä¸€äº›ç‰¹æ€§ï¼Œæ¯”å¦‚ clock IDã€‚clock ID å³ Timer çš„ç§ç±»ï¼Œå¯ä»¥ä¸ºå¦‚ä¸‹ä»»æ„ä¸€ç§ï¼š\nCLOCK_REALTIME ï¼šSettable system-wide real-time clockï¼› CLOCK_MONOTONIC\tï¼šNonsettable monotonic clock CLOCK_PROCESS_CPUTIME_ID\tï¼šPer-process CPU-time clock CLOCK_THREAD_CPUTIME_ID\tï¼šPer-thread CPU-time clock CLOCK_REALTIME æ—¶é—´æ˜¯ç³»ç»Ÿä¿å­˜çš„æ—¶é—´ï¼Œå³å¯ä»¥ç”± date å‘½ä»¤æ˜¾ç¤ºçš„æ—¶é—´ï¼Œè¯¥æ—¶é—´å¯ä»¥é‡æ–°è®¾ç½®ã€‚æ¯”å¦‚å½“å‰æ—¶é—´ä¸ºä¸Šåˆ 10 ç‚¹ 10 åˆ†ï¼ŒTimer æ‰“ç®—åœ¨ 10 åˆ†é’Ÿååˆ°æ—¶ã€‚å‡å¦‚ 5 åˆ†é’Ÿåï¼Œæˆ‘ç”¨ date å‘½ä»¤ä¿®æ”¹å½“å‰æ—¶é—´ä¸º 10 ç‚¹ 10 åˆ†ï¼Œé‚£ä¹ˆ Timer è¿˜ä¼šå†ç­‰ååˆ†é’Ÿåˆ°æœŸï¼Œå› æ­¤å®é™…ä¸Š Timer ç­‰å¾…äº† 15 åˆ†é’Ÿã€‚å‡å¦‚æ‚¨å¸Œæœ›æ— è®ºä»»ä½•äººå¦‚ä½•ä¿®æ”¹ç³»ç»Ÿæ—¶é—´ï¼ŒTimer éƒ½ä¸¥æ ¼æŒ‰ç…§ 10 åˆ†é’Ÿçš„å‘¨æœŸè¿›è¡Œè§¦å‘ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨ CLOCK_MONOTONICã€‚\nCLOCK_PROCESS_CPUTIME_ID çš„å«ä¹‰ä¸ setitimer çš„ ITIMER_VIRTUAL ç±»ä¼¼ã€‚è®¡æ—¶å™¨åªè®°å½•å½“å‰è¿›ç¨‹æ‰€å®é™…èŠ±è´¹çš„æ—¶é—´ï¼›æ¯”å¦‚è¿˜æ˜¯ä¸Šé¢çš„ä¾‹å­ï¼Œå‡è®¾ç³»ç»Ÿéå¸¸ç¹å¿™ï¼Œå½“å‰è¿›ç¨‹åªèƒ½è·å¾— 50%çš„ CPU æ—¶é—´ï¼Œä¸ºäº†è®©è¿›ç¨‹çœŸæ­£åœ°è¿è¡Œ 10 åˆ†é’Ÿï¼Œåº”è¯¥åˆ° 10 ç‚¹ 30 åˆ†æ‰å…è®¸ Timer åˆ°æœŸã€‚\nCLOCK_THREAD_CPUTIME_ID ä»¥çº¿ç¨‹ä¸ºè®¡æ—¶å®ä½“ï¼Œå½“å‰è¿›ç¨‹ä¸­çš„æŸä¸ªçº¿ç¨‹çœŸæ­£åœ°è¿è¡Œäº†ä¸€å®šæ—¶é—´æ‰è§¦å‘ Timerã€‚\ntimer_create çš„ç¬¬äºŒä¸ªå‚æ•° struct sigevent ç”¨æ¥è®¾ç½®å®šæ—¶å™¨åˆ°æ—¶æ—¶çš„é€šçŸ¥æ–¹å¼ã€‚è¯¥æ•°æ®ç»“æ„å¦‚ä¸‹ï¼š\nstruct sigevent { int sigev_notify; /* Notification method */ int sigev_signo; /* Notification signal */ union sigval sigev_value; /* Data passed with notification */ void (*sigev_notify_function) (union sigval); /* Function used for thread notification (SIGEV_THREAD) */ void *sigev_notify_attributes; /* Attributes for notification thread (SIGEV_THREAD) */ pid_t sigev_notify_thread_id; /* ID of thread to signal (SIGEV_THREAD_ID) */ }; union sigval { int sival_int; /* Integer value */ void *sival_ptr; /* Pointer value */ }; å…¶ä¸­ sigev_notify è¡¨ç¤ºé€šçŸ¥æ–¹å¼ï¼Œæœ‰å¦‚ä¸‹å‡ ç§ï¼š\nSIGEV_NONE\tï¼šå®šæ—¶å™¨åˆ°æœŸæ—¶ä¸äº§ç”Ÿé€šçŸ¥ã€‚ã€‚ã€‚ SIGEV_SIGNAL\tï¼šå®šæ—¶å™¨åˆ°æœŸæ—¶å°†ç»™è¿›ç¨‹æŠ•é€’ä¸€ä¸ªä¿¡å·ï¼Œç”¨ sigev_signo æŒ‡å®šä¿¡å·å€¼ã€‚ SIGEV_THREAD\tï¼šå®šæ—¶å™¨åˆ°æœŸæ—¶å°†å¯åŠ¨æ–°çš„çº¿ç¨‹è¿›è¡Œéœ€è¦çš„å¤„ç† SIGEV_THREAD_ID ï¼šï¼ˆä»…é’ˆå¯¹ Linux)å®šæ—¶å™¨åˆ°æœŸæ—¶å°†å‘æŒ‡å®šçº¿ç¨‹å‘é€ä¿¡å·ã€‚ å¦‚æœé‡‡ç”¨ SIGEV_NONE æ–¹å¼ï¼Œä½¿ç”¨è€…å¿…é¡»è°ƒç”¨timer_gettime å‡½æ•°ä¸»åŠ¨è¯»å–å®šæ—¶å™¨å·²ç»èµ°è¿‡çš„æ—¶é—´ã€‚ç±»ä¼¼è½®è¯¢ã€‚\nå¦‚æœé‡‡ç”¨ SIGEV_SIGNAL æ–¹å¼ï¼Œä½¿ç”¨è€…å¯ä»¥é€‰æ‹©ä½¿ç”¨ä»€ä¹ˆä¿¡å·ï¼Œç”¨ sigev_signo è¡¨ç¤ºä¿¡å·å€¼ï¼Œæ¯”å¦‚ SIG_ALARMã€‚\nå¦‚æœä½¿ç”¨ SIGEV_THREAD æ–¹å¼ï¼Œåˆ™éœ€è¦è®¾ç½® sigev_notify_functionï¼Œå½“ Timer åˆ°æœŸæ—¶ï¼Œå°†ä½¿ç”¨è¯¥å‡½æ•°ä½œä¸ºå…¥å£å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†ä¿¡å·ï¼›sigev_value ä¿å­˜äº†ä¼ å…¥ sigev_notify_function çš„å‚æ•°ã€‚sigev_notify_attributes å¦‚æœéç©ºï¼Œåˆ™åº”è¯¥æ˜¯ä¸€ä¸ªæŒ‡å‘ pthread_attr_t çš„æŒ‡é’ˆï¼Œç”¨æ¥è®¾ç½®çº¿ç¨‹çš„å±æ€§ï¼ˆæ¯”å¦‚ stack å¤§å°,detach çŠ¶æ€ç­‰ï¼‰ã€‚\nSIGEV_THREAD_ID é€šå¸¸å’Œ SIGEV_SIGNAL è”åˆä½¿ç”¨ï¼Œè¿™æ ·å½“ Timer åˆ°æœŸæ—¶ï¼Œç³»ç»Ÿä¼šå‘ç”± sigev_notify_thread_id æŒ‡å®šçš„çº¿ç¨‹å‘é€ä¿¡å·ï¼Œå¦åˆ™å¯èƒ½è¿›ç¨‹ä¸­çš„ä»»æ„çº¿ç¨‹éƒ½å¯èƒ½æ”¶åˆ°è¯¥ä¿¡å·ã€‚è¿™ä¸ªé€‰é¡¹æ˜¯ Linux å¯¹ POSIX æ ‡å‡†çš„æ‰©å±•ï¼Œç›®å‰ä¸»è¦æ˜¯ GLibc åœ¨å®ç° SIGEV_THREAD çš„æ—¶å€™ä½¿ç”¨åˆ°ï¼Œåº”ç”¨ç¨‹åºå¾ˆå°‘ä¼šéœ€è¦ç”¨åˆ°è¿™ç§æ¨¡å¼ã€‚\nå¯åŠ¨ Timer #åˆ›å»º Timer ä¹‹åï¼Œä¾¿å¯ä»¥è°ƒç”¨ timer_settime() å‡½æ•°æŒ‡å®šå®šæ—¶å™¨çš„æ—¶é—´é—´éš”ï¼Œå¹¶å¯åŠ¨äº†ã€‚å‡½æ•°åŸå‹ï¼š\nint timer_settime(timer_t timerid, int flags, const struct itimerspec *new_value, struct itimerspec * old_value); new_value å’Œ old_value éƒ½æ˜¯ struct itimerspec æ•°æ®ç»“æ„ï¼š\nstruct itimerspec { struct timespec it_interval; //å®šæ—¶å™¨å‘¨æœŸå€¼ struct timespec it_value; //å®šæ—¶å™¨åˆ°æœŸå€¼ }; struct timespec { time_t tv_sec; //ç§’ long\ttv_nsec; //çº³ç§’ }; å¯åŠ¨å’Œåœæ­¢ Timer éƒ½å¯ä»¥é€šè¿‡è®¾ç½® new_value æ¥å®ç°ï¼š\nnew_value-\u0026gt;it_interval ä¸ºå®šæ—¶å™¨çš„å‘¨æœŸå€¼ï¼Œæ¯”å¦‚ 1 ç§’ï¼Œè¡¨ç¤ºå®šæ—¶å™¨æ¯éš” 1 ç§’åˆ°æœŸï¼› new_value-\u0026gt;it_value å¦‚æœå¤§äº 0ï¼Œè¡¨ç¤ºå¯åŠ¨å®šæ—¶å™¨ï¼ŒTimer å°†åœ¨ it_value è¿™ä¹ˆé•¿çš„æ—¶é—´è¿‡å»ååˆ°æœŸï¼Œæ­¤åæ¯éš” it_interval ä¾¿åˆ°æœŸä¸€æ¬¡ã€‚å¦‚æœ it_value ä¸º 0ï¼Œè¡¨ç¤ºåœæ­¢è¯¥ Timerã€‚ æœ‰äº›æ—¶å€™ï¼Œåº”ç”¨ç¨‹åºä¼šå…ˆå¯åŠ¨ç”¨ä¸€ä¸ªæ—¶é—´é—´éš”å¯åŠ¨å®šæ—¶å™¨ï¼Œéšååˆä¿®æ”¹è¯¥å®šæ—¶å™¨çš„æ—¶é—´é—´éš”ï¼Œè¿™éƒ½å¯ä»¥é€šè¿‡ä¿®æ”¹ new_value æ¥å®ç°ï¼›å‡å¦‚åº”ç”¨ç¨‹åºåœ¨ä¿®æ”¹äº†æ—¶é—´é—´éš”ä¹‹åå¸Œæœ›äº†è§£ä¹‹å‰çš„æ—¶é—´é—´éš”è®¾ç½®ï¼Œåˆ™ä¼ å…¥ä¸€ä¸ªé NULL çš„ old_value æŒ‡é’ˆï¼Œè¿™æ ·åœ¨ timer_settime() è°ƒç”¨è¿”å›æ—¶ï¼Œold_value å°±ä¿å­˜äº†ä¸Šä¸€æ¬¡ Timer çš„æ—¶é—´é—´éš”è®¾ç½®ã€‚å¤šæ•°æƒ…å†µä¸‹æˆ‘ä»¬å¹¶ä¸éœ€è¦è¿™æ ·ï¼Œä¾¿å¯ä»¥ç®€å•åœ°å°† old_value è®¾ç½®ä¸º NULLï¼Œå¿½ç•¥å®ƒã€‚\nä¾‹ç¨‹ #ä¸‹é¢è¿™ä¸ªä¾‹ç¨‹ä½¿ç”¨ SIGEV_THREAD æ–¹å¼çš„ timer ï¼Œæ¯éš”ä¸¤ç§’è°ƒç”¨ä¸€æ¬¡ timer_thread å‡½æ•°ï¼Œå°† counter åŠ ä¸€ï¼Œå¹¶æ‰“å°ã€‚ä¸»å‡½æ•°ç­‰å¾… counter ç­‰äº 5 æ—¶é€€å‡ºã€‚\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;unistd.h\u0026gt; #include \u0026lt;time.h\u0026gt; #include \u0026lt;signal.h\u0026gt; int counter = 0; void timer_thread(union sigval val) { counter++; printf(\u0026quot;counter = %d\\n\u0026quot;,counter); } int main () { int ret = 0; timer_t timer_id; struct sigevent se; struct itimerspec ts; se.sigev_notify=SIGEV_THREAD; se.sigev_notify_function = timer_thread; se.sigev_notify_attributes = NULL; ret = timer_create(CLOCK_MONOTONIC,\u0026amp;se,\u0026amp;timer_id); if(ret\u0026lt;0) { perror(\u0026quot;timer create failed\\n\u0026quot;); return -1; } ts.it_value.tv_sec = 2; ts.it_value.tv_nsec = 0; ts.it_interval.tv_sec = 2; ts.it_interval.tv_nsec = 0; ret = timer_settime(timer_id,0,\u0026amp;ts,NULL); if(ret\u0026lt;0) { perror(\u0026quot;timer set failed\\n\u0026quot;); return -1; } printf(\u0026quot;...start\\n\u0026quot;); while(counter\u0026lt;5) { sleep(1); } return 0; } ç¼–è¯‘æ—¶è¦å¸¦ -lrt å‚æ•°ï¼Œè¯¥ç¨‹åºçš„è¾“å‡ºæ˜¯ï¼š\n~# gcc test.c -Wall -lpthread -lrt -o test ~# ./test ...start counter = 1 counter = 2 counter = 3 counter = 4 counter = 5 å‚è€ƒ #æµ…æ Linux ä¸­çš„æ—¶é—´ç¼–ç¨‹å’Œå®ç°åŸç†\n","date":"2015 July 1","permalink":"/posts/2015/07/01/","section":"Posts","summary":"1. æ—¶åŒº #Linux ç³»ç»Ÿä¸­é€šè¿‡ /etc/localtime æ–‡ä»¶è®¾ç½®ç³»ç»Ÿæ—¶åŒºï¼Œæ‰€æœ‰çš„æ—¶åŒºæ–‡ä»¶åœ¨ /usr/share/zoneinfo/ ç›®å½•ä¸‹","title":"Linux ç³»ç»Ÿä¸­çš„æ—¶é—´"},{"content":"åŸºç¡€æ•™ç¨‹ï¼š # å»–é›ªå³°çš„ Python 2.7 æ•™ç¨‹ ï¼šhttp://www.liaoxuefeng.com/wiki/001374738125095c955c1e6d8bb493182103fac9270762a000 Python æ ‡å‡†åº“ ï¼š http://python.usyiyi.cn/python_278/library/index.html ç½‘ç»œç¼–ç¨‹ï¼š # Python Socket ç½‘ç»œç¼–ç¨‹ ï¼šhttp://www.jianshu.com/p/49750ca1589d Sockets programming in Python ï¼šhttp://www.ibm.com/developerworks/linux/tutorials/l-pysocks/ Python TCP Communication ï¼šhttps://wiki.python.org/moin/TcpCommunication æ•°æ®åº“ # SQLite æ•™ç¨‹ ï¼šhttp://www.w3cschool.cc/sqlite/sqlite-tutorial.html Pillow # Pillow å¿«é€Ÿå…¥é—¨ ï¼šhttp://pillow-cn.readthedocs.org/zh_CN/latest/handbook/tutorial.html Pillow Tutorial ï¼šhttps://pillow.readthedocs.org/handbook/tutorial.html#cutting-pasting-and-merging-images Pillow Reference ï¼šhttps://pillow.readthedocs.org/reference/index.html Requests # Python Requestsçš„å®‰è£…ä¸ç®€å•è¿ç”¨ ï¼šhttp://www.zhidaow.com/post/python-requests-install-and-brief-introduction Python Requests 1.1.0 å¿«é€Ÿä¸Šæ‰‹ï¼š http://requests-docs-cn.readthedocs.org/zh_CN/latest/user/quickstart.html çˆ¬è™« # Python çˆ¬è™«ç³»åˆ—æ•™ç¨‹ ï¼šhttp://cuiqingcai.com/1052.html Scrapy æ¡†æ¶æ–‡æ¡£ ï¼šhttp://scrapy-chs.readthedocs.org/zh_CN/0.24/index.html ","date":"2015 June 13","permalink":"/posts/2015/06/13/","section":"Posts","summary":"åŸºç¡€æ•™ç¨‹ï¼š # å»–é›ªå³°çš„ Python 2.","title":"Python å­¦ä¹ èµ„æ–™"},{"content":"é¡¹ç›®ä¸»é¡µï¼šhttp://libmodbus.org\nç¨‹åºä¸­å¿…é¡»åŒ…å«å¤´æ–‡ä»¶ï¼Œç¼–è¯‘æ—¶è¿æ¥åˆ° libmodbus ï¼š\n#include \u0026lt;modbus.h\u0026gt; cc `pkg-config --cflags --libs libmodbus` files åœ¨ç¨‹åºä¸­ä½¿ç”¨ libmodbus ä¸»è¦æ˜¯å¦‚ä¸‹å‡ ä¸ªæ­¥éª¤ã€‚\n1. æ–°å»ºç¯å¢ƒ #æ–°å»ºä¸€ä¸ª libmodbus ç¯å¢ƒï¼Œå¦‚æœæ˜¯ä¸²å£è¿æ¥çš„modbusè®¾å¤‡ï¼Œç”¨ modbus_new_rtu() å‡½æ•°ï¼Œå¦‚æœæ˜¯tcpè¿æ¥çš„modbus è®¾å¤‡ï¼Œç”¨ modbus_new_tcp() å‡½æ•°ã€‚å¦‚æœæ–°å»ºæˆåŠŸä¼šè¿”å›ä¸€ä¸ª struct modbus_t æŒ‡é’ˆï¼Œä»¥åæˆ‘ä»¬æ“ä½œmodbusè®¾å¤‡ï¼Œå°±æ˜¯å¯¹è¿™ä¸ªæŒ‡é’ˆè¿›è¡Œæ“ä½œï¼›å¤±è´¥è¿”å›ç©ºæŒ‡é’ˆã€‚\nä¸€ä¸ªç‰©ç†æ¥å£å¯ä»¥è¿æ¥å¤šä¸ª modbus ä»è®¾å¤‡ï¼Œæ¯ä¸ªmodbus ä»è®¾å¤‡æœ‰è‡ªå·±ç‹¬ç«‹çš„ IDï¼Œ å«åšâ€ä»è®¾å¤‡ç¼–å·â€œï¼Œæ˜¯ä¸€ä¸ªæ•´æ•°ã€‚æ‰€æœ‰è¦ç”¨ modbus_set_slave() å‡½æ•°ä¸º modbus_t ç»“æ„è®¾ç½®ä»è®¾å¤‡ç¼–å·ï¼Œè¡¨ç¤ºè¦è¿æ¥çš„æ˜¯å“ªä¸ª modbus è®¾å¤‡ã€‚\né‡Šæ”¾ä¸€ä¸ª libmodbus ç¯å¢ƒï¼Œç”¨ modbus_free() å‡½æ•°ã€‚\n2. è¿æ¥ #æ–°å»ºæˆåŠŸåï¼Œå°±å¯ä»¥å»ºç«‹è¿æ¥ï¼Œç”¨ modbus_connect() å‡½æ•°ã€‚ å…³é—­è¿æ¥ç”¨ modbus_class() å‡½æ•°ã€‚ åˆ·æ–°è¿æ¥ç”¨ modbus_flush() å‡½æ•°ã€‚\n3. è¯»å†™ #è¿æ¥æˆåŠŸåï¼Œå¯ä»¥è°ƒç”¨ç›¸å…³å‡½æ•°å¯¹modbusè®¾å¤‡è¿›è¡Œæ“ä½œã€‚\n4. ç›¸å…³å‡½æ•°è¯´æ˜ # æ–°å»ºä¸€ä¸ª RTU ç±»å‹çš„ libmodbus ç¯å¢ƒï¼Œè¿”å›ä¸€ä¸ª modbus_t ç»“æ„\nmodbus_t *modbus_new_rtu(const char *device, int baud, char parity, int data_bit, int stop_bit); æ–°å»ºä¸€ä¸ª TCP ç±»å‹ çš„ libmodbus ç¯å¢ƒ ï¼Œè¿”å›ä¸€ä¸ª modbus_t ç»“æ„\nmodbus_t *modbus_new_tcp(const char *ip, int port); è®¾ç½® slave id ï¼Œè¿”å›å€¼ EINVAL è¡¨ç¤º slave å€¼æ— æ•ˆ\nint modbus_set_slave(modbus_t *ctx, int slave); ä½¿èƒ½ debug\nvoid modbus_set_debug(modbus_t *ctx, int boolean); å¦‚æœ boolean ä¸º true ï¼Œä¼šä½¿èƒ½ ctx çš„ debug æ ‡å¿—ä½ï¼Œåœ¨ stdout å’Œ stderr ä¸Šæ˜¾ç¤º modbus message ï¼Œä¾‹å¦‚ ï¼š\n[00][14][00][00][00][06][12][03][00][6B][00][03] Waiting for a confirmationâ€¦ \u0026lt;00\u0026gt;\u0026lt;14\u0026gt;\u0026lt;00\u0026gt;\u0026lt;00\u0026gt;\u0026lt;00\u0026gt;\u0026lt;09\u0026gt;\u0026lt;12\u0026gt;\u0026lt;03\u0026gt;\u0026lt;06\u0026gt;\u0026lt;02\u0026gt;\u0026lt;2B\u0026gt;\u0026lt;00\u0026gt;\u0026lt;00\u0026gt;\u0026lt;00\u0026gt;\u0026lt;00\u0026gt; è®¾ç½®æ•…éšœæ¢å¤æ¨¡å¼\nint modbus_set_error_recovery(modbus_t *ctx,modbus_error_recovery_mode error_recovery); å‚æ•° error_recovery å¯ä»¥è®¾ç½®0ï¼Œæˆ–è€…å¦‚ä¸‹çš„å€¼ï¼š\nMODBUS_ERROR_RECOVERY_LINK\nå»ºç«‹ä¸€ä¸ª modbus è¿æ¥ã€‚è¿”å›0è¡¨ç¤ºæˆåŠŸã€‚å¤±è´¥è¿”å› -1\nint modbus_connect(modbus_t *ctx); é‡Šæ”¾ä¸€ä¸ª modbus_t ç»“æ„ã€‚\nvoid modbus_free(modbus_t *ctx); function id 0x01\nint modbus_read_bits(modbus_t *ctx, int addr, int nb, uint8_t *dest); ä½¿ç”¨ modbus åŠŸèƒ½ç  0x01 ï¼Œä» addr è¯»å–è¿ç»­çš„ nb ä¸ªçŠ¶æ€ä½ï¼Œç»“æœæ”¾åœ¨ *dest æŒ‡å‘çš„æ•°ç»„ï¼Œæ¯ä¸ªçŠ¶æ€ä½å ç”¨ä¸€ä¸ªæ•°ç»„å…ƒç´ ï¼ŒçŠ¶æ€ä¸º TRUE æˆ– FALSE ã€‚æˆåŠŸè¿”å› 0 ï¼Œå¤±è´¥è¿”å› -1 ã€‚\nfunction id 0x02\nint modbus_read_input_bits(modbus_t *ctx, int addr, int nb, uint8_t *dest); ä½¿ç”¨ modbus åŠŸèƒ½ç  0x02 ï¼Œä» addr è¯»å– nb ä¸ªè¾“å…¥çŠ¶æ€ä½ï¼Œç»“æœæ”¾åœ¨ *dest æŒ‡å‘çš„æ•°ç»„ï¼Œæ¯ä¸ªçŠ¶æ€ä½å ç”¨ä¸€ä¸ªç´ ç»„å…ƒç´ ï¼ŒçŠ¶æ€ä¸º TRUE æˆ– FALSE ã€‚æˆåŠŸè¿”å› 0 ï¼Œå¤±è´¥è¿”å› -1 ã€‚\nfunction id 0x03\nint modbus_read_registers(modbus_t *ctx, int addr, int nb, uint16_t *dest); ä½¿ç”¨ modbus åŠŸèƒ½ç  0x03 ï¼Œä» addr åœ°å€å¼€å§‹ï¼Œè¯»å–è¿ç»­çš„ nb ä¸ªå¯„å­˜å™¨çš„å€¼ï¼Œä¸€ä¸ªå¯„å­˜å™¨æ˜¯ä¸¤ä¸ªå­—èŠ‚ã€‚ç»“æœå­˜æ”¾åœ¨ dest ã€‚è¿”å›è¯»å–å¯„å­˜å™¨çš„ä¸ªæ•°ï¼Œå¤±è´¥è¿”å› -1 ã€‚\nè®¾å¤‡ä¸Šçš„åœ°å€æ˜¯ä» 1 å¼€å§‹çš„ï¼Œmodbusæ˜¯ä»0å¼€å§‹å¯»å€ï¼Œå¦‚æœè¦è¯»å–1çš„æ•°æ®ï¼Œaddråº”è¯¥è®¾ä¸º0.\nfunction id 0x05\nint modbus_write_bit(modbus_t *ctx, int addr, int status); ä½¿ç”¨ modbus åŠŸèƒ½ç  0x05 ï¼Œå‘ addr å†™ä¸€ä¸ªçŠ¶æ€ï¼šTRUE æˆ– FALSE ï¼ŒæˆåŠŸä¼šè¿”å› 0 ï¼Œå¤±è´¥è¿”å› -1 ã€‚\nfunction id 0x0F\nint modbus_write_bits(modbus_t *ctx, int addr, int nb, const uint8_t *src); ä½¿ç”¨ modbus åŠŸèƒ½ç  0x0F ï¼Œå°† *src æŒ‡å‘çš„æ•°ç»„å†™å…¥ä» addr å¼€å§‹çš„ nb ä¸ªçŠ¶æ€ä½ï¼Œæ•°ç»„å…ƒç´ çš„å€¼åº”è¯¥æ˜¯ TRUE æˆ– FALSE ï¼Œæ¯ä¸ªå…ƒç´ å¯¹åº”ä¸€ä¸ªçŠ¶æ€ä½ã€‚æˆåŠŸä¼šè¿”å› 0 ï¼Œå¤±è´¥è¿”å› -1 ã€‚\nfunction id 0x06\nint modbus_write_register(modbus_t *ctx, int addr, int value); ä½¿ç”¨ modbus åŠŸèƒ½ç  0x06 ï¼Œå°† value å†™å…¥åœ°å€ä¸º addr çš„ä¸€ä¸ªå¯„å­˜å™¨ä¸­ã€‚æˆåŠŸä¼šè¿”å› 1 ï¼Œå¤±è´¥è¿”å› -1 ã€‚\n","date":"2015 May 24","permalink":"/posts/2015/05/24/","section":"Posts","summary":"é¡¹ç›®ä¸»é¡µï¼šhttp://libmodbus.org","title":"Libmodbus ç¼–ç¨‹è¯´æ˜"},{"content":" é¡¹ç›®ä¸»é¡µï¼šhttp://hardysimpson.github.io/zlog/ ä¸‹è½½åœ°å€ï¼šhttps://github.com/HardySimpson/zlog/releases ä¸­æ–‡ä½¿ç”¨æ‰‹å†Œï¼šhttp://hardysimpson.github.io/zlog/UsersGuide-CN.html ä¸‹è½½åè§£å‹å®‰è£…ï¼š\n[21:15]Workspace/ â¯ tar xvf zlog-latest-stable.tar.gz [21:16]Workspace/ â¯ cd zlog-latest-stable [21:17]zlog-latest-stable/ â¯ make ","date":"2015 February 6","permalink":"/posts/2015/02/06/","section":"Posts","summary":"é¡¹ç›®ä¸»é¡µï¼šhttp://hardysimpson.","title":"C è¯­è¨€æ—¥å¿—å‡½æ•°åº“ zlog"},{"content":"Shadowsocks å¯ä»¥ä¸ºæµè§ˆå™¨ï¼Œæ”¯æŒä»£ç†æœåŠ¡å™¨çš„è½¯ä»¶ï¼ˆä¾‹å¦‚ Dropboxï¼‰æä¾›ä»£ç†æœåŠ¡ã€‚\né¦–å…ˆè´­ä¹°ä¸€ä¸ªä»˜è´¹çš„ Shadowsocks æœåŠ¡è´¦å·ï¼Œæ¨è https://shadowsocks.comï¼Œä¸é™æµé‡ï¼Œé€Ÿåº¦è¿˜ä¸é”™ã€‚è´­ä¹°åä¼šæä¾›å¤šä¸ªå¯ç”¨çš„æœåŠ¡å™¨åœ°å€ï¼Œç«¯å£ï¼Œå¯†ç å’ŒåŠ å¯†æ–¹å¼ã€‚\næ¬¢è¿ä½¿ç”¨æˆ‘çš„æ¨å¹¿é“¾æ¥ï¼šhttps://portal.shadowsocks.com/aff.php?aff=424\nä¸‹è½½ OS X å®¢æˆ·ç«¯ï¼šShadowsocksXã€‚å®‰è£…åå¯åŠ¨ï¼Œé€‰æ‹© â€œæ‰“å¼€æœåŠ¡å™¨è®¾å®šâ€ ï¼š\næ·»åŠ æœåŠ¡å™¨ï¼Œè¾“å…¥æœåŠ¡å•†æä¾›çš„åŸŸåï¼Œç«¯å£ï¼Œå¯†ç ï¼š\nç„¶åå°±å¯ä»¥ç§‘å­¦ä¸Šç½‘äº†ã€‚å®¢æˆ·ç«¯å·²ç»é›†æˆäº† GFWList ï¼Œå¯ä»¥è‡ªåŠ¨è¯†åˆ«è®¿é—®åœ°å€ï¼Œå¢™å†…åœ°å€èµ°å›½å†…è·¯å¾„ï¼Œå¢™å¤–åœ°å€èµ°ä»£ç†æœåŠ¡å™¨ã€‚å¯ä»¥æ·»åŠ å¤šä¸ªæœåŠ¡å™¨ï¼Œæ„Ÿè§‰æ—¥æœ¬çš„èŠ‚ç‚¹é€Ÿåº¦æ›´å¿«ã€‚\nDropbox å·²ç»å®Œå…¨è¢«å¢™ï¼Œä¿®æ”¹ hosts ä¹Ÿæ— æ³•è¿æ¥ï¼Œåªèƒ½ç”¨ä»£ç†ã€‚æ‰“å¼€ â€œé¦–é€‰é¡¹â€ ï¼Œåœ¨â€œç½‘ç»œâ€æ ‡ç­¾ä¸­é€‰æ‹© â€œä»£ç†æœåŠ¡å™¨è®¾ç½®â€ï¼Œæ‰‹åŠ¨è®¾ç½®æœåŠ¡å™¨ç±»å‹ä¸º SOCK5 ï¼ŒæœåŠ¡å™¨åœ°å€ 127.0.0.1 ï¼Œç«¯å£ 1080ï¼š\nç‚¹å‡» â€œæ›´æ–°â€ï¼ŒDropbox å°±å¤æ´»äº†ã€‚\n","date":"2015 January 20","permalink":"/posts/2015/01/20/","section":"Posts","summary":"Shadowsocks å¯ä»¥ä¸ºæµè§ˆå™¨ï¼Œæ”¯æŒä»£ç†æœåŠ¡å™¨çš„è½¯ä»¶ï¼ˆä¾‹å¦‚ Dropboxï¼‰æä¾›ä»£ç†æœåŠ¡ã€‚","title":"ç§‘å­¦ä¸Šç½‘åˆ©å™¨ Shadowsocks"},{"content":"OS X Yosemite æ–°å¢äº†ä¸€ä¸ªé€šçŸ¥ä¸­å¿ƒï¼Œå¯ä»¥åœ¨ä¸Šé¢æ”¾ä¸€äº›å°éƒ¨ä»¶ã€‚è€Œ Today Script è¿™ä¸ªå°éƒ¨ä»¶å¯ä»¥è®©ä½ å†™è‡ªå·±çš„è„šæœ¬ï¼Œåœ¨é€šçŸ¥æ æ˜¾ç¤ºè‡ªå·±æƒ³è¦çš„ä¸œè¥¿ã€‚\nä¸»é¡µï¼šhttps://github.com/SamRothCA/Today-Scripts è„šæœ¬åˆ—è¡¨ï¼šhttps://github.com/SamRothCA/Today-Scripts/wiki åœ¨ä¸»é¡µä¸Šç‚¹å‡»ä¸‹è½½é“¾æ¥ï¼Œä¸‹è½½ä¸€ä¸ªå‹ç¼©åŒ…ï¼šToday-Scripts.tar.gzï¼Œè§£å‹å¾—åˆ° Today Scripts.app ï¼Œæ”¾åˆ°åº”ç”¨ç¨‹åºæ–‡ä»¶å¤¹å†…ï¼Œç„¶åæ‰“å¼€ã€‚åœ¨é€šçŸ¥ä¸­å¿ƒå°±ä¼šå‡ºç° Scripts :\nç‚¹å‡»åŠ å·ï¼ŒæŠŠå®ƒæ·»åŠ åˆ°é€šçŸ¥æ ã€‚æŒ‰ç…§æç¤ºï¼Œç‚¹å‡»å³ä¸Šè§’çš„ Info å›¾æ ‡æ¥æ·»åŠ ä¸€ä¸ªè„šæœ¬ï¼š\næ·»åŠ ä¸€ä¸ªæ˜¾ç¤ºå½“å‰æœˆä»½çš„å‘½ä»¤ï¼š\ncal | grep --before-context 6 --after-context 6 --color -e \u0026quot; $(date +%e)\u0026quot; -e \u0026quot;^$(date +%e)\u0026quot; è®°å¾—å†™ä¸Šæ ‡é¢˜ï¼š\næ•ˆæœå¦‚ä¸‹ï¼š\n","date":"2015 January 10","permalink":"/posts/2015/01/10/","section":"Posts","summary":"OS X Yosemite æ–°å¢äº†ä¸€ä¸ªé€šçŸ¥ä¸­å¿ƒï¼Œå¯ä»¥åœ¨ä¸Šé¢æ”¾ä¸€äº›å°éƒ¨ä»¶ã€‚è€Œ Today Script è¿™ä¸ªå°éƒ¨ä»¶å¯ä»¥è®©ä½ å†™è‡ªå·±çš„è„šæœ¬ï¼Œåœ¨é€šçŸ¥æ æ˜¾ç¤ºè‡ªå·±æƒ³è¦çš„ä¸œè¥¿ã€‚","title":"Today Scripts â€”â€” é€šè¿‡è„šæœ¬æ‰“é€ è‡ªå·±çš„é€šçŸ¥æ éƒ¨ä»¶"},{"content":"Lua ï¼ˆè‹±è¯­å‘éŸ³ï¼š/ËˆluËÉ™/ï¼‰æ˜¯ä¸€ç§è½»é‡çº§çš„è„šæœ¬è¯­è¨€ï¼Œå¯ä»¥æ–¹ä¾¿çš„åµŒå…¥åˆ°å…¶ä»–è¯­è¨€ä¸­ï¼Œå¾ˆæ˜“å­¦ä¹ ã€‚å®ƒæ˜¯ç”¨Cè¯­è¨€ç¼–å†™çš„ã€‚å¹¿æ³›åº”ç”¨äºæ¸¸æˆå’Œ web å¼€å‘ä¸­ã€‚æ®è¯´ Adobe Photoshop Lightroom ä¸­ 50% çš„ä»£ç æ˜¯æœ‰ Lua å†™çš„ã€‚æˆ‘å­¦ä¹ è¿™ä¸ªè¯­è¨€æ˜¯å› ä¸ºç›®å‰çš„é¡¹ç›®è¦ç”¨åˆ° LuCI ã€‚\nLua çš„ä¸»é¡µï¼šhttp://www.lua.org ä¸­å›½å¼€å‘è€…è®ºå›ï¼šhttp://www.luaer.cn Lua ç¨‹åºè®¾è®¡ï¼šhttp://book.luaer.cn Lua åœ¨çº¿æ‰‹å†Œï¼šhttp://manual.luaer.cn é…·å£³çš„ Lua ç®€æ˜æ•™ç¨‹ï¼šhttp://coolshell.cn/articles/10739.html 1.Hello World #Mac å¹³å°é»˜è®¤å·²ç»å®‰è£…äº† Lua , ç›´æ¥æ‰§è¡Œ lua å°±å¯ä»¥è¿›å…¥å®ƒçš„ shell , é¦–å…ˆè¾“å‡ºä¸€ä¸ª Hello World , è¯­æ³•å¾ˆåƒ C , ç»“å°¾æœ‰æ²¡æœ‰åˆ†å·éƒ½å¯ä»¥ï¼š\n[18:54]~/ â¯ lua Lua 5.2.3 Copyright (C) 1994-2013 Lua.org, PUC-Rio \u0026gt; print(\u0026quot;Hello World\u0026quot;) Hello World \u0026gt; ä¹Ÿå¯ä»¥å†™ä¸€ä¸ªè„šæœ¬æ–‡ä»¶ï¼Œç›´æ¥æ‰§è¡Œï¼š\n[18:57]Workspace/ â¯ cat test.lua #!/usr/local/bin/lua print(\u0026quot;Hello World\u0026quot;) [18:57]Workspace/ â¯ ./test.lua Hello World 2.åŸºæœ¬è¯­æ³• #æ³¨é‡Š #ä¸¤ä¸ªå‡å·æ˜¯è¡Œæ³¨é‡Šï¼Œä¸¤ä¸ªå‡å·åŠ æ–¹æ‹¬å·æ˜¯å—æ³¨é‡Šï¼š\n#!/usr/local/bin/lua --è¡Œæ³¨é‡Š --[[ å—æ³¨é‡Š --]] print(\u0026quot;Hello World\u0026quot;) æ•°æ®ç±»å‹å’Œå˜é‡ #Lua æ”¯æŒåŠ¨æ€æ•°æ®ç±»å‹ï¼Œå®šä¹‰å˜é‡æ—¶æ— éœ€å£°æ˜ç±»å‹ï¼Œå‡ ä¸ªåŸºæœ¬çš„æ•°æ®ç±»å‹æœ‰ï¼š\nå­—ç¬¦ä¸²ï¼Œç”¨å¼•å·åŒ…å«ï¼Œå•å¼•å·å’ŒåŒå¼•å·éƒ½å¯ä»¥ï¼›Lua è¿˜æ”¯æŒ C è¯­è¨€ç±»å‹çš„è½¬ä¹‰å­—ç¬¦ï¼Œä¾‹å¦‚ \\n æ¢è¡Œï¼Œ\\r å›è½¦ å®æ•°ï¼ŒLua çš„æ•°åªæœ‰ double å‹ï¼Œ64 bits æµ®ç‚¹æ•° å¸ƒå°”ï¼Œtrue å’Œ false ç©ºï¼ŒLua çš„ç©ºç±»å‹ç”¨ nil è¡¨ç¤ºï¼Œæ²¡æœ‰å£°æ˜è¿‡çš„å˜é‡å°±æ˜¯ nil type æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒä¼šè¿”å›æ•°æ®çš„ç±»å‹\nLua ä¸­çš„å˜é‡åˆ†ä¸ºå…¨å±€å˜é‡å’Œå±€éƒ¨å˜é‡ï¼ŒæœªåŠ è¯´æ˜çš„éƒ½æ˜¯å…¨å±€å˜é‡ï¼Œç”¨ local å…³é”®å­—å®šä¹‰å±€éƒ¨å˜é‡ ï¼š\ntheGlobalVar = 50 local theLocalVar = \u0026quot;local variable\u0026quot; è¡¨è¾¾å¼ #Lua çš„è¡¨è¾¾å¼ç”±æ•°å­—ï¼Œå­—ç¬¦ä¸²ï¼Œå˜é‡ï¼Œè¿ç®—ç¬¦ç»„æˆï¼Œè¿ç®—ç¬¦åˆ†ä¸ºå‡ ä¸ªç±»åˆ«ï¼Œå’Œ C è¯­è¨€å¾ˆåƒï¼š\næ•°å­¦è¿ç®—ç¬¦ï¼š+-*/^ (åŠ å‡ä¹˜é™¤å¹‚ï¼‰ï¼Œ- (è´Ÿå·ï¼‰ï¼Œè¿™äº›è¿ç®—ç¬¦åªèƒ½ç”¨äºå®æ•° å…³ç³»è¿ç®—ç¬¦ï¼š\u0026lt; ï¼Œ\u0026gt; ï¼Œ\u0026lt;= ï¼Œ\u0026gt;= ï¼Œ== ï¼Œè¿˜æœ‰ä¸€ä¸ª ~= è¡¨ç¤ºä¸ç­‰ï¼›æ¯”è¾ƒç»“æœè¿”å› true æˆ– false ï¼›å¦‚æœä¸¤ä¸ªå€¼çš„ç±»å‹ä¸åŒï¼Œé‚£ä¹ˆä¸€å®šæ˜¯ä¸ç­‰çš„ï¼Œnil ä¹‹å’Œè‡ªå·±ç›¸ç­‰ï¼›æ¯”è¾ƒå­—ç¬¦ä¸²æ—¶ï¼Œæ˜¯æŒ‰ç…§å­—æ¯çš„é¡ºåºè¿›è¡Œçš„ é€»è¾‘è¿ç®—ç¬¦ï¼šand , or , not ï¼›not åªä¼šè¿”å› true å’Œ falseï¼Œé™¤äº† false å’Œ nil ï¼Œå…¶ä»–éƒ½æ˜¯ true ï¼Œæ‰€ä»¥ not nil å°±æ˜¯ tureã€‚and å’Œ or è¿”å›çš„ç»“æœä¸æ˜¯ true æˆ– falseï¼Œè€Œæ˜¯å’Œæ“ä½œæ•°æœ‰å…³ï¼ša and b \u0026ndash; å¦‚æœaä¸ºfalseï¼Œåˆ™è¿”å›aï¼Œå¦åˆ™è¿”å›bï¼›a or b \u0026ndash; å¦‚æœaä¸ºtrueï¼Œåˆ™è¿”å›aï¼Œå¦åˆ™è¿”å›b è¿æ¥è¿ç®—ç¬¦ï¼š..(ä¸¤ä¸ªç‚¹)ï¼Œç”¨äºè¿æ¥å­—ç¬¦ä¸²ï¼Œå¦‚æœæ“ä½œç¬¦æ˜¯æ•°å­—ï¼Œä¼šè¿æ¥åè½¬ä¸ºå­—ç¬¦ä¸²ã€‚ æ§åˆ¶è¯­å¥ #if è¯­å¥\nif conditions then then-part end; if conditions then then-part else else-part end; if conditions then then-part elseif conditions then elseif-part .. ---\u0026gt;å¤šä¸ªelseif else else-part end; while å¾ªç¯\nwhile condition do statements; end; for å¾ªç¯\nfor var=exp1,exp2,exp3 do loop-part end exp1 æ˜¯åˆå§‹å€¼ï¼Œexp2 æ˜¯ç»ˆæ­¢å€¼ï¼Œexp3æ˜¯æ¯ä¸€æ­¥çš„é—´éš”ï¼Œå¦‚æœexp3ï¼Œé»˜è®¤æ˜¯1ï¼Œä¾‹å¦‚ï¼š\nå‡½æ•° #å‡½æ•°çš„å®šä¹‰ä»¥ function å…³é”®å­—å¼€å¤´ï¼Œä»¥ end ç»“å°¾ï¼Œå¯ä»¥è¿”å›å¤šä¸ªå€¼ã€‚\nLua æœ‰ä¸ªç‰¹åˆ«çš„è¯­æ³•ï¼Œå°±æ˜¯å¯ä»¥ä¸€è¡Œä¸ºå¤šä¸ªå˜é‡èµ‹å€¼ï¼Œé‚£ä¹ˆå¤šä¸ªè¿”å›å€¼å°±å¯ä»¥ä¾æ¬¡èµ‹ç»™å¤šä¸ªå˜é‡ã€‚å¦‚æœå€¼çš„æ•°é‡æ¯”å˜é‡å¤šï¼Œå¤šä½™çš„ä¼šèˆå¼ƒï¼›å¦‚æœå˜é‡æ¯”å€¼å¤šï¼Œåé¢çš„å˜é‡ä¼šè¢«èµ‹ nil ã€‚\n","date":"2015 January 7","permalink":"/posts/2015/01/07/","section":"Posts","summary":"Lua ï¼ˆè‹±è¯­å‘éŸ³ï¼š/ËˆluËÉ™/ï¼‰æ˜¯ä¸€ç§è½»é‡çº§çš„è„šæœ¬è¯­è¨€ï¼Œå¯ä»¥æ–¹ä¾¿çš„åµŒå…¥åˆ°å…¶ä»–è¯­è¨€ä¸­ï¼Œå¾ˆæ˜“å­¦ä¹ ã€‚å®ƒæ˜¯ç”¨Cè¯­è¨€ç¼–å†™çš„ã€‚å¹¿æ³›åº”ç”¨äºæ¸¸æˆå’Œ web å¼€å‘ä¸­ã€‚æ®è¯´ Adobe Photoshop Lightroom ä¸­ 50% çš„ä»£ç æ˜¯æœ‰ Lua å†™çš„ã€‚æˆ‘å­¦ä¹ è¿™ä¸ªè¯­è¨€æ˜¯å› ä¸ºç›®å‰çš„é¡¹ç›®è¦ç”¨åˆ° LuCI ã€‚","title":"Luaè¯­è¨€å­¦ä¹ ç¬”è®°"},{"content":"2014å¹´çš„æœ€åä¸€å¤©äº†\nè¿™ä¸€å¹´ï¼Œå¾—åˆ°äº†ä¸€äº›ï¼Œå¤±å»äº†å¾ˆå¤šï¼Œèµšäº†ä¸€ç‚¹é’±ï¼Œè™šåº¦äº†å¾ˆå¤šç¾å¥½çš„æ—¶å…‰ã€‚åœ¨æŸä¸ªçªç„¶é†’æ¥çš„é»æ˜ï¼Œå°±åœ¨æƒ³ï¼Œåº”è¯¥æŠŠç”Ÿå‘½ä¸­æœ€å¥½çš„æ—¶å…‰ç•™ç»™æœ€çˆ±çš„äººï¼Œè¿™æ¯”ä»€ä¹ˆéƒ½é‡è¦ã€‚\nè¿™ä¸€å¹´çš„æœ€åä¸€ä¸ªæœˆï¼Œæˆ‘åœ¨è¿™ä¸ªåŸå¸‚ä¹°äº†ä¸€å¥—æˆ¿å­ï¼Œäººç”Ÿä¸­çš„ç¬¬ä¸€å¥—æˆ¿ã€‚12æœˆ2æ—¥æ™šä¸Š11ç‚¹ï¼Œåœ¨åˆåŒä¸Šå†™ä¸‹è‡ªå·±çš„åå­—ï¼Œå›æ¥çš„è·¯ä¸Šä¸‹ç€å°é›¨ã€‚\nè¿™ä¸€å¹´çš„æ—¥å¿—å†™çš„å¤ªå°‘ï¼Œå¯èƒ½æ˜¯å› ä¸ºæˆ‘æ²¡å­¦åˆ°ä»€ä¹ˆä¸œè¥¿ï¼Œå¸Œæœ›æ˜å¹´ä¼šå¥½ä¸€ç‚¹ã€‚\n","date":"2014 December 31","permalink":"/posts/2014/12/31/","section":"Posts","summary":"2014å¹´çš„æœ€åä¸€å¤©äº†","title":"2014-12-31"},{"content":"ç”µè„‘çš„éŸ³é¢‘è¾“å…¥é€šå¸¸æœ‰ä¸¤ä¸ªé€šé“ï¼šMic å’Œ Line inã€‚Micå°±æ˜¯éº¦å…‹é£ï¼ŒLine in ç”¨äºè¿æ¥æœªç»æ”¾å¤§çš„æ¨¡æ‹ŸéŸ³é¢‘ä¿¡å·ï¼Œä¾‹å¦‚ Mp3 æ’­æ”¾å™¨çš„è€³æœºæ’å­”ï¼Œå¯ä»¥å°†å…¶è¿æ¥åˆ° PC çš„ Line in æ’å­”ã€‚\nLinux ä¸Šåªè¦ç”¨ alsa ç®¡ç†å£°å¡ï¼Œå®ƒè¿˜æä¾›å¾ˆå¤šå·¥å…·ï¼Œalsamixerç”¨äºé…ç½®éŸ³é¢‘çš„å„ä¸ªå‚æ•°ï¼ŒåŸºäºæ–‡æœ¬ä¸‹çš„å›¾å½¢ç•Œé¢ã€‚\nåœ¨å‘½ä»¤è¡Œè¾“å…¥ alsamixer å°±å¯ä»¥å¯åŠ¨å®ƒçš„ç•Œé¢ï¼Œç„¶åæŒ‰ F6 å°±å¯ä»¥çœ‹åˆ°å½“å‰ç³»ç»Ÿçš„ç½‘å¡ï¼Œæ¯ä¸ªç½‘å¡éƒ½ç”±ä¸€ä¸ªç‹¬ç«‹çš„æ•°å­— ID ï¼š\nè¿™é‡Œçš„ç½‘å¡æ˜¯ HDA Intelï¼ŒID æ˜¯ 0ã€‚\namixer æ˜¯ alsamixer çš„å‘½ä»¤è¡Œæ¨¡å¼ã€‚\nå…ˆçœ‹çœ‹ amixer çš„è¯­æ³•ï¼š\nç”¨ amixer -c 0 scontrols å°±å¯ä»¥çœ‹åˆ° ID ä¸º 0 çš„ç½‘å¡çš„æ‰€æœ‰å¯é…ç½®æ¥å£ï¼š\nç”¨ scontents å¯ä»¥æŸ¥çœ‹è¿™äº›æ¥å£çš„è¯¦ç»†å†…å®¹ï¼ŒåŒ…æ‹¬å¯é€‰çš„é€‰é¡¹å’Œå½“å‰çš„é€‰é¡¹ï¼š\nç”¨ sget å¯ä»¥æŸ¥çœ‹æŸä¸ªæ¥å£çš„è¯¦ç»†ä¿¡æ¯ï¼Œç„¶åæœ‰ sset å°±å¯ä»¥è®¾ç½®ï¼š\nå¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒInput source æœ‰ä¸‰ä¸ªé€šé“å¯é€‰ï¼šMic ï¼ŒFront Micï¼ŒLineã€‚Line å°±è¡¨ç¤º Line in ã€‚ç”¨ sset è®¾ç½®å…·ä½“é€šé“åï¼Œå°±å¯ä»¥ç”¨ arecord å¯¹ç›¸åº”é€šé“å½•éŸ³ã€‚\n","date":"2014 October 26","permalink":"/posts/2014/10/26/","section":"Posts","summary":"ç”µè„‘çš„éŸ³é¢‘è¾“å…¥é€šå¸¸æœ‰ä¸¤ä¸ªé€šé“ï¼šMic å’Œ Line inã€‚Micå°±æ˜¯éº¦å…‹é£ï¼ŒLine in ç”¨äºè¿æ¥æœªç»æ”¾å¤§çš„æ¨¡æ‹ŸéŸ³é¢‘ä¿¡å·ï¼Œä¾‹å¦‚ Mp3 æ’­æ”¾å™¨çš„è€³æœºæ’å­”ï¼Œå¯ä»¥å°†å…¶è¿æ¥åˆ° PC çš„ Line in æ’å­”ã€‚","title":"åœ¨ Linux ä¸­ä½¿ç”¨ amixer è®¾ç½® Input source"},{"content":"Mapbox æƒ³è¦æ„å»ºä¸–ç•Œä¸Šæœ€æ¼‚äº®çš„åœ°å›¾ã€‚æ”¯æŒå¤šç§å¹³å°ï¼Œå¯ä»¥å…è´¹åˆ›å»ºå¹¶å®šåˆ¶ä¸ªæ€§åŒ–çš„åœ°å›¾ï¼Œå®ç°éå¸¸ç»šä¸½çš„æ•ˆæœã€‚\nä¸»é¡µï¼šhttp://www.mapbox.com è¿™é‡Œæœ‰ä¸€ä¸ªä»‹ç»ï¼šhttp://www.pingwest.com/demo/mapbox å®šåˆ¶è‡ªå·±çš„åœ°å›¾ #é¦–å…ˆè¦æ³¨å†Œä¸€ä¸ªè´¦å·ï¼Œç„¶ååœ¨ä¸»é¡µé¢ä¸Šæ–¹ç‚¹å‡» Project ï¼Œè¿›å…¥åˆ°å¦‚ä¸‹ç•Œé¢ï¼Œç‚¹å‡» Create project å°±å¯ä»¥æ–°å»ºä¸€ä¸ªè‡ªå·±çš„åœ°å›¾ã€‚\næˆ‘æ–°å»ºäº†ä¸€ä¸ª My First Map ã€‚ç‚¹å‡»å®ƒï¼Œå°±å¯ä»¥è¿›å…¥ç¼–è¾‘ç•Œé¢ï¼Œå·¦ä¸Šæ–¹æ˜¯å®šåˆ¶åœ°å›¾æ‰€éœ€çš„å·¥å…·ï¼š\nStyle # è¿™ä¸ªæ ‡ç­¾ç”¨æ¥è®¾ç½®åœ°å›¾çš„æ ·å¼ï¼ŒåŒ…æ‹¬ï¼š\nColor ï¼šè®¾ç½®è¡—é“ï¼Œç»¿åœ°ï¼Œå»ºç­‘ï¼Œæ°´åœ¨åœ°å›¾ä¸Šæ˜¾ç¤ºçš„é¢œè‰²ã€‚ Baselayer ï¼šè®¾ç½®åœ°å›¾çš„åŸºæœ¬å›¾å±‚ï¼Œæœ‰è¡—é“åœ°å›¾ï¼Œåœ°å½¢å›¾å’Œå«æ˜Ÿå›¾ã€‚ Language ï¼šè®¾ç½®åœ°å›¾çš„è¯­è¨€ï¼ŒLocalized è¡¨ç¤ºæœ¬åœ°è¯­è¨€ã€‚ Data # è¿™ä¸ªæ ‡ç­¾ç”¨æ¥å‘åœ°å›¾æ·»åŠ è‡ªå®šä¹‰çš„æ•°æ®ï¼ŒåŒ…æ‹¬ï¼š\nMarker ï¼šç‚¹çŠ¶æ ‡è®°ã€‚ Line ï¼šçº¿ï¼Œè½¨è¿¹ã€‚ Poygon ï¼šä¸€å—å›¾å½¢ï¼Œæˆ–è€…åŒºåŸŸã€‚ å¦å¤–ï¼Œç‚¹å‡»ä¸‹æ–¹çš„ import ï¼Œå¯ä»¥å¯¼å…¥ csv ã€kml ã€gpx æ ¼å¼çš„æ•°æ®æ–‡ä»¶ã€‚\nProject # è¿™ä¸ªæ ‡ç­¾ä¸­å¯ä»¥è®¾ç½®åœ°å›¾åç§°å’Œæè¿°ï¼Œè¿˜å¯ä»¥åœ¨æ­¤ä¸‹è½½å’Œåˆ†äº«åœ°å›¾ã€‚\nInfo ï¼šData æ å¯ä»¥é€‰æ‹©ä¸‹è½½ GeoJSON æˆ– KML æ ¼å¼çš„åœ°å›¾æ–‡ä»¶ã€‚Map ID æ˜¯è¿™ä¸ªåœ°å›¾çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç”¨äºå¼€å‘ã€‚Share æ æ˜¯è¯¥åœ°å›¾çš„åˆ†äº«é“¾æ¥ã€‚Embed æ˜¯è¯¥åœ°å›¾åµŒå…¥ Web é¡µé¢çš„ä»£ç ï¼Œä¸‹é¢å¯ä»¥é€‰æ‹©é¡µé¢ä¸­æ˜¯å¦æ˜¾ç¤ºæ”¾å¤§ç¼©å°ï¼Œæœç´¢å’Œåˆ†äº«é“¾æ¥æŒ‰é’®ã€‚ Settings ï¼šè®¾ç½®åœ°å›¾åç§°å’Œæè¿°ã€‚ Advanced ï¼šè¿™é‡Œæœ‰ä¸¤ä¸ªé€‰é¡¹ï¼Œé€‰ä¸­ Save current map position åï¼Œé€šè¿‡åˆ†äº«çš„åœ°å›¾ä¼šæ˜¾ç¤ºç°åœ¨æ‰€é€‰çš„ä½ç½®å’Œå¤§å°ã€‚é€‰ä¸­ Hind Project frome public API ï¼Œé€šè¿‡åˆ†äº«çš„åœ°å›¾å¯ä»¥çœ‹åˆ°åœ¨ Data ä¸­æ·»åŠ çš„æ•°æ®ã€‚ ä¿®æ”¹åœ°å›¾åä¸€å®šè¦ç‚¹å‡»ä¸Šæ–¹çš„ Save ä¿å­˜ã€‚\n","date":"2014 October 9","permalink":"/posts/2014/10/09/","section":"Posts","summary":"Mapbox æƒ³è¦æ„å»ºä¸–ç•Œä¸Šæœ€æ¼‚äº®çš„åœ°å›¾ã€‚æ”¯æŒå¤šç§å¹³å°ï¼Œå¯ä»¥å…è´¹åˆ›å»ºå¹¶å®šåˆ¶ä¸ªæ€§åŒ–çš„åœ°å›¾ï¼Œå®ç°éå¸¸ç»šä¸½çš„æ•ˆæœã€‚","title":"ä¸ªæ€§åŒ–å®šåˆ¶åœ°å›¾ â€”â€” Mapbox"},{"content":"1.é”®ç›˜æ“ä½œ #ä½¿ç”¨ Macbook ï¼Œæ²¡æœ‰åˆé€‚çš„é¼ æ ‡ï¼Œç”¨äº†å¤–æ¥é”®ç›˜åï¼Œè§¦æ‘¸æ¿ä¹Ÿç¦»å¾—è¿œäº†ï¼Œå°½é‡æ˜¯ç”¨é”®ç›˜æ“ä½œï¼Œç†Ÿç»ƒåæ•ˆç‡å¾ˆé«˜ã€‚\næŒ‰ F1 é”®æ‰“å¼€ Spotlight ,è¾“å…¥è¦æ‰“å¼€çš„ç¨‹åºåç§°ï¼ŒåŒæ ·é€‚ç”¨äºæœç´¢å¹¶æ‰“å¼€æ–‡ä»¶ã€‚\nMac é”®ç›˜å¿«æ·é”® ï¼šhttps://support.apple.com/zh-cn/HT201236\nå¸¸ç”¨å¿«æ·é”® # command + shift + f ï¼šå…¨å±æ˜¾ç¤ºå½“å‰çª—å£ command + q ï¼šé€€å‡ºå½“å‰ç¨‹åº command + w ï¼š å…³é—­å½“å‰çª—å£æˆ–æ ‡ç­¾é¡µ command + t ï¼š æ–°å»ºçª—å£æˆ–æ ‡ç­¾é¡µ command + n ï¼š æ–°å»ºçª—å£ command + shift + 4 ï¼šæˆªå±ï¼Œå¦‚æœå†æŒ‰ä¸€æ¬¡ç©ºæ ¼ï¼Œé¼ æ ‡ä¼šå˜æˆç›¸æœºå›¾æ ‡ï¼Œå¯ä»¥é€‰æ‹©è¦è§£å–çš„ç¨‹åºçª—å£ Safari å¿«æ·é”® # command + option + f ï¼šé€‰æ‹©åˆ°åœ°å€æ  command + option + 2 ï¼šæ‰“å¼€å†å²è®°å½• command + d ï¼šæ”¶è—å½“å‰é¡µé¢ 2. å¸¸ç”¨è½¯ä»¶ #Keka â€”â€” å…è´¹å¼€æºçš„æ–‡ä»¶è§£å‹ç¼©è½¯ä»¶ # http://www.kekaosx.com/ è‹¹æœç³»ç»Ÿè‡ªå¸¦çš„å‹ç¼©è½¯ä»¶åŠŸèƒ½å¤ªå•ä¸€ï¼Œè€Œä¸”å‹ç¼©åçš„ zip æ–‡ä»¶åœ¨ windows ä¸‹ä¼šå‡ºç°ä¹±ç ï¼Œå¯¼è‡´è¯†åˆ«æ–‡ä»¶æŸåã€‚\nKeka æ”¯æŒå¤šç§å‹ç¼©æ ¼å¼ï¼š 7zï¼Œzipï¼Œtarï¼Œgzip ã€‚\nMou â€”â€” å…è´¹ Markdown ç¼–è¾‘å™¨ # mouapp.com Mou ç¼–è¾‘å™¨çš„ç•Œé¢éå¸¸ç®€æ´ï¼Œåˆ†ä¸ºå·¦å³ä¸¤éƒ¨åˆ†ï¼Œåœ¨å·¦æ å†™ Markdown ä»£ç ï¼Œå³ä¾§å°±èƒ½å®æ—¶æ˜¾ç¤ºè¾“å‡ºæ•ˆæœã€‚è¿˜å¯ä»¥è®¾ç½®å¤šç§ç¼–è¾‘å™¨ä¸»é¢˜å’Œ CSS æ ·å¼ï¼Œæ”¯æŒå¯¼å‡º HTML å’Œ PDF æ–‡æ¡£ã€‚\nè¯¥è½¯ä»¶çš„ä½œè€…æ˜¯ 80 åå›½äººã€‚\nOnyx â€”â€” å…è´¹çš„ç³»ç»Ÿç»´æŠ¤è½¯ä»¶ # http://www.onyxmac.com/ Onyx å¯ä»¥å®ç°å¾ˆå¤š â€œç³»ç»Ÿåå¥½è®¾ç½®â€ é‡Œæ²¡æœ‰æä¾›çš„è®¾ç½®ï¼Œä¾‹å¦‚é»˜è®¤çš„æˆªå±ä¿æŒè·¯å¾„ã€‚\nbrew â€”â€” OS X çš„åŒ…ç®¡ç†å™¨ # http://brew.sh/ ç”¨äºä»å¼€æºç¤¾åŒºå®‰è£…å„ç§åŒ…ã€‚é€šè¿‡ brew å®‰è£…åˆ°åŒ…éƒ½ä½äº /usr/local/ ç›®å½•ä¸‹ï¼Œä¸ä¼šä¸ç³»ç»Ÿå·²æœ‰çš„è½¯ä»¶äº§ç”Ÿå¹²æ‰°ã€‚\nxmarks # www.xmarks.com åœ¨ Mac ä¸Šä¸»è¦ä½¿ç”¨ Safari æµè§ˆå™¨ï¼Œåœ¨ Windows å¹³å°ä¸»è¦ä½¿ç”¨ Chrome ã€‚xmarks å¯ä»¥å®ç°å¤šä¸ªæµè§ˆå™¨ä¹‹é—´çš„ä¹¦ç­¾åŒæ­¥ï¼Œè€Œä¸”æ˜¯æ’ä»¶çš„å½¢å¼ã€‚\nXtrafinder # http://www.trankynam.com/xtrafinder/ åœ¨ Mac çš„ Finder ä¸å¤ªå¥½ç”¨ï¼Œæ— æ³•æ–°å»ºæ–‡ä»¶ï¼Œæ˜¾ç¤ºæ–‡ä»¶å±æ€§ä¹Ÿæ¯”è¾ƒéº»çƒ¦ï¼Œè¿˜æ²¡æœ‰å‰ªåˆ‡åŠŸèƒ½ã€‚è¿™ä¸ªè½¯ä»¶å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å®ƒå°†è¿™äº›åŠŸèƒ½éƒ½é›†æˆåˆ°äº† Finder ä¸­ã€‚\n","date":"2014 September 9","permalink":"/posts/2014/09/09/","section":"Posts","summary":"1.é”®ç›˜æ“ä½œ #ä½¿ç”¨ Macbook ï¼Œæ²¡æœ‰åˆé€‚çš„é¼ æ ‡ï¼Œç”¨äº†å¤–æ¥é”®ç›˜åï¼Œè§¦æ‘¸æ¿ä¹Ÿç¦»å¾—è¿œäº†ï¼Œå°½é‡æ˜¯ç”¨é”®ç›˜æ“ä½œï¼Œç†Ÿç»ƒåæ•ˆç‡å¾ˆé«˜ã€‚","title":"Mac OS X å¸¸ç”¨è½¯ä»¶å’ŒæŠ€å·§"},{"content":"åœ¨ http://www.telegraphics.com.au/sw/product/ICOFormat#icoformaté¡µé¢ä¸‹è½½ ico æ ¼å¼æ’ä»¶ã€‚\nåœ¨å¦‚ä¸‹ç•Œé¢é€‰æ‹© Mac CS5/CS6 ï¼š\nç„¶åæ‰“å¼€ä¸‹è½½çš„ DMG æ–‡ä»¶ ã€‚å°†å…¶ä¸­çš„ ICOFormat.plugin æ–‡ä»¶å¤æ‚åˆ° photoshop çš„æ’ä»¶ç›®å½•ä¸‹ :\n/Applications/Adobe Photoshop C6/Plug-ins/ OK!\nè¿™æ ·å°±å¯ä»¥æ–°å»ºï¼Œä¿å­˜ ICO å›¾ç‰‡äº†ã€‚\n","date":"2014 July 12","permalink":"/posts/2014/07/12/","section":"Posts","summary":"åœ¨ http://www.","title":"è®© Mac çš„ Photoshop CS6 æ”¯æŒ ICO æ–‡ä»¶"},{"content":" google-code-prettify å¯ä»¥é€šè¿‡ javascript å’Œ css æ–‡ä»¶ä¸º html é¡µé¢å®ç°ä»£ç æ®µçš„è¯­æ³•é«˜äº®ã€‚\n1. ä¸‹è½½ #åœ¨ https://code.google.com/p/google-code-prettify/ ä¸‹è½½ prettify-small-4-Mar-2013.tar.bz2 ï¼Œè§£å‹åçš„æ–‡ä»¶å¤¹æ”¾åœ¨åšå®¢æ¨¡æ¿çš„ include ç›®å½•ä¸‹ï¼Œæ”¹åä¸º prettify ã€‚\n2. å¯¼å…¥ #åœ¨æ¨¡æ¿çš„ base.html æ–‡ä»¶çš„ \u0026lt;head\u0026gt; æ®µæ·»åŠ  ï¼š\n\u0026lt;link href=\u0026quot;/template/include/prettify/prettify.css\u0026quot; type=\u0026quot;text/css\u0026quot; rel=\u0026quot;stylesheet\u0026quot; /\u0026gt; js æ–‡ä»¶æ·»åŠ åˆ° \u0026lt;body\u0026gt; æ®µçš„å°¾éƒ¨ï¼Œè¿™æ ·å¯ä»¥æå‡åŠ è½½é€Ÿåº¦ ï¼š\n\u0026lt;script type=\u0026quot;text/javascript\u0026quot; src=\u0026quot;/template/include/prettify/prettify.js\u0026quot;\u0026gt;\u0026lt;/script\u0026gt; 3. å®ç°ä»£ç é«˜äº® #åœ¨ base.html æ–‡ä»¶çš„ \u0026lt;body\u0026gt; æ®µå°¾éƒ¨æ·»åŠ å¦‚ä¸‹ä»£ç ï¼Œå®ƒä¼šåœ¨é¡µé¢çš„ \u0026lt;pre\u0026gt; æ ‡ç­¾æ·»åŠ  class=\u0026quot;prettyprint linenums prettyprinted\u0026quot; style=\u0026quot;overflow: auto;\u0026quot; ï¼Œç”¨äºè¯†åˆ«éœ€è¦é«˜äº®çš„ä»£ç å— ï¼š\n\u0026lt;script type=\u0026quot;text/javascript\u0026quot;\u0026gt; $(document).ready(function() { $('pre').addClass('prettyprint linenums').attr('style', 'overflow:auto'); prettyPrint(); }); \u0026lt;/script\u0026gt; è¿™æ®µ js ä»£ç ç”¨åˆ°äº† jQuery ï¼Œéœ€è¦æå‰å¼•å…¥ã€‚\nå¦‚æœå¯¹ä»£ç é«˜äº®çš„ä¸»é¢˜ä¸æ»¡æ„ï¼Œå¯ä»¥ä¿®æ”¹ prettify.css æ–‡ä»¶ã€‚\n","date":"2014 July 11","permalink":"/posts/2014/07/11/","section":"Posts","summary":"google-code-prettify å¯ä»¥é€šè¿‡ javascript å’Œ css æ–‡ä»¶ä¸º html é¡µé¢å®ç°ä»£ç æ®µçš„è¯­æ³•é«˜äº®ã€‚","title":"ç”¨ google-code-prettify å®ç°ä»£ç è¯­æ³•é«˜äº®"},{"content":" æ·»åŠ åçš„æ•ˆæœå¦‚å³ä¸‹è§’ã€‚\n1. å¯¼å…¥ jQuery #åœ¨ http://jquery.com/download/ ä¸­ä¸‹è½½å‹ç¼©è¿‡çš„ jQuery ï¼šjquery-1.11.1.min.js ,æ”¾å…¥åšå®¢æ¨¡æ¿çš„ç›¸åº”ç›®å½•ä¸‹ï¼Œæ¯”å¦‚ include/ ã€‚\nåœ¨ base.html çš„ ä¸­æ·»åŠ ï¼š\n\u0026lt;script type=\u0026quot;text/javascript\u0026quot; src=\u0026quot;/template/include/jquery-1.11.1.min.js\u0026quot;\u0026gt;\u0026lt;/script\u0026gt; 2. æ·»åŠ  div #åœ¨ base.html ä¸­æ·»åŠ :\n\u0026lt;div id=\u0026quot;back-top\u0026quot;\u0026gt; \u0026lt;a href=\u0026quot;#top\u0026quot; title=\u0026quot;å›åˆ°é¡¶éƒ¨\u0026quot;\u0026gt;\u0026lt;/a\u0026gt; \u0026lt;/div\u0026gt; 3. æ·»åŠ jsä»£ç  #ä½¿ç”¨ js å“åº”çª—å£æ»šåŠ¨äº‹ä»¶å’ŒæŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶ï¼Œå…¶ä¸­ 100 è¡¨ç¤ºå‘ä¸‹æ»šåŠ¨ 100 ä¸ªåƒç´ æ—¶å‡ºç°æŒ‰mdé’®ï¼Œ800 è¡¨ç¤ºä½¿ç”¨ 800ms çš„æ—¶é—´æ»šåŠ¨åˆ°é¡¶éƒ¨ã€‚\n\u0026lt;script type=\u0026quot;text/javascript\u0026quot;\u0026gt; $(\u0026quot;#back-top\u0026quot;).hide(); $(document).ready(function () { $(window).scroll(function () { if ($(this).scrollTop() \u0026gt; 100) { $('#back-top').fadeIn(); } else { $('#back-top').fadeOut(); } }); $('#back-top a').click(function () { $('body,html').animate({ scrollTop: 0 }, 800); return false; }); }); \u0026lt;/script\u0026gt; å¯ä»¥å°†è¿™æ®µä»£ç æ·»åŠ åˆ° \u0026lt;div id=\u0026quot;back-top\u0026quot;\u0026gt; æ®µçš„åé¢ã€‚\n4. æ·»åŠ æ ·å¼ #æ­¤å¤„ä½¿ç”¨ä¸€ä¸ªèƒŒæ™¯é€æ˜çš„å‘ä¸Šç®­å¤´å›¾ç‰‡ bg_up_arrow.pngï¼Œå°†å…¶æ”¾å…¥ include/ ç›®å½•ä¸‹ã€‚é€šè¿‡ backgroud-color æŒ‡å®šæ­£å¸¸æ—¶å’Œé¼ æ ‡æ”¾ä¸Šæ—¶çš„èƒŒæ™¯é¢œè‰²ï¼Œborder-radius æŒ‡å®šåœ†è§’çš„åŠå¾„ã€‚\n#back-top { position: fixed; bottom: 30px; right: 80px; } #back-top a { width: 54px; height: 54px; display: block; background: #ddd url(/template/include/bg_up_arrow.png) no-repeat center center; background-color: #e9e9e9; -webkit-border-radius: 7px; -moz-border-radius: 7px; border-radius: 7px; -webkit-transition: 1s; -moz-transition: 1s; transition: 1s; } #back-top a:hover { background-color: #c8c8c8; } ","date":"2014 July 9","permalink":"/posts/2014/07/09/","section":"Posts","summary":"æ·»åŠ åçš„æ•ˆæœå¦‚å³ä¸‹è§’ã€‚","title":"åœ¨åšå®¢æ·»åŠ è¿”å›é¡¶éƒ¨æŒ‰é’®"},{"content":"Telnet #åœ¨QNXä¸­ï¼Œtelnet æœåŠ¡å¿…é¡»ç”¨ inetdå¯åŠ¨ï¼Œæ‰€ä»¥ï¼Œå…ˆç¡®ä¿ /etc/inetd.conf æ–‡ä»¶ä¸­æœ‰ä¸€è¡Œ ï¼š\ntelnet stream tcp nowait root /usr/sbin/telnetd in.telnetd ä¸”æ²¡æœ‰è¢«æ³¨é‡Šã€‚\nå„è‡ªå­—æ®µçš„å«ä¹‰ï¼š\n\u0026lt;service_name\u0026gt; \u0026lt;socket_type\u0026gt; \u0026lt;proto\u0026gt; \u0026lt;flags\u0026gt; \u0026lt;user\u0026gt; \u0026lt;server_pathname\u0026gt; \u0026lt;args\u0026gt; å…¶ä¸­ \u0026lt;user\u0026gt; ä¸ºå¯åŠ¨æœåŠ¡çš„ç”¨æˆ·åï¼Œå¿…é¡»ä¸ºç³»ç»Ÿä¸­å·²ç»å­˜åœ¨çš„ç”¨æˆ·ã€‚\nç„¶åæ‰§è¡Œ inetd \u0026amp; å³å¯å¯åŠ¨telnetæœåŠ¡ã€‚\næ‰§è¡Œ netstat å‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ° telnet å·²ç»æ‰“å¼€ï¼š\nå¦‚æœè¦å¼€æœºå¯åŠ¨ï¼Œå¯ä»¥å°† /usr/sbin/inetd \u0026amp; å‘½ä»¤æ·»åŠ åˆ° /etc/rc.d/rc.local æ–‡ä»¶ä¸­ã€‚\nFTP #åœ¨QNXä¸­ï¼ŒFTP æœåŠ¡å¿…é¡»ç”¨ inetdå¯åŠ¨ï¼Œæ‰€ä»¥ï¼Œå…ˆç¡®ä¿ /etc/inetd.conf æ–‡ä»¶ä¸­æœ‰ä¸€è¡Œ ï¼š\nftp stream tcp nowait root /usr/sbin/ftpd in.ftpd -l ä¸”æ²¡æœ‰è¢«æ³¨é‡Šã€‚\nå„è‡ªå­—æ®µçš„å«ä¹‰ï¼š\n\u0026lt;service_name\u0026gt; \u0026lt;socket_type\u0026gt; \u0026lt;proto\u0026gt; \u0026lt;flags\u0026gt; \u0026lt;user\u0026gt; \u0026lt;server_pathname\u0026gt; \u0026lt;args\u0026gt; å…¶ä¸­ \u0026lt;user\u0026gt; ä¸ºå¯åŠ¨æœåŠ¡å™¨çš„ç”¨æˆ·åï¼Œå¿…é¡»ä¸ºç³»ç»Ÿä¸­å·²ç»å­˜åœ¨çš„ç”¨æˆ·ã€‚\nç„¶åæ‰§è¡Œ inetd \u0026amp; å³å¯å¯åŠ¨ftpæœåŠ¡ã€‚\næ‰§è¡Œ netstat å‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ° ftp å·²ç»æ‰“å¼€ï¼š\nå¦‚æœè¦å¼€æœºå¯åŠ¨ï¼Œå¯ä»¥å°† /usr/sbin/inetd \u0026amp; å‘½ä»¤æ·»åŠ åˆ° /etc/rc.d/rc.local æ–‡ä»¶ä¸­ã€‚\n/etc/ftpuser æ–‡ä»¶ç”¨äºæ§åˆ¶è®¿é—®ftpd çš„ç”¨æˆ·ã€‚è¦ä½¿rootç”¨æˆ·ç™»é™†ï¼Œå°†æ–‡ä»¶ä¸­æŠŠç¦æ­¢rootç”¨æˆ·ä½¿ç”¨ftpè¿™é¡¹å±è”½æ‰ï¼ˆrootå‰é¢åŠ #å·ï¼‰:\nå¹¶ä¸”ï¼Œroot ç”¨æˆ·å¿…é¡»æœ‰å¯†ç ï¼Œå¦åˆ™æ— æ³•é€šè¿‡ ftp ç™»é™†ã€‚\n","date":"2013 December 27","permalink":"/posts/2013/12/27/","section":"Posts","summary":"Telnet #åœ¨QNXä¸­ï¼Œtelnet æœåŠ¡å¿…é¡»ç”¨ inetdå¯åŠ¨ï¼Œæ‰€ä»¥ï¼Œå…ˆç¡®ä¿ /etc/inetd.","title":"QNX çš„ Telnet å’Œ FTP æœåŠ¡"},{"content":"Google Fonts æ˜¯ä¸€å¥—é«˜å“è´¨çš„ Web å­—ä½“ï¼Œå¯ä»¥é€šè¿‡ Google Fonts API æ·»åŠ åˆ°ä»»æ„ Web é¡µé¢ä¸­ï¼Œåªéœ€åœ¨ HTML æ–‡ä»¶çš„å¤´éƒ¨æ·»åŠ ä¸€ä¸ª stylesheet é“¾æ¥ï¼Œç„¶åå°±å¯ä»¥é€šè¿‡ CSS ä½¿ç”¨å­—ä½“ã€‚\nä¼˜åŠ¿ï¼š\né«˜å“è´¨ï¼Œå¼€æº æ”¯æŒå¤§å¤šæ•°æµè§ˆå™¨ æå…¶æ˜“ç”¨ åŠ£åŠ¿ï¼š\nå¢™å†…é“¾æ¥ä¸ç¨³å®š Google Fonts API ï¼šhttps://developers.google.com/fonts/\nExample #ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œå°†è¿™ä»½ä»£ç å¤åˆ¶å¹¶ä¿å­˜ä¸º html æ–‡ä»¶ã€‚\n\u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;link rel=\u0026quot;stylesheet\u0026quot; type=\u0026quot;text/css\u0026quot; href=\u0026quot;https://fonts.googleapis.com/css?family=Tangerine\u0026quot;\u0026gt; \u0026lt;style\u0026gt; body { font-family: 'Tangerine', serif; font-size: 48px; } \u0026lt;/style\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;div\u0026gt;Making the Web Beautiful!\u0026lt;/div\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; ç„¶ååœ¨æµè§ˆå™¨ä¸­æ‰“å¼€è¿™ä¸ª html æ–‡ä»¶ï¼Œå°±ä¼šçœ‹åˆ°å¦‚ä¸‹æ•ˆæœï¼š\nMaking the Web Beautiful!\nè¿™æ˜¯æ™®é€šæ–‡æœ¬ï¼Œæ‰€ä»¥å¯ä»¥ç”¨ CSS æ”¹å˜å®ƒçš„æ ·å¼ï¼Œè¯•ç€æ·»åŠ é˜´å½±:\nbody { font-family: 'Tangerine', serif; font-size: 48px; text-shadow: 4px 4px 4px #aaa; } æ•ˆæœå¦‚ä¸‹ï¼š\nMaking the Web Beautiful!\nOverview #ä½¿ç”¨ Google Fonts API åªéœ€ä¸¤æ­¥ï¼š\næ·»åŠ ä¸€ä¸ª stylesheet é“¾æ¥ï¼š\n\u0026lt;link rel=\u0026quot;stylesheet\u0026quot; type=\u0026quot;text/css\u0026quot; href=\u0026quot;https://fonts.googleapis.com/css?family=Font+Name\u0026quot;\u0026gt; ä¸ºä¸€ä¸ªå…ƒç´ æŒ‡å®šéœ€è¦çš„å­—ä½“ï¼š\nCSS selector { font-family: 'Font Name', serif; } æˆ–è€…ç”¨å†…è”å¼çš„ style ï¼š\n\u0026lt;div style=\u0026quot;font-family: 'Font Name', serif;\u0026quot;\u0026gt;Your text\u0026lt;/div\u0026gt; æ³¨æ„ï¼Œæ¨èåœ¨ href ä¸­ä½¿ç”¨ https çš„ url ï¼Œå¦åˆ™å¯èƒ½æ— æ³•è¿æ¥åˆ° googleapis.com ã€‚\nåœ¨ Google Fonts ä¸­å¯ä»¥çœ‹åˆ°å¯ç”¨çš„å­—ä½“åˆ—è¡¨ã€‚\n","date":"2013 October 16","permalink":"/posts/2013/10/16/","section":"Posts","summary":"Google Fonts æ˜¯ä¸€å¥—é«˜å“è´¨çš„ Web å­—ä½“ï¼Œå¯ä»¥é€šè¿‡ Google Fonts API æ·»åŠ åˆ°ä»»æ„ Web é¡µé¢ä¸­ï¼Œåªéœ€åœ¨ HTML æ–‡ä»¶çš„å¤´éƒ¨æ·»åŠ ä¸€ä¸ª stylesheet é“¾æ¥ï¼Œç„¶åå°±å¯ä»¥é€šè¿‡ CSS ä½¿ç”¨å­—ä½“ã€‚","title":"Google Fonts"},{"content":"é¡¹ç›®ä¸»é¡µï¼šhttp://fortawesome.github.io/Font-Awesome/\nç›®å‰çš„ Version 3.2.1 ç‰ˆæœ¬æ”¯æŒå¦‚ä¸‹ç‰¹æ€§ï¼š\nä¸€ä¸ªå­—ä½“æ–‡ä»¶ï¼Œ 361 ä¸ªå›¾æ ‡ ç”¨ CSS æ§åˆ¶æ ·å¼ æ— é™ç¼©æ”¾ å…è´¹ æ”¯æŒè§†ç½‘è†œå±å¹• ä¸º Bootstrap è®¾è®¡ï¼Œä¹Ÿå¯é›†æˆåˆ°é Bootstrap é¡¹ç›® 1.é›†æˆ # å¤åˆ¶ font ç›®å½•åˆ°é¡¹ç›®æ ¹ç›®å½•ä¸‹ å¤åˆ¶ css ç›®å½•åˆ°é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œä¸»è¦ä½¿ç”¨ font-awesome.min.css æ–‡ä»¶ ä¿®æ”¹ font-awesome.min.css æ–‡ä»¶ä¸­çš„å­—ä½“è·¯å¾„ï¼Œé»˜è®¤æ˜¯ ../font/ åœ¨ html æ–‡ä»¶ä¸­å¼•ç”¨ css æ–‡ä»¶ï¼š\u0026lt;link rel=\u0026quot;stylesheet\u0026quot; href=\u0026quot;./css/font-awesome.min.css\u0026quot; type=\u0026quot;text/css\u0026quot; /\u0026gt; 2.å®ä¾‹ #ä½¿ç”¨å›¾æ ‡ #\u0026lt;i class=\u0026quot;icon-youtube\u0026quot;\u0026gt;\u0026lt;/i\u0026gt; icon-youtube icon-youtube\nå…¶ä¸­çš„ icon-youtube æ˜¯å›¾æ ‡çš„åç§°ï¼Œæ‰€æœ‰æ”¯æŒçš„å›¾æ ‡åç§°å¯ä»¥åœ¨ font-awesome.min.css æ–‡ä»¶ä¸­æŸ¥æ‰¾ï¼Œä¹Ÿå¯åœ¨ Font-Awesome icons ä¸­é¢„è§ˆã€‚\næ›´å¤§çš„å›¾æ ‡ #é€šè¿‡ç»™å›¾æ ‡è®¾ç½® icon-largeã€icon-2xã€ icon-3x æˆ– icon-4x æ ·å¼ï¼Œå¯ä»¥è®©å›¾æ ‡ç›¸å¯¹äºå®ƒæ‰€åœ¨çš„å®¹å™¨å˜å¾—æ›´å¤§ï¼š\n\u0026lt;p\u0026gt;\u0026lt;i class=\u0026quot;icon-camera-retro icon-large\u0026quot;\u0026gt;\u0026lt;/i\u0026gt; icon-camera-retro\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;\u0026lt;i class=\u0026quot;icon-camera-retro icon-2x\u0026quot;\u0026gt;\u0026lt;/i\u0026gt; icon-camera-retro\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;\u0026lt;i class=\u0026quot;icon-camera-retro icon-3x\u0026quot;\u0026gt;\u0026lt;/i\u0026gt; icon-camera-retro\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;\u0026lt;i class=\u0026quot;icon-camera-retro icon-4x\u0026quot;\u0026gt;\u0026lt;/i\u0026gt; icon-camera-retro\u0026lt;/p\u0026gt; icon-camera-retro\nicon-camera-retro\nicon-camera-retro\nicon-camera-retro\nåŠ¨ç”»å¾®è°ƒ #ä½¿ç”¨ icon-spin ä½¿å›¾æ ‡æ—‹è½¬ï¼Œå¯¹äº icon-spinner å’Œ icon-refresh å›¾æ ‡å¯ä»¥å¾—åˆ°å¾ˆå¥½çš„æ•ˆæœï¼š\n\u0026lt;i class=\u0026quot;icon-spinner icon-spin\u0026quot;\u0026gt;\u0026lt;/i\u0026gt; Spinner icon when loading content... Spinner icon when loading content\u0026hellip;\n\u0026lt;i class=\u0026quot;icon-refresh icon-spin\u0026quot;\u0026gt;\u0026lt;/i\u0026gt; Refresh icon when refresh content... Refresh icon when refresh content\u0026hellip;\nåˆ—è¡¨ #åœ¨åˆ—è¡¨ä¸­ä½¿ç”¨å›¾æ ‡ï¼š\n\u0026lt;ul class=\u0026quot;icons\u0026quot;\u0026gt; \u0026lt;li\u0026gt;\u0026lt;i class=\u0026quot;icon-ok\u0026quot;\u0026gt;\u0026lt;/i\u0026gt; Lists\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;\u0026lt;i class=\u0026quot;icon-ok\u0026quot;\u0026gt;\u0026lt;/i\u0026gt; Buttons\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;\u0026lt;i class=\u0026quot;icon-ok\u0026quot;\u0026gt;\u0026lt;/i\u0026gt; Button groups\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;\u0026lt;i class=\u0026quot;icon-ok\u0026quot;\u0026gt;\u0026lt;/i\u0026gt; Navigation\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;\u0026lt;i class=\u0026quot;icon-ok\u0026quot;\u0026gt;\u0026lt;/i\u0026gt; Prepended form inputs\u0026lt;/li\u0026gt; \u0026lt;/ul\u0026gt; Lists Buttons Button groups Navigation Prepended form inputs ","date":"2013 October 15","permalink":"/posts/2013/10/15/","section":"Posts","summary":"é¡¹ç›®ä¸»é¡µï¼šhttp://fortawesome.github.io/Font-Awesome/","title":"Font Awesome çŸ¢é‡å­—ä½“å›¾æ ‡"},{"content":"ç¬¬ä¸€èŠ‚ #1.1 #####1.1.1\næ­£æ–‡\næ— åºåˆ—è¡¨1 æ— åºåˆ—è¡¨2 æ— åºåˆ—è¡¨å­é¡¹ æ— åºåˆ—è¡¨å­é¡¹ æ— åºåˆ—è¡¨3 ç¬¬äºŒèŠ‚ #æ­£æ–‡\næœ‰åºåˆ—è¡¨1 æœ‰åºåˆ—è¡¨2 ä»£ç æ®µï¼š\ninclude\u0026lt;stdio.h\u0026gt; int main() { printf(\u0026quot;hello farbox\\n!\u0026quot;); return 0; } æ³¨æ„äº‹é¡¹\næ’å…¥å›¾ç‰‡ï¼š\næ­£æ–‡\n","date":"2013 October 12","permalink":"/posts/2013/10/12/","section":"Posts","summary":"ç¬¬ä¸€èŠ‚ #1.","title":"Hello Farbox"},{"content":"QNX Neutrino æ”¯æŒå¤šç§è§¦æ‘¸å±ï¼Œå¯ä»¥åœ¨å®˜ç½‘ä¸ŠæŸ¥æ‰¾æ”¯æŒçš„å‹å·å’Œå¯¹åº”çš„é©±åŠ¨ï¼š\nhttp://www.qnx.com/developers/hardware_support/\næˆ–è€…åœ¨ Utilities Reference ä¸­æŸ¥çœ‹ devi-* é©±åŠ¨ï¼Œç„¶åç¡®å®šæ‰€éœ€çš„å‚æ•°ï¼Œå¯åŠ¨é©±åŠ¨ã€‚ä¾‹å¦‚ï¼Œå¯åŠ¨ä¸€ä¸ª Dynapro SC4 è§¦æ‘¸å±ï¼š\ndevi-dyna dyna -4 fd -d/dev/ser1 \u0026amp; ä½¿ç”¨ devi-dyna é©±åŠ¨ï¼ŒSC4 åè®®ï¼ˆ-4ï¼‰ï¼Œä¸²å£1ï¼ˆ/dev/ser1ï¼‰ã€‚\nç¬¬ä¸€æ¬¡ä½¿ç”¨é©±åŠ¨æ—¶ï¼Œä¼šè¿”å›ä¸€ä¸ªé”™è¯¯çŠ¶æ€ï¼Œæ— æ³•è·å–æ ¡å‡†æ–‡ä»¶ã€‚è¦æ ¡å‡†è§¦æ‘¸å±ï¼Œéœ€è¦åœ¨ Photon ä¸‹ä½¿ç”¨ calib å·¥å…·ã€‚\ncalib #ç”¨äºæ ¡å‡†è§¦æ‘¸å±ã€‚æˆåŠŸé…ç½®è§¦æ‘¸å±åï¼ˆå·²ç»åˆ›å»ºäº†è®¾å¤‡æ–‡ä»¶ï¼‰ï¼Œå¿…é¡»æ ¡å‡†ã€‚calib å·¥å…·çš„é…ç½®æ–‡ä»¶ä¿å­˜åœ¨ /etc/system/config/calib.$hostname ã€‚å…³äºè¯¥æ–‡ä»¶çš„æ ¼å¼ï¼Œå¯ä»¥åœ¨ â€œWriting an Input Device Driverâ€ çš„ â€œCalibration file formatâ€ æŸ¥çœ‹.\næ ¡å‡†çš„æ­¥éª¤æ˜¯ï¼š\nå¯åŠ¨ Photon. è¿è¡Œ calib. è§¦æ‘¸å±å¹•ä¸Šçš„ç›®æ ‡ç‚¹. ç‚¹å‡» Press to Complete Calibration æŒ‰é’®ï¼Œå®Œæˆæ ¡å‡†. è¯­æ³• #calib [options] å‚æ•° # -a alg ï¼šæŒ‡å®šæ ¡å‡†ç®—æ³•ã€‚æœ‰æ•ˆç®—æ³•æ˜¯ 3 å’Œ 4 ï¼Œé»˜è®¤å€¼æ˜¯ 3 ã€‚\n-b val ï¼šæŒ‡å®šè§¦æ‘¸ç‚¹çš„éªŒæ”¶æ–¹å·®ï¼ˆèŒƒå›´æ˜¯ 0 - 2000ï¼‰ã€‚ä½¿èƒ½è¯¥å‚æ•°å°†ä¼šå¼ºåˆ¶æ£€æŸ¥è§¦æ‘¸ç‚¹ã€‚\n-c ï¼šå¦‚æœå·²ç»é…ç½®æ–‡ä»¶ /etc/system/config/calib.$(hostname) å·²ç»å­˜åœ¨ï¼Œå°±åœæ­¢è¿è¡Œã€‚\n-d w,h ï¼šè§¦æ‘¸å±çš„å®½åº¦å’Œé«˜åº¦ã€‚å¦‚æœä¸è®¾ç½®è¯¥å‚æ•°ï¼Œcalib ä¼šå°è¯•ä»ç¡¬ä»¶è·å–ä¿¡æ¯ã€‚\n-f file ï¼šæ ¡å‡†æ–‡ä»¶çš„åç§°å’Œè·¯å¾„ï¼Œä»£æ›¿é»˜è®¤çš„ /etc/system/config/calib.$hostname ã€‚\n-l limit ï¼šæ ¡å‡†è§¦æ‘¸ç‚¹çš„ä¸ªæ•°ï¼Œé»˜è®¤å€¼æ˜¯ 15 ã€‚\n-o offset ï¼šç›¸å¯¹äºåå­—çº¿çš„åç§»ï¼Œç”¨äºè°ƒæ•´æ ¡éªŒã€‚åªèƒ½ç”¨åœ¨å››ç‚¹æ ¡éªŒã€‚\n-O ï¼šå°†è§¦æ‘¸å±çš„èµ·ç‚¹ï¼ˆ0,0ï¼‰è®¾ä¸ºå³ä¸‹è§’ã€‚é»˜è®¤ä¸ºå·¦ä¸Šè§’ã€‚\n-p x,y ï¼šç›¸å¯¹äºæ ¡éªŒèµ·ç‚¹çš„åç§»ã€‚\n-P ï¼šå…³é—­æç¤ºã€‚é»˜è®¤ä¼šåœ¨å±å¹•ä¸Šæ˜¾ç¤ºæç¤ºä¿¡æ¯ã€‚\n-s server ï¼šæœåŠ¡å™¨èŠ‚ç‚¹æˆ–è®¾å¤‡åç§°ã€‚\n-S ï¼šä½¿ç”¨å°è§¦æ‘¸ç›®æ ‡ã€‚é»˜è®¤æ˜¯å¤§çš„ã€‚\n-t timer ï¼šå®ŒæˆæŒ‰é’®çš„å®šæ—¶å€¼ï¼Œé»˜è®¤æ˜¯ 10 ã€‚\n-v ï¼šè¾“å‡ºè¯¦æƒ…ã€‚\n-x x ï¼šåˆå§‹åŒ– x åæ ‡ã€‚\n-y y ï¼šåˆå§‹åŒ– y åæ ‡ã€‚\nä¾‹ #æ ¡å‡†ä¸€ä¸ªå››åˆ†å­ä¸€çš„æ ‡å‡† 640*480 VGA å±ï¼š\ncalib -d 320,240 ELO è§¦æ‘¸å± #Elographics è§¦æ‘¸å±çš„é©±åŠ¨æ˜¯ devi-elo ï¼Œå®ƒä¼šåœ¨ Photon ä¸Šå¯åŠ¨ä¸€ä¸ª Elographics è¾“å…¥ç®¡ç†å™¨ ã€‚\nè¯­æ³• #devi-elo [general_opts] protocol* [protocol_opts]* device* [device_opts]* filter* [filter_opts]* ä½¿ç”¨ devi-* è§¦æ‘¸å±é©±åŠ¨æ—¶ï¼Œéœ€è¦ä¸€ä¸ªæ ¡å‡†æ–‡ä»¶ã€‚ç”¨ calib å·¥å…·äº§ç”Ÿï¼š\ncalib \u0026gt; calib_file.txt\nå‚æ•° #general_optsï¼š\n-b ï¼šç¦æ­¢ä½¿ç”¨ Ctrl-Alt-Shift-Backspace ç»„åˆé”®ç»“æŸ Photon ï¼ˆé»˜è®¤æ˜¯å…è®¸çš„ï¼‰ã€‚\n-d device ï¼šè®¾å¤‡ï¼ˆé»˜è®¤ï¼š/dev/photon æˆ– $PHOTON ï¼‰ã€‚\n-G ï¼šå¯åŠ¨è§¦æ‘¸å±é©±åŠ¨æ—¶æ— éœ€å›¾å½¢é©±åŠ¨ã€‚åœ¨è°ƒè¯•æ—¶å¾ˆæœ‰ç”¨ã€‚\n-g input_group ï¼šè¾“å…¥ç»„ï¼ˆé»˜è®¤æ˜¯ 1 ï¼‰ã€‚\n-l ï¼šåˆ—å‡ºå†…éƒ¨æ¨¡å—ã€‚æ¨¡å—ç”¨å¦‚ä¸‹æ ¼å¼æ˜¾ç¤ºï¼š\nmodule name | date compiled | revision | class -v[v]\u0026hellip; ï¼šè¾“å‡ºè¯¦æƒ…ï¼Œæ›´å¤šçš„ v å­—ç¬¦å¯¼è‡´è¾“å‡ºæ›´å¤šçš„è¯¦æƒ…ã€‚\nprotocol* [protocol_opts]*ï¼š\nsmartset [smartset_opts] [fd fd_opts]|[uart uart_opts] smartset â€”â€” Elographics smartset åè®®\n-b baud ï¼šæ³¢ç‰¹ç‡ï¼ˆé»˜è®¤æ˜¯9600ï¼‰\n-R ï¼šä¸è¦ reset è®¾å¤‡ï¼ˆé»˜è®¤æ˜¯ reset ï¼‰\ndevice* [device_opts]*ï¼š\nfd â€”â€” é€šè¿‡ open() æ‰“å¼€ä¸€ä¸ªè®¾å¤‡\n-d device ï¼šè®¾å¤‡æ–‡ä»¶åï¼ˆé»˜è®¤æ˜¯ /dev/ser1ï¼‰\n-s ï¼šè¾“å…¥æ¥å£æ˜¯ä¸²å£\nuart â€”â€” ç›´æ¥è®¿é—® 8250/16550/16450 UART\n-1 ï¼šCOM1\n-2 ï¼šCOM2\n-i irq ï¼šä¸²å£çš„ IRQ ï¼ˆé»˜è®¤æ˜¯ 4 ï¼‰\n-p ioport ï¼šä¸²å£çš„ç«¯å£åœ°å€ï¼ˆé»˜è®¤æ˜¯ 3f8ï¼‰\nfilter* [filter_opts]*ï¼š\nabs â€”â€” è½¬æ¢å’Œå‹ç¼©ç»å¯¹åæ ‡\n-b ï¼šç‚¹å‡»å±å¹•ä»£è¡¨é¼ æ ‡å³é”®ï¼ˆé»˜è®¤æ˜¯å·¦é”®ï¼‰\n-c ï¼šæ ¡å‡†æ¨¡å¼ï¼›ä¸è½¬æ¢åæ ‡\n-f filename ï¼šæ ¡å‡†æ–‡ä»¶\n-o x,y ï¼šæ˜¾ç¤ºåŒºåŸŸçš„èµ·å§‹ç‚¹ï¼ˆé»˜è®¤æ˜¯å›¾å½¢åŒºåŸŸçš„èµ·å§‹ç‚¹ï¼‰\n-s x,y ï¼šæ˜¾ç¤ºåŒºåŸŸå³ä¸‹è§’çš„åæ ‡ï¼ˆé»˜è®¤æ˜¯å›¾å½¢åŒºåŸŸçš„å®½å’Œé«˜ï¼‰\n-x ï¼šç¿»è½¬ x åæ ‡\n-y ï¼šç¿»è½¬ y åæ ‡\nä¾‹ #ä½¿ç”¨ COM1 ï¼Œç‚¹å‡»å±å¹•ä»£è¡¨é¼ æ ‡å³é”®ï¼š\ndevi-elo smartset fd -d/dev/ser1 abs -b ","date":"2013 September 15","permalink":"/posts/2013/09/15/","section":"Posts","summary":"QNX Neutrino æ”¯æŒå¤šç§è§¦æ‘¸å±ï¼Œå¯ä»¥åœ¨å®˜ç½‘ä¸ŠæŸ¥æ‰¾æ”¯æŒçš„å‹å·å’Œå¯¹åº”çš„é©±åŠ¨ï¼š","title":"QNX å¯¹è§¦æ‘¸å±çš„æ”¯æŒ"},{"content":"å¤„ç†ä¸­æ–­çš„çº¿ç¨‹åº”è¯¥å…ˆè·å¾— I/O æƒé™ï¼Œè°ƒç”¨ ThreadCtl() å‡½æ•°ï¼š\n#include \u0026lt;sys/neutrino.h\u0026gt; ThreadCtl( _NTO_TCTL_IO, 0 ); QNX æä¾›äº†ä¸¤ç§æ†ç»‘ä¸­æ–­æœåŠ¡ç¨‹åºå’Œä¸­æ–­å·çš„æ–¹å¼ï¼šInterruptAttach() å’Œ InterruptAttachEvent() ã€‚ä¸¤ç§æ–¹å¼è°ƒç”¨ä¸­æ–­æœåŠ¡ç¨‹åºçš„æ–¹å¼ä¹Ÿä¸åŒã€‚åˆ†ç¦»å¯ä»¥è°ƒç”¨ InterruptDetach() å‡½æ•°ï¼š\n#define IRQ3 3 /* A forward reference for the handler */ extern const sigevent *serint (void *, int); â€¦ /* * Associate the interrupt handler, serint, * with IRQ 3, the 2nd PC serial port */ ThreadCtl( _NTO_TCTL_IO, 0 ); id = InterruptAttach (IRQ3, serint, NULL, 0, 0); â€¦ /* Perform some processing. */ â€¦ /* Done; detach the interrupt source. */ InterruptDetach (id); ä¸­æ–­æœåŠ¡ç¨‹åº #ä¸­æ–­æœåŠ¡ç¨‹åºä¸­åº”è¯¥å®Œæˆå¦‚ä¸‹å‡ ä¸ªå·¥ä½œï¼š\nåˆ¤æ–­ä¸­æ–­æº\næ ¹æ®ä½ çš„ç¡¬ä»¶é…ç½®ï¼Œå¯èƒ½å‡ºç°å¤šä¸ªç¡¬ä»¶å…±äº«ä¸€ä¸ªä¸­æ–­å·ã€‚å¤§éƒ¨åˆ†PIC(å¯ç¼–ç¨‹ä¸­æ–­æ§åˆ¶å™¨)èŠ¯ç‰‡å¯ä»¥ç¼–ç¨‹é…ç½®ä¸ºç”µå¹³è§¦å‘ä¸­æ–­æˆ–è¾¹æ²¿è§¦å‘ä¸­æ–­ã€‚è§¦å‘æ–¹å¼å†³å®šäº†ä¸­æ–­æ˜¯å¦å¯ä»¥å…±äº«ã€‚\nä¸‹é¢æ˜¯å¤šä¸­æ–­æºè¯·æ±‚ä¸­æ–­çš„ç¤ºæ„å›¾ï¼š\nåœ¨ä¸Šé¢è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœ PIC é…ç½®ä¸ºç”µå¹³è§¦å‘ï¼Œåªè¦ç”µå¹³ä¸ºé«˜ï¼Œå°±è®¤ä¸º IRQ å¤„äºæ¿€æ´»çŠ¶æ€ã€‚ç¬¬äºŒä¸ªä¸­æ–­è¯·æ±‚(step2)æœ¬èº«å¹¶ä¸ä¼šäº§ç”Ÿæ–°çš„ä¸­æ–­ï¼Œä¸­æ–­ä¸€ç›´è¢«è®¤ä¸ºå¤„äºæ¿€æ´»çŠ¶æ€ï¼Œå³ä½¿æœ€åˆå¼•èµ·ä¸­æ–­çš„ä¸­æ–­æºå·²ç»åˆ é™¤(step3)ã€‚ç›´åˆ°æœ€åä¸€ä¸ªä¸­æ–­æºè¢«æ¸…é™¤ï¼Œè¯¥ä¸­æ–­æ‰ä¼šè¢«è®¤ä¸ºå¤„äºæœªæ¿€æ´»çŠ¶æ€ã€‚\nå¦‚æœæ˜¯è¾¹æ²¿è§¦å‘æ¨¡å¼ï¼Œä¸­æ–­åªä¼šè¢«â€œæ³¨æ„â€ä¸€æ¬¡ï¼Œå³ step1 ã€‚åªæœ‰å½“ä¸­æ–­çº¿è¢«æ¸…é™¤ï¼Œç„¶åè¢«å†æ¬¡è¯·æ±‚ï¼ŒPIC æ‰ä¼šè®¤ä¸ºæœ‰æ–°çš„ä¸­æ–­äº§ç”Ÿã€‚\nQNX å…è®¸å¤šä¸ªä¸­æ–­æœåŠ¡ç¨‹åºå…³è”ä¸€ä¸ªä¸­æ–­å·ã€‚è¿™æ ·çš„è¯ï¼Œæ¯ä¸ªæœåŠ¡ç¨‹åºå¿…é¡»æ‰¾åˆ°è‡ªå·±å…³è”çš„ç¡¬ä»¶å¹¶ä¸”åˆ¤æ–­æ˜¯å¦æ˜¯ç”±è¯¥ç¡¬ä»¶å¼•èµ·çš„ä¸­æ–­ã€‚è¿™é¡¹å·¥ä½œåœ¨ç”µå¹³è§¦å‘ç¯å¢ƒä¸‹æ˜¯å¯é çš„ï¼Œè¾¹æ²¿è§¦å‘ç¯å¢ƒå°±ä¸ä¸€å®šäº†ã€‚\nå¤„ç†ç¡¬ä»¶\né€šå¸¸æ˜¯è¯»å†™ç¡¬ä»¶å¯„å­˜å™¨ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ ISR ä¸­ä¸èƒ½ä½¿ç”¨å¤§éƒ¨åˆ†å†…æ ¸è°ƒç”¨ã€‚åœ¨ä½¿ç”¨åº“å‡½æ•°æ—¶ä¹Ÿè¦å°å¿ƒï¼Œå› ä¸ºå®ƒä»¬çš„åº•å±‚å®ç°å¯èƒ½ä½¿ç”¨äº†ç³»ç»Ÿè°ƒç”¨ï¼Œä¾‹å¦‚ printf() å‡½æ•°ã€‚\nåœ¨ ISR ä¸­å¯ä»¥ä½¿ç”¨çš„å†…æ ¸è°ƒç”¨æœ‰ï¼š\n* InterruptMask() * InterruptUnmask() * TraceEvent() InterruptMask() å’Œ InterruptUnmask() ç”¨äºå…³é—­å’Œä½¿èƒ½ä¸€ä¸ªç‰¹å®šçš„ä¸­æ–­å·ã€‚ TraceEvent() ç”¨äºè·Ÿè¸ªå†…æ ¸äº‹ä»¶ã€‚\næ›´æ–°æ•°æ®ç»“æ„\nå¦ä¸€ä¸ªé—®é¢˜æ˜¯å¦‚ä½•å®‰å…¨çš„æ›´æ–° ISR å’Œè½¯ä»¶çº¿ç¨‹å…±åŒä½¿ç”¨çš„æ•°æ®ç»“æ„ã€‚æœ‰ä¸¤ä¸ªç‰¹ç‚¹å€¼å¾—é‡ç”³ï¼š\nISR æ‹¥æœ‰æ¯”ä»»ä½•è½¯ä»¶çº¿ç¨‹éƒ½é«˜çš„ä¼˜å…ˆçº§ ISR ä¸èƒ½ä½¿ç”¨å†…æ ¸è°ƒç”¨(ç‰¹åˆ«å£°æ˜çš„é™¤å¤–) è¿™æ„å‘³ç€ä¸èƒ½åœ¨ ISR ä¸­ä½¿ç”¨çº¿ç¨‹çº§åˆ«çš„åŒæ­¥(ä¾‹å¦‚äº’æ–¥)ã€‚\nå”¤é†’åº”ç”¨å±‚ä»£ç \nå› ä¸º ISR ä¸­çš„æ“ä½œå—åˆ°å¾ˆå¤§é™åˆ¶ï¼Œé€šå¸¸éœ€è¦å°†å¤§é‡çš„æ“ä½œæ”¾åœ¨çº¿ç¨‹çº§åˆ«è¿è¡Œ\nä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œæœ‰ä¸¤ä¸ªé€‰æ‹©ï¼š\nåœ¨ ISR ä¸­å®Œæˆä¸€äº›å¯¹æ—¶é™è¦æ±‚ä¸¥æ ¼çš„å·¥ä½œï¼Œå…¶ä»–çš„å®‰æ’ç»™å”¤é†’çš„çº¿ç¨‹æ¥å¤„ç† åœ¨ ISR ä¸­ä»€ä¹ˆéƒ½ä¸åšï¼Œåªæ˜¯å”¤é†’ä¸€ä¸ªçº¿ç¨‹ è¿™ä¹Ÿæ˜¯ InterruptAttach() å’Œ InterruptAttachEvent() çš„åŒºåˆ«ã€‚\nä½¿ç”¨ InterruptAttach #InterruptAttach() å‡½æ•°çš„åŸå‹ï¼š\n#include \u0026lt;sys/neutrino.h\u0026gt; int InterruptAttach( int intr, const struct sigevent * (* handler)(void *, int), const void * area, int size, unsigned flags ); å‚æ•°ï¼š\nintr : ä¸­æ–­å·\nhandler : ä¸­æ–­æœåŠ¡å‡½æ•°\narea : çº¿ç¨‹ä¸ä¸­æ–­æœåŠ¡å‡½æ•°è¿›è¡Œé€šè®¯çš„ç©ºé—´ï¼Œå¦‚æœä¸éœ€è¦å¯ä»¥è®¾ä¸ºNULL\nsize : é€šè®¯ç©ºé—´çš„å¤§å°\nflags : è¡¨ç¤ºæ†ç»‘ä¸­æ–­æœåŠ¡å‡½æ•°çš„æ–¹å¼ï¼Œæœ‰ä¸‰ä¸ªå¯é€‰å€¼ï¼š\n_NTO_INTR_FLAGS_END : å°†æ–°çš„ä¸­æ–­æœåŠ¡å‡½æ•°æ”¾åœ¨è¯¥ä¸­æ–­çš„å¤„ç†å‡½æ•°é˜Ÿåˆ—çš„å°¾éƒ¨ã€‚\n_NTO_INTR_FLAGS_PROCESS : å°†ä¸­æ–­æœåŠ¡å‡½æ•°å…³è”åˆ°è¿›ç¨‹ï¼Œè€Œä¸æ˜¯å½“å‰çº¿ç¨‹.\n_NTO_INTR_FLAGS_TRK_MSK : è·Ÿè¸ªè°ƒç”¨ InterruptMask() å’Œ InterruptUnmask() æ¥å®‰å…¨çš„åˆ†ç¦»ä¸­æ–­æœåŠ¡å‡½æ•°ã€‚\nè°ƒç”¨æˆåŠŸçš„è¯ä¼šè¿”å›ä¸€ä¸ª id ï¼Œç”¨äº InterruptMask() å’Œ InterruptUnmask() ç­‰å‡½æ•°ã€‚å¤±è´¥è¿”å›-1ã€‚\nä¸­æ–­æœåŠ¡å‡½æ•°(ISR)çš„åŸå‹æ˜¯ï¼š\nconst struct sigevent *handler (void *area, int id); å‚æ•°ï¼š\narea : å³ InterruptAttach() å‡½æ•°çš„ area id : å³ InterruptAttach() å‡½æ•°çš„è¿”å›å€¼ åœ¨ handler() å‡½æ•°ä¸­å®Œæˆäº†ç›¸åº”çš„ä¸­æ–­æœåŠ¡åï¼Œå¯ä»¥é€‰æ‹©å®‰æ’ä¸€ä¸ªçº¿ç¨‹æ¥å®Œæˆåç»­çš„å·¥ä½œã€‚ä¸ºæ­¤ï¼ŒISR éœ€è¦è¿”å›ä¸€ä¸ªæŒ‡å‘ const struct sigevent ç»“æ„çš„æŒ‡é’ˆï¼Œå½“å†…æ ¸æ”¶åˆ°è¿™ä¸ªç»“æ„åï¼Œå°±ä¼šå°† event å¸¦åˆ°ç›®çš„åœ°ã€‚\nstruct sigevent å®šä¹‰åœ¨ \u0026lt;sys/siginfo.h\u0026gt; å¤´æ–‡ä»¶ï¼Œç»“æ„æˆå‘˜ sigev_notify æŒ‡å®šäº†äº§ç”Ÿæ€æ ·çš„é€šçŸ¥ã€‚è¯¥æ–‡ä»¶æä¾›äº†ä¸€äº›å®æ¥åˆå§‹åŒ–è¿™ä¸ªç»“æ„ï¼Œç¬¬ä¸€ä¸ªå‚æ•°éƒ½æ˜¯ struct sigevent ç±»å‹çš„æŒ‡é’ˆï¼Œä¸­æ–­æœåŠ¡å‡½æ•°ä¸­å¸¸ç”¨çš„å®æœ‰å¦‚ä¸‹ä¸¤ä¸ªï¼š\nSIGEV_INTR_INIT(\u0026amp;event)\nè®¾ç½® sigev_notify ä¸º SIGEV_INTRï¼Œè¡¨ç¤ºå‘é€ä¸€ä¸ªä¸­æ–­é€šçŸ¥åˆ°æŒ‡å®šçš„çº¿ç¨‹ã€‚\nSIGEV_NONE_INIT(\u0026amp;event)\nè®¾ç½® sigev_notify ä¸º SIGEV_NONEï¼Œè¡¨ç¤ºä¸å‘é€ä»»ä½•é€šçŸ¥ã€‚\nå…¸å‹çš„å¤„ç†ä¸­æ–­çš„æ–¹æ³•æ˜¯ï¼Œåœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­è°ƒç”¨ InterruptAttach() ç»‘å®šä¸­æ–­æœåŠ¡å‡½æ•°ï¼Œç„¶åè°ƒç”¨ InterruptWait() é˜»å¡çº¿ç¨‹ï¼Œç›´åˆ° ISR è¿”å›ä¸€ä¸ª SIGEV_INTR ï¼ŒInterruptWait() æ‰ä¼šè¿”å›ï¼š\nmain () { // perform initializations, etc. â€¦ // start up a thread that is dedicated to interrupt processing pthread_create (NULL, NULL, int_thread, NULL); â€¦ // perform other processing, as appropriate â€¦ } // this thread is dedicated to handling and managing interrupts void * int_thread (void *arg) { // enable I/O privilege ThreadCtl (_NTO_TCTL_IO, NULL); â€¦ // initialize the hardware, etc. â€¦ // attach the ISR to IRQ 3 InterruptAttach (IRQ3, isr_handler, NULL, 0, 0); â€¦ // perhaps boost this thread's priority here â€¦ // now service the hardware when the ISR says to while (1) { InterruptWait (NULL, NULL); // at this point, when InterruptWait unblocks, // the ISR has returned a SIGEV_INTR, indicating // that some form of work needs to be done. â€¦ // do the work â€¦ // if the isr_handler did an InterruptMask, then // this thread should do an InterruptUnmask to // allow interrupts from the hardware } } // this is the ISR const struct sigevent * isr_handler (void *arg, int id) { // look at the hardware to see if it caused the interrupt // if not, simply return (NULL); â€¦ // in a level-sensitive environment, clear the cause of // the interrupt, or at least issue InterruptMask to // disable the PIC from reinterrupting the kernel â€¦ // return a pointer to an event structure (preinitialized // by main) that contains SIGEV_INTR as its notification type. // This causes the InterruptWait in \u0026quot;int_thread\u0026quot; to unblock. return (\u0026amp;event); } è¿™ç§æ–¹æ¡ˆç›¸å¯¹äºä½¿ç”¨ SIGEV_SIGNAL æˆ– SIGEV_PULSE ç±»å‹æœ‰å‡ ä¸ªä¼˜ç‚¹ï¼š\nåº”ç”¨ç¨‹åºæ— éœ€è°ƒç”¨ MsgReceive() å‡½æ•°(ç”¨äºç­‰åˆ°ä¸€ä¸ªpulse)ã€‚ åº”ç”¨ç¨‹åºæ— éœ€ä¸€ä¸ª signal-handler å‡½æ•°(ç”¨äºç­‰å¾…ä¸€ä¸ªsignal)ã€‚ å¦‚æœä¸­æ–­å¤„ç†å¾ˆæ€¥è¿«ï¼Œå¯ä»¥å®šä¹‰ä¸€ä¸ªå…·æœ‰é«˜ä¼˜å…ˆçº§çš„ int_thread() çº¿ç¨‹ï¼›å½“ isr_handler() è¿”å› SIGEV_INTR æ—¶ï¼Œåªè¦ int_thread() çš„ä¼˜å…ˆçº§è¶³å¤Ÿé«˜ï¼Œå®ƒå°±ä¼šç«‹å³æ‰§è¡Œã€‚ ä½¿ç”¨ InterruptWait() æ—¶éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œè¢«ç»‘å®šçš„ä¸­æ–­å¿…é¡»äº§ç”Ÿ SIGEV_INTR ã€‚\nä½¿ç”¨ InterruptAttachEvent #InterruptAttachEvent() å‡½æ•°çš„åŸå‹ï¼š\nint InterruptAttachEvent( int intr, const struct sigevent* event, unsigned flags ); å‰é¢å…³äº InterruptAttach() çš„è®¨è®ºå¤§éƒ¨åˆ†éƒ½é€‚ç”¨äº InterruptAttachEvent() ï¼Œé™¤äº† ISR ã€‚è¿™é‡Œä¸éœ€è¦æä¾› ISR ,InterruptAttachEvent() ä¼šè‡ªå·±å¤„ç†ä¸­æ–­ï¼Œå› ä¸ºå·²ç»ä¸ºä¸­æ–­å·ç»‘å®šäº†ä¸€ä¸ª struct sigevetn ç»“æ„ï¼Œå†…æ ¸å¯ä»¥æ£€æŸ¥åˆ°è¿™ä¸ªäº‹ä»¶ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯æˆ‘ä»¬æ— éœ€è€ƒè™‘è¿›å…¥ ISR ä»¥åŠå¦‚ä½•è¿”å›ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨è¯¥å‡½æ•°æ—¶ï¼Œå†…æ ¸ä¼šåœ¨å¤„ç†ä¸­æ–­æ—¶è‡ªåŠ¨è°ƒç”¨ InterruptMask() ã€‚å› æ­¤ï¼Œä½ åº”è¯¥åœ¨ä¸­æ–­å¤„ç†çº¿ç¨‹ä¸­è°ƒç”¨ InterruptUnmask() æ¸…é™¤ä¸­æ–­ã€‚\n","date":"2013 July 28","permalink":"/posts/2013/07/28/","section":"Posts","summary":"å¤„ç†ä¸­æ–­çš„çº¿ç¨‹åº”è¯¥å…ˆè·å¾— I/O æƒé™ï¼Œè°ƒç”¨ ThreadCtl() å‡½æ•°ï¼š","title":"QNX ç¼–ç¨‹"},{"content":"devc-ser8250 æ˜¯ QNX ä¸‹çš„8250ä¸²å£é©±åŠ¨ï¼Œæ”¯æŒ8250s, 14450s å’Œ 16550s ã€‚\nå¿…é¡»ä»¥ root ç”¨æˆ·è¿è¡Œè¯¥ç¨‹åºã€‚\nè¯­æ³•ï¼š #devc-ser8250 [[options] [port[^shift][,intr]]]... \u0026amp; é€‰é¡¹ï¼š # -b numberï¼šåˆå§‹åŒ–æ³¢ç‰¹ç‡ï¼Œé»˜è®¤æ˜¯ 57600ã€‚\n-C size ï¼šcanonical buffer çš„å¤§å°ï¼Œå•ä½æ˜¯å­—èŠ‚ï¼Œé»˜è®¤æ˜¯ 256 ã€‚\n-c clock[/divisor] ï¼šè‡ªå®šä¹‰æ—¶é’Ÿé¢‘ç‡ï¼Œå•ä½æ˜¯ Hz ï¼Œdivisor æ˜¯ä¸²å£ã€‚\n-E ï¼šraw æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰ã€‚é»˜è®¤å…³é—­è½¯ä»¶æµæ§åˆ¶ã€‚\n-e ï¼šedited æ¨¡å¼ã€‚é»˜è®¤ä½¿èƒ½è½¯ä»¶æµæ§åˆ¶ã€‚\n-F ï¼šå…³é—­ç¡¬ä»¶æµæ§åˆ¶ï¼Œé»˜è®¤ä½¿èƒ½ç¡¬ä»¶æµæ§åˆ¶ã€‚edited æ¨¡å¼ä¸æ”¯æŒç¡¬ä»¶æµæ§åˆ¶ã€‚\n-f ï¼šä½¿èƒ½ç¡¬ä»¶æµæ§åˆ¶ã€‚\n-I number ï¼šä¸­æ–­è¾“å…¥ buffer çš„å¤§å°ï¼Œå•ä½æ˜¯å­—èŠ‚ï¼Œé»˜è®¤æ˜¯2048 ã€‚\n-O number ï¼šä¸­æ–­è¾“å‡º buffer çš„å¤§å°ï¼Œå•ä½æ˜¯å­—èŠ‚ï¼Œé»˜è®¤æ˜¯2048 ã€‚\n-o opt[,opt\u0026hellip;] ï¼šé¢å¤–é€‰é¡¹ï¼Œç”¨é€—å·éš”å¼€ï¼ŒåŒ…æ‹¬ï¼š\nnodaemon â€”â€” ä¸è¦è°ƒç”¨ procmgr_daemon() æ˜¯é©±åŠ¨åœ¨åå°è¿è¡Œã€‚å¦‚æœä½ éœ€è¦çŸ¥é“è®¾å¤‡ç»ˆæ­¢çš„æ—¶é—´ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ã€‚ priority=prio â€”â€” è®¾ç½®å†…éƒ¨è„‰å†²çš„å·¥ä½œä¼˜å…ˆçº§ã€‚ -S|s ï¼šå…³é—­/ä½¿èƒ½è½¯ä»¶æµæ§åˆ¶ã€‚é»˜è®¤ï¼šraw æ¨¡å¼æ—¶å…³é—­ï¼Œedited æ¨¡å¼æ—¶ä½¿èƒ½ã€‚\n-T number ï¼šä½¿èƒ½å‘é€ FIFO å¹¶è®¾ç½®æ¯æ¬¡ TX ä¸­æ–­å‘é€çš„å­—ç¬¦æ•°ï¼š1,4,8 æˆ– 14 ã€‚é»˜è®¤æ˜¯ 0 ï¼ˆFIFO å…³é—­ï¼‰\n-t number ï¼šä½¿èƒ½æ¥æ”¶ FIFO å¹¶è®¾ç½®å­—ç¬¦æ•°ä¸º 1,4,8 æˆ– 14 ã€‚é»˜è®¤æ˜¯ 0 ã€‚\n-u number ï¼šåœ¨è®¾å¤‡åå‰ç¼€(/dev/ser)é™„åŠ å·ç ã€‚é»˜è®¤æ˜¯ 1 ï¼›æ·»åŠ è®¾å¤‡ã€‚\nport ï¼šä¸€ä¸ªä¸²å£çš„åå…­è¿›åˆ¶çš„ I/O åœ°å€ï¼ˆX86ç³»ç»Ÿï¼‰æˆ–ç‰©ç†å†…å­˜åœ°å€ï¼ˆPowerPCå’ŒMIPSï¼‰ã€‚\nshift ï¼šè®¾å¤‡å¯„å­˜å™¨çš„é—´éš”ä¸º 2 çš„å¹‚ã€‚ä¾‹å¦‚ï¼š\n0 å¯„å­˜å™¨æ˜¯ 1 byte é—´éš” 1 å¯„å­˜å™¨æ˜¯ 2 byte é—´éš” 2 å¯„å­˜å™¨æ˜¯ 4 byte é—´éš” \u0026hellip; n å¯„å­˜å™¨æ˜¯ 2^n byte é—´éš” é»˜è®¤ shift æ˜¯ 0 ã€‚\nintr ï¼š è¯¥ port ä½¿ç”¨çš„ä¸­æ–­ã€‚\næè¿°ï¼š #å¦‚æœæ²¡æœ‰æŒ‡å®š I/O ç«¯å£ï¼Œé»˜è®¤ä¸º COM1(3f8,4) å’Œ COM2(2f8,3) ã€‚\n","date":"2013 June 9","permalink":"/posts/2013/06/09/","section":"Posts","summary":"devc-ser8250 æ˜¯ QNX ä¸‹çš„8250ä¸²å£é©±åŠ¨ï¼Œæ”¯æŒ8250s, 14450s å’Œ 16550s ã€‚","title":"QNXä¸‹çš„ä¸²å£é©±åŠ¨â€”â€”devc-ser8250"},{"content":"è¦è¯»å†™ I/O ç«¯å£ï¼Œå¿…é¡»è·å¾— I/O æƒé™ï¼Œè¿™éœ€è¦ä»¥ root æƒé™è¿è¡Œçº¿ç¨‹ï¼Œå¹¶ä¸”è°ƒç”¨ ThreadCtl() å‡½æ•°ï¼š\n#include \u0026lt;sys/neutrino.h\u0026gt; ThreadCtl( _NTO_TCTL_IO, 0 ); ç„¶åè°ƒç”¨ mmap_device_io å‡½æ•°æ˜ å°„ I/O ç«¯å£åœ°å€ï¼š\n#include \u0026lt;stdint.h\u0026gt; #include \u0026lt;sys/mman.h\u0026gt; uintptr_t mmap_device_io( size_t len, uint64_t io ); io è¡¨ç¤ºè¦è®¿é—®çš„ I/O ç«¯å£åœ°å€ï¼ˆåŸºåœ°å€ï¼‰ï¼Œlen è¡¨ç¤ºè¦è®¿é—®çš„ I/O ç«¯å£çš„å­—èŠ‚æ•°ã€‚å¦‚æœè°ƒç”¨æˆåŠŸä¼šè¿”å›æ˜ å°„åçš„èµ·å§‹åœ°å€ï¼Œå¯ä»¥ç›´æ¥ç”¨ in8 å’Œ out8 ç­‰å‡½æ•°è®¿é—®ï¼›å¦‚æœå¤±è´¥åˆ™è¿”å› MAP_DEVICE_FAILEDã€‚\nè°ƒç”¨è¯»å†™ I/O ç«¯å£çš„å‡½æ•°è¦åŒ…æ‹¬å¤´æ–‡ä»¶ï¼š\n#include \u0026lt;hw/inout.h\u0026gt; ä¸»è¦çš„å‡½æ•°æœ‰ï¼š\nuint8_t in8( uintptr_t port ); ä»æŒ‡å®šç«¯å£è¯»å– 8 ä½æ•°æ®ï¼Œport è¡¨ç¤ºç«¯å£åœ°å€ï¼Œè¿”å›å€¼æ˜¯è¯»åˆ°çš„æ•°æ®ã€‚\nvoid out8( uintptr_t port, uint8_t val ); å‘æŒ‡å®šç«¯å£å†™ä¸€ä¸ª 8 ä½æ•°æ®ã€‚\n","date":"2013 June 2","permalink":"/posts/2013/06/02/","section":"Posts","summary":"è¦è¯»å†™ I/O ç«¯å£ï¼Œå¿…é¡»è·å¾— I/O æƒé™ï¼Œè¿™éœ€è¦ä»¥ root æƒé™è¿è¡Œçº¿ç¨‹ï¼Œå¹¶ä¸”è°ƒç”¨ ThreadCtl() å‡½æ•°ï¼š","title":"QNX ç¼–ç¨‹è¯»å†™ I/O ç«¯å£"},{"content":"30å¤©è¯„ä¼°ç‰ˆé¡µé¢ï¼šhttp://www.qnx.com/products/evaluation/ åœ¨è¯¥é¡µé¢ä¸‹è½½æ‰€éœ€è½¯ä»¶ï¼Œå¹¶ç”³è¯· License ã€‚\nç³»ç»Ÿç¯å¢ƒä¸ºï¼šWindows XP å’Œ VMware 7.0\n1. å®‰è£… Windows å¹³å°çš„ QNX å¼€å‘å¥—ä»¶ #ä¸‹è½½ QNXSDP-6.5.0 å’Œ QNXSDP-6.5.0-SP1 ï¼Œä¾æ¬¡å®‰è£…ï¼Œå®‰è£…è¿‡ç¨‹ä¸­éœ€è¦è¾“å…¥ License ã€‚\næ³¨æ„ï¼šå®‰è£…ç›®å½•ä¸èƒ½æœ‰ç©ºæ ¼ï¼Œå¦åˆ™ä»¥åä½¿ç”¨è¿‡ç¨‹ä¸­ä¼šå‡ºé”™ã€‚\nå®‰è£…ååœ¨æ¡Œé¢ä¼šå‡ºç° QNX Momentics IDE 4.7 çš„å›¾æ ‡:\n2. åœ¨ VMWare ä¸­è¿è¡Œ QNX #åœ¨è¯¥é¡µé¢ä¸­é€‰æ‹© VMware (PC) target ï¼Œä¸‹è½½æ–‡ä»¶ 650SP1-VM.tar ã€‚ä¸‹è½½åè§£å‹ã€‚\nç„¶åç”¨ VMware Workstation 7.0 æˆ– VMware Player 3.0 æ‰“å¼€å…¶ä¸­çš„ 650SP1-VM.vmx æ–‡ä»¶ã€‚\nå¦‚æœåœ¨å¯åŠ¨è¿‡ç¨‹ä¸­ VMWare å¼¹å‡ºå¯¹è¯æ¡†æç¤ºâ€œè™šæ‹Ÿæœºè¢«ç§»åŠ¨â€ï¼Œé€‰æ‹© Create å¹¶ç‚¹å‡» OK ã€‚\nå¯åŠ¨åæ— éœ€å¯†ç å¯ç›´æ¥ç”¨ root ç”¨æˆ·ç™»å½•ã€‚\nç™»å½•åæ‰“å¼€ç»ˆç«¯ï¼Œç”¨ ifconfig æŸ¥çœ‹ç½‘å¡é…ç½®ï¼Œç”¨ ping å‘½ä»¤æŸ¥çœ‹ç½‘ç»œè¿æ¥ã€‚ç¡®ä¿å¯ä»¥å’Œå®¿ä¸»æœºè”é€šã€‚\né»˜è®¤æ˜¯ç”¨ DHCP æ–¹å¼è·å– IP ã€‚\n3. åˆ›å»ºç¨‹åºé¡¹ç›® #æ‰“å¼€ QNX Momentics IDE ã€‚é¦–æ¬¡æ‰“å¼€æ˜¯æ ¹æ®æç¤ºè®¾ç½® Workspace ï¼Œè·¯å¾„ä¸­ä¸èƒ½æœ‰ç©ºæ ¼ã€‚\nåœ¨èœå•ä¸Šé€‰æ‹© File / New / QNX C Project ï¼Œæ‰“å¼€ New Project å¯¹è¯æ¡†:\nè¾“å…¥ Project Name ï¼Œç‚¹å‡» Next ã€‚åœ¨ Build Variants æ ‡ç­¾é¡µä¸­é€‰æ‹© X86(Little Endian) ã€‚æœ€åç‚¹å‡» Finish :\nè¿™æ—¶ IDE å¯èƒ½è¿˜å¤„äº Welcome é¡µé¢ï¼Œç‚¹å‡»å³ä¸Šæ–¹çš„ Workbench å›¾æ ‡ï¼Œè¿›å…¥é¡¹ç›®é¡µé¢ã€‚\n4. QNX çš„é€šè®¯ #ç›®æ ‡æœºç³»ç»Ÿéœ€è¦èƒ½å¤Ÿå“åº”æ¥è‡ªå¼€å‘ç¯å¢ƒçš„è¯·æ±‚ï¼Œæ‰€ä»¥è¦ä¿è¯ç½‘ç»œè¿é€šï¼Œå¹¶ä¸”åœ¨ç›®æ ‡æœºç³»ç»Ÿçš„ç»ˆç«¯é‡Œå¯åŠ¨ qconn ç¨‹åºï¼š\nç„¶ååœ¨å¼€å‘ç¯å¢ƒçš„ Window èœå•ä¸­é€‰æ‹© Open Perspective\u0026ndash;\u0026gt;QNX System Information ï¼Œåœ¨æ‰“å¼€çš„ Target Navigator æ ‡ç­¾é¡µçš„ç©ºç™½å¤„ç‚¹å‡»é¼ æ ‡å³é”®å¹¶é€‰æ‹© New QNX Target\u0026hellip; :\nåœ¨æ‰“å¼€çš„å¯¹è¯æ¡†ä¸­è¾“å…¥ Target Nameï¼Œä¹Ÿå¯ä»¥é€‰æ‹© Same as hostname ï¼Œè¾“å…¥ç›®æ ‡æœºçš„ IP ã€‚ç‚¹å‡» Finish :\nç„¶ååœ¨ Target Navigator ä¸­ç‚¹å‡»åˆšæ‰æ–°å»ºçš„ç›®æ ‡å°±å¯ä»¥åœ¨å³è¾¹çš„ System Summary é¡µé¢çœ‹åˆ°ç›®æ ‡æœºç³»ç»Ÿçš„è¿›ç¨‹åˆ—è¡¨:\n5. ç¼–è¯‘å’Œé“¾æ¥ #ç‚¹å‡»å³ä¸Šæ–¹çš„ C/C++ å›¾æ ‡ä» QNX System Information é¡µé¢è¿”å›é¡¹ç›®æºç ç¼–è¾‘é¡µé¢:\nåœ¨é¡¹ç›®åç§°ä¸Šç‚¹å‡»é¼ æ ‡å³é”®ï¼Œé€‰æ‹© Build Project å¼€å§‹ç¼–è¯‘é“¾æ¥ã€‚ç¼–è¯‘è¿‡ç¨‹åº”è¯¥ä¸ä¼šæŠ¥é”™ã€‚\n6. å¯åŠ¨å’Œè°ƒè¯• #é¦–å…ˆè¦åˆ›å»ºä¸€ä¸ªå¯åŠ¨é…ç½®ã€‚åœ¨å·¥å…·æ ä¸Šçš„ bug å›¾æ ‡ä¸‹æ‹‰èœå•ä¸­é€‰æ‹© Debug Configurationsâ€¦ ï¼š\nç„¶åä¼šå‡ºç°ä¸€ä¸ªå¯¹è¯æ¡†ï¼Œåœ¨è¿™é‡Œå¯ä»¥åˆ›å»ºã€ç®¡ç†å’Œå¯åŠ¨é…ç½®ã€‚\nåœ¨å·¦æ ä¸­é€‰æ‹© C/C++ QNX QConn (IP) ï¼Œç„¶åç‚¹å‡» New launch configuration å›¾æ ‡ï¼š\nç°åœ¨åªéœ€è¦è®¾ç½® main æ ‡ç­¾é¡µä¸­çš„å†…å®¹ã€‚åœ¨ C/C++ Application ä¸­ç‚¹å‡» C/C++ Application æŒ‰é’®ï¼Œé€‰æ‹©éœ€è¦å¯åŠ¨å’Œè°ƒè¯•çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå…¶ä¸­å¸¦æœ‰ _g åç¼€çš„æ–‡ä»¶å¸¦æœ‰è°ƒè¯•ä¿¡æ¯ï¼Œå¦åˆ™åªèƒ½è¿è¡Œä¸èƒ½è°ƒè¯•ã€‚é€‰æ‹©åç‚¹å‡» OK ã€‚\nç¡®ä¿ç›®æ ‡æœºåœ¨ Target Options ä¸‹åˆ—è¡¨ä¸­ï¼Œç„¶åç‚¹å‡» Apply ï¼Œä¸€ä¸ªæ–°çš„å¯åŠ¨é…ç½®å°±å®Œæˆäº†ã€‚\nç°åœ¨ç‚¹å‡» Debug ï¼Œé›†æˆå¼€å‘ç¯å¢ƒå°±è¿›å…¥äº†è°ƒè¯•ç•Œé¢ï¼Œå¹¶é€šè¿‡ç½‘ç»œå°†å¯æ‰§è¡Œç¨‹åºä¼ é€åˆ°äº†ç›®æ ‡æœºçš„ç³»ç»Ÿä¸­ï¼Œç„¶ååœ¨è°ƒè¯•å™¨ä¸­å¯åŠ¨å®ƒã€‚\n","date":"2013 May 2","permalink":"/posts/2013/05/02/","section":"Posts","summary":"30å¤©è¯„ä¼°ç‰ˆé¡µé¢ï¼šhttp://www.qnx.com/products/evaluation/ åœ¨è¯¥é¡µé¢ä¸‹è½½æ‰€éœ€è½¯ä»¶ï¼Œå¹¶ç”³è¯· License ã€‚","title":"æ­å»º QNX å¼€å‘ç¯å¢ƒ"},{"content":" xagrs \u0026ndash; ä»æ ‡å‡†è¾“å…¥è·å¾—å‚æ•°å¹¶æ‰§è¡Œå‘½ä»¤\nxargs æœ‰ç‚¹ç±»ä¼¼åå¼•å· ï¼Œä½†æ˜¯åŠŸèƒ½æ›´å¼ºå¤§ï¼Œå®ƒä»æ ‡å‡†è¾“å…¥è·å¾—å‚æ•°åˆ—è¡¨ï¼Œç„¶ååˆ†å‰²å°å—åˆ†æ®µï¼Œå†é€æ¡ä¼ é€’ç»™å…¶ä»–å‘½ä»¤å¹¶æ‰§è¡Œã€‚ä¾‹å¦‚ï¼š\nfind ./ -type f | xargs grep date è¯¥å‘½ä»¤ç›¸å½“äºå¯¹å½“å‰ç›®å½•ä¸‹çš„æ¯ä¸ªæ–‡ä»¶æ‰§è¡Œä¸€æ¬¡ grep date ï¼Œä¹Ÿå°±æ˜¯å°†åˆ—å‡ºå½“å‰ç›®å½•ä¸‹æ–‡ä»¶å†…å®¹ä¸­åŒ…å« date çš„æ–‡ä»¶ ã€‚å¦‚æœæ²¡æœ‰ xargsï¼Œåªä¼šåˆ—å‡ºå½“å‰ç›®å½•ä¸‹æ–‡ä»¶åä¸­åŒ…å« date å­—æ®µçš„æ–‡ä»¶ã€‚\nä½†æ˜¯ä¸Šé¢è¿™ä¸ªä¾‹å­å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœæ–‡ä»¶åä¸­åŒ…å«æœ‰ç©ºæ ¼ï¼Œä¼šå‡ºé”™ï¼Œè¿™æ˜¯å› ä¸º xargs é»˜è®¤æ˜¯æŒ‰ç…§ç©ºç™½å­—ç¬¦æ¥åˆ†å‰²è¾“å…¥çš„ã€‚ä¸€ä¸ªç®€å•çš„è§£å†³åŠæ³•å°±æ˜¯å‘Šè¯‰findä½¿ç”¨NUL(\\0)æ¥åˆ†å‰²ç»“æœï¼ˆå‘findæä¾›-print0é€‰é¡¹ï¼‰ï¼Œå¹¶ä¸”å‘Šè¯‰xargsä¹Ÿä½¿ç”¨Nulæ¥åˆ†éš”è¾“å…¥ï¼ˆ-0ï¼‰ã€‚ä¾‹å¦‚åˆ é™¤å½“å‰ç›®å½•ä¸‹æ‰€æœ‰çš„ python æ–‡ä»¶ï¼š\nfind ./ -name '*.py' -type f -print0 | xargs -0 rm å¦‚æœè¦æŒ‡å®šå‚æ•°åœ¨å‘½ä»¤ä¸­çš„æ–‡ä»¶ï¼Œå¯ä»¥ç”¨ -i é€‰é¡¹å’Œ {} çš„ç»„åˆï¼Œå‚æ•°å°±ä¼šè¢«æ”¾åˆ° {} æ‰€åœ¨çš„ä½ç½®ã€‚ä¾‹å¦‚ï¼Œå°†å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶ç§»åŠ¨åˆ° back ç›®å½•ä¸‹ï¼š\nfind ./ -type f | xargs -i mv {} ./back/ æœ‰çš„å‘½ä»¤æ‰§è¡Œæ—¶éœ€è¦ä¸æ­¢ä¸€ä¸ªå‚æ•°ï¼Œxargs æä¾›äº† -n é€‰é¡¹æŒ‡å®šå‚æ•°æ•°ç›®ã€‚ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œé€å¯¹æ¯”è¾ƒå½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶çš„ä¸åŒï¼š\nfind ./ -type f | xargs -n 2 diff è¿˜ç”¨ä¸¤ä¸ªæœ‰ç”¨çš„é€‰é¡¹ï¼š\n-t æ¯æ¬¡æ‰§è¡Œå‘½ä»¤å‰å°†å®Œæ•´çš„å‘½ä»¤æ‰“å°ä¸€æ¬¡ -r åœ¨æ— è¾“å…¥æƒ…å†µä¸‹åˆ™ä¸æ„é€ å‘½ä»¤æ‰§è¡Œ ","date":"2013 April 28","permalink":"/posts/2013/04/28/","section":"Posts","summary":"xagrs \u0026ndash; ä»æ ‡å‡†è¾“å…¥è·å¾—å‚æ•°å¹¶æ‰§è¡Œå‘½ä»¤","title":"xargs å‘½ä»¤"},{"content":" ä¸‹è½½æºç å‰å¿…é¡»ç¡®ä¿å·²ç»å®‰è£…äº† dpkg-dev ã€‚ä½¿ç”¨ apt-get install dpkg-dev å‘½ä»¤å®‰è£…ã€‚\næŸ¥æ‰¾å¸¦ubuntuè¡¥ä¸çš„å†…æ ¸æºç \napt-cache search linux-source è¯¥æ¡å‘½ä»¤ä¼šæŸ¥æ‰¾åˆ°å¾ˆå¤šç‰ˆæœ¬çš„å†…æ ¸æºç ï¼Œé€‰æ‹©æ‰€éœ€è¦çš„ï¼Œç„¶åæ‰§è¡Œï¼š\napt-get source linux-source-[version] å¼€å§‹å°†å†…æ ¸æºç åŒ…ä¸‹è½½åˆ°å½“å‰ç›®å½•ä¸­ã€‚æºç åŒ…ä¸­æœ‰ä¸‰ä¸ªæ–‡ä»¶ï¼š*.dsc ã€*.diff.gz å’Œ *.orig.tar.gz ã€‚\nä¸‹è½½å®Œæˆåä¼šè‡ªåŠ¨è°ƒç”¨ dpkg-source å‘½ä»¤ï¼Œæ ¹æ® dsc æ–‡ä»¶ä¸­çš„ä¿¡æ¯ï¼Œå°†æºç åŒ…è§£å‹åˆ°åŒåç›®å½•ä¸­ã€‚ç„¶åå°±å¯ä»¥åœ¨æºç ç›®å½•ä¸‹ç¼–è¯‘å†…æ ¸äº†ã€‚\nä¸åªæ˜¯å†…æ ¸æºç ï¼Œç”¨ apt-get ä¸‹è½½å…¶ä»–æºç ä¹Ÿæ˜¯è¿™æ ·çš„æ–¹å¼ã€‚\nåœ¨ç¼–è¯‘æºç åŒ…å‰ï¼Œè¿˜å¯ä»¥ç”¨ä¸‹é¢å‘½ä»¤å®‰è£…å…·æœ‰ä¾èµ–å…³ç³»çš„ç›¸å…³è½¯ä»¶åŒ…ï¼š\napt-get build-dep åœ¨æºç ç›®å½•ä¸‹æ‰§è¡Œ dpkg-buildpackage å‘½ä»¤ï¼Œä¼šç”Ÿæˆ Deb è½¯ä»¶åŒ…ï¼Œå¹¶æ”¾ç½®åœ¨ä¸Šå±‚ç›®å½•ä¸­ã€‚\n","date":"2013 April 27","permalink":"/posts/2013/04/27/","section":"Posts","summary":"ä¸‹è½½æºç å‰å¿…é¡»ç¡®ä¿å·²ç»å®‰è£…äº† dpkg-dev ã€‚ä½¿ç”¨ apt-get install dpkg-dev å‘½ä»¤å®‰è£…ã€‚","title":"åœ¨ ubuntu ä¸­ä¸‹è½½å†…æ ¸æºç "},{"content":"GRUB2 æŒ‡å—ä¸­æ–‡ç‰ˆ\nä¿®æ”¹ GRUB2 çš„é…ç½®æ–‡ä»¶åï¼Œéƒ½è¦æ‰§è¡Œ update_grub å‘½ä»¤ç”Ÿæˆ /boot/grub/grub.cfg æ–‡ä»¶ï¼Œè¿™æ ·æ‰èƒ½ä½¿ä¿®æ”¹ç”Ÿæ•ˆã€‚ä»»ä½•æƒ…å†µä¸‹éƒ½ä¸å»ºè®®æ‰‹åŠ¨æ›´æ”¹è¯¥æ–‡ä»¶ã€‚\n1.æ˜¾ç¤ºå¯åŠ¨èœå• #é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœåªå®‰è£…äº†ä¸€ä¸ªç³»ç»Ÿï¼ŒGRUB2æ˜¯ä¸ä¼šæ˜¾ç¤ºå¯åŠ¨èœå•çš„ã€‚\nå¯ä»¥åœ¨å¯åŠ¨æ—¶æŒ‰ä½ Shift é”®ï¼Œå¼ºåˆ¶æ˜¾ç¤ºå¯åŠ¨èœå•ã€‚\n2.ä¿®æ”¹é»˜è®¤å¯åŠ¨é¡¹ #åœ¨ /etc/default/grub æ–‡ä»¶ä¸­ï¼Œè®¾ç½® GRUB_DEFAULTï¼š\nGRUB_DEFAULT = 0 /boot/grub/grub.cfg æ–‡ä»¶ä¸­çš„ç¬¬ä¸€ä¸ªèœå•é¡¹ä¸º 0 ï¼Œç¬¬äºŒä¸ªä¸º 1 \u0026hellip;\nä¹Ÿå¯ä»¥è®¾ç½®ä¸º saved ï¼Œè¡¨ç¤ºé»˜è®¤å¯åŠ¨é¡¹ä¸ºä¸Šä¸€æ¬¡é€‰æ‹©çš„é¡¹ç›®ã€‚\n3.ä¿®æ”¹ Linux å†…æ ¸å‚æ•° #åœ¨ /etc/default/grub æ–‡ä»¶ä¸­ï¼Œæœ‰ä¸¤ä¸ªé€‰é¡¹ç”¨äºè®¾ç½®å‘ Linux å†…æ ¸ä¼ é€’çš„å‚æ•°ï¼š\nGRUB_CMDLINE_LINUX è‹¥å­˜åœ¨ï¼Œæ— è®ºåœ¨ä¸€èˆ¬æˆ–æ˜¯æ•‘æ´æ¨¡å¼ï¼Œæ­¤è¡Œå°†è¿½åŠ åˆ°æ‰€æœ‰çš„ \u0026rsquo;linux\u0026rsquo; å‘½ä»¤è¡Œåé¢ï¼ˆä¼ ç»Ÿ GRUB çš„ã€Œkernelã€é€‰é¡¹ï¼‰ã€‚ç±»ä¼¼äº menu.lst ä¸­çš„ã€Œaltoptions ã€é€‰é¡¹ã€‚ GRUB_CMDLINE_LINUX_DEFAULT æ­¤è¡Œå°†è¿½åŠ åœ¨ \u0026rsquo;linux\u0026rsquo; å‘½ä»¤è¡Œåé¢ï¼ˆä¼ ç»Ÿ GRUB çš„ã€Œkernelã€é€‰é¡¹ï¼‰ã€‚æ­¤é€‰é¡¹åªä¼šè¿½åŠ åœ¨ä¸€èˆ¬æ¨¡å¼çš„æœ€åæ–¹ã€‚ç±»ä¼¼äº menu.lst ä¸­çš„ã€Œdefoptionsã€é€‰é¡¹ã€‚å¦‚æœæƒ³æ˜¾ç¤ºé»‘è‰²å±å¹•ä»¥åŠå¯åŠ¨è¿›ç¨‹æ–‡å­—ï¼Œè¯·ç§»é™¤ã€Œquiet splashã€ã€‚è‹¥æƒ³çœ‹åˆ° grub å¼•å¯¼ç”»é¢åŠç®€çŸ­çš„æ–‡å­—è¾“å‡ºï¼Œä½¿ç”¨ã€Œsplashã€ã€‚è‹¥æœ‰éœ€è¦çš„è¯ï¼Œä¹Ÿå¯ä»¥åœ¨æ­¤è¡Œè¾“å…¥é€‰é¡¹ã€Œacpi=offã€ã€‚ ","date":"2013 April 25","permalink":"/posts/2013/04/25/","section":"Posts","summary":"GRUB2 æŒ‡å—ä¸­æ–‡ç‰ˆ","title":"GRUB2å¸¸ç”¨é…ç½®"},{"content":"åŸç† #X86æ¶æ„çš„èœ‚é¸£å™¨è¿æ¥å›¾å¦‚ä¸‹ï¼š\nç”±å›¾å¯è§ï¼Œèœ‚é¸£å™¨çš„å£°è°ƒæ˜¯ç”±å®šæ—¶å™¨8254çš„è®¡æ•°å™¨2çš„è¾“å‡º OUT2 æ§åˆ¶çš„ï¼ŒOUT2 è¾“å‡ºä¸€å®šé¢‘ç‡çš„æ­£å¼¦æ³¢å°±å¯ä»¥é©±åŠ¨èœ‚é¸£å™¨å‘å£°ã€‚8254 çš„ç«¯å£åœ°å€æ˜¯ 0x40~0x43 ã€‚\nè®¡æ•°å™¨2æ˜¯å¦å·¥ä½œç”±é—¨æ§ä¿¡å· GATE2 å†³å®šï¼ŒGATE2 æ¥å¹¶å£ PB0 ä½ï¼Œå³ IO ç«¯å£ 0x61 çš„ D0 ä½ã€‚OUT2 å’Œ PB1 ç»è¿‡ä¸€ä¸ªä¸é—¨åè¿æ¥åˆ°èœ‚é¸£å™¨ï¼ŒPB1 æ˜¯ IO ç«¯å£ 0x61 çš„ D1 ä½ã€‚æ‰€ä»¥åªæœ‰å½“ PB0 å’Œ PB1 åŒæ—¶ä¸ºé«˜ï¼ŒOUT2 çš„è¾“å‡ºæ‰ä¼šåˆ°è¾¾èœ‚é¸£å™¨ã€‚\nç¼–ç¨‹ #åœ¨ Linux ä¸‹ï¼Œå¯ä»¥ç›´æ¥åœ¨ç”¨æˆ·ç©ºé—´è®¿é—® IO ç«¯å£ã€‚ä¸‹é¢ç¨‹åºå°†æ˜¯èœ‚é¸£å™¨å‘å£° 2 ç§’ã€‚\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;unistd.h\u0026gt; #include \u0026lt;sys/io.h\u0026gt; /* * val ä¸ºå†™å…¥è®¡æ•°å™¨çš„å€¼ * delay ä¸ºèœ‚é¸£å™¨å‘å£°æŒç»­çš„æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’ */ void beep(unsigned short int val,int delay) { unsigned char reg_val = 0; iopl(3); outb(0xb6,0x43); //counter 2 , mode 3 outb(val\u0026amp;0x00ff,0x42); outb(val\u0026gt;\u0026gt;8,0x42); reg_val = inb(0x61); outb(reg_val|0x03,0x61); //PB0å’ŒPB1è¾“å‡ºé«˜ç”µå¹³ usleep(1000*delay); outb(reg_val\u0026amp;0xfc,0x61); //PB0å’ŒPB1è¾“å‡ºä½ç”µå¹³ iopl(0); } int main() { beep(500,2000); return 0; } ","date":"2013 January 24","permalink":"/posts/2013/01/24/","section":"Posts","summary":"\u003ch2 id=\"åŸç†\" class=\"relative group\"\u003eåŸç† \u003cspan class=\"absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100\"\u003e\u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\" style=\"text-decoration-line: none !important;\" href=\"#%e5%8e%9f%e7%90%86\" aria-label=\"é”šç‚¹\"\u003e#\u003c/a\u003e\u003c/span\u003e\u003c/h2\u003e\u003cp\u003eX86æ¶æ„çš„èœ‚é¸£å™¨è¿æ¥å›¾å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cp\u003e\n\n\n\n\n  \n  \n  \n    \u003cfigure\u003e\n      \u003cimg\n        class=\"mx-auto my-0 rounded-md\"\n        src=\"./pics_1.JPG\"\n        alt=\"\"\n        \n          loading=\"lazy\"\n        \n      /\u003e\n      \n    \u003c/figure\u003e\n  \n\u003c/p\u003e\n\u003cp\u003eç”±å›¾å¯è§ï¼Œèœ‚é¸£å™¨çš„å£°è°ƒæ˜¯ç”±å®šæ—¶å™¨8254çš„è®¡æ•°å™¨2çš„è¾“å‡º OUT2 æ§åˆ¶çš„ï¼ŒOUT2 è¾“å‡ºä¸€å®šé¢‘ç‡çš„æ­£å¼¦æ³¢å°±å¯ä»¥é©±åŠ¨èœ‚é¸£å™¨å‘å£°ã€‚8254 çš„ç«¯å£åœ°å€æ˜¯ 0x40~0x43 ã€‚\u003c/p\u003e","title":"Linux ç³»ç»Ÿä¸‹ç¼–ç¨‹æ§åˆ¶èœ‚é¸£å™¨"},{"content":"udev æ˜¯ linux 2.6 å†…æ ¸æä¾›çš„ä¸€ç§åŠ¨æ€ç®¡ç†è®¾å¤‡å™¨ï¼Œä¸»è¦åŠŸèƒ½æ˜¯ç®¡ç† /dev ç›®å½•ä¸‹çš„è®¾å¤‡èŠ‚ç‚¹ï¼ŒåŒæ—¶ä¹Ÿæ›¿æ¢äº† devfs å’Œ hotplug çš„åŠŸèƒ½ï¼Œè¿™æ„å‘³ç€å®ƒè¦åœ¨æ·»åŠ /åˆ é™¤ç¡¬ä»¶æ—¶å¤„ç† /dev ç›®å½•ä»¥åŠæ‰€æœ‰ç”¨æˆ·ç©ºé—´çš„è¡Œä¸ºï¼ŒåŒ…æ‹¬åŠ è½½ firmware æ—¶ã€‚\nudev ä¾èµ–äºå†…æ ¸æä¾›çš„ uevent æ¥å£ï¼Œæ¯æ¬¡æ·»åŠ æˆ–åˆ é™¤è®¾å¤‡æ—¶ï¼Œå†…æ ¸éƒ½ä¼šå‘é€ uevent å‘ udev é€šçŸ¥æ›´æ”¹ã€‚udev çš„å®ˆæŠ¤è¿›ç¨‹æ˜¯ udevd ï¼Œåœ¨ç³»ç»Ÿå¯åŠ¨æ—¶ä¼šè¯»å–å¹¶åˆ†æ udev è§„åˆ™æ–‡ä»¶æä¾›çš„æ‰€æœ‰è§„åˆ™ï¼Œå¹¶ä¿å­˜åœ¨å†…å­˜ã€‚ å½“ udev æ¥æ”¶åˆ°å†…æ ¸å‘å‡ºçš„è®¾å¤‡æ›´æ”¹äº‹ä»¶åï¼Œä¼šå°†è®¾å¤‡ä¿¡æ¯ä¸è§„åˆ™è¿›è¡ŒåŒ¹é…ï¼Œç„¶åæ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚\nlinuxå†…æ ¸ä¸­çš„è®¾å¤‡ä¿¡æ¯éƒ½æ˜¯é€šè¿‡ sysfs æ–‡ä»¶ç³»ç»Ÿå¯¼å‡ºçš„ï¼Œä½äº /sys ç›®å½•ä¸‹ã€‚\n1. udevadm #udevadm æ˜¯ä¸€ä¸ª udev ç®¡ç†å·¥å…·ã€‚å¯ç”¨äºç›‘è§†å’Œæ§åˆ¶ udev çš„è¿è¡Œæ—¶è¡Œä¸ºã€è¯·æ±‚å†…æ ¸äº‹ä»¶ã€ç®¡ç†äº‹ä»¶é˜Ÿåˆ—ï¼Œä»¥åŠæä¾›ç®€å•çš„è°ƒè¯•æœºåˆ¶ã€‚\n1.1 ç›‘è§†æ­£åœ¨è¿è¡Œçš„ udev å®ˆæŠ¤è¿›ç¨‹ #ç¨‹åº udevadm monitor ç”¨äºå°†é©±åŠ¨ç¨‹åºæ ¸å¿ƒæ—¶é—´å’Œ udev äº‹ä»¶å¤„ç†çš„è®¡æ—¶å¯è§†åŒ–ã€‚æ‰§è¡Œ udevadm monitor åï¼Œä¼šå‡ºç°å¦‚ä¸‹å†…å®¹ï¼š\nmonitor will print the received events for: UDEV - the event which udev sends out after rule processing KERNEL - the kernel uevent ä¹‹åå‘ç”Ÿçš„æ‰€æœ‰ udev äº‹ä»¶éƒ½ä¼šæ˜¾ç¤ºã€‚ä¾‹å¦‚ä¸‹é¢æ˜¯æ’å…¥ U ç›˜åæ˜¾ç¤ºçš„å‰å‡ è¡Œï¼š\nKERNEL[1356423352.040293] add /devices/pci0000:00/0000:00:11.0/0000:02:03.0/usb1/1-1 (usb) KERNEL[1356423352.098881] add /devices/pci0000:00/0000:00:11.0/0000:02:03.0/usb1/1-1/1-1:1.0 (usb) UDEV [1356423352.181389] add /devices/pci0000:00/0000:00:11.0/0000:02:03.0/usb1/1-1 (usb) KERNEL[1356423352.239535] add /module/usb_storage (module) UDEV [1356423352.241499] add /module/usb_storage (module) æ¯è¡Œè¡¨ç¤ºä¸€ä¸ªäº‹ä»¶ã€‚ç¬¬ä¸€ä¸ªå­—æ®µä¸­ï¼ŒKERNEL è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªå†…æ ¸äº§ç”Ÿçš„äº‹ä»¶ï¼ŒUDEV è¡¨ç¤º udev äº‹ä»¶ã€‚ç¬¬äºŒä¸ªå­—æ®µæ˜¯è®¡æ—¶ï¼Œå•ä½æ˜¯å¾®ç§’ã€‚ç¬¬ä¸‰ä¸ªå­—æ®µè¡¨ç¤ºäº‹ä»¶çš„åŠ¨ä½œï¼Œadd è¡¨ç¤ºæ·»åŠ ï¼Œå¦‚æœå¸è½½ U ç›˜ä¼šæ˜¾ç¤º remove ã€‚æœ€åæ˜¯ sysfs æ–‡ä»¶ç³»ç»Ÿä¸­æ·»åŠ æˆ–åˆ é™¤çš„æ–‡ä»¶å’Œç›®å½•ã€‚\n1.2 æŸ¥è¯¢è®¾å¤‡ä¿¡æ¯ #udevadm info ç”¨äºæŸ¥è¯¢ sysfs æ–‡ä»¶ç³»ç»Ÿä¸­çš„è®¾å¤‡ä¿¡æ¯ï¼Œä¿¡æ¯æ˜¯æŒ‰ç…§ Linux è®¾å¤‡æ¨¡å‹çš„å±‚æ¬¡ç»“æ„æ˜¾ç¤ºçš„ï¼Œé¦–å…ˆæ˜¯è¿™ä¸ªè®¾å¤‡çš„è·¯å¾„å’Œä¿¡æ¯ï¼Œç„¶åä¾æ¬¡éå†å®ƒçš„çˆ¶è®¾å¤‡ã€‚\nä¾‹å¦‚è¦æŸ¥è¯¢ U ç›˜ sdb1 çš„ä¿¡æ¯ï¼Œå°±æ‰§è¡Œï¼š\nudevadm info -a -p /sys/class/block/sdb1 æ˜¾ç¤ºçš„ç¬¬ä¸€æ®µä¿¡æ¯å¦‚ä¸‹ï¼š\nlooking at device '/devices/pci0000:00/0000:00:11.0/0000:02:03.0/usb1/1-1/1-1:1.0/host5/target5:0:0/5:0:0:0/block/sdd/sdd1': KERNEL==\u0026quot;sdd1\u0026quot; SUBSYSTEM==\u0026quot;block\u0026quot; DRIVER==\u0026quot;\u0026quot; ATTR{partition}==\u0026quot;1\u0026quot; ATTR{start}==\u0026quot;1040128\u0026quot; ATTR{size}==\u0026quot;6848768\u0026quot; ATTR{alignment_offset}==\u0026quot;0\u0026quot; ATTR{stat}==\u0026quot; 143 6874 9334 1493 1 0 1 3 0 1266 1496\u0026quot; ATTR{inflight}==\u0026quot; 0 0\u0026quot; KERNEL æ˜¯è®¾å¤‡åœ¨å†…æ ¸ä¸­çš„åç§°ï¼ŒSUBSYSTEM è¡¨ç¤ºå®ƒæ‰€å±çš„å­ç³»ç»Ÿï¼ŒATTR{} è¡¨ç¤ºå„ç§å±æ€§ã€‚è¿™äº›å­—æ®µéƒ½ä¼šåœ¨ udev è§„åˆ™ä¸­ ç”¨åˆ°ã€‚\n2. udev è§„åˆ™ #udev è§„åˆ™å¯ä»¥ä¸å†…æ ¸æ·»åŠ åˆ°äº‹ä»¶æœ¬èº«çš„å±æ€§æˆ–è€…å†…æ ¸å¯¼å‡ºåˆ° sysfs çš„ä»»ä½•ä¿¡æ¯åŒ¹é…ã€‚è§„åˆ™è¿˜å¯ä»¥ä»å¤–éƒ¨ç¨‹åºè¯·æ±‚å…¶ä»–ä¿¡æ¯ã€‚æ ¹æ®æä¾›çš„è§„åˆ™åŒ¹é…æ¯ä¸ªäº‹ä»¶ã€‚æ‰€æœ‰è§„åˆ™éƒ½ä½äº /etc/udev/rules.d ç›®å½•ä¸‹ã€‚\nè§„åˆ™æ–‡ä»¶ä¸­çš„æ¯ä¸€è¡Œè‡³å°‘åŒ…å«ä¸€ä¸ªå…³é”®å­—å€¼å¯¹ã€‚æœ‰ä¸¤ç§ç±»å‹çš„å…³é”®å­—ï¼ŒåŒ¹é…å…³é”®å­—å’ŒæŒ‡æ´¾å…³é”®å­—ã€‚å¦‚æœæ‰€æœ‰åŒ¹é…å…³é”®å­—ä¸å®ƒä»¬çš„å€¼åŒ¹é…ï¼Œåˆ™åº”ç”¨æ­¤è§„åˆ™å¹¶å°†æŒ‡æ´¾å…³é”®å­—æŒ‡æ´¾ç»™ç‰¹å®šçš„å€¼ã€‚åŒ¹é…è§„åˆ™å¯ä»¥æŒ‡å®šè®¾å¤‡èŠ‚ç‚¹çš„åç§°ã€æ·»åŠ æŒ‡å‘è¯¥èŠ‚ç‚¹çš„ç¬¦å·é“¾æ¥æˆ–è€…è¿è¡Œä½œä¸ºäº‹ä»¶å¤„ç†ä¸€éƒ¨åˆ†çš„ç‰¹å®šç¨‹åºã€‚å¦‚æœæ‰¾ä¸åˆ°åŒ¹é…çš„è§„åˆ™ï¼Œåˆ™ä½¿ç”¨é»˜è®¤è®¾å¤‡èŠ‚ç‚¹åæ¥åˆ›å»ºè®¾å¤‡èŠ‚ç‚¹ã€‚udev æ‰‹å†Œé¡µä¸­æè¿°äº†æœ‰å…³è§„åˆ™è¯­æ³•å’Œæä¾›ç”¨æ¥ä¸æ•°æ®åŒ¹é…æˆ–å¯¼å…¥æ•°æ®çš„å…³é”®å­—çš„è¯¦ç»†ä¿¡æ¯ã€‚\nä¸‹é¢è¿™ä¸ªä¾‹å­æ¥è‡ª /etc/udev/rules.d/10-automount.rules ã€‚\nKERNEL==\u0026quot;sd[b-z]\u0026quot;,SUBSYSTEM==\u0026quot;block\u0026quot;,BUS==\u0026quot;usb\u0026quot;,SYMLINK+=\u0026quot;usb_%k\u0026quot; KERNEL==\u0026quot;sd[b-z][1-9]\u0026quot;,SUBSYSTEM==\u0026quot;block\u0026quot;,BUS==\u0026quot;usb\u0026quot;,SYMLINK+=\u0026quot;usb_%k\u0026quot; ACTION==\u0026quot;add\u0026quot;,KERNEL==\u0026quot;sd[b-z][1-9]\u0026quot;,SUBSYSTEM==\u0026quot;block\u0026quot;,BUS==\u0026quot;usb\u0026quot;,RUN+=\u0026quot;/bin/mkdir -m 777 /media/usb_%k\u0026quot;,RUN+=\u0026quot;/bin/mount -t auto /dev/usb_%k /media/usb_%k\u0026quot; ACTION==\u0026quot;remove\u0026quot;,KERNEL==\u0026quot;sd[b-z][1-9]\u0026quot;,SUBSYSTEM==\u0026quot;block\u0026quot;,BUS==\u0026quot;usb\u0026quot;,RUN+=\u0026quot;/bin/rm -rf /media/usb_%k\u0026quot; å‰ä¸¤æ¡è§„åˆ™ç”±å››ä¸ªé”®æ„æˆï¼šä¸‰ä¸ªåŒ¹é…é”® (KERNEL,SUBSYSTEM,BUS) å’Œä¸€ä¸ªèµ‹å€¼é”® (SYMLINK)ã€‚ä¸‰ä¸ªåŒ¹é…è§„åˆ™æœç´¢è®¾å¤‡åˆ—è¡¨ä»¥æŸ¥æ‰¾æ‰€æœ‰çš„ U ç›˜ã€‚åªæœ‰å®Œå…¨åŒ¹é…æ‰èƒ½è§¦å‘æ‰§è¡Œæ­¤è§„åˆ™ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒSYMLINK æŒ‡æ´¾å…³é”®å­—ä¼šåœ¨ /dev ç›®å½•ä¸‹ç”Ÿäº§ä¸€ä¸ªçš„é“¾æ¥ï¼ŒæŒ‡å‘é»˜è®¤çš„è®¾å¤‡èŠ‚ç‚¹ã€‚åŒ¹é…æ­¤ç‰¹æ®Šè®¾å¤‡ç±»å‹çš„ä»»ä½•åç»­è§„åˆ™éƒ½ä¸äº§ç”Ÿä»»ä½•å½±å“ã€‚\nåä¸¤æ¡è§„åˆ™åˆ†åˆ«å¯¹åº”æ’å…¥(add)å’Œæ‹”å‡º(remove) U ç›˜çš„äº‹ä»¶ã€‚RUN è¡¨ç¤ºäº‹ä»¶å‘ç”Ÿæ—¶æ‰§è¡Œçš„ç¨‹åºã€‚\næ‰€æœ‰è§„åˆ™å…·æœ‰ä¸€äº›å…±åŒçš„ç‰¹å¾:\næ¯ä¸ªè§„åˆ™ç”±ä¸€ä¸ªæˆ–å¤šä¸ªä»¥é€—å·åˆ†éš”çš„å…³é”®å­—å€¼å¯¹æ„æˆã€‚\nå…³é”®å­—çš„è¿ç®—ç”±è¿ç®—ç¬¦ç¡®å®šï¼Œudev è§„åˆ™æ”¯æŒå¤šä¸ªä¸åŒçš„è¿ç®—ç¬¦ã€‚\næ¯ä¸ªç»™å®šå€¼å¿…é¡»ç”¨å¼•å·å¼•èµ·æ¥ã€‚\nè§„åˆ™æ–‡ä»¶çš„æ¯ä¸€è¡Œä»£è¡¨ä¸€ä¸ªè§„åˆ™ã€‚å¦‚æœä¸€ä¸ªè§„åˆ™è¶…è¿‡ä¸€è¡Œï¼Œè¯·ä½¿ç”¨ \\ åˆå¹¶ä¸åŒè¡Œï¼Œå°±åƒåœ¨å£³å±‚è¯­æ³•ä¸­ä¸€æ ·ã€‚\nudev è§„åˆ™æ”¯æŒä¸ *ã€? å’Œ [] æ¨¡å¼åŒ¹é…çš„å¤–å£³å¼æ¨¡å¼ã€‚\nudev è§„åˆ™æ”¯æŒæ›¿æ¢ã€‚\n2.1 åœ¨ udev è§„åˆ™ä¸­ä½¿ç”¨è¿ç®—ç¬¦ #åˆ›å»ºå¯ä»¥ä»è‹¥å¹²ä¸åŒè¿ç®—ç¬¦é€‰æ‹©çš„å…³é”®å­—ï¼Œå…·ä½“å–å†³äºå¸Œæœ›åˆ›å»ºçš„å…³é”®å­—ç±»å‹ã€‚åŒ¹é…å…³é”®å­—é€šå¸¸ä»…ç”¨äºæŸ¥æ‰¾åŒ¹é…æˆ–æ˜æ˜¾ä¸åŒ¹é…æœç´¢å€¼çš„å€¼ã€‚åŒ¹é…å…³é”®å­—åŒ…å«ä»¥ä¸‹è¿ç®—ç¬¦ä¹‹ä¸€ï¼š\n==\tæ¯”è¾ƒç­‰äºæ€§ã€‚å¦‚æœå…³é”®å­—åŒ…å«æœç´¢æ¨¡å¼ï¼Œåˆ™åŒ¹é…è¯¥æ¨¡å¼çš„æ‰€æœ‰ç»“æœå‡æœ‰æ•ˆã€‚\n!=\tæ¯”è¾ƒä¸ç­‰äºæ€§ã€‚å¦‚æœå…³é”®å­—åŒ…å«æœç´¢æ¨¡å¼ï¼Œåˆ™åŒ¹é…è¯¥æ¨¡å¼çš„æ‰€æœ‰ç»“æœå‡æœ‰æ•ˆã€‚\nèµ‹å€¼å…³é”®å­—å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ä»»ä½•è¿ç®—ç¬¦ï¼š\n=\tä¸ºå…³é”®å­—æŒ‡æ´¾å€¼ã€‚å¦‚æœå…³é”®å­—ä»¥å‰ç”±ä¸€åˆ—å€¼æ„æˆï¼Œå…³é”®å­—å°†é‡ç½®ï¼Œå¹¶ä¸”ä»…æŒ‡æ´¾ä¸€ä¸ªå€¼ã€‚\n+=\tä¸ºåŒ…å«ä¸€åˆ—é¡¹çš„å…³é”®å­—æ·»åŠ ä¸€ä¸ªå€¼ã€‚\n:=\tæŒ‡æ´¾æœ€ç»ˆå€¼ã€‚ä¸å…è®¸åé¢çš„è§„åˆ™è¿›è¡Œä»»ä½•åç»­æ›´æ”¹ã€‚\n2.2 åœ¨ udev è§„åˆ™ä¸­ä½¿ç”¨æ›¿æ¢é¡¹ #udev è§„åˆ™æ”¯æŒä½¿ç”¨å ä½ç¬¦å’Œæ›¿æ¢é¡¹ã€‚è¯·æŒ‰ç…§åœ¨å…¶ä»–ä»»ä½•è„šæœ¬ä¸­çš„ç›¸åŒæ–¹å¼ä½¿ç”¨ã€‚åœ¨ udev è§„åˆ™ä¸­å¯ä½¿ç”¨ä»¥ä¸‹æ›¿æ¢é¡¹ï¼š\n%rã€$root\nè®¾å¤‡ç›®å½• /devï¼ˆé»˜è®¤ï¼‰ã€‚\n%pã€$devpath\nDEVPATH çš„å€¼ã€‚\n%kã€$kernel\nKERNEL çš„å€¼æˆ–å†…éƒ¨è®¾å¤‡åç§°ã€‚\n%nã€$number\nè®¾å¤‡å·ã€‚\n%Nã€$tempnode\nè®¾å¤‡æ–‡ä»¶çš„ä¸´æ—¶åç§°ã€‚\n%Mã€$major\nè®¾å¤‡çš„ä¸»ç¼–å·ã€‚\n%mã€$minor\nè®¾å¤‡çš„æ¬¡ç¼–å·ã€‚\n%s{attribute}/$attr{attribute}\nsysfs å±æ€§çš„å€¼ï¼ˆç”± attribute æŒ‡å®šï¼‰ã€‚\n%E{variable}ã€$attr{variable}\nç¯å¢ƒå˜é‡çš„å€¼ï¼ˆç”± variable æŒ‡å®šï¼‰ã€‚\n%cã€$result\nPROGRAM çš„è¾“å‡ºã€‚\n%%\n%å­—ç¬¦ã€‚\n$$\n$ å­—ç¬¦ã€‚\n2.3 ä½¿ç”¨ udev åŒ¹é…å…³é”®å­— #åŒ¹é…å…³é”®å­—æè¿°åº”ç”¨ udev è§„åˆ™ä¹‹å‰å¿…é¡»æ»¡è¶³çš„æ¡ä»¶ã€‚ä»¥ä¸‹åŒ¹é…å…³é”®å­—å¯ç”¨ï¼š\nACTION\näº‹ä»¶æ“ä½œçš„åç§°ï¼Œå¦‚ add æˆ– removeï¼ˆæ·»åŠ æˆ–åˆ é™¤è®¾å¤‡æ—¶ï¼‰ã€‚\nDEVPATH\näº‹ä»¶è®¾å¤‡çš„è®¾å¤‡è·¯å¾„ï¼Œå¦‚ DEVPATH=/bus/pci/drivers/ipw3945ï¼Œç”¨äºæœç´¢ä¸ ipw3945 é©±åŠ¨ç¨‹åºæœ‰å…³çš„æ‰€æœ‰äº‹ä»¶ã€‚\nKERNEL\näº‹ä»¶è®¾å¤‡çš„å†…éƒ¨ï¼ˆå†…æ ¸ï¼‰åç§°ã€‚\nSUBSYSTEM\näº‹ä»¶è®¾å¤‡çš„å­ç³»ç»Ÿï¼Œå¦‚ SUBSYSTEM=usbï¼ˆç”¨äºä¸ USB è®¾å¤‡æœ‰å…³çš„æ‰€æœ‰äº‹ä»¶ï¼‰ã€‚\nATTR{filename}\näº‹ä»¶è®¾å¤‡çš„ sysfs å±æ€§ã€‚ä¾‹å¦‚ï¼Œè¦åŒ¹é… vendor å±æ€§æ–‡ä»¶åä¸­åŒ…å«çš„å­—ç¬¦ä¸²ï¼Œå¯ä»¥ä½¿ç”¨ ATTR{vendor}==\u0026ldquo;On(sS)tream\u0026rdquo;ã€‚\nKERNELS\nè®© udev å‘ä¸Šæœç´¢è®¾å¤‡è·¯å¾„ä»¥æŸ¥æ‰¾åŒ¹é…çš„è®¾å¤‡åç§°ã€‚\nSUBSYSTEMS\nè®© udev å‘ä¸Šæœç´¢è®¾å¤‡è·¯å¾„ä»¥æŸ¥æ‰¾åŒ¹é…çš„è®¾å¤‡å­ç³»ç»Ÿåç§°ã€‚\nDRIVERS\nè®© udev å‘ä¸Šæœç´¢è®¾å¤‡è·¯å¾„ä»¥æŸ¥æ‰¾åŒ¹é…çš„è®¾å¤‡é©±åŠ¨ç¨‹åºåç§°ã€‚\nATTRS{filename}\nè®© udev å‘ä¸Šæœç´¢è®¾å¤‡è·¯å¾„ä»¥æŸ¥æ‰¾å…·æœ‰åŒ¹é…çš„ sysfs å±æ€§å€¼çš„è®¾å¤‡ã€‚\nENV{key}\nç¯å¢ƒå˜é‡çš„å€¼ï¼Œå¦‚ ENV{ID_BUS}=\u0026ldquo;ieee1394ï¼Œç”¨äºæœç´¢ä¸è¯¥ FireWire æ€»çº¿ ID æœ‰å…³çš„æ‰€æœ‰äº‹ä»¶ã€‚\nPROGRAM\nè®© udev æ‰§è¡Œå¤–éƒ¨ç¨‹åºã€‚ç¨‹åºå¿…é¡»è¿”å›é€€å‡ºç é›¶ï¼Œæ‰èƒ½æˆåŠŸã€‚ç¨‹åºçš„è¾“å‡ºï¼ˆæ‰“å°åˆ° stdoutï¼‰å¯ç”¨äº RESULT å…³é”®å­—ã€‚\nRESULT\nåŒ¹é…ä¸Šæ¬¡ PROGRAM è°ƒç”¨çš„è¾“å‡ºå­—ç¬¦ä¸²ã€‚åœ¨ä¸ PROGRAM å…³é”®å­—ç›¸åŒçš„è§„åˆ™ä¸­åŒ…å«è¯¥å…³é”®å­—ï¼Œæˆ–åœ¨åé¢çš„ä¸€ä¸ªä¸­ã€‚\n2.4 ä½¿ç”¨ udev æŒ‡æ´¾å…³é”®å­— #ä¸ä¸Šè¿°åŒ¹é…é”®ç›¸æ¯”ï¼Œèµ‹å€¼é”®æœªæè¿°å¿…é¡»æ»¡è¶³çš„æ¡ä»¶ã€‚å®ƒä»¬å°†å€¼ã€åç§°å’Œæ“ä½œæŒ‡æ´¾ç»™ç”± udev ç»´æŠ¤çš„è®¾å¤‡èŠ‚ç‚¹ã€‚\nNAME\nå°†åˆ›å»ºçš„è®¾å¤‡èŠ‚ç‚¹çš„åç§°ã€‚åœ¨ä¸€ä¸ªè§„åˆ™è®¾ç½®èŠ‚ç‚¹åç§°ä¹‹åï¼Œå°†å¯¹è¯¥èŠ‚ç‚¹å¿½ç•¥å¸¦æœ‰ NAME å…³é”®å­—çš„å…¶ä»–æ‰€æœ‰è§„åˆ™ã€‚\nSYMLINK\nä¸è¦åˆ›å»ºçš„èŠ‚ç‚¹æœ‰å…³çš„ç¬¦å·é“¾æ¥åç§°ã€‚å¤šä¸ªåŒ¹é…çš„è§„åˆ™å¯æ·»åŠ è¦ä½¿ç”¨è®¾å¤‡èŠ‚ç‚¹åˆ›å»ºçš„ç¬¦å·é“¾æ¥ã€‚ä¹Ÿå¯ä»¥é€šè¿‡ä½¿ç”¨ç©ºæ ¼å­—ç¬¦åˆ†éš”ç¬¦å·é“¾æ¥åç§°ï¼Œåœ¨ä¸€ä¸ªè§„åˆ™ä¸­ä¸ºä¸€ä¸ªèŠ‚ç‚¹æŒ‡å®šå¤šä¸ªç¬¦å·é“¾æ¥ã€‚\nOWNER, GROUP, MODE\næ–°è®¾å¤‡èŠ‚ç‚¹çš„æƒé™ã€‚æ­¤å¤„æŒ‡å®šçš„å€¼é‡å†™å·²ç¼–è¯‘çš„ä»»ä½•å€¼ã€‚\nATTR{key}\næŒ‡å®šè¦å†™å…¥äº‹ä»¶è®¾å¤‡çš„ sysfs å±æ€§çš„å€¼ã€‚å¦‚æœä½¿ç”¨ == è¿ç®—ç¬¦ï¼Œä¹Ÿå°†ä½¿ç”¨è¯¥å…³é”®å­—åŒ¹é… sysfs å±æ€§çš„å€¼ã€‚\nENV{key}\nå‘ŠçŸ¥ udev å°†å˜é‡å¯¼å‡ºåˆ°ç¯å¢ƒã€‚å¦‚æœä½¿ç”¨ == è¿ç®—ç¬¦ï¼Œä¹Ÿå°†ä½¿ç”¨è¯¥å…³é”®å­—åŒ¹é…ç¯å¢ƒå˜é‡ã€‚\nRUN\nå‘ŠçŸ¥ udev å‘ç¨‹åºåˆ—è¡¨æ·»åŠ è¦ä¸ºè¯¥è®¾å¤‡æ‰§è¡Œçš„ç¨‹åºã€‚è¯·è®°ä½ï¼Œå°†æ­¤ç¨‹åºé™åˆ¶äºå¾ˆçŸ­çš„ä»»åŠ¡ï¼Œä»¥å…å¦¨ç¢æ­¤è®¾å¤‡çš„åç»­äº‹ä»¶ã€‚\nLABEL\næ·»åŠ  GOTO å¯è·³è‡³çš„æ ‡ç­¾ã€‚\nGOTO\nå‘ŠçŸ¥ udev è·³è¿‡ä¸€äº›è§„åˆ™ï¼Œç»§ç»­æ‰§è¡Œå…·æœ‰æŒ‰ GOTO å…³é”®å­—å¼•ç”¨çš„æ ‡ç­¾çš„è§„åˆ™ã€‚\nIMPORT{type}\nå°†å˜é‡è£…è½½å…¥å¤–éƒ¨ç¨‹åºè¾“å‡ºä¹‹ç±»çš„äº‹ä»¶ç¯å¢ƒä¸­ã€‚udev å¯¼å…¥ä¸åŒç±»å‹çš„è‹¥å¹²å˜é‡ã€‚å¦‚æœæœªæŒ‡å®šä»»ä½•ç±»å‹ï¼Œudev å°†å°è¯•æ ¹æ®æ–‡ä»¶è®¸å¯æƒé™çš„å¯æ‰§è¡Œä½æ¥è‡ªè¡Œç¡®å®šç±»å‹ã€‚\nprogram å‘ŠçŸ¥ udev æ‰§è¡Œå¤–éƒ¨ç¨‹åºå¹¶å¯¼å…¥å…¶è¾“å‡ºã€‚ file å‘ŠçŸ¥ udev å¯¼å…¥æ–‡æœ¬æ–‡ä»¶ã€‚ parent å‘ŠçŸ¥ udev ä»çˆ¶è®¾å¤‡å¯¼å…¥å‚¨å­˜çš„å…³é”®å­—ã€‚ WAIT_FOR_SYSFS\nå‘ŠçŸ¥ udev ç­‰å¾…è¦ä¸ºæŸä¸ªè®¾å¤‡åˆ›å»ºçš„æŒ‡å®š sysfs æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼ŒWAIT_FOR_SYSFS=\u0026ldquo;ioerr_cnt\u0026rdquo; é€šçŸ¥ udev ç­‰å¾… ioerr_cnt æ–‡ä»¶åˆ›å»ºå®Œæˆã€‚\nOPTIONS\nOPTION å…³é”®å­—å¯èƒ½æœ‰è‹¥å¹²å€¼ï¼š\nlast_rule å‘ŠçŸ¥ udev å¿½ç•¥åé¢çš„æ‰€æœ‰è§„åˆ™ã€‚ ignore_device å‘ŠçŸ¥ udev å®Œå…¨å¿½ç•¥æ­¤äº‹ä»¶ã€‚ ignore_remove å‘ŠçŸ¥ udev å¿½ç•¥åé¢é’ˆå¯¹è®¾å¤‡çš„æ‰€æœ‰åˆ é™¤äº‹ä»¶ã€‚ all_partitions å‘ŠçŸ¥ udev ä¸ºå—è®¾å¤‡ä¸Šçš„æ‰€æœ‰å¯ç”¨åˆ†åŒºåˆ›å»ºè®¾å¤‡èŠ‚ç‚¹ã€‚ 3. udev ä½¿ç”¨çš„æ–‡ä»¶ # /sys/*\nLinux å†…æ ¸æä¾›çš„è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼Œç”¨äºå¯¼å‡ºæ‰€æœ‰å½“å‰å·²çŸ¥è®¾å¤‡ã€‚æ­¤ä¿¡æ¯ç”± udev ç”¨äºåœ¨ /dev ä¸­åˆ›å»ºè®¾å¤‡èŠ‚ç‚¹\n/dev/*\nåŠ¨æ€åˆ›å»ºçš„è®¾å¤‡èŠ‚ç‚¹å’Œå¼•å¯¼æ—¶ä» /lib/udev/devices/* å¤åˆ¶çš„é™æ€å†…å®¹\n/etc/udev/udev.conf\nä¸» udev é…ç½®æ–‡ä»¶ã€‚\n/etc/udev/rules.d/*\nudev äº‹ä»¶åŒ¹é…è§„åˆ™.\n/lib/udev/devices/*\né™æ€ /dev å†…å®¹ã€‚\n/lib/udev/*\nä» udev è§„åˆ™è°ƒç”¨çš„å¸®åŠ©ç¨‹åºã€‚\n","date":"2013 January 5","permalink":"/posts/2013/01/05/","section":"Posts","summary":"udev æ˜¯ linux 2.","title":"ä½¿ç”¨ udev ç®¡ç†è®¾å¤‡"},{"content":"å‡è®¾å­—ç¬¦è®¾å¤‡åä¸º led ï¼Œæºæ–‡ä»¶ä¸ºled.c ï¼Œä¸æ¶‰åŠå®é™…çš„ç¡¬ä»¶æ“ä½œã€‚åŸºæœ¬çš„é©±åŠ¨ä»£ç ç»“æ„å¦‚ä¸‹ï¼š\n1. åŒ…å«å¿…è¦çš„å¤´æ–‡ä»¶ ##include \u0026lt;linux/init.h\u0026gt; //module_init() å’Œ module_exit() #include \u0026lt;linux/sched.h\u0026gt; //åŒ…å«å¤§éƒ¨åˆ†å†…æ ¸APIçš„å®šä¹‰ #include \u0026lt;linux/module.h\u0026gt; //ä»€ä¹ˆæ¨¡å—ä¿¡æ¯çš„å®ï¼Œä¾‹å¦‚MODULE_AUTHOR(author) #include \u0026lt;linux/version.h\u0026gt; //åŒ…å«å†…æ ¸ç‰ˆæœ¬ä¿¡æ¯çš„å¤´æ–‡ä»¶ #include \u0026lt;linux/moduleparam.h\u0026gt; //åˆ›å»ºæ¨¡å—å‚æ•°çš„å® #include \u0026lt;linux/kernel.h\u0026gt; //printkç­‰å‡½æ•° #include \u0026lt;linux/types.h\u0026gt; //å†…æ ¸æ¨¡å—çš„å„ç§æ•°æ®ç±»å‹ï¼Œä¾‹å¦‚dev_t #include \u0026lt;linux/fs.h\u0026gt; //æ–‡ä»¶ç³»ç»Ÿ #include \u0026lt;linux/cdev.h\u0026gt; è¿˜å¯ä»¥æ ¹æ®éœ€è¦æ·»åŠ å…¶ä»–å¤´æ–‡ä»¶ã€‚\n2. å®šä¹‰ä¸€ä¸ªè®¾å¤‡ç§æœ‰æ•°æ®ç»“æ„ #é€šå¸¸ä¼šå°†è®¾å¤‡åï¼Œè®¾å¤‡å·ï¼Œcdevç­‰éƒ½æ”¾å…¥è¿™ä¸ªæ•°æ®ç»“æ„ã€‚\nstruct led_dev_t { char dev_name[10]; dev_t dev_num; struct cdev cdev; } struct led_dev_t *led_dev; 3. å®ç° file_operations ç»“æ„ #file_operations ç»“æ„é¦–å…ˆè¦å®ç° .owner ç„¶åå†æ ¹æ®éœ€è¦å®ç°ç›¸å…³å‡½æ•°ã€‚\nstruct file_operations led_fops = { .owner = THIS_MODULE, .open = led_open, .release = led_close, } 4. å®ç°æ¨¡å—åˆå§‹åŒ–å‡½æ•° #æ¨¡å—åŠ è½½å‡½æ•°åº”è¯¥ä¾æ¬¡å®Œæˆå¦‚ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š\nä¸ºè®¾å¤‡ç§æœ‰æ•°æ®ç»“æ„åˆ†é…å†…å­˜ï¼Œç„¶ååˆå§‹åŒ–ã€‚ ç”³è¯·è®¾å¤‡å·ã€‚ æ³¨å†Œå­—ç¬¦è®¾å¤‡ã€‚å³åˆå§‹åŒ– cdev ï¼Œå°† file_operations ç»“æ„å’Œè®¾å¤‡å·ä¸ cdev ç»‘å®šã€‚ æœ€åç”¨ module_init() å®å‘å†…æ ¸è¯´æ˜åˆå§‹åŒ–å‡½æ•°çš„ä½ç½®ã€‚\n5. å®ç°æ¨¡å—å¸è½½å‡½æ•° #æ¨¡å—å¸è½½å‡½æ•°çš„å†…å®¹åŸºæœ¬æ˜¯åŠ è½½å‡½æ•°çš„é€†è¿‡ç¨‹ï¼š\né‡Šæ”¾è®¾å¤‡å·ã€‚ åˆ é™¤ cdev ã€‚ é‡Šæ”¾ç”³è¯·çš„å†…å­˜ã€‚ æœ€åç”¨ module_exit() å®å‘å†…æ ¸è¯´æ˜å¸è½½å‡½æ•°çš„ä½ç½®ã€‚\n6. å®ç°æ–‡ä»¶æ“ä½œå‡½æ•° #open å’Œ close å‡½æ•°é€šå¸¸æ˜¯å¿…é¡»çš„ã€‚\nopen å‡½æ•°çš„åŸå‹æ˜¯\nint (*open)(struct inode *,struct file *) inode ç»“æ„çš„æˆå‘˜ i_cdev æŒ‡å‘çš„å°±æ˜¯å…ˆå‰è®¾ç½®çš„ cdev ã€‚è¦ç¡®ä¿è®¾å¤‡æˆåŠŸæ‰“å¼€ï¼Œåº”è¯¥é€šè¿‡ inode-\u0026gt;i_cdev æ‰¾åˆ°åŒ…å« cdev çš„è®¾å¤‡ç§æœ‰æ•°æ®ç»“æ„çš„å®ä¾‹ã€‚å†…æ ¸æä¾› container_of å®æ¥å®Œæˆè¿™é¡¹å·¥ä½œï¼š\ncontainer_of(poiner,container_type,container_field); ç”¨æ³•å¦‚ä¸‹ï¼š\nstruct led_dev_t *dev; dev = container_of(inode-\u0026gt;i_cdev,struct led_dev_t,cdev); DEBUG(\u0026quot;open %s\\n\u0026quot;,dev-\u0026gt;dev_name); filp-\u0026gt;private_data = dev; close å‡½æ•°çš„åŸå‹æ˜¯\nint (*release)(struct inode *,struct file *) 7. æ¨¡å—å‚æ•° #æ¨¡å—çš„å‚æ•°é€šè¿‡ module_param(name,type,flag) å£°æ˜ï¼Œå¹¶ä¸”åº”è¯¥æœ‰ä¸€ä¸ªé»˜è®¤å€¼ï¼Œä¾‹å¦‚ï¼š\nstatic int addr=0x300; module_param(addr,int,S_IRUGO|S_IWUSR); å¦‚æœå‚æ•°ç±»å‹ä¸ºå­—ç¬¦ä¸²ï¼Œtype åº”è¯¥è®¾ä¸º charp ã€‚\nflag æ˜¯è®¿é—®è®¸å¯å€¼ï¼Œå¯ç”¨çš„å€¼å®šä¹‰åœ¨ \u0026lt;linux/stat.h\u0026gt; ä¸­ã€‚S_IRUGO è¡¨ç¤ºä»»ä½•äººéƒ½å¯ä»¥è¯»å–è¯¥å‚æ•°ï¼Œä½†ä¸èƒ½ä¿®æ”¹ï¼›S_IWUSR è¡¨ç¤º root ç”¨æˆ·å¯ä»¥ä¿®æ”¹è¯¥å‚æ•°ã€‚\n8. å£°æ˜è®¸å¯è¯ #MODULE_LICENSE(\u0026quot;GPL\u0026quot;); 9. å…³äºè°ƒè¯• #æœ€å¸¸ç”¨çš„è°ƒè¯•æ‰‹æ®µæ˜¯å†…æ ¸æ‰“å°å‡½æ•° printk ï¼Œä½¿ç”¨æ–¹æ³•ä¸æ ‡å‡†åº“å‡½æ•° printf ç±»ä¼¼ã€‚printk æ‰“å°çš„ä¿¡æ¯é€šå¸¸ç”¨ dmesg å‘½ä»¤æŸ¥çœ‹ã€‚\nä¸ºäº†æ–¹ä¾¿åœ¨æœ€ç»ˆå‘å¸ƒæ—¶å»æ‰æ‰“å°çš„è°ƒè¯•ä¿¡æ¯ï¼Œé€šå¸¸å°† printk å‡½æ•°å°è£…ä¸ºä¸€ä¸ªå® ï¼š\n#define PRINT_DEBUG #ifdef PRINT_DEBUG #define DEBUG(fmt,args...) printk(\u0026quot;LED:\u0026quot;fmt,##args) #else #define DEBUG(fmt,args...) #endif å‘å¸ƒæ—¶åªéœ€å°†ç¬¬ä¸€è¡Œæ³¨é‡Šæ‰ï¼Œå°±å¯ä»¥å»æ‰æ‰“å°ä¿¡æ¯ã€‚\n10. Makefile #KERNELDIR=/lib/modules/$(shell uname -r)/build PWD=$(shell pwd) obj-m := led.o default: $(MAKE) -C $(KERNELDIR) M=$(PWD) modules clean: $(MAKE) -C $(KERNELDIR) M=$(PWD) clean å¦‚æœæ¨¡å—åŒ…å«å¤šä¸ªæºæ–‡ä»¶ï¼Œæ¯”å¦‚ file1.c å’Œ file2.c ï¼ŒMakefile åº”è¯¥å¦‚ä¸‹ç¼–å†™ï¼š\nobj-m := modulename.o modulename-objs := file1.o file2.o modulename æ˜¯æ¨¡å—çš„åç§°ï¼Œæœ€å¥½ä¸è¦ä¸æºæ–‡ä»¶åŒåã€‚\n11. åŠ è½½é©±åŠ¨ #ç”¨ insmod å‘½ä»¤åŠ è½½é©±åŠ¨ï¼ŒåŠ è½½æ—¶å¯ä»¥æŒ‡å®šå‚æ•°ï¼Œä¾‹å¦‚ï¼š\ninsmod led.ko addr=0x300 åŠ è½½æˆåŠŸåï¼Œ/sys/modules/ ä¸‹ä¼šå‡ºç°ç›¸åº”çš„ç›®å½•ï¼Œ/proc/modulesæ–‡ä»¶ï¼ˆlsmod å³æŸ¥çœ‹çš„è¯¥æ–‡ä»¶ï¼‰ä¸­ä¼šå‡ºç°æ¨¡å—çš„ä¿¡æ¯ï¼Œ /proc/devices æ–‡ä»¶ä¸­å¯ä»¥çœ‹åˆ°è®¾å¤‡åå’Œä¸»è®¾å¤‡å·ï¼š\ncat /proc/devices | grep led å¯ä»¥æ ¹æ®ä¸»è®¾å¤‡å·åˆ›å»ºè®¾å¤‡èŠ‚ç‚¹ã€‚\n12. é™„å½•ï¼šå®Œæ•´ä»£ç  ##include \u0026lt;linux/init.h\u0026gt; #include \u0026lt;linux/module.h\u0026gt; #include \u0026lt;linux/slab.h\u0026gt; #include \u0026lt;linux/mm.h\u0026gt; #include \u0026lt;linux/fs.h\u0026gt; #include \u0026lt;linux/types.h\u0026gt; #include \u0026lt;linux/cdev.h\u0026gt; #include \u0026lt;linux/version.h\u0026gt; #define PRINT_DEBUG #ifdef PRINT_DEBUG #define DEBUG(fmt,args...) printk(\u0026quot;LED : \u0026quot;fmt,##args) #else #define DEBUG(fmt,args...) #endif struct led_dev_t { const char *dev_name; dev_t dev_num; struct cdev cdev; }; struct led_dev_t *led_dev; int led_open(struct inode *inode,struct file *filp) { struct led_dev_t *dev; dev = container_of(inode-\u0026gt;i_cdev,struct led_dev_t,cdev); DEBUG(\u0026quot;open %s\\n\u0026quot;,dev-\u0026gt;dev_name); filp-\u0026gt;private_data = dev; return 0; } int led_close(struct inode *inode,struct file *filp) { DEBUG(\u0026quot;close %s\\n\u0026quot;,((struct led_dev_t *)filp-\u0026gt;private_data)-\u0026gt;dev_name); return 0; } struct file_operations led_fops = { .owner = THIS_MODULE, .open = led_open, .release = led_close, }; static int __init led_init(void) { int ret = 0; unsigned int dev_major = 0; unsigned int dev_minor = 0; //åˆå§‹åŒ–è®¾å¤‡ç§æœ‰æ•°æ®ç»“æ„ led_dev = kmalloc(sizeof(struct led_dev_t),GFP_KERNEL); if(led_dev \u0026lt;= 0) { DEBUG(\u0026quot;led init kmalloc failed\\n\u0026quot;); return -1; } memset(led_dev,0,sizeof(struct led_dev_t)); led_dev-\u0026gt;dev_name = \u0026quot;led\u0026quot;; //å®šä¹‰è®¾å¤‡å //ç”³è¯·è®¾å¤‡å· if(dev_major) { led_dev-\u0026gt;dev_num = MKDEV(dev_major,dev_minor); ret = register_chrdev_region(led_dev-\u0026gt;dev_num,1,led_dev-\u0026gt;dev_name); } else { ret = alloc_chrdev_region(\u0026amp;(led_dev-\u0026gt;dev_num),dev_minor,1,led_dev-\u0026gt;\tdev_name); dev_major = MAJOR(led_dev-\u0026gt;dev_num); } if(ret) { DEBUG(\u0026quot;register chrdev region failed\\n\u0026quot;); return ret; } else { DEBUG(\u0026quot;Major: %d, Minor: %d\\n\u0026quot;,dev_major,dev_minor); } //åˆå§‹åŒ– cdev cdev_init(\u0026amp;(led_dev-\u0026gt;cdev),\u0026amp;led_fops); led_dev-\u0026gt;cdev.owner = THIS_MODULE; ret = cdev_add(\u0026amp;(led_dev-\u0026gt;cdev),led_dev-\u0026gt;dev_num,1); if(ret\u0026lt;0) { DEBUG(\u0026quot;cdev add failed\\n\u0026quot;); return ret; } DEBUG(\u0026quot;led init\\n\u0026quot;); return 0; } static void __exit led_exit(void) { DEBUG(\u0026quot;device is %s\\n\u0026quot;,led_dev-\u0026gt;dev_name); unregister_chrdev_region(led_dev-\u0026gt;dev_num,1); cdev_del(\u0026amp;led_dev-\u0026gt;cdev); kfree(led_dev); DEBUG(\u0026quot;led exit\\n\u0026quot;); } module_init(led_init); module_exit(led_exit); MODULE_AUTHOR(\u0026quot;Li Shaocheng\u0026quot;); MODULE_LICENSE(\u0026quot;GPL\u0026quot;); ","date":"2013 January 4","permalink":"/posts/2013/01/04/","section":"Posts","summary":"å‡è®¾å­—ç¬¦è®¾å¤‡åä¸º led ï¼Œæºæ–‡ä»¶ä¸ºled.","title":"Linux å­—ç¬¦é©±åŠ¨çš„åŸºæœ¬ç»“æ„"},{"content":"ä¸€ä¸ªæœ€ç®€å•çš„å†…æ ¸æ¨¡å— #ç¼–å†™ä¸€ä¸ªæœ€ç®€å•çš„å†…æ ¸æ¨¡å— hellomodï¼Œæºç  hellomod.c å¦‚ä¸‹ï¼š\n#include \u0026lt;linux/init.h\u0026gt; #include \u0026lt;linux/module.h\u0026gt; static int __init hellomod_init(void) { printk(\u0026quot;hellomod init\\n\u0026quot;); return 0; } static void __exit hellomod_exit(void) { printk(\u0026quot;hellomod exit\\n\u0026quot;); } module_init(hellomod_init); module_exit(hellomod_exit); MODULE_LICENSE(\u0026quot;GPL\u0026quot;); Makefile æ–‡ä»¶å¦‚ä¸‹ï¼š\nKERDIR=/lib/modules/$(shell uname -r)/build PWD=$(shell pwd) obj-m:=hellomod.o default: make -C ${KERDIR} M=${PWD} modules clean: make -C ${KERDIR} M=${PWD} clean ç›´æ¥è¿è¡Œ make å³å¯å°†å…¶ç¼–è¯‘ä¸º hellomod.ko ã€‚ä¸‹é¢ä»¥è¯¥æ¨¡å—ä¸ºä¾‹ä»‹ç»æ·»åŠ åˆ°å†…æ ¸çš„æ­¥éª¤ã€‚\næ·»åŠ åˆ°å†…æ ¸ #å°†ä¸€ä¸ªæ¨¡å—æºç æ·»åŠ åˆ°å†…æ ¸éœ€è¦å¦‚ä¸‹ä¸‰ä¸ªæ­¥éª¤ï¼š\n1.å°†æºç æ–‡ä»¶å¤åˆ¶çš„ç›¸åº”çš„ç›®å½•ä¸­ #æˆ‘ä»¬å°† hellomod.c å¤åˆ¶åˆ°å†…æ ¸æºç çš„ driver/char/ ç›®å½•ä¸‹ã€‚\n2.ä¿®æ”¹ Makefile æ–‡ä»¶ #åœ¨ driver/char/Makefile æ–‡ä»¶ä¸­æ·»åŠ æ–°çš„æ¨¡å—ï¼š\nobj-$(CONFIG_HELLOMOD) += hellomod.o å…¶ä¸­ CONFIG_HELLOMOD å˜é‡æ˜¯åœ¨é…ç½®å†…æ ¸æ˜¯ç¡®å®šçš„ï¼Œé€šå¸¸å¯ä»¥å–ä¸‰ä¸ªå€¼ï¼šy ã€n ã€m ã€‚å…¶ä¸­ CONFIG_ æ˜¯å›ºå®šçš„ï¼Œ HELLOMOD æ˜¯è‡ªå®šä¹‰çš„ï¼Œä½†å¿…é¡»ä¸ Kconfig æ–‡ä»¶ä¸­çš„è®¾ç½®ä¸€è‡´ã€‚\n3.ä¿®æ”¹ Kconfig æ–‡ä»¶ #drivers/char/Kconfig æ–‡ä»¶çš„åŸºæœ¬ç»“æ„å¦‚ä¸‹ï¼š\nmenu \u0026quot;Characters devices\u0026quot; config ... ... source \u0026quot;drivers/char/ipmi/Kconfig\u0026quot; ... endmenu menu å’Œ endmenu ä¹‹é—´å®šä¹‰äº†ä¸€ä¸ª Characters devices èœå•ã€‚config å­—æ®µå®šä¹‰äº†ä¸€ä¸ªæ¨¡å—é€‰é¡¹ï¼Œsource å¯¼å…¥äº†ä¸€ä¸ªå¤–éƒ¨çš„ Kconfig ã€‚\nåœ¨ menu å’Œ endmenu ä¹‹é—´æ·»åŠ ï¼š\nconfig HELLOMOD tristate \u0026quot;hellomod\u0026quot; default m help just a module HELLOMOD ä¸ Makefile ä¸­å®šä¹‰çš„å˜é‡æ˜¯ä¸€è‡´çš„ã€‚tristate è®¾ç½®çš„æ˜¯æ˜¾ç¤ºåœ¨é…ç½®ç•Œé¢çš„æ¡ç›®ï¼Œdefault è®¾ç½®çš„æ˜¯è¯¥é…ç½®çš„é»˜è®¤å€¼ã€‚help æ˜¾ç¤ºçš„æ˜¯å¸®åŠ©å†…å®¹ã€‚\nå¦‚ä¸Šä¿®æ”¹ä¹‹åï¼Œè¿è¡Œ make menuconfig ï¼Œå°±å¯ä»¥åœ¨ Device Drivers -\u0026gt; Character devices ä¸­çœ‹åˆ° \u0026lt;M\u0026gt;hellomod ã€‚é€€å‡ºä¿å­˜åå¯ä»¥åœ¨ .config æ–‡ä»¶ä¸­çœ‹åˆ° CONFIG_HELLOMOD=m ã€‚\næ–°å¢ä¸€ä¸ªæ¨¡å—ç›®å½• #å¦‚æœè¦ä¸º hellomod æ–°å»ºä¸€ä¸ªå•ç‹¬çš„ç›®å½•ï¼Œå¯ä»¥æŒ‰å¦‚ä¸‹æ­¥éª¤å®Œæˆï¼š\n1.æ–°å»ºç›®å½•å¹¶æ·»åŠ æºæ–‡ä»¶ #åœ¨ drivers/char/ ç›®å½•ä¸‹æ–°å»º hellomod ç›®å½•ï¼Œå¹¶å°† hellomod.c å¤åˆ¶åˆ°è¯¥ç›®å½•ä¸‹ã€‚\n2.æ·»åŠ  Makefile #åœ¨ drivers/char/hellomod/ ç›®å½•ä¸‹æ–°å»º Makefile æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\nobj-$(CONFIG_HELLOMOD) += hellomod.o 3.æ·»åŠ  Kconfig #åœ¨ drivers/char/hellomod/ ç›®å½•ä¸‹æ–°å»º Kconfig æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\nmenu \u0026quot;hello module\u0026quot; config HELLOMOD tristate \u0026quot;hellomod\u0026quot; default m help just a module endmenu ç„¶ååœ¨ä¸Šå±‚ç›®å½• drivers/chars çš„ Kconfig æ–‡ä»¶ä¸­æ·»åŠ ï¼š\nsource drivers/char/hellomod/Kconfig ","date":"2012 December 18","permalink":"/posts/2012/12/18/","section":"Posts","summary":"ä¸€ä¸ªæœ€ç®€å•çš„å†…æ ¸æ¨¡å— #ç¼–å†™ä¸€ä¸ªæœ€ç®€å•çš„å†…æ ¸æ¨¡å— hellomodï¼Œæºç  hellomod.","title":"åœ¨ Linux å†…æ ¸ä¸­æ–°å¢æ¨¡å—ä»£ç "},{"content":"å®ç°æ­¥éª¤ #å‡è®¾è®¾å¤‡é©±åŠ¨åä¸º module ï¼Œè®¾å¤‡çš„ç§æœ‰æ•°æ®ç»“æ„ä¸º module_dev_t ï¼Œå®ç°å¼‚æ­¥é€šçŸ¥çš„æ­¥éª¤å¦‚ä¸‹ ï¼š\n1.å®šä¹‰ä¸€ä¸ª struct fasync_struct *ç±»å‹çš„æŒ‡é’ˆï¼Œé€šå¸¸æ˜¯åœ¨è®¾å¤‡çš„ç§æœ‰æ•°æ®ç»“æ„ä¸­å®šä¹‰ã€‚\nstruct module_dev_t module_dev { ... strcut fasync_struct * fasync_queue; } 2.å®ç° fasync æ–¹æ³•,åœ¨ fasync æ–¹æ³•ä¸­è°ƒç”¨ fasync_helper å‡½æ•°ã€‚\nstatic int module_fasync(int fd,struct file *filp,int mode) { struct module_dev_t *dev = filp-\u0026gt;private_data; return fasync_helper(fd,filp,mode,\u0026amp;dev-\u0026gt;fasync_queue); } struct file_operations fops = { ... .fasync = module_fasync, } 3.åœ¨æ•°æ®åˆ°è¾¾æ—¶è°ƒç”¨ kill_fasync å‡½æ•°äº§ç”Ÿä¿¡å·ã€‚\nif(dev-\u0026gt;fasync_queue) kill_fasync(\u0026amp;dev-\u0026gt;fasync_queue,SIGIO,POLL_IN); 4.åœ¨å…³é—­è®¾å¤‡æ˜¯è°ƒç”¨ fasync æ–¹æ³•ã€‚\nmodule_fasync(-1,filp,0); åº”ç”¨ç¨‹åºçš„ç¼–ç¨‹æ–¹æ³• #1.ä¸ºä¿¡å·æ³¨å†Œä¸€ä¸ªå¤„ç†å‡½æ•°\nsignal(SIGIO,sig_handler); å½“è¿›ç¨‹æ¥æ”¶åˆ° SIGIO ä¿¡å·æ˜¯ä¼šæ‰§è¡Œ sig_handler å‡½æ•°ï¼š\nvoid (*sig_handler)(int sig) 2.è®¾ç½®å°†è¦æ¥æ”¶ SIGIO æˆ– SIGURG ä¿¡å·çš„è¿›ç¨‹ id ã€‚\nfcntl(fd,F_SETOWN,getpid()); è¿™æ ·ä¼šå°†è¿›ç¨‹çš„ ID ä¿å­˜åˆ° filp-\u0026gt;f_woner ä¸­ï¼Œå†…æ ¸å°±çŸ¥é“å½“ä¿¡å·åˆ°è¾¾æ—¶åº”è¯¥é€šçŸ¥å“ªä¸ªè¿›ç¨‹ã€‚\n3.ä¸ºæ–‡ä»¶è®¾ç½® FASYNC æ ‡å¿—ã€‚\noflas = fcntl(fd,F_GETFL); fcntl(fd,F_SETFL,oflags | FASYNC); è®¾ç½® FASYNC æ—¶å°±ä¼šè°ƒç”¨é©±åŠ¨çš„ fasync æ–¹æ³•ã€‚åœ¨æ–‡ä»¶æ‰“å¼€æ—¶ï¼ŒFASYNC æ ‡å¿—æ˜¯é»˜è®¤æ¸…é™¤çš„ã€‚\n","date":"2012 November 20","permalink":"/posts/2012/11/20/","section":"Posts","summary":"å®ç°æ­¥éª¤ #å‡è®¾è®¾å¤‡é©±åŠ¨åä¸º module ï¼Œè®¾å¤‡çš„ç§æœ‰æ•°æ®ç»“æ„ä¸º module_dev_t ï¼Œå®ç°å¼‚æ­¥é€šçŸ¥çš„æ­¥éª¤å¦‚ä¸‹ ï¼š","title":"Linux é©±åŠ¨çš„å¼‚æ­¥é€šçŸ¥"},{"content":"æ•°æ®æ–‡ä»¶ datefile\nSteve Blenheim:238-923-7366:95 Latham Lane, Easton, PA 83755:11/12/56:20300 Betty Boop:245-836-8357:635 Cutesy Lane, Hollywood, CA 91464:6/23/23:14500 Igor Chevsky:385-375-8395:3567 Populus Place, Caldwell, NJ 23875:6/18/68:23400 Norma Corder:397-857-2735:74 Pine Street, Dearborn, MI 23874:3/28/45:245700 Jennifer Cowan:548-834-2348:583 Laurel Ave., Kingsville, TX 83745:10/1/35:58900 Jon DeLoach:408-253-3122:123 Park St., San Jose, CA 04086:7/25/53:85100 Karen Evich:284-758-2857:23 Edgecliff Place, Lincoln, NB 92743:7/25/53:85100 Karen Evich:284-758-2867:23 Edgecliff Place, Lincoln, NB 92743:11/3/35:58200 Karen Evich:284-758-2867:23 Edgecliff Place, Lincoln, NB 92743:11/3/35:58200 Fred Fardbarkle:674-843-1385:20 Parak Lane, Duluth, MN 23850:4/12/23:780900 Fred Fardbarkle:674-843-1385:20 Parak Lane, Duluth, MN 23850:4/12/23:780900 Lori Gortz:327-832-5728:3465 Mirlo Street, Peabody, MA 34756:10/2/65:35200 Paco Gutierrez:835-365-1284:454 Easy Street, Decatur, IL 75732:2/28/53:123500 Ephram Hardy:293-259-5395:235 CarltonLane, Joliet, IL 73858:8/12/20:56700 James Ikeda:834-938-8376:23445 Aster Ave., Allentown, NJ 83745:12/1/38:45000 Barbara Kertz:385-573-8326:832 Ponce Drive, Gary, IN 83756:12/1/46:268500 Lesley Kirstin:408-456-1234:4 Harvard Square, Boston, MA 02133:4/22/62:52600 William Kopf:846-836-2837:6937 Ware Road, Milton, PA 93756:9/21/46:43500 Sir Lancelot:837-835-8257:474 Camelot Boulevard, Bath, WY 28356:5/13/69:24500 Jesse Neal:408-233-8971:45 Rose Terrace, San Francisco, CA 92303:2/3/36:25000 Zippy Pinhead:834-823-8319:2356 Bizarro Ave., Farmount, IL 84357:1/1/67:89500 Arthur Putie:923-835-8745:23 Wimp Lane, Kensington, DL 38758:8/31/69:126000 Popeye Sailor:156-454-3322:945 Bluto Street, Anywhere, USA 29358:3/19/35:22350 Jose Santiago:385-898-8357:38 Fife Way, Abilene, TX 39673:1/5/58:95600 Tommy Savage:408-724-0140:1222 Oxbow Court, Sunnyvale, CA 94087:5/19/66:34200 Yukio Takeshida:387-827-1095:13 Uno Lane, Ashville, NC 23556:7/1/29:57000 Vinh Tranh:438-910-7449:8235 Maple Street, Wilmington, VM 29085:9/23/63:68900 æŠŠ Jon çš„åå­—æ”¹ä¸º Jonathan\nsed -e 's/^Jon /Jonathan /' datebook åˆ é™¤å‰ 3 è¡Œ\nsed -e '1,3d' datebook æ‰“å°ç¬¬ 5~10 è¡Œ\nsed -n -e '5,10p' datebook åˆ é™¤å«æœ‰ Lane çš„æ‰€æœ‰è¡Œ\nsed -e '/Lane/d' datebook åˆ é™¤ä¸å«æœ‰ Lane çš„æ‰€æœ‰è¡Œ\nsed -e '/Lane/!d' datebook æ‰“å°æ‰€æœ‰ç”Ÿæ—¥åœ¨åä¸€æœˆæˆ–åäºŒæœˆçš„è¡Œ\nsed -n -e '/:1[12]\\//p' datebook åœ¨ä»¥ James å¼€å¤´çš„å„è¡Œæœ«å°¾åŠ ä¸Š 3 é¢—æ˜Ÿå·\nsed -e '/^James/s/$/***\u0026amp;/' datebook å°†æ‰€æœ‰åŒ…å« Jose çš„è¡Œéƒ½æ›¿æ¢ä¸º JOSE HAS RETIRED\nsed -e '/Jose/c\\JOSE HAS RETIRED' datebook æŠŠ Popeye çš„ç”Ÿæ—¥æ”¹ä¸º 11/14/46 ï¼Œå‡å®šæ‚¨ä¸çŸ¥é“ Popeye çš„ç”Ÿæ—¥ï¼Œè®¾æ³•ç”¨æ­£åˆ™è¡¨è¾¾å¼æŸ¥æ‰¾å‡ºæ¥\nsed -n -e '/^Popeye /s/:[0-9]*\\/[0-9]*\\/[0-9]*/:11\\/14\\/46:/p' datebook åˆ é™¤æ‰€æœ‰ç©ºè¡Œ\nsed -e '/^$/d' datebook å†™ä¸€ä¸ªèƒ½å®Œæˆä¸‹åˆ—ä»»åŠ¡çš„ sed è„šæœ¬\na) åœ¨ç¬¬ä¸€è¡Œä¸Šæ–¹æ’å…¥æ ‡é¢˜ PERSONNEL FILE\nb) åˆ é™¤ä»¥ 500 ç»“å°¾çš„å·¥èµ„é¡¹\nc) æŠŠåå’Œå§“çš„ä½ç½®é¢ å€’åï¼Œæ‰“å°æ–‡ä»¶å†…å®¹\nd) åœ¨æ–‡ä»¶æœ«å°¾åŠ ä¸Š THE END\n1i\\PERSONNEL FILE /500$/d s/\\([a-zA-Z]*\\) \\([a-zA-Z]*\\)/\\2 \\1/ $a\\THE END ","date":"2012 November 4","permalink":"/posts/2012/11/04/","section":"Posts","summary":"æ•°æ®æ–‡ä»¶ datefile","title":"ã€ŠUnix Shell èŒƒä¾‹ç²¾è§£ã€‹ç¬¬äº”ç«  sed ä¹ é¢˜"},{"content":"æ•°æ®æ–‡ä»¶ï¼š\nSteve Blenheim:238-923-7366:95 Latham Lane, Easton, PA 83755:11/12/56:20300 Betty Boop:245-836-8357:635 Cutesy Lane, Hollywood, CA 91464:6/23/23:14500 Igor Chevsky:385-375-8395:3567 Populus Place, Caldwell, NJ 23875:6/18/68:23400 Norma Corder:397-857-2735:74 Pine Street, Dearborn, MI 23874:3/28/45:245700 Jennifer Cowan:548-834-2348:583 Laurel Ave., Kingsville, TX 83745:10/1/35:58900 Jon DeLoach:408-253-3122:123 Park St., San Jose, CA 04086:7/25/53:85100 Karen Evich:284-758-2857:23 Edgecliff Place, Lincoln, NB 92743:7/25/53:85100 Karen Evich:284-758-2867:23 Edgecliff Place, Lincoln, NB 92743:11/3/35:58200 Karen Evich:284-758-2867:23 Edgecliff Place, Lincoln, NB 92743:11/3/35:58200 Fred Fardbarkle:674-843-1385:20 Parak Lane, Duluth, MN 23850:4/12/23:780900 Fred Fardbarkle:674-843-1385:20 Parak Lane, Duluth, MN 23850:4/12/23:780900 Lori Gortz:327-832-5728:3465 Mirlo Street, Peabody, MA 34756:10/2/65:35200 Paco Gutierrez:835-365-1284:454 Easy Street, Decatur, IL 75732:2/28/53:123500 Ephram Hardy:293-259-5395:235 CarltonLane, Joliet, IL 73858:8/12/20:56700 James Ikeda:834-938-8376:23445 Aster Ave., Allentown, NJ 83745:12/1/38:45000 Barbara Kertz:385-573-8326:832 Ponce Drive, Gary, IN 83756:12/1/46:268500 Lesley Kirstin:408-456-1234:4 Harvard Square, Boston, MA 02133:4/22/62:52600 William Kopf:846-836-2837:6937 Ware Road, Milton, PA 93756:9/21/46:43500 Sir Lancelot:837-835-8257:474 Camelot Boulevard, Bath, WY 28356:5/13/69:24500 Jesse Neal:408-233-8971:45 Rose Terrace, San Francisco, CA 92303:2/3/36:25000 Zippy Pinhead:834-823-8319:2356 Bizarro Ave., Farmount, IL 84357:1/1/67:89500 Arthur Putie:923-835-8745:23 Wimp Lane, Kensington, DL 38758:8/31/69:126000 Popeye Sailor:156-454-3322:945 Bluto Street, Anywhere, USA 29358:3/19/35:22350 Jose Santiago:385-898-8357:38 Fife Way, Abilene, TX 39673:1/5/58:95600 Tommy Savage:408-724-0140:1222 Oxbow Court, Sunnyvale, CA 94087:5/19/66:34200 Yukio Takeshida:387-827-1095:13 Uno Lane, Ashville, NC 23556:7/1/29:57000 Vinh Tranh:438-910-7449:8235 Maple Street, Wilmington, VM 29085:9/23/63:68900 æ‰“å°æ‰€æœ‰åŒ…å«å­—ç¬¦ä¸² San çš„è¡Œ\ngrep 'San' databook æ‰“å°æ‰€æœ‰ä»¥ J å¼€å¤´çš„è¡Œ\ngrep '^J' databook æ‰“å°æ‰€æœ‰ä»¥ 700 ç»“å°¾çš„è¡Œ\ngrep '700$' databook æ‰“å°æ‰€æœ‰ä¸åŒ…å« 834 çš„è¡Œ\ngrep -v '834' databook æ‰“å°æ‰€æœ‰ç”Ÿæ—¥åœ¨ December çš„è¡Œ\ngrep ':12/' databook æ‰“å°æ‰€æœ‰ç”µè¯å·ç åŒºå·ä¸º 408 çš„è¡Œ\ngrep ':408-' databook æ‰“å°æ‰€æœ‰åŒ…å«ä¸€ä¸ªå¤§å†™å­—æ¯ï¼Œåè·Ÿå››ä¸ªå°å†™å­—æ¯ï¼Œä¸€ä¸ªé€—å·ï¼Œä¸€ä¸ªç©ºæ ¼å’Œä¸€ä¸ªå¤§å†™å­—æ¯çš„è¡Œ\ngrep '[[:upper:]][[:lower:]]\\{4\\}, [[:upper:]]' databook æ‰“å°æ‰€æœ‰æœ€åä¸€ä¸ªåå­—ä»¥ K æˆ– k å¼€å§‹çš„è¡Œ\ngrep '^[A-Za-z]* [Kk]' databook æ‰“å°æ‰€æœ‰è–ªæ°´ä¸º 6 ä½æ•°çš„è¡Œï¼Œå‰å¯¼æ˜¯ä¸€ä¸ªè¡Œå·\ngrep -n ':[0-9]\\{6\\}$' databook æ‰“å°åŒ…å« Lincoln æˆ– lincoln ï¼ˆæ³¨æ„ï¼Œgrep ä¸åŒºåˆ†å¤§å°å†™ï¼‰çš„è¡Œ\ngrep '[Ll]incoln' databook ","date":"2012 November 3","permalink":"/posts/2012/11/03/","section":"Posts","summary":"æ•°æ®æ–‡ä»¶ï¼š","title":"ã€ŠUnix Shell èŒƒä¾‹ç²¾è§£ã€‹ç¬¬å››ç«  grep ä¹ é¢˜"},{"content":"ä¸€äº›é€‰é¡¹ # -e script ï¼šæ·»åŠ ä¸€å¥—å‘½ä»¤ï¼Œå¯é€šè¿‡è¯¥é€‰é¡¹æ·»åŠ å¤šä¸ªå¤„ç†å‘½ä»¤ -n ï¼šåªæ‰“å°é€šè¿‡ p å‘½ä»¤åŒ¹é…åˆ°çš„è¡Œ -i ï¼šå°†ä¿®æ”¹ç»“æœå†™å…¥æ–‡ä»¶ -f scriptfile ï¼šä½¿ç”¨è„šæœ¬æ–‡ä»¶ å¸¸ç”¨å‘½ä»¤ # ! ï¼šå¯¹æ‰€é€‰è¡Œä»¥ä¸ºçš„è¡Œè¿›è¡Œæ“ä½œ p ï¼šæ‰“å° d ï¼šåˆ é™¤ s ï¼šæ›¿æ¢ g ï¼šè¡Œå†…å…¨å±€æ›¿æ¢ w ï¼šå°†è¡Œå†™å…¥æ–‡ä»¶ c\\ ï¼šç”¨å‘½ä»¤åé¢çš„æ–‡æœ¬æ›¿æ¢å½“å‰çš„è¡Œ a\\ ï¼šåœ¨å½“å‰è¡Œåæ·»åŠ æ–‡æœ¬ GNUå¯¹æ­£åˆ™è¡¨è¾¾å¼çš„æ‰©å±• # \\n : äº§ç”Ÿæˆ–åŒ¹é…ä¸€ä¸ªæ¢è¡Œç¬¦ï¼ˆASCII 10ï¼‰ \\r : äº§ç”Ÿæˆ–åŒ¹é…ä¸€ä¸ªå›è½¦ç¬¦ï¼ˆASCII 13ï¼‰ \\t : äº§ç”Ÿæˆ–åŒ¹é…ä¸€ä¸ªåˆ¶è¡¨ç¬¦ï¼ˆASCII 9ï¼‰ \\v : äº§ç”Ÿæˆ–åŒ¹é…ä¸€ä¸ªå‚ç›´åˆ¶è¡¨ç¬¦ï¼ˆASCII 11ï¼‰ æŒ‡å®šåœ°å€èŒƒå›´ #æ‰“å°ç¬¬ä¸€è¡Œåˆ°ç¬¬åè¡Œï¼š\nsed -n -e '1,10p' filename æ‰“å°æœ€åä¸€è¡Œï¼š\nsed -n -e '$p' filename ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…è¡Œï¼Œ\tæ‰“å°ä»ä»¥ root å¼€å¤´çš„è¡Œåˆ°ä»¥ mail å¼€å¤´çš„è¡Œï¼š\nsed -n -e '/^root/,/^mail/p' filename å¤§å°å†™è½¬æ¢ #\\U \\u ï¼šè½¬æ¢ä¸ºå¤§å†™\n\\L \\l ï¼šè½¬æ¢ä¸ºå°å†™\nsed -e 's/[a-z]/\\U\u0026amp;/g' filename sed -e 's/[A-Z]/\\L\u0026amp;/g' filename \u0026amp; è¡¨ç¤ºå‰é¢çš„æ¨¡å¼æ‰€åŒ¹é…åˆ°çš„å­—ç¬¦\næ–‡æœ¬è½¬æ¢ #DOS/Windowsæ ¼å¼çš„æ–‡æœ¬çš„æ¯ä¸€è¡Œæœ«å°¾æ˜¯ä¸€ä¸ªå›è½¦ï¼ˆCRï¼‰å’Œä¸€ä¸ªæ¢è¡Œç¬¦ï¼ˆLFï¼‰ï¼Œè€ŒUnixé£æ ¼çš„æ–‡æœ¬åªæœ‰ä¸€ä¸ªæ¢è¡Œç¬¦ã€‚\nUnixè½¬DOSï¼Œ$ åŒ¹é…åˆ°æ¯è¡Œçš„æœ«å°¾ï¼Œ\\r è¡¨ç¤ºå›è½¦ç¬¦ï¼Œè¿™æ ·å°±ä¼šåœ¨æ¯è¡Œçš„æœ«å°¾å‰æ·»åŠ ä¸€ä¸ªå›è½¦ç¬¦ï¼š\nsed -e 's/$/\\r/' filename \u0026gt; filename.txt DOSè½¬Unixï¼Œå°†è¡Œå°¾å‰çš„ä¸€ä¸ªå­—ç¬¦ï¼ˆå›è½¦ï¼‰æ›¿æ¢ä¸ºç©ºå³å¯ï¼š\nsed -e 's/.$//' filename.txt \u0026gt; filename ","date":"2012 November 2","permalink":"/posts/2012/11/02/","section":"Posts","summary":"ä¸€äº›é€‰é¡¹ # -e script ï¼šæ·»åŠ ä¸€å¥—å‘½ä»¤ï¼Œå¯é€šè¿‡è¯¥é€‰é¡¹æ·»åŠ å¤šä¸ªå¤„ç†å‘½ä»¤ -n ï¼šåªæ‰“å°é€šè¿‡ p å‘½ä»¤åŒ¹é…åˆ°çš„è¡Œ -i ï¼šå°†ä¿®æ”¹ç»“æœå†™å…¥æ–‡ä»¶ -f scriptfile ï¼šä½¿ç”¨è„šæœ¬æ–‡ä»¶ å¸¸ç”¨å‘½ä»¤ # !","title":"sed å­¦ä¹ ç¬”è®°"},{"content":"æµ‹è¯•æ–‡ä»¶ file çš„å†…å®¹å¦‚ä¸‹ï¼š\nMike Harrington:(510) 548-1278:250ğŸ’¯175 Christian Dobbins:(408) 538-2358:155:90:201 Susan Dalsass:(206) 654-6279:250:60:50 Archie McNichol:(206) 548-1348:250ğŸ’¯175 Jody Savage:(206) 548-1278:15:188:150 Guy Quigley:(916) 343-6410:250ğŸ’¯175 Dan Savage:(406) 298-7744:450:300:275 Nancy McNeil:(206) 548-1278:250:80:75 John Goldenrod:(916) 348-4278:250ğŸ’¯175 Chet Main:(510) 548-5258:50:95:135 Tom Savage:(408) 926-3456:250:168:200 Elizabeth Stachelin:(916) 440-1763:175:75:300 è¯¥æ–‡ä»¶ä¾æ¬¡æ˜¾ç¤ºçš„æ˜¯å§“åï¼Œç”µè¯å·ç ï¼Œè¿‡å»ä¸‰ä¸ªæœˆçš„ææ¬¾é¢ã€‚\næ˜¾ç¤ºæ‰€æœ‰çš„ç”µè¯å·ç \nawk -F \u0026quot;:\u0026quot; '{print $2}' file æ˜¾ç¤º Dan çš„ç”µè¯å·ç \nawk -F \u0026quot;:\u0026quot; '$1 ~ /^Dan / {print $2}' file æ˜¾ç¤ºæ‰€æœ‰ä»¥ D å¼€å¤´çš„å§“\nawk -F \u0026quot;[ :]\u0026quot; '$2 ~ /^D/ {print $2}' file æ˜¾ç¤ºæ‰€æœ‰ä»¥ C æˆ– E å¼€å¤´çš„å\nawk -F \u0026quot;[ :]\u0026quot; '$1 ~ /^[CE]/ {print $1}' file æ˜¾ç¤ºåªæœ‰å››ä¸ªå­—ç¬¦çš„å\nawk -F \u0026quot;[ :]\u0026quot; '{if(length($1) == 4) print $1}' file æ˜¾ç¤ºæ‰€æœ‰åŒºå·ä¸º 916 çš„äººå\nawk -F \u0026quot;:\u0026quot; '$2 ~ /(916)/ {print $1}' file æ˜¾ç¤º Mike çš„ææ¬¾ï¼Œæ¯ç¬”ææ¬¾ä»¥ $ å¼€å¤´\nawk -F \u0026quot;:\u0026quot; '$1 ~ /^Mike / {printf(\u0026quot;$%s,$%s,$%s\\n\u0026quot;,$3,$4,$5)}' file å°†æ‰€æœ‰ä¿¡æ¯è¾“å‡ºä¸ºå¦‚ä¸‹æ ¼å¼ï¼š\n*** CAMPAIGN 1998 CONTRIBUTIONS *** ---------------------------------------------------------------------------- NAME PHONE Jan | Feb | Mar | Total Donated ---------------------------------------------------------------------------- Mike Harrington (510) 548-1278 250.00 100.00 175.00 525.00 Christian Dobbins (408) 538-2358 155.00 90.00 201.00 446.00 Susan Dalsass (206) 654-6279 250.00 60.00 50.00 360.00 Archie McNichol (206) 548-1348 250.00 100.00 175.00 525.00 Jody Savage (206) 548-1278 15.00 188.00 150.00 353.00 Guy Quigley (916) 343-6410 250.00 100.00 175.00 525.00 Dan Savage (406) 298-7744 450.00 300.00 275.00 1025.00 Nancy McNeil (206) 548-1278 250.00 80.00 75.00 405.00 John Goldenrod (916) 348-4278 250.00 100.00 175.00 525.00 Chet Main (510) 548-5258 50.00 95.00 135.00 280.00 Tom Savage (408) 926-3456 250.00 168.00 200.00 618.00 Elizabeth Stachelin (916) 440-1763 175.00 75.00 300.00 550.00 --------------------------------------------------------------------------- SUMMARY --------------------------------------------------------------------------- The campaign received a total of $6137.00 for this quarter The average donation for the 12 contributors was $511.42 The highest contribution was $450.00 The lowest contributino was $15.00 è„šæœ¬æ–‡ä»¶ script å¦‚ä¸‹ï¼š\nBEGIN { FS=\u0026quot;:\u0026quot; sum=0 max=0 min=0 printf(\u0026quot; *** CAMPAIGN 1998 CONTRIBUTIONS ***\\n\u0026quot;) printf(\u0026quot;----------------------------------------------------------------------------\\n\u0026quot;) printf(\u0026quot;%19s%17s%10s%10s%10s%19s\\n\u0026quot;,\u0026quot;NAME\u0026quot;,\u0026quot;PHONE\u0026quot;,\u0026quot;Jan\u0026quot;,\u0026quot;| Feb\u0026quot;,\u0026quot;| Mar\u0026quot;,\u0026quot;| Total Donated\u0026quot;) printf(\u0026quot;----------------------------------------------------------------------------\\n\u0026quot;) } { printf(\u0026quot;%19s%17s%10.2f%10.2f%10.2f\u0026quot;,$1,$2,$3,$4,$5) total=$3+$4+$5 printf(\u0026quot;%12.2f\\n\u0026quot;,total) sum+=total\tif(NR==1) { min=$3 max=$3 } for(i=3;i\u0026lt;6;i++) { if(min\u0026gt;$i) min=$i if(max\u0026lt;$i) max=$i } } END { ave=sum/NR printf(\u0026quot;---------------------------------------------------------------------------\\n\u0026quot;) printf(\u0026quot; SUMMARY\\n\u0026quot;) printf(\u0026quot;---------------------------------------------------------------------------\\n\u0026quot;) printf(\u0026quot;The campaign received a total of $%.2f for this quarter\\n\u0026quot;,sum); printf(\u0026quot;The average donation for the 12 contributors was $%.2f\\n\u0026quot;,ave); printf(\u0026quot;The highest contribution was $%.2f\\n\u0026quot;,max) printf(\u0026quot;The lowest contributino was $%.2f\\n\u0026quot;,min) } æ‰§è¡Œï¼š\nawk -f script file ","date":"2012 October 28","permalink":"/posts/2012/10/28/","section":"Posts","summary":"æµ‹è¯•æ–‡ä»¶ file çš„å†…å®¹å¦‚ä¸‹ï¼š","title":"awk å®ä¾‹ç»ƒä¹ "},{"content":"åŸæ–‡ï¼š Wireless Operating Modes\nTranslated by Bob\n2012-10-27\nEmailï¼šgexbob@gmail.com\nBlogï¼šhttp://shaocheng.li\nä¸€ä¸ª WNIC ï¼ˆWireless Network Interface Controllerï¼Œæ— çº¿ç½‘ç»œæ¥å£æ§åˆ¶å™¨ï¼‰æ€»æ˜¯è¿è¡Œåœ¨å¦‚ä¸‹å‡ ç§æ¨¡å¼ä¹‹ä¸€ã€‚è¿™äº›æ¨¡å¼è®¾å®šäº†æ— çº¿è¿æ¥çš„ä¸»è¦åŠŸèƒ½ã€‚æœ‰æ—¶ä¹Ÿå¯èƒ½åŒæ—¶è¿è¡Œåœ¨ä¸¤ç§æ¨¡å¼ã€‚\nStation (STA) åŸºæœ¬æ¨¡å¼ #ä»»ä½•æ— çº¿é©±åŠ¨éƒ½èƒ½è¿è¡Œåœ¨è¿™ç§æ¨¡å¼ã€‚å› æ­¤å®ƒè¢«ç§°ä½œé»˜è®¤æ¨¡å¼ã€‚ä¸¤ä¸ª STA æ¨¡å¼çš„ WNIC æ— æ³•ç›¸äº’è¿æ¥ã€‚å®ƒä»¬éœ€è¦ç¬¬ä¸‰ä¸ª AP æ¨¡å¼çš„ WNIC æ¥ç®¡ç†æ— çº¿ç½‘ç»œï¼STA æ¨¡å¼çš„ WNIC é€šè¿‡å‘é€ç®¡ç†æ•°æ®å¸§æ¥è¿æ¥ AP æ¨¡å¼çš„ WNIC ã€‚è¿™ä¸ªè¿‡ç¨‹å«åšè®¤è¯ï¼ˆauthenticationï¼‰å’Œå…³è”ï¼ˆassociationï¼‰ã€‚å½“ AP å‘é€å…³è”æˆåŠŸçš„å›å¤åï¼Œè¿™ä¸ª STA å°±æˆä¸ºäº†æ— çº¿ç½‘ç»œçš„ä¸€éƒ¨åˆ†ã€‚\nAccessPoint (AP) åŸºæœ¬æ¨¡å¼ #åœ¨ä¸€ä¸ªå·²ç»è¢«ç®¡ç†çš„æ— çº¿ç½‘ç»œä¸­ï¼ŒAccess Point æ˜¯ä½œä¸ºä¸»è®¾å¤‡å­˜åœ¨çš„ã€‚å®ƒé€šè¿‡ç®¡ç†å’Œç»´æŠ¤ STA åˆ—è¡¨æ¥èšåˆç½‘ç»œã€‚å®ƒè¿˜ç®¡ç†å®‰å…¨ç­–ç•¥ã€‚è¿™ä¸ªç½‘ç»œå°±ä»¥ AP çš„ MAC åœ°å€å‘½åã€‚åŒæ—¶è¿˜ä¼šä¸º AP è®¾ç½®ä¸€ä¸ªå¯è¯»çš„åå­— SSID ã€‚\nLinux ä¸‹ä½¿ç”¨ AP æ¨¡å¼éœ€è¦ç”¨åˆ° hostapd ï¼Œå½“å‰è‡³å°‘æ˜¯ 0.6 ç‰ˆæœ¬ï¼Œæœ€å¥½é€šè¿‡ git è·å¾—ã€‚http://wireless.erley.org\nMonitor (MON) æ¨¡å¼ #Monitor æ¨¡å¼æ˜¯ä¸€ä¸ªè¢«åŠ¨æ¨¡å¼ï¼Œä¸ä¼šä¼ è¾“æ•°æ®å¸§ã€‚æ‰€æœ‰çš„è¾“å…¥åŒ…éƒ½äº¤ç»™ä¸»æœºå¤„ç†ï¼Œä¸ä¼šè¿›è¡Œä»»ä½•è¿‡æ»¤ã€‚è¿™ä¸ªæ¨¡å¼è¢«ç”¨æ¥ç›‘è§†ç½‘ç»œã€‚\nå¯¹äº mac80211 ï¼Œé™¤äº†å¸¸è§„è®¾å¤‡ï¼Œå®ƒå¯èƒ½è¿˜æœ‰ä¸€ä¸ªå¤„äº Monitor æ¨¡å¼çš„ç½‘ç»œè®¾å¤‡ï¼Œç”¨äºæ£€æµ‹å’Œä½¿ç”¨ç½‘ç»œã€‚å¯æ˜¯ï¼Œä¸æ˜¯æ‰€æœ‰çš„ç¡¬ä»¶éƒ½æ”¯æŒè¿™ä¸ªåŠŸèƒ½ï¼Œå› ä¸ºä¸æ˜¯æ‰€æœ‰çš„ç¡¬ä»¶éƒ½èƒ½é…ç½®ä¸ºåœ¨å…¶ä»–æ¨¡å¼ä¸‹æ˜¾ç¤ºæ‰€æœ‰çš„æ•°æ®åŒ…ã€‚Monitor æ¨¡å¼æ¥å£æ€»æ˜¯å·¥ä½œåœ¨â€œå°½å¯èƒ½(best effort)â€çš„åŸºç¡€ä¸Šã€‚\nå¯¹äº mac80211 ï¼Œä¹Ÿå¯ä»¥åœ¨ Monitor æ¨¡å¼ä¸‹å‘é€æ•°æ®åŒ…ï¼Œè¿™å«åšæ•°æ®åŒ…æ³¨å…¥ã€‚ç”¨äºæƒ³åœ¨ç”¨æˆ·ç©ºé—´å®æ–½ MLME å·¥ä½œçš„åº”ç”¨ç¨‹åºï¼Œä¾‹å¦‚æ”¯æŒ IEEE 802.11 çš„éæ ‡å‡† MAC æ‰©å±•ã€‚\nAd-Hoc (IBSS) æ¨¡å¼ #Ad-Hoc æ¨¡å¼ä¹Ÿå« IBBS (Independent Basic Service Set) æ¨¡å¼ï¼Œç”¨äºåˆ›å»ºæ— éœ€ AP çš„æ— çº¿ç½‘ç»œã€‚IBSS ç½‘ç»œä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½ç®¡ç†è‡ªå·±çš„ç½‘ç»œã€‚ Ad-Hoc ç”¨äºåœ¨æ²¡æœ‰å¯ç”¨ AP çš„æƒ…å†µä¸‹ä½¿ä¸¤å°æˆ–æ›´å¤šçš„ç”µè„‘ç›¸äº’è¿æ¥ã€‚\nWireless Distribution System (WDS) æ¨¡å¼ #åˆ†å‘ç³»ç»Ÿ (Distribution System) æ˜¯é€šè¿‡æœ‰çº¿è¿æ¥åˆ° AP ã€‚æ— çº¿åˆ†å‘ç³»ç»Ÿ (Wireless Distribution System) æ˜¯é€šè¿‡æ— çº¿çš„æ–¹å¼å®Œæˆç›¸åŒçš„å·¥ä½œã€‚WDS ä½œä¸ºå¤šä¸ªå…³è” AP ä¹‹é—´çš„å…±åŒé€”å¾„ï¼Œå¯è¢«ç”¨äºæ›¿ä»£ç»¼åˆå¸ƒçº¿ã€‚é˜…è¯» iw WDS æ–‡æ¡£å¯ä»¥è¯¦ç»†äº†è§£æ€æ ·ä½¿èƒ½è¿™ä¸ªæ¨¡å¼ï¼Œä¹Ÿè¦é‡æ–°ç†è§£ä½¿ç”¨ 4-address mode ã€‚\nMesh #Mesh æ¥å£è¢«ç”¨äºå…è®¸å¤šä¸ªè®¾å¤‡ä¹‹é—´é€šè¿‡åŠ¨æ€çš„å»ºç«‹æ™ºèƒ½è·¯ç”±æ¥ç›¸äº’æ²Ÿé€šã€‚\næŸ¥çœ‹ Wikipedia\u0026rsquo;s entry on 802.11s å’Œ Wireless mesh network(WMN)ã€‚\nä¸ºäº†å®ç° mesh çš„ portal åŠŸèƒ½ï¼Œå¯ä»¥ä¸ºå¸¸è§„ç½‘å£æ¡¥æ¥ä¸€ä¸ª mesh æ¥å£ã€‚\n","date":"2012 October 27","permalink":"/posts/2012/10/27/","section":"Posts","summary":"åŸæ–‡ï¼š Wireless Operating Modes","title":"Linux Wireless â€”â€” æ— çº¿æ“ä½œæ¨¡å¼"},{"content":"ç°åœ¨çš„ linux å†…æ ¸æ”¯æŒä¸‰ç§ç”µæºç®¡ç†æ¨¡å¼,å¯ä»¥åœ¨ /sys/power/state æ–‡ä»¶ä¸­æŸ¥çœ‹ï¼š\ncat /sys/power/state standby mem disk å‘è¯¥æ–‡ä»¶å†™å…¥æ¨¡å¼çš„åç§°å³å¯å®ç°å¾…æœºï¼Œä¼‘çœ ç­‰ï¼Œä¾‹å¦‚ï¼š\necho standby \u0026gt; /sys/power/state ä¸‹é¢å¯¹å„æ¨¡å¼è¯¦ç»†è¯´æ˜ã€‚\n1. standby #ACPI state: S1\nè¯¥æ¨¡å¼ä¼šå…³é—­æ˜¾ç¤ºå™¨å’Œé”®ç›˜ç­‰è¾“å…¥è®¾å¤‡ï¼Œ CPU ä¾ç„¶åœ¨å·¥ä½œï¼Œæ‰€æœ‰çš„æ“ä½œçŠ¶æ€éƒ½ä¸ä¼šä¸¢å¤±ã€‚\nåœ¨è¯¥æ¨¡å¼ä¸‹æŒ‰ä¸€ä¸‹è®¡ç®—æœºçš„å¼€å…³é”®ï¼Œç³»ç»Ÿä¼šåœ¨1~2ç§’å†…æ¢å¤åˆ°ä¹‹å‰çš„çŠ¶æ€ã€‚\n2. mem #ACPI state: S3\nè¯¥æ¨¡å¼ç›¸å½“äº Windows ä¸‹çš„å¾…æœºã€‚è®¡ç®—æœºå°†è¿›å…¥ä¸€ä¸ªä½ä¾›ç”µçŠ¶æ€ï¼Œåªæœ‰å†…å­˜ä¿æŒä¾›ç”µï¼Œå¹¶å¤„äºè‡ªåˆ·æ–°æ¨¡å¼ï¼Œä»¥ä¾¿ä¿å­˜å†…å®¹ã€‚\næ­¤æ—¶ï¼Œç³»ç»Ÿå’Œè®¾å¤‡çš„çŠ¶æ€éƒ½å­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚æ‰€æœ‰è®¾å¤‡ç”µæºéƒ½è¿›å…¥ D3 çŠ¶æ€ï¼Œå³å…¨éƒ¨æ–­ç”µã€‚å¤šæ•°æƒ…å†µä¸‹ï¼Œå¤–å›´è®¾å¤‡æ€»çº¿ä¹Ÿå…¨éƒ¨æ–­ç”µã€‚\nåœ¨è¯¥æ¨¡å¼ä¸‹æŒ‰ä¸€ä¸‹è®¡ç®—æœºçš„å¼€å…³é”®ï¼Œç³»ç»Ÿä¼šåœ¨3~5ç§’å†…æ¢å¤åˆ°ä¹‹å‰çš„çŠ¶æ€ã€‚\n3. disk #ACPI state: S4\nè¯¥æ¨¡å¼ç±»ä¼¼ mem æ¨¡å¼ï¼Œä½†æ˜¯æœ€åå¤šäº†ä¸€ä¸ªæ­¥éª¤ï¼šå°†å†…å­˜çš„å†…å®¹å†™å…¥ç¡¬ç›˜ï¼ˆé€šå¸¸æ˜¯å†™å…¥ swap åˆ†åŒºï¼‰ã€‚åœ¨æ¢å¤æ—¶ï¼Œå†å°†å…¶è¯»å‡ºï¼Œå¹¶é‡æ–°å†™å…¥æš‚åœå‰çš„å·¥ä½œçŠ¶æ€ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œå³ä½¿åœ¨è¯¥æ¨¡å¼ä¸‹è®¡ç®—æœºæ–­ç”µï¼Œä¹Ÿä¸ä¼šä¸¢å¤±æ•°æ®ï¼Œä¾ç„¶å¯ä»¥æ¢å¤åˆ°ä»¥å‰çš„å·¥ä½œçŠ¶æ€ã€‚\nä»è¯¥æ¨¡å¼æ¢å¤éœ€è¦å¤§çº¦30ç§’ã€‚\nåœ¨ disk æ¨¡å¼ä¸­ï¼Œå°†å†…å­˜å†…å®¹å†™å…¥ç¡¬ç›˜çš„ swap åˆ†åŒºä½¿ç”¨çš„æ˜¯ swsusp æœºåˆ¶ã€‚å…³äºè¯¥æœºåˆ¶çš„è¯¦æƒ…åœ¨å†…æ ¸æºç çš„ Documentation/power/swsusp.txt æ–‡ä»¶ä¸­ã€‚\n","date":"2012 October 23","permalink":"/posts/2012/10/23/","section":"Posts","summary":"ç°åœ¨çš„ linux å†…æ ¸æ”¯æŒä¸‰ç§ç”µæºç®¡ç†æ¨¡å¼,å¯ä»¥åœ¨ /sys/power/state æ–‡ä»¶ä¸­æŸ¥çœ‹ï¼š","title":"Linux ç³»ç»Ÿçš„ç”µæºç®¡ç†"},{"content":"ç®€ä»‹ #å®˜æ–¹ : http://www.sublimetext.com/\nå‚è€ƒäº†éå®˜æ–¹æ–‡æ¡£ : http://docs.sublimetext.info/en/latest/index.html\nè§†é¢‘ç®€ä»‹ : http://v.youku.com/v_show/id_XMzU5NzQ5ODgw.html\n1.åŸºæœ¬ç¼–è¾‘ #1.1.æ“ä½œæ–‡ä»¶ # Ctrl+n :æ–°å»ºæ–‡ä»¶ã€‚ Ctrl+s :ä¿å­˜æ–‡ä»¶ã€‚ Ctrl+w :å…³é—­å½“å‰æ–‡ä»¶ï¼Œæ²¡æœ‰æ–‡ä»¶æ—¶ä¼šå…³é—­çª—å£ã€‚ Ctrl+tab :åœ¨å¤šä¸ªæ‰“å¼€çš„æ–‡ä»¶ä¹‹é—´åˆ‡æ¢ åœ¨ View-\u0026gt;Syntax ä¸­å¯ä»¥é€‰æ‹©å½“å‰æ–‡ä»¶çš„è¯­æ³•ã€‚ 1.2.é€‰æ‹©æ–‡æœ¬ # Ctrl+l :é€‰æ‹©å½“å‰è¡Œ Shift+é¼ æ ‡å³é”® :æŒ‰åˆ—é€‰æ‹©æ–‡æœ¬ã€‚ åå¤æŒ‰ä¸‹ Ctrl+d å¯ä»¥å°†å…¨æ–‡ä¸­ä¸å…‰æ ‡æ‰€åœ¨å¤„ç›¸åŒçš„å•è¯é€ä¸€åŠ å…¥é€‰æ‹©ï¼Œç›´æ¥æŒ‰ Alt+F3 å¯ä»¥ä¸€æ¬¡é€‰æ‹©å…¨éƒ¨ç›¸åŒçš„å•è¯ã€‚ 1.3.è·³è½¬ # ç”¨ Ctrl+P å¯ä»¥å¿«é€Ÿè·³è½¬åˆ°å½“å‰é¡¹ç›®ä¸­çš„ä»»æ„æ–‡ä»¶ï¼Œå¯è¿›è¡Œå…³é”®è¯åŒ¹é…ã€‚ ç”¨ Ctrl+P å @ (æˆ–æ˜¯Ctrl+R)å¯ä»¥å¿«é€Ÿåˆ—å‡º/è·³è½¬åˆ°æŸä¸ªå‡½æ•°ï¼ˆå¾ˆçˆ½çš„æ˜¯åœ¨ markdown å½“ä¸­æ˜¯åŒ¹é…åˆ°æ ‡é¢˜ï¼Œè€Œä¸”è¿˜æ˜¯å¸¦ç¼©è¿›çš„ï¼ï¼‰ã€‚ ç”¨ Ctrl+P å # å¯ä»¥åœ¨å½“å‰æ–‡ä»¶ä¸­è¿›è¡Œæœç´¢ã€‚ ç”¨ Ctrl+P å : (æˆ–æ˜¯Ctrl+G)åŠ ä¸Šæ•°å­—å¯ä»¥è·³è½¬åˆ°ç›¸åº”çš„è¡Œã€‚ è€Œæ›´é…·çš„æ˜¯ä½ å¯ä»¥ç”¨ Ctrl+P åŠ ä¸Šä¸€äº›å…³é”®è¯è·³è½¬åˆ°æŸä¸ªæ–‡ä»¶åŒæ—¶åŠ ä¸Š @ æ¥åˆ—å‡º/è·³è½¬åˆ°ç›®æ ‡æ–‡ä»¶ä¸­çš„æŸä¸ªå‡½æ•°ï¼Œæˆ–æ˜¯åŒæ—¶åŠ ä¸Š # æ¥åœ¨ç›®æ ‡æ–‡ä»¶ä¸­è¿›è¡Œæœç´¢ï¼Œæˆ–æ˜¯åŒæ—¶åŠ ä¸Š : å’Œæ•°å­—æ¥è·³è½¬åˆ°ç›®æ ‡æ–‡ä»¶ä¸­ç›¸åº”çš„è¡Œã€‚ 1.4.æ³¨é‡Š # Ctrl+/ :å¿«é€Ÿæ³¨é‡Šä¸€è¡Œï¼Œä¼šæ ¹æ®å½“å‰æ–‡ä»¶çš„è¯­æ³•é€‰æ‹©æ³¨é‡Šå­—ç¬¦ã€‚ Ctrl+Shift+/ :æ³¨é‡Šä¸€å—ä»£ç ã€‚ 2.å¸¸ç”¨è®¾ç½® #Sublime Text çš„å„é¡¹ç‰¹æ€§éƒ½æ˜¯ç”¨é…ç½®æ–‡ä»¶æ¥è®¾ç½®çš„ã€‚ä¾‹å¦‚ç”¨ Preferences-\u0026gt;Settings-User å¯æ‰“å¼€é’ˆå¯¹å½“å‰ç”¨æˆ·çš„é…ç½®æ–‡ä»¶ï¼Œæ–‡ä»¶ä¸­æ¯è¡Œè®¾ç½®ä¸€ä¸ªç‰¹æ€§ï¼Œä»¥é€—å·ç»“å°¾ï¼Œæœ€åä¸€ä¸ªè¡Œæœ«å°¾ä¸å¯ä»¥å†™é€—å·ï¼Œä¾‹å¦‚:\n{ \u0026quot;font_face\u0026quot;: \u0026quot;DejaVu Sans Mono\u0026quot;, \u0026quot;font_size\u0026quot;: 12 } 2.1.è®¾ç½®å­—ä½“ #ç‚¹å‡»èœå•ä¸Šçš„ Preferences-\u0026gt;Settings-User ï¼Œåœ¨æ‰“å¼€çš„ç”¨æˆ·é…ç½®æ–‡ä»¶ä¸­è¾“å…¥:\n\u0026quot;font_face\u0026quot;: \u0026quot;DejaVu Sans Mono\u0026quot;, \u0026quot;font_size\u0026quot;: 12, ä¹Ÿå¯ä»¥é€‰æ‹© Preferences-\u0026gt;Settings-Defaultï¼Œåœ¨é»˜è®¤é…ç½®æ–‡ä»¶ä¸­çš„ç›¸åŒå­—æ®µä¸­è®¾ç½®é»˜è®¤å­—ä½“ã€‚\n2.2.è®¾ç½®ç¼©è¿› #åœ¨ Preferences-\u0026gt;Settings-Default ä¸­å¯ä»¥çœ‹åˆ°é»˜è®¤ç¼©è¿›ä¸º4ä¸ªç©ºæ ¼çš„å®½åº¦ï¼Œå¹¶ä¸” Tab ä¸ä¼šè½¬æ¢ä¸ºç©ºæ ¼ï¼Œç›¸åº”çš„å­—æ®µä¸º:\n\u0026quot;tab_size\u0026quot;: 4, \u0026quot;translate_tabs_to_spaces\u0026quot;: false, è¿˜å¯ä»¥é’ˆå¯¹ç›¸åº”çš„è¯­æ³•è®¾ç½®ç‰¹å®šçš„ç¼©è¿›æ ¼å¼ã€‚å…ˆåœ¨ View-\u0026gt;Syntax ä¸­é€‰æ‹©è¯­æ³•ï¼Œç„¶åç‚¹å‡» Preferences-\u0026gt;Settings-More-\u0026gt;Syntax Specific-User,åœ¨æ‰“å¼€çš„æ–‡ä»¶ä¸­è®¾ç½®ã€‚\n2.3.è®¾ç½®æ–‡ä»¶çš„ä¿å­˜æ ¼å¼ #æˆ‘ä»¬å¸Œæœ›æ ¹æ®å½“å‰çš„è¯­æ³•å°†æ–‡ä»¶ä¿å­˜ä¸ºç›¸åº”çš„æ ¼å¼ï¼Œä¾‹å¦‚Markdownæ–‡ä»¶ä¿å­˜ä¸ºåç¼€ä¸º .md çš„æ–‡ä»¶ã€‚è®¾ç½®æ–¹æ³•å¦‚ä¸‹:\næ–°å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œè®¾ç½® View-\u0026gt;Syntax ä¸º Markdown ã€‚\né€‰æ‹© preferences-\u0026gt;Setting-more-\u0026gt;Syntax Specific-User ï¼Œåœ¨æ‰“å¼€çš„ Markdown.sublime-settings æ–‡ä»¶ä¸­è¾“å…¥:\n{ \u0026quot;extensions\u0026quot;: [ \u0026quot;md\u0026quot; ] } ç„¶åä¿å­˜ã€‚\nä¿å­˜ä¹‹å‰æ–°å»ºçš„æ–‡ä»¶ï¼Œåç¼€å°±ä¼šæ˜¯ .md ã€‚\n2.4.è®¾ç½®ä¸ºVimæ¨¡å¼ #ç‚¹å‡» Preferences-\u0026gt;Setting-user ï¼Œåœ¨æ‰“å¼€çš„é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ï¼š\n\u0026quot;ignored_packages\u0026quot;: [], ç„¶åä¿å­˜ã€‚\nåœ¨ Vim çš„ insert æ¨¡å¼ä¸‹ä¹Ÿå¯ä»¥ç”¨æ­£å¸¸ Sublime Text çš„æ–¹å¼ç¼–è¾‘æ–‡ä»¶ã€‚\n3.å®‰è£…æ’ä»¶ #åªéœ€å°†ä¸‹è½½çš„æ’ä»¶è§£å‹åˆ° Packages ç›®å½•å³å¯ï¼Œæ‰“å¼€ Packages ç›®å½•çš„æ–¹æ³•æ˜¯ç‚¹å‡» Preferences-\u0026gt;Browse Packages\u0026hellip; ã€‚\nä¹Ÿå¯ä»¥é€šè¿‡ Sublime Package Control æ’ä»¶æ¥æœç´¢ã€ä¸‹è½½ã€å®‰è£…æºä¸­çš„æ’ä»¶ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š\nç”¨ Ctrl+Â· æ‰“å¼€ console ï¼Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤:\nimport urllib2,os; pf='Package Control.sublime-package'; ipp=sublime.installed_packages_path(); os.makedirs(ipp) if not os.path.exists(ipp) else None; urllib2.install_opener(urllib2.build_opener(urllib2.ProxyHandler())); open(os.path.join(ipp,pf),'wb').write(urllib2.urlopen('http://sublime.wbond.net/'+pf.replace(' ','%20')).read()); print 'Please restart Sublime Text to finish installation' è¯¥å‘½ä»¤ä¼šåˆ›å»ºä¸€ä¸ª Installed Packages Text æ–‡ä»¶å¤¹ï¼Œç„¶åä¸‹è½½ Package Control.sublime-package åˆ°ä»–ä¸‹é¢ã€‚\nç„¶åé‡å¯ Sublime Text ã€‚åœ¨èœå• Preferences ä¸‹å¯ä»¥çœ‹åˆ°å¤šå‡ºäº† Package Control æ¡ç›®ã€‚\næŒ‰ä¸‹ Ctrl+Shift+p ï¼Œæ‰“å¼€å‘½ä»¤é¢æ¿ã€‚è¾“å…¥ install è°ƒå‡º Package Control: Install Package åæŒ‰å›è½¦ï¼Œåœ¨åˆ—è¡¨ä¸­é€‰æ‹©éœ€è¦å®‰è£…çš„æ’ä»¶ï¼Œå°±ä¼šè‡ªåŠ¨å®‰è£…ï¼Œé‡å¯åç”Ÿæ•ˆã€‚\n3.1.ä¸€äº›æœ‰ç”¨çš„æ’ä»¶ # GBK Encoding Support : Sublime Text ç›®å‰åªæ”¯æŒ UTF-8 ç¼–ç çš„æ–‡ä»¶ï¼Œè¯¥æ’ä»¶å¯ä»¥ä½¿ Sublime Text æ”¯æŒ GBK ç¼–ç æ–‡ä»¶ã€‚å¯ç”¨åè½½å…¥æ–‡ä»¶çš„é€Ÿåº¦å˜æ…¢ï¼Œè¿˜æœ‰ä¸€ä¸ªBugå°±æ˜¯æ ‡ç­¾ä¸Šçš„æ–‡ä»¶åä¹±ç ï¼Œæ ¹æ®æŸç½‘å‹çš„æ–¹æ³•å¯¹è¯¥æ’ä»¶çš„ sublime_gbk.py æ–‡ä»¶çš„è¿›è¡Œä¿®æ”¹åè§£å†³ï¼Œä¿®æ”¹åçš„ä»£ç å¦‚ä¸‹ï¼Œç”¨ # æ³¨é‡Šçš„æ˜¯æºä»£ç ï¼Œç”¨ #new line æ ‡è®°çš„æ˜¯æ–°åŠ çš„ä»£ç ã€‚\nexcept: gbk = file(view.file_name()).read() text = gbk.decode('gbk') file_name = view.file_name().encode('utf-8') #tmp_file_name = urllib.quote_plus(os.path.basename(file_name)) + SEPERATOR + urllib.quote_\tplus(file_name) #tmp_file = os.path.join(TEMP_PATH, tmp_file_name) #f = file(tmp_file, 'w') f = file(view.file_name(),'w') #new line f.write(text.encode('utf8')) f.close() window = sublime.active_window() #v = window.find_open_file(tmp_file) v = window.find_open_file(file_name) #new line if(not v): #window.open_file(tmp_file) window.open_file(file_name) #new ConvertToUTF8 : åŠŸèƒ½ä¸ GBK Encoding Support ç±»ä¼¼ï¼Œä¸”æ²¡æœ‰ Bug ã€‚\nMarkdown Build : ç”¨äºå°† Markdown æ–‡ä»¶è½¬æ¢ä¸º Html ï¼Œå¹¶ç”¨æµè§ˆå™¨æ‰“å¼€ã€‚å¿«æ·é”®æ˜¯ Ctlr+b ã€‚\nTag : æ ¼å¼åŒ– Html å’Œ CSS è¯­å¥ï¼Œé€‰ä¸­ä¸€æ®µè¯­å¥ï¼Œå®‰è£…ç»„åˆé”® ctrl+alt+f å³å¯ã€‚\nJSFormat : æ ¼å¼åŒ– Javascript æ–‡ä»¶\nå®‰è£…åé‡å¯ sublime text å°±èƒ½ä½¿ç”¨jsæ ¼å¼åŒ–æ’ä»¶\nä½¿ç”¨æ–¹æ³•ï¼š\n1.å¿«æ·é”®ï¼šctrl+alt+f\n2.å…ˆç”¨å¿«æ·é”®æ‰“å¼€å‘½ä»¤é¢æ¿ â€œctrl + shift + pâ€, å†è¾“å…¥ â€œFormat: Javascriptâ€ å°±å¯ä»¥ä½¿ç”¨æ ¼å¼åŒ–å‘½ä»¤\nSublimeCodeIntel : ä»£ç è¡¥å…¨æç¤ºï¼Œæ”¯æŒå¤šç§è¯­è¨€ã€‚\nSoda : ä¸€ä¸ªä¸»é¢˜ï¼Œæ¯”é»˜è®¤çš„æ¼‚äº®ä¸€äº›ã€‚å®‰è£…åï¼Œæ‰“å¼€é…ç½®æ–‡ä»¶Preferences -\u0026gt; Settings - Userï¼ŒåŠ ä¸Šä¸€è¡Œ\u0026quot;theme\u0026quot;: \u0026ldquo;Soda Light.sublime-theme\u0026quot;æˆ–è€… \u0026ldquo;theme\u0026rdquo;: \u0026ldquo;Soda Dark.sublime-theme\u0026rdquo;ã€‚å‰é¢ä¸€ä¸ªæ˜¯äº®è‰²ä¸»é¢˜ï¼Œåé¢ä¸€ä¸ªæ˜¯æš—è‰²ä¸»é¢˜ã€‚\n3.2.ç”¨ Sublime Text ç¼–è¾‘ Markdown æ–‡ä»¶ # é…ç½® Markdown è¯­æ³•é«˜äº®\nä¸‹è½½ Made of code é…è‰²æ–‡ä»¶ï¼Œæ”¾åœ¨ Preferences-\u0026gt;Browse Package\u0026hellip; æ‰€æ‰“å¼€çš„ç›®å½•ä¸‹å³å¯ã€‚\nåœ¨ Preferences-\u0026gt;Color Scheme ä¸­é€‰æ‹© Made of code ï¼Œåœ¨ View-\u0026gt;Syntax ä¸­é€‰æ‹© Markdown ã€‚\nå®‰è£… Markdown Build æ’ä»¶ã€‚\nåœ¨ Tool èœå•é‡Œç‚¹å‡» Buildï¼Œå¿«æ·é”®æ˜¯ Ctrl+b ï¼Œä¼šè°ƒç”¨ Markdown Build ç”Ÿæˆ Html æ–‡ä»¶å¹¶ç”¨é»˜è®¤çš„æµè§ˆå™¨æ‰“å¼€ã€‚\n4.ä¸€äº›é—®é¢˜ #æœ€è¿‘å‘ç°æ‰“å¼€æ–‡ä»¶æ—¶ï¼Œä¼šå¤šå‡ºä¸€ä¸ªå¸¦ dump åç¼€çš„æ–‡ä»¶ã€‚æœ€åå‘ç°æ˜¯ GBK Encoding Support æ’ä»¶çš„é—®é¢˜ï¼Œå¸è½½åè§£å†³ï¼Œç„¶åæ¢ä¸Šäº† ConvertToUTF8 ã€‚\n","date":"2012 September 16","permalink":"/posts/2012/09/16/","section":"Posts","summary":"ç®€ä»‹ #å®˜æ–¹ : http://www.","title":"Sublime Text"},{"content":"1.ä»£ç å’Œè¯­æ³•é«˜äº® #é™¤äº† Markdown è¯­æ³•çš„ç¼©è¿›æ–¹å¼ï¼Œåœ¨ Octopress ä¸­è¿˜å¤šç§æ–¹å¼å¯ä»¥åœ¨æ–‡ç« ä¸­åµŒå…¥ä»£ç å¹¶æ˜¾ç¤ºè¯­æ³•é«˜äº®ï¼š\nåå¼•å·ä»£ç å— è¯­æ³•\n``` [language] [title] [url] [link text] code snippet ``` åµŒå…¥ Gist Gist æ˜¯ Github æä¾›çš„ä¸€ä¸ªä»£ç ç®¡ç†åŠŸèƒ½ã€‚åœ¨ Gist ä¸­æ–°å»ºçš„ä»£ç æ–‡ä»¶ä¼šè·å¾—ä¸€ä¸ª gist_id ï¼Œç”¨ä¸‹é¢çš„è¯­æ³•å°±å¯ä»¥åœ¨æ–‡ç« ä¸­åµŒå…¥ç›¸åº”çš„ä»£ç ï¼š\n{ % gist gist_id [filename] % } filename æ˜¯å¯é€‰çš„ï¼Œå¦‚æœä¸€ä¸ª gist_id ä¸‹æœ‰å¤šä¸ªæ–‡ä»¶ï¼Œå¯ä»¥ä¾æ¬¡åµŒå…¥ã€‚\ninclude_code include_code ç”¨äºåœ¨æ–‡ç« ä¸­å¯¼å…¥ä»£ç æ–‡ä»¶ã€‚å¯ä»¥åœ¨ _config.yml çš„ code_dir è®¾ç½®æ–‡ä»¶è·¯å¾„ï¼Œé»˜è®¤æ˜¯ source/downloads/code ã€‚\nè¯­æ³•ï¼š\n{ % include_code [title] [lang:language] path/to/file % } ä¾‹å¦‚ï¼Œå¯¼å…¥ source/downloads/code/test.js ï¼š\n{ % include_code test.js % } 2.æ’å…¥å›¾ç‰‡ #github æä¾›çš„ç©ºé—´æœ‰é™ï¼Œå›¾ç‰‡æœ€å¥½ä½¿ç”¨å¤–é“¾ã€‚\nOctopress æä¾›çš„æ’å…¥å›¾ç‰‡çš„è¯­æ³•å¦‚ä¸‹ï¼š\n{ % img [class names] /path/to/image [width] [height] [title text [alt text]] % } å¦‚æœåªè¾“å…¥å›¾ç‰‡çš„è·¯å¾„ (/path/to/image) ï¼Œå›¾ç‰‡ä¼šä»¥å·¦å¯¹é½çš„æ–¹å¼æ˜¾ç¤ºï¼Œå…¶ä»–å¯é€‰å‚æ•°å¯ä»¥æ§åˆ¶å›¾ç‰‡çš„å®½é«˜å’Œæ˜¾ç¤ºä½ç½® (class names) ã€‚\n3.æ·»åŠ å¯¼èˆª #ä»¥æ·»åŠ ä¸€ä¸ª About é¡µé¢ä¸ºä¾‹ï¼š\næ‰§è¡Œï¼š rake new_page[blog/about] åœ¨ source/blog/ ç›®å½•å…ˆç”Ÿæˆ about ç›®å½•å’Œ about/index.markdown æ–‡ä»¶ï¼Œé»˜è®¤çš„å¸ƒå±€æ–¹å¼æ˜¯ layout: page ã€‚\nåœ¨ source/_includes/custom/navigation.html æ–‡ä»¶ä¸­æ·»åŠ ä¸€è¡Œï¼š\n\u0026lt;li\u0026gt;\u0026lt;a href=\u0026#34;{{ root_url }}/blog/about\u0026#34;\u0026gt;About\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt; 4.å¸ƒå±€ #æ‰€æœ‰çš„é¡µé¢å¸ƒå±€æ–‡ä»¶éƒ½ä½äº source/_layouts ç›®å½•ä¸‹ï¼Œä¾‹å¦‚ post.html æ˜¯å‘å¸ƒæ–‡ç« æ—¶é»˜è®¤çš„å¸ƒå±€ã€‚\nå¯ä»¥ä»å·²æœ‰çš„å¸ƒå±€æ–‡ä»¶å¤åˆ¶ï¼Œç„¶åä¿®æ”¹ï¼Œä¾‹å¦‚ä» page.html å¤åˆ¶ä¸€ä»½ about.html ï¼Œå¹¶ä¿®æ”¹ï¼Œç„¶åå°±å¯ä»¥åœ¨ä¸Šé¢æ–°å»ºçš„ about/index.markdown ä¸­è®¾ç½® layout: about ã€‚\n5.ä¾§è¾¹æ  #Octopress æä¾›çš„ä¾§è¾¹æ éƒ½ä½äº source/_includes/asides ç›®å½•ä¸‹ï¼Œä¾‹å¦‚ï¼šæ˜¾ç¤ºæœ€è¿‘å‘è¡¨çš„ recent_posts.html ï¼Œæ˜¾ç¤º github ç‰ˆæœ¬åº“çš„ github.htmlã€‚æˆ‘ä»¬æ–°å¢çš„ä¾§è¾¹æ æœ€å¥½æ”¾åœ¨ source/_includes/custom/asides ä¸‹ã€‚\nå‡è®¾æˆ‘ä»¬æ–°å»ºäº†ä¸€ä¸ªæ˜¾ç¤ºå‘å¸ƒè®¸å¯è¯çš„ä¾§è¾¹æ :license.htmlï¼Œè¦å°†å…¶æ˜¾ç¤ºåœ¨æ‰€æœ‰çš„é¡µé¢éœ€è¦ä¿®æ”¹ _config.yml æ–‡ä»¶ï¼š\ndefault_asides: [custom/asides/license.html] default_asides ä¸­æ·»åŠ çš„ä¾§è¾¹æ ä¼šæ˜¾ç¤ºåœ¨æ‰€æœ‰å¸ƒå±€çš„é¡µé¢ä¸­ï¼Œå¦‚æœæƒ³è¦æ ¹æ®é¡µé¢çš„å¸ƒå±€æ˜¾ç¤ºä¸åŒçš„ä¾§è¾¹æ ï¼ŒOctopress æä¾›äº†ä¸‰ä¸ªé»˜è®¤å¸ƒå±€çš„è®¾ç½®å˜é‡ï¼š\nblog_index_asides # blog ä¸»é¡µä¸Šæ˜¾ç¤ºçš„ä¾§è¾¹æ  post_asides # post å¸ƒå±€é¡µé¢æ˜¾ç¤ºçš„ä¾§è¾¹æ  page_asides # page å¸ƒå±€é¡µé¢æ˜¾ç¤ºçš„ä¾§è¾¹æ  åªè¦åœ¨ç›¸åº”çš„å˜é‡ä¸­æ·»åŠ ä¾§è¾¹æ å³å¯ã€‚\nå¦‚æœè¦æ–°å»ºäº†å…¶ä»–å¸ƒå±€ï¼Œå¦‚ about.htmlï¼Œåªéœ€åœ¨ _config.yml æ–‡ä»¶ä¸­æ·»åŠ  about_asides ã€‚\n6.è¯„è®º #Octproess å·²ç»åŒ…å«äº†æ”¯æŒ Disqus çš„æ’ä»¶ï¼Œåªéœ€åšç®€å•çš„è®¾ç½®å³å¯ä½¿ç”¨ï¼š\né¦–å…ˆç¡®ä¿ä½ å·²ç»æ³¨å†Œäº†ä¸€ä¸ª Disqus çš„è´¦æˆ·ï¼Œå¹¶å°†ä½ çš„ Blog çš„ URL æ·»åŠ åˆ° Disqus ã€‚\nç„¶ååœ¨ _config.yml ä¸­è®¾ç½® Disqus è´¦æˆ·çš„ short name , å¹¶å°†å…¶ä½¿èƒ½ï¼š\n# Disqus Comments disqus_short_name: exbob disqus_show_comment_count: true æœ€ååœ¨æ¯ä¸ª post çš„å¤´éƒ¨è®¾ç½®å…è®¸è¯„è®ºï¼š\ncomments: true 7.åˆ†äº« #æ·»åŠ åˆ†äº«æŒ‰é’®çš„æ–¹å¼æœ‰å¾ˆå¤šï¼Œè¿™é‡Œç”¨çš„æ˜¯ ç™¾åº¦åˆ†äº«ï¼š\né¦–å…ˆåœ¨ç™¾åº¦åˆ†äº«ä¸­é€‰æ‹©åˆ†äº«æŒ‰é’®çš„æ ·å¼ï¼Œå¹¶ç”Ÿæˆä»£ç ï¼Œä¾‹å¦‚ï¼š \u0026lt;!-- Baidu Button BEGIN --\u0026gt; \u0026lt;div id=\u0026#34;bdshare\u0026#34; class=\u0026#34;bdshare_t bds_tools get-codes-bdshare\u0026#34;\u0026gt; \u0026lt;a class=\u0026#34;bds_qzone\u0026#34;\u0026gt;\u0026lt;/a\u0026gt; \u0026lt;a class=\u0026#34;bds_tsina\u0026#34;\u0026gt;\u0026lt;/a\u0026gt; \u0026lt;a class=\u0026#34;bds_tqq\u0026#34;\u0026gt;\u0026lt;/a\u0026gt; \u0026lt;a class=\u0026#34;bds_renren\u0026#34;\u0026gt;\u0026lt;/a\u0026gt; \u0026lt;span class=\u0026#34;bds_more\u0026#34;\u0026gt;æ›´å¤š\u0026lt;/span\u0026gt; \u0026lt;a class=\u0026#34;shareCount\u0026#34;\u0026gt;\u0026lt;/a\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;script type=\u0026#34;text/javascript\u0026#34; id=\u0026#34;bdshare_js\u0026#34; data=\u0026#34;type=tools\u0026amp;amp;uid=949520\u0026#34; \u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script type=\u0026#34;text/javascript\u0026#34; id=\u0026#34;bdshell_js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script type=\u0026#34;text/javascript\u0026#34;\u0026gt; document.getElementById(\u0026#34;bdshell_js\u0026#34;).src = \u0026#34;http://bdimg.share.baidu.com/static/js/shell_v2.js?cdnversion=\u0026#34; + new Date().getHours(); \u0026lt;/script\u0026gt; \u0026lt;!-- Baidu Button END --\u0026gt; å°†ä¸Šé¢çš„ä»£ç æ·»åŠ åˆ° source/_includes/post/sharing.html æ–‡ä»¶çš„ä¸­ï¼š \u0026lt;div class=\u0026#34;sharing\u0026#34;\u0026gt; { % if site.baidushare % } \u0026lt;!-- Baidu Button BEGIN --\u0026gt; \u0026lt;div id=\u0026#34;bdshare\u0026#34; class=\u0026#34;bdshare_t bds_tools get-codes-bdshare\u0026#34;\u0026gt; \u0026lt;a class=\u0026#34;bds_qzone\u0026#34;\u0026gt;\u0026lt;/a\u0026gt; \u0026lt;a class=\u0026#34;bds_tsina\u0026#34;\u0026gt;\u0026lt;/a\u0026gt; \u0026lt;a class=\u0026#34;bds_tqq\u0026#34;\u0026gt;\u0026lt;/a\u0026gt; \u0026lt;a class=\u0026#34;bds_renren\u0026#34;\u0026gt;\u0026lt;/a\u0026gt; \u0026lt;span class=\u0026#34;bds_more\u0026#34;\u0026gt;æ›´å¤š\u0026lt;/span\u0026gt; \u0026lt;a class=\u0026#34;shareCount\u0026#34;\u0026gt;\u0026lt;/a\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;script type=\u0026#34;text/javascript\u0026#34; id=\u0026#34;bdshare_js\u0026#34; data=\u0026#34;type=tools\u0026amp;amp;uid=949520\u0026#34; \u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script type=\u0026#34;text/javascript\u0026#34; id=\u0026#34;bdshell_js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script type=\u0026#34;text/javascript\u0026#34;\u0026gt; document.getElementById(\u0026#34;bdshell_js\u0026#34;).src = \u0026#34;http://bdimg.share.baidu.com/static/js/shell_v2.js?cdnversion=\u0026#34; + new Date().getHours(); \u0026lt;/script\u0026gt; \u0026lt;!-- Baidu Button END --\u0026gt; { % endif % } \u0026lt;/div\u0026gt; æœ€åï¼Œåœ¨ _config.yml æ–‡ä»¶ä¸­æ·»åŠ  baidushare : # baidu share baidushare: true ","date":"2012 September 15","permalink":"/posts/2012/09/15/","section":"Posts","summary":"1.ä»£ç å’Œè¯­æ³•é«˜äº® #é™¤äº† Markdown è¯­æ³•çš„ç¼©è¿›æ–¹å¼ï¼Œåœ¨ Octopress ä¸­è¿˜å¤šç§æ–¹å¼å¯ä»¥åœ¨æ–‡ç« ä¸­åµŒå…¥ä»£ç å¹¶æ˜¾ç¤ºè¯­æ³•é«˜äº®ï¼š","title":"Octopress ä½¿ç”¨ç¬”è®°"},{"content":"1.å‡†å¤‡ # å®‰è£… git\nsudo yum install git é…ç½®ï¼š\ngit config --global user.name \u0026quot;your name\u0026quot; git config --global user.email \u0026quot;your email\u0026quot; ç”¨ RVM å®‰è£… Ruby 1.9.3ï¼š\ncurl -L https://get.rvm.io | bash -s stable --ruby æ ¹æ®æç¤ºæ‰§è¡Œï¼š\nsource ~/.rvm/scripts/rvm å†å®‰è£… ruby 1.9.3ï¼š\nrvm install 1.9.3 rvm use 1.9.3 rvm rubygems latest å®‰è£…ç»“æŸåè¿è¡Œ ruby \u0026ndash;version æŸ¥çœ‹ ruby ç‰ˆæœ¬ã€‚\nå®‰è£… Octopress\ngit clone git://github.com/imathis/octopress.git octopress cd octopress # é¦–æ¬¡è¿›å…¥è¯¥ç›®å½•æ—¶ä¼šè¯¢é—®æ˜¯å¦ä¿¡ä»» .rvmrc æ–‡ä»¶ï¼Œé€‰æ‹© yes ruby --version # åº”è¯¥æ˜¯ Ruby 1.9.3 å†å®‰è£…ä¸€äº›ä¾èµ–æ–‡ä»¶ï¼š\ngem install bundler bundle install å®‰è£…é»˜è®¤çš„ä¸»é¢˜ï¼š\nrake install 2.éƒ¨ç½²åˆ° Github Pages #å…ˆåœ¨ github ä¸Šæ–°å»ºä¸€ä¸ªåä¸º username.github.com (username æ›¿æ¢ä¸ºä½ çš„ç”¨æˆ·å) çš„ç‰ˆæœ¬åº“ã€‚ç„¶åæ‰§è¡Œï¼š\nrake setup_github_pages è¿™é‡Œä¼šè¯¢é—®ä½ çš„ Github Pages ç‰ˆæœ¬åº“çš„ URL ï¼Œåº”è¯¥è¾“å…¥ git@github.com:username/username.github.com.git ã€‚è¿™æ¡å‘½ä»¤è¿˜ä¼šåšä»¥ä¸‹å‡ ä»¶äº‹ï¼š\nå°† Github Pages ç‰ˆæœ¬åº“ä½œä¸ºé»˜è®¤çš„ origin remote å°†æ´»åŠ¨åˆ†æ”¯ä» master åˆ‡æ¢åˆ° source æ ¹æ®ç‰ˆæœ¬åº“è®¾ç½®åšå®¢çš„ URL åœ¨ _deploy ç›®å½•ä¸‹è®¾ç½®ä¸€ä¸ª master åˆ†æ”¯ç”¨äºéƒ¨ç½²åšå®¢ã€‚ ç„¶åæ‰§è¡Œï¼š\nrake generate rake deploy ä¼šåœ¨ _deploy ç›®å½•ä¸‹ç”Ÿæˆåšå®¢ï¼Œå¹¶æŠŠè¯¥ç›®å½•ä¸‹çš„æ–‡ä»¶å‘å¸ƒåˆ° github ç‰ˆæœ¬åº“çš„ master åˆ†æ”¯ã€‚ååˆ†é’Ÿä»¥åå°±å¯ä»¥é€šè¿‡ username.github.com è®¿é—®ä½ çš„åšå®¢äº†ã€‚\nOctopress çš„æºæ–‡ä»¶ä¹Ÿåº”è¯¥æäº¤åˆ° github ä¿å­˜ï¼š\ngit add . git commit git push origin source 3.é…ç½® #Octopress çš„é…ç½®æ–‡ä»¶æœ‰å››ä¸ªï¼š\n_config.yml #ä¸»é…ç½®æ–‡ä»¶ï¼ˆjekyllçš„è®¾ç½®ï¼‰ Rakefile #å…³äºéƒ¨ç½²çš„é…ç½® config.rb config.ru é€šå¸¸åªéœ€è¦ä¿®æ”¹ _config.yml å’Œ Rakefile ã€‚\n_config.yml æ–‡ä»¶ä¸­çš„é…ç½®åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š\nMain Configs ä¸»è¦çš„è®¾ç½®æœ‰ï¼š\nurl: # ç”¨äº RSS çš„ URL title: # åšå®¢çš„æ ‡é¢˜ï¼Œä¼šæ˜¾ç¤ºåœ¨åšå®¢å’Œæµè§ˆå™¨æ ‡ç­¾ä¸Šã€‚ subtitle: # åšå®¢çš„å‰¯æ ‡é¢˜ author: # åå­—, ç”¨äº RSS, Copyright, Metadata simple_search: # æœç´ æ æ‰€ç”¨çš„ç½‘å€ description: # é»˜è®¤çš„å…³äºæœ¬ç«™ç‚¹çš„æè¿° date_format: # Format dates using Ruby's date strftime syntax subscribe_rss: # ç”¨äº rss è®¢é˜…çš„ URL, é»˜è®¤ç”¨ /atom.xml subscribe_email: # Url to subscribe by email (service required) category_feeds: # Enable per category RSS feeds (defaults to false in 2.1) email: # Email address for the RSS feed if you want it. Jekyll \u0026amp; Plugin\nç”¨äº Jekyll åŠå…¶æ’ä»¶çš„è®¾ç½®ï¼Œä¸»è¦æœ‰ï¼š\nroot: # ç›¸å¯¹æ ¹ç›®å½•ï¼Œé»˜è®¤æ˜¯ / ï¼Œå¦‚æœåšå®¢è¦å‘å¸ƒåœ¨ä¸€ä¸ªå­ç›®å½•ä¸‹ï¼ˆä¾‹å¦‚ site.com/projectï¼‰ï¼Œè¦è®¾ä¸º /project permalink: # åšå®¢æ–‡ç« çš„å­˜æ”¾ç»“æ„ source: # æºæ–‡ä»¶çš„ç›®å½• destination: # ç”Ÿæˆçš„æ–‡ä»¶å­˜æ”¾çš„ç›®å½• plugins: # Jekyll æ’ä»¶çš„ç›®å½• code_dir: # ä»£ç ç‰‡æ®µæ–‡ä»¶çš„å­˜æ”¾ç›®å½• (ç”¨äº include_code æ’ä»¶) category_dir: # Directory for generated blog category pages pygments: # Toggle python pygments syntax highlighting paginate: # Posts per page on the blog index pagination_dir: # Directory base for pagination URLs eg. /blog/page/2/ recent_posts: # Number of recent posts to appear in the sidebar default_asides: # Configure what shows up in the sidebar and in what order blog_index_asides: # Optional sidebar config for blog index page post_asides: # Optional sidebar config for post layout page_asides: # Optional sidebar config for page layout 3rd Party Setting\nè¿™äº›ç¬¬ä¸‰æ–¹å·¥å…·å·²ç»å®‰è£…ï¼Œåªè¦ç®€å•çš„è®¾ç½®å°±å¯ä»¥ä½¿ç”¨ã€‚\n4.å†™åšå®¢ #å‘è¡¨æ–‡ç« \næ‰€æœ‰è¦å‘è¡¨çš„åšæ–‡éƒ½å­˜æ”¾åœ¨ source/_posts ç›®å½•ä¸‹ï¼Œå¹¶éµå¾ª Jekyll çš„å‘½åæ–¹å¼ï¼šYYYY-MM-DD-post-title.markdown ã€‚å¯ä»¥å°†å†™å¥½çš„æ–‡ç« æŒ‰ç…§è¿™ç§æ–¹å¼å‘½åï¼Œå¹¶åœ¨æ–‡ä»¶ä¸­æ·»åŠ ä¸‹é¢è®²åˆ°çš„å¤´éƒ¨ï¼Œç„¶åå¤åˆ¶åˆ°è¯¥ç›®å½•ä¹ ä¸‹ã€‚ä¹Ÿå¯ä»¥ç”¨ Octopress æä¾›çš„å‘½ä»¤ç”Ÿæˆï¼Œè¯­æ³•å¦‚ä¸‹ï¼š\nrake new_post[\u0026quot;tiltle\u0026quot;] è¿™æ ·ç”Ÿæˆçš„æ–‡ä»¶é»˜è®¤æ˜¯ markdown æ ¼å¼ï¼Œå¯ä»¥åœ¨ Rakefile ä¸­ä¿®æ”¹é»˜è®¤çš„æ ¼å¼ã€‚\næ‰“å¼€æ–‡ä»¶ä¼šå‘ç°æœ‰ä¸€ä¸ªå¤´éƒ¨ï¼Œç±»ä¼¼ï¼š\n--- layout: post title: \u0026quot;tiltle\u0026quot; date: 2012-09-03 15:59 comments: true external-url: categories: --- layout: post è¡¨ç¤ºä½¿ç”¨ source/_layouts/post.html å¸ƒå±€æ–¹å¼ã€‚ comment: true è¡¨ç¤ºå…è®¸è¯„è®ºï¼Œä¹Ÿå¯è®¾ä¸º off å…³é—­è¯„è®ºã€‚å¦‚æœæœ‰å…¶ä»–ä½œè€…ï¼Œå¯ä»¥æ·»åŠ  author: your name ï¼Œé»˜è®¤ä¼šä½¿ç”¨ _config.yml ä¸­çš„è®¾ç½®ã€‚å¦‚æœè¦ä¿å­˜ä¸ºè‰ç¨¿ï¼Œæ·»åŠ  published: false ï¼Œè¿™æ ·åœ¨ç”Ÿæˆåšå®¢æ—¶å°±ä¸ä¼šè¢«å‘è¡¨ã€‚categories ç”¨äºè®¾ç½®æ ‡ç­¾ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªæ ‡ç­¾ï¼Œå¯ä»¥ç”¨å¦‚ä¸‹æ ¼å¼ï¼š\ncategories: Sass å¦‚æœæœ‰å¤šä¸ªæ ‡ç­¾ï¼š\n# Multiple categories example 1 categories: [CSS3, Sass, Media Queries] # Multiple categories example 2 categories: - CSS3 - Sass - Media Queries é»˜è®¤æƒ…å†µä¸‹ï¼Œpost çš„å…¨éƒ¨å†…å®¹å°†æ˜¾ç¤ºåœ¨ index é¡µé¢ã€‚å¯ä»¥åœ¨æ–‡ç« ä¸­æ’å…¥ \u0026lt;!\u0026ndash; more \u0026ndash;\u0026gt; ï¼Œindex é¡µé¢åªä¼šæ˜¾ç¤ºè¯¥æ ‡è®°ä¹‹å‰çš„å†…å®¹ï¼Œç‚¹å‡» â€œContinue-\u0026gt;â€ æŒ‰é’®åä¼šå®Œå…¨æ˜¾ç¤ºã€‚\næ·»åŠ é¡µé¢\nå¯ä»¥åœ¨ source ç›®å½•ä¸‹æ·»åŠ é¡µé¢ï¼Œæ·»åŠ çš„æ–‡ä»¶çš„è·¯å¾„ä¸æœ€ç»ˆç”Ÿæˆçš„åšå®¢çš„ URL æ˜¯ç›´æ¥å¯¹åº”çš„ï¼Œä¾‹å¦‚ about.markdown å°±å¯¹åº” site.com/about.html ã€‚å¦‚æœæƒ³è¦ site.com/about ï¼Œå°±è¦åœ¨ source ä¸‹æ·»åŠ  about/index.markdown ã€‚å¯ä»¥ç”¨ rake å‘½ä»¤æ·»åŠ é¡µé¢ï¼š\nrake new_page[super-awesome] # ç”Ÿæˆ source/super-awesome/index.markdown rake new_page[super-awesome/page.html] # ç”Ÿæˆ source/super-awesome/page.html é»˜è®¤æ·»åŠ çš„æ–‡ä»¶çš„æ ¼å¼æ˜¯ markdown ï¼Œä¹Ÿå¯ä»¥åœ¨ Rakefile ä¸­ä¿®æ”¹ã€‚æ–‡ä»¶çš„å†…å®¹ä¸ post ç±»ä¼¼ï¼š\n--- layout: page title: \u0026quot;Super Awesome\u0026quot; date: 2011-07-03 5:59 comments: true sharing: true footer: true --- ç”Ÿæˆå’Œé¢„è§ˆ\næ‰§è¡Œï¼š\nrake generate åœ¨ _site ç›®å½•ä¸‹ç”Ÿæˆåšå®¢çš„é™æ€é¡µé¢ã€‚\nç„¶åæ‰§è¡Œï¼š\nrake preview # Watches, and mounts a webserver at åœ¨æµè§ˆå™¨ä¸­è®¿é—® http://localhost:4000 å³å¯é¢„è§ˆåšå®¢ã€‚\næœ€åç”¨ rake deploy å‘å¸ƒã€‚\n","date":"2012 September 9","permalink":"/posts/2012/09/09/","section":"Posts","summary":"1.å‡†å¤‡ # å®‰è£… git","title":"ç”¨ Octopress åœ¨ github ä¸Šéƒ¨ç½²åšå®¢"},{"content":"Qt Embedded ç›´æ¥ä¾èµ– Framebufferï¼Œæ— éœ€ X-Windowã€‚æ‰€ä»¥è¦å¼€å¯ Linux ç³»ç»Ÿçš„ Framebuffer ã€‚å¼€å¯æ–¹æ³•æ˜¯é€šè¿‡ BootLoader å‘å†…æ ¸ä¼ é€’å‚æ•°ï¼š\nå¯¹äº grubï¼Œåœ¨ grub.conf æ–‡ä»¶çš„kernel å‘½ä»¤åé¢æ·»åŠ  vga=0x311 fb:on ã€‚ å¯¹äº liloï¼Œåœ¨ lilo.conf æ–‡ä»¶ä¸­æ·»åŠ  vga=0x311ã€‚0x311 è¡¨ç¤ºåˆ†è¾¨ç‡ä¸º 640*480ï¼Œ16dppã€‚ ç¼–è¯‘å®‰è£… #é¦–å…ˆä¸‹è½½ Qt/E-4.4.0 çš„æºç ï¼Œç„¶åè§£å‹åœ¨ root ç›®å½•ï¼š\ncd /root tar -xvjf qt-embedded-linux-opensource-src-4.4.0.tar.bz2 cd qt-embedded-linux-opensource-src-4.4.0 æºç ä¸­åŒ…å«äº†æ–‡æ¡£ã€ä¾‹ç¨‹ã€‚è¿™äº›ä¼šå ç”¨å¾ˆå¤šç©ºé—´å’Œç¼–è¯‘æ—¶é—´ï¼Œå¦‚æœä¸éœ€è¦çš„è¯å°±ä¿®æ”¹ configure ï¼ŒæŠŠå®ƒå»æ‰ï¼š\nQT_DEFAULT_BUILD_PARTS=\u0026quot;libs tools examples demos doc\u0026quot; æ”¹ä¸º QT_DEFAULT_BUILD_PARTS=\u0026quot;libs tools\u0026quot; é€šè¿‡ configure çš„é€‰é¡¹å¯ä»¥å…³é—­å¾ˆå¤šä¸éœ€è¦çš„æ¨¡å—ï¼Œç”¨ ./configure -help æŸ¥çœ‹è¯¦æƒ…ã€‚\né’ˆå¯¹åµŒå…¥å¼ç‰ˆæœ¬ï¼Œè¿˜å¯ä»¥ç”¨ -no-feature-\u0026lt;feature\u0026gt; å…³é—­ç›¸åº”çš„ç‰¹æ€§ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šç¼–è¯‘å…¨éƒ¨çš„ç‰¹æ€§ã€‚å¯ç”¨çš„ feature åœ¨ src/corelib/global/qfeatures.txt æ–‡ä»¶ä¸­æœ‰å®Œæ•´æè¿°ã€‚ä½†æ˜¯è¿™ä¸ªæ–¹æ³•ä¸æ–¹ä¾¿ï¼Œé€šå¸¸æ˜¯é€šè¿‡ -qconfig å‚æ•°æŒ‡å®šä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œåœ¨ src/corelib/global/ ç›®å½•ä¸‹æœ‰å‡ ä¸ªå…¸å‹çš„é…ç½®æ–‡ä»¶ï¼š\nqconfig-large.h #åŒ…å«äº†å¤§å¤šæ•°ç‰¹æ€§ã€‚ qconfig-small.h #å…³é—­äº†å¾ˆå¤šç‰¹æ€§ã€‚ qconfig-minimal.h #æœ€å°é…ç½®ï¼Œå‡ ä¹å…³é—­äº†æ‰€æœ‰ç‰¹æ€§ã€‚ å¯ä»¥æ‰‹åŠ¨ç¼–è¾‘ä¿®æ”¹é…ç½®ã€‚ä½†æ˜¯å„ç§ç‰¹æ€§ä¹‹é—´çš„ä¾èµ–å¾ˆå¤æ‚ï¼Œæ‰€æœ‰Qtæä¾›äº†ä¸€ä¸ªå›¾å½¢å·¥å…· qconfig æ¥å¸®åŠ©ç”Ÿæˆé…ç½®ã€‚è¿™ä¸ªå·¥å…·éœ€è¦ç¼–è¯‘ï¼Œå®‰è£… Qt/E åå†ä»‹ç»ã€‚\næ‰§è¡Œï¼š\n./configure -prefix /usr/qt -release -no-largefile -no-qt3support -no-xmlpatterns -no-phonon -no-svg -no-webkit -no-mmx -no-3dnow -no-sse -no-sse2 -no-gif -no-libtiff -no-libmng -qt-libpng -qt-libjpeg -no-openssl -no-nis -no-cups -no-iconv -no-opengl -no-dbus -qt-freetype -depths 16 -embedded x86 -qt-decoration-default -qt-gfx-linuxfb -qt-kbd-tty -qt-kbd-usb -qt-mouse-pc -qt-mouse-bus -no-glib -qconfig src/corelib/global/qconfig-small.h make make install ç¼–è¯‘å·¥ç¨‹éœ€è¦å‡ ä¸ªå°æ—¶ï¼Œæ‰€æœ‰æ–‡ä»¶éƒ½ä¼šè¢«å®‰è£…åˆ° /usr/qt/ ç›®å½•ä¸‹ã€‚ç°åœ¨é…ç½®ç¯å¢ƒå˜é‡ï¼š åœ¨ /etc/profile æ–‡ä»¶ä¸­æ·»åŠ ï¼š\nPATH=$PATH:/usr/qt/bin åœ¨ /etc/ld.so.conf æ–‡ä»¶ä¸­æ·»åŠ ï¼š\n/usr/qt/lib ç„¶åæ‰§è¡Œ ldconf -v\né‡å¯ç³»ç»Ÿåï¼ŒQt/E å°±å¯ä»¥ä½¿ç”¨äº†ã€‚\næµ‹è¯• #demo.cpp\n#include \u0026lt;QApplication\u0026gt; #include \u0026lt;QPushButton\u0026gt; #include \u0026lt;QFont\u0026gt; #include \u0026lt;QTextCodec\u0026gt; int main(int argc, char *argv[]) { QApplication app(argc, argv); QTextCodec *codec = QTextCodec::codecForName(\u0026quot;GB18030\u0026quot;); QTextCodec::setCodecForLocale(codec); QTextCodec::setCodecForCStrings(codec); QTextCodec::setCodecForTr(codec); QPushButton hello(\u0026quot;Hello ä¸–ç•Œ!\u0026quot;); hello.show(); return app.exec(); } ç¼–è¯‘ï¼š\nqmake -project qmake make ç¼–è¯‘ç”Ÿæˆäº† demo ç¨‹åºï¼Œè¿è¡Œï¼š\n./demo -qws -fn wenquanyi ç”¨qconfigå·¥å…·é…ç½®qconfig-local.hæ–‡ä»¶ #è¿›å…¥qconfigçš„æºç ç›®å½•ç¼–è¯‘ç”Ÿæˆ qconfig ï¼š\ncd tools/qconfig/ qmake make æ‰§è¡Œqconfigï¼š\n./qconfig -qws é¦–æ¬¡æ‰“å¼€æ—¶å¯èƒ½å‡ºç°å¦‚ä¸‹ç•Œé¢ï¼Œéœ€è¦å¯¼å…¥ feature.txt æ–‡ä»¶ï¼š\né€‰æ‹© src/corelib/global/feature.txt æ–‡ä»¶ï¼Œç„¶åç‚¹å‡» Open ï¼Œå°±ä¼šå¯¼å…¥æ‰€æœ‰å¯é…ç½®çš„ç‰¹æ€§ï¼š\nåœ¨å·¦ä¾§çš„æ ‘çŠ¶åˆ—è¡¨ä¸­é€‰æ‹©éœ€è¦ç¼–è¯‘çš„ç‰¹æ€§ï¼Œç„¶åé€šè¿‡ File èœå•çš„ Save As ä¿å­˜ä¸ºqconfig-local.hæ–‡ä»¶å³å¯ã€‚ ä¹Ÿå¯ä»¥é€šè¿‡ File -\u0026gt; Open æ‰“å¼€å·²æœ‰çš„é…ç½®æ–‡ä»¶ï¼Œä¾‹å¦‚ qconfig-small.hï¼Œè¿›è¡Œä¿®æ”¹ã€‚\n","date":"2012 June 1","permalink":"/posts/2012/06/01/","section":"Posts","summary":"Qt Embedded ç›´æ¥ä¾èµ– Framebufferï¼Œæ— éœ€ X-Windowã€‚æ‰€ä»¥è¦å¼€å¯ Linux ç³»ç»Ÿçš„ Framebuffer ã€‚å¼€å¯æ–¹æ³•æ˜¯é€šè¿‡ BootLoader å‘å†…æ ¸ä¼ é€’å‚æ•°ï¼š","title":"åœ¨ Redhat9 æ–‡æœ¬ç³»ç»Ÿä¸Šå®‰è£… Qt/E 4.4.0"},{"content":"åŸæ–‡ï¼š\nThe Vim/Cscope tutorial\nhttp://cscope.sourceforge.net/cscope_vim_tutorial.html\nTranslated by Bob\n2012-4-27\nEmailï¼š gexbob@gmail.com\nBlogï¼šhttp://shaocheng.li\nCscope æ˜¯ä¸€ä¸ªéå¸¸æ–¹ä¾¿çš„å·¥å…·, å®ƒä¼šä¸ºä½ çš„ç¼–è¾‘å™¨ï¼ˆå³ Vim ï¼‰å¸¦æ¥å¾ˆå¥½çš„èˆ’é€‚æ€§. å¹¸è¿çš„æ˜¯, Cscope å·²ç»è¢« Vim åœ¨å†…éƒ¨é›†æˆ.\nè¿™ä¸ªæ•™ç¨‹å‘ä½ ä»‹ç»äº† Vim å†…å»ºçš„ Cscope æ”¯æŒï¼Œä»¥åŠä¸€å¥—è®©æœç´¢æ›´æ–¹ä¾¿çš„æ–¹æ³•.\nå‡è®¾ä½ çŸ¥é“ä½¿ç”¨ vi é£æ ¼ç¼–è¾‘å™¨çš„åŸºæœ¬çŸ¥è¯†, ä½†æ˜¯ä¸éœ€è¦ä»»ä½•å…³äºVimçš„ç‰¹å®šçŸ¥è¯† (ä¼šç®€å•ä»‹ç»ä¸€äº›ç”¨å¾—åˆ°çš„ Vim ç‰¹æœ‰åŠŸèƒ½â€”â€”å¦‚å¤šçª—å£). ä½ ä¹Ÿæ— éœ€çŸ¥é“ä»»ä½•å…³äºCscopeçš„çŸ¥è¯†: æˆ‘ä»¬ä¼šé€æ­¥ä»‹ç»ä¸€äº›åŸºæœ¬çš„ä¸œè¥¿.\nç®€è€Œè¨€ä¹‹ï¼ŒVim çš„ Cscope æ”¯æŒå¾ˆåƒä½ ç”¨è¿‡çš„ Vim çš„ ctags åŠŸèƒ½ã€‚ä½†æ˜¯å› ä¸º Cscope çš„æœç´¢ç±»å‹æ¯” ctags æ›´å¤šï¼Œæ‰€ä»¥ä¼šæœ‰äº›ä¸åŒã€‚\nè¿™æ˜¯ä¸€ä¸ªå®è·µæ•™ç¨‹, æ‰€ä»¥è¦å¯åŠ¨ä¸€ä¸ª shell , ç„¶åè·Ÿç€ä¸‹é¢çš„æ­¥éª¤åš:\nå¦‚æœä½ çš„ç”µè„‘è¿˜æ²¡æœ‰Cscopeï¼Œå…ˆä¸‹è½½å¹¶å®‰è£…ã€‚ç†æƒ³çŠ¶æ€ä¸‹, ä½ çš„ Vim åº”è¯¥æ˜¯ 6.x ç‰ˆæœ¬, ä½†æ˜¯ç”¨ Vim 5 ä»¥ä¸Šçš„ç‰ˆæœ¬éƒ½å¯ä»¥è·å¾—å¤§éƒ¨åˆ†åŠŸèƒ½ (æ— æ³•ä½¿ç”¨å‚ç›´åˆ†å‰², ä½†æ˜¯é€šè¿‡ä¿®æ”¹ç›¸å…³æ–‡ä»¶å¯ä»¥ä½¿ç”¨æ°´å¹³åˆ†å‰²).\næ³¨æ„: å¦‚æœä½ çš„ Vim ç‰ˆæœ¬åœ¨ç¼–è¯‘æ—¶æ²¡æœ‰æŒ‡å®š \u0026lsquo;\u0026ndash;enable-cscope\u0026rsquo; é€‰é¡¹, ä½ éœ€è¦é‡æ–°ç¼–è¯‘å’Œé…ç½® Vim ã€‚ å¤§éƒ¨åˆ†éš Linux å‘è¡Œç‰ˆå®‰è£…çš„ Vim äºŒè¿›åˆ¶æ–‡ä»¶éƒ½ä½¿èƒ½äº† Cscope æ’ä»¶ã€‚\nä¸‹è½½ cscope_maps.vim æ–‡ä»¶, è®© Vim åœ¨å¯åŠ¨æ—¶è¯»å–å®ƒ. å¦‚æœä½ ç”¨çš„æ˜¯ Vim 6.x, æŠŠå®ƒå¤åˆ¶åˆ° $HOME/.vim/plugin ç›®å½•ä¸‹å³å¯ (æˆ–è€…å…¶ä»–æ’ä»¶å­ç›®å½•). å¦‚æœä½ ç”¨çš„æ˜¯ Vim 5.x, åªèƒ½æŠŠ cscope_maps æ–‡ä»¶çš„å†…å®¹å¤åˆ¶åˆ° $HOME/.vimrc æ–‡ä»¶ä¸­, æˆ–è€…é»è´´ \u0026ldquo;source cscope_maps.vim\u0026rdquo; ä¸€è¡Œåˆ° .vimrc æ–‡ä»¶.\nè¿›å…¥ä¸€ä¸ªæœ‰Cä»£ç æ–‡ä»¶çš„ç›®å½•, æ‰§è¡Œ \u0026lsquo;cscope -R\u0026rsquo; ( \u0026lsquo;-R\u0026rsquo; ä¼šè®© Cscope éå†æ‰€æœ‰å­ç›®å½•, å¦åˆ™åªä¼šæ£€æµ‹å½“å‰ç›®å½•). ç”±äºæ²¡æœ‰ä½¿ç”¨ \u0026lsquo;-b\u0026rsquo; é€‰é¡¹ (å®ƒå‘Šè¯‰ Cscope åªå»ºç«‹æ•°æ®åº“åå°±é€€å‡º), Cscope ä¼šæ‰“å¼€ä¸€ä¸ªåŸºäº curses çš„ GUI ç•Œé¢. åœ¨è¿™é‡Œå°è¯•ä¸€äº›æœç´¢ (æç¤º: ä½¿ç”¨æ–¹å‘é”®å¯ä»¥åœ¨æœç´¢ç±»å‹ä¹‹é—´ç§»åŠ¨, ç”¨ \u0026rsquo;tab\u0026rsquo; é”®æ¥åœ¨æœç´¢ç±»å‹å’Œæœç´¢ç»“æœä¹‹é—´åšå‡ºé€‰æ‹©). åœ¨æœç´¢ç»“æœçš„å·¦è¾¹æ•²å…¥æ•°å­—, Cscope å°±ä¼šåœ¨ Vim ä¸­æ‰“å¼€å®ƒçš„ä½ç½®. (é™¤éä½ æŠŠ EDITOR ç¯å¢ƒå˜é‡è®¾ä¸ºäº† Vim ä¹‹å¤–çš„ä¸œè¥¿). å…³é—­ Vim, å°±ä¼šè¿”å›åˆ°ç¦»å¼€ Cscope GUI æ—¶çš„ä½ç½®. æœ‰è¶£ã€‚\nCscope æ¥å£æœ‰ä¸ªå¤§é—®é¢˜ï¼› æ¯æ¬¡è¦æ‰§è¡Œæ–°çš„æœç´¢æ—¶éƒ½è¦å…³é—­ Vim. è¿™å°±æ˜¯ Vim æ’ä»¶. ç”¨ CTRL-D å…³é—­ Cscope.\nå¯åŠ¨ Vim. å¦‚æœä½ æ„¿æ„, å¯ä»¥åœ¨å¯åŠ¨æ—¶å¸¦ä¸€ä¸ªCè¯­è¨€çš„æ ‡è¯†ç¬¦ (å…¥: \u0026lsquo;vim -t main\u0026rsquo;), ç„¶åå°±ä¼šè·³åˆ°ä»£ç ä¸­è¯¥æ ‡è¯†ç¬¦å®šä¹‰çš„åœ°æ–¹.\næŠŠå…‰æ ‡ç§»åˆ°ä¸€ä¸ªåœ¨ç¨‹åºä¸­å¤šæ¬¡ä½¿ç”¨çš„æ ‡è¯†ç¬¦ä¸Š. é”®å…¥ \u0026ldquo;CTRL-\\ s\u0026rdquo; (å…ˆæ•²CTRL-, ç„¶åæ•² \u0026rsquo;s\u0026rsquo;) , åº”è¯¥ä¼šåœ¨ Vim çª—å£çš„åº•éƒ¨çœ‹åˆ°ä¸€ä¸ªèœå•ï¼Œæ˜¾ç¤ºäº†ç¨‹åºä¸­æ‰€æœ‰ç”¨åˆ°è¿™ä¸ªæ ‡è¯†ç¬¦çš„åœ°æ–¹. é€‰æ‹©å…¶ä¸­çš„ä¸€ä¸ªç„¶åç‚¹å›è½¦, å°±ä¼šè·³åˆ°é‚£é‡Œ. ç±»ä¼¼ ctags, å¯ä»¥ç‚¹å‡» \u0026ldquo;CTRL-t\u0026rdquo; è°ƒå›æœç´¢ä¹‹å‰çš„ä½ç½® (ä¹Ÿå¯ä»¥å¤šæœç´¢å‡ ä¸ªï¼Œç„¶åç”¨ CTRL-t ä¾æ¬¡é‡Šæ”¾).\nåŠ©è®°ç¬¦: \u0026lsquo;'é”®åœ¨\u0026rsquo;]\u0026lsquo;é”®çš„å³è¾¹, ç”¨äº ctags æœç´¢.\nå°è¯•åŒæ ·çš„æœç´¢, ä½†æ˜¯è¿™æ¬¡ç”¨ \u0026ldquo;CTRL-spacebar s\u0026rdquo; ç»„åˆé”®. è¿™ä¸€æ¬¡ï¼ŒVim çª—å£ä¼šæ°´å¹³åˆ†å‰²ä¸ºä¸¤ä¸ª, Cscope çš„æœç´¢ç»“æœå°†åœ¨æ–°çš„çª—å£ä¸Šæ˜¾ç¤º.[å¦‚æœä½ ä»æ¥æ²¡ç”¨è¿‡ Vim çš„å¤šçª—å£: ç”¨ \u0026lsquo;CTRL-W w\u0026rsquo; (æˆ– CTRL-W å’Œæ–¹å‘é”®, æˆ– CTRL-W å’Œ h/j/k/l )åœ¨çª—å£ä¹‹é—´ç§»åŠ¨, ç”¨ \u0026lsquo;CTRL-W c\u0026rsquo; (æˆ– \u0026lsquo;:q\u0026rsquo;)å…³é—­ä¸€ä¸ªçª—å£, ç”¨ \u0026lsquo;CTRL-W o\u0026rsquo;åªæ˜¾ç¤ºå½“å‰çª—å£, ç”¨ \u0026lsquo;CTRL-W s\u0026rsquo; (æˆ– \u0026lsquo;CTRL-W v\u0026rsquo; å‚ç›´åˆ†å‰²)å°†çª—å£åˆ†å‰²ä¸ºä¸¤ä¸ª, ç”¨ \u0026lsquo;:spl[it] filename]\u0026rsquo; åœ¨åˆ†å‰²çš„æ–°çª—å£æ‰“å¼€æ–‡ä»¶ã€‚\nMnemonic: åœ¨ä¸¤ä¸ªåˆ†å‰²çš„çª—å£ä¹‹é—´ä¼šæœ‰ä¸€æ¡ç©ºç™½çš„é—´éš”.\nç°åœ¨ç”¨ \u0026ldquo;CTRL-spacebar CTRL-spacebar s\u0026rdquo;(åªéœ€æŒ‰ä½CTRLè¿æŒ‰ä¸¤æ¬¡ç©ºæ ¼)è¿›è¡ŒåŒæ ·çš„æœç´¢. å¦‚æœä½ æ— æ³•å¿«é€Ÿçš„æŒ‰é”®, å°±æ‰“å¼€ cscope_maps.vim è„šæœ¬ï¼Œå°† Vim çš„è¶…æ—¶è®¾ç½®æ”¹ä¸ºæ³¨é‡Š [äº‹å®ä¸Šï¼Œæˆ‘é€šå¸¸å…³é—­ Vim çš„è¶…æ—¶]. è¿™ä¸€æ¬¡ Vim çš„çª—å£ä¼šè¢«å‚ç›´åˆ†å‰² (æ³¨æ„: åœ¨ Vim 5.x ä¸Šæ˜¯æ— æ³•å®ç°çš„).\nåˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬åªç”¨åˆ°äº†\u0026rsquo;cscope_maps.vim\u0026rsquo;çš„çƒ­é”®,æ‰€æœ‰çš„æœç´¢éƒ½ä¸ Vim ä¸­çš„å…‰æ ‡æœ‰å…³. Cscope æœç´¢æœ‰ä¸€ä¸ªè€åŠæ³• (ç”¨ Vim çš„å†…å»º Cscope), ç”¨ \u0026ldquo;:cscope find symbol foo\u0026quot;å‘½ä»¤ (æˆ–è€…ç®€å•ç‚¹ï¼Œ\u0026quot;:cs f s foo\u0026rdquo;). å¯¹äºå¯æ°´å¹³åˆ†å‰²çš„ç‰ˆæœ¬,å¯ä»¥ç”¨\u0026quot;:scscope\u0026quot; (æˆ–\u0026quot;:scs\u0026quot;) . å¦‚æœè¦æœç´¢çš„è¯å°±åœ¨å…‰æ ‡ä¸‹ï¼Œç”¨çƒ­é”®æ›´ç®€å•, å‘½ä»¤è¡Œçš„æ–¹å¼å¯ä»¥è®©ä½ æœç´¢ä»»ä½•æ ‡è¯†ç¬¦ï¼Œæ‰€ä»¥è¦æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©.\nåˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬åªç”¨äº†ä¸€ç§æœç´¢æ–¹æ³•ï¼šâ€˜s\u0026rsquo;ï¼ŒæŸ¥æ‰¾æ ‡è¯†ç¬¦çš„ä½¿ç”¨æƒ…å†µã€‚è¯•ä¸€ä¸‹ Cscope çš„å…¶ä»–ç”¨æ³•: \u0026lsquo;g\u0026rsquo; ï¼ŒæŸ¥æ‰¾å…¨å±€å®šä¹‰çš„æ ‡è¯†ç¬¦ï¼›\u0026lsquo;c\u0026rsquo;ï¼ŒæŸ¥æ‰¾ä¸€ä¸ªå‡½æ•°çš„æ‰€æœ‰è°ƒç”¨ï¼›\u0026lsquo;f\u0026rsquo; æ‰“å¼€å…‰æ ‡æ‰€æŒ‡çš„æ–‡ä»¶å (æ³¨æ„: å› ä¸º Cscope é»˜è®¤ä» /usr/include æŸ¥æ‰¾å¤´æ–‡ä»¶, å¯ä»¥ç”¨è¿™ä¸ªåŠŸèƒ½æ‰“å¼€å¤§éƒ¨åˆ†æ ‡å‡†å¤´æ–‡ä»¶). è¿™äº›éƒ½æ˜¯æˆ‘æœ€å¸¸ç”¨çš„, ä½†æ˜¯è¿˜æœ‰å…¶ä»–çš„ (åœ¨ cscope_maps.vim æ–‡ä»¶å¯ä»¥æ‰¾åˆ°æ‰€æœ‰çš„ç”¨æ³•ï¼Œä¹Ÿå¯ä»¥çœ‹ Cscope çš„ man æ‰‹å†Œ).\nè™½ç„¶ Cscope æœ€åˆåªæ”¯æŒ C è¯­è¨€, å®é™…ä¸Šå®ƒæ˜¯ä¸ªéå¸¸çµæ´»çš„å·¥å…·ï¼Œå¯ä»¥æ”¯æŒç±»ä¼¼ C++ å’Œ Java è¿™æ ·çš„è¯­è¨€. ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªé€šç”¨çš„\u0026rsquo;grep\u0026rsquo;æ•°æ®åº“, å®ƒçš„ä½œç”¨æ˜¯åˆ†æå‡½æ•°è°ƒç”¨å’Œå˜é‡å®šä¹‰ç­‰ç±»ä¼¼çš„ç»“æ„. Cscope é»˜è®¤åªèƒ½è§£æå½“å‰ç›®å½•(ç”¨â€˜-Râ€™é€‰é¡¹å¯ä»¥åŒ…æ‹¬å­ç›®å½•)ä¸‹çš„ C, lex, å’Œ yacc æ–‡ä»¶ (.c, .h, .l, .y) , ç›®å‰è¿˜æ— æ³•ä¿®æ”¹æ–‡ä»¶æ‰©å±•åˆ—è¡¨ (æˆ‘ä»¬åº”è¯¥æ”¹å˜è¿™ä¸ªç°çŠ¶). æ‰€ä»¥ä½ å¿…é¡»åšä¸€ä¸ªè¦è§£æçš„æ–‡ä»¶åˆ—è¡¨, å‘½åä¸º\u0026rsquo;cscope.files\u0026rsquo;(å¦‚æœç”¨ \u0026lsquo;cscope -i foofile\u0026rsquo;å‘½ä»¤ï¼Œå°±å¯ä»¥éšæ„å‘½å). æœ‰ä¸€ä¸ªç®€å•ï¼ˆè€Œä¸”ååˆ†çµæ´»ï¼‰çš„æ–¹æ³•æ˜¯é€šè¿‡ Unix çš„\u0026rsquo;find\u0026rsquo;å‘½ä»¤:\nfind . -name '*.java' \u0026gt; cscope.files ç„¶åæ‰§è¡Œ \u0026lsquo;cscope -b\u0026rsquo; é‡æ–°æ„å»ºæ•°æ®åº“(â€˜-bâ€™ä¼šè®© Cscope åªæ„å»ºæ•°æ®åº“è€Œä¸å¯åŠ¨ GUI), ä½ å°±å¯ä»¥æµè§ˆ Java æ–‡ä»¶ä¸­çš„æ‰€æœ‰æ ‡è¯†ç¬¦. å¾ˆå¤šäººç”¨ Cscope æ¥æµè§ˆå’Œç¼–è¾‘å¤§é‡çš„æ–‡æ¡£æ–‡ä»¶, è¯´æ˜ Cscope è§£æå™¨æ˜¯éå¸¸çµæ´»çš„ã€‚\nå¯¹äºå¤§çš„é¡¹ç›®,ä½ å¯èƒ½éœ€è¦ç”¨ -q é€‰é¡¹, å¹¶ä¸”ä½¿ç”¨æ›´å¤æ‚çš„ \u0026lsquo;find\u0026rsquo; å‘½ä»¤. åœ¨ tutorial on using Cscope with large projects å¯ä»¥å¾—åˆ°æ›´å¤šä¿¡æ¯.\nå°è¯•é€šè¿‡è®¾ç½® $CSCOPE_DB ç¯å¢ƒå˜é‡æ¥æŒ‡å®šä¸€ä¸ªä½ åˆ›å»ºçš„ Cscope æ•°æ®åº“, è¿™æ ·å°±ä¸ç”¨æ€»æ˜¯åœ¨æ•°æ®åº“çš„ç›®å½•ä¸‹å¯åŠ¨ Vim. è¿™ç§ç”¨æ³•å¤šç”¨äºä»£ç åˆ†åˆ«æ”¾åœ¨å¤šä¸ªå­ç›®å½•çš„é¡¹ç›®ã€‚æ³¨æ„: è¿™ç§æƒ…å†µä¸‹, åº”è¯¥ç”¨ç»å¯¹è·¯å¾„æ¥æ„å»ºæ•°æ®åº“: cd to / ,ç„¶åï¼š\nfind /my/project/dir -name '*.c' -o -name '*.h' \u0026gt; /foo/cscope.files ç„¶ååœ¨ cscope.files çš„ç›®å½•ä¸‹è¿è¡Œ Cscope (æˆ–è€…ç”¨ \u0026lsquo;cscope -i /foo/cscope.files\u0026rsquo;), ç„¶åè®¾ç½®å¹¶åˆ°å¤„ $CSCOPE_DB å˜é‡, è®©å®ƒæŒ‡å‘ cscope.out æ–‡ä»¶):\ncd /foo cscope -b CSCOPE_DB=/foo/cscope.out; export CSCOPE_DB (ä¸Šé¢æœ€åä¸€æ¡å‘½ä»¤æ˜¯é’ˆå¯¹ Bourne/Korn/Bash çš„: æˆ‘å·²ç»å¿˜äº†åœ¨åŸºäº csh çš„ shell ä¸­å¦‚ä½•å¯¼å‡ºå˜é‡, å› ä¸ºæˆ‘ä¸å–œæ¬¢å®ƒ).\nç°åœ¨åº”è¯¥å¯ä»¥åœ¨ä»»ä½•ç›®å½•ä¸‹è¿è¡Œ \u0026lsquo;vim -t foo\u0026rsquo; ï¼Œå¹¶ä¸”ä¼šå‡†ç¡®çš„è·³åˆ°å®šä¹‰ \u0026lsquo;foo\u0026rsquo; çš„åœ°æ–¹. æˆ‘é€šå¸¸ä¼šä¸ºä¸åŒçš„é¡¹ç›®å†™ä¸€ä¸ªå°çš„ shell è„šæœ¬ (ä»…ç”¨äºå®šä¹‰å’Œå¯¼å‡º CSCOPE_DB) , ä»¥ååªéœ€ç”¨ä¸€ä¸ª \u0026lsquo;source projectA\u0026rsquo; å‘½ä»¤æ¥é€‰æ‹©å®ƒä»¬.\nBUG: åœ¨ Cscope V15.4 ä¹‹å‰çš„ç‰ˆæœ¬, æœ‰ä¸€ä¸ªæ„šè ¢çš„Bugï¼Œå½“æ‰§è¡Œä¸Šé¢çš„å‘½ä»¤æ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´Vim åœæ­¢å·¥ä½œï¼Œé™¤éä½ è°ƒç”¨ä½ çš„æ•°æ®åº“æ˜¯ä¸ç”¨é»˜è®¤çš„â€˜cscope.out\u0026rsquo;ï¼šç”¨â€™-f foo\u0026rsquo;å‘½åä¸ºâ€˜foo.out\u0026rsquo;ã€‚\nå°±æ˜¯è¿™æ ·ï¼å¦‚æœæœ‰ä»€ä¹ˆé—®é¢˜çš„è¯å°±ç”¨\u0026quot;:help cscope\u0026quot; (Vim) æˆ– \u0026ldquo;man cscope\u0026rdquo; (æ ¹æ®ä½ çš„ shell) , è¿˜å¯ä»¥å­¦ä¹ ç»†å¾®ä¹‹å¤„.\nCscope support added to Vim by Andy Kahn\nTutorial and cscope_maps.vim by Jason Duell\nCscope art by Petr Sorfa\n","date":"2012 April 29","permalink":"/posts/2012/04/29/","section":"Posts","summary":"åŸæ–‡ï¼š","title":"Vim/Cscope æ•™ç¨‹"},{"content":"åŸæ–‡ï¼š\nUsing Cscope on large projects (example: the Linux kernel)\nhttp://cscope.sourceforge.net/large_projects.html\nTranslated by Bob\n2012-4-28\nEmailï¼š gexbob@gmail.com\nBlogï¼šhttp://shaocheng.li\nå¦‚æœä½ è¦æ¶‰åŠä¸€ä¸ªå¤§çš„ä»£ç åº“ï¼ŒCscope ä¼šæ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„å·¥å…·. å®ƒå¯ä»¥é€šè¿‡å¿«é€Ÿã€æœ‰ç›®çš„çš„æœç´¢ä¸ºä½ èŠ‚çœå¾ˆå¤šæ—¶é—´ï¼Œè€Œä¸æ˜¯åƒ grep é‚£æ ·éšæœºçš„å¯¹æºæ–‡ä»¶æ‰‹åŠ¨æœç´¢(å¯¹äºå¤§çš„ä»£ç åº“ï¼Œgrep éœ€è¦ä¸€æ®µæ—¶é—´æ‰èƒ½å¯åŠ¨).\nåœ¨è¿™ä¸ªæ•™ç¨‹ä¸­ï¼Œä½ å°†å­¦ä¼šå¦‚ä½•é’ˆå¯¹ä¸€ä¸ªå¤§é¡¹ç›®æ¥è®¾ç½® Cscope. æˆ‘ä»¬ç”¨åˆ°çš„ä¾‹å­æ˜¯ Linux å†…æ ¸æºä»£ç , åŸºæœ¬çš„æ­¥éª¤å’Œå…¶ä»–å¤§é¡¹ç›®æ˜¯ä¸€æ ·çš„, åŒ…æ‹¬ C++ å’Œ JAVA é¡¹ç›®.\n1.è·å–æºä»£ç . é¦–å…ˆè¦è·å–æºä»£ç . å¯ä»¥ä» http://www.kernel.org ä¸‹è½½å†…æ ¸æºä»£ç . æœ¬æ•™ç¨‹ä¸­å‡è®¾ä½ ä¸‹è½½çš„æ˜¯ Linux 2.4.18 å¹¶ä¸”å®‰è£…åœ¨ /home/jru/linux-2.4.18.\næ³¨æ„: ç¡®ä¿ä½ æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´: å†…æ ¸å‹ç¼©åŒ…åªæœ‰ 30 MB, è§£å‹åä¼šçš„æºä»£ç æ˜¯ 150 MB , ç”Ÿæˆçš„ Cscope æ•°æ®åº“ä¼šå ç”¨é¢å¤–çš„ 20-100+ MB (è¿™å–å†³äºä½ æƒ³è¦æ•°æ®åº“åŒ…å«å¤šå°‘å†…æ ¸ä»£ç ). æœ‰å¿…è¦çš„è¯ï¼Œå¯ä»¥æŠŠæºä»£ç å’Œ Cscope æ•°æ®åº“æ”¾åœ¨ä¸¤ä¸ªä¸åŒçš„ç£ç›˜åˆ†åŒº .\n2.å¼„æ¸…æ¥šä½ æƒ³è¦æŠŠ Cscope æ•°æ®åº“æ–‡ä»¶æ”¾åœ¨å“ªé‡Œ. æˆ‘å‡è®¾ä½ ä¼šåœ¨ /home/jru/cscope å­˜æ”¾æ•°æ®åº“å’Œå…³è”æ–‡ä»¶.\n3.ç”Ÿæˆä¸€ä¸ªå¸¦æœ‰æµè§ˆæ–‡ä»¶åˆ—è¡¨çš„ cscope.files . å¯¹äºæŸäº›é¡¹ç›®, ä½ å¯èƒ½æƒ³è¦åœ¨ Cscope æ•°æ®åº“ä¸­åŒ…å«é¡¹ç›®ç›®å½•ä¸­çš„æ‰€æœ‰ C æºæ–‡ä»¶. è¿™ç§æƒ…å†µä¸‹å¯ä»¥è·³è¿‡è¿™ä¸€æ­¥, åªéœ€åœ¨é¡¹ç›®çš„é¡¶å±‚ç›®å½•ä¸Šæ‰§è¡Œ \u0026lsquo;cscope -R\u0026rsquo; æ¥æ„å»ºä½ çš„ Cscope æ•°æ®åº“. ä½†æ˜¯å¦‚æœæœ‰äº›ä»£ç ä½ ä¸æƒ³åŒ…å«, æˆ–è€…ä½ çš„é¡¹ç›®åŒ…å« C++ æˆ– JAVA æºä»£ç  (Cscope é»˜è®¤åªèƒ½è§£æ .c, .h, .y, æˆ– .l æ–‡ä»¶), å°±è¦ç”Ÿæˆä¸€ä¸ª cscope.files æ–‡ä»¶, å…¶ä¸­åŒ…å«äº†æƒ³è¦ Cscope æ‰«æçš„æ‰€æœ‰æ–‡ä»¶å (æ¯ä¸ªæ–‡ä»¶åå ä¸€è¡Œ).\nä½ æœ‰å¯èƒ½ç”¨åˆ°ç»å¯¹è·¯å¾„ (è‡³å°‘åœ¨ç¼–è¾‘å™¨é‡Œä½¿ç”¨ Cscope æ•°æ®åº“æ—¶éœ€è¦), è¿™æ ·å°±å¯ä»¥åœ¨ä½ åˆ›å»ºçš„ç›®å½•ä¹‹å¤–ä½¿ç”¨æ•°æ®åº“. æˆ‘å±•ç¤ºçš„å‘½ä»¤ä¼šå…ˆè¿›å…¥æ ¹ç›®å½•, è¿™æ ·å°±å¯ä»¥ç”¨ find æ‰“å°å‡ºç»å¯¹è·¯å¾„.\nå¯¹äºå¾ˆå¤šé¡¹ç›®, find å‘½ä»¤å¯ä»¥è¿™æ ·ç”¨:\ncd / find /my/project/dir -name '*.java' \u0026gt;/my/cscope/dir/cscope.files å¯¹äº Linux å†…æ ¸, å°±æœ‰ç‚¹æ£˜æ‰‹, å› ä¸ºæˆ‘ä»¬æƒ³è¦æ’é™¤æ–‡æ¡£å’Œè„šæœ¬ç›®å½•ä¸‹çš„ä»£ç , è¿˜æœ‰é™¤ Intel x86 å¤–çš„æ‰€æœ‰èŠ¯ç‰‡å’Œä½“ç³»ç»“æ„çš„æ±‡ç¼–ä»£ç (æˆ‘æƒ³ä½ çš„ä½“ç³»ç»“æ„æ˜¯ X86). å¦å¤–, æœ¬ä¾‹ä¸­æˆ‘ä¼šæ’é™¤æ‰€æœ‰çš„å†…æ ¸é©±åŠ¨ä»£ç  (è¿™äº›ä»£ç è¶…è¿‡è¦è§£æçš„ä»£ç æ€»é‡çš„ä¸¤å€, ä¼šå¯¼è‡´ Cscope æ•°æ®åº“è†¨èƒ€, å¹¶ä¸”åŒ…å«äº†å¾ˆå¤šé‡å¤çš„å®šä¹‰, é€šå¸¸æ›´éš¾æœç´ . å¦‚æœä½ å¯¹é©±åŠ¨ä»£ç æ„Ÿå…´è¶£, å¯ä»¥çœç•¥ä¸‹é¢ç›¸å…³çš„è¡Œ, æˆ–è€…ä¿®æ”¹ä¸ºåªè¾“å‡ºä½ æ„Ÿå…´è¶£çš„é©±åŠ¨æ–‡ä»¶):\nLNX=/home/jru/linux-2.4.18 cd / find $LNX \\ -path \u0026quot;$LNX/arch/*\u0026quot; ! -path \u0026quot;$LNX/arch/i386*\u0026quot; -prune -o \\ -path \u0026quot;$LNX/include/asm-*\u0026quot; ! -path \u0026quot;$LNX/include/asm-i386*\u0026quot; -prune -o \\ -path \u0026quot;$LNX/tmp*\u0026quot; -prune -o \\ -path \u0026quot;$LNX/Documentation*\u0026quot; -prune -o \\ -path \u0026quot;$LNX/scripts*\u0026quot; -prune -o \\ -path \u0026quot;$LNX/drivers*\u0026quot; -prune -o \\ -name \u0026quot;*.[chxsS]\u0026quot; -print \u0026gt;/home/jru/cscope/cscope.files è¿™é‡Œç”¨åˆ°äº† find å‘½ä»¤, åœ¨å¤§é¡¹ç›®ä¸­ï¼Œè¿™æ ·åšæ¯”æ‰‹åŠ¨ç¼–è¾‘ä¸€ä¸ªæ–‡ä»¶åˆ—è¡¨å®¹æ˜“å¤šäº†, ä¹Ÿå¯ä»¥ä»å…¶ä»–åœ°æ–¹å¤åˆ¶ä¸€ä¸ª.\n4.ç”Ÿæˆ Cscope æ•°æ®åº“. åˆ°äº†ç”Ÿæˆ Cscope æ•°æ®åº“çš„æ—¶å€™äº†:\ncd /home/jru/cscope # the directory with 'cscope.files' cscope -b -q -k -b é€‰é¡¹å‘Šè¯‰ Cscope åªè¦æ„å»ºæ•°æ®åº“ï¼Œæ— éœ€å¯åŠ¨ Cscope GUI. -q ä¼šå¯¼è‡´ä¸€ä¸ªé¢å¤–çš„\u0026rsquo;inverted index\u0026rsquo; æ–‡ä»¶è¢«åˆ›å»º, å®ƒä¼šä½¿å¤§æ•°æ®åº“çš„æœç´¢æ›´å¿«. æœ€å, -k è®¾ç½® Cscope ä¸º \u0026lsquo;kernel\u0026rsquo; æ¨¡å¼â€”â€”è¿™æ ·å®ƒå°±ä¸ä¼šå» /usr/include ä¸‹æœç´¢æºæ–‡ä»¶ä¸­åŒ…å«çš„å¤´æ–‡ä»¶ (è¿™æ˜¯åœ¨æ“ä½œç³»ç»Ÿæˆ– C æºç åº“ä¸­ä½¿ç”¨ Cscope æ—¶çš„ä¸»è¦ä½œç”¨).\nåœ¨æˆ‘çš„ 900 MHz Pentium III ç³»ç»Ÿä¸Š (å¸¦ä¸€ä¸ªæ ‡å‡†çš„ IDE ç¡¬ç›˜), è§£æè¿™æ ·çš„ Linux æºç åªç”¨äº† 12 ç§’, è¾“å‡ºçš„ 3 ä¸ªæ–‡ä»¶ (cscope.out, cscope.in.out, å’Œ cscope.po.out) æ€»å…±å ç”¨äº† 25 MB.\n5.ä½¿ç”¨æ•°æ®åº“. å¦‚æœä½ å–œæ¬¢ç”¨ vim æˆ– emacs/xemacs, æˆ‘å»ºè®®ä½ å…ˆå­¦ä¹ æ€æ ·åœ¨è¿™äº›ç¼–è¾‘å™¨ä¸­ä½¿ç”¨ Cscope, è¿™æ ·æ‰èƒ½è®©ä½ åœ¨ç¼–è¾‘å™¨ä¸­è½»æ¾çš„è¿è¡Œæœç´¢. æˆ‘ä»¬æœ‰ä¸€ä»½ tutorial for Vim, emacs ç”¨æˆ·å½“ç„¶æ˜¯è¶³å¤Ÿèªæ˜çš„ï¼Œå¯ä»¥æ ¹æ® cscope/contrib/xcscope ç›®å½•ä¸‹çš„å®è´µæ„è§æ¥è§£å†³æ‰€æœ‰é—®é¢˜.\nå¦åˆ™, ä½ å¯ä»¥ç”¨ç‹¬ç«‹çš„åŸºäº curses çš„ Cscope GUI æ¥è¿è¡Œæœç´¢, ç„¶åå¯åŠ¨ä½ å–œæ¬¢çš„ç¼–è¾‘å™¨(æ— è®º $EDITOR è®¾ä¸ºä»€ä¹ˆ,æˆ–é»˜è®¤æ˜¯vi) æ¥æ‰“å¼€æœç´¢ç»“æœä¸­çš„è¡Œ.\nå¦‚æœä½ ç”¨ç‹¬ç«‹çš„ Cscope æµè§ˆå™¨, ç¡®ä¿è¿™æ ·è°ƒç”¨å®ƒ:\ncscope -d è¿™æ · Cscope å°±ä¸ä¼šé‡æ–°ç”Ÿæˆæ•°æ®åº“. å¦åˆ™ä½ å°±ä¸å¾—ä¸ Cscope æ£€æµ‹ä¿®æ”¹è¿‡çš„æ–‡ä»¶, åœ¨å¤§é¡¹ç›®ä¸­ä¼šèŠ±å¾ˆå¤šæ—¶é—´, å³ä½¿æ²¡æœ‰æ–‡ä»¶è¢«ä¿®æ”¹è¿‡. å¦‚æœå¶ç„¶æ²¡æœ‰å¸¦ä»»ä½•å‚æ•°å°±è¿è¡Œäº† \u0026lsquo;cscope\u0026rsquo;, ä¹Ÿä¼šå¯¼è‡´é‡æ–°åˆ›å»ºæ²¡æœ‰å¿«é€Ÿç´¢å¼•å’Œå†…æ ¸æ¨¡å¼çš„æ•°æ®åº“, é‚£å°±è¦é‡æ–°è¿è¡Œä¹‹å‰çš„ cscope å‘½ä»¤äº†.\n6.æºç æ”¹å˜æ—¶é‡æ–°ç”Ÿæˆæ•°æ®åº“. å¦‚æœé¡¹ç›®ä¸­æœ‰äº†æ–°æ–‡ä»¶, å°±å†è¿è¡Œ \u0026lsquo;find\u0026rsquo; å‘½ä»¤æ¥æ›´æ–° cscope.files (å¦‚æœæ­£åœ¨ä½¿ç”¨å®ƒ).\nåƒåˆå§‹ç”Ÿæˆæ•°æ®é‚£æ ·ï¼Œç”¨åŒæ ·çš„æ–¹æ³•è°ƒç”¨ cscope (å¹¶ä¸”åœ¨ç›¸åŒçš„ç›®å½•ä¸‹) (å³, cscope -b -q -k).\nTutorial by Jason Duell\n","date":"2012 April 28","permalink":"/posts/2012/04/28/","section":"Posts","summary":"åŸæ–‡ï¼š","title":"åœ¨å¤§é¡¹ç›®ä¸­ä½¿ç”¨ Cscope"},{"content":"åŸæ–‡ï¼š\nBuilding a custom kernel\nhttps://fedoraproject.org/wiki/Building_a_custom_kernel\nTranslated By Bob\n2012-3-31\nEmailï¼š gexbob@gmail.com\nBlogï¼šhttp://shaocheng.li\n1. ä»æºç RPMåŒ…å»ºç«‹ä¸€ä¸ªå†…æ ¸ # æ³¨æ„ï¼šä¸‹é¢çš„è¯´æ˜åªå¯¹ Fedora12 å’Œä¹‹åç‰ˆæœ¬æœ‰æ•ˆ\nè¿™ä»½æ–‡æ¡£ä¸ºé‚£äº›æƒ³è¦é‡æ–°å»ºç«‹å†…æ ¸çš„é«˜çº§ç”¨æˆ·æä¾›è¯´æ˜ã€‚ä½†æ˜¯ï¼Œé‡æ–°å»ºç«‹çš„å†…æ ¸æ— æ³•å¾—åˆ° Fedora å†…æ ¸å›¢é˜Ÿçš„æ”¯æŒã€‚ä½†æ˜¯ï¼Œæ‚¨æ˜¯é«˜çº§ç”¨æˆ·ï¼Œæ‚¨å¯ä»¥è‡ªå·±å¤„ç†ï¼Œå¯¹å—ï¼Ÿæ— è®ºå¦‚ä½•ï¼Œé«˜çº§ç”¨æˆ·å»ºç«‹å®šåˆ¶å†…æ ¸çš„åŸå› æœ‰å¦‚ä¸‹å‡ é¡¹ï¼š\næµ‹è¯•ä»–ä»¬ç¼–å†™çš„æˆ–ä»å…¶ä»–åœ°æ–¹å¾—åˆ°çš„è¡¥ä¸ã€‚ é‡æ–°é…ç½®å·²ç»å­˜åœ¨çš„å†…æ ¸ã€‚ å­¦ä¹ å†…æ ¸æˆ–å†…æ ¸å¼€å‘ã€‚ è¿™äº›è¯´æ˜ä¹Ÿå¯ä»¥ç”¨äºç®€å•çš„å‡†å¤‡å†…æ ¸æºç æ ‘ã€‚\nå¼€å§‹ä¹‹å‰ï¼Œç¡®è®¤ç³»ç»Ÿå·²ç»å®‰è£…äº†å¿…è¦çš„è½¯ä»¶åŒ…ï¼š\nrpmdevtools yum-utils yum-utils æ˜¯ä¸€ä¸ªé»˜è®¤çš„åŒ…ã€‚ç”¨å¦‚ä¸‹å‘½ä»¤å®‰è£…ï¼š\nsu -c 'yum install rpmdevtools yum-utils' å¦‚æœæ‚¨è¦ç”¨ make xconfigï¼Œå®‰è£…å¦‚ä¸‹è½¯ä»¶æ˜¯å¿…è¦çš„ï¼š\nqt3-devle libXi-devel gcc-c++ å¯¹äº Fedora 15ï¼Œç”¨å¦‚ä¸‹å‘½ä»¤ï¼š\nsu -c 'yum install qt3-devel libXi-devel' 1.1. è·å¾—æºç  # ä¸è¦ç”¨ root å»ºç«‹è½¯ä»¶åŒ…,ç”¨ root å»ºç«‹è½¯ä»¶åŒ…æ˜¯å¾ˆå±é™©ä¸”æ²¡æœ‰å¿…è¦çš„ï¼Œå³ä½¿å¯¹äºå†…æ ¸ã€‚ä¸‹é¢çš„æŒ‡ä»¤å…è®¸ä»»ä½•æ™®é€šç”¨æˆ·ä»æºç åŒ…å¼€å§‹å»ºç«‹å’Œå®‰è£…å†…æ ¸.\n1.åœ¨æ‚¨çš„ç”¨æˆ·ä¸»ç›®å½•ä¸‹å‡†å¤‡ä¸€ä¸ªå»ºç«‹RPMåŒ…çš„ç¯å¢ƒï¼Œè¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š\nrpmdev-setuptree è¿™ä¸ªå‘½ä»¤æ–°å»ºäº†å‡ ä¸ªä¸åŒçš„ç›®å½• ${HOME}/rpmbuild/SOURCESï¼Œ ${HOME}/rpmbuild/SPECSå’Œ${HOME}/rpmbuild/BUILD ã€‚${HOME} æ˜¯æ‚¨çš„ç”¨æˆ·ä¸»ç›®å½•ã€‚\n2.ä¸‹è½½ kernel-\u0026lt;version\u0026gt;.src.rpm æ–‡ä»¶ã€‚ç”¨\u0026ndash;enablerepoé€‰é¡¹ä½¿èƒ½é€‚å½“çš„æºç åº“ã€‚ï¼ˆyumdownloader \u0026ndash;enablerepo=repo_to_enable \u0026ndash;source kernel)\nyumdownloader --source kernel 3.ç”¨ yum-builddep å‘½ä»¤ä¸ºå†…æ ¸æºç å®‰è£…ç¼–è¯‘ä¾èµ–ã€‚\nsu -c 'yum-builddep kernel-\u0026lt;version\u0026gt;.src.rpm' 4.ç”¨å¦‚ä¸‹å‘½ä»¤å®‰è£… kernel-\u0026lt;version\u0026gt;.src.rpm\nrpm -Uvh kernel-\u0026lt;version\u0026gt;.src.rpm è¿™ä¸ªå‘½ä»¤æŠŠRPMç›®å½•å†™å…¥äº† ${HOME}/repbuild/SOURCESå’Œ${HOME}/rpmbuild/SPECS ï¼Œ${HOME} æ˜¯æ‚¨çš„ç”¨æˆ·ä¸»ç›®å½•ã€‚å¯ä»¥å¿½ç•¥åƒä¸‹é¢è¿™æ ·çš„ä¿¡æ¯ï¼š\nwarning: user kojibuilder does not exist - using root warning: group kojibuilder does not exist - using root ç©ºé—´éœ€æ±‚:å®Œå…¨çš„å†…éƒ¨ç¼–è¯‘è¿‡ç¨‹éœ€è¦è‹¥å¹² GB çš„é¢å¤–ç©ºé—´ã€‚\n1.2. å‡†å¤‡å†…æ ¸æºç æ ‘ #è¿™ä¸€æ­¥æ‰©å¤§ä¸ºæ•´ä¸ªå†…æ ¸æºç æ–‡ä»¶ã€‚è¿™å¯¹äºæŸ¥çœ‹ä»£ç ã€ç¼–è¾‘ä»£ç å’Œç”Ÿæˆè¡¥ä¸æ˜¯å¿…éœ€çš„ã€‚\nç”¨å¦‚ä¸‹å‘½ä»¤å‡†å¤‡å†…æ ¸æºç æ ‘ï¼š\ncd ~/rpmbuild/SPECS rpmbuild -bp --target=$(uname -m) kernel.spec ç°åœ¨ï¼Œå†…æ ¸æºç æ ‘å°±ä½äº ~/rpmbuild/BUILD/kernel-\u0026lt;version\u0026gt;/linux-\u0026lt;version\u0026gt;.\u0026lt;arch\u0026gt; ç›®å½•ã€‚\n1.3. å¤åˆ¶æºç æ ‘å’Œç”Ÿæˆä¸€ä¸ªè¡¥ä¸ #è¿™ä¸€æ­¥æ˜¯ä¸ºäº†å¯¹å†…æ ¸æºç ä½¿ç”¨ä¸€ä¸ªè¡¥ä¸ã€‚å¦‚æœä¸éœ€è¦è¿™ä¸ªè¡¥ä¸ï¼Œç›´æ¥è·³åˆ°â€œé…ç½®å†…æ ¸é€‰é¡¹â€ã€‚\né«˜çº§ç”¨æˆ·ï¼š æœ‰äº›å·¥å…·ï¼Œä¾‹å¦‚â€œquiltâ€ï¼Œå…è®¸æ‚¨é¿å…å¤åˆ¶æºç æ ‘ã€‚å¯¹åº”é«˜çº§ç”¨æˆ·ï¼Œè¿™æ ·çš„å·¥å…·å¯ä»¥ä½¿æ‚¨åœ¨ä¸‹é¢çš„æ­¥éª¤ä¸­èŠ‚çœå¾ˆå¤šæ—¶é—´ã€‚\nå¤åˆ¶æºç æ ‘æ˜¯ä¸ºäº†ä¿ç•™ä¿®æ”¹å‰çš„åŸå§‹ä»£ç ã€‚\nexport arch=x86_64 # replace x86_64 with your arch export ver=3.1 # replace 3.1 with your kernel version export fedver=fc16 # replace fc16 with your fedora version cp -r ~/rpmbuild/BUILD/kernel-$ver.$fedver/linux-$ver.$arch ~/rpmbuild/BUILD/kernel-$ver.$fedver.orig cp -al ~/rpmbuild/BUILD/kernel-$ver.$fedver.orig ~/rpmbuild/BUILD/kernel-$ver.$fedver.new ç¬¬äºŒä¸ª cp å‘½ä»¤åœ¨ .orig å’Œ .new æ ‘ä¹‹é—´å»ºç«‹äº†ç¡¬è¿æ¥ï¼Œè¿™æ ·å¯ä»¥ä½¿ diff è¿è¡Œçš„æ›´å¿«ã€‚å¤§éƒ¨åˆ†æ–‡æœ¬ç¼–è¾‘è€…éƒ½çŸ¥é“æ€æ ·æ­£ç¡®çš„ç ´åç¡¬è¿æ¥æ¥é¿å…é—®é¢˜ã€‚\nåœ¨ FC14 ä¸Šä½¿ç”¨ vim æ—¶ï¼Œå®ƒä¼šæŠŠä¸Šé¢çš„ç¡¬è¿æ¥å½“åšç¡¬è¿æ¥æ¥å¤„ç†ï¼Œä»è€Œå¯¼è‡´ä¸Šé¢çš„æŠ€æœ¯å¤±è´¥ã€‚æœ‰å¿…è¦å°†åŸå§‹ä»£ç å®Œå…¨å¤åˆ¶åˆ° .new ç›®å½•ã€‚ä½†æ˜¯è¿™æ ·å°†ä½¿ç”¨åŒå€çš„ç©ºé—´ã€‚\nç›´æ¥æ›´æ”¹ .new æºç æ ‘ä¸­çš„ä»£ç ï¼Œæˆ–è€…å¤åˆ¶åˆ°ä¸€ä¸ªå‰¯æœ¬æ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶å¯ä»¥æ¥è‡ªäºä¸€ä¸ªè¦æ±‚æµ‹è¯•çš„å¼€å‘è€…ï¼Œä¸Šæ¸¸å†…æ ¸æºç ï¼Œæˆ–è€…å¦ä¸€ä¸ªå‘è¡Œç‰ˆæœ¬ã€‚\nä¿®æ”¹ .new æºç æ ‘ä¹‹åï¼Œç”Ÿæˆä¸€ä¸ªè¡¥ä¸ã€‚è¦ç”Ÿæˆä¸€ä¸ªè¡¥ä¸ï¼Œç”¨ä¸‹é¢å‘½ä»¤å¯¹æ•´ä¸ª .new å’Œ .orig æºç æ ‘è¿è¡Œ diff ã€‚\ncd ~/rpmbuild/BUILD diff -uNrp kernel-$ver.$fedver.orig kernel-$ver.$fedver.new \u0026gt; ../SOURCES/linux-$ver.$fedver-mynewpatch.patch ç”¨æ–°è¡¥ä¸çš„åå­—æ›¿æ¢ \u0026rsquo;linux-$ver.$fedver-mynewpatch.patch\u0026rsquo; ã€‚åœ¨ FC14 ä¸Šå¿…é¡»æŠŠå‰é¢çš„è¡¥ä¸åå­—å¤åˆ¶åˆ° ~/rpmbuild/SOURCES ä¸­çš„ linux-$ver.$fedver-mynewpatch.patch ï¼Œä»¥ä¾¿ rpmbuild æ‰¾åˆ°å®ƒã€‚\næ›´å¤šå…³äºè¡¥ä¸çš„ä¿¡æ¯è¯·çœ‹ diff(1) å’Œ patch(1) çš„ man æ‰‹å†Œ\n1.4. é…ç½®å†…æ ¸é€‰é¡¹ #è¿™ä¸€æ­¥æ˜¯ä¸ºäº†ä¿®æ”¹å†…æ ¸çš„é€‰é¡¹ã€‚è¿™ä¸€æ­¥æ˜¯å¯é€‰çš„ã€‚å¦‚æœæ²¡æœ‰éœ€è¦ä¿®æ”¹çš„é…ç½®ï¼Œå¯ä»¥è·³åˆ°â€œå‡†å¤‡å»ºç«‹æ–‡ä»¶â€ã€‚\nå°å˜åŒ–: å¦‚æœæ‚¨åªæ˜¯æƒ³è¦åšä¸€ç‚¹å°çš„ä¿®æ”¹ï¼Œå¯ä»¥åœ¨config-localæ–‡ä»¶ä¸­æ ¹æ®éœ€è¦ç›´æ¥è®¾ç½®é€‰é¡¹ã€‚è¿™æ ·ä¼šæ‰¾åˆ°å¹¶è¦†ç›–å…¶ä½™çš„config-*æ–‡ä»¶ï¼Œé¿å…å¾ˆå¤šä¸å¿…è¦çš„å·¥ä½œã€‚å¦‚æœæ‚¨ä½¿ç”¨config-localå°±å¯ä»¥è·³è¿‡ä¸‹é¢çš„æ­¥éª¤ã€‚*\n1.æ”¹å˜å†…æ ¸æºç æ ‘ç›®å½•ï¼š\ncd ~/rpmbuild/BUILD/kernel-$ver.$fedver/linux-$ver.$arch/ å¦‚æœæ‚¨åªæ˜¯å¯¹é»˜è®¤çš„ fedora å†…æ ¸åšå°çš„ä¿®æ”¹ï¼Œè·³åˆ°ç¬¬å››æ­¥ï¼Œä»ä¸¤ä¸ªé…ç½®å·¥ä½œä¸­é€‰æ‹©ä¸€ä¸ªï¼Œå°†è¿™äº›ä¿®æ”¹ç¼–è¾‘åˆ°é»˜è®¤çš„é…ç½®æ–‡ä»¶ã€‚\n2.ä» ~/rpmbuild/BUILD/kernel-$ver.$fedver/linux-$ver.$arch/configs é€‰æ‹©æ‰€éœ€çš„é…ç½®æ–‡ä»¶ã€‚å¤åˆ¶æ‰€éœ€çš„ config æ–‡ä»¶åˆ° ~/rpmbuild/BUILD/kernel-$ver.$fedver/linux-$ver.$arch/.config:\ncp configs/\u0026lt;desired-config-file\u0026gt; .config 3.è¿è¡Œä¸‹é¢å‘½ä»¤ï¼š\nmake oldconfig 4.è¿è¡Œä¸‹é¢å‘½ä»¤ï¼Œåœ¨æ–‡æœ¬ç•Œé¢ä¸Šé€‰æ‹©å¹¶ä¿æŒæ‰€éœ€çš„å†…æ ¸é€‰é¡¹\nmake menuconfig è¿è¡Œå›¾å½¢ç•Œé¢çš„è¯ç”¨è¿™ä¸ªå‘½ä»¤ï¼š\nmake xconfig 5.åœ¨é¡¶å±‚ config æ–‡ä»¶ä¸­æ·»åŠ ä¸€è¡Œï¼Œè¯¥æ–‡ä»¶åŒ…å«äº†å†…æ ¸æ”¯æŒçš„ç¡¬ä»¶æ¶æ„ï¼ˆuname -içš„è¾“å‡ºï¼‰ã€‚è¿™ä¸€è¡Œä»¥ # å¼€å¤´ã€‚ä¾‹å¦‚ï¼Œx86_64 è®¾å¤‡åº”è¯¥åœ¨é¡¶å±‚ config æ–‡ä»¶ä¸­æ·»åŠ ä¸‹é¢è¿™è¡Œï¼š\n# x86_64 6.å¤åˆ¶ config æ–‡ä»¶åˆ° ~/rpmbuild/SOURCES/:\ncp .config ~/rpmbuild/SOURCES/config-`uname -m`-generic 32-bit x86 å†…æ ¸\n32-bit PAE å†…æ ¸ä½¿ç”¨ config-i686-PAE é…ç½®æ–‡ä»¶ã€‚å¦‚æœæ‚¨æ­£åœ¨å»ºç«‹ä¸€ä¸ª PAE å†…æ ¸ï¼Œéœ€è¦å¤åˆ¶æ‚¨çš„ config æ–‡ä»¶åˆ° ~/rpmbuild/SOURCES/:\ncp .config ~/rpmbuild/SOURCES/config-i686-PAE å¦‚æœæ‚¨æ­£åœ¨å»ºç«‹ä¸€ä¸ªé PAE å†…æ ¸ï¼Œéœ€è¦å¤åˆ¶æ‚¨çš„ config æ–‡ä»¶åˆ°ï¼š\ncp .config ~/rpmbuild/SOURCES/config-x86-32-generic å†æ¬¡é¼“åŠ±ä½¿ç”¨ config-localï¼Œé™¤éæ‚¨æ­£åœ¨ä¿®æ”¹å¤§é‡çš„é…ç½®ã€‚\n1.5. å‡†å¤‡å»ºç«‹æ–‡ä»¶ #è¿™ä¸€æ­¥å°†å¯¹ kernel.spec æ–‡ä»¶åšå¿…è¦çš„ä¿®æ”¹ã€‚åªæ˜¯å»ºç«‹å®šåˆ¶å†…æ ¸æ‰€éœ€çš„ã€‚\n1.è¿›å…¥~/rpmbuild/SPECSç›®å½•ï¼š\ncd ~/rpmbuild/SPECS 2.ç”¨ç¼–è¾‘å™¨æ‰“å¼€kernel.specæ–‡ä»¶ã€‚\n3.ä¸ºå†…æ ¸èµ·ä¸€ä¸ªå”¯ä¸€çš„åå­—ã€‚è¿™å¯¹äºç¡®ä¿å®šåˆ¶å†…æ ¸ä¸ä¸å…¶ä»–å†…æ ¸æ··æ·†æ˜¯å¾ˆé‡è¦çš„ã€‚é€šè¿‡ä¿®æ”¹ â€˜buildidâ€™ ä¸€è¡Œï¼Œä¸ºå†…æ ¸åå­—æ·»åŠ ä¸€ä¸ªå”¯ä¸€çš„å­—ç¬¦ä¸²ã€‚å¯ä»¥æŠŠ â€œ.localâ€ æ”¹ä¸ºæ‚¨çš„åå­—ç¼©å†™ï¼Œä¸€ä¸ª bug å·ï¼Œæ—¥æœŸï¼Œæˆ–å…¶å®ƒä»»ä½•å”¯ä¸€çš„å­—ç¬¦ä¸²ã€‚\nä¿®æ”¹è¿™ä¸€è¡Œï¼š\n#% define buildid .local æ”¹ä¸ºï¼ˆæ³¨æ„ï¼Œ# å·å’Œé¢å¤–çš„ç©ºæ ¼éƒ½è¢«åˆ é™¤äº†ï¼‰ï¼š\n%define buildid .\u0026lt;custom_text\u0026gt; 4.å¦‚æœæ‚¨ç”Ÿæˆäº†ä¸€ä¸ªè¡¥ä¸ï¼Œæœ€åæŠŠå®ƒæ·»åŠ åˆ° kernel.spec æ–‡ä»¶ä¸­æ‰€æœ‰å·²å­˜åœ¨çš„è¡¥ä¸çš„åé¢ï¼Œå¹¶ä¸”æ·»åŠ è¯¦ç»†çš„æ³¨é‡Šã€‚\n# cputime accounting is broken, revert to 2.6.22 version Patch2220: linux-2.6-cputime-fix-accounting.patch Patch9999: linux-2.6-samfw-test.patch ç„¶åï¼Œéœ€è¦å°†è¡¥ä¸åº”ç”¨åˆ°specæ–‡ä»¶çš„applicationæ®µï¼Œæ”¾åœ¨æ‰€æœ‰å·²å­˜åœ¨çš„è¡¥ä¸åº”ç”¨çš„åé¢ï¼Œå¹¶æ·»åŠ è¯¦ç»†çš„æ³¨é‡Šã€‚\nApplyPatch linux-2.6-cputime-fix-accounting.patch ApplyPatch linux-2.6-samfw-test.patch 1.6. å»ºç«‹æ–°å†…æ ¸ #è¿™ä¸€æ­¥å®é™…æ˜¯è¦ç”Ÿæˆä¸€ä¸ªå†…æ ¸ RPM æ–‡ä»¶ã€‚åªæ˜¯å»ºç«‹å®šåˆ¶å†…æ ¸æ‰€éœ€çš„ã€‚å¯¹äº Fedora10 æˆ– 11 ï¼Œå¤§å¤šæ•°åœºåˆä¸‹ï¼Œè¿™æ˜¯å»ºç«‹å†…æ ¸ï¼ˆåŒ…æ‹¬å›ºä»¶ï¼‰çš„æœ€ç®€å•çš„æ–¹æ³•ï¼ˆçœ‹æœ€åä¸€éƒ¨åˆ†ï¼‰ã€‚\nç”¨ rpmbuild å·¥å…·å»ºç«‹æ–°å†…æ ¸ï¼š\n1.å»ºç«‹æ‰€æœ‰å†…æ ¸é…ç½®ï¼š\nrpmbuild -bb --target='uname -m' kernel.spec 2.å…³é—­æŒ‡å®šçš„å†…æ ¸é…ç½®ï¼ˆä¸ºäº†æ›´å¿«çš„å»ºç«‹ï¼‰ï¼š\nrpmbuild -bb --without \u0026lt;option\u0026gt; --target='uname -m' kernel.spec å…¶ä¸­ â€œoptionâ€ çš„æœ‰æ•ˆå€¼åŒ…æ‹¬ xenã€smpã€upã€paeã€kdumpã€debug å’Œ debuginfo ã€‚æŒ‡å®š \u0026ndash;without debug ä¼šå‰”é™¤å†…æ ¸ä¸­çš„è°ƒè¯•ä»£ç ï¼ŒæŒ‡å®š \u0026ndash;without debuginfo ä¼šç¦æ­¢å»ºç«‹ kernel-debuginfo åŒ…ã€‚\n3.åªå»ºç«‹ä¸€ä¸ªç‰¹å®šçš„å†…æ ¸ï¼š\nrpmbuild -bb --with \u0026lt;option\u0026gt; --target='uname -m' kernel-spec â€œoptionâ€ çš„æœ‰æ•ˆå€¼åŒ…æ‹¬ xenonlyã€smponly å’Œ beseonlyã€‚\n4.ä¾‹å¦‚ï¼Œåªå»ºç«‹ kernel å’Œ kernel-devel åŒ…çš„å‘½ä»¤æ˜¯ï¼š\nrpmbuild -bb --with baseonly --without debuginfo --target='uname -m' kernel.spec 5.å»ºç«‹æ—¶åŒ…å«å›ºä»¶ï¼Œç”¨å¦‚ä¸‹å‘½ä»¤ï¼š\nrpmbuild -bb --with baseonly --with firmware --without debuginfo --target=`uname -m` kernel.spec å»ºç«‹çš„è¿‡ç¨‹éœ€è¦å¾ˆé•¿æ—¶é—´ã€‚ä¼šåœ¨å±å¹•ä¸Šæ‰“å°å¤§é‡çš„ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯å¯ä»¥è¢«å¿½ç•¥ï¼Œé™¤éå»ºç«‹è¿‡ç¨‹å› ä¸ºä¸€ä¸ªerrorè€Œåœæ­¢ã€‚å¦‚æœæˆåŠŸå®Œæˆå»ºç«‹è¿‡ç¨‹ï¼Œä¸€ä¸ªæ–°çš„å†…æ ¸åŒ…ä¼šå‡ºç°åœ¨~/rpmbuild/RPMSç›®å½•ã€‚\nåº”è¯¥æ·»åŠ ä¸€ä¸ªæ•…éšœæ’é™¤çš„éƒ¨åˆ†ã€‚\n####1.6.1. ä»¥ä¸‹æ˜¯é€šç”¨æ•™ç¨‹\nå¤§éƒ¨åˆ†å…³äº Linux å†…æ ¸å¼€å‘çš„æ•™ç¨‹ï¼Œä¾‹å­å’Œæ•™ç§‘ä¹¦éƒ½å‡è®¾å†…æ ¸æºç è¢«å®‰è£…åœ¨/usr/src/linuxç›®å½•ä¸‹ã€‚å¦‚æœæ‚¨æƒ³ä¸‹é¢è¿™æ ·åšä¸€ä¸ªç¬¦å·é“¾æ¥ï¼Œæ‚¨å°±å¯ä»¥ä½¿ç”¨é‚£äº›FedoraåŒ…çš„å­¦ä¹ ææ–™äº†ã€‚å®‰è£…åˆé€‚çš„å†…æ ¸æºç ï¼Œç„¶åè¿è¡Œä¸‹é¢å‘½ä»¤ï¼š\nsu -c 'ln -s /usr/src/kernels/\u0026lt;version\u0026gt;.\u0026lt;release\u0026gt;-\u0026lt;arch\u0026gt; /usr/src/linux' æ ¹æ®æç¤ºè¾“å…¥ root å¯†ç ã€‚\n1.7. å®‰è£…æ–°å†…æ ¸ #è¿™ä¸€æ­¥å°†æŠŠæ–°å†…æ ¸å®‰è£…åˆ°è¿è¡Œä¸­çš„ç³»ç»Ÿã€‚\nè¦å®‰è£…æ–°å†…æ ¸ï¼Œç”¨ rpm -ivh å‘½ä»¤ï¼Œä¸è¦å¸¦ -U æˆ– \u0026ndash;upgrade é€‰é¡¹ï¼š\nsu -c \u0026quot;rpm -ivh --force $HOME/rpmbuild/RPMS/\u0026lt;arch\u0026gt;/kernel-\u0026lt;version\u0026gt;.\u0026lt;arch\u0026gt;.rpm\u0026quot; å¦‚æœæ‚¨æ ¹æ®éœ€è¦ä¿®æ”¹äº†å†…æ ¸çš„åå­—ï¼Œæ‚¨çš„å›ºä»¶å’Œå†…æ ¸å¤´æ–‡ä»¶å°†æ— æ³•åŒ¹é…ã€‚æœ€ç®€å•çš„è§£å†³æ–¹æ³•æ˜¯ç”¨å‰é¢æè¿°çš„æ–¹æ³•å»ºç«‹æ–°çš„å›ºä»¶ï¼Œç„¶åï¼š\nsu -c \u0026quot;rpm -ivh $HOME/rpmbuild/RPMS/\u0026lt;arch\u0026gt;/kernel-\u0026lt;version\u0026gt;.\u0026lt;arch\u0026gt;.rpm \\ $HOME/rpmbuild/RPMS/\u0026lt;arch\u0026gt;/kernel-firmware-\u0026lt;version\u0026gt;.\u0026lt;arch\u0026gt;.rpm \\ $HOME/rpmbuild/RPMS/\u0026lt;arch\u0026gt;/kernel-headers-\u0026lt;version\u0026gt;.\u0026lt;arch\u0026gt;.rpm \\ $HOME/rpmbuild/RPMS/\u0026lt;arch\u0026gt;/kernel-devel-\u0026lt;version\u0026gt;.\u0026lt;arch\u0026gt;.rpm\u0026quot; è¿™äº›å‘½ä»¤ä¼šæŠŠæ‚¨çš„å†…æ ¸å®‰è£…åˆ° /bootç›®å½•ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ initramfsï¼Œå¹¶ä¸”è‡ªåŠ¨æŠŠæ–°å†…æ ¸æ·»åŠ åˆ° grub çš„ â€œmenu.listâ€ ä¸­ã€‚ç„¶åï¼Œæ‚¨å°±å¯ä»¥é‡å¯å¹¶ä½¿ç”¨æ‚¨çš„æ–°å†…æ ¸äº†ã€‚\n2. åªå»ºç«‹å†…æ ¸æ¨¡å—ï¼ˆkernel modulesï¼‰ #æœ¬æ®µéœ€è¦æ›´æ–°å’Œå……å®\nè¿™ä¸€æ®µé’ˆå¯¹é‚£äº›åªæƒ³åœ¨å†…æ ¸æ¨¡å—ä¸Šå·¥ä½œçš„ç”¨æˆ·ï¼Œä»–ä»¬å¹¶ä¸æƒ³å»ºç«‹ä¸€ä¸ªå®Œæ•´çš„å†…æ ¸ã€‚åªè¦å°±æ²¡å¿…è¦ä¸‹è½½å’Œé‡æ–°å»ºç«‹æ•´ä¸ªå†…æ ¸ã€‚è¦ä¸ºå½“å‰è¿è¡Œçš„å†…æ ¸å»ºç«‹ä¸€ä¸ªæ¨¡å—ï¼Œåªéœ€è¦ç›¸åŒ¹é…çš„ kernel-devel åŒ…ã€‚è¿è¡Œä¸‹é¢å‘½ä»¤å®‰è£… kernel-devel åŒ…ï¼š\nsu -c 'yum install kernel-devel' å¦‚æœæ‚¨ç”¨çš„æ˜¯ PAE å†…æ ¸ï¼Œå¯èƒ½è¦å®‰è£… â€œkernel-PAE-develâ€ ã€‚\nåªè¦æ‚¨å®‰è£…äº†ç›¸åº”ç‰ˆæœ¬çš„ kernel æˆ– kernel-devel åŒ…ï¼Œå°±å¯ä»¥å»ºç«‹ä»»ä½•å†…æ ¸ç‰ˆæœ¬ã€‚æœ¬æ®µçš„å…¶ä½™éƒ¨åˆ†å‡è®¾æ‚¨æ­£åœ¨ä½¿ç”¨å½“å‰è¿è¡Œçš„å†…æ ¸ã€‚å¦‚æœä¸æ˜¯ï¼Œç”¨æŒ‡å®šçš„ç‰ˆæœ¬å·ä»£æ›¿ â€˜uname -râ€™ã€‚\nkernel-doc åŒ…åŒ…å«äº†å®˜æ–¹çš„ Kbuild æ–‡æ¡£ã€‚åœ¨ Documentation/kbuild ç›®å½•ä¸‹æŸ¥çœ‹ï¼Œå°¤å…¶æ˜¯ modules.txt æ–‡ä»¶ã€‚\nä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œä» foo.c å»ºç«‹ foo.ko æ¨¡å—ï¼Œåœ¨ foo.c æ‰€åœ¨çš„ç›®å½•ä¸‹åˆ›å»ºä¸‹é¢è¿™æ ·çš„ Makefileï¼š\nobj-m := foo.o KDIR := /lib/modules/$(shell uname -r)/build PWD := $(shell pwd) default: [TAB]$(MAKE) -C $(KDIR) M=$(PWD) modules [TAB] è¡¨ç¤º makefile ä¸­åŒ…å«å‘½ä»¤çš„ä¸€è¡Œå¿…é¡»ä»¥ä¸€ä¸ª tab å­—ç¬¦å¼€å¤´ã€‚\nç„¶åï¼Œæ‰§è¡Œ make å‘½ä»¤å»ºç«‹ foo.ko æ¨¡å—ã€‚\nä¸Šé¢æ˜¯æ˜¯é€šè¿‡ä¸€ä¸ªæœ¬åœ° Makefile åŒ…è£…è°ƒç”¨ kbuildã€‚é€šå¸¸æ‚¨å¯ä»¥ç®€å•ä¸€ç‚¹ï¼Œæƒ³ä¸‹é¢è¿™æ ·æ¥å»ºç«‹é‚£äº›ç›®æ ‡ã€‚\n# make -C /lib/modules/`uname -r`/build M=`pwd` modules # make -C /lib/modules/`uname -r`/build M=`pwd` clean # make -C /lib/modules/`uname -r`/build M=`pwd` modules_install ","date":"2012 April 1","permalink":"/posts/2012/04/01/","section":"Posts","summary":"åŸæ–‡ï¼š","title":"å»ºç«‹ä¸€ä¸ªå®šåˆ¶å†…æ ¸"},{"content":"Goagent çš„é¡¹ç›®ä¸»é¡µåœ¨ googlecodeï¼šhttp://code.google.com/p/goagent/\né¦–é¡µæœ‰ Windows ç³»ç»Ÿä¸­çš„éƒ¨ç½²æ•™ç¨‹ï¼ŒLinux ç³»ç»Ÿä¸­çš„éƒ¨ç½²æ–¹æ³•æœ‰äº›å¤æ‚ï¼Œè®°å½•å¦‚ä¸‹:\nç”³è¯·ä¸€ä¸ªGoogle Appengineï¼šhttp://code.google.com/intl/zh-CN/appengine/ï¼Œå¹¶ä¸”åˆ›å»ºä¸€ä¸ª appidã€‚ ä¸‹è½½ Python ç‰ˆçš„ Google App Engine SDKï¼Œä¸‹è½½é¡µé¢ï¼šhttp://code.google.com/intl/zh-CN/appengine/downloads.html#Google_App_Engine_SDK_for_Pythonï¼Œè¦é€‰æ‹© Linux å¹³å°ã€‚ä¸‹è½½åè§£å‹ä¸ºä¸€ä¸ª google_appengine æ–‡ä»¶å¤¹ã€‚ ä¸‹è½½ goagent ç¨³å®šç‰ˆï¼Œåœ¨é¡¹ç›®ä¸»é¡µçš„é¡¶éƒ¨å°±æœ‰ä¸‹è½½é“¾æ¥ï¼Œå½“å‰çš„ç‰ˆæœ¬æ˜¯ goagent 1.7.10ã€‚ä¸‹è½½åè§£å‹åˆ° google_appengine/goagent æ–‡ä»¶å¤¹ã€‚ ä¿®æ”¹ local/proxy.ini æ–‡ä»¶ä¸­çš„ [gae] ä¸‹çš„ appid=ä½ çš„appid ï¼Œå¤šä¸ª appid å¯ä»¥ç”¨ | éš”å¼€ã€‚ ä¸Šä¼ ã€‚åœ¨ google_appengine ç›®å½•ä¸‹æ‰§è¡Œï¼špython appcfg.py update goagent/server/pythonã€‚ä¸Šä¼ éœ€è¦ä¸€äº›æ—¶é—´ã€‚ chrome æµè§ˆå™¨è¯·å®‰è£… SwitchySharp æ’ä»¶ï¼šhttps://chrome.google.com/webstore/detail/dpplabbmogkhghncfbfdeeokoefdjegmï¼Œå®‰è£…åå¯¼å…¥è¿™ä¸ªè®¾ç½®ï¼šhttp://goagent.googlecode.com/files/SwitchyOptions.bakã€‚ ä½¿ç”¨æ—¶åœ¨ goagent/local ä¸‹æ‰§è¡Œ python proxy.py ï¼Œç„¶åæ‰“å¼€ chrome å³å¯ã€‚ ","date":"2012 March 23","permalink":"/posts/2012/03/23/","section":"Posts","summary":"Goagent çš„é¡¹ç›®ä¸»é¡µåœ¨ googlecodeï¼šhttp://code.","title":"åœ¨ Linux ç³»ç»Ÿä¸­éƒ¨ç½² goagent"},{"content":"ä¹Ÿè®¸ä½ è¿˜ä¸çŸ¥é“ AA æ˜¯ä»€ä¹ˆï¼Œä½†åªçœ‹é‚£ç‰›é€¼å“„å“„çš„åå­—ï¼Œå°±è¯¥çŸ¥é“å®ƒç»éå–„ç±»ã€‚\næ²¡é”™ã€‚è¿›å…¥è¿™ä¸ªé¡¹ç›®çš„ä¸»é¡µï¼šhttp://aa-project.sourceforge.net/ï¼Œå°±èƒ½çœ‹åˆ°å®ƒçš„ä¸‰ä¸ªå®ä¼Ÿç›®æ ‡ï¼š\nå°†æ‰€æœ‰çš„é‡è¦è½¯ä»¶ç§»æ¤åˆ°AA-lib å°†AA-libç§»æ¤åˆ°æ‰€æœ‰çš„å¯ç”¨å¹³å° è¿«ä½¿IBMé‡æ–°åˆ¶é€ MDAå¡ æ³¨ï¼šMDAï¼ˆMonochrome Display Adapter ï¼‰ï¼Œå•è‰²å­—ç¬¦æ˜¾ç¤ºé€‚é…å¡ï¼Œä¸å•è‰²å­—ç¬¦æ˜¾ç¤ºå™¨é…æ¥ï¼Œå®ƒåªæ”¯æŒå­—ç¬¦æ˜¾ç¤ºåŠŸèƒ½ï¼Œæ— å›¾å½¢åŠŸèƒ½ï¼Œæ˜¯ä¸€ç§ç›¸å½“å¤è€çš„æ˜¾å¡ã€‚\nå¦‚æœä½ å¯¹æŠ€æœ¯ä¸æ„Ÿå…´è¶£ï¼Œå¯ç”¨ç‚¹å‡»è¿™é‡Œ http://v.youku.com/v_show/id_XMzYwNTIyODY4.htmlï¼Œè§‚çœ‹åˆ©ç”¨ AA åˆ¶ä½œçš„ä¸€æ®µåŠ¨ç”»,åˆ¶ä½œæ–¹æ³•å’Œæºä»£ç åœ¨æ–‡æ¡£çš„æœ€åä¸€èŠ‚ã€‚\nç®€å•çš„è¯´ï¼Œå®ƒå¯ç”¨å®ç°ä¸‹é¢çš„æ•ˆæœï¼Œå°±æ˜¯å°†å›¾ç‰‡è½¬æ¢ä¸º ASCII æ–‡æœ¬ã€‚\nè¿™ä¸ªç•¥æ˜¾ç²—ç³™ï¼Œå¦‚æœå°†å­—ä½“è°ƒå°ï¼Œå¢å¤§åˆ†è¾¨ç‡ï¼Œå¯æ˜¾ç¤ºæ›´åŠ é€¼çœŸçš„å›¾ç‰‡ï¼Œä¾‹å¦‚ï¼š\nå…¶å®ï¼Œè¿™æ˜¯ä¸€ä¸ªç”±ASCIIå­—ç¬¦çš„ç‹‚çƒ­çˆ±å¥½è€…ä»¬å¼€å‘çš„é¡¹ç›®ï¼Œæœ€åˆçš„å‘èµ·äººå« Jan Hubicka ï¼Œç›®çš„æ˜¯å°†è®¡ç®—æœºä¸Šçš„ä¸€åˆ‡éƒ½ç”¨ ASCII å­—ç¬¦æ¥è¡¨ç°ï¼ŒåŒ…æ‹¬å›¾å½¢å’Œè§†é¢‘ã€‚\nè¯¥é¡¹ç›®æä¾›äº†ä¸€ä¸ªåº“â€”â€” AA-lib ï¼Œè¿™æ˜¯ä¸€ä¸ªä½çº§å›¾å½¢åº“ï¼Œä¸å…¶ä»–çš„åº“çš„åŒºåˆ«æ˜¯å®ƒä¸éœ€è¦å›¾å½¢è®¾å¤‡ï¼Œå®Œå…¨ç”¨ ASCII å­—ç¬¦æç»˜å›¾å½¢ï¼Œå®ƒçš„ API è¢«è®¾è®¡å¾—ä¸å…¶ä»–åº“ç±»ä¼¼ã€‚è¿˜ææä¾›ä¸€ä¸ªæ¼”ç¤ºç¨‹åºâ€”â€” BBï¼ˆè¿™ä¸ªåå­—æ›´æ˜¾å¦ç±»ï¼‰ï¼Œæ’­æ”¾äº†ä¸€æ®µå®Œå…¨ç”± ASCII å­—ç¬¦ç»˜åˆ¶çš„åŠ¨ç”»ï¼Œå…¶ä¸­æœ‰æ–‡å­—ï¼Œå›¾åƒï¼Œåˆ†å½¢å‡ ä½•ï¼Œè¿˜æœ‰ä¸€ä¸ª 3D æ•ˆæœã€‚\nä¸‹é¢åœ¨ fedora12 ä¸­å®‰è£…å®ƒä»¬ã€‚\n1. å®‰è£… AA-lib #ä¸‹è½½ aalib-1.2ï¼š\nhttp://prdownloads.sourceforge.net/aa-project/aalib-1.2.tar.gz\næœ€æ–°ç‰ˆæœ¬æ˜¯ 1.4ï¼Œä½†æ˜¯ BB æ˜¯åŸºäº 1.2 çš„ï¼Œæ‰€æœ‰å…ˆå®‰è£…1.2ã€‚\nè§£å‹ã€ç¼–è¯‘ã€å®‰è£…ï¼š\ntar xvzf aalib-1.2.tar.gz cd aalib-1.2 ./configure make make install é»˜è®¤å®‰è£…åœ¨ /usr/local ä¸‹\n2. å®‰è£… bb #ä¸‹è½½ bb-1.2ï¼š\nhttp://prdownloads.sourceforge.net/aa-project/bb-1.2.tar.gz\nç¼–è¯‘å‰éœ€è¦è®¾ç½®ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œå¦åˆ™ä¼šæ‰¾ä¸åˆ° aa-libï¼š\nexport CFLAGS=-I/usr/local/include è§£å‹ï¼š\ntar xvzf bb-1.2.tar.gz cd aalib-1.2 ç¼–è¯‘æ—¶ä¼šæŠ¥ textform.c æ–‡ä»¶çš„é”™è¯¯ï¼Œæ˜¯å› ä¸ºè¯¥æ–‡ä»¶å†…å®šä¹‰çš„æŸäº›å­—ç¬¦ä¸²å¤ªé•¿ï¼Œæ¢è¡Œæ—¶æ²¡æœ‰ç”¨åæ–œæ ï¼Œå¯ä»¥åœ¨åé¢åŠ ä¸Šåæ–œæ \tï¼Œæˆ–ç›´æ¥æ³¨é‡Šæ‰ã€‚ç„¶åç¼–è¯‘ï¼š\n./configure make ç¼–è¯‘ç”Ÿæˆäº†å¯æ‰§è¡Œæ–‡ä»¶ bbï¼Œç›´æ¥æ‰§è¡Œå³å¯çœ‹åˆ°ä¸€æ®µæ¼”ç¤ºã€‚æœ€å¥½åœ¨æ–‡æœ¬æ¨¡å¼ä¸‹æ‰§è¡Œï¼Œå¦åˆ™å¯èƒ½ä¼šæŠ¥é”™ã€‚\nè¿™æ®µæ¼”ç¤ºè¿˜å¯ä»¥æ·»åŠ éŸ³ä¹ï¼Œåœ¨æºç çš„ mikunix ç›®å½•ä¸‹æœ‰éŸ³é¢‘çš„ç¨‹åºï¼Œç›´æ¥ make ï¼Œç„¶åæ‰§è¡Œ strip ../bb_snd_\tserverã€‚ä½†æ˜¯æˆ‘ä¸€ç›´æ²¡æœ‰å¼„å‡ºå£°éŸ³ï¼Œä¹Ÿè®¸æ˜¯è™šæ‹Ÿæœºçš„é—®é¢˜ã€‚\n3. å®‰è£… aview #aview çš„ä½œç”¨æ˜¯å°† pnm æ ¼å¼çš„å›¾ç‰‡è½¬æ¢ä¸º ASCII æ–‡æœ¬ï¼Œå¹¶æ˜¾ç¤ºã€‚aviewåªæ”¯æŒ pnmã€pgmã€pbm å’Œ ppm æ ¼å¼çš„å›¾ç‰‡ï¼Œæ‰€ä»¥éœ€è¦å°†å…¶ä»–æ ¼å¼çš„å›¾ç‰‡è½¬æ¢ï¼Œå®ƒæä¾›äº†ä¸€ä¸ª asciiview çš„è„šæœ¬ï¼Œåˆ©ç”¨ convert è½¬æ¢å›¾ç‰‡æ ¼å¼ï¼Œç„¶åå†ä¼ é€’ç»™ aviewã€‚\naview ä¾èµ–äº aalib-1.4ï¼Œæ‰€æœ‰è¦å…ˆç”¨ 1.4 æ›¿æ¢ä¹‹å‰å®‰è£…çš„ 1.2ï¼Œå®‰è£…æ–¹æ³•ä¸ 1.2 ç›¸åŒã€‚å®‰è£…åä¸‹è½½ aviewï¼šhttp://prdownloads.sourceforge.net/aa-project/aview-1.3.0rc1.tar.gz\nè§£å‹ã€ç¼–è¯‘ã€å®‰è£…ï¼š\ntar xvzf aview-1.3.0rc1.tar.gz cd aview-1.3.0 ./configure make make install ç¼–è¯‘ç”Ÿæˆçš„ aview ç¨‹åºå¯ä»¥å°† pbmã€pgm æˆ– pnm å›¾ç‰‡ç”¨ ASCII å­—ç¬¦æ˜¾ç¤ºã€‚ä½†æ˜¯ä¸æ”¯æŒ JPEG å›¾ç‰‡ï¼Œæ‰€ä»¥å®ƒæä¾›äº†ä¸€ä¸ª shell è„šæœ¬ ascii\tviewï¼Œå…ˆè°ƒç”¨ convert å°† JPEG å›¾ç‰‡è½¬æ¢ä¸º pgm å›¾ç‰‡ï¼Œç„¶åå†ç”¨ aview æ˜¾ç¤ºã€‚\nfedora12 ä¸­æ²¡æœ‰ convert å‘½ä»¤ï¼Œå…ˆç”¨ä¸‹é¢çš„å‘½ä»¤å®‰è£…ï¼š\nyum install ImageMagick å‡†å¤‡ä¸€å¼ å›¾ç‰‡ï¼Œä¾‹å¦‚ 1.jpgï¼Œç”¨ä¸‹é¢çš„å‘½ä»¤å°±å¯ä»¥æŠŠå®ƒè½¬æ¢ä¸º ASCIIæ–‡æœ¬ï¼š\nasciiview 1.jpg 4. Bad Apple #ä¸‹é¢å‚è€ƒ aview çš„æºç ï¼Œç¼–å†™äº†ä¸€ä¸ªç¨‹åºï¼Œåœ¨ Linux çš„ç»ˆç«¯ä¸‹æ’­æ”¾ä¸€æ®µç”± ASCII å­—ç¬¦ç»˜åˆ¶çš„åŠ¨ç”»ï¼šBad Appleã€‚åŸç†æ¯”è¾ƒ\tç®€å•ï¼Œå°±æ˜¯å°†è§†é¢‘é€å¸§æˆªå›¾ï¼Œç„¶åç”¨ç¨‹åºæŒ‰ä¸€å®šçš„æ—¶é—´é—´éš”å°†å›¾ç‰‡ä¾æ¬¡è½¬æ¢ä¸ºASCIIæ–‡æœ¬åœ¨ç»ˆç«¯ä¸Šæ˜¾ç¤ºã€‚åŠ¨ç”»è§†é¢‘åœ¨è¿™é‡Œï¼šhttp://v.youku.com/v_show/id_XMzYwNTIyODY4.htmlï¼ŒåŠ¨ç”»ä¸­çš„å¡é¡¿æ˜¯å±å¹•å½•åƒè½¯ä»¶çš„é—®é¢˜ï¼ŒAA-libæœ¬èº«æ˜¯å¾ˆæµç•…çš„ã€‚\nåˆ¶ä½œæ­¥éª¤ï¼š\nå‡†å¤‡ apple.flvï¼Œç”¨ kmplayer åšæ¯ 50 æ¯«ç§’æˆªå›¾ï¼Œæˆªå›¾ä¸º jpeg æ ¼å¼ï¼ŒæŠŠå®ƒä»¬éƒ½å¤åˆ¶åˆ° /root/aa/img ç›®å½•ä¸‹ã€‚\nç”¨ä¸‹é¢ shell è„šæœ¬å°† jpeg å›¾ç‰‡è½¬åŒ–ä¸º pgm æ ¼å¼ï¼Œå…± 3202 å¼ ï¼Œæ–‡ä»¶åä¸º 1.pgm åˆ° 3202.pgm ï¼Œå…¨éƒ¨æ”¾åœ¨ pgm æ–‡ä»¶å¤¹ä¸‹ã€‚\n#!/bin/sh ls -l *.jpg \u0026gt; sort i=1 while [ $i -le 3202 ] do filename=`sed -n ''$i'p' sort | awk '{print $8}'` echo $filename convert $filename ./pgm/$i.pgm i=`expr $i + 1` done åœ¨ pgm æ–‡ä»¶å¤¹ä¸‹æ‰§è¡Œç¨‹åºï¼š\n./aviewdemo -contrast 20 -extended 1.pgm ç¨‹åºæºç åœ¨è¿™é‡Œï¼šhttp://download.csdn.net/detail/exbob/4112093\nåŠ¨ç”»è§†é¢‘åœ¨è¿™é‡Œï¼šhttp://v.youku.com/v_show/id_XMzYwNTIyODY4.html\n","date":"2012 March 5","permalink":"/posts/2012/03/05/","section":"Posts","summary":"ä¹Ÿè®¸ä½ è¿˜ä¸çŸ¥é“ AA æ˜¯ä»€ä¹ˆï¼Œä½†åªçœ‹é‚£ç‰›é€¼å“„å“„çš„åå­—ï¼Œå°±è¯¥çŸ¥é“å®ƒç»éå–„ç±»ã€‚","title":"ç‰›é€¼çš„AA"},{"content":"åŸæ–‡ï¼š\nX Window System Architecture Overview HOWTO\nhttp://www.linuxdoc.org/HOWTO/XWindow-Overview-HOWTO/index.html\nDaniel Manrique\nroadmr@entropia.com.mx\nTranslated By Bob\nEmailï¼š gexbob@gmail.com\nBlogï¼šhttp://shaocheng.li\nä¿®è®¢å†å²\nRevision 1.0.1 2001-05-22 Revised by: dm ä¸€äº›è¯­æ³•ä¿®æ­£ï¼Œç”±Bill StaehleæŒ‡å‡ºã€‚\nRevision 1.0 2001-05-20 Revised by: dm åˆå§‹å‘è¡Œã€‚\næœ¬æ–‡æ¡£æè¿°äº†X Windowçš„æ¶æ„ï¼Œç»™å‡ºäº†å¯¹äºX Windowè®¾è®¡çš„æ›´å¥½ç†è§£, åŒ…æ‹¬Xçš„ç»„ä»¶ï¼Œè¿™äº›ç»„ä»¶ç»“åˆèµ·æ¥æ„æˆçš„å¯è¿è¡Œå›¾å½¢ç¯å¢ƒï¼Œè¿™äº›ç»„ä»¶ä½œä¸ºçª—å£ç®¡ç†å™¨è¯¥æ€æ ·é€‰æ‹©ï¼Œå·¥å…·åŒ…å’Œæ„ä»¶åº“ï¼Œæ¡Œé¢ç¯å¢ƒã€‚\n1. åºè¨€ #è¿™ä¸ªæ–‡æ¡£çš„ç›®çš„æ˜¯æä¾›ä¸€ä¸ª X-Window ç³»ç»Ÿæ¶æ„çš„æ¦‚è¿°ï¼Œå¸Œæœ›äººä»¬æ›´å¥½çš„ç†è§£å®ƒä¸ºä»€ä¹ˆè¦è¿™æ ·è®¾è®¡ï¼ŒX çš„ç»„ä»¶æ˜¯æ€æ ·ç»„åˆèµ·æ¥å½¢æˆä¸€ä¸ªå¯å·¥ä½œçš„å›¾å½¢ç¯å¢ƒï¼Œæ€æ ·é€‰æ‹©è¿™äº›ç»„ä»¶ã€‚\næˆ‘ä»¬æ¢è®¨ä¸€äº›ç»å¸¸è¢«æåˆ°çš„æ¦‚å¿µï¼Œå¦‚æœæ²¡æœ‰ç›¸å…³çš„æŠ€æœ¯èƒŒæ™¯ï¼Œè¿™äº›æ¦‚å¿µå¯èƒ½è¢«æ··æ·†ï¼Œä¾‹å¦‚éƒ¨ä»¶ï¼ˆwidgetsï¼‰å’Œå·¥å…·åŒ…ï¼ˆtoolkitsï¼‰ï¼Œçª—å£ç®¡ç†å™¨ï¼ˆwindow managersï¼‰å’Œæ¡Œé¢ç¯å¢ƒï¼ˆdesktop environmentsï¼‰ã€‚è¿˜æä¾›äº†ä¸€äº›ä¾‹å­ï¼Œå±•ç¤ºäº†è¿™äº›ç»„ä»¶åœ¨æ—¥å¸¸ä½¿ç”¨çš„åº”ç”¨ç¨‹åºä¸­å¦‚ä½•ç›¸äº’ä½œç”¨ã€‚\nè¿™ä¸ªæ–‡æ¡£æ•…æ„å†™å¾—ä¸å¤ªåé‡æŠ€æœ¯ï¼Œå®ƒåŸºäºä½œè€…çš„ç»éªŒçŸ¥è¯†ï¼Œä»¥éæŠ€æœ¯æ–¹å¼å¼•å…¥ï¼Œå®ƒå¯ä»¥ä»å„ç§æ„è§ä¸­å¸å–è¥å…»ï¼ŒåŒ…æ‹¬æ›´æ·±å…¥çš„ä¾‹å­å’Œè§£é‡Šï¼Œä»¥åŠæŠ€æœ¯ä¸Šçš„æ›´æ­£ã€‚ä½œè€…æ¬¢è¿æ‰€æœ‰å…³äºè¿™ä¸ªæ–‡æ¡£çš„é—®é¢˜å’Œæ„è§ï¼ŒEmailï¼š roadmr@entropia.com.mx ã€‚\n2. ç®€ä»‹ #å›åˆ°UNIXè¿˜æ˜¯æ–°é²œäº‹ç‰©çš„æ—¶ä»£ï¼Œå¤§çº¦æ˜¯1970å¹´ï¼Œå›¾å½¢ç”¨æˆ·æ¥å£è¿˜æ˜¯ä¸€ä¸ªå¥‡æ€ªçš„ä¸œè¥¿ï¼Œåªè¢«ä¸€ä¸ªå®éªŒå®¤ï¼ˆXerox\u0026rsquo;s PARCï¼‰ä½¿ç”¨ã€‚å¯æ˜¯ä»Šå¤©ï¼Œä»»ä½•æ“ä½œç³»ç»Ÿåªè¦æƒ³æ‹¥æœ‰ç«äº‰åŠ›ï¼Œå°±å¿…é¡»æœ‰ä¸€ä¸ªGUIå­ç³»ç»Ÿã€‚GUIç•Œé¢æä¾›äº†è‰¯å¥½çš„æ˜“ç”¨æ€§ã€‚è¿™ä¸æ˜¯UNIXæ‰€å…³å¿ƒçš„ï¼ŒUNIX æœ‰å®ƒçš„ä¼ ç»Ÿï¼ŒæŸç§ç¨‹åº¦æ¥è®²ï¼Œå¤šåŠŸèƒ½æ¯”æ˜“ç”¨æ€§æ›´å¥½ã€‚ä½†æ˜¯ï¼Œæœ‰å‡ ä¸ªåŸå› ä½¿å¾— UNIX ç³»ç»Ÿéœ€è¦æœ‰ä¸€ä¸ªGUIã€‚ä¾‹å¦‚ï¼ŒUNIX çš„å¤šä»»åŠ¡ç‰¹æ€§ï¼Œåœ¨ç»™å®šçš„æ—¶é—´å†…è¦è¿è¡Œå¤šä¸ªç¨‹åºã€‚GUI æä¾›äº†å¤šç§æ§åˆ¶æ–¹å¼ï¼Œå¯ä»¥åœ¨åŒä¸€æ—¶é—´åœ¨å±å¹•ä¸Šæ˜¾ç¤ºå¤šä¸ªè¿è¡Œçš„ç¨‹åºã€‚æ‰€ä»¥ï¼ŒæŸäº›ç±»å‹çš„ä¿¡æ¯æ›´é€‚åˆåœ¨å›¾å½¢ç•Œé¢ä¸Šæ˜¾ç¤ºï¼ˆæœ‰äº›ç”šè‡³åªèƒ½åœ¨å›¾å½¢ç•Œé¢ä¸Šæ˜¾ç¤ºï¼Œä¾‹å¦‚pr0nå’Œå…¶ä»–å›¾å½¢æ•°æ®ï¼‰ã€‚\nå†å²ä¸Šï¼ŒUNIXæœ‰å¾ˆå¤šå­¦æœ¯ä¸Šçš„æ”¹è¿›ã€‚ä¸€ä¸ªå¥½çš„ä¾‹å­æ˜¯ï¼Œ70å¹´ä»£æœ«åŠ å…¥äº† BSD ç½‘ç»œä»£ç ï¼Œè¿™æ˜¯åŠ å·å¤§å­¦ä¼¯å…‹åˆ©åˆ†æ ¡çš„å·¥ä½œæˆæœã€‚äº‹å®è¯æ˜ï¼ŒX Window ç³»ç»Ÿä¹Ÿæ˜¯ä¸€ä¸ªå­¦æœ¯é¡¹ç›®çš„ç»“æœï¼Œå³ MIT çš„é›…å…¸å¨œé¡¹ç›®ï¼Œå®ƒæˆä¸ºäº†ç°ä»£ UNIXï¼ˆç±»UNIXç³»ç»Ÿï¼‰ä¸­å¤§éƒ¨åˆ†GUIå­ç³»ç»Ÿçš„åŸºç¡€ï¼ŒåŒ…æ‹¬ Linux å’Œ BSDã€‚\nä»ä¸€å¼€å§‹ï¼ŒUNIXå°±æ˜¯ä¸€ä¸ªå¤šç”¨æˆ·ã€å¤šä»»åŠ¡çš„åˆ†æ—¶æ“ä½œç³»ç»Ÿã€‚éšç€ç½‘ç»œæŠ€æœ¯çš„åŠ å…¥ï¼Œå®ƒè¿˜å…è®¸ç”¨æˆ·è¿œç¨‹è¿æ¥å’Œæ‰§è¡Œä»»åŠ¡ã€‚ä»¥å‰ï¼Œè¿™æ˜¯é€šè¿‡ä¸²è¡Œç»ˆç«¯æˆ–ç½‘ç»œè¿æ¥ï¼ˆtelnetï¼‰å®Œæˆçš„ã€‚\nå½“å¼€å‘UNIXä¸‹çš„GUIç³»ç»Ÿçš„æ—¶å€™ï¼Œè¿™äº›æ¦‚å¿µéƒ½è¢«åŠ å…¥åˆ°äº†è®¾è®¡ä¸­ã€‚äº‹å®ä¸Šï¼ŒXæ˜¯ä¸€ä¸ªç›¸å½“å¤æ‚çš„è®¾è®¡ï¼Œè¿™æ˜¯ç»å¸¸è¢«æåˆ°çš„ä¸€ä¸ªç¼ºç‚¹ã€‚å¯æ˜¯ï¼Œæ­£å› å¦‚æ­¤ï¼Œå®ƒæ‰æ˜¯ä¸€ä¸ªçœŸæ­£å¤šåŠŸèƒ½çš„ç³»ç»Ÿï¼Œå½“æˆ‘ä»¬è§£é‡ŠGUIçš„å„ä¸ªéƒ¨åˆ†åœ¨UNIXä¸‹æ˜¯æ€æ ·ç»“åˆçš„æ—¶å€™ï¼Œè¿™äº›éƒ½ä¼šå˜çš„å¾ˆæ¸…æ™°ã€‚\nä»‹ç»Xçš„æ¶æ„ä¹‹å‰ï¼Œç®€å•ä»‹ç»ä¸€ä¸‹å®ƒçš„å†å²ï¼Œè¿˜æœ‰å®ƒæ˜¯å¦‚æœè¿›å…¥Linuxç³»ç»Ÿçš„ã€‚\nXæ˜¯ç”±é›…å…¸å¨œé¡¹ç›®å¼€å‘ï¼Œåœ¨1984å¹´å‘è¡Œã€‚1988å¹´ï¼Œä¸€ä¸ªå«åšâ€œX Consortium â€çš„å®ä½“æ¥æ‰‹Xï¼Œä¹‹åå¼€å§‹å¤„ç†å®ƒçš„å¼€å‘å’Œå‘å¸ƒã€‚Xè§„èŒƒæ˜¯è‡ªç”±æä¾›çš„ï¼Œè¿™ä¸ªèªæ˜çš„ä¸¾åŠ¨ä½¿Xå¾—åˆ°äº†å¾ˆå¤§ç¨‹åº¦çš„æ™®åŠã€‚ä¸‹é¢ä»‹ç»XFree86æ˜¯ä»€ä¹ˆã€‚XFree86æ˜¯æˆ‘ä»¬åœ¨Linuxç³»ç»Ÿä¸Šä½¿ç”¨çš„Xå®ä½“ï¼ŒXFree86ä¹Ÿå¯ä»¥å·¥ä½œåœ¨å…¶ä»–æ“ä½œç³»ç»Ÿä¸Šï¼Œä¾‹å¦‚BSDç³»åˆ—ã€OS/2å’Œå…¶ä»–ã€‚å°½ç®¡å®ƒçš„åå­—ä¸­å¸¦æœ‰86ï¼Œå®ƒä¾ç„¶æ”¯æŒå…¶ä»–CPUæ¶æ„ã€‚\n3. X Windowç³»ç»Ÿæ¶æ„ï¼šæ¦‚è§ˆ #Xè¢«è®¾è®¡ä¸ºå®¢æˆ·ç«¯â€”æœåŠ¡å™¨çš„æ¶æ„ï¼ˆclient-serverï¼‰ã€‚åº”ç”¨è½¯ä»¶ä½œä¸ºå®¢æˆ·ç«¯ï¼Œä»–ä»¬é€šè¿‡æœåŠ¡å™¨è¿›è¡Œæ²Ÿé€šå’Œå‘å¸ƒè¯·æ±‚ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä»æœåŠ¡å™¨æ¥å—ä¿¡æ¯ã€‚\nX serverç»´æŠ¤ä¸€ä¸ªç‹¬ç«‹çš„æ˜¾ç¤ºæ§åˆ¶å™¨å’Œå¤„ç†æ¥è‡ªclientçš„è¯·æ±‚ã€‚ä»è¿™ä¸€ç‚¹ä¸Šæ¥çœ‹ï¼Œä½¿ç”¨è¿™ç§æ¨¡å¼çš„ä¼˜ç‚¹æ˜¯æ˜¾è€Œæ˜“è§çš„ã€‚åº”ç”¨ç¨‹åºï¼ˆclientï¼‰åªéœ€è¦çŸ¥é“æ€æ ·åŒserveræ²Ÿé€šï¼Œè€Œä¸éœ€è¦å…³æ³¨å®é™…å›¾åƒæ˜¾ç¤ºè®¾å¤‡çš„ç»†èŠ‚ã€‚æœ€åŸºæœ¬çš„ï¼Œclientä¼šå‘Šè¯‰serverä¸€äº›è¿™æ ·çš„ä¸œè¥¿ï¼šâ€œç”»ä¸€æ¡ä»è¿™é‡Œåˆ°é‚£é‡Œçš„çº¿â€ï¼Œæˆ–è€…â€œæ˜¾ç¤ºä¸€ä¸ªæ–‡æœ¬å­—ç¬¦ä¸²ï¼Œä½¿ç”¨è¿™ä¸ªå­—ä½“ï¼Œåœ¨å±å¹•çš„è¿™ä¸ªä½ç½®â€ã€‚\nè¿™ä¸åªç”¨å›¾å½¢åº“å†™åº”ç”¨æ²¡ä»€ä¹ˆä¸åŒã€‚ä½†æ˜¯ï¼ŒXæ¨¡å¼æ›´è¿›ä¸€æ­¥ã€‚å®ƒä¸é™åˆ¶clientå’Œserveråœ¨åŒå¤„ä¸€å°ç”µè„‘ã€‚ä½¿ç”¨è¿™ä¸ªåè®®å¯ä»¥è®©clientå’Œserveré€šè¿‡ç½‘ç»œè¿›è¡Œæ²Ÿé€šï¼Œäº‹å®ä¸Šï¼Œâ€œè¿›ç¨‹é—´é€šä¿¡æœºåˆ¶æä¾›äº†å¯é çš„å­—èŠ‚æµâ€ã€‚å½“ç„¶ï¼Œæ›´å¥½çš„æ–¹æ³•æ˜¯ä½¿ç”¨TCP/IPåè®®ã€‚å¯ä»¥çœ‹åˆ°ï¼ŒXçš„æ¨¡å¼æ˜¯å¾ˆå¼ºå¤§çš„ã€‚ä¸€ä¸ªç»å…¸çš„ä¾‹å­æ˜¯ï¼Œåœ¨Crayè®¡ç®—æœºä¸Šè¿è¡Œä¸€ä¸ªå¤„ç†å™¨å¯†é›†é˜µåº”ç”¨ç¨‹åºï¼Œåœ¨Solaris æœåŠ¡å™¨ä¸Šè¿è¡Œä¸€ä¸ªæ•°æ®åº“ç›‘è§†å™¨ï¼Œåœ¨å°å‹BSDé‚®ä»¶æœåŠ¡å™¨ä¸Šè¿è¡Œä¸€ä¸ªE-mailåº”ç”¨ï¼Œåœ¨SGIæœåŠ¡å™¨ä¸Šè¿è¡Œä¸€ä¸ªå¯è§†åŒ–åº”ç”¨ï¼Œç„¶åï¼Œå°†ä»¥ä¸Šè¿™äº›éƒ½æ˜¾ç¤ºåœ¨æˆ‘çš„Linuxå¹³å°çš„å±å¹•ä¸Šã€‚\nç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°X serveræ˜¯ä¸€ä¸ªå¤„ç†å®é™…å›¾å½¢æ˜¾ç¤ºçš„ä¸œè¥¿ã€‚ç”±äºX serveræ˜¯è¿è¡Œåœ¨ç”¨æˆ·ä½¿ç”¨çš„å®é™…è®¡ç®—æœºä¸Šï¼Œå®ƒçš„èŒè´£æ˜¯å¤„ç†æ‰€æœ‰ä¸ç”¨æˆ·çš„äº¤äº’ã€‚è¿™åŒ…æ‹¬ç›‘å¬é¼ æ ‡å’Œé”®ç›˜ã€‚æ‰€æœ‰è¿™äº›ä¿¡æ¯éƒ½è¦ä¼ è¾¾ç»™clientï¼Œè¿˜æœ‰å¯¹å®ƒè¿›è¡Œå“åº”ã€‚\nXæä¾›äº†ä¸€ä¸ªåº“ï¼Œç§°ä½œXlibï¼Œè´Ÿè´£å¤„ç†æ‰€æœ‰ä½çº§çš„client-serveré€šä¿¡ä»»åŠ¡ã€‚å¾ˆæ˜¾ç„¶ï¼Œclientè°ƒç”¨Xlibä¸­çš„å‡½æ•°è¿›è¡Œå·¥ä½œã€‚\nè¿™æ ·çœ‹æ¥ï¼Œä¸€åˆ‡éƒ½å·¥ä½œçš„å¾ˆå¥½ã€‚æˆ‘ä»¬æœ‰ä¸€ä¸ªserverè´Ÿè´£è™šæ‹Ÿè¾“å‡ºå’Œæ•°æ®è¾“å…¥ï¼Œå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºï¼Œä¸¤è€…ä¹‹é—´å¯ä»¥é€šè¿‡ä¸€ç§æ–¹æ³•äº’ç›¸é€šä¿¡ã€‚å‡è®¾clientå’Œserverä¹‹é—´æœ‰ä¸€ä¸ªäº’åŠ¨ï¼Œclientå¯ä»¥è®©serveråœ¨å±å¹•ä¸Šåˆ†é…ä¸€æŒ‡å®šçš„çŸ©å½¢åŒºåŸŸã€‚ä½œä¸ºclientï¼Œæˆ‘å¹¶ä¸å…³å¿ƒæˆ‘è¢«ç°å®åœ¨å±å¹•çš„å“ªä¸ªä½ç½®ï¼Œæˆ‘åªæ˜¯å‘Šè¯‰serverâ€œç»™æˆ‘ä¸€ä¸ªXä¹˜ä»¥Yåƒç´ å¤§å°çš„åŒºåŸŸâ€ï¼Œç„¶åè°ƒç”¨å‡½æ•°æ‰§è¡Œç±»ä¼¼â€œç”»ä¸€æ¡ä»è¿™é‡Œåˆ°é‚£é‡Œçš„çº¿â€ï¼Œâ€œç”¨æˆ·æ˜¯å¦åœ¨æˆ‘çš„å±å¹•èŒƒå›´å†…ç§»åŠ¨é¼ æ ‡â€ç­‰ç­‰ã€‚\n4. çª—å£ç®¡ç†å™¨ #å¯æ˜¯ï¼Œæˆ‘ä»¬æ²¡æœ‰æåˆ°X serveræ€æ ·å¤„ç†clientåœ¨å±å¹•ç°å®èŒƒå›´å†…çš„æ“ä½œï¼ˆè°ƒç”¨çª—å£ï¼‰ã€‚æ˜¾ç„¶ï¼Œå¯¹äºä»»ä½•ä½¿ç”¨GUIçš„ç”¨æˆ·ï¼Œå¯¹éœ€è¦å¯¹â€œclient windowsâ€è¿›è¡Œæ§åˆ¶ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥å¯¹çª—å£è¿›è¡Œç§»åŠ¨å’Œæ’åˆ—ï¼›æ”¹å˜å¤§å°ï¼›æœ€å¤§åŒ–æˆ–æœ€å°åŒ–ã€‚é‚£ä¹ˆï¼ŒX serveræ˜¯æ€æ ·å¤„ç†è¿™äº›ä»»åŠ¡å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼šä¸èƒ½ã€‚\nXçš„è®¾è®¡åŸåˆ™ä¹‹ä¸€å°±æ˜¯â€œåªæä¾›æœºåˆ¶ï¼Œä¸æä¾›ç­–ç•¥â€ã€‚æ‰€ä»¥ï¼ŒX serveræä¾›äº†ä¸€ä¸ªæ“ä½œçª—å£çš„æ–¹æ³•ï¼ˆæœºåˆ¶ï¼‰ï¼Œå¹¶æ²¡æœ‰è¯´æ€æ ·è¡¨ç°è¿™ç§æœºåˆ¶ï¼ˆç­–ç•¥ï¼‰ã€‚\nè¿™äº›æœºåˆ¶å’Œç­–ç•¥å¯ä»¥å½’ç»“ä¸ºï¼šæœ‰ä¸€ä¸ªç¨‹åºçš„è´£ä»»æ˜¯ç®¡ç†å±å¹•ç©ºé—´ã€‚è¿™ä¸ªç¨‹åºå†³å®šäº†çª—å£çš„ä½ç½®ï¼Œä¸ºç”¨æˆ·æä¾›äº†æ§åˆ¶çª—å£å¤–è§‚ã€ä½ç½®å’Œå¤§å°çš„æœºåˆ¶ï¼Œé€šå¸¸è¿˜ä¼šæä¾›ä¸€äº›â€œè£…é¥°â€ï¼Œä¾‹å¦‚æ ‡é¢˜ã€è¾¹æ¡†å’ŒæŒ‰é’®ï¼Œè¿™äº›æ˜¯æˆ‘ä»¬å¯¹çª—å£æœ¬èº«çš„æ§åˆ¶ã€‚è¿™ä¸ªæ§åˆ¶çª—å£çš„ç¨‹åºç§°ä½œâ€œçª—å£ç®¡ç†å™¨â€ã€‚\nâ€œçª—å£ç®¡ç†å™¨åªæ˜¯Xçš„ä¸€ä¸ªå®¢æˆ·ç«¯ç¨‹åºâ€”â€”å®ƒä¸æ˜¯X windowç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ï¼Œå°½ç®¡å®ƒäº«æœ‰ä¸€äº›ç‰¹æƒâ€”â€”æ‰€ä»¥ï¼Œçª—å£ç®¡ç†å™¨ä¸æ˜¯å”¯ä¸€çš„ï¼Œè€Œæ˜¯æœ‰å¾ˆå¤šï¼Œå®ƒä»¬æä¾›äº†ä¸åŒçš„ç”¨æˆ·ä¸çª—å£çš„äº¤äº’æ–¹å¼å’Œä¸åŒçš„çª—å£å¸ƒå±€ã€ä¿®é¥°ã€é”®ç›˜å’Œè‰²è°ƒçš„é£æ ¼ã€‚â€\nXçš„æ¶æ„æä¾›äº†ç”¨äºçª—å£ç®¡ç†å™¨æ‰§è¡Œè¿™äº›çª—å£æ“ä½œçš„æ–¹æ³•ï¼Œä½†ç¡®å®æ²¡æœ‰æä¾›ä¸€ä¸ªçª—å£ç®¡ç†å™¨ã€‚\nå¦å¤–ï¼Œç”±äºçª—å£ç®¡ç†å™¨æ˜¯ä¸€ä¸ªå¤–éƒ¨å…ƒä»¶ï¼Œå¯ä»¥å¾ˆå®¹æ˜“çš„æ ¹æ®ä½ çš„å‚æ•°è®¾å®šçª—å£ï¼Œä¾‹å¦‚ï¼Œä½ å¸Œæœ›å®ƒçœ‹èµ·æ¥æ˜¯ä»€ä¹ˆæ ·å­ï¼Œä½ æƒ³è¦å®ƒæ€æ ·æ‰§è¡Œï¼Œä½ æƒ³è¦å®ƒå‡ºç°åœ¨å“ªé‡Œï¼Œç­‰ç­‰ã€‚æœ‰äº›çª—å£ç®¡ç†å™¨æ¯”è¾ƒç®€å•å’Œä¸‘é™‹ï¼ˆä¾‹å¦‚twmï¼‰ï¼›è¿˜æœ‰ä¸€äº›æ˜¯åè€Œä¸å®çš„ï¼›è¿˜æœ‰ä»‹äºä¸¤è€…ä¹‹é—´çš„ï¼›fvwm, amiwm, icewm, windowmaker, afterstep, sawfish, kwm, è¿˜æœ‰æ•°ä¸æ¸…çš„å…¶ä»–çª—å£ç®¡ç†å™¨ã€‚æ¯ä¸€ç§å£å‘³éƒ½æœ‰å¯¹åº”çš„çª—å£ç®¡ç†å™¨ã€‚\nçª—å£ç®¡ç†å™¨æ˜¯ä¸€ä¸ªâ€œmeta-clientâ€ï¼Œæœ€åŸºæœ¬çš„ä½¿å‘½æ˜¯ç®¡ç†å…¶ä»–å®¢æˆ·ç«¯ç¨‹åºã€‚å¤§éƒ¨åˆ†çª—å£ç®¡ç†å™¨ä¼šæä¾›ä¸€äº›é¢å¤–çš„è®¾æ–½ï¼ˆæœ‰äº›ä¼šæä¾›å¾ˆå¤šï¼‰ã€‚ å¯æ˜¯ï¼Œæœ‰ä¸ªåŠŸèƒ½æ˜¯å¤§éƒ¨åˆ†çª—å£ç®¡ç†å™¨éƒ½æœ‰çš„â€”â€”å¯åŠ¨åº”ç”¨ç¨‹åºçš„æ–¹æ³•ã€‚æœ‰äº›çª—å£ç®¡ç†å™¨ä¼šæä¾›ä¸€ä¸ªå‘½ä»¤ç›’å­ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œå†™æ ‡å‡†å‘½ä»¤ï¼ˆç”¨äºå¯åŠ¨åº”ç”¨ç¨‹åºï¼‰ã€‚è¿˜æœ‰ä¸€äº›çª—å£ç®¡ç†å™¨ä¼šæä¾›æŸç§ç±»å‹çš„åº”ç”¨ç¨‹åºå¯åŠ¨èœå•ã€‚è¿™äº›ä¸æ˜¯æ ‡å‡†é…ç½®ã€‚ç”±äºXæ²¡æœ‰åˆ¶åº¦å…³äºå¦‚ä½•å¯åŠ¨åº”ç”¨ç¨‹åºçš„ç­–ç•¥ï¼Œè¿™é¡¹åŠŸèƒ½åœ¨å®¢æˆ·ç«¯ç¨‹åºä¸­å®æ–½ã€‚é‚£ä¹ˆï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œçª—å£ç®¡ç†å™¨æ‰€è´Ÿè´£çš„è¿™ä¸ªåŠŸèƒ½ï¼ˆä¸ªä½“ä¹‹é—´ä¼šç”±å·®å¼‚ï¼‰ï¼Œå®ƒçš„å”¯ä¸€ä½¿å‘½å°±æ˜¯å¦‚æœå¯åŠ¨å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºï¼Œå°±åƒä¸€ä¸ªç¨‹åºå¯åŠ¨å¹³å°ã€‚å½“ç„¶ï¼Œäººä»¬å·²ç»å†™äº†å¤§é‡çš„â€œå¯åŠ¨ç¨‹åºâ€çš„åº”ç”¨ã€‚\n5. å®¢æˆ·ç«¯åº”ç”¨ #ä¸‹é¢è®©æˆ‘ä»¬å…³æ³¨ä¸€äº›å®¢æˆ·ç«¯ç¨‹åºã€‚å‡è®¾ä½ æƒ³è¦ä»å¤´å¼€å§‹å†™ä¸€ä¸ªå®¢æˆ·ç«¯ç¨‹åºï¼Œå¹¶ä¸”åªç”¨Xæä¾›çš„è®¾æ–½ã€‚ä½ å¾ˆå¿«å°±ä¼šå‘ç°ï¼ŒXlibæ˜¯æ¼‚äº®çš„æ–¯å·´è¾¾ï¼Œæƒ³è¦åœ¨å±å¹•ä¸Šæ”¾ä¸€ä¸ªæŒ‰é’®ã€æ–‡æœ¬ï¼Œæˆ–æ˜¯ä¸ºç”¨æˆ·æä¾›çš„æ¼‚äº®ç©ºé—´ï¼ˆæ»šåŠ¨æ¡ï¼Œå•é€‰æ¡†ï¼‰ï¼Œè¿™äº›äº‹ç«Ÿæ˜¯ä»¤äººææ€–çš„å¤æ‚ã€‚\nå¹¸è¿çš„æ˜¯ï¼Œæœ‰äººä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªåº“ï¼Œå¯ä»¥è§£å†³è¿™äº›æ§ä»¶çš„ç¼–ç¨‹é—®é¢˜ã€‚è¿™äº›æ§ä»¶é€šå¸¸ç§°ä½œâ€œéƒ¨ä»¶â€ï¼ˆwidget library ï¼‰ï¼Œæ‰€ä»¥ï¼Œè¿™ä¸ªåº“ç§°ä½œâ€œéƒ¨ä»¶åº“â€ã€‚æˆ‘åªéœ€ä»åº“ä¸­è°ƒç”¨ä¸€ä¸ªå¸¦å‚æ•°çš„å‡½æ•°å°±å¯ä»¥åœ¨å±å¹•ä¸Šæ˜¾ç¤ºä¸€ä¸ªæŒ‰é’®ã€‚è¿™äº›éƒ¨ä»¶åŒ…æ‹¬èœå•ã€æŒ‰é’®ã€å•é€‰æŒ‰é’®ã€æ»šåŠ¨æ¡å’Œç”»å¸ƒã€‚\nâ€œcanvasâ€ï¼ˆç”»å¸ƒï¼‰æ˜¯ä¸€ä¸ªæœ‰è¶£çš„éƒ¨ä»¶ï¼Œå®ƒæ˜¯å®¢æˆ·ç«¯ä¸Šçš„ä¸€ä¸ªå­ç©ºé—´ï¼Œæˆ‘èƒ½åœ¨é‡Œé¢è¯ä¸€äº›ä¸œè¥¿ã€‚å¯ä»¥ç†è§£ï¼Œæˆ‘ä¸èƒ½ç›´æ¥ä½¿ç”¨Xlibï¼Œé‚£æ ·ä¼šå¹²æ‰°éƒ¨ä»¶åº“ï¼Œè¿™ä¸ªåº“æœ¬èº«æä¾›äº†åœ¨ç”»å¸ƒå†…ç”»ä»»æ„å›¾åƒçš„æ–¹æ³•ã€‚\nç”±äºéƒ¨ä»¶åº“ç¡®å®å¯ä»¥åœ¨å±å¹•ä¸Šç”»å„ç§å…ƒç´ ï¼Œä»¥åŠè§£é‡Šç”¨æˆ·çš„è¾“å…¥åŠ¨ä½œï¼Œè¿™ä¸ªåº“è¦å¯¹æ¯ä¸ªå®¢æˆ·ç«¯çš„å¤–è§‚å’Œè¡Œä¸ºè´Ÿè´£ã€‚ä»å¼€å‘è€…çš„è§’åº¦æ¥çœ‹ï¼Œéƒ¨ä»¶åº“ä¹Ÿæœ‰ä¸€äº›APIï¼ˆè®¾ç½®å‡½æ•°ï¼‰ï¼Œå®šä¹‰äº†æˆ‘æƒ³è¦ç”¨åˆ°çš„éƒ¨ä»¶ã€‚\n6. éƒ¨ä»¶åº“å’Œå·¥å…·åŒ… #åŸå§‹çš„éƒ¨ä»¶åº“æ˜¯ä¸ºé›…å…¸å¨œé¡¹ç›®å¼€å‘çš„ï¼Œç†æ‰€å½“ç„¶åº”è¯¥æ˜¯é›…å…¸å¨œéƒ¨ä»¶åº“ï¼Œä¹Ÿè¢«ç§°ä½œé›…å…¸å¨œéƒ¨ä»¶ã€‚å®ƒéå¸¸åŸºç¡€ï¼Œéå¸¸ç®€é™‹ï¼Œå®‰è£…ç°åœ¨çš„æ ‡å‡†æ¥çœ‹ï¼Œå®ƒçš„ä½¿ç”¨æ–¹ä¾¿å¹¶ä¸ç›´è§‚ï¼ˆä¾‹å¦‚ï¼Œè¦ç§»åŠ¨ä¸€ä¸ªæ»šåŠ¨æ¡æˆ–æ»‘å—ï¼Œä½ ä¸èƒ½æ‹–åŠ¨ï¼Œä½ è¦ç‚¹å‡»å³è¾¹çš„æŒ‰é’®è®©å®ƒå‘ä¸Šæ»‘ï¼Œæˆ–è€…ç‚¹å‡»å·¦è¾¹çš„æŒ‰é’®è®©å®ƒå‘ä¸‹æ»‘ï¼‰ï¼Œæ­£å› å¦‚æ­¤ï¼Œç°åœ¨å‡ ä¹æ²¡æœ‰è¢«ä½¿ç”¨äº†ã€‚\nåƒçª—å£ç®¡ç†å™¨ä¸€æ ·ï¼Œè€ƒè™‘åˆ°ä¸åŒçš„è®¾è®¡ç›®çš„ï¼Œå·¥å…·åŒ…ï¼ˆtoolkitï¼‰ä¹Ÿæœ‰å¾ˆå¤šç§ã€‚æœ€æ—©çš„å·¥å…·åŒ…ä¹‹ä¸€æ˜¯è‘—åçš„Motifï¼Œè¿™æ˜¯å¼€å‘è½¯ä»¶åŸºé‡‘ä¼šï¼ˆOSFï¼‰çš„Motifå›¾åƒç¯å¢ƒçš„ä¸€éƒ¨åˆ†ï¼Œç”±ä¸€ä¸ªçª—å£ç®¡ç†å™¨å’Œä¸€ä¸ªåŒ¹é…å·¥å…·åŒ…ç»„æˆã€‚OSFçš„å†å²è¶…å‡ºäº†æœ¬æ–‡æ¡£çš„è®¨è®ºèŒƒå›´ã€‚Motifå·¥å…·åŒ…ä¼˜äºé›…å…¸å¨œéƒ¨ä»¶ï¼Œåœ¨80å¹´ä»£å’Œ90å¹´ä»£åˆä½¿ç”¨å¹¿æ³›ã€‚\nè¿™äº›å¹´ï¼ŒMotifä¸æ˜¯ä¸€ä¸ªå—æ¬¢è¿çš„é€‰æ‹©ã€‚å®ƒä¸æ˜¯å…è´¹çš„ï¼Œå¦‚æœä½ æƒ³è¦ä¸€ä¸ªå¼€å‘è®¸å¯è¯ï¼ˆå³ç”¨å®ƒç¼–è¯‘ä½ è‡ªå·±çš„ç¨‹åºï¼‰ï¼Œä½ éœ€è¦å‘OSF Motifç¼´è´¹ï¼Œå°½ç®¡å¯ä»¥å‘å¸ƒä¸€ä¸ªé’ˆå¯¹Motifçš„äºŒè¿›åˆ¶è¿æ¥ã€‚è‡³å°‘å¯¹äºLinuxç”¨æˆ·æ¥è¯´ï¼Œæœ€çŸ¥åçš„Motifåº”ç”¨å¯èƒ½å°±æ˜¯Netscape Navigator/Communicatorã€‚\næœ‰ä¸€æ®µæ—¶é—´ï¼ŒMotifæ˜¯å”¯ä¸€æ­£å¸¸å¯ç”¨çš„å·¥å…·åŒ…ã€‚æœ‰å¾ˆå¤šè½¯ä»¶å›´ç»•ç€Motifã€‚äºæ˜¯äººä»¬å¼€å§‹å¼€å‘æ›¿ä»£å“ï¼Œäº§ç”Ÿäº†ä¸°å¯Œçš„å·¥å…·åŒ…ï¼Œä¾‹å¦‚XForms, FLTKç­‰ç­‰ã€‚\nå·²ç»æœ‰äº›æ—¶é—´æ²¡æœ‰å¬åˆ°Motifäº†ï¼Œç‰¹åˆ«æ˜¯åœ¨è‡ªç”±è½¯ä»¶ä¸–ç•Œã€‚åŸå› æ˜¯ï¼šå°±è®¸å¯ã€æ€§èƒ½ï¼ˆMotifè¢«æ™®éè®¤ä¸ºåƒä¸€å¤´çŒªï¼‰å’ŒåŠŸèƒ½è€Œè¨€å·²ç»æœ‰äº†æ›´å¥½çš„æ›¿ä»£å“ã€‚\næœ‰ä¸€ä¸ªçŸ¥åå¹¶å¹¿æ³›ä½¿ç”¨çš„å·¥å…·åŒ…æ˜¯Gtkï¼Œå®ƒæ˜¯GIMPé¡¹ç›®ä¸“é—¨è®¾è®¡ç”¨æ¥æ›¿ä»£Motifçš„ã€‚Gtkç°åœ¨éå¸¸æµè¡Œï¼Œå› ä¸ºå®ƒç›¸å¯¹è¾ƒè½»ï¼ŒåŠŸèƒ½ä¸°å¯Œï¼Œå¯æ‰©å±•ï¼Œè€Œä¸”å®Œå…¨å…è´¹ã€‚GIMPçš„0.6å‘è¡Œç‰ˆçš„æ›´æ–°æ—¥å¿—é‡ŒåŒ…å«äº†â€œBloatif has been zorched â€ï¼Œè¿™å¥è¯æ˜¯ç»™Motifçš„è‡ƒè‚¿çš„é—å˜±ã€‚\nå¦ä¸€ä¸ªç›®å‰å¾ˆæµè¡Œçš„å·¥å…·åŒ…æ˜¯Qtã€‚ç›´åˆ°KDEé¡¹ç›®çš„å‡ºç°ï¼Œå®ƒæ‰å¼€å§‹å‡ºåï¼ŒKDEåˆ©ç”¨äº†Qtçš„æ‰€æœ‰GUIå…ƒç´ ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬ä¸ä¼šæ·±å…¥Qtçš„è®¸å¯é—®é¢˜å’ŒKDE/GNOMEçš„åˆ†ç¦»æ€§ã€‚Gtkè¯´æ¥è¯é•¿ï¼Œå› ä¸ºå®ƒçš„å†å²ä¼´éšç€Motifçš„æ›¿æ¢è€Œå˜çš„å¾ˆæœ‰è¶£ã€‚Qtæ²¡ä»€ä¹ˆå¯è¯´çš„ï¼Œå› ä¸ºå®ƒçœŸçš„å¾ˆæµè¡Œã€‚\næœ€åï¼Œå¦ä¸€ä¸ªå€¼å¾—ä¸€æçš„æ›¿ä»£å“æ˜¯LessTifï¼Œè¿™ä¸ªåå­—æ˜¯å¯¹äºMotifçš„åŒå…³è¯­ï¼ŒLessTifçš„ç›®æ ‡æ˜¯æˆä¸ºå…è´¹çš„ï¼Œå…¼å®¹Motif APIçš„æ›¿ä»£å“ã€‚å¹¶ä¸æ¸…æ¥šLessTifçš„ç›®æ ‡å·²ç»è¾¾åˆ°äº†æ€æ ·çš„ç¨‹åº¦ï¼Œå€’ä¸å¦‚å¸®åŠ©é‚£äº›ä½¿ç”¨Motifä»£ç çš„åº”ç”¨ï¼Œåœ¨å®ƒä»¬æƒ³è¦ç§»æ¤åˆ°å…¶ä»–çš„å·¥å…·åŒ…æ—¶ï¼Œæœ‰ä¸ªä¸€ä¸ªå…è´¹çš„æ›¿ä»£å“ã€‚\n7. ç›®å‰ä¸ºæ­¢æˆ‘ä»¬æ‰€æ‹¥æœ‰çš„ #ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“ï¼ŒXæœ‰ä¸€ä¸ªclient-serveræ¶æ„ï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå°±æ˜¯clientã€‚åœ¨è¿™ä¸ªclient-serveræ¶æ„çš„å›¾å½¢ç³»ç»Ÿä¸‹ï¼Œæœ‰å¤šç§å¯é€‰çš„çª—å£ç®¡ç†å™¨ï¼Œå®ƒç®¡ç†ç€æˆ‘ä»¬çš„å±å¹•ç©ºé—´ã€‚clientæ˜¯æˆ‘ä»¬çœŸæ­£å®Œæˆå·¥ä½œçš„åœ°æ–¹ï¼Œè€Œä¸”ï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„å·¥å…·åŒ…è¿›è¡Œå®¢æˆ·ç«¯ç¼–ç¨‹ã€‚\nå›°å¢ƒå°±ä»è¿™é‡Œäº§ç”Ÿäº†ã€‚å„ç§çª—å£ç®¡ç†å™¨ä½¿ç”¨å„è‡ªä¸åŒçš„æ–¹æ³•ç®¡ç†å®¢æˆ·ç«¯ï¼Œå®ƒä»¬çš„åŠŸèƒ½å’Œå¤–è§‚å„ä¸ç›¸åŒã€‚åŒæ ·çš„ï¼Œç”±äºæ¯ä¸ªå®¢æˆ·ç«¯ä½¿ç”¨ä¸åŒçš„å·¥å…·åŒ…ï¼Œå®ƒä»¬çš„å¤–è§‚å’Œæ€§èƒ½ä¹Ÿä¼šä¸åŒã€‚ç”±äºæ²¡æœ‰äººè¯´ä½œè€…å¿…é¡»ç”¨åŒä¸€ä¸ªå·¥å…·åŒ…å†™åº”ç”¨ç¨‹åºï¼Œä¸‹é¢è¿™ç§æƒ…å†µå¾ˆå¯èƒ½åœ¨ç”¨æˆ·è¿è¡Œç¨‹åºæ˜¯å‡ºç°ï¼Œæ¯”æ–¹è¯´ï¼Œå…­ä¸ªä¸åŒçš„åº”ç”¨ï¼Œéƒ½ä½¿ç”¨ä¸åŒçš„å·¥å…·åŒ…ï¼Œé‚£ä¹ˆå®ƒä»¬çš„å¤–è§‚å’Œæ€§èƒ½ä¹Ÿä¸åŒã€‚è¿™æ˜¯ç”±äºåº”ç”¨ä¹‹é—´çš„åŠŸèƒ½ä¸ä¸€è‡´è€Œé€ æˆçš„å›°å¢ƒã€‚å¦‚æœä½ ä¸€ç›´ä½¿ç”¨ä¸€ä¸ªç”¨é›…å…¸å¨œç»„ä»¶å†™çš„ç¨‹åºï¼Œä½ ä¼šæ³¨æ„åˆ°ï¼Œå®ƒå’Œç”¨Gtkæ‰€å†™çš„ç¨‹åºä¸å¤ªä¸€æ ·ã€‚é€šè¿‡ä½¿ç”¨è¿™äº›å¤–è§‚å’Œä½“éªŒå·®åˆ«å¾ˆå¤§çš„åº”ç”¨ï¼Œä¼šè®©ä½ è®°ä½æ˜¯ä¸€ä¸ªå›°å¢ƒã€‚è¿™åŸºæœ¬ä¸Šå¦å®šäº†ä¸€ä¸ªGUIç¯å¢ƒçš„ä¼˜åŠ¿ã€‚\nä»æŠ€æœ¯è§’åº¦æ¥çœ‹ï¼Œä½¿ç”¨å¤šç§ä¸åŒçš„å·¥å…·åŒ…ä¼šå¢åŠ å¯¹èµ„æºçš„å ç”¨ã€‚ç°ä»£æ“ä½œç³»ç»Ÿéƒ½æ”¯æŒåŠ¨æ€é“¾æ¥åº“ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœæˆ‘æœ‰ä¸¤ä¸‰ä¸ªä½¿ç”¨Gtkçš„åº”ç”¨ç¨‹åºï¼Œè¿˜æœ‰ä¸€ä¸ªGtkåŠ¨æ€é“¾æ¥åº“ï¼Œé‚£ä¹ˆè¿™å‡ ä¸ªåº”ç”¨ç¨‹åºå°†å…±äº«è¿™ä¸ªGtkã€‚è¿™æ ·å°±èŠ‚çœäº†èµ„æºã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœæˆ‘æœ‰ä¸€ä¸ªGtkåº”ç”¨ï¼Œä¸€ä¸ªQtåº”ç”¨ï¼Œä¸€äº›åŸºäºé›…å…¸å¨œçš„ç¨‹åºï¼Œä¸€ä¸ªåŸºäºMotifçš„ç¨‹åºï¼ˆä¾‹å¦‚Netscapeï¼‰ï¼Œä¸€ä¸ªä½¿ç”¨FLTKçš„ç¨‹åºï¼Œè¿˜æœ‰å…¶ä»–ä¸€äº›ä½¿ç”¨XFormsï¼Œé‚£æˆ‘å°±è¦åœ¨å†…å­˜ä¸­åŠ è½½å…­ä¸ªä¸åŒçš„åº“ï¼Œæ¯ä¸ªåº“è¿˜è¦æœ‰ä¸€ä¸ªä¸åŒçš„å·¥å…·åŒ…ã€‚è¯·è®°ä½ï¼Œè¿™äº›å·¥å…·åŒ…æä¾›çš„åŠŸèƒ½åŸºæœ¬ç›¸åŒã€‚\nè¿˜ç”¨å¦å¤–ä¸€äº›é—®é¢˜ã€‚æ¯ä¸€ç§çª—å£ç®¡ç†å™¨çš„å¯åŠ¨ç¨‹åºçš„æ–¹å¼æ˜¯ä¸åŒçš„ã€‚æœ‰äº›çª—å£ç®¡ç†å™¨æœ‰æ¼‚äº®çš„å¯åŠ¨ç¨‹åºèœå•ï¼›æœ‰äº›åˆ™æ²¡æœ‰ï¼Œå®ƒä»¬å¸Œæœ›æˆ‘ä»¬æ‰“å¼€ä¸€ä¸ªç¨‹åºå¯åŠ¨ç®±ï¼Œæˆ–è€…ä½¿ç”¨ä¸€ä¸ªç»„åˆé”®ï¼Œè¦ä¸å°±æ˜¯æ‰“å¼€ä¸€ä¸ªxtermï¼Œç„¶åè°ƒç”¨å‘½ä»¤å¯åŠ¨ä½ çš„ç¨‹åºã€‚æ‰€æœ‰ï¼Œå›°å¢ƒå°±æ˜¯å› ä¸ºæ²¡æœ‰ä¸€ä¸ªæ ‡å‡†ã€‚\næœ€åï¼Œæˆ‘ä»¬çš„è®¡åˆ’æ²¡æœ‰è¦†ç›–åˆ°ä¸€äº›GUIç¯å¢ƒçš„ç»†èŠ‚ã€‚ä¾‹å¦‚æœ‰æ•ˆçš„é…ç½®ï¼Œæˆ–è€…â€œæ§åˆ¶é¢æ¿â€ï¼›è¿˜æœ‰å›¾å½¢æ–‡ä»¶ç®¡ç†å™¨ã€‚å½“ç„¶ï¼Œè¿™äº›å¯ä»¥å†™æˆå®¢æˆ·ç«¯åº”ç”¨ã€‚åœ¨å…¸å‹çš„è‡ªç”±è½¯ä»¶æ—¶å°šä¸­ï¼Œæœ‰æ•°ç™¾ç§æ–‡ä»¶ç®¡ç†å™¨ï¼Œæ•°ç™¾ç§ç³»ç»Ÿé…ç½®ç¨‹åºï¼Œå¯ä»¥æƒ³è±¡ï¼Œå¤„ç†è¿™äº›ä¸åŒçš„è½¯ä»¶ç»„ä»¶å°†æ˜¯æ›´å¤§çš„å›°å¢ƒã€‚\n8. æ¡Œé¢ç¯å¢ƒçš„æ•‘èµ #å…ˆè¯´ä¸€ä¸‹æ¡Œé¢ç¯å¢ƒçš„æ¦‚å¿µæ˜¯æ€ä¹ˆæ¥çš„ã€‚ä¸€ä¸ªæ¡Œé¢ç¯å¢ƒåº”è¯¥æä¾›ä¸€å¥—è®¾æ–½å’ŒæŒ‡å¯¼ï¼Œç”¨äºè§„èŒƒæˆ‘ä»¬ä¹‹å‰æåˆ°çš„æ‰€æœ‰ä¸œè¥¿ï¼Œä»¥ä¾¿æˆ‘ä»¬å‰é¢æåˆ°çš„é—®é¢˜æœ€å°åŒ–ã€‚\næ¡Œé¢ç¯å¢ƒçš„æ¦‚å¿µå¯¹äºLinuxæ¥è¯´æ˜¯æ–°çš„ä¸œè¥¿ï¼Œä½†æ˜¯è¿™äº›ä¸œè¥¿åœ¨å…¶ä»–æ“ä½œç³»ç»Ÿï¼ˆä¾‹å¦‚Windowså’ŒMac OSï¼‰ä¸­æœ¬æ¥å°±å­˜åœ¨ã€‚ä¾‹å¦‚ï¼ŒMacOSï¼Œå®ƒæ˜¯æœ€æ—©çš„å›¾å½¢ç”¨æˆ·æ¥å£ä¹‹ä¸€ï¼Œä¸ºæ•´ä¸ªè®¡ç®—æœºä¼šè¯æä¾›äº†ä¸€ä¸ªéå¸¸ä¸€è‡´çš„æ„Ÿè§‚ã€‚å†ä¾‹å¦‚ï¼Œæ“ä½œç³»ç»Ÿæä¾›äº†å¾ˆå¤šæˆ‘ä»¬å‰é¢æåˆ°çš„ç»†èŠ‚ï¼šå®ƒæä¾›äº†ä¸€ä¸ªé»˜è®¤çš„æ–‡ä»¶ç®¡ç†å™¨ï¼Œä¸€ä¸ªå…¨ç³»ç»Ÿæ§åˆ¶é¢æ¿ï¼Œè¿˜æœ‰ä¸€ä¸ªæ‰€æœ‰åº”ç”¨éƒ½ä½¿ç”¨çš„ç‹¬ç«‹å·¥å…·åŒ…ï¼ˆæ‰€ä»¥å®ƒä»¬çœ‹èµ·æ¥éƒ½å·®ä¸å¤šï¼‰ã€‚åº”ç”¨çª—å£ç”±ç³»ç»Ÿï¼ˆä¸¥æ ¼çš„å°†æ˜¯çª—å£ç®¡ç†å™¨ï¼‰è´Ÿè´£ç®¡ç†ã€‚æœ€åï¼Œè¿˜æœ‰ä¸€å¥—æŒ‡å—å‘Šè¯‰å¼€å‘è€…åº”è¯¥æ€ä¹ˆè¡¨ç°ä»–ä»¬çš„åº”ç”¨ï¼Œå¦‚ä½•è®¾è®¡å¤–è§‚å’Œå¸ƒå±€ï¼Œä»¥åŠæ ¹æ®ç³»ç»Ÿä¸­çš„å…¶ä»–åº”ç”¨è®¾è®¡å¤–è§‚ã€‚æ‰€æœ‰è¿™äº›éƒ½æ˜¯ä¸ºäº†ä¿è¯åº”ç”¨ç¨‹åºçš„ä¸€è‡´æ€§å’Œæ˜“ç”¨æ€§ã€‚\nè¿™å¼•å‡ºäº†ä¸€ä¸ªé—®é¢˜ï¼Œâ€œä¸ºä»€ä¹ˆXçš„å¼€å‘è€…æ²¡æœ‰å°†æ¡Œé¢ç¯å¢ƒçš„äº‹æƒ…æ”¾åœ¨é¦–ä½ï¼Ÿâ€ã€‚è¿™æ˜¯æœ‰é“ç†çš„ï¼›æ¯•ç«Ÿï¼Œè¿™æ ·å°±å¯ä»¥é¿å…å‰é¢æåˆ°çš„æ‰€æœ‰é—®é¢˜ã€‚ç­”æ¡ˆå°±æ˜¯ï¼Œåœ¨Xçš„è®¾è®¡è¿‡ç¨‹ä¸­ï¼Œå®ƒçš„è®¾è®¡è€…é€‰æ‹©å°†å®ƒè®¾è®¡å¾—å°½å¯èƒ½çš„çµæ´»ã€‚æ¯”å¦‚è¯´ï¼ŒMacOSæä¾›äº†å¤§å¤šæ•°æœºåˆ¶/ç­–ç•¥è§„èŒƒï¼Œä½†æ˜¯ä»–ä»¬ä¸é¼“åŠ±äººä»¬ç©å¼„è¿™äº›ä¸œè¥¿ï¼Œç»“æœå°±æ˜¯å¤±å»äº†å¤šåŠŸèƒ½æ€§ï¼Œå¦‚æœæˆ‘ä¸å–œæ¬¢MacOSç®¡ç†çª—å£çš„æ–¹å¼ï¼Œæˆ–è€…å·¥å…·åŒ…æ²¡æœ‰æä¾›æˆ‘éœ€è¦çš„åŠŸèƒ½ï¼Œæˆ‘åªèƒ½æ€ªè‡ªå·±å€’éœ‰ã€‚Xä¸‹å°±ä¸ä¼šå‘ç”Ÿè¿™æ ·çš„äº‹ï¼Œçµæ´»çš„ä»£ä»·å°±æ˜¯æ›´å¤§çš„å¤æ‚æ€§ã€‚\nåœ¨Linux/Unixå’ŒXä¸‹ï¼Œä¸€åˆ‡éƒ½å½’ç»“äºç»Ÿä¸€å’ŒåšæŒã€‚ä»¥KDEä¸ºä¾‹ï¼ŒKDEåŒ…å«ä¸€ä¸ªå•ä¸€çš„çª—å£ç®¡ç†å™¨ï¼ˆkwmï¼‰ï¼Œè´Ÿè´£ç®¡ç†å’Œæ§åˆ¶çª—å£çš„è¡Œä¸ºã€‚å®ƒç”¨äº†ä¸€ä¸ªç‰¹å®šçš„å›¾å½¢å·¥å…·åŒ…ï¼ˆQtï¼‰ï¼Œä»¥è‡³äºKDEåº”ç”¨çš„æ§åˆ¶å’Œå¤–è§‚éƒ½å·®ä¸å¤šã€‚KDEæä¾›äº†ä¸€å¥—æ¡Œé¢ç¯å¢ƒåº“ï¼Œè¿™æ˜¯Qtçš„æ‰©å±•ï¼Œç”¨æ¥å®Œæˆä¸€äº›å¸¸è§çš„ç¼–ç¨‹å·¥ä½œï¼Œä¾‹å¦‚åˆ›å»ºèœå•ã€â€œå…³äºâ€æ¡†ï¼Œç¼–å†™å·¥å…·æ ï¼Œç¨‹åºé—´é€šä¿¡ï¼Œæ‰“å°ï¼Œé€‰æ‹©æ–‡ä»¶ï¼Œç­‰ç­‰ã€‚è¿™ä½¿å¾—ç¨‹åºå‘˜çš„å·¥ä½œæ›´åŠ ç®€å•ï¼Œå¹¶ä¸”æ ‡å‡†åŒ–ã€‚KDEè¿˜ä¸ºç¨‹åºå‘˜æä¾›äº†ä¸€å¥—è®¾è®¡å’Œè¡Œä¸ºæŒ‡å—ï¼Œå¦‚æœæ¯ä¸ªäººéƒ½æŒ‰ç…§æŒ‡å—æ¥åšï¼Œé‚£ä¹ˆKDEç¨‹åºçš„å¤–è§‚å’Œæ“ä½œå°±ä¼šå¾ˆç›¸ä¼¼ã€‚æœ€åï¼ŒKDEè¿˜ä¸ºæ¡Œé¢ç¯å¢ƒæä¾›ä¸€äº›ç»„ä»¶ï¼Œä¸€ä¸ªå¯åŠ¨å™¨é¢æ¿ï¼ˆkpanelï¼‰ï¼Œä¸€ä¸ªæ ‡å‡†çš„æ–‡ä»¶ç®¡ç†å™¨ï¼Œè¿˜æœ‰ä¸€ä¸ªé…ç½®ç¨‹åºï¼ˆæ§åˆ¶é¢æ¿ï¼‰ï¼Œé€šè¿‡å®ƒå¯ä»¥å…¨æ–¹ä½çš„æ§åˆ¶è®¡ç®—æœºç¯å¢ƒï¼Œæ¯”å¦‚è®¾ç½®æ¡Œé¢èƒŒæ™¯å’Œæ ‡é¢˜æ çš„é¢œè‰²ã€‚\nKDEé¢æ¿ç›¸å½“äºWindowsæ“ä½œç³»ç»Ÿçš„ä»»åŠ¡æ ã€‚åœ¨è¿™ä¸Šé¢å¯ä»¥å¯åŠ¨åº”ç”¨ç¨‹åºï¼Œè¿˜å¯ä»¥åœ¨ä¸Šé¢æ˜¾ç¤ºå°†å°ç¨‹åºï¼ˆappletsï¼‰ã€‚å®ƒè¿˜æä¾›äº†å¤§å¤šæ•°ç”¨æˆ·éƒ½ç¦»ä¸å¼€çš„å®æ—¶æ—¶é’Ÿã€‚\n9. ç‰¹å®šæ¡Œé¢ç¯å¢ƒ #æˆ‘ä»¬ä»¥KDEä¸ºä¾‹ï¼Œä½†å®ƒä¸æ˜¯Unixç³»ç»Ÿä¸Šæœ€æ—©çš„æ¡Œé¢ç¯å¢ƒã€‚æœ€æ—©çš„å¯èƒ½æ˜¯CDEï¼ˆCommon Desktop Environmentï¼‰ï¼ŒOSFçš„å¦ä¸€ä¸ªå…„å¼Ÿã€‚æ ¹æ®CDE FAQï¼šâ€œCommon Desktop Environmentæ˜¯Unixçš„æ ‡å‡†æ¡Œé¢ï¼Œä¸ºæœ€ç»ˆç”¨æˆ·ã€ç³»ç»Ÿç®¡ç†å‘˜å’Œåº”ç”¨å¼€å‘è€…æä¾›ä¸€è´¯çš„è·¨å¹³å°æœåŠ¡ã€‚â€å¯æ˜¯ï¼ŒCDEæ²¡æœ‰è¶³å¤Ÿä¸°å¯Œçš„åŠŸèƒ½å’Œæ˜“ç”¨æ€§ã€‚é™¤äº†Motifï¼ŒCDEå‡ ä¹åœ¨è‡ªç”±è½¯ä»¶ä¸–ç•Œæ¶ˆå¤±äº†ï¼Œæœ€ç»ˆè¢«æ›´å¥½çš„å¹³å°æ›¿ä»£ã€‚\nåœ¨Linuxä¸‹ï¼Œæœ€æµè¡Œçš„æ¡Œé¢ç¯å¢ƒæ˜¯KDEå’ŒGNOMEï¼Œä½†æ˜¯ä¸æ­¢è¿™ä¸¤ä¸ªã€‚åœ¨ç½‘ä¸Šå¯ä»¥è½»æ˜“çš„æœç´¢åˆ°åŠæ‰“æ¡Œé¢ç¯å¢ƒï¼šGNUStepã€ROXã€GTK+XFceã€UDEã€‚å®ƒä»¬éƒ½æä¾›å‰é¢æåˆ°çš„åŸºç¡€åŠŸèƒ½ã€‚GNOMEå’ŒKDEæ‹¥æœ‰æ¥è‡ªç¤¾åŒºå’Œä¸šç•Œçš„æœ€å¹¿æ³›çš„æ”¯æŒï¼Œæ‰€ä»¥å®ƒä»¬æ˜¯æœ€ä¼˜ç§€çš„ä¹‹ä¸€ï¼Œä¸ºç”¨æˆ·å’Œåº”ç”¨ç¨‹åºæä¾›å¤§é‡çš„æœåŠ¡ã€‚\næˆ‘ä»¬æè¿‡åœ¨KDEä¸‹æœ‰å¾ˆå¤šæä¾›ç‰¹å®šæœåŠ¡çš„ç»„ä»¶ã€‚ä½œä¸ºä¸€ä¸ªå¥½çš„æ¡Œé¢ç¯å¢ƒï¼ŒGNOMEåœ¨è¿™æ–¹é¢ä¹Ÿä¸€æ ·ã€‚æœ€æ˜æ˜¾çš„å·®åˆ«æ˜¯GNOMEå¹¶ä¸è¦æ±‚ä½¿ç”¨ç‰¹å®šçš„çª—å£ç®¡ç†å™¨ï¼ˆè¿™æ–¹é¢KDEæœ‰kwmï¼‰ã€‚GNOMEä¸€ç›´è¯•å›¾åšåˆ°ä¸çª—å£ç®¡ç†å™¨æ— å…³ï¼Œä½†æ˜¯è¦æ‰¿è®¤ï¼Œå¤§å¤šæ•°ç”¨æˆ·ä¸ä»–ä»¬çš„çª—å£ç®¡ç†å™¨è”ç³»ç´§å¯†ï¼Œè€Œå¼ºè¿«ä»–ä»¬ä½¿ç”¨ä¸åŒçš„çª—å£ç®¡ç†å™¨ä¼šæŸå®³ä»–ä»¬çš„è§‚ä¼—ã€‚GNOMEåŸæœ¬é’çEnlightenmentçª—å£ç®¡ç†å™¨ï¼Œç°åœ¨å®ƒä»¬æ›´å–œæ¬¢ç”¨Sawfishï¼Œä½†æ˜¯GNOMEæ§åˆ¶é¢æ¿ä¸€ç›´æœ‰ä¸€ä¸ªçª—å£ç®¡ç†å™¨é€‰æ‹©æ¡†ã€‚\né™¤æ­¤ä»¥å¤–ï¼ŒGNOMEä½¿ç”¨Gtkå·¥å…·åŒ…ï¼Œå¹¶ä¸”é€šè¿‡gnome-libæä¾›äº†ä¸€å¥—é«˜çº§åŠŸèƒ½å’Œå·¥å…·ã€‚GNOMEæœ‰å®ƒè‡ªå·±çš„ä¸€å¥—ç¼–ç¨‹æ–¹æ³•ï¼Œå¯ä»¥ç¡®ä¿å…¼å®¹çš„åº”ç”¨ä¹‹é—´è¡Œä¸ºä¸€è‡´ï¼›å®ƒæä¾›äº†ä¸€ä¸ªé¢æ¿ï¼Œä¸€ä¸ªæ–‡ä»¶ç®¡ç†å™¨ï¼ˆgmcï¼‰å’Œä¸€ä¸ªæ§åˆ¶é¢æ¿ï¼ˆgnomeæ§åˆ¶ä¸­å¿ƒï¼‰ã€‚\n10. æ€æ ·æŠŠå®ƒä»¬ç»„åˆåˆ°ä¸€èµ· #æ¯ä¸ªç”¨æˆ·éƒ½å¯ä»¥è‡ªç”±çš„é€‰æ‹©æ„Ÿè§‰æœ€å¥½çš„æ¡Œé¢ç¯å¢ƒã€‚æœ€ç»ˆçš„ç»“æœæ˜¯ï¼Œå¦‚æœä½ ä½¿ç”¨çº¯kdeæˆ–çº¯gnomeç³»ç»Ÿï¼Œæ•´ä¸ªç¯å¢ƒçš„æ„Ÿè§‚å°±éå¸¸ä¸€è‡´ï¼›å¹¶ä¸”åº”ç”¨ç¨‹åºä¹‹é—´çš„æ²Ÿé€šä¼šæ›´å¥½ã€‚æˆ‘ä»¬ä¸å¯èƒ½åœ¨ä¸€ä¸ªåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨å¤šç§ä¸åŒçš„å·¥å…·åŒ…ã€‚ç°ä»£Linuxæ¡Œé¢ç¯å¢ƒæä¾›çš„è®¾å¤‡è¿˜ä½¿ç”¨äº†ä¸€äº›å…¶ä»–çš„å°æŠ€æœ¯ï¼Œä¾‹å¦‚ç»„ä»¶æ¶æ„ï¼ˆKDEæœ‰Kpartsï¼ŒGNOMEç”¨Bonoboï¼‰ï¼Œå®ƒå…è®¸ä½ åœ¨æ–‡å­—å¤„ç†æ–‡æ¡£ä¸­åµŒå…¥è¡¨æ ¼æˆ–å›¾è¡¨ï¼›è¿˜æœ‰æ•´ä½“æ‰“å°è®¾å¤‡ï¼Œå°±åƒæ˜¯Windowsä¸­çš„å°åˆ·èƒŒæ™¯ï¼›è¿˜æœ‰è„šæœ¬è¯­è¨€ï¼Œå¯ä»¥è®©æ›´å¤šçš„é«˜çº§ç”¨æˆ·ç¼–å†™ç¨‹åºå°†å¤šä¸ªåº”ç”¨ç»“åˆåˆ°ä¸€èµ·ï¼Œè®©å®ƒä»¬ç”¨æœ‰è¶£çš„æ–¹å¼è¿›è¡Œåä½œã€‚\nåœ¨Unixçš„æ¡Œé¢ç¯å¢ƒæ¦‚å¿µä¸­ï¼Œä¸€ä¸ªç¨‹åºå¯ä»¥åœ¨å¤šä¸ªç¯å¢ƒä¸­è¿è¡Œã€‚æˆ‘å¯ä»¥æƒ³è±¡åœ¨GNOMEä¸­ç”¨Konquerorï¼Œåœ¨KDEä¸­ç”¨Gnumericã€‚å®ƒä»¬åªæ˜¯ç¨‹åºè€Œå·²ã€‚å½“ç„¶ï¼Œä¸€ä¸ªæ¡Œé¢ç¯å¢ƒçš„æ•´ä½“ç†å¿µæ˜¯ä¸€è‡´çš„ï¼Œæ‰€ä»¥ï¼ŒåšæŒä½¿ç”¨é‚£äº›ä½ å–œæ¬¢çš„ç¯å¢ƒä¸­çš„åº”ç”¨æ˜¯æœ‰é“ç†çš„ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ æƒ³è¦å¤„ç†æ‰ä¸€ä¸ªä¸å¤ªåˆé€‚çš„åº”ç”¨ï¼Œå¹¶ä¸”ä¸å½±å“ç¯å¢ƒä¸­çš„å…¶ä»–éƒ¨åˆ†ï¼Œä½ å®Œå…¨å¯ä»¥è‡ªç”±çš„å»åšã€‚\n11. Xç³»ç»Ÿä¸­çš„ä¸€å¤© #ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œåœ¨Linuxç³»ç»Ÿçš„æ¡Œé¢ç¯å¢ƒä¸­ï¼Œä¸€ä¸ªå…¸å‹çš„GNOMEä¼šè¯æ˜¯æ€æ ·è¿è¡Œçš„ã€‚å‡è®¾å®ƒä»¬å·¥ä½œåœ¨Xä¹‹ä¸Šã€‚\nå½“Linuxç³»ç»Ÿå¯åŠ¨Xæ—¶ï¼ŒX serverå¯åŠ¨å¹¶åˆå§‹åŒ–å›¾å½¢è®¾å¤‡ï¼Œç„¶åç­‰å¾…å®¢æˆ·ç«¯çš„åº”ç­”ã€‚é¦–å…ˆå¯åŠ¨gnome-sessiongï¼Œå¹¶ä¸”è®¾ç½®å·¥ä½œä¼šè¯ã€‚ä¸€ä¸ªä¼šè¯åŒ…æ‹¬æˆ‘åŒæ„æ‰“å¼€çš„åº”ç”¨ï¼Œå®ƒä»¬åœ¨å±å¹•ä¸Šçš„ä½ç½®ï¼Œç­‰ç­‰ã€‚ç„¶åå¯åŠ¨é¢æ¿ã€‚é¢æ¿é€šå¸¸å‡ºç°åœ¨å±å¹•çš„åº•éƒ¨ï¼Œæœ‰ç‚¹åƒæ¡Œé¢ç¯å¢ƒçš„ä»ªè¡¨ç›˜ã€‚æˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥å¯åŠ¨ç¨‹åºï¼Œçœ‹åˆ°æ­£åœ¨è¿è¡Œçš„ç¨‹åºï¼Œè¿˜å¯ä»¥æ§åˆ¶å·¥ä½œç¯å¢ƒã€‚ç„¶åï¼Œçª—å£ç®¡ç†å™¨ä¼šå¯åŠ¨ã€‚å› ä¸ºæˆ‘ä»¬æ­£åœ¨ä½¿ç”¨GNOMEï¼Œæ— æ³•ç¡®å®šæ˜¯å“ªç§çª—å£ç®¡ç†å™¨ï¼Œè¿™é‡Œå‡è®¾æ˜¯Sawfishã€‚æœ€åï¼Œæ–‡ä»¶ç®¡ç†å™¨å¯åŠ¨ã€‚æ–‡ä»¶ç®¡ç†å™¨è´Ÿè´£å¤„ç†æ¡Œé¢å›¾æ ‡ã€‚è‡³æ­¤ï¼Œæˆ‘çš„GNOMEç¯å¢ƒå°±å®Œå…¨å‡†å¤‡å¥½äº†ã€‚\nåˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ‰€æœ‰å¯åŠ¨çš„ç¨‹åºéƒ½æ˜¯å®¢æˆ·ç«¯ï¼Œéƒ½è¿æ¥åˆ°äº†X serverã€‚ç°åœ¨æˆ‘ä»¬çœ‹åˆ°çš„X serverå’Œclientæ˜¯åœ¨åŒä¸€å°è®¡ç®—æœºä¸Šï¼Œä½†æ˜¯å°±åƒæˆ‘ä»¬å‰é¢çœ‹åˆ°çš„ï¼Œè¿™ä¸æ˜¯å¿…é¡»çš„ã€‚\nç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥æ‰“å¼€ä¸€ä¸ªxtermæ¥æ‰§è¡Œä¸€äº›å‘½ä»¤ã€‚å½“æˆ‘ä»¬ç‚¹å‡»xtermå›¾æ ‡æ—¶ï¼Œé¢æ¿ä¼šå¯åŠ¨xtermç¨‹åºã€‚å®ƒæ˜¯ä¸€ä¸ªX clientåº”ç”¨ï¼Œæ‰€ä»¥ï¼Œå½“å®ƒå¯åŠ¨æ—¶ä¼šè¿æ¥X serverå¹¶æ˜¾ç¤ºå®ƒçš„ç•Œé¢ã€‚å½“X serverä¸ºxtermåˆ†é…å±å¹•ç©ºé—´æ—¶ï¼Œå®ƒä¼šè®©çª—å£ç®¡ç†å™¨ï¼ˆSawfishï¼‰ä¸ºçª—å£è£…é¥°ä¸€ä¸ªæ¼‚äº®çš„æ ‡é¢˜æ ï¼Œå¹¶å†³å®šå®ƒæ˜¾ç¤ºçš„ä½ç½®ã€‚\nè®©æˆ‘ä»¬ç”¨ä¸€ä¸‹æµè§ˆå™¨ã€‚ç‚¹å‡»é¢æ¿ä¸Šçš„Netscapeå›¾æ ‡ï¼Œå¯åŠ¨ä¸€ä¸ªæµè§ˆå™¨ã€‚è¿™ä¸ªæµè§ˆå™¨å¯ä¸æ˜¯GNOMEçš„è®¾å¤‡ï¼Œå®ƒç”¨çš„æ˜¯Gtkå·¥å…·åŒ…ã€‚æ‰€ä»¥ï¼Œå®ƒå’Œæ¡Œé¢ç¯å¢ƒä¸­çš„å…¶å®ƒéƒ¨åˆ†ä¸æ˜¯ç‰¹åˆ«åè°ƒã€‚\næ¥ç€æ‰“å¼€â€œFileâ€èœå•ã€‚Motifåœ¨å±å¹•ä¸Šæä¾›äº†ä¸€ä¸ªæ§åˆ¶å™¨ï¼Œæ‰€ä»¥ï¼ŒMotifåº“çš„å·¥ä½œå°±æ˜¯é€‚å½“çš„è°ƒç”¨ç›¸å…³çš„Xlibï¼Œä¸ºæ˜¾ç¤ºèœå•åœ¨å±å¹•ä¸Šç»˜åˆ¶å¿…è¦çš„å…ƒç´ ï¼Œå¹¶ä¸”è®©æˆ‘é€‰æ‹©â€œexitâ€é€‰é¡¹æ¥å…³é—­åº”ç”¨ã€‚\nç°åœ¨æˆ‘ä»¬æ‰“å¼€ä¸€ä¸ªGnumericç”µå­è¡¨æ ¼ã€‚æœ‰äº›æ—¶å€™æˆ‘éœ€è¦ç”¨åˆ°xtermï¼Œæ‰€ä»¥æˆ‘ç‚¹å‡»å®ƒã€‚Sawfishæ£€æµ‹åˆ°äº†æˆ‘çš„åŠ¨ä½œï¼Œç„¶åå¯¹ç°æœ‰çš„çª—å£åšäº›æ”¹å˜ï¼Œå°†xtermæ”¾åœ¨äº†æœ€ä¸Šå±‚ï¼Œå¹¶ä¸”å°†ç„¦ç‚¹ç§»åŠ¨åˆ°xtermä¸Šé¢ï¼Œè¿™æ ·æˆ‘å°±å¯ä»¥åœ¨å®ƒä¸Šé¢å·¥ä½œäº†ã€‚\nä¹‹åï¼Œæˆ‘å›åˆ°ç”µå­è¡¨æ ¼ï¼Œæƒ³è¦æ‰“å°è¿™ä¸ªæ–‡æ¡£ã€‚Gnumericæ˜¯ä¸€ä¸ªGNOMEåº”ç”¨ï¼Œæ‰€ä»¥å®ƒå¯ä»¥ä½¿ç”¨GNOMEç¯å¢ƒæä¾›çš„è®¾å¤‡ã€‚å½“æˆ‘æ‰“å°æ—¶ï¼ŒGnumericè°ƒç”¨gnome-printåº“ï¼Œè¿æ¥æ‰“å°æœºå¹¶ä¸”æ‰“å°ã€‚\n12. ç‰ˆæƒå’Œè®¸å¯ #Copyright (c) 2001 by Daniel Manrique\nåœ¨è‡ªç”±è½¯ä»¶ç¤¾åŒºå‘è¡Œçš„GNU Free Documentation Licenseï¼ŒVersion1.1æˆ–ä¹‹åç‰ˆæœ¬çš„æ¡æ¬¾ä¸‹ï¼ˆä¸åŒ…å«ä¸å˜ç« èŠ‚ã€å°é¢æ–‡å­—å’Œå°åº•æ–‡å­—ï¼‰ï¼Œæˆäºˆå¤åˆ¶ã€å‘å¸ƒå’Œä¿®æ”¹è¯¥æ–‡æ¡£çš„æƒé™ã€‚åœ¨è¿™é‡Œå¯ä»¥æ‰¾åˆ°è®¸å¯åè®®çš„è¡£æœæ‹·è´ã€‚\n","date":"2012 February 27","permalink":"/posts/2012/02/27/","section":"Posts","summary":"åŸæ–‡ï¼š","title":"X Window æ¶æ„æ¦‚è¿°"},{"content":"ä»Šå¤©æ˜¯å¹´å‰æœ€åä¸€å¤©ä¸Šç­ï¼Œè¦åœ¨ Fedora7 ä¸‹å®‰è£…ä¸€æ¬¾ USB æ— çº¿ç½‘å¡â€”â€” TP-Link çš„ WN321G+ï¼Œè¯¥ç½‘å¡ä½¿ç”¨çš„æ˜¯ rt73 èŠ¯ç‰‡ï¼Œå±äº Ralink èŠ¯ç‰‡ç»„ï¼Œå®‰è£…è¿‡ç¨‹ä¸­é‡åˆ°äº†ä¸€ä¸‹é—®é¢˜ï¼Œæœ€åæ€»ç®—æˆåŠŸäº†ï¼Œè®°å½•ä¸€ä¸‹ã€‚\næ’ä¸Šusbç½‘å¡ï¼Œç”¨ lsusb å‘½ä»¤å°±å¯ä»¥çœ‹åˆ°è®¾å¤‡ï¼š\nBus 004 Drvice 003ï¼š ID 148f:2573 Ralink Technology,Corp fedora7 å·²ç»å¸¦äº† rt73 çš„é©±åŠ¨ï¼Œç”¨å¦‚ä¸‹å‘½ä»¤å³å¯åŠ è½½ï¼š\nmodprobe rt73usb å¯æ˜¯åŠ è½½äº†é©±åŠ¨åï¼Œç½‘å¡è¿˜æ˜¯ä¸èƒ½ç”¨ï¼Œç”¨ iwconfig å‘½ä»¤ä¹Ÿæ²¡æœ‰çœ‹åˆ°æ— çº¿ç½‘å¡ï¼Œç”¨ dmesg å‘½ä»¤çœ‹åˆ°ä¸€æ¡é”™è¯¯ä¿¡æ¯ï¼š\nError-connt read firmware æ— æ³•è¯»å–å›ºä»¶ï¼ŒåŸå› ä¸æ˜ã€‚\næ— å¥ˆåªèƒ½ä¸‹è½½åœ¨ä¸€ä¸ªæ–°çš„é©±åŠ¨ï¼Œç¼–è¯‘å®‰è£…ï¼Œé©±åŠ¨åç§°æ˜¯ï¼š\nrt73-k2wrlz-3.0.3-3 ä¸‹è½½åœ°å€ï¼š http://homepages.tu-darmstadt.de/~p_larbig/wlan/rt73-k2wrlz-3.0.3.tar.bz2\nä¸‹è½½åè§£å‹ï¼ŒæŒ‰ç…§READMEæ–‡ä»¶çš„æè¿°è¿›è¡Œç¼–è¯‘å®‰è£…ï¼š\ntar -xvf rt73-k2wrlz-3.0.3-3.tar.bz2 cd rt73-k2wrlz-3.0.3-3/Module make make install modprobe rt73 ifname=wlan0 å®‰è£…æˆåŠŸã€‚\nç”¨ iwconfig å¯ä»¥çœ‹åˆ° wlan0 çš„ç›¸å…³ä¿¡æ¯ï¼Œ\nåœ¨ /etc/sysconfig/network-scripts ç›®å½•ä¸‹æ·»åŠ  ifcfg-wlan0 æ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š\nDEVICE=wlan0 ONBOOT=yes ROOTPROTO=dhcp ä¿å­˜ï¼Œé€€å‡ºï¼Œç”¨ ifup wlan0 å‘½ä»¤å¯åŠ¨ç½‘å¡ã€‚\nç”¨ iwlist wlan0 scan å¯ä»¥çœ‹åˆ°å¯ç”¨çš„æ— çº¿è·¯ç”±å™¨ã€‚ ç”¨ iwconfig wlan0 ap [mac] å‘½ä»¤è¿æ¥åˆ°å¯ç”¨çš„æ— çº¿è·¯ç”±å™¨çš„MACåœ°å€ã€‚\nå·¥ä½œå®Œæˆï¼Œå¼€å¿ƒå›å®¶ã€‚\nP.S.:\nmake åå¯èƒ½ä¼šæŠ¥ warningï¼šModule file much too bigï¼Œç”¨ strip å‹ç¼©å³å¯ï¼š\nstrip --strip-debug rt73.ko åŸæ¥ 2.7M çš„é©±åŠ¨æ–‡ä»¶å‹ç¼©ååªæœ‰200KBã€‚\næœ€è¿‘å‘ç°è¯¥é©±åŠ¨ä¸å¤ªç¨³å®šï¼Œç»å¸¸ä¼šè¿ä¸ä¸Šæ— çº¿è·¯ç”±ï¼Œæœ€ç»ˆæ›´æ¢ä¸ºèŠ¯ç‰‡å‚å•† Ralink æä¾›çš„é©±åŠ¨ã€‚\nä¸‹è½½åœ°å€ï¼šhttp://www.ralinktech.com/en/04_support/support.php?sn=501\næ–‡ä»¶åï¼š2011_0210_RT73_Linux_STA_Drv1.1.0.5.bz2\nå®‰è£…æ–¹æ³•å‚è€ƒReadmeæ–‡ä»¶ã€‚\nå‚è€ƒï¼š\nWireless Setupï¼šhttps://wiki.archlinux.org/index.php/Wireless_Setup\nrt73-k2wrlz-3.0.3-3ï¼šhttp://aur.archlinux.org/packages.php?ID=15377\nRt2x00 beta driverï¼šhttps://wiki.archlinux.org/index.php/Using_the_new_rt2x00_beta_driver\n","date":"2012 January 17","permalink":"/posts/2012/01/17/","section":"Posts","summary":"ä»Šå¤©æ˜¯å¹´å‰æœ€åä¸€å¤©ä¸Šç­ï¼Œè¦åœ¨ Fedora7 ä¸‹å®‰è£…ä¸€æ¬¾ USB æ— çº¿ç½‘å¡â€”â€” TP-Link çš„ WN321G+ï¼Œè¯¥ç½‘å¡ä½¿ç”¨çš„æ˜¯ rt73 èŠ¯ç‰‡ï¼Œå±äº Ralink èŠ¯ç‰‡ç»„ï¼Œå®‰è£…è¿‡ç¨‹ä¸­é‡åˆ°äº†ä¸€ä¸‹é—®é¢˜ï¼Œæœ€åæ€»ç®—æˆåŠŸäº†ï¼Œè®°å½•ä¸€ä¸‹ã€‚","title":"åœ¨Fedora7ä¸‹å®‰è£…USBæ— çº¿ç½‘å¡TL-WN321G"},{"content":"ç¯å¢ƒï¼šRedhat9.02\nå¯åŠ¨çº§åˆ«ï¼š3\n1. é…ç½®å†…æ ¸ï¼š #é¦–å…ˆè¦å†ç¼–è¯‘å†…æ ¸æ˜¯é€‰ä¸­å¦‚ä¸‹å‡ é¡¹ï¼š\nCode maturity level options ---\u0026gt;[*] Prompt for development and/or incomplete code/drivers Processor type and features ---\u0026gt;[*] MTRR (Memory Type Range Register) support Block Devices -\u0026gt;[*] Loopback device support [*] RAM disk support (4096) Default RAM disk size [*] Initial RAM disk (initrd) support Console Drivers -\u0026gt;[*] VGA text console [*] Videomode selection support Console Drivers -\u0026gt; Frame-buffer support -\u0026gt;[*] Support for frame buffer devices [*] VESA VGA graphics console [*] Use splash screen instead of boot logo 2. é…ç½®Bootloader # Grub ä¿®æ”¹/etc/grub.confï¼Œåœ¨kernelé¡¹çš„æœ€åæ·»åŠ vgaå‚æ•°å’Œfbï¼Œä¾‹å¦‚ï¼š\nkernel /boot/vmlinuz-2.4.20-8 ro root=LABEL=/ vga=0x311 fb:on LILO\nä¿®æ”¹/etc/lilo.confï¼Œæ·»åŠ vgaå‚æ•°ï¼Œä¾‹å¦‚ï¼š\nvga=0x311 ä¿®æ”¹åæ‰§è¡Œliloå‘½ä»¤ï¼Œå†™å…¥bootloaderã€‚\nvgaå‚æ•°çš„å¯é€‰å€¼å¦‚ä¸‹ï¼š\nä¿®æ”¹åé‡å¯ç³»ç»Ÿï¼Œä¼šåœ¨å³ä¸Šè§’çœ‹åˆ°ä¸€ä¸ªLinuxçš„ä¼é¹…Logoã€‚\n","date":"2011 December 14","permalink":"/posts/2011/12/14/","section":"Posts","summary":"ç¯å¢ƒï¼šRedhat9.02","title":"æ€æ ·è®¾ç½®Framebuffer"},{"content":"åŸæ–‡ï¼š\nHow To Create a GNU Autoconf / Automake Based Configure Script for Your Application\nhttp://www3.fh-swf.de/fbin/roth/download/prg3.howto_autoconfmake.pdf\nby Prof.Dr. Walter Roth\nUniversity of Applied Science Suedwestfalen, Germany\nTranslated by Bob\n2011-11-18\nEmailï¼š gexbob@gmail.com\nBlogï¼šhttp://shaocheng.li\n1. æœ¬æ–‡æ¡£çš„åŸºæœ¬ä¿¡æ¯ #1.1. å°åˆ· #æœ‰äº›å­—ä½“æ¯”è¾ƒéš¾è®¤ï¼Œæ‰€ä»¥ç”¨ä¸‹é¢è¿™ä¸ªè¡¨ç»™å‡ºä¸€äº›å­—ç¬¦çš„å›¾åƒï¼Œè¿™å¯¹å‘½ä»¤å¾ˆé‡è¦ã€‚æœ¬æ–‡æ¡£ç”¨ Times New Roman çš„ 12 å·å­—ä½“å†™æ™®é€šæ–‡æœ¬ï¼Œç”¨ Courier çš„ 11 å·å­—ä½“å†™å‘½ä»¤è¡Œå’Œæºä»£ç ã€‚æ³¨æ„ï¼šåŒçº¿å¯èƒ½ä¼šç”»æˆä¸€ä¸ªæ¯”è¾ƒé•¿çš„å•çº¿\n1.2. åè¯å®šä¹‰ #åº”ç”¨ï¼ˆApplicationï¼‰æ˜¯æŒ‡ä½ å¼€å‘çš„ç¨‹åºã€‚\nç›®æ ‡ç³»ç»Ÿï¼ˆtarget systemï¼‰æ˜¯ç”¨äºå®‰è£…ä½ çš„ç¨‹åºçš„è®¡ç®—æœºã€‚\nå¼€å‘ç³»ç»Ÿï¼ˆdevelopment systemï¼‰æ˜¯æŒ‡å¼€å‘ç¨‹åºæ‰€ç”¨è®¡ç®—æœº\n2. ä¸ºä»€ä¹ˆä½¿ç”¨GNU AutoXXX Toolsï¼Ÿ #ä½¿ç”¨ Autoconf å’Œ Automake æ˜¯å”¯ä¸€çš„ï¼ˆåˆç†çš„ï¼‰ä¸ºä½ çš„åº”ç”¨åˆ›å»º Makefile çš„æ–¹æ³•ï¼Œåªè¦ä½ çš„åº”ç”¨å·¥ä½œåœ¨ä»»ä½•æœ‰ GNU å·¥å…·çš„ç³»ç»Ÿä¸Šã€‚GNU å·¥å…·å¯ç”¨äºæ‰€æœ‰çš„ Unixã€Windowsï¼ˆCywinï¼‰å’Œ MacOS ç³»ç»Ÿ\n3. å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ #GNU Autoconf ç”±å¤šä¸ªç¨‹åºç»„æˆï¼Œæœ€ç»ˆç”±å®ƒä»¬ä¸ºä½ çš„åº”ç”¨åˆ›å»º Makefileã€‚å®ƒä¼šä¸ºæºç çš„æ¯ä¸ªå­ç›®å½•åˆ›å»ºä¸€ä¸ª Makefileã€‚ç”±äºMakefile æ˜¯é’ˆå¯¹ç‰¹å®šçš„ç”¨æˆ·æœºå™¨çš„ï¼ˆç›®æ ‡ç³»ç»Ÿï¼‰ï¼Œä¹Ÿå°±æ˜¯ä½ çš„ç¨‹åºè¿è¡Œçš„ç³»ç»Ÿï¼Œæ‰€ä»¥å¿…é¡»åœ¨ç”¨æˆ·æœºå™¨ä¸Šåˆ›å»ºã€‚ç›®æ ‡ç³»ç»Ÿçš„æ‰€æœ‰ä¿¡æ¯å¯¹äºè¿™ä¸ªæœºå™¨éƒ½æ˜¯å¯ç”¨çš„ã€‚Makefile æ˜¯ç”±å†—é•¿çš„è„šæ­¥ç¨‹åºâ€œconfigureâ€åˆ›å»ºçš„ï¼Œè¿™ä¸ªè„šæœ¬å¿…é¡»éšä½ çš„æºä»£ç ä¸€èµ·æä¾›ã€‚åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šï¼Œconfigure æ˜¯æ ¹æ®å®ƒè¿è¡Œçš„ä¸€äº›æµ‹è¯•ç»“æœæ¥åˆ›å»º Makefile çš„ï¼Œè¿™äº›ç»“æœå·²ç»äº‹å…ˆå†™åœ¨äº† Makefile.amæ–‡ä»¶ã€‚Makefile æ”¯æŒå¾ˆå¤šä¸åŒçš„ç›®æ ‡ï¼Œç¬¬ä¸€ä¸ªå°±æ˜¯â€œallâ€ã€‚make all ä¼šä¸ºä½ çš„ç¨‹åºåˆ›å»ºäºŒè¿›åˆ¶æ–‡ä»¶ã€‚install ç›®æ ‡ä¼šå®‰è£…è¿™äº›äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œuninstall ç”¨äºå¸è½½ã€‚è¿™æ ·çš„è¯ï¼Œç”¨æˆ·å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„ä½¿ç”¨ä½ çš„ç¨‹åºï¼Œåªéœ€åº”ç”¨çš„é¡¶å±‚ç›®å½•ä¸Šï¼Œè¿è¡Œå¦‚ä¸‹ä¸‰æ¡å‘½ä»¤å³å¯ï¼š\n./configure make make install ç¬¬äºŒæ¡å‘½ä»¤å°±ç›¸å½“äº make allï¼Œå› ä¸º all æ˜¯ç¬¬ä¸€ä¸ªç›®æ ‡ã€‚å½“ç„¶ï¼Œç›®æ ‡ç³»ç»Ÿå¿…é¡»æœ‰å¯ç”¨ make å·¥å…·å’Œä¸€ä¸ªç¼–è¯‘å™¨ã€‚ä½†æ˜¯ï¼Œè¿™è¦ç”¨ configure æ£€æŸ¥ï¼Œå¦‚æœ configure æ²¡æœ‰æ‰¾åˆ°æ‰€æœ‰å®ƒéœ€è¦çš„ç¨‹åºï¼Œå®ƒä¼šåœæ­¢å¹¶è¿”å›é”™è¯¯ä¿¡æ¯ã€‚ å¯æ˜¯ï¼Œå¿…é¡»åœ¨ä½ çš„ç³»ç»Ÿä¸Šåˆ›å»º configure è„šæœ¬ï¼Œè¿™æ˜¯ä¸ªéå¸¸å¤æ‚çš„ä»»åŠ¡ã€‚\n4. ä½ éœ€è¦ä»€ä¹ˆï¼Ÿ #é¦–å…ˆï¼Œéœ€è¦ä½ çš„æºç ã€‚ç¡®ä¿å¤„åœ¨é¡¶å±‚ç›®å½•ï¼Œå¹¶ä¸”åŒ…å«äº†æ‰€æœ‰çš„æ–‡ä»¶ï¼Œç¼–è¯‘æ—¶ä¸ä¼šæŠ¥é”™ã€‚\nä½ å¯èƒ½è¦æ·»åŠ ä¸€äº›æ–°æ–‡ä»¶ï¼Œä¸ºä½ çš„åº”ç”¨æä¾›ä¸€äº›å¿…è¦çš„æ–‡æ¡£ã€‚ä¸‹é¢è¿™äº›æ–‡ä»¶æ˜¯å¿…é¡»å­˜åœ¨äºé¡¶å±‚ç›®å½•çš„ï¼š\nINSTALLï¼šå®‰è£…æè¿°ã€‚ä½ å¯ä»¥ä»å…¶ä»–åŸºäºautomakeçš„åº”ç”¨ä¸­æ‹·è´ä¸€ä¸ªæ ‡å‡†çš„INSTALLæ–‡ä»¶ï¼Œç„¶åæ·»åŠ ä¸€äº›é’ˆå¯¹ä½ çš„åº”ç”¨çš„ä¿¡æ¯ã€‚ READMEï¼šç”¨æˆ·åº”è¯¥çŸ¥é“çš„ä¸€äº›å…³äºæœ¬åº”ç”¨çš„ä¿¡æ¯ã€‚æœ€å¥½åœ¨æ–‡ä»¶çš„å¼€å§‹å¤„ç®€å•æè¿°ä¸€äº›è¿™ä¸ªåº”ç”¨çš„ç›®çš„ AUTHORSï¼šä½œè€…åˆ—è¡¨ã€‚ NEWSï¼šå…³äºæœ¬åº”ç”¨çš„æœ€æ–°çš„æ–°é—» ChangLogï¼šæœ¬åº”ç”¨çš„ä¿®è®¢å†å² è¿™äº›æ–‡ä»¶å¯ä»¥ä¸åŒ…å«ä»»ä½•å†…å®¹ï¼Œå› æ­¤ï¼Œç¬¬ä¸€æ¬¡è¿è¡Œæ—¶ï¼Œä½ å¯ä»¥åªåˆ›å»ºä¸€äº›ç©ºæ–‡ä»¶ã€‚ä½†æ˜¯ï¼Œè¿™äº›æ–‡æ¡£å¯¹ç”¨æˆ·æ˜¯å¾ˆé‡è¦çš„ã€‚ä½ åº”è¯¥èŠ±ç‚¹æ—¶é—´å¥½å¥½çš„å†™äº†å®ƒä»¬ã€‚README æ–‡ä»¶æ˜¯æœ€é‡è¦çš„ä¸€ä¸ªã€‚è®©å®ƒå°½å¯èƒ½çš„ä¿æŠ¤ä¸€äº›æœ‰ç”¨çš„ä¿¡æ¯ã€‚\nç„¶åï¼Œå½“ç„¶æ˜¯éœ€è¦GNUå·¥å…·ã€‚å¹¸è¿çš„æ˜¯ï¼Œç°åœ¨æ‰€æœ‰çš„Linuxå‘è¡Œç‰ˆéƒ½åŒ…å«äº†GNUå·¥å…·ã€‚ä½ å¯ä»¥éªŒè¯ä¸€äº›å®ƒä»¬æ˜¯å¦å·²ç»å®‰è£…ã€‚è¦æ£€æŸ¥çš„è¯ï¼Œåªéœ€é”®å…¥ï¼š\nwhich automake å®ƒä¼šäº§ç”Ÿç±»ä¼¼ä¸‹é¢çš„ç»“æœï¼š\n/usr/bin/automake å¦‚æœè¿”å›çš„æ˜¯ç©ºè¡Œï¼Œå¾ˆå¯èƒ½æ²¡æœ‰å®‰è£…GNUå·¥å…·ã€‚\n5. ä¸€æ­¥ä¸€æ­¥ä¸ºâ€œHello Worldâ€åˆ›å»ºé…ç½®è„šæœ¬ #5.1. ç®€è¯„ #ä¸‹é¢å†…å®¹ä¸­çš„å‘½ä»¤éƒ½ç”¨ Courier å­—ä½“ã€‚æ‰€æœ‰çš„å‘½ä»¤éƒ½å¯ä»¥åœ¨æ™®é€šç”¨æˆ·ä¸­ä½¿ç”¨ï¼Œæ— éœ€å˜æˆ root ã€‚ä¾‹å­ä¸­ä½¿ç”¨çš„åº”ç”¨å«åš myapplicationï¼Œç‰ˆæœ¬æ˜¯ 1.0ã€‚è¯¥åº”ç”¨åªæœ‰ä¸€ä¸ªæ–‡ä»¶å¤¹â€œmyapplicationâ€ï¼Œå•ä¸€æºæ–‡ä»¶ main.cã€‚ä½ è¦è‡ªå·±ç¼–è¾‘æºä»£ç ã€æ–‡æ¡£ã€configure.ac å’Œ makefile.am æ–‡ä»¶ã€‚å…¶ä»–çš„éƒ½å¯ä»¥è‡ªåŠ¨ç”Ÿæˆã€‚\n5.2. å‡†å¤‡æºç  #è¿›å…¥åº”ç”¨çš„é¡¶å±‚ç›®å½•ã€‚\ncd myapplication å»ºç«‹å‰é¢æåˆ°çš„é‚£äº›ç©ºæ–‡æ¡£æ–‡ä»¶ï¼Œç¨åå†å¡«å†™å®ƒä»¬ã€‚\ntouch INSTALL README AUTHORS NEWS ChangeLog 5.3. æ–°å»ºmakefile.am #####5.3.1. æ„å»ºåº”ç”¨\nmakefile.am åŒ…å«äº†å…³äºåº”ç”¨çš„ä¿¡æ¯ï¼Œé…ç½®è„šæœ¬éœ€è¦è¿™äº›ä¿¡æ¯æ¥åˆ›å»ºæœ€ç»ˆçš„ Makefileã€‚å¿…é¡»å»ºç«‹ä¸€ä¸ª makefile.amï¼Œå®ƒçš„å†…å®¹åŒ…æ‹¬ç›®æ ‡ã€æºä»£ç å’Œåº”ç”¨çš„å­ç›®å½•ã€‚ä¸‹é¢æ˜¯ myapplication çš„ makefile.amï¼Œæ²¡æœ‰å­ç›®å½•ï¼š\n##Process this file with automake to create Makefile.in bin_PROGRAMS = myapplication myapplication_SOURCES=main.c ç¬¬ä¸€è¡Œæ˜¯é»˜è®¤çš„å†…å®¹ï¼Œæ¯ä¸ª makefile.am éƒ½å¯ä»¥ä½¿ç”¨ã€‚ç¬¬äºŒè¡Œåˆ—å‡ºäº†è¦å»ºç«‹å’Œå®‰è£…åˆ°ç›®æ ‡ç³»ç»Ÿçš„äºŒè¿›åˆ¶ç¨‹åºæ–‡ä»¶ã€‚æœ¬ä¾‹ä¸­åªæœ‰ä¸€ä¸ª myapplicationï¼Œå®ƒå°†è¢«å®‰è£…åˆ° SuSe9.0 ç³»ç»Ÿçš„ /usr/bin ç›®å½•ä¸‹ï¼Œè¿™æ˜¯ä¸€ä¸ªé»˜è®¤ç›®å½•ã€‚å¦‚æœä½ è¦æ„å»ºå¤šäºä¸€ä¸ªçš„ç¨‹åºï¼Œæˆ–è¦å®‰è£…åˆ°å…¶ä»–ç›®å½•ï¼Œè¯·æŸ¥çœ‹ç¬¬7ç« çš„ Automake æ–‡æ¡£ã€‚\nç¬¬ä¸‰è¡Œåˆ—å‡ºäº†è¯¥åº”ç”¨çš„æ‰€æœ‰æºæ–‡ä»¶ã€‚ç¬¬ä¸€ä¸ªè¯æ˜¯ç”±åº”ç”¨åç§°å’Œ_SOURCESç»„æˆçš„ã€‚\n####5.3.2. å®‰è£…æ–‡ä»¶\nmakefile.am ä¸ä»…ä»…ç®¡ç†åº”ç”¨çš„æ„å»ºè¿‡ç¨‹ï¼Œè¿˜å®šä¹‰äº†è¦å®‰è£…åˆ°ç›®æ ‡ç³»ç»Ÿçš„æ–‡ä»¶çš„ç›®æ ‡è·¯å¾„ã€‚automakeå·²ç»æå‰å®šä¹‰äº†æ ‡å‡†çš„å®‰è£…ç›®å½•ï¼Œå…¶ä¸­æœ€é‡è¦çš„å‡ ä¸ªç›®å½•æ˜¯ï¼š\nprefix ï¼šå®‰è£…ç›®å½•æ ‘çš„é¡¶å±‚ï¼Œæ ‡å‡†æ˜¯/usr/local(KDEæ˜¯/opt/kde) binary ï¼šäºŒè¿›åˆ¶ç¨‹åºçš„ç›®å½• libexecdir ï¼šç¨‹åºçš„åº“çš„ç›®å½• è¿˜æœ‰æ›´å¤šçš„æå‰å®šä¹‰çš„ç›®å½•ï¼Œè¯·é˜…è¯»â€œThe GNU Coding Startdingâ€çš„ç›®å½•å˜é‡ï¼ˆ5ï¼‰ã€‚å®‰è£…åˆ°è¿™äº›ç›®å½•çš„æ–‡ä»¶ä¼šåƒä¸‹é¢è¿™æ ·è¢«åˆ—å‡ºäº†ï¼š\nbin_PROGRAMS=myapplication myapplicationæ–‡ä»¶å°†è¢«æ”¾åˆ°ä¸€ä¸ªbinç›®å½•ä¸‹ã€‚\nå¦‚æœä½ éœ€è¦å°†æŸäº›æ–‡ä»¶å®‰è£…åˆ°éæ ‡å‡†ç›®å½•ä¸‹ï¼Œå°±è¦è‡ªå·±å®šä¹‰ã€‚åå­—å¿…é¡»ä»¥dirä½œä¸ºåç¼€ã€‚ä¾‹å¦‚ï¼š\nhtmldir=$(prefix)/html html ç›®å½•å°±ä¼šå¤„äº prefix ä¹‹ä¸‹ã€‚åœ¨ makefile.am å®šä¹‰è¦å®‰è£…çš„æ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š\nhtml_DATA=usermanual.html é™¤äº†æ ‡å‡†ç›®å½•,automake è¿˜ä¸ºä¸ªåˆ«åŒ…å®šä¹‰äº†ç›®å½•ï¼špkglibdirã€pkgincludedir å’Œ pkgdatadirï¼Œå¯ä»¥ç”¨å®ƒä»¬å°†ä½ çš„æ–‡ä»¶å®‰è£…åˆ°æ ‡å‡†çš„binã€libæˆ–dataç›®å½•ä¸‹çš„ç‹¬ç«‹å­ç›®å½•ã€‚è¿™äº›å®‰è£…ç›®å½•ä¼šç”¨åŒ…çš„åå­—å‘½åã€‚\nå¹¶ä¸æ˜¯æ‰€æœ‰æ–‡ä»¶éƒ½è¦è¢«æœ€ç»ˆå®‰è£…ã€‚ä¾‹å¦‚ï¼Œå›¾æ ‡ï¼ˆæˆ–å›¾æ ‡ï¼‰ï¼Œå®ƒä»¬è¢«ç¼–è¯‘åˆ°å¯æ‰§è¡Œæ–‡ä»¶åå°±ä¸å†éœ€è¦äº†ã€‚ä½†å®ƒä»¬å¹¶ä¸æ˜¯çœŸæ­£çš„æºæ–‡ä»¶ã€‚ç”±äºå®ƒä»¬å¿…é¡»åŒ…å«åœ¨æœ€ç»ˆçš„å‘å¸ƒä¸­ï¼Œæ‰€æœ‰è¦æŠŠå®ƒä»¬ä½œä¸ºEXTRA_distæ–‡ä»¶åˆ—å‡ºäº†ã€‚\n5.4. æ–°å»ºconfigure.ac #æ³¨æ„ï¼šåœ¨æ¯”è¾ƒæ—©çš„ automake å’Œ autoconf ç‰ˆæœ¬ä¸­ï¼Œconfigure.ac è¢«å«åš configure.inã€‚autoscan å·¥å…·ä¼šæ‰«æä½ çš„æºä»£ç ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªé»˜è®¤çš„ configure.ac åˆå§‹æ–‡ä»¶ã€‚å› æ­¤ï¼Œä½ å¯ä»¥åœ¨æºä»£ç çš„é¡¶å±‚ç›®å½•æ‰§è¡Œ autoscanï¼Œç”Ÿæˆä¸€ä¸ª configure.scan æ–‡ä»¶ä½œä¸º configure.ac çš„æ¨¡æ¿ã€‚\nautoscan autoscançš„æ‰§è¡Œç»“æœå¤§æ¦‚æ˜¯è¿™æ ·ï¼š\n# -*- Autoconf -*- # Process this file with autoconf to produce a configure script. AC_PREREQ(2.59) AC_INIT(FULL-PACKAGE-NAME, VERSION, BUG-REPORT-ADDRESS) AC_CONFIG_SRCDIR([config.h.in]) AC_CONFIG_HEADER([config.h]) # Checks for programs. AC_PROG_CXX AC_PROG_CC AC_PROG_CPP AC_PROG_INSTALL AC_PROG_LN_S AC_PROG_MAKE_SET AC_PROG_RANLIB # Checks for libraries. # Checks for header files. # Checks for typedefs, structures, and compiler characteristics. AC_HEADER_STDBOOL AC_C_CONST # Checks for library functions. AC_CONFIG_FILES([Makefile src/Makefile]) AC_OUTPUT ç¼–è¾‘ configure.scan æ–‡ä»¶ï¼Œä¿®æ”¹ä¸‹é¢è¿™å‡ è¡Œï¼š\nAC_INIT(FULL-PACKAGE-NAME, VERSION, BUG-REPORT-ADDRESS) ç”¨ä½ çš„åº”ç”¨çš„åå­—æ›¿æ¢ FULL-PACKAGE-NAME ï¼ŒVERSION å°±æ˜¯å®ƒçš„ç‰ˆæœ¬å·ã€‚BUG-REPORT-ADDRESS åº”è¯¥è®¾ä¸€ä¸ª Email åœ°å€ï¼Œä»¥ä¾¿æŠ¥å‘Š Bugã€‚ä¾‹å¦‚ï¼š\nAC_INIT(myapplication,1.0) æ¥ä¸‹æ¥æ·»åŠ ä¸€è¡Œï¼Œæ¥è°ƒç”¨ automakeã€‚\nAM_INIT_AUTOMAKE(@PACKAGE_NAME@, @PACKAGE_VERSION@) è¿™ä¸€è¡Œä½¿ç”¨ PACKAGE_NAME å’Œ PACKAGE_VERSIONå˜é‡ï¼Œå®ƒä»¬éƒ½æ˜¯ AC_INIT ä¸­å®šä¹‰è¿‡çš„ï¼Œæœ€ç»ˆä¼šä¼ é€’ç»™ automakeã€‚@ è¡¨ç¤ºå®ƒåŒ…å«å­—ç¬¦ä¸²çš„æ˜¯ä¸€ä¸ªå˜é‡æ ‡è¯†ç¬¦ã€‚æ²¡æœ‰ç”¨ @ çš„å­—ç¬¦ä¸²ç›´æ¥æŒ‰å­—é¢ä¼ é€’ï¼Œç»“æœåŒ…å«åœ¨ PACKAGE_NAME_PACKAGE_VERSION ã€‚\nAC_CONFIG_SRCDIR ç”¨äºæ£€æµ‹æºä»£ç ç›®å½•ä¸‹çš„ config.h æ–‡ä»¶ã€‚AC_CONFIG_HEADER è¡¨ç¤ºä½ æƒ³è¦ä½¿ç”¨ä¸€ä¸ªé…ç½®å¤´æ–‡ä»¶ã€‚\nä¸‹é¢çš„å®ç”¨äºæ£€æµ‹æ„å»ºåº”ç”¨æ‰€éœ€çš„å„ç§ç¨‹åºï¼ŒæŠŠä½ éœ€è¦ç”¨åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šçš„ç¨‹åºéƒ½æ·»åŠ åˆ°è¿™é‡Œã€‚\nåœ¨ typedefs è¿™ä¸€ç»„ï¼Œä½ å¯ä»¥æ£€æµ‹ç›®æ ‡æœºå™¨ä¸Šçš„ç³»ç»Ÿçš„ç‰¹æ®Šå±æ€§ã€‚AC_HEADER_STDBOOL æ˜¯ autoscan ä¸ºæœ¬ä¾‹æ·»åŠ çš„ï¼Œç”¨äºæ£€æµ‹ stdbool.h çš„å¯ç”¨æ€§å’Œ C99 çš„ bool ç±»å‹æ˜¯å¦å­˜åœ¨ã€‚AC_C_CONST ç”¨äºæ£€æµ‹ä¾‹ç¨‹æ‰€éœ€çš„å¸¸é‡æœºåˆ¶ã€‚\næœ€åï¼Œä½ å¯ä»¥åœ¨ AC_CONFIG_FILES ä¸­æŒ‡å®šæ‰€æœ‰ä½ æƒ³è¦é…ç½®ç”Ÿæˆçš„ makefile æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶å°†ç”± AC_OUTPUT è¾“å‡ºï¼Œé€šå¸¸å°†å®ƒå¸è½½æ–‡ä»¶çš„æœ€åä¸€è¡Œã€‚\n5.5. æ–°å»ºconfig.h.in #è¿è¡Œ autoheader å¯ä»¥æ ¹æ® configure.ac æ–‡ä»¶åˆ›å»ºä¸€ä¸ª config.h.inã€‚å¦‚æœä½ æƒ³è¦æŒ‡å®š config.h ä¸­åŒ…å« #defineï¼Œå¿…é¡»åœ¨ configure.ac ä¸­å®šä¹‰ã€‚æŸ¥çœ‹ autoconf æ–‡æ¡£ä¸­çš„ AC_CONFIG_HEADERã€‚\nautoheader è¿™æ ·å°±ä¼šå»ºç«‹ config.h æ–‡ä»¶ï¼Œæ–‡ä»¶çš„å†…å®¹æ˜¯ç”¨é¢„å¤„ç†æè¿°åº”ç”¨ç¨‹åºçš„ä»£ç ã€‚ä¸‹é¢è¿™æ®µæ–‡æœ¬æ˜¯ä¾‹ç¨‹çš„ config.h.in æ–‡ä»¶çš„ä¸€éƒ¨åˆ†ã€‚\n/* config.h.in. Generated from configure.in by autoheader. */ * Define to 1 if stdbool.h conforms to C99. */ #undef HAVE_STDBOOL_H /* Define to 1 if the system has the type `_Bool'. */ #undef HAVE__BOOL /* Name of package */ #undef PACKAGE /* Define to the address where bug reports for this package should be sent. */ #undef PACKAGE_BUGREPORT /* Define to the full name of this package. */ #undef PACKAGE_NAME /* Define to the full name and version of this package. */ #undef PACKAGE_STRING /* Define to the one symbol short name of this package. */ #undef PACKAGE_TARNAME /* Define to the version of this package. */ #undef PACKAGE_VERSION /* Define to 1 if you have the ANSI C header files. */ #undef STDC_HEADERS /* Version number of package */ #undef VERSION /* Define to empty if `const' does not conform to ANSI C. */ #undef const 5.6. æ–°å»ºaclocal.m4 #å¾ˆå¹¸è¿æœ‰ä¸€ä¸ªç¨‹åºå¯ä»¥å®Œæˆè¿™ä¸ªå·¥ä½œã€‚åªéœ€æ‰§è¡Œï¼š\naclocal è¿™æ ·å°±åˆ›å»ºäº† aclocal.m4 æ–‡ä»¶ã€‚æ–‡ä»¶ä¸­åŒ…å«äº† autoconf çš„å®ï¼Œå®ƒä»¬å¯ä»¥ç”¨åœ¨ä½ çš„æœºå™¨ä¸Šã€‚æ–‡ä»¶åŒ…å«äº†å®çš„å®Œæ•´æºä»£ç ï¼Œæ‰€ä»¥å¾ˆé•¿ã€‚å¦‚æœæ²¡æœ‰åœ¨ä½ çš„æœºå™¨ä¸Šæ‰¾åˆ°æ‰€æœ‰çš„å®ï¼Œå¯ä»¥å°è¯•ä» autoconf çš„å®æ¡£æ¡ˆï¼ˆwww.gnu.org/software/ac-archiveï¼‰ä¸­æ‰¾ä¸€æ‰¾ã€‚è¿™é‡Œæœ‰å¾ˆå¤šå®ï¼Œå¯ä»¥è§£å†³ä½ é‡åˆ°çš„å¤§éƒ¨åˆ†é—®é¢˜ã€‚å¦å¤–ï¼Œè¿˜æœ‰ BNV_HVE_QT ç”¨äºæ£€æµ‹ Qt åº“ï¼ŒMDL_HAVE_OPENGL ç”¨äºæ£€æµ‹ OpenGLã€‚\nå¦‚æœæ²¡æœ‰æ‰¾åˆ°ä½ æ‰€éœ€çš„å®ï¼Œå°±ä¸å¾—ä¸è‡ªå·±å»å†™äº†ã€‚â€œGoat bookâ€ï¼ˆ1ï¼‰ä¼šå‘Šè¯‰ä½ æ€ä¹ˆåšã€‚\n5.7. æ–°å»ºconfigure #ç°åœ¨ï¼Œautoconf å°±å¯ä»¥ç”¨ autoconfig.ac å’Œ aclocal.m4 åˆ›å»ºä¸€ä¸ªé…ç½®è„šæœ¬äº†ã€‚åªéœ€è¿è¡Œï¼š\nautoconf è¿™æ ·ä¼šäº§ç”Ÿä¸€ä¸ªé…ç½®è„šæœ¬ï¼Œå¯¹äºä¸€ä¸ªGUIåº”ç”¨ï¼Œå¯èƒ½è¶…è¿‡2000è¡Œã€‚\n5.8. æ–°å»ºmakefile.in #makefile.in åŒ…å«å¾ˆå¤šä» makefile.am è‡ªåŠ¨æ·»åŠ çš„ä¿¡æ¯ã€‚makefile.in æ˜¯é…ç½®è„šæœ¬æœ€ç»ˆåˆ›å»º Makefile æ‰€å¿…é¡»çš„ã€‚å¾ˆå¹¸è¿çš„æ˜¯ï¼Œautomake ç¨‹åºå¯ä»¥ä¸ºä½ å®Œæˆè¿™ä¸ªå·¥ä½œã€‚å¯æ˜¯ï¼Œä¸€äº›åº”ç”¨ç¨‹åºå‘å¸ƒåŒ…æ‰€å¿…é¡»çš„æ–‡ä»¶è¿˜æ²¡æœ‰æ·»åŠ åˆ°åº”ç”¨çš„é¡¶å±‚ç›®å½•ã€‚å¦‚æœä½ è¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œautomake å°†ä»GNUå·¥å…·ä¸­æ‹·è´è¿™äº›æ–‡ä»¶ï¼Œç„¶ååˆ›å»º makefile.inï¼š\nautomake -a æˆ–\nautomake --add-missing 5.9. æµ‹è¯•åŒ… #ç°åœ¨ï¼Œé…ç½®è„šæœ¬å·²ç»å‡†å¤‡å¥½äº†ï¼Œå¯ä»¥åœ¨ä»»ä½• GNU æ”¯æŒç³»ç»Ÿä¸Šåˆ›å»º Makefileã€‚configure æ¥å—å¾ˆå¤šå‘½ä»¤è¡Œå‚æ•°ã€‚è¿è¡Œ ./configure å¯ä»¥å¾—åˆ°ä¸€ä¸ªæ¦‚è¿°ã€‚æœ€é‡è¦çš„å‚æ•°å¯èƒ½æ˜¯ \u0026ndash;enable-FEATURE ï¼Œè¿™é‡Œçš„ FEATURE æœ‰å¾ˆå¤šé€‰æ‹©ã€‚å¯¹äºç¨‹åºå¼€å‘è€Œè¨€ï¼Œç»å¸¸è¦ç”¨åˆ° \u0026ndash;enabl-debug=full æ¥é€‰æ‹©è°ƒè¯•ã€‚å¯¹äºç”¨æˆ·ï¼Œ\u0026ndash;prefix å’Œ \u0026ndash;with-LIBRARY-dir å¯ä»¥æ§åˆ¶å¾ˆå¤šå®‰è£…è·¯å¾„ã€‚å…ˆè¯•ä¸€ä¸‹ä¸ç”¨ä»»ä½•å‚æ•°è¿è¡Œ configureã€‚ä¼šåœ¨æºç çš„é¡¶å±‚ç›®å½•äº§ç”Ÿä¸€ä¸ª Makefile ï¼Œprefix è®¾ä¸º /usr/localã€‚åªéœ€é”®å…¥ï¼š\n./configure ä½ å°†çœ‹åˆ°å¾ˆå¤š check\u0026hellip; ä¿¡æ¯ï¼Œæœ€åç»“æŸæ—¶ä¼šå‡ºç°åœ¨ç±»ä¼¼ä¸‹é¢çš„ä¿¡æ¯ï¼š\nconfigure: creating ./config.status config.status: creating makefile config.status: creating config.h config.status: config.h is unchanged config.status: executing depfiles commands ç„¶åï¼Œæµ‹è¯•ä¸€ä¸‹æ–°çš„ makefileï¼š\nmake åº”è¯¥ä¼šæ²¡æœ‰ä»»ä½•é”™è¯¯çš„ç¼–è¯‘åº”ç”¨ã€‚æ³¨æ„ï¼Œä¸è¦ç”¨ root ç”¨æˆ·è¿è¡Œ make installï¼Œå¦åˆ™ä¼šå°†ç¨‹åºå®‰è£…åˆ°é»˜è®¤çš„ prefix ä¸‹ï¼Œé‚£å¾ˆå¯èƒ½æ˜¯ä¸€ä¸ªé”™è¯¯çš„åœ°å€ã€‚è¿è¡Œå¦‚ä¸‹å‘½ä»¤å°±èƒ½å°†åº”ç”¨å®‰è£…åˆ°é»˜è®¤çš„ prefixï¼š\nmake install åªè¦ä½ ä¸æ˜¯ rootï¼Œå°†çœ‹åˆ°å¾ˆå¤šé”™è¯¯ä¿¡æ¯ï¼Œè¿™æ˜¯å› ä¸ºæ²¡æœ‰å†™çš„æƒé™ã€‚ç”¨æ™®é€šç”¨æˆ·è¿è¡Œ make install çš„è¯ï¼Œå¯¹äºå¯»æ‰¾å®‰è£…çš„æ–‡ä»¶ä¼šå¾ˆæœ‰ç”¨ã€‚\nä½ çš„ Makefile æ”¯æŒæ‰€æœ‰çš„æ ‡å‡†çš„ç›®æ ‡ï¼Œä¾‹å¦‚ cleanã€distã€uninstall ç­‰ç­‰ã€‚ è¦å¾—åˆ°ä¸€ä¸ªç¨‹åºçš„å¼€å‘ç‰ˆæœ¬ï¼Œéœ€è¦é‡æ–°è¿è¡Œ configureï¼Œç”Ÿæˆä¸€ä¸ªæ”¯æŒè°ƒè¯•çš„ makefileã€‚\n./configure --enable-debug=full ç„¶åè¿è¡Œï¼š\nmake è¿™æ ·ï¼Œç¼–è¯‘çš„ç¨‹åºå°±åŒ…å«äº†è°ƒè¯•ä¿¡æ¯ã€‚å› æ­¤ï¼Œå¯æ‰§è¡Œæ–‡ä»¶ä¹Ÿä¼šæ¯”ä¹‹å‰ç¼–è¯‘çš„å¤§å¾ˆå¤šã€‚ç°åœ¨ä½ å°±å¯ä»¥åœ¨è°ƒè¯•å™¨ä¸­è¿è¡Œä½ çš„ç¨‹åºäº†ã€‚\n6. æ¯”è¾ƒå¤æ‚çš„åº”ç”¨ #6.1. å¸¦æœ‰å­ç›®å½•çš„åº”ç”¨ #ä½ éœ€è¦åœ¨é¡¶å±‚ç›®å½•ï¼ˆmyapplicationï¼‰å’Œæ¯ä¸ªå­ç›®å½•ï¼ˆsrcã€docã€imgï¼‰éƒ½æœ‰ä¸€ä¸ªmakefile.amã€‚åƒmyapplication/CVSè¿™æ ·çš„å­ç›®å½•ä¸ç®—å‘å¸ƒåŒ…çš„ä¸€éƒ¨åˆ†ï¼Œå¿…é¡»è·³è¿‡ã€‚ç›¸åº”ç›®å½•çš„ç›´æ¥å­ç›®å½•å¿…é¡»åƒä¸‹é¢è¿™æ ·åœ¨ makefile.am ä¸­åˆ—å‡ºäº†ï¼š\nSUBDIRS = subdir1 subdir2 subdir3 ä¸éœ€è¦åœ¨SUBDIRSä¸­æŒ‡å®šå­ç›®å½•ä¸‹çš„ç›®å½•ã€‚æ¯ä¸ªå­ç›®å½•ä¸‹çš„makefile.amåªéœ€æŒ‡å®šæœ¬ç›®å½•ä¸‹çš„ç›´æ¥å­ç›®å½•ã€‚\nä¾‹å¦‚ï¼Œé¡¶å±‚ç›®å½•æ˜¯myapplicationï¼ŒCVSå­ç›®å½•ç”¨äºç®¡ç†CVSï¼Œsrcæ˜¯æºç ï¼Œdocæ˜¯æ–‡æ¡£ï¼Œimgæ˜¯å›¾ç‰‡ï¼Œmyapplication ç›®å½•ä¸‹çš„é¡¶çº§ makefile.am å°±åº”è¯¥æ˜¯è¿™æ ·ï¼š\n##Process this file with automake to create Makefile.in SUBDIRS = src doc img æä¾›ä¸€ä¸ªå¥½ä¸»æ„ï¼Œä¸ºå¤§å¤šæ•° autoXXX å·¥å…·åˆ›å»ºå’Œä½¿ç”¨çš„æ–‡ä»¶ä½¿ç”¨ç”¨ä¸€ä¸ªå«åš admin çš„å•ç‹¬ç›®å½•ã€‚è¿™ä¼šä½¿é¡¶å±‚ç›®å½•æ›´å…·å¯è¯»æ€§ã€‚ä½ è¦åšçš„å°±æ˜¯åœ¨AC_INITåé¢ç›´æ¥æ·»åŠ ï¼š\nAC_CONFIG_AUX_DIR(admin) ç„¶ååœ¨æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ª admin ç›®å½•ï¼Œå®ƒå°±å¯ä»¥è¢« automake ä½¿ç”¨äº†ã€‚\nmkdir admin æºæ–‡ä»¶é€šå¸¸è¢«åˆ—åœ¨ myapplication_SOURCES åˆ—è¡¨ã€‚ä½†æ˜¯ï¼Œè¿™æ¬¡çš„æºæ–‡ä»¶åœ¨ src ç›®å½•ä¸‹ï¼Œæ‰€ä»¥è¦æŠŠå®ƒä»¬åˆ—åœ¨ myapplication/src/makefile.am æ–‡ä»¶ä¸­ã€‚äºŒè¿›åˆ¶æ–‡ä»¶åˆ—è¡¨ bin_PROGRAMS ä¹Ÿåœ¨è¿™ä¸ªæ–‡ä»¶ä¸­æŒ‡å®šã€‚å¦‚ä¸‹ï¼š\n##Process this file with automake to create Makefile.in bin_PROGRAMS = myapplication myapplication_SOURCES = main.c å¯¹äºå…¶ä»–çš„éæºä»£ç æ–‡ä»¶ï¼Œå¦‚æœæƒ³å°†å®ƒä»¬åŒ…å«åœ¨å‘å¸ƒåŒ…ä¸­ï¼Œå°±å¿…é¡»ä½œä¸º EXTRA_DIST æ–‡ä»¶åˆ—å‡ºã€‚å¦‚æœ doc ç›®å½•ä¸­åŒ…å«ä¸€ä¸ª index.html æ–‡ä»¶ï¼Œä½ å¿…é¡»å°†å®ƒæ·»åŠ åˆ° myapplication/doc/makefile.am æ–‡ä»¶çš„ EXTRA_DIST åˆ—è¡¨ä¸­ï¼š\n##Process this file with automake to create Makefile.in EXTRA_DIST = index.html page1.html ä¸‹é¢æ˜¯ myapplication/img ç›®å½•ä¸‹çš„ makefile.am æ–‡ä»¶ï¼š\n##Process this file with automake to create Makefile.in EXTRA_DIST = image1.png image2.bmp è¿è¡Œ autoscanï¼Œå¹¶æŒ‰ç…§3.3èŠ‚æè¿°çš„é‚£æ ·ç¼–è¾‘ configure.scan æ–‡ä»¶ã€‚åœ¨æ–‡ä»¶æœ«å°¾çš„ AC_CONFIG_FILES å®ä¸­ä¸ºæ¯ä¸ªè¦åŒ…å«åœ¨å‘å¸ƒåŒ…çš„å­ç›®å½•åˆ—ä¸€ä¸ª makefile æ–‡ä»¶ã€‚åœ¨é¡¶å±‚ç›®å½•ï¼ˆmyapplicationï¼‰ä¸‹è¿è¡Œï¼š\naclocal autoconf autoheader automake -a é‚£ä¹ˆï¼Œautomake å°†ä¸ºæ¯ä¸ª makefile.in åˆ›å»ºä¸€ä¸ª makefile.amã€‚\n6.2. åº“çš„åº”ç”¨ #####6.2.1. é™æ€åº“\né™æ€åº“çš„æ„å»ºå¾ˆåƒåº”ç”¨ï¼Œå¯æ˜¯ï¼Œç›®æ ‡è¦ç”¨ _LIBRARIES å˜é‡æŒ‡å®šã€‚mylib åº“å¯ä»¥ç”¨ä¸‹é¢çš„è¿™äº›æ–¹å¼æŒ‡å®šï¼š\nå¦‚æœå®ƒè¦è¢«å®‰è£…åœ¨å…¨å±€åº“ç›®å½•ä¸‹ï¼ˆé»˜è®¤ï¼š/usr/libï¼‰ï¼š\nlib_LIBRARIES = mylib.a å¦‚æœå®ƒè¦è¢«å®‰è£…åœ¨åº”ç”¨çš„libç›®å½•ä¸‹ï¼ˆé»˜è®¤ï¼š/usr/myapplication/libï¼‰ï¼š\npkglib_LIBRARIES = mylib.a å¦‚æœå®ƒåªæ˜¯åœ¨æ„å»ºçš„è¿‡ç¨‹ä¸­ä½¿ç”¨ï¼Œä¸éœ€è¦å®‰è£…ï¼š\n[python] view plaincopy noinst_LIBRARIES = mylib.a ####6.2.2. å…±äº«åº“\næ„å»ºå…±äº«åº“æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„é—®é¢˜ï¼Œä½ æœ€å¥½å‚è€ƒä¸€ä¸‹ automake å’Œ libtool çš„æ–‡æ¡£ã€‚è¿™é‡Œä»‹ç»ä¸€ç§ç®€å•æƒ…å†µä¸‹å·¥ä½œæ–¹å¼ï¼šå¯¹äºç”¨ libtool æ„å»ºçš„åº“ä½¿ç”¨ _LTLIBRARIES å®ã€‚åº“çš„åå­—è¦ä»¥ lib å¼€å¤´å¹¶ä»¥ .la ç»“å°¾ï¼ˆä¾‹å¦‚libmylib.laï¼‰ã€‚ä½¿ç”¨ _SOURCESå® æ—¶ï¼Œla å‰é¢çš„ç‚¹(.)å¿…é¡»ç”¨ä¸‹åˆ’çº¿(_)ä»£æ›¿ã€‚å¯¹äºè¦å®‰è£…åˆ° lib ç›®å½•ä¸‹çš„ mylib åº“æ¥è¯´ï¼Œå®ƒçš„å®å¯ä»¥è¿™æ ·å†™ï¼š\nlib_LTLIBRARIES = libmylib.la libmylib_la_SOURCES = mylib.c åœ¨ configure.ac æ–‡ä»¶ä¸­çš„ AC_PROG_CC åé¢æ·»åŠ  AC_PROG_LIBTOOL å®ã€‚è¿™æ ·çš„è¯ï¼Œautoconf å°±ä¼šä¸º configure è„šæœ¬å¢åŠ  libtool æ”¯æŒã€‚\nè¿è¡Œ automake ä¹‹å‰ï¼Œå…ˆè¿è¡Œ libtoolizeï¼Œä¼šæ·»åŠ ä¸€äº› automake æ‰€éœ€çš„æ–‡ä»¶ã€‚\n7. å‚è€ƒæ–‡çŒ® # Gary Vaughan, Ben Elliston, Tom Tromey, Ian Taylor: â€œGNU Autoconf, Automake and Libtoolâ€, New Riders Publishing, 2000, also available online at http://www.gnu.org GNU Automake:http://www.gnu.org/software/automake/manual/automake.html GNU Autoconf:http://www.gnu.org/software/autoconf/manual/autoconf-2.57/autoconf.html Libtool The GNU Coding Standards:http://www.gnu.org/prep/standards/standards.html\u0026gt; ","date":"2011 November 21","permalink":"/posts/2011/11/21/","section":"Posts","summary":"åŸæ–‡ï¼š","title":"ä½¿ç”¨GNU Autoconf/Automakeåˆ›å»ºMakefile"},{"content":"åŸæ–‡ï¼š\nGuide for pkg-config:http://people.freedesktop.org/~dbn/pkg-config-guide.html\nDan Nicholson\nTranslated By Bob\n2011-11-13\nEmail: gexbob@gmail.com\nBlog:http://shaocheng.li\næ¦‚è¿° #è¿™ä¸ªæ–‡æ¡£çš„ç›®çš„æ˜¯ä»ç”¨æˆ·å’Œå¼€å‘è€…çš„è§’åº¦ç»™ä¸€ä¸ª pkg-config å·¥å…·çš„ä½¿ç”¨æ¦‚è¿°ã€‚æœ¬æ–‡å¤ä¹ ä¸€äº› pkg-config èƒŒåçš„æ¦‚å¿µï¼Œæ€æ ·å†™ pkg-config æ–‡ä»¶æ¥æ”¯æŒä½ çš„é¡¹ç›®ï¼Œä»¥åŠæ€æ ·ç”¨ pkg-config é›†æˆç¬¬ä¸‰æ–¹é¡¹ç›®ã€‚\nå…³äº pkg-config çš„æ›´å¤šä¿¡æ¯å¯ä»¥åœ¨ web ç«™ç‚¹å’Œ pkg-config çš„ man æ‰‹å†Œä¸­æ‰¾åˆ°ã€‚\næœ¬æ–‡æ¡£å‡çš„ pkg-config åœ¨ç±»UNIXæ“ä½œç³»ç»Ÿä¸­ä½¿ç”¨ï¼Œä¾‹å¦‚ Linuxã€‚å…¶ä»–å¹³å°å¯èƒ½åœ¨ä¸€äº›ç»†èŠ‚ä¸Šçš„å­˜åœ¨å·®åˆ«ã€‚\nä¸ºä»€ä¹ˆï¼Ÿ #ç°ä»£è®¡ç®—æœºç³»ç»Ÿä½¿ç”¨äº†å¾ˆå¤šåˆ†å±‚ç»„ä»¶ä¸ºç”¨æˆ·æä¾›åº”ç”¨ã€‚å…¶ä¸­ä¸€ä¸ªå›°éš¾å°±æ˜¯å¦‚ä½•æ­£ç¡®çš„æ•´åˆè¿™äº›ç»„ä»¶ã€‚pkg-config ä¼šæ”¶é›†ç³»ç»Ÿä¸­å®‰è£…çš„åº“çš„æ•°æ®ï¼Œç„¶åæä¾›ç»™ç”¨æˆ·ã€‚\nå¦‚æœæ²¡æœ‰ pkg-config è¿™æ ·çš„æ•°æ®ç³»ç»Ÿï¼Œå®šä½è®¡ç®—æœºæä¾›çš„æœåŠ¡å’Œè·å–å®ƒä»¬çš„ç»†èŠ‚ä¼šå¾ˆå›°éš¾ã€‚å¯¹äºå¼€å‘è€…ï¼Œå®‰è£…è½¯ä»¶åŒ…çš„ pkg-config æ–‡ä»¶æå¤§çš„ç®€åŒ–äº†å¯¹ API çš„è·å–ã€‚\nä¸€äº›æ¦‚å¿µ #ä½¿ç”¨ pkg-config çš„åˆçº§é˜¶æ®µæ˜¯ä¸ºç¼–è¯‘å’Œé“¾æ¥ç¨‹åºæ—¶æä¾›å¿…è¦çš„ç»†èŠ‚ã€‚æ•°æ®å­˜å‚¨åœ¨ pkg-config æ–‡ä»¶ä¸­ã€‚è¿™äº›æ–‡ä»¶æœ‰ä¸€ä¸ª .pc çš„åç¼€ï¼Œæ”¾åœ¨ä¸€ä¸ªç‰¹å®šçš„ã€pkg-config å·¥å…·æ‰€çŸ¥é“çš„ä½ç½®ã€‚æˆ‘ä»¬ä¼šåœ¨åé¢æè¿°æ›´å¤šçš„ç»†èŠ‚ã€‚\nè¿™ä¸ªæ–‡ä»¶çš„æ ¼å¼åŒ…æ‹¬é¢„å®šä¹‰çš„å…³é”®å­—å’Œè‡ªç”±å½¢å¼çš„å˜é‡ã€‚ä¾‹å¦‚ï¼š\nprefix=/usr/local exec_prefix=${prefix} includedir=${prefix}/include libdir=${exec_prefix}/lib Name: foo Description: The foo library Version: 1.0.0 Cflags: -I${includedir}/foo Libs: -L${libdir} -lfoo ä»¥é¢„å®šä¹‰å…³é”®å­— Nameï¼šä¸ºä¾‹ï¼Œä»¥å…³é”®å­—å¼€å¤´ï¼Œåé¢è·Ÿä¸€ä¸ªå†’å·å’Œä¸€ä¸ªå€¼ã€‚å˜é‡æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å’Œä¸€ä¸ªå€¼ï¼Œä¾‹å¦‚ prefix= ï¼Œç”¨ç­‰å·åˆ†å¼€ã€‚å…³é”®å­—æ˜¯ç”± pkg-config å®šä¹‰å’Œè¾“å‡ºçš„ã€‚å˜é‡ä¸æ˜¯å¿…é¡»çš„ï¼Œä½†å¯ä»¥è¢«å…³é”®å­—ç”¨æ¥å®šä½å’Œå­˜å‚¨ pkg-config æ²¡æœ‰è¦†ç›–çš„æ•°æ®ã€‚\nè¿™é‡Œåªæ˜¯ç®€å•çš„æè¿°ä¸€ä¸‹å…³é”®å­—ã€‚æ›´æ·±å…¥çš„æè¿°å’Œæ€æ ·æœ‰æ•ˆçš„ä½¿ç”¨å®ƒä»¬å°†åœ¨â€œå†™pkg-configæ–‡ä»¶â€æ®µä¸­ç»™å‡ºã€‚\n**Nameï¼š**ä¸€ä¸ªäººä»¬å¯è¯»çš„é“¾æ¥åº“æˆ–è½¯ä»¶åŒ…çš„åç§°ï¼Œè¿™ä¸å½±å“pkg-configçš„ä½¿ç”¨ï¼Œå®ƒç”¨çš„æ˜¯.pcæ–‡ä»¶çš„åç§°ã€‚\n**Descriptionï¼š**å…³äºè½¯ä»¶åŒ…çš„ç®€å•æè¿°ã€‚\n**URLï¼š**ä¸€ä¸ªURLï¼Œå¯ä»¥åœ¨é‚£é‡Œè·å¾—æ›´å¤šçš„ä¿¡æ¯ï¼Œå¹¶ä¸”ä¸‹è½½è¿™ä¸ªè½¯ä»¶åŒ…ã€‚\n**Versionï¼š**è½¯ä»¶åŒ…çš„ç‰ˆæœ¬ã€‚\n**Requiresï¼š**è¿™ä¸ªè½¯ä»¶åŒ…æ‰€éœ€çš„åŒ…çš„åˆ—è¡¨ã€‚è¿™äº›åŒ…çš„ç‰ˆæœ¬å¯èƒ½ç”¨ä¸€å†™è¿ç®—ç¬¦æ¥æŒ‡å®šï¼š=ã€\u0026gt;ã€\u0026lt;ã€\u0026gt;=ã€\u0026lt;=ã€‚\n**Requires.privateï¼š**è¿™ä¸ªè½¯ä»¶åŒ…æ‰€éœ€çš„ç§æœ‰åŒ…çš„åˆ—è¡¨ï¼Œä¸ä¼šæš´éœ²ç»™åº”ç”¨ã€‚ç‰ˆæœ¬çš„æŒ‡å®šè§„åˆ™ä¸Requiresç›¸åŒã€‚\n**Conflictsï¼š**å¯é€‰ï¼Œæè¿°äº†ä¼šä¸è¿™ä¸ªè½¯ä»¶åŒ…äº§ç”Ÿå†²çªçš„åŒ…ã€‚ç‰ˆæœ¬çš„æŒ‡å®šè§„åˆ™ä¸Requiresç›¸åŒã€‚è¿™ä¸ªåŸŸä¼šæä¾›åŒä¸€ä¸ªåŒ…çš„å¤šä¸ªå®ä¾‹ï¼Œä¾‹å¦‚ï¼šConflicts: bar \u0026lt; 1.2.3, bar \u0026gt;= 1.3.0ã€‚\n**Cflagsï¼š**ä¸ºè¿™ä¸ªè½¯ä»¶åŒ…æŒ‡å®šç¼–è¯‘å™¨é€‰é¡¹ï¼Œä»¥åŠpkg-configä¸æ”¯æŒçš„å¿…è¦çš„åº“ã€‚å¦‚æœæ‰€éœ€çš„åº“æ”¯æŒpkg-configï¼Œåº”è¯¥å°†å®ƒä»¬æ·»åŠ åˆ°Requireså’ŒRequires.privateã€‚\n**Libsï¼š**ä¸ºè¿™ä¸ªè½¯ä»¶åŒ…æŒ‡å®šçš„é“¾æ¥é€‰é¡¹ï¼Œä»¥åŠpkg-configä¸æ”¯æŒçš„å¿…è¦çš„åº“ã€‚ä¸Cflagsçš„è§„åˆ™ç›¸åŒã€‚\n**Libs.privateï¼š**è¿™ä¸ªè½¯ä»¶åŒ…æ‰€éœ€çš„ç§æœ‰åº“çš„é“¾æ¥é€‰é¡¹ï¼Œä¸ä¼šæš´éœ²ç»™åº”ç”¨ã€‚è§„åˆ™ä¸Cflagsç›¸åŒã€‚\nå†™pkg-configæ–‡ä»¶ #ä¸ºä¸€ä¸ªè½¯ä»¶åŒ…åˆ›å»º pkg-config æ—¶ï¼Œé¦–å…ˆè¦ç¡®å®šæ€æ ·æè¿°å®ƒã€‚ä¸€ä¸ªæ–‡ä»¶æœ€å¥½åªç”¨äºæè¿°ä¸€ä¸ªåº“ï¼Œæ‰€ä»¥ï¼Œæ¯ä¸ªè½¯ä»¶åŒ…è‡³å°‘éœ€è¦åƒå®ƒæ‰€éœ€çš„é“¾æ¥åº“é‚£ä¹ˆå¤šçš„ pkg-config æ–‡ä»¶ã€‚\nè½¯ä»¶åŒ…çš„åå­—æ˜¯ç”± pkg-config æ•°æ®æ–‡ä»¶çš„åå­—ç¡®å®šçš„ã€‚å°±æ˜¯æ–‡ä»¶åå»æ‰ .pc åç¼€çš„é‚£ä¸€éƒ¨åˆ†ã€‚é€šå¸¸éƒ½ç”¨åº“çš„åå­—å‘½å .pc æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªå®‰è£… libfoo.so çš„åŒ…ä¼šæœ‰ä¸€ä¸ªç›¸åº”çš„ libfoo.c æ–‡ä»¶æ¥åŒ…å« pkg-config æ•°æ®ã€‚è¿™ä¸æ˜¯å¿…é¡»çš„ï¼Œ.pc æ–‡ä»¶ä»…ä»…æ˜¯ä¸€ä¸ªå¯¹ä½ çš„åº“çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚æ‰€ä»¥ï¼Œfoo.pc æˆ– foolib.pc ä¹Ÿèƒ½æ­£å¸¸å·¥ä½œã€‚\nNameã€Description å’Œ URL çš„å€¼æ˜¯çº¯ç²¹çš„ä¿¡æ¯ï¼Œå®¹æ˜“å¡«å†™ã€‚Version æ¯”è¾ƒæ£˜æ‰‹ï¼Œå®ƒè¦ç¡®ä¿è¿™ä¸ªåŒ…å¯ä»¥è¢«ç”¨æˆ·ä½¿ç”¨ã€‚pkg-config ä½¿ç”¨ RPM ç®—æ³•æ¥è¿›è¡Œç‰ˆæœ¬æ¯”è¾ƒã€‚Version æœ€å¥½æ˜¯ç”¨ç‚¹åˆ†å¼€çš„åè¿›åˆ¶æ•°å­—ï¼Œä¾‹å¦‚ 1.2.3ï¼Œå› ä¸ºå­—æ¯å¯èƒ½å¼•èµ·æ„å¤–çš„ç»“æœã€‚æ•°å­—åº”è¯¥æ˜¯å•è°ƒé€’å¢çš„ï¼Œå¹¶ä¸”è¦ç«Ÿå¯èƒ½å…·ä½“çš„æè¿°è¿™ä¸ªåº“ã€‚é€šå¸¸ä½¿ç”¨åŒ…çš„ç‰ˆæœ¬å·å³å¯ï¼Œè¿™æ ·å¯ä»¥æ–¹ä¾¿ä½¿ç”¨è€…è·Ÿè¸ªã€‚\nåœ¨æè¿°æ›´å¤šçš„æœ‰ç”¨çš„å…³é”®å­—ä¹‹å‰ï¼Œæœ‰å¿…è¦å±•ç¤ºä¸€ä¸‹å˜é‡çš„å®šä¹‰ã€‚æœ€å¸¸è§çš„ç”¨æ³•æ˜¯å®šä¹‰å®‰è£…è·¯å¾„ï¼Œè¿™æ ·å°±ä¸ä¼šä½¿å…¶ä»–å­—æ®µæ˜¾å¾—æ‚ä¹±ã€‚å› ä¸ºå˜é‡æ˜¯æ‰©å¤§é€’å½’çš„ï¼Œåœ¨ç»“åˆ autoconf æ´¾ç”Ÿè·¯å¾„æ—¶ï¼Œè¿™ä¼šå¾ˆæœ‰ç”¨ã€‚\nprefix=/usr/local includedir=${prefix}/include Cflags: -I${includedir}/foo æœ€é‡è¦çš„ pkg-config æ•°æ®å­—æ®µæ˜¯ Requiresï¼ŒRequires.privateï¼ŒCflagsï¼ŒLibs å’Œ Libs.private ã€‚å®ƒä»¬å®šä¹‰çš„æ•°æ®è¢«å¤–éƒ¨é¡¹ç›®ç”¨æ¥ç¼–è¯‘å’Œé“¾æ¥åº“ã€‚\nRequires å’Œ Requires.private å®šä¹‰äº†åº“æ‰€éœ€çš„å…¶ä»–æ¨¡å—ã€‚é€šå¸¸é¦–é€‰ Requires.privateï¼Œä»¥ä¾¿é¿å…ç¨‹åºé“¾æ¥åˆ°ä¸€äº›ä¸å¿…è¦çš„åº“ã€‚å¦‚æœä¸€ä¸ªç¨‹åºä¸ä½¿ç”¨æ‰€éœ€åº“çš„ç¬¦å·ï¼Œå®ƒå°±ä¸åº”è¯¥ç›´æ¥é“¾æ¥åˆ°è¿™ä¸ªåº“ã€‚å¯ä»¥åœ¨ overlinking çš„è®¨è®ºä¸­çœ‹åˆ°æ›´å¤šè¯¦ç»†çš„è§£é‡Šã€‚\nç”±äº pkg-config é€šå¸¸ä¼šå…¬å¼€ Requires åº“çš„é“¾æ¥æ ‡è¯†ï¼Œè¿™äº›æ¨¡å—ä¼šå˜æˆç¨‹åºçš„ç›´æ¥ä¾èµ–ã€‚å¦å¤–ï¼ŒRequires.private ä¸­çš„åº“åªæœ‰åœ¨é™æ€é“¾æ¥æ˜¯æ‰ä¼šè¢«åŒ…å«ã€‚æ­£å› å¦‚æ­¤ï¼Œpkg-config é€šå¸¸åªä¼šé€‚å½“çš„ä» Requires ä¸­çš„åŒä¸€ä¸ªåŒ…ä¸­æ·»åŠ æ¨¡å—ã€‚\nLibs åŒ…å«äº†ä½¿ç”¨åº“æ˜¯æ‰€å¿…é¡»çš„é“¾æ¥æ ‡è¯†ã€‚æ­¤å¤–ï¼ŒLibs å’Œ Libs.private è¿˜åŒ…å«äº† pkg-config ä¸æ”¯æŒçš„åº“çš„é“¾æ¥æ ‡è¯†ã€‚ä¸ Requires ç±»ä¼¼ï¼Œé¦–é€‰å°†å¤–éƒ¨åº“çš„é“¾æ¥æ ‡è¯†æ·»åŠ åˆ° Libs.privateï¼Œè¿™æ ·ï¼Œç¨‹åºå°±ä¸ä¼šè·å¾—é¢å¤–çš„ç›´æ¥ä¾èµ–ã€‚\næœ€åï¼ŒCflags åŒ…å«äº†æ‰€ç”¨çš„åº“çš„ç¼–è¯‘æ ‡è¯†ã€‚ä¸ Libs ä¸åŒï¼ŒCflags æ²¡æœ‰ç§æœ‰å˜ç§ã€‚è¿™æ˜¯å› ä¸ºï¼Œæ•°æ®ç±»å‹å’Œå®å®šä¹‰åœ¨ä»»ä½•é“¾æ¥æƒ…å†µä¸‹éƒ½æ˜¯éœ€è¦çš„ã€‚\nä½¿ç”¨pkg-configæ–‡ä»¶ #å‡è®¾ç³»ç»Ÿä¸­å·²ç»å®‰è£…äº† .pc æ–‡ä»¶ï¼Œpkg-config å·¥å…·å°±è¢«ç”¨æ¥æå–å…¶ä¸­çš„æ•°æ®ã€‚æ‰§è¡Œ pkg-config \u0026ndash;help å‘½ä»¤å¯ä»¥çœ‹åˆ°ä¸€äº›å…³äºå‘½ä»¤é€‰é¡¹çš„ç®€å•æè¿°ã€‚æ·±å…¥çš„æè¿°å¯ä»¥åœ¨ pkg-configï¼ˆ1ï¼‰çš„ man æ‰‹å†Œé¡µä¸­æ‰¾åˆ°ã€‚æœ¬åœ°å°†å¯¹ä¸€äº›å¸¸è§çš„ç”¨æ³•è¿›è¡Œç®€å•çš„æè¿°ã€‚\nå‡è®¾ç³»ç»Ÿä¸­å·²ç»æœ‰äº†ä¸¤ä¸ªæ¨¡å—ï¼šfooå’Œbarã€‚å®ƒä»¬çš„.pcæ–‡ä»¶å¯èƒ½åƒä¸‹é¢è¿™æ ·ï¼š\nfoo.pc: prefix=/usr exec_prefix=${prefix} includedir=${prefix}/include libdir=${exec_prefix}/lib Name: foo Description: The foo library Version: 1.0.0 Cflags: -I${includedir}/foo Libs: -L${libdir} -lfoo bar.pc: prefix=/usr exec_prefix=${prefix} includedir=${prefix}/include libdir=${exec_prefix}/lib Name: bar Description: The bar library Version: 2.1.2 Requires.private: foo \u0026gt;= 0.7 Cflags: -I${includedir} Libs: -L${libdir} -lbar æ¨¡å—çš„ç‰ˆæœ¬å¯ä»¥ç”¨ \u0026ndash;modversion é€‰é¡¹è·å¾—ã€‚\n$ pkg-config --modversion foo 1.0.0 $ pkg-config --modversion bar 2.1.2 è¦æ‰“å°æ¨¡å—çš„é“¾æ¥æ ‡è¯†ï¼Œå°±ç”¨ \u0026ndash;libs é€‰é¡¹ã€‚\n$ pkg-config --libs foo -lfoo $ pkg-config --libs bar -lbar è¯·æ³¨æ„ï¼Œpkg-config å‹ç¼©äº†ä¸¤ä¸ªæ¨¡å— Libs å­—æ®µã€‚è¿™æ˜¯å› ä¸º pkg-config å¯¹ -L æ ‡è¯†æœ‰ç‰¹æ®Šå¤„ç†ï¼Œå®ƒçŸ¥é“ ${libdir} ç›®å½• /usr/lib æ˜¯ç³»ç»Ÿé“¾æ¥å™¨æœç´ è·¯å¾„çš„ä¸€éƒ¨åˆ†ã€‚ä¹Ÿå°±æ˜¯ pkg-config å—åˆ°äº†é“¾æ¥å™¨é€‰é¡¹çš„å½±å“ã€‚\nè¿˜æœ‰å°±æ˜¯ï¼Œè™½ç„¶ foo æ˜¯ bar æ‰€éœ€è¦çš„ï¼Œä½†æ˜¯æ²¡æœ‰è¾“å‡º foo çš„é“¾æ¥æ ‡è¯†ã€‚è¿™æ˜¯å› ä¸ºï¼Œåªä½¿ç”¨ bar åº“çš„åº”ç”¨å¹¶ä¸ç›´æ¥éœ€è¦ fooã€‚å¯¹åº”é™æ€é“¾æ¥ bar çš„åº”ç”¨ï¼Œæˆ‘ä»¬éœ€è¦ä¸¤ä¸ªé“¾æ¥æ ‡è¯†:\n$ pkg-config --libs --static bar -lbar -lfoo è¿™ç§æƒ…å†µä¸‹ï¼Œpkg-configå°±è¦è¾“å‡ºä¸¤ä¸ªé“¾æ¥æ ‡è¯†ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯é™æ€é“¾æ¥çš„åº”ç”¨å¯ä»¥æ‰¾åˆ°æ‰€æœ‰å¿…é¡»çš„ç¬¦å·ã€‚å¦ä¸€æ–¹é¢ï¼Œå®ƒä¼šè¾“å‡ºæ‰€æœ‰çš„Cflagså­—æ®µã€‚\n$ pkg-config --cflags bar -I/usr/include/foo $ pkg-config --cflags --static bar -I/usr/include/foo è¿˜æœ‰ä¸€ä¸ªæœ‰ç”¨çš„é€‰é¡¹ï¼Œ\u0026ndash;existsï¼Œå¯ä»¥ç”¨æ¥æµ‹è¯•æ¨¡å—çš„å¯ç”¨æ€§ã€‚\n$ pkg-config --exists foo $ echo $? 0 æœ€å€¼å¾—æ³¨æ„çš„ pkg-config ç‰¹æ€§æ˜¯å®ƒæ‰€æä¾›çš„ç‰ˆæœ¬æ£€æµ‹ï¼Œå¯ä»¥ç”¨æ¥ç¡®å®šæŸä¸ªç‰ˆæœ¬æ˜¯å¦å¯ç”¨ã€‚\n$ pkg-config --exists foo $ echo $? 0 æœ‰äº›å‘½ä»¤åœ¨ç»“åˆ \u0026ndash;print-errors é€‰é¡¹ä½¿ç”¨æ—¶å¯ä»¥è¾“å‡ºæ›´è¯¦ç»†çš„ä¿¡æ¯ã€‚\n$ pkg-config --exists --print-errors xoxo Package xoxo was not found in the pkg-config search path. Perhaps you should add the directory containing `xoxo.pc' to the PKG_CONFIG_PATH environment variable No package 'xoxo' found ä¸Šé¢çš„ä¿¡æ¯å‡ºç°äº† PKG_CONFIG_PATH ç¯å¢ƒå˜é‡ã€‚è¿™ä¸ªå˜é‡ç”¨æ¥é…ç½® pkg-config çš„æœç´¢è·¯å¾„ã€‚åœ¨ç±» Unix æ“ä½œç³»ç»Ÿä¸­ï¼Œä¼šæœç´¢ /usr/lib/pkconfig å’Œ /usr/share/pkgconfig ç›®å½•ã€‚è¿™é€šå¸¸å·²ç»è¦†ç›–äº†ç³»ç»Ÿå·²ç»å®‰è£…çš„æ¨¡å—ã€‚ä½†æ˜¯ï¼Œæœ‰äº›æœ¬åœ°æ¨¡å—å¯èƒ½å®‰è£…åœ¨äº†å…¶ä»–è·¯å¾„ï¼Œä¾‹å¦‚ /usr/local ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œéœ€è¦æŒ‡å®šæœç´¢è·¯å¾„ï¼Œä»¥ä¾¿ pkg-config å¯ä»¥å®šä½ .pc æ–‡ä»¶ã€‚\n$ pkg-config --modversion hello Package hello was not found in the pkg-config search path. Perhaps you should add the directory containing `hello.pc' to the PKG_CONFIG_PATH environment variable No package 'hello' found $ export PKG_CONFIG_PATH=/usr/local/lib/pkgconfig $ pkg-config --modversion hello 1.0.0 autoconfä¹Ÿæä¾›äº†ä¸€äº›å®ï¼Œå¯ä»¥å°†pkg-configé›†æˆåˆ°é¡¹ç›®ä¸­ã€‚\nPKG_PROG_PKG_CONFIG([MIN-VERSION])ï¼šå®šä½ç³»ç»Ÿä¸­çš„ pkg-config å·¥å…·ï¼Œå¹¶æ£€æµ‹ç‰ˆæœ¬å…¼å®¹æ€§ã€‚ PKG_CHECK_EXISTS(MODULES,[ACTION-IF-FOUND], [ACTION-IF-NOT-FOUND])ï¼šæ£€æµ‹æŒ‡å®šçš„æ¨¡å—æ˜¯å¦å­˜åœ¨ã€‚ PKG_CHECK_MODULES(VARIABLE-PREFIX,MODULES, [ACTION-IF-FOUND], [ACTION-IF-NOT-FOUND]):ï¼šæ£€æµ‹æŒ‡å®šçš„æ¨¡å—æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨ï¼Œå°±æ ¹æ® pkg-config \u0026ndash;cflags å’Œ pkg-config \u0026ndash;libs çš„è¾“å‡ºè®¾ç½® \u0026lt;VARIABLE-PREFIX\u0026gt;_CFLAGS and \u0026lt;VARIABLE-PREFIX\u0026gt;_LIBSã€‚ å¸¸è§é—®é¢˜ # æˆ‘çš„ç¨‹åºä½¿ç”¨äº†xåº“ï¼Œæˆ‘è¯¥æ€ä¹ˆåšï¼Ÿ pkg-config çš„è¾“å‡ºå¯ä»¥åœ¨ç¼–è¯‘å‘½ä»¤ä¸­ä½¿ç”¨ï¼Œå‡è®¾ x åº“å·²ç»æœ‰äº†ä¸€ä¸ªå«åš x.pc çš„ pkg-config æ–‡ä»¶ï¼š\ncc `pkg-config --cflags --libs x` -o myapp myapp.c å°† pkg-config é›†æˆåˆ° autoconf å’Œ automake ä¸­ä½¿ç”¨ä¼šæ›´å¼ºå¤§ã€‚ä½†æ˜¯ï¼Œç”¨ PKG_CONFIG_PATH å®å¯ä»¥å¾ˆå®¹æ˜“çš„åœ¨å»ºç«‹è¿‡ç¨‹ä¸­è®¿é—®å…ƒæ•°æ®ã€‚\nconfigure.ac: PKG_CHECK_MODULES(\\[X], [x]) Makefile.am: myapp_CFLAGS = $(X_CFLAGS) myapp_LDADD = $(X_LIBS) å¦‚æœæ‰¾åˆ°äº† x æ¨¡å—ï¼Œå®ä¼šå¡«å……å’Œæ›¿ä»£ X_CFLAGSå’ŒX_LIBSå˜é‡ã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œä¼šäº§ç”Ÿé”™è¯¯ã€‚é…ç½® PKG_CHECK_MODULES çš„ç¬¬3ã€4ä¸ªå‚æ•°ï¼Œå¯ä»¥æ§åˆ¶æ²¡æœ‰æ‰¾åˆ°æ¨¡å—æ—¶çš„åŠ¨ä½œã€‚\næˆ‘çš„ z åº“å®‰è£…äº†ä¿æŠ¤ libx å¤´çš„å¤´æ–‡ä»¶ã€‚æˆ‘åº”è¯¥åœ¨ z.pc ä¸­æ·»åŠ ä»€ä¹ˆï¼Ÿ\nå¦‚æœ x åº“æ”¯æŒ pkg-configï¼Œå°†å®ƒæ·»åŠ åˆ° Requires.private å­—æ®µã€‚å¦‚æœä¸æ”¯æŒï¼Œå°±é…ç½® Cflags å­—æ®µï¼Œæ·»åŠ ä¸€äº›ä½¿ç”¨ libx å¤´æ—¶æ‰€éœ€çš„ç¼–è¯‘å™¨æ ‡è¯†ã€‚åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œæ— è®ºæ˜¯å¦ä½¿ç”¨äº†\u0026ndash;staticï¼Œpkg-config éƒ½ä¼šè¾“å‡ºç¼–è¯‘å™¨æ ‡è¯†ã€‚\næˆ‘çš„ z åº“å†…éƒ¨ä½¿ç”¨äº† libxï¼Œä½†æ˜¯ä¸èƒ½å†å…¬å¼€ API ä¸­æš´éœ²libxçš„æ•°æ®ç±»å‹ã€‚æˆ‘åº”è¯¥åœ¨ z.pc ä¸­æ·»åŠ ä»€ä¹ˆï¼Ÿ\nåŒæ ·çš„ï¼Œå¦‚æœ x æ”¯æŒ pkg-configï¼Œå°±æŠŠå®ƒæ·»åŠ åˆ° Requires.private ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå°±æ²¡å¿…è¦å‘å‡ºç¼–è¯‘å™¨æ ‡è¯†ï¼Œä½†æ˜¯åœ¨ä»Šå¤©é“¾æ¥æ—¶è¦ç¡®ä¿æœ‰é“¾æ¥å™¨æ ‡è¯†ã€‚å¦‚æœ libx ä¸æ”¯æŒpkg-config ï¼Œå°±å°†å¿…è¦çš„é“¾æ¥å™¨æ ‡è¯†æ·»åŠ åˆ° Libs.privateã€‚\nDan Nicholson \u0026lt;dbn.lists (at) gmail (dot) com\u0026gt;\nCopyright (C) 2010 Dan Nicholson.\nThis document is licensed under the GNU General Public License, Version 2 or any later version.\n","date":"2011 November 19","permalink":"/posts/2011/11/19/","section":"Posts","summary":"åŸæ–‡ï¼š","title":"pkg-configæŒ‡å—"},{"content":"æ¦‚è¿° #æœ€è¿‘è¦å°† Redhat9.02 ç§»æ¤åˆ°ä¸€å—åµŒå…¥å¼ 586 çš„ä¸»æ¿ä¸Šï¼Œç©ºé—´æœ‰é™ï¼Œè¿˜è¦æœ‰å›¾å½¢ç¯å¢ƒï¼Œæ”¯æŒä¸­æ–‡ã€‚æ‰€ä»¥ï¼Œè¦å»ºç«‹ä¸€ä¸ªç²¾ç®€çš„å›¾åƒç¯å¢ƒï¼Œå…ˆé€‰æ‹© TinyX+GTK çš„æ–¹å¼è¿›è¡Œç ”ç©¶ã€‚TinyX æ˜¯ XFree86 é’ˆå¯¹åµŒå…¥å¼çš„ç¼–è¯‘é€‰é¡¹ï¼Œä½“ç§¯å°ï¼Œå¯åŠ¨é€Ÿåº¦å¿«ã€‚ æœ¬æ–‡ä½¿ç”¨è™šæ‹Ÿæœº vmware å®‰è£… Redhat-9.02 æ–‡æœ¬ç³»ç»Ÿï¼Œç„¶åç”¨ XFree86-4.3.0 ç¼–è¯‘ TinyX ï¼Œæœ€åç¼–è¯‘ GTK+-2.0ã€‚\n1. å®‰è£…Redhat-9.02 #åœ¨ vmware ä¸Šæ–°å»ºä¸€ä¸ªè™šæ‹Ÿæœºï¼Œç¡¬ç›˜ç©ºé—´ä¸º 4GBï¼Œå†…å­˜ 512MBã€‚å¼€å§‹å®‰è£… Redhat-9.02ï¼Œé€‰æ‹© linux text æ¨¡å¼ï¼Œä¸­æ–‡å®‰è£…è¯­è¨€ï¼Œswap åˆ†åŒºä¸º 512MBï¼Œå…¶ä½™ç©ºé—´éƒ½æŒ‚è½½åˆ°æ ¹ç›®å½•ä¸‹ã€‚bootloader ç”¨ Grubï¼Œè‡ªå®šä¹‰å®‰è£…è½¯ä»¶åŒ…ï¼Œé€‰æ‹©çš„è½¯ä»¶åŒ…å¦‚ä¸‹ï¼š\nAdministration tools Development Tools Editors Ftp Server Kernel Development NetWork Server Printing Support Server Configuration Tools Sound and Video System Tool é€‰æ‹©ç³»ç»Ÿæ”¯æŒçš„è¯­è¨€ä¸º Chinese+Englishã€‚\nå®‰è£…åå°† /etc/sysconfig/ ä¸‹çš„ i18n æ–‡ä»¶ä¿®æ”¹å¦‚ä¸‹ï¼š\nLC_CTYPE=\u0026quot;zh_CN.GB2312\u0026quot; SUPPORTED=\u0026quot;zh_CN.GB2312:en_US.UTF-8:en_US:en\u0026quot; SYSFONT=\u0026quot;latercyrheb-sun16\u0026quot; SYSFONTACM=\u0026quot;iso01\u0026quot; 2. ç¼–è¯‘libpng-1.2.16 #ç¼–è¯‘ TinyX æ—¶éœ€è¦ png.h æ–‡ä»¶ï¼Œæ‰€ä»¥è¦é‡æ–°å®‰è£… libpngã€‚å…ˆåˆ é™¤åŸæœ‰çš„ libpngï¼š\nrm -rf /usr/lib/libpng* ä¸‹è½½ libpng-1.2.16.tar.bz2 ï¼Œå¤åˆ¶åˆ° /root ç›®å½•ä¸‹è§£å‹ï¼š\ntar -xvjf libpng-1.2.16.tar.bz2 æºç åŒ…ä¸­çš„ README å’Œ INSTALL æ–‡ä»¶æœ‰å…³äº libpng çš„è¯¦ç»†ä¿¡æ¯å’Œç¼–è¯‘å®‰è£…æ–¹æ³•ï¼Œç”¨å¦‚ä¸‹å‘½ä»¤ç¼–è¯‘å®‰è£…ï¼š\ncd /root/libpng-1.2.16 ./configure make make install é»˜è®¤å®‰è£…åœ¨ /usr/local/ ç›®å½•ä¸‹ï¼Œæ”¯æŒ pkg-configï¼Œpkg-config æ–‡ä»¶æ”¾åœ¨ /usr/lib/pkg-config/ ç›®å½•ä¸‹ã€‚å¦‚æœæƒ³å¸è½½ libpngï¼Œæ‰§è¡Œï¼šmake uninstallã€‚\n3.ç¼–è¯‘freetype-2.2.1 #åˆ é™¤åŸæœ‰çš„ freetypeï¼š\nrm -rf /usr/lib/libfreetype* ä¸‹è½½ freetype-2.2.1.tar.gzï¼šhttp://download.savannah.gnu.org/releases/freetype/\nå¤åˆ¶åˆ° /root/ ç›®å½•ä¸‹è§£å‹ï¼š\ntar -xvzf freetype-2.2.1.tar.gz ç¼–è¯‘ã€å®‰è£…ï¼š\ncd /root/freetype-2.2.1 ./configure make make install é»˜è®¤å®‰è£…åˆ° /usr/local/ ç›®å½•ä¸‹ï¼Œæ”¯æŒ pkg-configã€‚\n4.ç¼–è¯‘TinyX #å…ˆåˆ é™¤åŸç³»ç»Ÿçš„ X-windowï¼š\nrm -rf /usr/X11R6 rm -rf /etc/X11 ä¸‹è½½XFree86-4.3.0ï¼šftp://ftp.xfree86.org/pub/XFree86/4.3.0/ï¼Œå…±ä¸‹è½½7ä¸ªè½¯ä»¶åŒ…ï¼š\nX430src-1.tgz X430src-2.tgz X430src-3.tgz X430src-4.tgz X430src-5.tgz X430src-6.tgz X430src-7.tgz å…¨éƒ¨å¤åˆ¶åˆ° /root ä¸‹è§£å‹ï¼Œè§£å‹åçš„æºç éƒ½ä¼šæ”¾åœ¨ /root/xc ç›®å½•ä¸‹ã€‚\nå…ˆç¼–è¯‘ä¸€ä¸ª lndir å·¥å…·ï¼š\ncd /root/xc/config/util make -f Makefile.ini lndir cd ../../../ ç”¨ lndir åˆ¶ä½œä¸€ä¸ªæºæ–‡ä»¶çš„ç¬¦å·é“¾æ¥ç›®å½•ï¼š\nmkdir build cd build ../xc/config/util/lndir ../xc ç”¨ TinyX.cf çš„é…ç½®å®‰è£…ï¼š\ncd config/cf cp -arf TinyX.cf host.def ä¿®æ”¹ host.def ä¸ºï¼š\n#define KDriveXServer YES #define TinyXServer YES #define XfbdevServer YES #define BuildLBX YES #define BuildFonts YES #define BuildAppgroup NO #define BuildDBE NO #define BuildXCSecurity YES #define FontServerAccess NO #undef BuildXF86RushExt #define BuildXF86RushExt NO #undef BuildRender #define BuildRender YES #define UseRgbTxt YES #define BuildFontServer NO ç„¶åï¼š\ncd ../../ touch xf86Date.h touch xf86Version.h make World make install ä¸»è¦çš„åº“ã€å¤´æ–‡ä»¶ã€å¯æ‰§è¡Œæ–‡ä»¶å’Œé…ç½®æ–‡ä»¶ç­‰éƒ½å®‰è£…äº†åœ¨ /etc/X11 å’Œ /usr/X11R6 ä¸‹ã€‚\nTinyX ä¾èµ–äº framebufferï¼Œè¦æ‰“å¼€ framebufferã€‚ä¿®æ”¹ /etc/grub.conf æ–‡ä»¶ï¼Œåœ¨ kernel ä¸€è¡Œæ·»åŠ ï¼š\nvga=0x311 fbï¼šon 0x311ä¸º640x480ï¼Œ16bppã€‚ ç„¶åé‡å¯ç³»ç»Ÿï¼Œå¯åŠ¨æ—¶ï¼Œå±å¹•å·¦ä¸Šæ–¹ä¼šå‡ºç°ä¸€ä¸ªä¼é¹… Logoã€‚\né‡å¯åè¿è¡Œ /usr/X11R6/bin/Xfbdevï¼Œå³å¯å¯åŠ¨ Xserverï¼Œå¯ä»¥çœ‹åˆ°ç°è‰²èƒŒæ™¯ä¸Šæœ‰ä¸€ä¸ª X å½¢çš„é¼ æ ‡ã€‚ ä¸º Xfbdev å»ºç«‹ä¸€ä¸ªç¬¦å·é“¾æ¥ï¼š\nln -s Xfbdev X è¿™æ ·å°±å¯ä»¥ç”¨startxå‘½ä»¤å¯åŠ¨ X-windowã€‚ç”¨Ctrl+Alt+Backspaceç»„åˆé”®é€€å‡ºX-windowã€‚\nè¿™é‡Œå¯èƒ½å‡ºç°åŠ è½½é“¾æ¥åº“çš„é”™è¯¯ï¼ŒæŸ¥çœ‹ /etc/ld.so.conf æ–‡ä»¶ä¸­æ˜¯å¦æœ‰ /usr/X11R6/libï¼Œç„¶åæ‰§è¡Œ ldconfig -vã€‚\n5.è®¾ç½®pkg-config #åœ¨ /root/.bashrc æ–‡ä»¶ä¸­æ·»åŠ  PKG_CONFIG_PATH ç¯å¢ƒå˜é‡ï¼š\nexport PKG\\_CONFIG\\_PATH=/usr/local/lib/pkgconfig:/usr/X11R6/lib/pkgconfig 6.ç¼–è¯‘Glib-2.0 #å…ˆåˆ é™¤åŸæœ‰çš„ glibï¼š\nrm -rf /usr/lib/libglib* rm -rf /usr/lib/libgmoudle* rm -rf /usr/lib/libgobject* rm -rf /usr/lib/gthread* ä¸‹è½½ glib-2.0.0.tar.bz2ï¼šhttp://ftp.gnome.org/pub/gnome/sources/glib/2.0/\nå¤åˆ¶åˆ°/root/ç›®å½•ä¸‹è§£å‹ï¼š\ntar -xvjf glib-2.0.0.tar.bz2 ç¼–è¯‘ã€å®‰è£…ï¼š\ncd /root/glib-2.0.0 ./configure make make install é»˜è®¤å®‰è£…åˆ°/usr/local/ç›®å½•ä¸‹ï¼Œæ”¯æŒpkg-configã€‚\n7.ç¼–è¯‘atk-1.0.0 #åˆ é™¤åŸæœ‰çš„ atkï¼š\nrm -rf /usr/lib/libatk* ä¿®æ”¹ /etc/ld.so.conf æ–‡ä»¶ï¼Œæ·»åŠ ï¼š\n/usr/local/lib ä¸‹è½½ atk-1.0.0.tar.bz2ï¼šhttp://ftp.gnome.org/pub/gnome/sources/atk/1.0/\nå¤åˆ¶åˆ°/root/ç›®å½•ä¸‹è§£å‹ï¼š\ntar -xvjf atk-1.0.0.tar.bz2 ç¼–è¯‘ã€å®‰è£…ï¼š\ncd /root/atk-1.0.0 ./configure make make install é»˜è®¤å®‰è£…åˆ° /usr/local/ ç›®å½•ä¸‹ï¼Œæ”¯æŒ pkg-configã€‚\n8.ç¼–è¯‘pango-1.0.0 #åˆ é™¤åŸæœ‰çš„pangoï¼š\nrm -rf /usr/lib/libpango* rm -rf /usr/lib/pango ä¸‹è½½pango-1.0.0.tar.bz2ï¼šhttp://ftp.gnome.org/pub/gnome/sources/pango/1.0/\nå¤åˆ¶åˆ° /root/ ç›®å½•ä¸‹è§£å‹ï¼š\ntar -xvjf pango-1.0.0.tar.bz2 ç¼–è¯‘ã€å®‰è£…ï¼š\ncd /root/pango-1.0.0 ./configure make make install é»˜è®¤å®‰è£…åˆ° /usr/local/ ç›®å½•ä¸‹ï¼Œæ”¯æŒ pkg-configã€‚\n9.ç¼–è¯‘libjpeg-6b #åˆ é™¤åŸæœ‰çš„ libjpegï¼š\nrm -rf /usr/lib/libjpeg* ä¸‹è½½libjpeg-6b.tar.gzï¼šhttp://jaist.dl.sourceforge.net/project/cross-stuff/cross-stuff/1.0/libjpeg-6b.tar.gz\nå¤åˆ¶åˆ° /root/ ç›®å½•ä¸‹è§£å‹ï¼š\ntar -xvzf libjpeg-6b.tar.gz ç¼–è¯‘ã€å®‰è£…ï¼š\ncd /root/libjpeg-6b ./configure --enable-shared make make install é»˜è®¤å®‰è£…åˆ°/usr/local/ç›®å½•ä¸‹ã€‚\n10.ç¼–è¯‘gtk+-2.0 #åˆ é™¤åŸæœ‰çš„gtk:\nrm -rf /etc/gtk* rm -rf /etc/gnome rm -rf /usr/bin/*gtk* rm -rf /usr/lib/libgtk* rm -rf /usr/lib/gtk* ä¸‹è½½gtk+-2.0.0.tar.bz2ï¼šhttp://ftp.gnome.org/pub/gnome/sources/gtk+/2.0/\nå¤åˆ¶åˆ°/root/ç›®å½•ä¸‹è§£å‹ï¼š\ntar -xvjf gtk+-2.0.0.tar.bz2 ç¼–è¯‘ã€å®‰è£…ï¼š\ncd /root/gtk+-2.0.0 ./configure --without-libtiff make make install é»˜è®¤å®‰è£…åˆ°/usr/local/ç›®å½•ä¸‹ï¼Œæ”¯æŒpkg-configã€‚\n11.æµ‹è¯• #è¿è¡Œ startxï¼Œå¯ä»¥å¯åŠ¨ X-windowã€‚ ç„¶åè¿è¡Œgtk-demoï¼Œå¯ä»¥å¯åŠ¨ gtk-demo ç¨‹åºã€‚ ç¼–å†™ demo.c æ–‡ä»¶ï¼š\n#include \u0026lt;gtk/gtk.h\u0026gt; char *_(char *c) { return(g_locale_to_utf8(c,-1,0,0,0)); } int main(int argc,char *argv[]) { GtkWidget *window; gtk_init(\u0026amp;argc,\u0026amp;argv); window = gtk_window_new(GTK_WINDOW_TOPLEVEL); gtk_window_set_title(GTK_WINDOW(window),_(\u0026quot;ä¸­æ–‡çª—å£\u0026quot;)); //å®šä¹‰çª—å£çš„æ ‡é¢˜ gtk_window_set_default_size(GTK_WINDOW(window),200,200); //è®¾ç½®çª—å£çš„å¤§å° gtk_window_set_position(GTK_WINDOW(window),GTK_WIN_POS_MOUSE); //è®¾ç½®çª—å£æ˜¾ç¤ºçš„ä½ç½®ä¸ºé¼ æ ‡çš„ä½ç½® gtk_widget_show(window); gtk_main(); return 1; } ç¼–è¯‘ï¼š\ngcc -Wall -o demo demo.c `pkg-config --cflags --libs gtk+-2.0` æ‰§è¡Œï¼š\n./demo æ•ˆæœï¼š\n","date":"2011 November 15","permalink":"/posts/2011/11/15/","section":"Posts","summary":"\u003ch2 id=\"æ¦‚è¿°\" class=\"relative group\"\u003eæ¦‚è¿° \u003cspan class=\"absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100\"\u003e\u003ca class=\"group-hover:text-primary-300 dark:group-hover:text-neutral-700\" style=\"text-decoration-line: none !important;\" href=\"#%e6%a6%82%e8%bf%b0\" aria-label=\"é”šç‚¹\"\u003e#\u003c/a\u003e\u003c/span\u003e\u003c/h2\u003e\u003cp\u003eæœ€è¿‘è¦å°† Redhat9.02 ç§»æ¤åˆ°ä¸€å—åµŒå…¥å¼ 586 çš„ä¸»æ¿ä¸Šï¼Œç©ºé—´æœ‰é™ï¼Œè¿˜è¦æœ‰å›¾å½¢ç¯å¢ƒï¼Œæ”¯æŒä¸­æ–‡ã€‚æ‰€ä»¥ï¼Œè¦å»ºç«‹ä¸€ä¸ªç²¾ç®€çš„å›¾åƒç¯å¢ƒï¼Œå…ˆé€‰æ‹© TinyX+GTK çš„æ–¹å¼è¿›è¡Œç ”ç©¶ã€‚TinyX æ˜¯ XFree86 é’ˆå¯¹åµŒå…¥å¼çš„ç¼–è¯‘é€‰é¡¹ï¼Œä½“ç§¯å°ï¼Œå¯åŠ¨é€Ÿåº¦å¿«ã€‚\næœ¬æ–‡ä½¿ç”¨è™šæ‹Ÿæœº vmware å®‰è£… Redhat-9.02 æ–‡æœ¬ç³»ç»Ÿï¼Œç„¶åç”¨ XFree86-4.3.0 ç¼–è¯‘ TinyX ï¼Œæœ€åç¼–è¯‘ GTK+-2.0ã€‚\u003c/p\u003e","title":"åœ¨Redhat9ä¸‹æ„å»ºTinyX+GTKå›¾å½¢ç¯å¢ƒ"},{"content":"åŸæ–‡ï¼š\nBuilding XFree86 from a Source Distribution\nhttp://www.xfree86.org/4.3.0/BUILD.html\n26 February 2003\nTranslated By Bob\nEmailï¼š gexbob@gmail.com\nBlogï¼šhttp://shaocheng.li\nè¿™ä¸ªæ–‡æ¡£æè¿°äº†æ€æ ·ä»æºä»£ç å‘è¡Œç‰ˆæ„å»ºXFree86ï¼Œè¦ç»“åˆç‰¹å®šæ“ä½œç³»ç»Ÿçš„READMEæ–‡ä»¶æ¥ä½¿ç”¨å®ƒã€‚\næ³¨ï¼šæ„å»ºXFree86ä¹‹å‰ï¼Œæœ€å¥½å‚è€ƒç‰¹å®šæ“ä½œç³»ç»Ÿçš„READMEæ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶åŒ…å«äº†åœ¨ä½ çš„æ“ä½œç³»ç»Ÿä¸‹æˆåŠŸæ„å»ºXFree86æ‰€éœ€çš„è¯¦ç»†ä¿¡æ¯ã€‚\næˆ‘ä»¬å¼ºçƒˆæ¨èä½¿ç”¨GCCæ„å»ºXFree86ï¼Œä½†æ˜¯é€šå¸¸ä¹Ÿå¯ä»¥ä½¿ç”¨å„ä¸ªå¹³å°çš„æœ¬åœ°ç¼–è¯‘å™¨ã€‚\n1. æ€æ ·å¾—åˆ°XFree86 4.3.0 çš„æºç  #æ¨èçš„æ–¹æ³•æ˜¯ä» XFree86 çš„ CVS åº“ä¸­è·å– XFree86 4.3.0 çš„æºç ã€‚æœ‰å¤šç§é€”å¾„å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ï¼Œå¯ä»¥åœ¨æˆ‘ä»¬çš„ CVS é¡µé¢æ‰¾åˆ° xf-4.3.0 å‘è¡Œç‰ˆçš„æ ‡ç­¾ã€‚\nå¦ä¸€ä¸ªé€”å¾„æ˜¯åœ¨ XFree86 çš„ FTP ç«™ç‚¹ä¸‹è½½ 4.3.0 çš„ tar æ ¼å¼æºç åŒ…ã€‚æ­¥éª¤å¦‚ä¸‹ï¼š\nXFree86 4.3.0çš„æºç åŒ…å«åœ¨ X430src-1.tgz, X430src-2.tgz, X430src-3.tgz, X430src-4.tgz,X430src-5.tgz, X430src-6.tgz å’Œ X430src-7.tgz ä¸­ã€‚è¿™äº›æ–‡ä»¶å¯ä»¥åœ¨ ftp://ftp.xfree86.org/pub/XFree86/4.3.0/source/ æˆ– XFree86 ç«™ç‚¹çš„ç±»ä¼¼åœ°å€ä¸­æ‰¾åˆ°ã€‚X430src-4.tgz å’Œ X430src-5.tgzåŒ…å«äº†å­—ä½“ï¼ŒX430src-6.tgz å’Œ X430src-7.tgz åŒ…å«äº†æ–‡æ¡£ã€‚X430src-1.tgz, X430src-2.tgz å’Œ X430src-3.tgz åŒ…å«äº†å…¶ä»–æ‰€æœ‰çš„ä¸œè¥¿ã€‚å¦‚æœä½ ä¸éœ€è¦å­—ä½“å’Œæ–‡æ¡£ï¼Œå¯ä»¥åªä¸‹è½½ X430src-1.tgz, X430src-2.tgz å’Œ X430src-3.tgzã€‚\nè¿è¡Œä¸‹é¢çš„å‘½ä»¤è§£å‹æ¯ä¸ªæ–‡ä»¶ï¼Œç¡®ä¿è¶³å¤Ÿçš„ç©ºé—´ï¼Œå…¨éƒ¨æºç å¤§çº¦éœ€è¦305Mï¼Œè¿˜è¦ä¸€äº›ç©ºé—´ç¼–è¯‘äºŒè¿›åˆ¶æ–‡ä»¶ã€‚\ngzip -d \u0026lt; X430src-1.tgz | tar vxf - gzip -d \u0026lt; X430src-2.tgz | tar vxf - gzip -d \u0026lt; X430src-3.tgz | tar vxf - gzip -d \u0026lt; X430src-4.tgz | tar vxf - gzip -d \u0026lt; X430src-5.tgz | tar vxf - gzip -d \u0026lt; X430src-6.tgz | tar vxf - gzip -d \u0026lt; X430src-7.tgz | tar vxf - å¦‚æœä½ å·²ç»æœ‰äº†ä¸€ä»½ XFree86 4.2.0 æºç çš„æ‹·è´ï¼Œå¯ä»¥ä» ftp://ftp.xfree86.org/pub/XFree86/4.3.0/patches/ ä¸‹è½½è¡¥ä¸æ¥å‡çº§åˆ° 4.3.0 ã€‚è¡¥ä¸çš„ä¸‹è½½å’Œä½¿ç”¨ä¿¡æ¯å¯ä»¥åœ¨è¿™ä¸ªå‘è¡Œç‰ˆçš„R EDAME æ–‡ä»¶çš„ â€œHow to get XFree86â€ æ®µæ‰¾åˆ°ã€‚ æ‰€æœ‰çš„æ–¹æ³•éƒ½å°†äº§ç”Ÿä¸€ä¸ªä¸»æºç ç›®å½•ï¼Œå«åš xc ã€‚\n2. æ„å»ºä¹‹å‰å…ˆé…ç½®æºç  #åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ²¡æœ‰å¿…è¦åšä»»ä½•é…ç½®ã€‚\nå¦‚æœä½ ç¡®å®æƒ³è¦æ”¹å˜é…ç½®ï¼Œå»ºè®®ä½ å…ˆè¿›å…¥ xc/config/cf ç›®å½•ï¼Œå¤åˆ¶ xf86site.def ä¸º host.defã€‚ç„¶åé€šè¿‡é˜…è¯» host.def æ–‡ä»¶ï¼Œæ ¹æ®ä½ çš„é…ç½®è®¾ç½®ä½ æƒ³è¦çš„å‚æ•°ã€‚ä½ ä¹Ÿå¯ä»¥é€šè¿‡æŸ¥çœ‹ .cf æ–‡ä»¶ï¼Œæ‰¾å‡ºé’ˆå¯¹ä½ çš„æ“ä½œç³»ç»Ÿçš„é»˜è®¤è®¾ç½®ã€‚\né€šå¸¸éµå¾ªçš„è§„åˆ™æ˜¯ï¼Œåªä¿®æ”¹ä½ ç†è§£çš„é€‰é¡¹ï¼Œå¹¶ä¸”æœ‰å¥½çš„ä¿®æ”¹åŸå› ã€‚ä¿®æ”¹é»˜è®¤é…ç½®å®¹æ˜“äº§ç”Ÿä¸€äº›é—®é¢˜ã€‚å¾ˆå¤šé…ç½®é€‰é¡¹è®°å½•åœ¨ xc/config/cf/READMEã€‚\nå¦‚æœä½ åªä½¿ç”¨æºä»£ç çš„ x430src-1.tgz,x430src-2.tgz å’Œ x430src-3.tgx éƒ¨åˆ†ï¼Œä½ éœ€è¦å®šä¹‰ BuildFonts ä¸º NOã€‚\n3. ä½¿ç”¨ç¬¦å·é“¾æ¥çš„ç›®å½•æ¥æ„å»º #æ¨èçš„åšæ³•æ˜¯ï¼Œç”¨ä¸€ä¸ªç¬¦å·é“¾æ¥çš„ç›®å½•æ¥æ„å»º XFree86ã€‚è¿™æ ·å¯ä»¥ä¿è¯æºä»£ç ç›®å½•åœ¨æ„å»ºè¿‡ç¨‹ä¸­ä¸è¢«ä¿®æ”¹ï¼Œè¿˜æœ‰ä»¥ä¸‹å¥½å¤„ï¼š\nå½“ä½¿ç”¨ CVS ç»´æŠ¤æºç æ ‘çš„æ›´æ–°æ—¶ï¼Œæ›´æ–°è¿›ç¨‹ä¸ä¼šè¢«é CVS æ§åˆ¶çš„æ–‡ä»¶æ‰€å¹²æ‰°ã€‚ å¯ä»¥ç”¨åŒæ ·çš„æºç ä¸ºä¸åŒçš„æ“ä½œç³»ç»Ÿæˆ–æ¶æ„æ„å»º XFree86 ï¼Œç”¨åªè¯»çš„ NFS å…±äº«ã€‚ å¯ä»¥ç”¨ä¸åŒçš„é…ç½®æ„å»º XFree86ï¼Œåªéœ€è¦åœ¨æ¯ä¸€ä¸ªæ„å»ºæ ‘ä¸­æ”¾ä¸€ä¸ª host.def çš„æ‹·è´ï¼Œå¹¶ä¸”åˆ†åˆ«å®šä¹‰ã€‚ ç”¨ä¸‹é¢æ­¥éª¤å»ºç«‹ä¸€ä¸ªç¬¦å·é“¾æ¥ç›®å½•ï¼š\nåœ¨æ„å»ºæ ‘çš„é¡¶å±‚åˆ›å»ºç›®å½•ï¼Œé€šå¸¸æ–°å»ºåœ¨xcç›®å½•çš„åŒå±‚ï¼Œä½†ä¸æ˜¯å¼ºåˆ¶æ€§çš„ã€‚\ncd [xcç›®å½•] mkdir build ç”¨â€œlndirâ€å‘½ä»¤åˆ›å»ºå½±å­æ ‘ï¼š\nlndir ../xc æ³¨ï¼šå¦‚æœéœ€è¦çš„è¯ï¼Œæœ€å¥½ä½¿ç”¨xcç›®å½•çš„ç»å¯¹è·¯å¾„ã€‚\nå¦‚æœä½ çš„ç³»ç»Ÿæ²¡æœ‰å®‰è£… lndir ï¼Œä½ å¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤ä» XFree86 çš„æºç å®‰è£…å®ƒï¼š\ncd xc/config/util make -f Makefile.ini lndir cp lndir [some directory in your PATH] éšç€æ—¶é—´çš„æ¨ç§»ï¼Œå¯èƒ½åœ¨æ„å»ºæ ‘ä¸­äº§ç”Ÿä¸€äº›é™ˆæ—§çš„é“¾æ¥ï¼Œä¾‹å¦‚ï¼Œå½“æºç ä¸­çš„æ–‡ä»¶è¢«åˆ é™¤æˆ–é‡å‘½åã€‚å¯ä»¥åœ¨æ„å»ºç›®å½•ä¸­è¿è¡Œâ€œcleanlinksâ€è„šæœ¬æ¥æ¸…é™¤ã€‚å¾ˆå°‘ä¼šå› ä¸ºä¸€äº›å˜åŒ–è€Œè¦ä»å¤´å¼€å§‹é‡æ–°åˆ›å»ºæ„å»ºæ ‘ã€‚å¦‚æœæœ‰è¿™æ ·çš„æƒ…å†µï¼Œé‚£å¯èƒ½æ˜¯æ„å»ºè¿‡ç¨‹ä¸­é—®é¢˜ã€‚æœ€å¥½çš„æ–¹æ³•æ˜¯åˆ é™¤æ„å»ºæ ‘ï¼Œç„¶åæŒ‰ä¸Šé¢çš„æ­¥éª¤é‡æ–°æ„å»ºã€‚\n4. æ„å»ºå’Œå®‰è£… #æ„å»ºä¹‹å‰ï¼Œè¯»ä¸€ä¸‹ xc/programs/Xserver/hw/xfree86/doc ä¸­ä¸ä½ ç›¸å…³çš„ç‰¹å®šæ“ä½œç³»ç»Ÿçš„ README ã€‚ä¸€æ—¦ç‰¹å®šæ“ä½œç³»ç»Ÿçš„è¯¦æƒ…å·²ç»æœ‰äº†æè¿°ï¼Œå°±å¯ä»¥åˆ°ä½ çš„æ„å»ºç›®å½•ï¼ˆxcç›®å½•æˆ–ä¹‹å‰å»ºç«‹çš„å½±å­æ ‘ï¼‰ï¼Œè¿è¡Œâ€œmake Worldâ€ï¼Œå¦‚æœæœ‰å¿…è¦ï¼Œå°±å¸¦ä¸Š README ä¸­æè¿°çš„ BOOTSTRAPCFLAGS è®¾ç½®ï¼Œä½†æ˜¯ XFree86 æ”¯æŒå¤§å¤šæ•°æ“ä½œç³»ç»Ÿå·²ç»ä¸éœ€è¦ BOOTSTRAPCFLAGSã€‚ä¸€ä¸ªæ˜æ™ºçš„åšæ³•æ˜¯å°† stdout å’Œ stderr é‡å®šå‘åˆ° World.logï¼Œä»¥ä¾¿è¿½è¸ªæ„å»ºè¿‡ç¨‹ä¸­å¯èƒ½äº§ç”Ÿçš„é—®é¢˜ã€‚\nåœ¨ç±» Bourne çš„ shell(Bash,Korn shell,zsh,ç­‰)ä¸­ä½¿ç”¨å¦‚ä¸‹çš„å‘½ä»¤ï¼š\nmake World \u0026gt; World.log 2\u0026gt;\u0026amp;1 C-shell(csh,tcsh,ç­‰)ä¸­ä½¿ç”¨ï¼š\nmake World \u0026gt;\u0026amp; World.log ä½ å¯ä»¥æ ¹æ®æ„å»ºçš„è¿›å±•è¿è¡Œï¼š\ntail -f World.log æ„å»ºå®Œæˆåï¼Œå¦‚æœæœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½ éœ€è¦æ£€æŸ¥ World.log æ–‡ä»¶ã€‚å¦‚æœæ²¡æœ‰é—®é¢˜ï¼Œä½ å°±å¯ä»¥å®‰è£…äºŒè¿›åˆ¶æ–‡ä»¶äº†ã€‚é»˜è®¤çš„â€œmake Worldâ€ è¿‡ç¨‹ä¼šå¿½ç•¥é”™è¯¯ï¼Œä»¥ä¾¿å°½å¯èƒ½çš„æ„å»ºæˆåŠŸã€‚å¦‚æœåœ¨è¿™ä¸€æ­¥ä¸­æœ‰æ— æ³•è§£å†³çš„é—®é¢˜ï¼Œå®‰è£…è¿‡ç¨‹å°†ä¼šå¤±è´¥ã€‚è§£å†³é—®é¢˜åé‡æ–°å¼€å§‹æ„å»ºæ—¶ï¼Œåªéœ€è¦è¿è¡Œ â€œmakeâ€ ã€‚å¦‚æœåœ¨è§£å†³é—®é¢˜çš„è¿‡ç¨‹ä¸­æ”¹å˜äº† Imakefile æˆ–å…¶å®ƒæ„å»ºé…ç½®ï¼Œéœ€è¦é‡æ–°è¿è¡Œ â€œmake Worldâ€ æˆ– â€œmake Everythingâ€ã€‚\nå¦‚æœä½ æƒ³è¦ â€œmake Worldâ€ åœ¨ç¬¬ä¸€ä¸ªé”™è¯¯æ˜¯ç»“æŸï¼Œç”¨ä¸‹é¢çš„å‘½ä»¤æ¥æ›¿æ¢å‰é¢æ‰€è®²çš„:\nåœ¨ç±»Bourneçš„shellä¸­ï¼š\nmake WORLDOPTS= World \u0026gt; World.log 2\u0026gt;\u0026amp;1 åœ¨C-shellä¸­ï¼š\nmake WORLDOPTS= World \u0026gt;\u0026amp; World.log å¯¹äºå®‰è£…ï¼Œè¿è¡Œâ€œmake installâ€å’Œâ€œmake install.manâ€ã€‚ç¡®ä¿ /usr/X11R6 ä¸­æœ‰è¶³å¤Ÿçš„ç©ºé—´ç”¨äºå®‰è£…ã€‚å¦‚æœä½ æƒ³è¦å®‰è£…åœ¨ /usr ä¹‹å¤–çš„æ–‡ä»¶ç³»ç»Ÿï¼Œéœ€è¦åœ¨æ–°å»ºä¸€ä¸ªæŒ‡å‘ /usr/X11R6 çš„ç¬¦å·è¿æ¥ã€‚\n5. é‡æ–°é…ç½®æœåŠ¡å™¨ #ä¸ºæœåŠ¡å™¨æ„å»ºä¸åŒçš„è®¾ç½®ï¼Œæˆ–å¸¦æœ‰ä¸åŒé©±åŠ¨è®¾ç½®çš„æœåŠ¡å™¨ã€‚\nç¡®ä¿æ–°çš„é©±åŠ¨æºç åœ¨æ­£ç¡®çš„ä½ç½®ï¼ˆä¾‹å¦‚ï¼Œé©±åŠ¨æºç åº”è¯¥åœ¨ xc/programs/Xserver/hw/xfree86/drivers ä¸‹çš„ä¸€ä¸ªå­ç›®å½•ï¼‰ã€‚\nä¿®æ”¹host.defï¼ˆä½ è¦æ„å»ºçš„æœåŠ¡å™¨ï¼‰ä¸­å®šä¹‰çš„æœåŠ¡å™¨è®¾ç½®ï¼Œä¹Ÿå¯ä»¥æ ¹æ®ä½ çš„éœ€è¦ä¿®æ”¹é©±åŠ¨åˆ—è¡¨ã€‚\nåœ¨xc/programs/Xserverä¸­è¿è¡Œï¼š\nmake Makefile make Makefiles make includes make depend make 6. å…¶ä»–æœ‰ç”¨çš„makeç›®æ ‡ #ä¸‹é¢æ˜¯ä¸€äº›åœ¨ XFree86 çš„ Makefile ä¸­å®šä¹‰çš„å…¶ä»–æœ‰ç”¨çš„ç›®æ ‡ï¼š\nEverything make Worleä¹‹åï¼Œmake Everything ä¼šåšä»»ä½• make World å¯ä»¥åšçš„ï¼Œé™¤äº†æ¸…ç†æ ‘ã€‚è¿™æ˜¯ä¸€ä¸ªä¸ºæºç æ‰“è¡¥ä¸åã€å¿«é€Ÿé‡æ–°æ„å»ºæ ‘çš„æ–¹æ³•ã€‚ä½†å®ƒå¹¶ä¸æ˜¯100%å¯é çš„ã€‚æœ€å¥½æ˜¯ç”¨ make World åšä¸€æ¬¡å®Œæ•´çš„æ„å»ºã€‚\nclean ç”¨äºå¯¹æºç æ ‘è¿›è¡Œå±€éƒ¨æ¸…ç†ã€‚åˆ é™¤ç›®æ ‡æ–‡ä»¶å’Œç”Ÿæˆçš„æ‰‹å†Œé¡µï¼Œä½†æ˜¯ä¿ç•™ Makefile å’Œç”Ÿæˆçš„ä¾èµ–æ–‡ä»¶ã€‚æ‰§è¡Œ make clean åï¼Œä½ éœ€è¦é‡æ–°è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥é‡æ–°æ„å»º XFree86 ï¼š\nmake include make depend make disclean å¯¹æºç æ ‘è¿›è¡Œå®Œå…¨æ¸…ç†ï¼Œåˆ é™¤æ‰€æœ‰çš„ç”Ÿäº§æ–‡ä»¶ã€‚make discleanåï¼Œåªèƒ½ç”¨make Worldé‡æ–°æ„å»ºXFree86ã€‚\nincludes ç”Ÿäº§æ‰€æœ‰çš„å¯ç”Ÿæˆå¤´æ–‡ä»¶å’Œæ„å»ºæ‰€éœ€çš„ç¬¦å·é“¾æ¥ã€‚make cleanæ—¶ï¼Œè¿™äº›æ–‡ä»¶ä¼šè¢«åˆ é™¤ã€‚\ndepend é‡æ–°è®¡ç®— Makefile ä¸­å„ä¸ªç›®æ ‡çš„ä¾èµ–å…³ç³»ã€‚æ ¹æ®æ“ä½œç³»ç»Ÿï¼Œä¾èµ–å…³ç³»å‚¨å­˜åœ¨ Makefile ï¼Œæˆ–ä¸€ä¸ªç‹¬ç«‹çš„æ–‡ä»¶ä¸­ï¼Œå«åš .dependã€‚è¿™ç›®æ ‡éœ€è¦ç”¨åˆ° make includes ç”Ÿäº§çš„å¤´æ–‡ä»¶ã€‚VerifyOS æ˜¾ç¤ºæ£€æµ‹åˆ°çš„æ“ä½œç³»ç»Ÿçš„ç‰ˆæœ¬ã€‚å¦‚ç‰ˆæœ¬å·ä¸ä½ çš„ç³»ç»Ÿä¸åŒ¹é…ï¼Œä½ å¯èƒ½è¦åœ¨ host.def ä¸­è®¾ç½®å¹¶ä¸”å‘ XFree86@XFree86.org æŠ¥å‘Šè¿™ä¸ªé—®é¢˜\n","date":"2011 November 8","permalink":"/posts/2011/11/08/","section":"Posts","summary":"åŸæ–‡ï¼š","title":"ä»æºç å»ºç«‹XFree86"},{"content":"ä½¿ç”¨é€’å½’ï¼š\nint strlen(char * str) { if(*str) return strlen(str+1)+1; else return 0; } ","date":"2011 October 18","permalink":"/posts/2011/10/18/","section":"Posts","summary":"ä½¿ç”¨é€’å½’ï¼š","title":"ä¸ç”¨ä»»ä½•å˜é‡ï¼Œå®ç°strlenå‡½æ•°"},{"content":"Linuxç³»ç»Ÿæ–‡æœ¬æ¨¡å¼ä¸‹æˆªå±è¦ç”¨åˆ°/devç›®å½•ä¸‹çš„vcsè®¾å¤‡ï¼š\nls /dev/vcs* /dev/vcs /dev/vcs1 /dev/vcs2 /dev/vcs3 /dev/vcs4 /dev/vcs5 /dev/vcs6 å…¶ä¸­ï¼Œ/dev/vcs æ˜¯å½“å‰çš„è™šæ‹Ÿæ§åˆ¶å°çš„å†…å®¹ï¼Œ/dev/vcs1 æ˜¯tty1çš„å†…å®¹ã€‚\næˆªå–å½“å‰æ§åˆ¶å°çš„å†…å®¹ï¼š\ncat /dev/vcs \u0026gt; filename å¾—åˆ°çš„æ–‡ä»¶ filename æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œç›´æ¥ç”¨ç¼–è¾‘å™¨å³å¯æŸ¥çœ‹ã€‚\nå¦‚æœè¦æˆªå– tty1 çš„å†…å®¹ï¼Œå°±æ‰§è¡Œï¼š\ncat /dev/vcs1 \u0026gt; filename ","date":"2011 July 29","permalink":"/posts/2011/07/29/","section":"Posts","summary":"Linuxç³»ç»Ÿæ–‡æœ¬æ¨¡å¼ä¸‹æˆªå±è¦ç”¨åˆ°/devç›®å½•ä¸‹çš„vcsè®¾å¤‡ï¼š","title":"Linuxç³»ç»Ÿæ–‡æœ¬æ¨¡å¼ä¸‹çš„æˆªå±"},{"content":"ddçš„ä½œç”¨æ˜¯è½¬æ¢å’Œæ‹·è´æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å®ƒæ¥åˆ†å‰²æ–‡ä»¶ï¼Œç›¸å…³çš„é€‰é¡¹å¦‚ä¸‹ï¼š\nif=filenameï¼šè¾“å…¥çš„æ–‡ä»¶å\nof=finenameï¼šè¾“å‡ºçš„æ–‡ä»¶å\nbs=bytesï¼šä¸€æ¬¡è¯»å†™çš„å­—èŠ‚æ•°ï¼Œé»˜è®¤æ˜¯512bytes\nskip=blocks:æ‹·è´å‰ï¼Œè·³è¿‡çš„è¾“å…¥æ–‡ä»¶çš„å‰blockså—ï¼Œå—çš„å¤§å°æœ‰bså†³å®š\ncount=blocksï¼šåªæ‹·è´è¾“å…¥æ–‡ä»¶çš„å‰blockså—\nä¾‹å¦‚ï¼Œç°åœ¨æœ‰ä¸€ä¸ªæ–‡ä»¶fileï¼Œå¤§å°ä¸º116616å­—èŠ‚ï¼š\n[root]# du -b file 116616 file å°†å…¶åˆ†å‰²ä¸ºä¸¤æ–‡ä»¶file1å’Œfile2ï¼Œé‚£æˆ‘ä»¬å°±è®¾ç½®æ¯å—ä¸º1024å­—èŠ‚ï¼Œå°†fileçš„å‰60å—æ”¾å…¥file1ï¼Œä½™ä¸‹çš„æ”¾å…¥file2ï¼š\n[root]# dd if=file bs=1024 count=60 skip=0 of=file1 [root]# dd if=file bs=1024 count=60 skip=60 of=file2 ç„¶åç”¨catå°†ä¸¤ä¸ªæ–‡ä»¶åˆå¹¶ä¸ºfile.bakï¼Œè¦æ³¨æ„æ–‡ä»¶çš„é¡ºåºï¼š\n[root]# cat file1 file2 \u0026gt; file.bak å¯ä»¥ç”¨md5suméªŒè¯ä¸€ä¸‹fileå’Œfile.bakï¼š\n[root]# md5sum file 3ff53f7c30421ace632eefff36148a70 file [root]# md5sum file.bak 3ff53f7c30421ace632eefff36148a70 file.bak å¯ä»¥è¯æ˜ä¸¤ä¸ªæ–‡ä»¶æ—¶å®Œå…¨ç›¸åŒçš„ã€‚\nä¸ºäº†æ–¹ä¾¿åˆ†å‰²ã€åˆå¹¶æ–‡ä»¶ï¼Œæˆ‘å†™äº†ä¸¤ä¸ªè„šæœ¬ï¼š\nddf.sh\n#ddf.shï¼šåˆ†å‰²æ–‡ä»¶ï¼Œåˆ†å‰²åçš„æ–‡ä»¶ä»¥æ•°å­—ç»“å°¾ï¼Œä¾‹å¦‚fileåˆ†å‰²ä¸ºä¸¤ä¸ªæ–‡ä»¶ï¼šfile1å’Œfile2 #!/bin/sh #ä½¿ç”¨è„šæœ¬æ˜¯ç¬¬ä¸€å‚æ•°æ˜¯è¦åˆ†å‰²çš„æ–‡ä»¶å Filename=$1 Filesize=0 Path=`pwd` #éªŒè¯æ–‡ä»¶åæ˜¯å¦æ­£ç¡®ï¼Œç„¶åè®¡ç®—æ–‡ä»¶çš„å¤§å° if [ -z $Filename ];then echo \u0026quot;Error:The file name can not be empty\u0026quot; exit fi if [ -e $Filename ];then Filesize=`du -b $Filename | awk '{print $1}'` if [ $Filesize == 0 ];then echo \u0026quot;Error:The File size is zero!\u0026quot; exit fi echo \u0026quot;The file size is $Filesize Byte\u0026quot; echo \u0026quot;Plese enter the subfile size(KB):\u0026quot; else echo \u0026quot;Error:$Filename does not exist!\u0026quot; exit fi #è¾“å…¥åˆ†å‰²åæ¯ä¸ªæ–‡ä»¶çš„å¤§å°ï¼Œå•ä½æ˜¯KB read Subfilesize if [ -z $Subfilesize ];then echo \u0026quot;Error:Input can not be empty\u0026quot; exit fi echo $Subfilesize | grep '^[0-9]\\+$' \u0026gt;\u0026gt; /dev/null if [ $? -ne 0 ];then echo \u0026quot;Error:The Input is not a number!\u0026quot; exit elif [ $Subfilesize -eq 0 ];then echo \u0026quot;Error:The Subfile size is zero!\u0026quot; exit fi #è®¡ç®—éœ€è¦åˆ†å‰²ä¸ºå‡ ä¸ªæ–‡ä»¶ SubfileByte=`expr $Subfilesize \\* 1024` Subfilenum=`expr $Filesize / $SubfileByte` if [ `expr $Filesize % $Subfilesize` -ne 0 ];then Subfilenum=`expr $Subfilenum + 1` fi #å°†æ–‡ä»¶åˆ†å‰² echo \u0026quot;$Filename will be divided into $Subfilenum\u0026quot; i=1 skipnum=0 while [ $i -le $Subfilenum ] do echo \u0026quot;$Filename$i\u0026quot; dd if=$Filename of=\u0026quot;$Path/$Filename$i\u0026quot; bs=1024 count=$Subfilesize skip=$skipnum i=`expr $i + 1` skipnum=`expr $skipnum + $Subfilesize` done echo \u0026quot;$Filename has been divided into $Subfilenum\u0026quot; echo \u0026quot;Done !\u0026quot; caf.sh\n#caf.sh:åˆå¹¶æ–‡ä»¶ï¼Œéœ€è¦åˆå¹¶çš„æ–‡ä»¶è¦æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹é‡Œ # æ–‡ä»¶ååˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†éƒ½ç›¸åŒï¼Œç¬¬äºŒéƒ¨åˆ†å¿…é¡»æ˜¯ä»1å¼€å§‹çš„è¿ç»­æ•°å­—ï¼Œä¾‹å¦‚file1ï¼Œfile2ï¼Œfile3 # åˆå¹¶åçš„æ–‡ä»¶åä¸ºfile.bak #!/bin/sh #è¾“å…¥æ–‡ä»¶åçš„ç¬¬ä¸€éƒ¨åˆ† echo \u0026quot;Please enter file name:\u0026quot; read Filename if [ -z $Filename ];then echo \u0026quot;Error:File name can not be empty\u0026quot; exit fi #è¾“å…¥å¾…åˆå¹¶æ–‡ä»¶çš„ä¸ªæ•° echo \u0026quot;Please enter the number of subfiles:\u0026quot; read Subfilenum if [ -z $Subfilenum ];then echo \u0026quot;Error:The number of subfiles can not be empty\u0026quot; exit fi echo $Subfilenum | grep '^[0-9]\\+$' \u0026gt; /dev/null if [ $? -ne 0 ];then echo \u0026quot;Error:Input must be a number\u0026quot; exit fi if [ $Subfilenum -eq 0 ];then echo \u0026quot;Error:The number of subfiles can not be zero\u0026quot; exit fi #åˆå¹¶æ–‡ä»¶ i=1 Newfile=$Filename\\.bak while [ $i -le $Subfilenum ] do Subfilename=$Filename$i if [ -e $Subfilename ];then echo \u0026quot;$Subfilename done!\u0026quot; cat $Subfilename \u0026gt;\u0026gt; $Newfile i=`expr $i + 1` else echo \u0026quot;Error:$Subfilename does not exist\u0026quot; rm -rf $Newfile exit fi done echo \u0026quot;Subfiles be merged into $Newfile\u0026quot; echo \u0026quot;Success!\u0026quot; ç”¨è¿™ä¸¤ä¸ªè„šæœ¬å®Œæˆå¯¹fileçš„åˆ†å‰²ã€åˆå¹¶ï¼š\n[root]# ./ddf.sh file The file size is 116616 Byte Plese enter the subfile size(KB): 60 file will be divided into 2 file1 è®°å½•äº†60+0 çš„è¯»å…¥ è®°å½•äº†60+0 çš„å†™å‡º 61440å­—èŠ‚(61 kB)å·²å¤åˆ¶ï¼Œ0.0352612 ç§’ï¼Œ1.7 MB/ç§’ file2 è®°å½•äº†53+1 çš„è¯»å…¥ è®°å½•äº†53+1 çš„å†™å‡º 55176å­—èŠ‚(55 kB)å·²å¤åˆ¶ï¼Œ0.0316272 ç§’ï¼Œ1.7 MB/ç§’ file has been divided into 2 Done ! [root]# ls caf.sh ddf.sh file file1 file2 [root]# ./caf.sh Please enter file name: file Please enter the number of subfiles: 2 file1 done! file2 done! Subfiles be merged into file.bak Success! [root]# ls caf.sh ddf.sh file file1 file2 file.bak ","date":"2011 July 26","permalink":"/posts/2011/07/26/","section":"Posts","summary":"ddçš„ä½œç”¨æ˜¯è½¬æ¢å’Œæ‹·è´æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å®ƒæ¥åˆ†å‰²æ–‡ä»¶ï¼Œç›¸å…³çš„é€‰é¡¹å¦‚ä¸‹ï¼š","title":"Linuxä¸‹åˆ†å‰²ã€åˆå¹¶æ–‡ä»¶â€”â€”ddå’Œcat"},{"content":"åŸæ–‡ï¼š\nã€ŠLinux Ramdisk mini-HOWTOã€‹\nBy Van Emery\nhttp://www.vanemery.com/Linux/Ramdisk/ramdisk.html\nTranslate By Bob\nFriday, July 25, 2011\nEmailï¼š gexbob@gmail.com\nBlogï¼šhttp://shaocheng.li\nç®€ä»‹ #ä»€ä¹ˆæ˜¯RamDiskï¼ŸRamDiskå°±æ˜¯å°†å†…å­˜ï¼ˆRamï¼‰çš„ä¸€éƒ¨åˆ†å½“åšç¡¬ç›˜ï¼ˆDiskï¼‰æ¥ä½¿ç”¨ã€‚RamDiskæœ‰å›ºå®šçš„å¤§å°ï¼Œå¯ä»¥åƒæ­£å¸¸ç¡¬ç›˜åˆ†åŒºé‚£æ ·å»ä½¿ç”¨ã€‚ å°±æ“ä½œæ—¶é—´æ¥è®²ï¼ŒRamDiskæ¯”çœŸå®çš„ç‰©ç†ç¡¬ç›˜å¿«å¾ˆå¤šï¼Œå½“ç³»ç»Ÿå…³é—­æˆ–æ–­ç”µæ—¶ï¼Œä¿å­˜åœ¨RamDiskä¸­çš„æ•°æ®ä¼šå…¨éƒ¨ä¸¢å¤±ã€‚RamDiskå¯ä»¥æˆä¸ºä¸€ä¸ªå­˜æ”¾ä¸´æ—¶æ•°æ®çš„å¥½åœ°æ–¹ã€‚\nLinuxçš„2.4å†…æ ¸å·²ç»å†…å»ºæ”¯æŒRamDiskã€‚RamDiskåœ¨å¾ˆå¤šæƒ…å†µä¸‹æ˜¯å¾ˆæœ‰ç”¨çš„ï¼ŒåŒ…æ‹¬ï¼š\nä½¿ç”¨åŠ å¯†æ–‡ä»¶ä¸­çš„æœªåŠ å¯†æ•°æ®ï¼› æŸäº›ç±»å‹çš„ç½‘é¡µå†…å®¹æœåŠ¡ï¼› æŒ‚è½½loopbackæ–‡ä»¶ç³»ç»Ÿï¼ˆä¾‹å¦‚ï¼Œä»è½¯ç›˜æˆ–CDè¿è¡Œï¼‰ æˆ‘ä¸ºä»€ä¹ˆè¦å†™è¿™ä¸ªæ–‡æ¡£ï¼Ÿå› ä¸ºæˆ‘éœ€è¦è®¾ç½®ä¸€ä¸ª16Mçš„RamDiskæ¥æŸ¥çœ‹ã€åˆ›å»ºåŠ å¯†æ–‡ä»¶ã€‚æˆ‘ä¸æƒ³è®©æœªåŠ å¯†çš„æ–‡ä»¶å†™å…¥æˆ‘çš„å·¥ä½œå¹³å°çš„ä»»ä½•ç‰©ç†ä»‹è´¨ã€‚æˆ‘è¿˜å‘ç°ä¸€ä¸ªæœ‰è¶£çš„åœ°æ–¹ï¼Œå¯ä»¥è½»æ˜“çš„åœ¨Ramä¸­åˆ›å»ºä¸€ä¸ªæ¯”æˆ‘çš„ç¬¬ä¸€ä¸ªç‰©ç†ç¡¬ç›˜ï¼ˆ20Mï¼‰è¿˜å¤§çš„è™šæ‹Ÿç¡¬ç›˜ï¼Œå½“æ—¶ï¼Œæˆ‘æ ¹æœ¬æ— æ³•æƒ³è±¡æ€æ ·å¡«æ»¡è¿™ä¸ªè™šæ‹Ÿç¡¬ç›˜ã€‚\nè¿™ä¸ªæ–‡æ¡£å°†ä¼šå¸¦ä½ ä¸€æ­¥æ­¥åœ°ç»å†åˆ›å»ºå’Œä½¿ç”¨RamDiskçš„è¿‡ç¨‹ã€‚\nå¹³å° #æˆ‘ä½¿ç”¨Red Hat 9è¿›è¡Œæµ‹è¯•ï¼Œä½†æ˜¯è¿™åº”è¯¥é€‚ç”¨äºå…¶ä»–çš„ 2.4 å†…æ ¸çš„Linuxç³»ç»Ÿï¼Œæˆ‘è¿˜å‡è®¾ä½ çš„Linuxç³»ç»Ÿå·²ç»å°†RamDiskæ”¯æŒç¼–è¯‘åˆ°äº†å†…æ ¸ã€‚æˆ‘çš„è®¡ç®—æœºä½¿ç”¨ Pentium 4 å¤„ç†å™¨ï¼Œ256Må†…å­˜ï¼Œç¡®åˆ‡çš„å†…æ ¸ç‰ˆæœ¬æ˜¯ï¼š2.4.20-20.9\n1. æŸ¥çœ‹ä½ çš„ç³»ç»Ÿå·²ç»åˆ›å»ºäº†ä»€ä¹ˆ #RedHaté»˜è®¤åˆ›å»º16ä¸ªRamDiskï¼Œè™½ç„¶å®ƒä»¬æ²¡æœ‰æ¿€æ´»æˆ–ä½¿ç”¨ä»»ä½•Ramã€‚ç³»ç»Ÿåˆ—å‡ºçš„è®¾å¤‡æ˜¯ram0~ram19ï¼Œä½†æ˜¯åªæœ‰ram0~ram15æ˜¯é»˜è®¤å¯ç”¨çš„ã€‚ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å¯ç”¨æ£€å‡ºè¿™äº›å—è®¾å¤‡ï¼š\n[root]# ls -l /dev/ram* lrwxrwxrwx 1 root root 4 Jun 12 00:31 /dev/ram -\u0026gt; ram1 brw-rw---- 1 root disk 1, 0 Jan 30 2003 /dev/ram0 brw-rw---- 1 root disk 1, 1 Jan 30 2003 /dev/ram1 brw-rw---- 1 root disk 1, 10 Jan 30 2003 /dev/ram10 brw-rw---- 1 root disk 1, 11 Jan 30 2003 /dev/ram11 brw-rw---- 1 root disk 1, 12 Jan 30 2003 /dev/ram12 brw-rw---- 1 root disk 1, 13 Jan 30 2003 /dev/ram13 brw-rw---- 1 root disk 1, 14 Jan 30 2003 /dev/ram14 brw-rw---- 1 root disk 1, 15 Jan 30 2003 /dev/ram15 brw-rw---- 1 root disk 1, 16 Jan 30 2003 /dev/ram16 brw-rw---- 1 root disk 1, 17 Jan 30 2003 /dev/ram17 brw-rw---- 1 root disk 1, 18 Jan 30 2003 /dev/ram18 brw-rw---- 1 root disk 1, 19 Jan 30 2003 /dev/ram19 brw-rw---- 1 root disk 1, 2 Jan 30 2003 /dev/ram2 brw-rw---- 1 root disk 1, 3 Jan 30 2003 /dev/ram3 brw-rw---- 1 root disk 1, 4 Jan 30 2003 /dev/ram4 brw-rw---- 1 root disk 1, 5 Jan 30 2003 /dev/ram5 brw-rw---- 1 root disk 1, 6 Jan 30 2003 /dev/ram6 brw-rw---- 1 root disk 1, 7 Jan 30 2003 /dev/ram7 brw-rw---- 1 root disk 1, 8 Jan 30 2003 /dev/ram8 brw-rw---- 1 root disk 1, 9 Jan 30 2003 /dev/ram9 lrwxrwxrwx 1 root root 4 Jun 12 00:31 /dev/ramdisk -\u0026gt; ram0 ç°åœ¨ï¼Œç”¨grepåœ¨dmesgçš„è¾“å‡ºä¸­æ‰¾å‡ºRamDiskçš„å¤§å°\n[root]# dmesg | grep RAMDISK RAMDISK driver initialized: 16 RAM disks of 4096K size 1024 blocksize RAMDISK: Compressed image found at block 0 ä½ å¯ç”¨çœ‹åˆ°ï¼ŒRamDisk é»˜è®¤åªæœ‰ 4MBã€‚æˆ‘æƒ³è¦ä¸€ä¸ª 16MB çš„ RamDiskï¼Œæ‰€ä»¥ï¼Œä¸‹ä¸€æ­¥è¦é…ç½® Linuxï¼Œä½¿å¾—åœ¨å¯åŠ¨è¿‡ç¨‹ä¸­ä½¿ç”¨ä¸€ä¸ªæ›´å¤§çš„ RamDisk ã€‚\n2. å¢åŠ RamDiskçš„å¤§å° #RamDisk çš„å¤§å°æ˜¯è¢«ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹æ§åˆ¶çš„ï¼Œè¿™ä¸ªé€‰é¡¹ä¼šåœ¨ç³»ç»Ÿå¯åŠ¨æ—¶ä¼ ç»™å†…æ ¸ã€‚ç”±äº RedHat9 çš„é»˜è®¤ bootloader æ˜¯ GRUBï¼Œæˆ‘å°†ç”¨æ–°çš„é€‰é¡¹ä¿®æ”¹ /etc/grub.confï¼ŒRamDisk å¤§å°çš„å†…æ ¸é€‰é¡¹æ˜¯ï¼šramdisk_size=xxxxx ï¼Œxxxxx æ˜¯æŒ‡å¤§å°ä¸º 1024-Byte çš„å—çš„ä¸ªæ•°ã€‚ä¸‹é¢æ˜¯æˆ‘è¦æ·»åŠ åˆ° /etc/grub.conf çš„å†…å®¹ï¼Œå®ƒå°† RamDisk é…ç½®ä¸º16MBï¼š\ngurb.conf\n# grub.conf generated by anaconda # # Note that you do not have to rerun grub after making changes to this file # NOTICE: You have a /boot partition. This means that # all kernel and initrd paths are relative to /boot/, eg. # root (hd0,0) # kernel /vmlinuz-version ro root=/dev/hda5 # initrd /initrd-version.img #boot=/dev/hda default=0 timeout=10 splashimage=(hd0,0)/grub/splash.xpm.gz title Red Hat Linux (2.4.20-20.9) root (hd0,0) kernel /vmlinuz-2.4.20-20.9 ro root=LABEL=/ hdc=ide-scsi ramdisk_size=16000 initrd /initrd-2.4.20-20.9.img å°†æ–‡ä»¶ä¿å­˜åï¼Œä½ éœ€è¦é‡å¯ç³»ç»Ÿã€‚é‡å¯åï¼Œé€šè¿‡æŸ¥çœ‹dmesgçš„è¾“å‡ºæ¥ç¡®è®¤ä¿®æ”¹å·²ç»ç”Ÿæ•ˆï¼š\n[root]# dmesg | grep RAMDISK RAMDISK driver initialized: 16 RAM disks of 16000K size 1024 blocksize RAMDISK: Compressed image found at block 0 3. æ ¼å¼åŒ–RamDisk #æ— éœ€å°† RamDisk æ ¼å¼åŒ–ä¸ºæ—¥å¿—æ–‡ä»¶ç³»ç»Ÿï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ EXT2 æ–‡ä»¶ç³»ç»Ÿã€‚æˆ‘åªæƒ³ä½¿ç”¨ä¸€ä¸ª RamDisk ï¼Œæ‰€ä»¥æˆ‘åªæ ¼å¼åŒ– ram0ã€‚\n[root]# mke2fs -m 0 /dev/ram0 mke2fs 1.32 (09-Nov-2002) Filesystem label= OS type: Linux Block size=1024 (log=0) Fragment size=1024 (log=0) 4000 inodes, 16000 blocks 0 blocks (0.00%) reserved for the super user First data block=1 2 block groups 8192 blocks per group, 8192 fragments per group 2000 inodes per group Superblock backups stored on blocks: 8193 Writing inode tables: done Writing superblocks and filesystem accounting information: done This filesystem will be automatically checked every 22 mounts or 180 days, whichever comes first. Use tune2fs -c or -i to override. -m 0é€‰é¡¹æŒ‡å®šäº†æ–‡ä»¶ç³»ç»Ÿä¸Šrootç”¨æˆ·ä¿ç•™åŒºå—çš„æ¯”ä¾‹ä¸º0ï¼Œè¿™æ˜¯é»˜è®¤çš„ç‰¹æ€§ã€‚æˆ‘å¸Œæœ›æ™®é€šç”¨æˆ·å¯ä»¥ä½¿ç”¨æ‰€æœ‰çš„RamDiskç©ºé—´ã€‚\n4. æ–°å»ºä¸€ä¸ªæŒ‚è½½ç‚¹å¹¶æŒ‚è½½RamDisk #ä½ å·²ç»æ ¼å¼åŒ–äº†RamDiskï¼Œç°åœ¨è¦ä¸ºå®ƒæ–°å»ºä¸€ä¸ªæŒ‚è½½ç‚¹ã€‚ç„¶åå°±å¯ä»¥æŒ‚è½½ä½ çš„RamDiskå¹¶ä½¿ç”¨å®ƒã€‚æˆ‘ä»¬å°†ä¼šä½¿ç”¨/mnt/rdæ–‡ä»¶å¤¹ã€‚\n[root]# mkdir /mnt/rd [root]# mount /dev/ram0 /mnt/rd æ£€æµ‹æ–°æŒ‚è½½çš„RamDisk\n[root]# mount | grep ram0 /dev/ram0 on /mnt/rd type ext2 (rw) [root]# df -h | grep ram0 /dev/ram0 16M 13K 16M 1% /mnt/rd ä½ å¯ä»¥ç”¨tune2fså‘½ä»¤æŸ¥çœ‹æ–°RamDiskçš„è¯¦ç»†ä¿¡æ¯\n[root]# tune2fs -l /dev/ram0 tune2fs 1.32 (09-Nov-2002) Filesystem volume name: none Last mounted on: not available Filesystem UUID: fbb80e9a-8e7c-4bd4-b3d9-37c29813a5f5 Filesystem magic number: 0xEF53 Filesystem revision #: 1 (dynamic) Filesystem features: filetype sparse_super Default mount options: (none) Filesystem state: not clean Errors behavior: Continue Filesystem OS type: Linux Inode count: 4000 Block count: 16000 Reserved block count: 0 Free blocks: 15478 Free inodes: 3989 First block: 1 Block size: 1024 Fragment size: 1024 Blocks per group: 8192 Fragments per group: 8192 Inodes per group: 2000 Inode blocks per group: 250 Filesystem created: Mon Dec 8 14:33:57 2003 Last mount time: Mon Dec 8 14:35:39 2003 Last write time: Mon Dec 8 14:35:39 2003 Mount count: 1 Maximum mount count: 22 Last checked: Mon Dec 8 14:33:57 2003 Check interval: 15552000 (6 months) Next check after: Sat Jun 5 14:33:57 2004 Reserved blocks uid: 0 (user root) Reserved blocks gid: 0 (group root) First inode: 11 Inode size: 128 åœ¨æˆ‘çš„ç³»ç»Ÿä¸­ï¼Œæˆ‘éœ€è¦\u0026rsquo;var\u0026rsquo;ç”¨æˆ·èƒ½å¤Ÿè¯»å†™RamDiskï¼Œæ‰€ä»¥å¿…é¡»ä¿®æ”¹/mnt/rdæ–‡ä»¶å¤¹çš„æ‰€æœ‰è€…å’Œæƒé™ã€‚\n[root]# chown van:root /mnt/rd [root]# chmod 0770 /mnt/rd [root]# ls -ald /mnt/rd drwxrwx--- 2 van root 4096 Dec 8 11:09 /mnt/rd RamDiskæŒ‚è½½ç‚¹çš„æ‰€æœ‰è€…å’Œæƒé™è¦æ ¹æ®ä½ çš„ç‰¹å®šæƒ…å†µè¿›è¡Œä¿®æ”¹ã€‚\n5. ä½¿ç”¨RamDisk #RamDiskå·²ç»åˆ›å»ºæˆåŠŸï¼Œç°åœ¨ï¼Œä½ å¯ä»¥åƒåœ¨ç‰©ç†ç¡¬ç›˜åˆ†åŒºé‚£æ ·ï¼Œåœ¨RamDiskä¸Šå¤åˆ¶ã€ç§»åŠ¨ã€åˆ é™¤ã€ç¼–è¾‘æˆ–åˆ—å‡ºæ–‡ä»¶ã€‚è¿™æ˜¯ä¸€ä¸ªæŸ¥çœ‹åŠ å¯†çš„GPGæˆ–OpenSSLæ–‡ä»¶çš„å¥½åœ°æ–¹ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªåˆ›å»ºåŠ å¯†æ–‡ä»¶çš„å¥½åœ°æ–¹ã€‚ä½ çš„ä¸»æœºå…³é—­åï¼Œæ‰€æœ‰åœ¨RamDiskä¸Šåˆ›å»ºçš„æ–‡ä»¶éƒ½ä¼šæ¶ˆå¤±ã€‚\nç”¨ä¸‹é¢çš„å‘½ä»¤å¯ä»¥è½»æ˜“çš„å¸è½½RamDiskï¼š\n[root]# umount -v /mnt/rd /dev/ram0 umounted **Noteï¼š**å¦‚æœä½ å¸è½½äº†RamDiskï¼Œä½ çš„æ•°æ®ä¾ç„¶ä¼šä¿å­˜åœ¨é‚£é‡Œã€‚ä¸€æ—¦å†…å­˜è¢«åˆ†é…ç»™äº†RamDiskï¼Œå®ƒå°±ä¼šè¢«æ ‡è®°ï¼Œä¹‹åå†…æ ¸å°±ä¸ä¼šè¯•å›¾é‡ç”¨è¿™å—å†…å­˜ã€‚å› æ­¤ï¼Œä½¿ç”¨äº†RamDiskåï¼Œå°±ä¸èƒ½å›æ”¶é‚£å—å†…å­˜ã€‚æ­£å› å¦‚æ­¤ï¼Œä½ è¦è€ƒè™‘æ¸…æ¥šï¼Œä¸è¦ç»™RamDiskåˆ†é…å¤ªå¤šçš„å†…å­˜ã€‚åœ¨æˆ‘çš„ç³»ç»Ÿé‡Œï¼Œæˆ‘åˆ†é…äº†å°äº10%çš„ç‰©ç†å†…å­˜ã€‚ä½ è¦æ ¹æ®è‡ªå·±çš„éœ€è¦ç¡®å®šRamDiskçš„å¤§å°ã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥é‡å¯åé‡Šæ”¾ç©ºé—´ã€‚\nè‡ªåŠ¨åˆ›å»ºRamDisk #å¦‚æœä½ éœ€è¦æ¯æ¬¡ç³»ç»Ÿå¯åŠ¨ååˆ›å»ºå’ŒæŒ‚è½½RamDiskï¼Œå¯ä»¥é€šè¿‡åœ¨/etc/rc.localå¯åŠ¨è„šæœ¬é‡Œæ·»åŠ å‘½ä»¤æ¥è‡ªåŠ¨æ‰§è¡Œè¿™ä¸ªè¿›ç¨‹ã€‚ ä¸‹é¢æ˜¯æˆ‘æ·»åŠ çš„å‘½ä»¤ï¼š\n# Formats, mounts, and sets permissions on my 16MB ramdisk /sbin/mke2fs -q -m 0 /dev/ram0 /bin/mount /dev/ram0 /mnt/rd /bin/chown van:root /mnt/rd /bin/chmod 0750 /mnt/rd ç»“è¯­ #ç°åœ¨ä½ å¯ä»¥å°è¯•åœ¨ä½ çš„UNIX/Linuxç³»ç»Ÿä¸Šåˆ›å»ºå’Œä½¿ç”¨RamDiskã€‚å¸Œæœ›è¿™äº›ä¿¡æ¯å¯¹ä½ æœ‰ç”¨ã€‚\nå‚è€ƒ # /usr/src/linux-2.4/Documentation/ramdisk.txt /usr/src/linux-2.4/drivers/block/rd.c man mke2fs Ramdisk article by Mark Nielsen for Red Hat 6.0 ","date":"2011 July 25","permalink":"/posts/2011/07/25/","section":"Posts","summary":"åŸæ–‡ï¼š","title":"å¦‚ä½•åœ¨Linuxç³»ç»Ÿä¸‹åˆ¶ä½œRamDisk"},{"content":"åŸæ–‡ï¼š\nã€ŠRemote Serial Console HOWTOã€‹ï¼šhttp://www.linux.com/learn/docs/ldp/714-Remote-Serial-Console-HOWTO\nTranslate By Bob\nFriday, July 15, 2011\nEmailï¼š gexbob@gmail.com\nBlogï¼šhttp://shaocheng.li\næ ¹æ®æˆ‘çš„ç¯å¢ƒï¼ˆRedhat 9ï¼ŒGrub 0.93ï¼‰ï¼Œç¿»è¯‘äº†æˆ‘éœ€è¦çš„éƒ¨åˆ†ã€‚åŸæ–‡è¿˜æœ‰é’ˆå¯¹Liloå’ŒSyslinuxçš„é…ç½®è¯´æ˜ã€‚\n1. å‡†å¤‡å·¥ä½œ #1.1. å…³äºserial console #Consoleæ˜¯ä¸€ä¸ªè¾“å‡ºç³»ç»Ÿç®¡ç†ä¿¡æ¯çš„æ–‡æœ¬è¾“å‡ºè®¾å¤‡ï¼Œè¿™äº›ä¿¡æ¯æ¥è‡ªäºå†…æ ¸ï¼Œç³»ç»Ÿå¯åŠ¨å’Œç³»ç»Ÿç”¨æˆ·ï¼Œserial consoleå°±æ˜¯ä¸²å£ä½œä¸ºè¾“å‡ºç»ˆç«¯è®¾å¤‡ï¼Œæ˜¯è¿™äº›ä¿¡æ¯å¯ä»¥é€šè¿‡ä¸²å£åœ¨è¿œç¨‹çš„ç»ˆç«¯ä¸Šæ˜¾ç¤ºã€‚\né…ç½®ä¸€ä¸ªserial consoleå¤§è‡´åŒ…æ‹¬äº”é¡¹å†…å®¹ï¼š\né…ç½®BIOSä½¿ç”¨serial consoleï¼ˆå¯é€‰ï¼‰ï¼› é…ç½®Bootloaderä½¿ç”¨serial consoleï¼ˆå¯é€‰ï¼‰ï¼› é…ç½®å†…æ ¸ä½¿ç”¨serial console åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶è¿è¡Œä¸€ä¸ªæ”¯æŒserial consoleç™»å½•çš„ç¨‹åº ä¸€äº›å…¶ä»–ç³»ç»Ÿé…ç½®ï¼Œä½¿è¿™äº›åŠŸèƒ½æ”¯æŒserial consoleï¼Œæˆ–è€…é˜²æ­¢å®ƒä»¬æ‰°ä¹±serial console 1.2. ä¸²å£çº¿ #ä½¿ç”¨RS232æ–¹å¼çš„DB9ä¸²å£çº¿ï¼Œä¿¡å·è¿æ¥å¦‚ä¸‹ï¼š\nSignal ground ------------------ Signal ground Receive data ------------------ Transmit data Transmit data ------------------ Receive data Ready to send ------------------ Clear to send Clear to send ------------------ Ready to send ata terminal ready -------------+--- Data carrier detect | +--- Data set ready Data carrier detect ----+---------------- Data terminal ready | Data set ready ----+ 1.3. ä¸²å£å‚æ•°çš„è®¾ç½® #é€‰æ‹©çš„ä¸²å£æ˜¯COM1ï¼Œè®¾å¤‡åä¸ºttyS0ï¼Œæ³¢ç‰¹ç‡ä¸º9600,8ä½æ•°æ®ä½ï¼Œæ— å¥‡å¶æ ¡éªŒï¼Œ1ä½åœæ­¢ä½ã€‚\n2. é…ç½®BIOS #æœ‰äº›BIOSæ”¯æŒserial consoleï¼Œå¯ä»¥åœ¨serial consoleæ˜¾ç¤ºBIOSå¯åŠ¨ä¿¡æ¯ï¼Œè¿™éœ€è¦åœ¨BIOSä¸­é…ç½®ã€‚\n3. é…ç½®Bootloader #LILOã€GRUBå’ŒSYSLINUXéƒ½æ”¯æŒserial consoleã€‚\n3.1. GRUBçš„é…ç½® #GRUBçš„é…ç½®æ–‡ä»¶æ˜¯/boot/grubç›®å½•ä¸‹çš„grub.confï¼Œåœ¨é…ç½®æ–‡ä»¶çš„å¼€å§‹å¤„æ·»åŠ ï¼š\nserial --unit=0 --speed=9600 --word=8 --parity=no --stop=1 terminal --timeout=10 serial console Serialå‘½ä»¤ç”¨äºè®¾ç½®ä¸²å£çš„å‚æ•°ï¼š\n--unitï¼šä¸²å£è®¾å¤‡ï¼Œ0å°±è¡¨ç¤ºttyS0ï¼Œå¦‚æœæ˜¯ttyS1å°±è¦è®¾ä¸º1ï¼› --speedï¼šæ³¢ç‰¹ç‡ï¼› --workï¼šæ•°æ®ä½ï¼› --parityï¼šå¥‡å¶æ ¡éªŒä½ï¼› --stopï¼šåœæ­¢ä½ã€‚ Terminalå‘½ä»¤ç”¨äºè®¾ç½®ç»ˆç«¯çš„ç±»å‹ --timeoutï¼šç­‰å¾…æ—¶é—´ï¼Œå•ä½æ˜¯ç§’ 4. é…ç½®Kernel #Kernelçš„consoleç±»å‹å¯ä»¥é€šè¿‡consoleå‚æ•°é€‰æ‹©ï¼Œconsoleé…ç½®çš„è¯­æ³•å¦‚ä¸‹ï¼š\nconsole=ttyS\u0026lt;serial_port\u0026gt;[,\u0026lt;mode\u0026gt;] console=tty\u0026lt;virtual_terminal\u0026gt; console=lp\u0026lt;parallel_port\u0026gt; console=ttyUSB[\u0026lt;usb_port\u0026gt;[,\u0026lt;mode\u0026gt;] å…¶ä¸­çš„ttySå°±æ˜¯ä¸²å£è®¾å¤‡ï¼Œmodeè¡¨ç¤ºä¸²å£çš„å‚æ•°ï¼›ttyè¡¨ç¤ºè™šæ‹Ÿç»ˆç«¯ã€‚\næ¯ä¸ªconsoleç±»å‹æŒ‡å—è®¾ç½®ä¸€ä¸ªè®¾å¤‡ï¼Œä¾‹å¦‚ï¼Œå¯ä»¥è®¾ç½®ä¸ºconsole=tty0 console=lp0 console=ttyS0ï¼Œä½†æ˜¯è®¾ä¸º console=ttyS0 console=ttyS1å°±æ˜¯é”™è¯¯çš„ã€‚\nå¦‚æœæ²¡æœ‰è®¾ç½®consoleå‚æ•°ï¼Œå†…æ ¸é»˜è®¤ä½¿ç”¨è™šæ‹Ÿç»ˆç«¯ï¼Œå³tty0ï¼Œä½¿ç”¨ç»„åˆé”® Ctrl+Alt+F1 å¯ä»¥åˆ‡æ¢åˆ° tty0ã€‚å¦‚æœä½ çš„ç”µè„‘æœ‰æ˜¾ç¤ºè®¾å¤‡ï¼Œæœ€å¥½å°†å®ƒè®¾ä¸º consoleï¼Œå³ console=tty0ã€‚\næ ¹æ®æˆ‘çš„è®¾å¤‡æƒ…å†µå¯ä»¥è®¾ç½®ä¸ºï¼š\nconsole=tty0 console=ttyS0,9600n8 Consoleå‚æ•°éœ€è¦ç”¨bootloaderåœ¨å†…æ ¸å¯åŠ¨æ—¶ä¼ é€’ç»™å†…æ ¸ï¼Œå¯¹äºGRUBï¼Œéœ€è¦ä¿®æ”¹grub.confæ–‡ä»¶ï¼Œå°†å‚æ•°æ·»åŠ åˆ°kernelå‘½ä»¤åé¢å³å¯ï¼Œä¾‹å¦‚ï¼›\ngrub.conf\ntitle Red Hat Linux (2.4.9-21) root (hd0,0) kernel /vmlinuz-2.4.9-21 ro root=/dev/hda6 console=tty0 console=ttyS0,9600n8 initrd /initrd-2.4.9-21.img 5. é…ç½®getty #gettyä¼šç›‘æ§å’Œç­‰å¾…ä¸€ä¸ªè¿æ¥ï¼Œç„¶åé…ç½®ä¸²å£è¿æ¥ï¼Œå‘é€/etc/issueçš„å†…å®¹ï¼Œå¹¶ä¸”è¦æ±‚è¾“å…¥ç™»å½•åå’Œå¯†ç ï¼Œç„¶åå¼€å§‹ç™»å½•ï¼Œå¦‚æœç™»å½•å¤±è´¥ï¼Œgettyä¼šè¿”å›ç­‰å¾…çŠ¶æ€ã€‚\ngettyçš„å¦ä¸€é¡¹å·¥ä½œæ˜¯è®¾ç½®TERMå˜é‡çš„å€¼ï¼Œä»¥æŒ‡å®šæ‰€è¿æ¥çš„ç»ˆç«¯çš„ç±»å‹ã€‚\nå¸¸ç”¨çš„gettyæœ‰å››ä¸ªç‰ˆæœ¬ï¼š\n*gettyï¼š*ä¼ ç»Ÿçš„gettyï¼Œéœ€è¦é…ç½®æ–‡ä»¶/etc/gettydefs *agettyï¼š*æ— éœ€é…ç½®æ–‡ä»¶ï¼Œç›´æ¥é€šè¿‡å‘½ä»¤è¡Œä¼ é€’å‚æ•° *mgettyï¼š*æ”¯æŒmodemçš„gettyï¼Œéœ€è¦é…ç½®æ–‡ä»¶ *minigettyï¼š*ç²¾ç®€ç‰ˆçš„gettyï¼Œä¸æ”¯æŒserial console\nRedHat9è‡ªå¸¦agettyå’Œmgettyï¼Œåœ¨/etc/inittabæ–‡ä»¶ä¸­é»˜è®¤ä½¿ç”¨mgettyï¼Œåœ¨è¯¥æ–‡ä»¶ä¸­æ·»åŠ ï¼š\ncoï¼š2345ï¼šrespawnï¼š/sbin/agetty -h -t 60 ttyS0 9600 vt102 -t 60 : 60ç§’å†…æ— æ“ä½œï¼Œagettyå°†ä¼šè¿”å›ç­‰å¾…çŠ¶æ€ã€‚\n-h ï¼š ä½¿ç”¨ç¡¬ä»¶æµæ§åˆ¶ï¼ˆCTS/RTSæ¡æ‰‹ï¼‰\n6. å…¶ä»–é…ç½® #6.1. è®©rootå¯ä»¥é€šè¿‡serial consoleç™»å½• #é…ç½®æ–‡ä»¶/etc/securettyç”¨äºç®¡ç†rootç”¨æˆ·å¯ä»¥ç™»å½•çš„è®¾å¤‡ï¼Œå°†serial consoleçš„è®¾å¤‡åæ·»åŠ åˆ°è¯¥æ–‡ä»¶ï¼Œå³å¯ä½¿rootç”¨æˆ·é€šè¿‡serial consoleç™»å½•ã€‚\nä¸ºäº†å®‰å…¨æ€§ï¼Œæˆ‘ä»¬é€šå¸¸rootç”¨æˆ·åœ¨è¿œç¨‹ç™»å½•ï¼Œè€Œæ˜¯ç”¨æ™®é€šç”¨æˆ·ç™»å½•ï¼Œç„¶åç”¨suæˆ–sudoå‘½ä»¤åˆ‡æ¢åˆ°rootã€‚\n6.2. å°†å¯åŠ¨åŸºæœ¬æ”¹ä¸ºæ–‡æœ¬æ–¹å¼ #è¿™ä¸ªåªé’ˆå¯¹åœ¨æ²¡æœ‰å±å¹•çš„æœåŠ¡å™¨ä¸Šè¿è¡ŒX-Windowç³»ç»Ÿï¼Œç¼–è¾‘/etc/inittabæ–‡ä»¶ä¸­åŒ…å«initdefaultçš„é‚£ä¸€è¡Œï¼Œä¾‹å¦‚ï¼š\nid:5:initdefault: æ”¹ä¸º\nid:3:initdefault: å¦‚æœè¿æ¥äº†é”®ç›˜å’Œæ˜¾ç¤ºå™¨ï¼Œå¯ä»¥ç”¨startå‘½ä»¤å¯åŠ¨X-Windowã€‚\n####6.2.1. é…ç½®ä¸ºè¿è¡ŒX\næœ‰æ—¶ï¼Œä¸€å°æœ‰serial consoleå´æ²¡æœ‰è¿æ¥æ˜¾ç¤ºå™¨çš„ç”µè„‘ä¾ç„¶éœ€è¦è¿è¡ŒX-Windowï¼Œä¾‹å¦‚ï¼Œè¿™å°ç”µè„‘è¿æ¥æœ‰Xç»ˆç«¯ã€‚\nè¿™ç§æƒ…å†µä¸‹ï¼Œè®¡ç®—æœºè¿˜æ˜¯éœ€è¦è¿è¡Œåœ¨ç¬¬5çº§ï¼Œä½†æ˜¯ä¸èƒ½ä¸ºæ˜¾ç¤ºå™¨è¿è¡ŒX-serverã€‚ä¿®æ”¹/etc/X11/xdm/Xservers,åˆ é™¤æ‰€æœ‰ä»¥å†’å·å¼€å¤´çš„è¡Œï¼Œä¾‹å¦‚ï¼š\n:0 local /usr/X11R6/bin/X å¦‚æœæ“ä½œç³»ç»Ÿä½¿ç”¨çš„æ˜¯GNOMEï¼Œé‚£å°±è¦ä¿®æ”¹å®ƒçš„é…ç½®æ–‡ä»¶/etc/X11/gdm/gdm.confï¼Œåˆ é™¤[servers] æ®µä¸­çš„æ‰€æœ‰æœ¬åœ°X-Serverçš„æ¡ç›®ï¼Œä¾‹å¦‚ï¼š\n[servers] 0=/usr/bin/X11/X 6.3. åˆ é™¤å·²æœ‰çš„consoleè®¾ç½® #/etc/ioctl.saveåŒ…å«äº†å•ç”¨æˆ·æ¨¡å¼ä¸­ä½¿ç”¨çš„ä¸²å£å’Œç»ˆç«¯çš„ç‰¹æ€§ï¼Œè¿™äº›ç‰¹æ€§é€šå¸¸æ˜¯æœ‰gettyæ¥è®¾ç½®çš„â€”â€”åœ¨æ²¡ç”¨gettyè¿è¡Œçš„å•ç”¨æˆ·æ¨¡å¼ä¸‹ï¼Œè¿™ä¸ªæ–‡ä»¶çš„å†…å®¹è¢«ç”¨æ¥è®¾ç½®ä¸²å£å’Œç»ˆç«¯ã€‚\nå› ä¸ºæˆ‘ä»¬å·²ç»æ”¹å˜äº†consoleï¼Œå·²æœ‰çš„è®¾ç½®å·²ç»ä¸æ­£ç¡®äº†ï¼Œæ‰€ä»¥è¦åˆ é™¤è¿™ä¸ªæ–‡ä»¶ï¼š\nrm -f /etc/ioctl.save ä¸€æ—¦æˆ‘ä»¬å¯ä»¥ä»serial consoleç™»å½•ï¼Œæˆ‘ä»¬ä¼šé‡å»ºè¿™ä¸ªæ–‡ä»¶ã€‚\n6.4. serial consoleä¸æ˜¯/dev/modem #å¾ˆå¤šLinuxä¼šå°†/dev/modemé“¾æ¥åˆ°ä¸€ä¸ªåŒ…å«å¯ç”¨modemçš„ä¸²å£è®¾å¤‡ã€‚\nè™½ç„¶serial consoleæ˜¯ä¸€ä¸ªå¸¦æœ‰modemçš„ä¸²å£ï¼Œä½†æ˜¯æˆ‘ä»¬çœŸçš„ä¸å¸Œæœ›å®ƒè¢«ç”¨ä½œä¸€ä¸ªå‘¼å«è®¾å¤‡ã€‚\næ£€æŸ¥/dev/modemæ˜¯å¦æŒ‡å‘äº†é‚£ä¸ªç”¨åšconsoleçš„ä¸²å£ï¼Œå¦‚æœæ˜¯ï¼Œå°†å®ƒåˆ é™¤ã€‚\nbash$ ls -l /dev/modem lrwxrwxrwx 1 root root 10 Jan 01 00:00 /dev/modem -\u0026gt; /dev/ttyS0 bash# rm /dev/modem 6.5. æ›´æ”¹/dev/systtyçš„ç›®æ ‡ #å¾ˆå¤šLinuxå°†/dev/systtyé“¾æ¥åˆ°äº†é”®ç›˜å’Œæ˜¾ç¤ºå™¨æ‰€ä½¿ç”¨çš„é‚£ä¸ªç»ˆç«¯è®¾å¤‡ã€‚\nå¦‚æœè®¡ç®—æœºæ²¡æœ‰è¿æ¥é”®ç›˜å’Œæ˜¾ç¤ºå™¨ï¼Œæˆ–è€…ä¸æƒ³ç»™é”®ç›˜å’Œæ˜¾ç¤ºå™¨æä¾›ä¸€ä¸ªæ–‡æœ¬ç»ˆç«¯ï¼Œé‚£å°±ä¿®æ”¹/dev/systtyï¼Œä½¿å®ƒæŒ‡å‘serial consoleã€‚\nç›¸å¯¹äºä¿®æ”¹é“¾æ¥ï¼Œä¿®æ”¹MAKEDEVä½¿ç”¨çš„é…ç½®æ–‡ä»¶æ›´å¥½ï¼Œè¿™æ ·ä¼šé‡å»ºé“¾æ¥ã€‚é…ç½®æ–‡ä»¶ä½äº/dev/makedev.dç›®å½•ä¸‹ï¼Œé»˜è®¤é…ç½®æŒ‡å‘ç¬¬ä¸€ä¸ªè™šæ‹Ÿç»ˆç«¯ï¼š\nl systty tty0 ä¿®æ”¹å®ƒï¼Œä½¿systtyæŒ‡å‘ç”¨ä½œconsoleçš„ä¸²å£ï¼š\nbash# cd /etc/makedev.d bash# fgrep systty * linux-2.4.x:l systty tty0 bash# vi linux-2.4.x å°†systtyé‚£ä¸€è¡Œæ”¹ä¸ºï¼š\nl systty ttyS0 ç„¶åæ ¹æ®æ–°å®šä¹‰é‡å»º/dev/systty:\nbash# cd /dev bash# rm systty bash# ./MAKEDEV systty 6.6. é…ç½®å¯æ‹”æ’è®¤è¯æ¨¡å— #å¯æ‹”æ’è®¤è¯æ¨¡å—ç³»ç»Ÿè¢«ç”¨äºå‘ç”¨æˆ·æä¾›é€šè¿‡consoleç™»å½•ç³»ç»Ÿçš„ç‰¹æƒï¼Œå®ƒä½¿å¾—è®¾å¤‡åƒè½¯ç›˜é‚£æ ·å¯ä»¥ç”±consoleç”¨æˆ·æŒ‚è½½ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼ŒæŒ‚è½½ç£ç›˜éœ€è¦è¶…çº§ç”¨æˆ·æƒé™ã€‚\nPAMé…ç½®æ–‡ä»¶/etc/security/console.permsåŒ…å«\u0026lt;console\u0026gt;å˜é‡ï¼Œå¯¹äºè¿æ¥äº†é”®ç›˜æ˜¾ç¤ºå™¨çš„ç³»ç»Ÿï¼Œé»˜è®¤çš„\u0026lt;console\u0026gt;å˜é‡ä¸ºï¼š\n\u0026lt;console\u0026gt;=tty[0-9][0-9]* vc/[0-9][0-9]* :[0-9]\\.[0-9] :[0-9] åœ¨è¯¥æ–‡ä»¶çš„åé¢éƒ¨åˆ†ï¼Œconsoleç”¨æˆ·è¢«èµ‹äºˆäº†ä½¿ç”¨ä¸€äº›è®¾å¤‡çš„æƒé™ï¼Œè®¾å¤‡æƒé™çš„ä¿®æ”¹ä¼šåœ¨ç™»å½•æˆ–é€€å‡ºåç”Ÿæ•ˆã€‚ console.permsæ–‡ä»¶ä¸­é»˜è®¤çš„è®¾å¤‡åˆ—è¡¨å¦‚ä¸‹ï¼š\nconsole.perms\n\u0026lt;console\u0026gt; 0660 \u0026lt;floppy\u0026gt; 0660 root.floppy \u0026lt;console\u0026gt; 0600 \u0026lt;sound\u0026gt; 0600 root \u0026lt;console\u0026gt; 0600 \u0026lt;cdrom\u0026gt; 0660 root.disk \u0026lt;console\u0026gt; 0600 \u0026lt;pilot\u0026gt; 0660 root.uucp \u0026lt;console\u0026gt; 0600 \u0026lt;jaz\u0026gt; 0660 root.disk \u0026lt;console\u0026gt; 0600 \u0026lt;zip\u0026gt; 0660 root.disk \u0026lt;console\u0026gt; 0600 \u0026lt;ls120\u0026gt; 0660 root.disk \u0026lt;console\u0026gt; 0600 \u0026lt;scanner\u0026gt; 0600 root \u0026lt;console\u0026gt; 0600 \u0026lt;camera\u0026gt; 0600 root \u0026lt;console\u0026gt; 0600 \u0026lt;memstick\u0026gt; 0600 root \u0026lt;console\u0026gt; 0600 \u0026lt;flash\u0026gt; 0600 root \u0026lt;console\u0026gt; 0600 \u0026lt;fb\u0026gt; 0600 root \u0026lt;console\u0026gt; 0600 \u0026lt;kbd\u0026gt; 0600 root \u0026lt;console\u0026gt; 0600 \u0026lt;joystick\u0026gt; 0600 root \u0026lt;console\u0026gt; 0600 \u0026lt;v4l\u0026gt; 0600 root \u0026lt;console\u0026gt; 0700 \u0026lt;gpm\u0026gt; 0700 root \u0026lt;console\u0026gt; 0600 \u0026lt;mainboard\u0026gt; 0600 root \u0026lt;console\u0026gt; 0600 \u0026lt;rio500\u0026gt; 0600 root ä»¥ä¸Šè¢«åˆ—å‡ºçš„è®¾å¤‡åˆ†ä¸ºä¸¤ç§ï¼šä¸€äº›è®¾å¤‡éœ€è¦æ¥è‡ªé”®ç›˜å’Œæ˜¾ç¤ºå™¨çš„è¿æ¥ï¼Œè€Œå¦ä¸€äº›è®¾å¤‡å¯ä»¥æ–¹ä¾¿çš„è¿æ¥ï¼Œè¿™ä¸ªé…ç½®æ–‡ä»¶æ— æ³•åŒºåˆ†é€»è¾‘consoleå’Œç‰©ç†consoleï¼Œå¯é€šè¿‡ä¿®æ”¹æ–‡ä»¶æ¥åŒºåˆ†äºŒè€…ã€‚\néœ€è¦é”®ç›˜å’Œæ˜¾ç¤ºå™¨è¿æ¥çš„è®¾å¤‡å¦‚ä¸‹ï¼š\n\u0026lt;console\u0026gt; 0600 \u0026lt;fb\u0026gt; 0600 root \u0026lt;console\u0026gt; 0600 \u0026lt;kbd\u0026gt; 0600 root \u0026lt;console\u0026gt; 0600 \u0026lt;joystick\u0026gt; 0600 root \u0026lt;console\u0026gt; 0600 \u0026lt;v4l\u0026gt; 0600 root \u0026lt;console\u0026gt; 0700 \u0026lt;gpm\u0026gt; 0700 root å…¶ä½™çš„è®¾å¤‡è¦ä¿®æ”¹ä¸ºé€šè¿‡serial consoleæ¥æ§åˆ¶ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬ä¸æƒ³è¦ä¸€ä¸ªå¤„äºæ‰˜ç®¡ä½ç½®çš„éç‰¹æƒç”¨æˆ·å»æŒ‚è½½è½¯ç›˜ã€‚ä¸ºserial consoleå®šä¹‰ä¸€ä¸ªæ–°çš„consoleç±»å‹ï¼Œå«åš\u0026lt;sconsole\u0026gt;ï¼Œå°†å®ƒæ·»åŠ åˆ°console.permsï¼š\n\u0026lt;sconsole\u0026gt;=ttyS0 ç„¶åå°†å…¶ä»–è®¾å¤‡çš„ \u0026lt;console\u0026gt; æ”¹ä¸º \u0026lt;sconsole\u0026gt;,ä½¿å®ƒä»¬æŒ‡å‘serial console:\n\u0026lt;sconsole\u0026gt; 0660 \u0026lt;floppy\u0026gt; 0660 root.floppy \u0026lt;sconsole\u0026gt; 0600 \u0026lt;sound\u0026gt; 0600 root \u0026lt;sconsole\u0026gt; 0600 \u0026lt;cdrom\u0026gt; 0660 root.disk \u0026lt;sconsole\u0026gt; 0600 \u0026lt;pilot\u0026gt; 0660 root.uucp \u0026lt;sconsole\u0026gt; 0600 \u0026lt;jaz\u0026gt; 0660 root.disk \u0026lt;sconsole\u0026gt; 0600 \u0026lt;zip\u0026gt; 0660 root.disk \u0026lt;sconsole\u0026gt; 0600 \u0026lt;ls120\u0026gt; 0660 root.disk \u0026lt;sconsole\u0026gt; 0600 \u0026lt;scanner\u0026gt; 0600 root \u0026lt;sconsole\u0026gt; 0600 \u0026lt;camera\u0026gt; 0600 root \u0026lt;sconsole\u0026gt; 0600 \u0026lt;memstick\u0026gt; 0600 root \u0026lt;sconsole\u0026gt; 0600 \u0026lt;flash\u0026gt; 0600 root \u0026lt;sconsole\u0026gt; 0600 \u0026lt;mainboard\u0026gt; 0600 root \u0026lt;sconsole\u0026gt; 0600 \u0026lt;rio500\u0026gt; 0600 root 6.7. é’ˆå¯¹RedHatçš„é…ç½® #RedHatå°†ä¸€äº›ç³»ç»Ÿåˆå§‹åŒ–æ‰€éœ€çš„å‚æ•°å­˜æ”¾åœ¨ /etc/sysconfig/initã€‚\nä¿®æ”¹BOOTUPå‚æ•°ï¼Œä½¿ç”¨ç‹¬ç«‹ç»ˆç«¯å‘½ä»¤å†™OKã€PASSEDå’ŒFAULTä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯å°†ä¸å†æ˜¾ç¤ºä¸ºç»¿è‰²ã€é»„è‰²æˆ–çº¢è‰²ã€‚/etc/sysconfig/init æ–‡ä»¶çš„æ³¨é‡Šè¯´ï¼Œé™¤äº†colorï¼Œè¿˜å¯ä»¥è®¾ç½®å…¶ä»–çš„å€¼ï¼Œä½†æ˜¯ï¼ŒBOOTUP å¿…é¡»è¢«è®¾ä¸º serialã€‚\nä¿®æ”¹PROMPTå‚æ•°ï¼Œç¦æ­¢äº¤äº’å¯åŠ¨ã€‚\nå¯¹ /etc/sysconfig/init çš„ä¿®æ”¹å¦‚ä¸‹ï¼š\nBOOTUP=serial PROMPT=no RedHatä¼šè¿è¡Œä¸€ä¸ªç”¨äºå‘ç°ç¡¬ä»¶è®¾å¤‡çš„ç¨‹åºï¼Œå«åš kudzuã€‚å½“å‘ç°ä¸€ä¸ªä¸²å£æ—¶ï¼Œkudzuä¼šå°†å…¶å¤ä½ï¼Œè¿™å°†åœæ­¢ serial consoleã€‚kudzu çš„é…ç½®æ–‡ä»¶æ˜¯ /etc/sysconfig/kudzuã€‚\nå°†é…ç½®æ–‡ä»¶ä¸­çš„ SAFE è®¾ä¸º yesï¼Œå°±ä¼šé˜»æ­¢ kudzu å¤ä½è®¾å¤‡ã€‚\nä¿®æ”¹ /etc/sysconfig/kudzu:\nSAFE=yes 7. é‡å¯æµ‹è¯• #7.1. éªŒè¯consoleæ“ä½œ #æœ‰å¯èƒ½çš„è¯ï¼Œåœ¨ä¸²å£ä¸Šæ¥ä¸€ä¸ªä¸²å£æ¥çº¿ç›’ã€‚åœ¨é‡å¯çš„è¿‡ç¨‹ä¸­ï¼ŒDTRä¿¡å·ä¼šè¢«æ¿€æ´»ï¼Œå‡ºç°consoleä¿¡æ¯æ—¶ï¼Œæ•°æ®æŒ‡ç¤ºç¯ä¼šé—ªçƒã€‚åœ¨é‡Œä¸€å°ç”µè„‘ä¸Šé…ç½®å¥½ç»ˆç«¯ï¼Œé‡å¯è®¡ç®—æœºã€‚\né‡å¯è¿‡ç¨‹ä¸­ï¼Œåœ¨ç»ˆç«¯ç•Œé¢å¯ä»¥çœ‹åˆ°bootloaderçš„å¯åŠ¨ä¿¡æ¯ï¼Œç„¶åæ˜¯kernelå¯åŠ¨ï¼Œç³»ç»Ÿåˆå§‹åŒ–è¾“å‡ºï¼Œæœ€åä¼šæ˜¾ç¤º/etc/issueçš„å†…å®¹ï¼Œå¹¶ä¸”gettyè¦æ±‚ä½ ç™»å½•ã€‚\nå¦‚æœæ²¡æœ‰çœ‹åˆ°loginä¿¡æ¯ï¼Œå¯èƒ½ä¼šæç¤ºæŒ‰ä¸‹Returnæˆ–Enteré”®ã€‚\n7.2. é‡å»ºconsoleè®¾ç½® #ç”¨rootç”¨æˆ·ç™»å½•serial consoleã€‚å‰é¢æˆ‘ä»¬åˆ é™¤äº†/etc/ioctl.saveï¼Œç°åœ¨è¦é‡æ–°é…ç½®consoleï¼Œæ³¢ç‰¹ç‡ä¸º9600,8ä½æ•°æ®ä½ï¼Œæ— å¥‡å¶æ ¡éªŒï¼Œ1ä½åœæ­¢ä½ã€‚\nremote.example.edu.au ttyS0 login: root Password: â€¦ sh# rm -f /etc/ioctl.save bash# telinit 1 â€¦Telling INIT to go to single user mode. INIT: Going single user INIT: Sending processes the TERM signal sh# stty sane -parenb cs8 crtscts brkint -istrip -ixoff -ixon ç»“æŸå•ç”¨æˆ·æ¨¡å¼è¿”å›æ­£å¸¸è¿è¡Œçº§åˆ«åï¼Œserial consoleçš„ç»ˆç«¯é…ç½®ä¼šä¿å­˜åˆ°/etc/ioctl.saveã€‚\nsh# exit ... bash# ls -l /etc/ioctl.save -rw------- 1 root root 60 Jan 1 00:00 /etc/ioctl.save å½“ç³»ç»Ÿä»¥å•ç”¨æˆ·æ¨¡å¼å¯åŠ¨åï¼Œä¼šä½¿ç”¨/etc/ioctl.saveã€‚\né™„å½•ï¼š #æˆ‘çš„å¹³å°ï¼š\nä¸¤å°PCï¼Œä¸€ä¸ªå®‰è£…Redhat 9ï¼Œbootlloaderä¸ºGrub 0.93ï¼Œå¦ä¸€ä¸ªå®‰è£…WindowsXP,ç”¨è¶…çº§ç»ˆç«¯ä½œä¸ºserial consoleæ˜¾ç¤ºè®¾å¤‡ï¼Œç”¨DB9å¤´çš„ä¸²å£é€šä¿¡çº¿å°†äºŒè€…COM1ç›¸è¿ï¼Œåªå°†ä¸¤ç«¯çš„TXå’ŒRXä¿¡å·äº¤å‰ç›¸è¿ï¼Œå…¶ä»–ä¿¡å·éƒ½ç›´è¿ã€‚\næ“ä½œæ­¥éª¤ï¼š\nä¿®æ”¹/boot/grub/grub.conf\næ·»åŠ ï¼š\nserial --unit=0 --speed=9600 --word=8 --parity=no --stop=1 terminal --timeout=10 serial console åœ¨kernelåé¢æ·»åŠ å‚æ•°ï¼š\nconsole=tty0 console=ttyS0,9600n8 ä¿®æ”¹/etc/inittab\næ·»åŠ ï¼š\ncoï¼š2345ï¼šrespawnï¼š/sbin/agetty -t 60 ttyS0 9600 vt100 åœ¨XPç³»ç»Ÿä¸Šæ‰“å¼€è¶…çº§ç»ˆç«¯ï¼Œæ³¢ç‰¹ç‡ä¸º9600ï¼Œ8ä½æ•°æ®ä½ï¼Œ1ä½åœæ­¢ä½ï¼Œæ— å¥‡å¶æ ¡éªŒï¼Œæ— æ•°æ®æµæ§åˆ¶ã€‚ç„¶åé‡å¯Redhat9ï¼Œåœ¨è¶…çº§ç»ˆç«¯ä¸Šå³å¯çœ‹åˆ°å†…æ ¸å’Œæ–‡ä»¶ç³»ç»Ÿçš„å¯åŠ¨ä¿¡æ¯ï¼Œæœ€åå¯ä»¥ç”¨æ™®é€šç”¨æˆ·ç™»å½•ï¼Œç™»å½•åå¯ä»¥ç”¨su rootå‘½ä»¤åˆ‡æ¢åˆ°rootç”¨æˆ·ã€‚è¿™é‡Œæœ‰ä¸ªé—®é¢˜è¿˜æœªè§£å†³ï¼Œæ–‡ä»¶ç³»ç»Ÿçš„ä¿¡æ¯åªèƒ½åœ¨è¶…çº§ç»ˆç«¯ä¸Šæ˜¾ç¤ºï¼Œåœ¨Redhat9çš„å±å¹•ä¸Šæ˜¾ç¤ºå®Œå†…æ ¸å¯åŠ¨ä¿¡æ¯åå°±æš‚åœè¾“å‡ºäº†ï¼Œæœ€åç›´æ¥æ˜¾ç¤ºç™»å½•ä¿¡æ¯ï¼Œå¾…è§£å†³ã€‚\nå¦‚æœæƒ³è®©rootç”¨æˆ·é€šè¿‡serial consoleç™»å½•ï¼Œéœ€è¦ä¿®æ”¹/etc/securettyï¼Œåœ¨è¯¥æ–‡ä»¶çš„æœ€åä¸€è¡Œæ·»åŠ ttyS0ï¼Œé‡å¯åå³å¯åœ¨è¶…çº§ç»ˆç«¯ç”¨rootç”¨æˆ·ç™»å½•ã€‚\nå…¶ä»–è®¾ç½®æš‚æœªæµ‹è¯•ã€‚\n","date":"2011 July 22","permalink":"/posts/2011/07/22/","section":"Posts","summary":"åŸæ–‡ï¼š","title":"ä¸ºLinuxç³»ç»Ÿé…ç½®serial console"},{"content":"åŸç† #ç°åœ¨æœ‰ä¸€ä¸ªæ–‡ä»¶file1ï¼Œé€šè¿‡ä¿®æ”¹file1å¾—åˆ°äº†æ–‡ä»¶file2ï¼Œç„¶åç”¨diffå·¥å…·æ¯”è¾ƒfile1å’Œfile2çš„å·®å¼‚ï¼Œå¾—åˆ°ä¸€ä¸ªè¡¥ä¸æ–‡ä»¶file.patchï¼Œå®ƒè®°å½•äº†ä¸¤ä¸ªæ–‡ä»¶çš„ä¸åŒä¹‹å¤„ï¼Œpatchå·¥å…·å°±å¯ä»¥æ ¹æ®è¿™ä¸ªè¡¥ä¸æ–‡ä»¶ä¿®æ”¹file1ï¼Œä»è€Œå¾—åˆ°file2ã€‚\nç›¸å…³å·¥å…· #diff diff [options] æºæ–‡ä»¶ ç›®æ ‡æ–‡ä»¶ diffç”¨äºåˆ—å‡ºä¸¤ä¸ªæ–‡ä»¶çš„ä¸åŒä¹‹å¤„ï¼ŒæŒ‡ç¤ºå¦‚ä½•ç”±æºæ–‡ä»¶å˜ä¸ºç›®æ ‡æ–‡ä»¶ï¼Œå¯ä»¥ç”¨é‡å®šå‘ç”Ÿæˆè¡¥ä¸æ–‡ä»¶ï¼Œæ³¨æ„ï¼šdiffåªèƒ½ç”¨äºæ¯”è¾ƒæ–‡æœ¬æ–‡ä»¶ã€‚å¸¸ç”¨é€‰é¡¹ï¼š\n-cï¼Œè¾“å‡ºä¸€ä¸ªåŸºäºä¸Šä¸‹æ–‡çš„diffï¼Œå³æä¾›æ¯å¤„ä¿®æ”¹çš„å‰åæœºä¼šå†…å®¹ï¼Œè¿™æ ·patchå‘½ä»¤å¯ä»¥åœ¨æ‰“è¡¥ä¸å‰éªŒè¯ä¸Šä¸‹æ–‡æ˜¯å¦åŒ¹é…ï¼Œè€Œè¡¥ä¸æ–‡ä»¶ä¹Ÿæ›´å®¹æ˜“é˜…è¯»ã€‚\n-bï¼Œå¿½ç•¥ç©ºæ ¼å¼•èµ·çš„å˜åŒ–\n-Bï¼Œå¿½ç•¥æ’å…¥/åˆ é™¤ç©ºè¡Œå¼•èµ·çš„å˜åŒ–\n-iï¼Œå¿½ç•¥å¤§å°å†™\n-Nï¼Œåœ¨æ¯”è¾ƒç›®å½•æ—¶ï¼Œå¦‚æœä¸€ä¸ªæ–‡ä»¶åªåœ¨å…¶ä¸­ä¸€ä¸ªç›®å½•ä¸­æ‰¾åˆ°ï¼Œé‚£å®ƒè¢«è§†ä¸ºåœ¨ç¬¬äºŒä¸ªç›®å½•ä¸­æ˜¯ä¸€ä¸ªç©ºæ–‡ä»¶\n-rï¼Œåœ¨æ¯”è¾ƒç›®å½•æ—¶ï¼Œé€’å½’æ¯”è¾ƒæ‰€æœ‰å­ç›®å½•\n-uï¼Œä½¿ç”¨ç»Ÿä¸€çš„è¾“å‡ºæ ¼å¼\npatch patch [options] æºæ–‡ä»¶ è¡¥ä¸æ–‡ä»¶ patchç”¨äºæ ¹æ®è¡¥ä¸æ–‡ä»¶ä¿®æ”¹æºæ–‡ä»¶ï¼Œå®ƒä¼šç›´æ¥æ”¹åŠ¨æºæ–‡ä»¶ï¼Œæ‰“è¡¥ä¸å‰è¯·æ³¨æ„å¤‡ä»½ã€‚å¸¸ç”¨é€‰é¡¹ï¼š\n-Rï¼Œåå‘è¡¥ä¸ï¼Œå°†å·²ç»æ‰“äº†è¡¥ä¸çš„æ–‡ä»¶æ¢å¤åˆ°åŸæ¥çš„æ ·å­\n-p[num]ï¼Œå¿½ç•¥å‰å‡ å±‚ç›®å½•ï¼Œç›®å½•çš„å±‚æ•°ç”±numæŒ‡å®š\nä¾‹1ï¼šæ¯”è¾ƒä¸¤ä¸ªæ–‡ä»¶ #file1:\nthis is line1 this is line2 this is line3 this is line4 file2ï¼š\nthis is line1 this is line2 hello this is line3 this is line4 this is line5 æ‰§è¡Œï¼š\ndiff file1 file2 \u0026gt; file.patch ç”Ÿæˆè¡¥ä¸æ–‡ä»¶file.patchï¼š\n2c2 \u0026lt; this is line2 --- \u0026gt; this is line2 hello 4a5 \u0026gt; this is line5 å¯¹file1æ‰“è¡¥ä¸ï¼š\npatch file1 file.patch file1çš„å†…å®¹å°±å˜æˆäº†file2ï¼Œå¦‚æœæƒ³æŠŠfile1å˜ä¸ºåŸæ¥çš„æ ·å­ï¼Œæ‰§è¡Œï¼š\npatch -R file1 file.patch ä¾‹2ï¼šæ¯”è¾ƒä¸¤ä¸ªç›®å½• #åœ¨å·¥ä½œè·¯å¾„ä¸‹æœ‰ä¸¤ä¸ªç›®å½•ï¼šdoc1å’Œdoc2ã€‚\næ‰§è¡Œdiffå‘½ä»¤ï¼Œç”Ÿæˆè¡¥ä¸æ–‡ä»¶patchï¼š\ndiff -Nur doc1 doc2 \u0026gt; doc.patch ç”¨patchå·¥å…·ä¸ºdoc1æ‰“è¡¥ä¸ï¼š\ncd doc1 patch -p1 \u0026lt; ../doc.patch å‚è€ƒï¼š #ç”¨Diffå’ŒPatchå·¥å…·ç»´æŠ¤æºç ï¼š https://www.ibm.com/developerworks/cn/linux/l-diffp/\n","date":"2011 July 15","permalink":"/posts/2011/07/15/","section":"Posts","summary":"åŸç† #ç°åœ¨æœ‰ä¸€ä¸ªæ–‡ä»¶file1ï¼Œé€šè¿‡ä¿®æ”¹file1å¾—åˆ°äº†æ–‡ä»¶file2ï¼Œç„¶åç”¨diffå·¥å…·æ¯”è¾ƒfile1å’Œfile2çš„å·®å¼‚ï¼Œå¾—åˆ°ä¸€ä¸ªè¡¥ä¸æ–‡ä»¶file.","title":"è¡¥ä¸çš„åˆ¶ä½œå’Œä½¿ç”¨"},{"content":"ä¸‹é¢è¿™æ®µä»£ç ä¼šè¾“å‡ºä»€ä¹ˆç»“æœï¼Ÿ\n#include \u0026lt;stdio.h\u0026gt; int main() { printf(\u0026quot;%d\\n\u0026quot;,( (i-sizeof(int)) \u0026gt;\u0026gt;32)); return 0; } ç­”æ¡ˆæ˜¯ 0\nå°†ä»£ç ä¿®æ”¹å¦‚ä¸‹ï¼š\n#include \u0026lt;stdio.h\u0026gt; int main() { printf(\u0026quot;%d\\n\u0026quot;,( (i-((int)sizeof(int))) \u0026gt;\u0026gt;32)); return 0; } ç»“æœè¾“å‡º -1\nè§£æï¼š\nsizeofæ˜¯ä¸€ä¸ªæ“ä½œç¬¦ï¼Œå®ƒè¿”å›çš„ç»“æœæ˜¯unsigned intã€‚\nå¯¹äºæ— ç¬¦å·æ•°ï¼šå³ç§»åï¼Œé«˜ä½è¡¥0ï¼›\nå¯¹äºæœ‰ç¬¦å·æ•°ï¼šæ­£æ•°ï¼Œå³ç§»åé«˜ä½è¡¥0ï¼›è´Ÿæ•°ï¼Œå³ç§»åé«˜ä½è¡¥1ã€‚\nå»ºè®®åªå¯¹æ— ç¬¦å·æ•°åšä½è¿è¡Œï¼Œå‡å°‘å‡ºé”™çš„å¯èƒ½ã€‚\næ³¨æ„ï¼šç§»åŠ¨çš„ä½æ•°è¦å°äºåšæ“ä½œæ•°çš„æ€»ä½æ•°ï¼Œå¦åˆ™ç»“æœæ˜¯undefinedï¼ˆè™½ç„¶æœ‰æ—¶ä¹Ÿä¼šå¾—åˆ°æ­£ç¡®çš„ç»“æœï¼‰ã€‚\n","date":"2011 July 8","permalink":"/posts/2011/07/08/","section":"Posts","summary":"ä¸‹é¢è¿™æ®µä»£ç ä¼šè¾“å‡ºä»€ä¹ˆç»“æœï¼Ÿ","title":"å…³äºCè¯­è¨€çš„ä½ç§»æ“ä½œ"},{"content":"å…ˆåšä¸€é“é¢˜ç›®ï¼š\n#include \u0026lt;stdio.h\u0026gt; int f(int *p) { static int i = 5; p=\u0026amp;i; return 0; } int main(void) { int *p; f(p); printf(\u0026quot;p = %d/n\u0026quot;,*p); return 0; } è¯¥ç¨‹åºçš„è¾“å‡ºç»“æœæ˜¯å¤šå°‘ï¼Ÿ\næœ‰äººä¼šè®¤ä¸ºè¾“å‡ºçš„æ˜¯â€œp = 5â€ï¼Œå…¶å®åº”è¯¥æ˜¯ä¸€ä¸ªä¸ç¡®å®šçš„æ•°ã€‚\nä¸ºäº†å¼„æ¸…ä¸ºä»€ä¹ˆï¼Œå…ˆçœ‹ä¸‹ä¸€ä¸ªä¾‹å­ï¼š\n#include \u0026lt;stdio.h\u0026gt; int main(void) { int i=0x01; int *p=\u0026amp;i; printf(\u0026quot;\u0026amp;i = %x/n\u0026quot;,\u0026amp;i); //içš„åœ°å€ printf(\u0026quot;p = %x/n\u0026quot;,p); printf(\u0026quot;*p = %x/n\u0026quot;,*p); printf(\u0026quot;\u0026amp;p = %x/n\u0026quot;,\u0026amp;p); return 0; } æ‰§è¡Œç»“æœï¼š\n\u0026amp;i = bfffe924 p = bfffe924 *p = 1 \u0026amp;p = bfffe920 è§£æï¼š\næŒ‡é’ˆå 4Byteï¼Œå­˜æ”¾ç€å®ƒæ‰€æŒ‡å‘çš„æ•°æ®çš„åœ°å€ã€‚Pæ˜¯ä¸€ä¸ªæŒ‡å‘intå‹å˜é‡içš„æŒ‡é’ˆï¼Œæ‰€ä»¥pè¡¨ç¤ºè¯¥æŒ‡é’ˆçš„å†…å®¹ï¼Œä¹Ÿå°±æ˜¯içš„åœ°å€ï¼›*pè¡¨ç¤ºpæŒ‡å‘çš„å†…å®¹ï¼Œå°±æ˜¯iï¼›\u0026amp;pä»£è¡¨æŒ‡é’ˆpæœ¬èº«çš„åœ°å€ã€‚\nå†çœ‹ç¬¬ä¸€é“é¢˜ï¼Œmainå‡½æ•°é‡Œçš„på’Œfå‡½æ•°çš„å‚æ•°péƒ½æ˜¯æŒ‡å‘intå‹çš„æŒ‡é’ˆï¼Œå½“ main å‡½æ•°è°ƒç”¨få‡½æ•°æ—¶ï¼šf(p),ä¼ é€’ç»™få‡½æ•°çš„æ˜¯mainå‡½æ•°ä¸­çš„pçš„å†…å®¹ï¼Œå› ä¸ºpæ²¡æœ‰åˆå§‹åŒ–ï¼Œæ‰€ä»¥å®ƒçš„å†…å®¹æ˜¯ä¸€ä¸ªä¸ç¡®å®šçš„åœ°å€ï¼Œæ‰€ä»¥ï¼Œfå‡½æ•°ä¸­çš„pæŒ‡å‘äº†è¿™ä¸ªä¸ç¡®å®šåœ°å€ã€‚\næ€æ ·æ‰èƒ½è®© main å‡½æ•°ä¸­çš„pæŒ‡å‘få‡½æ•°ä¸­çš„é™æ€å˜é‡iå‘¢ï¼Ÿ\nå°†ç¨‹åºåšå¦‚ä¸‹ä¿®æ”¹å³å¯ï¼š\n#include \u0026lt;stdio.h\u0026gt; int f(int **p) { static int i = 5; *p=\u0026amp;i; return 0; } int main(void) { int i=0x01; int *p=\u0026amp;i; f(\u0026amp;p); printf(\u0026quot;p = %d/n\u0026quot;,*p); return 0; } ","date":"2011 July 1","permalink":"/posts/2011/07/01/","section":"Posts","summary":"å…ˆåšä¸€é“é¢˜ç›®ï¼š","title":"å…³äºå‡½æ•°çš„æŒ‡é’ˆå‚æ•°"},{"content":"ä¸‹é¢æ˜¯ä¸€ä¸ªæ’åºç®—æ³•ï¼Œç”¨shellå®ç°çš„ï¼š\nsleepsort.sh\n#!/bin/bash function f() { sleep \u0026quot;$1\u0026quot; echo \u0026quot;$1\u0026quot; } while [ -n \u0026quot;$1\u0026quot; ] do f \u0026quot;$1\u0026quot; \u0026amp; shift done wait ç”¨æ³•ï¼š\n./sleepsort.sh 5 3 6 3 6 3 1 4 7 è¿™ä¸ªç®—æ³•å¤ªNBã€å¤ªBTã€å¤ªæç¬‘äº†ï¼\nç¥é©¬å†’æ³¡ã€æ’å…¥ã€å½’å¹¶\u0026hellip; å…¨æ˜¯æµ®äº‘å•Šï¼\nè†œæ‹œå§ï¼\nè¯¦æƒ…å¯è§é…·å£³åŸæ–‡ï¼šhttp://coolshell.cn/articles/4883.html\nä½©æœä¹‹ä½™ï¼Œæˆ‘åœ¨linuxä¸‹ç”¨Cè¯­è¨€å®ç°äº†ä¸€æŠŠï¼š\nsleepsort.c\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;unistd.h\u0026gt; #include \u0026lt;pthread.h\u0026gt; void *f(void *opt) { sleep((*((int *)opt))); printf(\u0026quot;%d,\u0026quot;,(*((int *)opt))); pthread_exit(0); } int main() { const int len=5; pthread_t a_thread[5]; int array[5]={3,5,2,4,1}; int i=0; while(i\u0026lt;len) { pthread_create(\u0026amp;(a_thread[i]),NULL,f,\u0026amp;(array[i])); i++; } i=0; while(i\u0026lt;len) { pthread_join(a_thread[i],0); i++; } printf(\u0026quot;/n\u0026quot;); return 0; } ç¼–è¯‘ï¼š\ngcc -Wall -o sleepsort sleepsort.c -lpthread æ‰§è¡Œï¼š\n./sleepsort 1,2,3,4,5, ","date":"2011 June 28","permalink":"/posts/2011/06/28/","section":"Posts","summary":"ä¸‹é¢æ˜¯ä¸€ä¸ªæ’åºç®—æ³•ï¼Œç”¨shellå®ç°çš„ï¼š","title":"ç¥çº§æ’åºç®—æ³•"},{"content":"å¯¹äºunicodeç¼–ç çš„å­—ç¬¦ï¼Œå¯ä»¥å…ˆå°†unicodeç¼–ç è½¬æ¢ä¸ºGBKç¼–ç ï¼Œç„¶ååˆ©ç”¨GBKç‚¹é˜µå­—åº“ï¼ˆgbk.bin)æ˜¾ç¤ºå­—ç¬¦ã€‚ä¸€ä¸ªæ¯”è¾ƒå¥½çš„ç¼–ç è½¬æ¢æ–¹æ³•æ˜¯ï¼Œåˆ¶ä½œä¸€ä¸ªæŒ‰ç…§unicodeç¼–ç é¡ºåºæ’åˆ—çš„GBKç¼–ç è¡¨ï¼Œç›´æ¥æ ¹æ®unicodeç¼–ç å°±å¯ä»¥æŸ¥åˆ°å¯¹åº”çš„GBKç¼–ç ï¼Œå…·ä½“çš„åˆ¶ä½œæ–¹æ³•å¦‚ä¸‹ï¼š\n1.ç”Ÿæˆä¸€ä¸ªunicodeå­—ç¬¦æ–‡ä»¶ #ä¸Šä»¥ç¯‡æ–‡ç« ä¸­å·²ç»åˆ¶ä½œäº†ä¸€ä¸ªGBKç¼–ç çš„å…¨å­—ç¬¦æ–‡ä»¶gbk.txtï¼Œç”¨è®°äº‹æœ¬æ‰“å¼€gbk.txtï¼Œç„¶åä»¥unicodeç¼–ç å¦å­˜ä¸ºunicode.txtæ–‡ä»¶ã€‚\nè¿™æ ·çš„è¯ï¼Œæ‰€æœ‰çš„GBKç¼–ç å­—ç¬¦éƒ½ç”¨unicodeç¼–ç ä¿å­˜åœ¨unicode.txtä¸­äº†ï¼Œå¯ä»¥ç”¨winhexæ‰“å¼€unicode.txtï¼Œä¼šå‘ç°å‰ä¸¤ä¸ªå­—èŠ‚æ˜¯FFFEï¼Œè¿™æ˜¯unicodeç¼–ç çš„æ ‡è¯†ï¼Œè¦æ³¨æ„åé¢çš„unicodeç¼–ç æ˜¯å°ç«¯å­˜å‚¨ã€‚\n2.åˆ¶ä½œunicodeè½¬gbkçš„æ–‡ä»¶ #è¿™é‡Œè¦ç”¨ç¨‹åºåˆ¶ä½œä¸€ä¸ªunicodeä¸gbkç¼–ç ç›¸å¯¹åº”çš„æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶æ¯å››ä¸ªå­—èŠ‚ä¸ºä¸€ç»„ï¼Œå…¶ä¸­å‰ä¸¤ä¸ªå­—èŠ‚ä¸ºunicodeç¼–ç ï¼Œåä¸¤ä¸ªå­—èŠ‚æ˜¯å¯¹åº”çš„gbkç¼–ç ï¼Œä¸¤ç§ç¼–ç éƒ½ä»¥å°ç«¯å­˜å‚¨ï¼Œæ•°æ®ç»“æ„å¦‚ä¸‹ï¼š\nunion code { unsigned int unigbk; unsigned short int uni_gbk[2]; unsigned char buffer[4]; }; è¿™ä¸ªæ•°æ®ç»“æ„æ˜¯ä»¥gbkç¼–ç çš„é¡ºåºå­˜æ”¾åœ¨æ–‡ä»¶uni2gbk.txtä¸­ï¼Œæ–‡ä»¶å¤§å°ä¸º128764Byteã€‚ç¨‹åºå¦‚ä¸‹ï¼š\n//ç”±unicode.txtå’Œgbk.txtç”Ÿæˆuni2gbk.txt #include \u0026lt;stdio.h\u0026gt; int main(void) { unsigned char buffer[2]; int count=0; FILE *fup=0; FILE *fgp=0; FILE *fwp=0; fup=fopen(\u0026quot;unicode.txt\u0026quot;,\u0026quot;rb\u0026quot;); fgp=fopen(\u0026quot;gbk.txt\u0026quot;,\u0026quot;rb\u0026quot;); fwp=fopen(\u0026quot;uni2gbk.txt\u0026quot;,\u0026quot;wb\u0026quot;); fgetc(fup); fgetc(fup); while(1) { //è¯»å–unicodeç¼–ç ï¼Œå†™å…¥uni2gbk.txt buffer[0]=fgetc(fup); buffer[1]=fgetc(fup); fputc(buffer[0],fwp); fputc(buffer[1],fwp); //è¯»å–gbkç¼–ç ï¼Œå†™å…¥uni2gbk.txt buffer[0]=fgetc(fgp); buffer[1]=fgetc(fgp); fputc(buffer[1],fwp); fputc(buffer[0],fwp); count+=2; if(count==0xfb7c) printf(\u0026quot;xxxxxxxxx/n\u0026quot;); if(buffer[0]==0xfe \u0026amp;\u0026amp; buffer[1]==0xfe) { printf(\u0026quot;count = %x/n\u0026quot;,count); fclose(fup); fclose(fgp); fclose(fwp); return; } } return 0ï¼› } 3.å°†uni2gbk.txtæ’åº #ç”¨ç¨‹åºå°†uni2gbk.txtæ–‡ä»¶ä¸­çš„union codeæ•°æ®ç»“æ„æŒ‰ç…§unicodeç¼–ç çš„é¡ºåºä»å°åˆ°å¤§æ’åºï¼Œç¨‹åºå¦‚ä¸‹ï¼š\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; #define MAXSIZE (0x7DBF) //union codeçš„ä¸ªæ•° union code { unsigned int unigbk; unsigned short int uni_gbk[2]; unsigned char buffer[4]; }; int main(void) { unsigned char flag=1; unsigned int i=0; unsigned int j=0; union code pdata; union code ndata; FILE *fp=0; fp = fopen(\u0026quot;uni2gbk.txt\u0026quot;,\u0026quot;rb+\u0026quot;); for(i=1; i\u0026lt;MAXSIZE \u0026amp;\u0026amp; flag==1; i++) { flag=0; for(j=0; j\u0026lt;(MAXSIZE-i); j++) { fseek(fp,j*4,0); fread(pdata.buffer,1,4,fp); fseek(fp,j*4+4,0); fread(ndata.buffer,1,4,fp); if(pdata.uni_gbk[0]\u0026gt;ndata.uni_gbk[0]) { flag=1; fseek(fp,j*4,0); fwrite(ndata.buffer,4,1,fp); fseek(fp,j*4+4,0); fwrite(pdata.buffer,4,1,fp); } } printf(\u0026quot;i=%d/n\u0026quot;,i); } fclose(fp); } æ’åºåï¼Œä¸ºäº†ä¸æ²¡æœ‰æ’åºçš„uni2gbk.txtåŒºåˆ†ï¼Œå°†æ–‡ä»¶åæ”¹ä¸ºuni2gbkp.txtã€‚\n4.åˆ é™¤æ— ç”¨çš„ç¼–ç  #ç”¨winhexæ‰“å¼€uni2gbkp.txtï¼Œå¯ä»¥å‘ç°ï¼Œä»0åˆ°ç¬¬0x80EBä¸ªå­—èŠ‚ä¸­çš„unicodeç¼–ç éƒ½æ˜¯0x0020æˆ–0x003Fï¼Œè¿™äº›éƒ½æ˜¯æ— ç”¨çš„ç¼–ç ï¼Œå®ƒä»¬æ‰€å¯¹åº”çš„gbkç¼–ç ä¹Ÿæ˜¯æ— ç”¨çš„ï¼Œéƒ½å¯ä»¥åˆ é™¤ã€‚\nåˆ é™¤åï¼Œuni2gbkp.txtæ–‡ä»¶ä¸­çš„union codeæ•°æ®ç»“æ„çš„unicodeç¼–ç å°±æ˜¯ä»0x00A4å¼€å§‹ï¼Œä»¥0xFFE5ç»“æŸã€‚ä½†æ˜¯è¿™äº›unicodeç¼–ç ä¸æ˜¯è¿ç»­çš„ï¼Œä¾‹å¦‚0x00A4ä¹‹åå°±æ˜¯0x00A7ï¼Œä¸ºäº†æ–¹ä¾¿æŸ¥æ‰¾ï¼Œéœ€è¦åœ¨ä¸è¿ç»­çš„ç¼–ç ä¸­é—´ç”¨union codeå¡«å……ï¼Œå¯¹åº”çš„gbkç¼–ç éƒ¨åˆ†ç”¨0x0000å¡«å……ï¼Œç„¶åå°†union codeä¸­çš„unicodeç¼–ç å…¨éƒ¨åˆ é™¤ã€‚æœ€åç”Ÿæˆuni2gbk.binæ–‡ä»¶ã€‚ç¨‹åºå¦‚ä¸‹ï¼š\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; union code { unsigned int unigbk; unsigned short int uni_gbk[2]; unsigned char buffer[4]; }; int main() { unsigned short int count=0x00A4; //ä»unicodeçš„0x00A4å¼€å§‹ union code temp; FILE *frp=0; FILE *fwp=0; frp=fopen(\u0026quot;uni2gbkp.txt\u0026quot;,\u0026quot;rb\u0026quot;); fwp=fopen(\u0026quot;uni2gbk.bin\u0026quot;,\u0026quot;wb\u0026quot;); fseek(frp,0x80EC,SEEK_SET); //èˆå¼ƒuni2gbkp.txtæ–‡ä»¶çš„å‰0x80ECä¸ªå­—èŠ‚ fread(temp.buffer,1,4,frp); while(count\u0026lt;=0xffe5) //ä»¥unicodeçš„0xffe5ç»“æŸ { if(temp.uni_gbk[0]==count) //åˆ¤æ–­unicodeç¼–ç æ˜¯å¦è¿ç»­ { fputc(temp.buffer[2],fwp); //å°†å¯¹åº”çš„gbkç¼–ç å†™å…¥uni2gbk.bin fputc(temp.buffer[3],fwp); fread(temp.buffer,1,4,frp); } else //ä¸è¿ç»­çš„åœ°æ–¹å¡«å……0 { fputc(0x00,fwp); fputc(0x00,fwp); } count++; } fclose(frp); fclose(fwp); return 0; } ç”Ÿæˆçš„uni2gbk.binæ–‡ä»¶ä¸­éƒ½æ˜¯gbkç¼–ç ï¼Œè¿™äº›gbkç¼–ç éƒ½æ˜¯æŒ‰ç…§å¯¹åº”çš„unicodeç¼–ç ï¼ˆ0x00A4åˆ°0xFFE5ï¼‰çš„é¡ºåºæ’åˆ—çš„ã€‚\n5.uni2gbk.binçš„ä½¿ç”¨ #å‡è®¾ä¸€ä¸ªå­—ç¬¦çš„unicodeç¼–ç ä¸ºXï¼Œé‚£ä¹ˆå®ƒå¯¹åº”çš„gbkç¼–ç åœ¨uni2gbk.binæ–‡ä»¶ä¸­çš„ä½ç½®å°±æ˜¯ï¼š\nï¼ˆX-0x00A4ï¼‰*2\nä»è¿™ä¸ªä½ç½®è¯»å–ä¸€ä¸ªunsigned short intæ•°æ®ï¼Œå°±æ˜¯å®ƒçš„gbkç ã€‚ç„¶ååˆ©ç”¨GBKç‚¹é˜µå­—åº“ï¼ˆgbk.binï¼‰å³å¯æ˜¾ç¤ºã€‚\nä¾‹å¦‚ï¼Œä»¥Linuxçš„ç»ˆç«¯æ¨¡æ‹Ÿç‚¹é˜µå±å¹•ï¼Œç¨‹åºå¦‚ä¸‹ï¼š\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;unistd.h\u0026gt; #include \u0026lt;curses.h\u0026gt; #define START 0x8140 #define DATANUM 0x20 int displaychar(FILE *fp,unsigned short int dispch,char fillch,char start_x,char start_y); int main(void) { FILE * fp=0; unsigned short int testch = 0x7231; //æ±‰å­—'çˆ±â€˜çš„unicodeç  unsigned short int gbkch=0; //å­˜æ”¾testchçš„gbkç¼–ç  //å°†unicodeè½¬æ¢ä¸ºgbk fp = fopen(\u0026quot;uni2gbk.bin\u0026quot;,\u0026quot;rb\u0026quot;); fseek(fp,(testch-0x00A4)*((unsigned int)2),SEEK_SET); gbkch = fgetc(fp); gbkch = (fgetc(fp)\u0026lt;\u0026lt;8) + gbkch; fclose(fp); fp = fopen(\u0026quot;gbk.bin\u0026quot;,\u0026quot;rb\u0026quot;); initscr(); displaychar(fp,gbkch,'*',0,0); refresh(); while(1); endwin(); fclose(fp); return 0; } /* * fpæŒ‡å‘ç‚¹é˜µå­—åº“äºŒè¿›åˆ¶æ–‡ä»¶ * ä»¥ç‚¹é˜µæ–¹å¼æ˜¾ç¤ºä¸€ä¸ªGBKå­—ç¬¦ * dispchæ˜¯è¦æ˜¾ç¤ºçš„å­—ç¬¦ï¼Œfillchæ˜¯å¡«å……ç‚¹é˜µçš„å­—ç¬¦ * start_x,start_yæ˜¯æ˜¾ç¤ºçš„èµ·å§‹åæ ‡ */ int displaychar(FILE *fp,unsigned short int dispch,char fillch,char start_x,char start_y) { char x=start_x; char y=start_y; unsigned int location=(dispch-START)*DATANUM; int i=0; int j=0; char buf=0; fseek(fp,location,SEEK_SET); for(i=0;i\u0026lt;DATANUM;i++) { buf=fgetc(fp); //æ˜¾ç¤ºä¸€ä¸ªå­—èŠ‚ for(j=0;j\u0026lt;8;j++) { move(y+j,x); if( buf \u0026amp; (0x01\u0026lt;\u0026lt;j) ) { addch(fillch); } } if(x == (start_x+15)) { x=start_x; y=start_y+8; } else x++; } return 0; } ä¸‹è½½ï¼š #unicodeç‚¹é˜µå­—åº“æ–‡ä»¶ï¼šhttp://download.csdn.net/source/3362591\n","date":"2011 June 13","permalink":"/posts/2011/06/13/","section":"Posts","summary":"å¯¹äºunicodeç¼–ç çš„å­—ç¬¦ï¼Œå¯ä»¥å…ˆå°†unicodeç¼–ç è½¬æ¢ä¸ºGBKç¼–ç ï¼Œç„¶ååˆ©ç”¨GBKç‚¹é˜µå­—åº“ï¼ˆgbk.bin)æ˜¾ç¤ºå­—ç¬¦ã€‚ä¸€ä¸ªæ¯”è¾ƒå¥½çš„ç¼–ç è½¬æ¢æ–¹æ³•æ˜¯ï¼Œåˆ¶ä½œä¸€ä¸ªæŒ‰ç…§unicodeç¼–ç é¡ºåºæ’åˆ—çš„GBKç¼–ç è¡¨ï¼Œç›´æ¥æ ¹æ®unicodeç¼–ç å°±å¯ä»¥æŸ¥åˆ°å¯¹åº”çš„GBKç¼–ç ï¼Œå…·ä½“çš„åˆ¶ä½œæ–¹æ³•å¦‚ä¸‹ï¼š","title":"Unicodeç¼–ç å­—ç¬¦çš„ç‚¹é˜µæ˜¾ç¤º"},{"content":"GBKç¼–ç å…±æ”¶å½•æ±‰å­—21003ä¸ªã€ç¬¦å·883ä¸ªï¼Œå¹¶æä¾›1894ä¸ªé€ å­—ç ä½ï¼Œç®€ã€ç¹ä½“å­—èäºä¸€åº“ã€‚ä»¥ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªæ±‰å­—ï¼Œç¼–ç èŒƒå›´æ˜¯0x8140~0xfefeï¼Œå…¼å®¹GB2318ï¼Œå¹¶è¦†ç›–äº†unicodeä¸­çš„æ‰€æœ‰æ±‰å­—ã€‚Win7è®°äº‹æœ¬é»˜è®¤ä»¥GBKä¿å­˜æ±‰å­—ã€‚\nå…³äºGBKçš„è¯¦ç»†ä¿¡æ¯ï¼šhttp://baike.baidu.com/view/25421.htm\nå¼€å‘ç¯å¢ƒ:\nWin7ã€Eclipseã€MinGW\n1.ç”ŸæˆGBKå…¨å­—ç¬¦æ–‡ä»¶ #è¿è¡Œä¸‹é¢è¿™æ®µä»£ç ï¼Œç”ŸæˆGBKå…¨å­—ç¬¦æ–‡ä»¶gbk.txt,ç¼–ç èŒƒå›´0x8140~0xfefeã€‚\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; int main(void) { FILE *fp=0; char ch=0; unsigned short int start=0x8140; unsigned char part1=0; unsigned char part2=0; fp=fopen(\u0026quot;gbk.txt\u0026quot;,\u0026quot;wb\u0026quot;); if(fp==NULL) { perror(\u0026quot;Cann't open gbk.txt\u0026quot;); return -1; } else printf(\u0026quot;Creat file gbk.txt/n\u0026quot;); while(start \u0026lt; 0xfeff) { part1=start\u0026gt;\u0026gt;8; part2=start; fputc(part1,fp); fputc(part2,fp); start++; } fclose(fp); printf(\u0026quot;success!\u0026quot;); return 0; } è¿è¡Œåï¼Œç”¨è®°äº‹æœ¬æ‰“å¼€gbk.txtæ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°å…¶ä¸­çš„å­—ç¬¦ã€‚\n2.ç”Ÿæˆå­—æ¨¡äºŒè¿›åˆ¶æ–‡ä»¶ #ç”¨â€œç‰§ç å­—æ¨¡â€è½¯ä»¶æ‰“å¼€gbk.txtæ–‡ä»¶ï¼Œé€‰æ‹©å­—ä½“ä¸ºå®‹ä½“ï¼Œå­—é‡ä¸º1ï¼Œç‚¹é˜µå¤§å°16*16ï¼Œå¯¹é½æ–¹å¼ä¸ºå·¦ä¸‹ï¼Œå–æ¨¡æ–¹å¼ä¸ºâ€œçºµå‘å–æ¨¡ã€é«˜ä½åœ¨ä¸‹â€ã€‚è¾“å‡ºæ ¼å¼é€‰æ‹©binã€‚ç„¶åç‚¹å‡»è¾“å‡ºï¼Œä¼šç”Ÿæˆä¸€ä¸ªtemp.binæ–‡ä»¶ï¼Œæ”¹åä¸ºgbk.binã€‚\ngbk.binæ–‡ä»¶å°±æ˜¯GBKç¼–ç å­—ç¬¦çš„ç‚¹é˜µå­—åº“æ–‡ä»¶ï¼Œæ¯32ä¸ªå­—èŠ‚å¯ä»¥ç»˜åˆ¶ä¸€ä¸ªå­—ç¬¦ï¼Œä¾‹å¦‚ç¬¬ä¸€ä¸ªå­—ç¬¦â€˜ä¸‚â€™çš„æ˜¾ç¤ºå¦‚ä¸‹ï¼š\nå–æ¨¡çš„æ•°æ®ä¸ºï¼š\n0x02, 0x02, 0x02, 0xc2, 0xb2, 0x8e, 0x82, 0x82, 0x82, 0x82, 0x82, 0x82, 0x02, 0x02, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x80, 0x40, 0x3f, 0x00, 0x00, 0x00, 0x00,\n3.ä½¿ç”¨å­—åº“æ–‡ä»¶ #gbk.binæ–‡ä»¶ä¸­æŒ‰GBKç¼–ç çš„å¤§å°æ’åˆ—ï¼Œæ¯32ä¸ªå­—èŠ‚å¯ä»¥æ˜¾ç¤ºä¸€ä¸ªå­—ç¬¦ï¼Œå‡è®¾ä¸€ä¸ªå­—ç¬¦çš„GBKç¼–ç ä¸ºNUMï¼Œé‚£ä¹ˆå®ƒçš„ç‚¹é˜µæ•°æ®ç¬¬ä¸€ä¸ªå­—èŠ‚çš„ä½ç½®å°±æ˜¯ï¼š\nï¼ˆNUM-0x8240ï¼‰*32\nä»è¿™ä¸ªå­—èŠ‚å¼€å§‹ï¼Œè¯»å–32ä¸ªå­—èŠ‚ï¼Œå°†å…¶æŒ‰æŒ‰ç…§å–æ¨¡æ–¹å¼æ˜¾ç¤ºå³å¯ã€‚\nä¾‹å¦‚ï¼šç”¨Linuxçš„ç»ˆç«¯æ¨¡æ‹Ÿç‚¹é˜µå±å¹•ï¼Œæ¯ä¸ªå­—ç¬¦ä½ç½®å°±æ˜¯ä¸€ä¸ªç‚¹ï¼Œç¨‹åºå¦‚ä¸‹ï¼š\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;unistd.h\u0026gt; #include \u0026lt;curses.h\u0026gt; #define START 0x8140 #define DATANUM 0x20 int displaychar(FILE *fp,unsigned short int dispch,char fillch,char start_x,char start_y); int main(void) { FILE * fp=0; unsigned short int testch = 0xb0ae; //æ±‰å­—'çˆ±â€˜çš„gbkç  fp = fopen(\u0026quot;gbk.bin\u0026quot;,\u0026quot;rb\u0026quot;); initscr(); displaychar(fp,testch,'*',0,0); refresh(); while(1); endwin(); fclose(fp); return 0; } /* * fpæŒ‡å‘ç‚¹é˜µå­—åº“äºŒè¿›åˆ¶æ–‡ä»¶ * ä»¥ç‚¹é˜µæ–¹å¼æ˜¾ç¤ºä¸€ä¸ªGBKå­—ç¬¦ * dispchæ˜¯è¦æ˜¾ç¤ºçš„å­—ç¬¦ï¼Œfillchæ˜¯å¡«å……ç‚¹é˜µçš„å­—ç¬¦ * start_x,start_yæ˜¯æ˜¾ç¤ºçš„èµ·å§‹åæ ‡ */ int displaychar(FILE *fp,unsigned short int dispch,char fillch,char start_x,char start_y) { char x=start_x; char y=start_y; unsigned int location=(dispch-START)*DATANUM; int i=0; int j=0; char buf=0; fseek(fp,location,SEEK_SET); for(i=0;i\u0026lt;DATANUM;i++) { buf=fgetc(fp); //æ˜¾ç¤ºä¸€ä¸ªå­—èŠ‚ for(j=0;j\u0026lt;8;j++) { move(y+j,x); if( buf \u0026amp; (0x01\u0026lt;\u0026lt;j) ) { addch(fillch); } } if(x == (start_x+15)) { x=start_x; y=start_y+8; } else x++; } return 0; } æ˜¾ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š\nä¸‹è½½ï¼š #å­—åº“æ–‡ä»¶ï¼šhttp://download.csdn.net/source/3359198 å­—æ¨¡æå–è½¯ä»¶ï¼šhttp://download.csdn.net/source/3358791\n","date":"2011 June 12","permalink":"/posts/2011/06/12/","section":"Posts","summary":"GBKç¼–ç å…±æ”¶å½•æ±‰å­—21003ä¸ªã€ç¬¦å·883ä¸ªï¼Œå¹¶æä¾›1894ä¸ªé€ å­—ç ä½ï¼Œç®€ã€ç¹ä½“å­—èäºä¸€åº“ã€‚ä»¥ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªæ±‰å­—ï¼Œç¼–ç èŒƒå›´æ˜¯0x8140~0xfefeï¼Œå…¼å®¹GB2318ï¼Œå¹¶è¦†ç›–äº†unicodeä¸­çš„æ‰€æœ‰æ±‰å­—ã€‚Win7è®°äº‹æœ¬é»˜è®¤ä»¥GBKä¿å­˜æ±‰å­—ã€‚","title":"GBKç‚¹é˜µæ˜¾ç¤ºå­—åº“çš„åˆ¶ä½œå’Œä½¿ç”¨"},{"content":"å¼€å‘ç¯å¢ƒï¼š\nWin7ï¼ŒEclipseï¼ŒMinGW\n#1.ç”ŸæˆASCIIå­—ç¬¦æ–‡ä»¶\nASCIIç¼–ç çš„å¯æ‰“å°å­—ç¬¦æ˜¯0x20~0x7E,å…ˆç”¨è¿è¡Œä¸‹é¢è¿™æ®µä»£ç ï¼Œç”Ÿæˆä¸€ä¸ªåŒ…å«å…¨éƒ¨å¯æ‰“å°å­—ç¬¦çš„txtæ–‡ä»¶ï¼š\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; int main(int argc,char *argv[]) { FILE * fp; unsigned char i = 0; fp = fopen(\u0026quot;ascii.txt\u0026quot;,\u0026quot;w\u0026quot;); if(fp == 0) { perror(\u0026quot;open\u0026quot;); return -1; } for(i=0x20;i\u0026lt;0x7F;i++) { fputc(i,fp); } return 0; } è¿è¡Œåï¼Œç”¨è®°äº‹æœ¬æ‰“å¼€ascii.txtæ–‡ä»¶ï¼Œä¼šçœ‹åˆ°å¦‚ä¸‹æ–‡æœ¬ï¼š\n#2.ç”Ÿæˆå­—æ¨¡æ•°æ®\nä½¿ç”¨å­—æ¨¡æå–V2.1è½¯ä»¶ï¼Œè®¾ç½®å­—ä½“ä¸ºå®‹ä½“ã€12ï¼Œçºµå‘å–æ¨¡ï¼Œå­—èŠ‚å€’åºï¼ˆå³é«˜ä½åœ¨ä¸‹ï¼‰ã€‚è¿™äº›è®¾ç½®å¯ä»¥æ ¹æ®å®é™…æƒ…å†µè®¾ç½®ã€‚ç”¨C51æ ¼å¼ç”Ÿæˆå­—æ¨¡ï¼Œå¤§å°æ˜¯8*16ï¼Œæ¯ä¸ªå­—ç¬¦ç”¨16ä¸ªå­—èŠ‚è¡¨ç¤ºã€‚å¦‚å­—ç¬¦Açš„æ˜¾ç¤ºå¦‚ä¸‹ï¼š\nå–æ¨¡æ•°æ®ä¸ºï¼š\n0x00,0x00,0xC0,0x38,0xE0,0x00,0x00,0x00,0x20,0x3C,0x23,0x02,0x02,0x27,0x38,0x20,\nç„¶åå°†æ‰€æœ‰çš„å­—æ¨¡æ•°æ®å¤åˆ¶åˆ°ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œåˆ é™¤å…¶ä¸­çš„ç©ºè¡Œï¼Œæ¢è¡Œï¼Œæ³¨é‡Šç­‰ä¸å­—æ¨¡æ•°æ®æ— å…³çš„å†…å®¹ï¼Œå¹¶å°†æ–‡ä»¶æœ€åçš„ä¸€ä¸ªé€—å·æ”¹ä¸ºASCIIå­—ç¬¦çš„å¥å·ï¼Œå¾—åˆ°ä¸€ä¸ªçº¯å­—æ¨¡æ•°æ®æ–‡ä»¶ascii_zk.txt\n#3.å°†å­—æ¨¡æ•°æ®æ–‡ä»¶è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ–‡ä»¶\nå°†ascii_zk.txtæ–‡ä»¶ä¸­çš„æ¯ä¸ªå­—æ¨¡æ•°æ®è½¬æ¢ä¸ºå ä¸€ä¸ªå­—èŠ‚çš„æ•°ï¼Œå°†æ‰€æœ‰çš„æ•°æ®å¡«å……ä¸ºä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ascii_zk.binã€‚è¿™æ ·ï¼ŒæŒ‰ç…§ASCIIç çš„é¡ºåºï¼Œascii_zk.binä¸­æ¯16ä¸ªå­—èŠ‚å°±å¯ä»¥ç»˜åˆ¶ä¸€ä¸ªå­—ç¬¦ã€‚æ–‡ä»¶è½¬æ¢çš„ç¨‹åºå¦‚ä¸‹ï¼š\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; /* *å°†ä¸€ä¸ªasciiå­—ç¬¦è½¬æ¢ä¸ºæ•° */ unsigned char c2x(char ch) { unsigned char temp=0; if(ch\u0026gt;=0x30 \u0026amp;\u0026amp; ch\u0026lt;=0x39) temp = ch-0x30; else if(ch\u0026gt;=0x41 \u0026amp;\u0026amp; ch\u0026lt;=0x46) temp = 0x0a+(ch-0x41); else if(ch\u0026gt;=0x61 \u0026amp;\u0026amp; ch\u0026lt;=0x66) temp = 0x0a+(ch-0x61); else temp =0xff; return temp; } //å°†ascii_zk.txtè½¬æ¢ä¸ºäºŒè¿›åˆ¶æ–‡ä»¶ int main(void) { char buffer[5]; unsigned char ch=0; int i=0; FILE *frp=0; FILE *fwp=0; for(i=0; i\u0026lt;5; i++) buffer[i] = 0; frp=fopen(\u0026quot;ascii_zk.txt\u0026quot;,\u0026quot;r\u0026quot;); fwp=fopen(\u0026quot;ascii_zk.bin\u0026quot;,\u0026quot;w\u0026quot;); while(buffer[4] != 0x2e) //å…¨éƒ¨æ•°æ®ä»¥å¥å·ç»“å°¾ { for(i=0; i\u0026lt;5; i++) buffer[i]=fgetc(frp); ch = c2x(buffer[2]); ch = ch*16; ch = ch+c2x(buffer[3]); fputc(ch,fwp); } fclose(frp); fclose(fwp); return 0; } å­—åº“æ–‡ä»¶åˆ¶ä½œå®Œæ¯•ã€‚\n#4.å­—åº“æ–‡ä»¶ascii_zk.binçš„ä½¿ç”¨\nascii_zk.binæ–‡ä»¶ä»ASCIIç çš„ç©ºæ ¼ï¼ˆ0x20ï¼‰å¼€å§‹ï¼Œæ¯16ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦çš„ç‚¹é˜µå­—æ¨¡ã€‚ä»¥å­—æ¯Aä¸ºä¾‹ï¼Œå®ƒçš„ASCIIç æ˜¯0x41ï¼Œé‚£ä¹ˆï¼Œå®ƒçš„å­—æ¨¡æ•°æ®çš„å¼€å§‹ä½ç½®å°±æ˜¯ï¼š\nï¼ˆ0x41-0x20ï¼‰*16\nä»è¿™ä¸ªä½ç½®å¼€å§‹ä¾æ¬¡è¯»å–16ä¸ªå­—èŠ‚ï¼Œå°±æ˜¯å­—æ¯Açš„å­—æ¨¡æ•°æ®ï¼Œå°†å…¶æ˜¾ç¤ºå³å¯ã€‚\nä¾‹ï¼šç”¨Linuxçš„ç»ˆç«¯æ¨¡æ‹Ÿæ˜¾ç¤ºç‚¹é˜µå­—ç¬¦ï¼Œç»ˆç«¯å±å¹•ä¸­çš„æ¯ä¸ªå­—ç¬¦ä½ç½®å°±æ˜¯ä¸€ä¸ªç‚¹ï¼Œç¨‹åºå¦‚ä¸‹ã€‚\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;unistd.h\u0026gt; #include \u0026lt;curses.h\u0026gt; #define START 0x20 #define DATANUM 0x10 int displaychar(FILE *fp,char dispch,char fillch,char start_x,char start_y); int main(void) { FILE* fp=0; int i = 0; const char * teststring=\u0026quot;I love Julia\u0026quot;; fp=fopen(\u0026quot;ascii_zk.bin\u0026quot;,\u0026quot;r\u0026quot;); initscr(); for(i=0;(teststring[i]!=0);i++) { displaychar(fp,teststring[i],'*',0+(i*8),0); } refresh(); while(1); endwin(); fclose(fp); return 0; } /* * ä»¥ç‚¹é˜µæ–¹å¼æ˜¾ç¤ºä¸€ä¸ªASCIIå­—ç¬¦ * dispchæ˜¯è¦æ˜¾ç¤ºçš„å­—ç¬¦ï¼Œfillchæ˜¯å¡«å……ç‚¹é˜µçš„å­—ç¬¦ * start_x,start_yæ˜¯æ˜¾ç¤ºçš„èµ·å§‹åæ ‡ */ int displaychar(FILE *fp,char dispch,char fillch,char start_x,char start_y) { int location = ((dispch-START) * DATANUM); char x=start_x; char y=start_y; int i=0; int j=0; char buf=0; //å°†æ–‡ä»¶æµæŒ‡é’ˆç§»åˆ°åˆ°dispchå­—ç¬¦ç‚¹é˜µæ•°æ®çš„èµ·å§‹ä½ç½® fseek(fp,location,SEEK_SET); for(i=0;i\u0026lt;DATANUM;i++) { buf = fgetc(fp); //æ˜¾ç¤ºä¸€ä¸ªå­—èŠ‚ for(j=0;j\u0026lt;8;j++) { move(y+j,x); if(buf \u0026amp; (0x01\u0026lt;\u0026lt;j)) addch(fillch); } if(x == (start_x+7)) { x = start_x; y = (start_y+8); } else { x++; } } return 0; } è¯¥ç¨‹åºåœ¨Fedora12çš„ç»ˆç«¯ä¸­è¿è¡Œï¼Œæ•ˆæœå¦‚ä¸‹ï¼š\n#ä¸‹è½½ï¼š\nASCIIç‚¹é˜µå­—åº“æ–‡ä»¶\n","date":"2011 June 8","permalink":"/posts/2011/06/08/","section":"Posts","summary":"å¼€å‘ç¯å¢ƒï¼š","title":"ASCIIå­—ç¬¦ç‚¹é˜µå­—åº“çš„åˆ¶ä½œå’Œä½¿ç”¨"},{"content":"ç¯å¢ƒï¼šFedora12 Gcc4.4.2\nåœ¨Cè¯­è¨€ä¸­ï¼Œmainå‡½æ•°çš„å£°æ˜å¦‚ä¸‹ï¼š\nint mainï¼ˆint argcï¼Œchar *argv[]); argcæ˜¯æŒ‡ç¨‹åºå‚æ•°çš„ä¸ªæ•°ï¼ŒåŒ…æ‹¬ç¨‹åºåæœ¬èº«ï¼Œå¦‚æœç¨‹åºä¸å¸¦å‚æ•°ï¼Œargcä¸º1ï¼›\nargvçš„æ¯ä¸ªæ•°ç»„å…ƒç´ å­˜æ”¾ä¸€ä¸ªç¨‹åºå‚æ•°ï¼Œç¨‹åºåå­˜æ”¾åœ¨argv[0];\nä¾‹å¦‚ï¼š\n$ ls -l æ­¤æ—¶ï¼Œargcä¸º2ï¼Œargv[0]æ˜¯lsï¼Œargv[1]æ˜¯-lã€‚\nç¨‹åºçš„å‚æ•°å¯ä»¥åˆ†ä¸ºä¸‰ç§ï¼šé€‰é¡¹ï¼Œé€‰é¡¹çš„å…³è”å€¼ï¼Œéé€‰é¡¹å‚æ•°ã€‚ä¾‹å¦‚ï¼š\n$gcc hello.c -o hello hello.cæ˜¯éé€‰é¡¹å‚æ•°ï¼Œ-oæ˜¯é€‰é¡¹ï¼Œhelloæ˜¯-oé€‰é¡¹çš„å…³è”å€¼ã€‚\næ ¹æ®Linuxçš„æƒ¯ä¾‹ï¼Œç¨‹åºçš„é€‰é¡¹åº”è¯¥ä»¥ä¸€ä¸ªçŸ­æ¨ªçº¿å¼€å¤´ï¼Œåé¢åŒ…å«å•ä¸ªå­—æ¯æˆ–æ•°å­—ï¼Œé€‰é¡¹åˆ†ä¸ºä¸¤ç§ï¼šå¸¦å…³è”å€¼çš„å’Œä¸å¸¦å…³è”å€¼çš„ï¼Œä¾‹å¦‚ï¼š\n$gcc hello.c -o hello é€‰é¡¹-oå¿…é¡»å¸¦ä¸€ä¸ªå…³è”å€¼ã€‚\n$ls -l é€‰é¡¹-læ— éœ€å¸¦å‚æ•°ã€‚\nä¸å¸¦å…³è”å€¼çš„é€‰é¡¹åº”è¯¥å¯ä»¥åœ¨ä¸€ä¸ªçŸ­æ¨ªçº¿ååˆå¹¶ä½¿ç”¨ï¼Œä¾‹å¦‚ï¼š\n$ls -la Linuxç³»ç»Ÿæä¾›äº†getoptå‡½æ•°ï¼Œå®ƒç”¨æ¥æŒ‰ç…§ä¸Šè¿°è§„åˆ™å¤„ç†ç¨‹åºçš„å‚æ•°ï¼Œç›¸å…³å®šä¹‰å¦‚ä¸‹ï¼š\n#include \u0026lt;unistd.h\u0026gt; int getopt(int argc,char *const argv[],const char *optstring); extern char *optarg; extern int optind,opterr,optopt; getopt ä½¿ç”¨ main å‡½æ•°çš„ argc å’Œ argv ä½œä¸ºå‰ä¸¤ä¸ªå‚æ•°ï¼Œoptsting æ˜¯ä¸€ä¸ªå­—ç¬¦åˆ—è¡¨ï¼Œæ¯ä¸ªå­—ç¬¦ä»£è¡¨ä¸€ä¸ªå•å­—ç¬¦é€‰é¡¹ï¼Œå¦‚æœä¸€ä¸ªå­—ç¬¦åé¢ç´§è·Ÿä»¥å†’å·ï¼ˆï¼šï¼‰ï¼Œè¡¨ç¤ºè¯¥å­—ç¬¦æœ‰ä¸€ä¸ªå…³è”å€¼ä½œä¸ºä¸‹ä¸€ä¸ªå‚æ•°ï¼›\ngetoptçš„è¿”å›å€¼æ˜¯argvæ•°ç»„ä¸­çš„ä¸‹ä¸€ä¸ªé€‰é¡¹å‚æ•°ï¼Œç”±optindè®°å½•argvæ•°ç»„çš„ä¸‹æ ‡,å¦‚æœé€‰é¡¹å‚æ•°å¤„ç†å®Œæ¯•ï¼Œå‡½æ•°è¿”å›-1ï¼›\nå¦‚æœé‡åˆ°ä¸€ä¸ªæ— æ³•è¯†åˆ«çš„é€‰é¡¹ï¼Œè¿”å›é—®å·ï¼ˆï¼Ÿï¼‰ï¼Œå¹¶ä¿å­˜åœ¨optoptä¸­ï¼›\nå¦‚æœä¸€ä¸ªé€‰é¡¹éœ€è¦ä¸€ä¸ªå…³è”å€¼ï¼Œè€Œç¨‹åºæ‰§è¡Œæ—¶æ²¡æœ‰æä¾›ï¼Œè¿”å›ä¸€ä¸ªé—®å·ï¼ˆï¼Ÿï¼‰,å¦‚æœå°†optstringçš„ç¬¬ä¸€ä¸ªå­—ç¬¦è®¾ä¸ºå†’å·ï¼ˆ:),è¿™ç§æƒ…å†µä¸‹ï¼Œå‡½æ•°ä¼šè¿”å›å†’å·è€Œä¸æ˜¯é—®å·ã€‚\né€‰é¡¹å‚æ•°å¤„ç†å®Œæ¯•åï¼Œoptind ä¼šæŒ‡å‘ argv æ•°ç»„å°¾éƒ¨çš„å…¶ä»–éé€‰é¡¹å‚æ•°ã€‚å®é™…ä¸Šï¼Œgetopt åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¼šé‡æ’ argv æ•°ç»„ï¼Œå°†éé€‰é¡¹å‚æ•°ç§»åˆ°æ•°ç»„çš„å°¾éƒ¨ã€‚\nä¾‹ï¼š\nä¸‹é¢è¿™ä¸ªç¨‹åºéœ€è¦æä¾›ä¸¤ä¸ªæ— å…³è”å€¼çš„é€‰é¡¹ï¼š-vï¼Œ-gï¼›ä¸€ä¸ªéœ€è¦å…³è”å€¼çš„é€‰é¡¹ï¼š-tï¼›ä¸€ä¸ªéé€‰é¡¹å‚æ•°ã€‚\n//getopttest.c #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;unistd.h\u0026gt; int main(int argc,char *argv[]) { int opt=0; int i=0; const char *optstring=\u0026quot;:vgt:\u0026quot;; //éé€‰é¡¹å‚æ•°çš„ä¸ªæ•° const int num=1; //è°ƒç”¨getoptå‰æ‰“å°argvæ•°ç»„ for(i=0;i\u0026lt;argc;i++) printf(\u0026quot;%d:%s/n\u0026quot;,i,argv[i]); //å¤„ç†é€‰é¡¹å‚æ•° while((opt=getopt(argc,argv,optstring)) != -1) { switch(opt) { case 'v': case 'g': printf(\u0026quot;optionï¼š%c/n\u0026quot;,opt); break; case 't': printf(\u0026quot;option:%c = %s/n\u0026quot;,opt,optarg); break; case ':': printf(\u0026quot;the option need a value/n\u0026quot;); break; case '?': printf(\u0026quot;unknow optionï¼š%c/n\u0026quot;,optopt); break; } } //å¤„ç†éé€‰é¡¹å‚æ•° for(i=0;optind\u0026lt;argc;i++,optind++) { if(i\u0026lt;num) printf(\u0026quot;argument:%s/n\u0026quot;,argv[optind]); else printf(\u0026quot;excess argument:%s/n\u0026quot;,argv[optind]); } //è°ƒç”¨getoptåæ‰“å°argvæ•°ç»„ for(i=0;i\u0026lt;argc;i++) printf(\u0026quot;%d:%s/n\u0026quot;,i,argv[i]); return 0; } ç¼–è¯‘ï¼š\ngcc -Wall getopttest.c -o getopttest æ‰§è¡Œï¼š\n$./getopttest arg1 -vg -t value -x arg2 0:./getopttest 1:arg1 2:-vg 3:-t 4:value 5:-x 6:arg2 optionï¼šv optionï¼šg option:t = value unknow optionï¼šx argument:arg1 excess argument:arg2 0:./getopttest 1:-vg 2:-t 3:value 4:-x 5:arg1 6:arg2 ä»æ‰§è¡Œç»“æœå¯ä»¥çœ‹å‡ºï¼Œgetopt å‡½æ•°é‡æ’äº† argv æ•°ç»„ï¼Œå°†éé€‰é¡¹å‚æ•° arg1 æ’åˆ°äº†æ•°ç»„å°¾éƒ¨ã€‚\n","date":"2011 May 28","permalink":"/posts/2011/05/28/","section":"Posts","summary":"ç¯å¢ƒï¼šFedora12 Gcc4.","title":"ç”¨getoptå¤„ç†mainå‡½æ•°çš„å‚æ•°"},{"content":"ç¯å¢ƒï¼šfedora12ï¼Œgcc4.4.4\nCè¯­è¨€å‚æ•°ä¸ªæ•°å¯å˜çš„å‡½æ•°ï¼Œå«åšVAå‡½æ•°ï¼ˆvariable argument functionï¼‰ï¼Œä¾‹å¦‚printf()å‡½æ•°ã€‚è¦å®ç°VAå‡½æ•°éœ€è¦åŒ…å«stdarg.h:\n#include \u0026lt;stdarg.h\u0026gt; ä¸»è¦ä½¿ç”¨ä¸‹é¢ä¸‰ä¸ªå®å®šä¹‰ï¼š\nva_start(ap, A) va_arg(ap, T) va_end(ap) ap æ˜¯ç±»å‹æ˜¯ va_list ï¼Œva_list çš„å®šä¹‰å¦‚ä¸‹ï¼š\ntypedef char *va_list; å®ƒç”¨æ¥æŒ‡å‘å‡½æ•°çš„å‚æ•°ã€‚\nAæ˜¯å‡½æ•°çš„æœ€åä¸€ä¸ªå›ºå®šå‚æ•°ï¼Œä¸€ä¸ªVAå‡½æ•°å¿…é¡»æœ‰è‡³å°‘ä¸€ä¸ªå›ºå®šå‚æ•°ã€‚\nTæ˜¯å‚æ•°çš„ç±»å‹ï¼Œä¾‹å¦‚intï¼Œchar\u0026hellip;,ç­‰ç­‰ã€‚\nva_start(ap,A)ï¼šåˆå§‹åŒ–å‡½æ•°å‚æ•°æŒ‡é’ˆapï¼Œä½¿apæŒ‡å‘Açš„å³è¾¹çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå³å‡½æ•°å¯å˜å‚æ•°ä¸­çš„ç¬¬ä¸€ä¸ªï¼› va_arg(ap,Tï¼‰ï¼šè¿”å›apæŒ‡å‘çš„å‚æ•°çš„å€¼ï¼Œå‚æ•°çš„ç±»å‹ç”¨Tç¡®å®šï¼Œç„¶åå°†apæŒ‡å‘ä¸‹ä¸€ä¸ªå‚æ•°ï¼› va_endï¼ˆapï¼‰ï¼šé‡Šæ”¾apã€‚ ä¸‹é¢çš„ä¾‹å­å®šä¹‰äº†ä¸€ä¸ªvaå‡½æ•°ï¼Œä½œç”¨æ˜¯ä¾æ¬¡æ‰“å°ä¼ é€’ç»™å‡½æ•°çš„intå‹å‚æ•°ã€‚\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;stdarg.h\u0026gt; int va_function(const char *start,...) { int n=1; va_list arg; va_start(arg,start); printf(\u0026quot;%s/n\u0026quot;,start); while(n != 0) { n=va_arg(arg,int); printf(\u0026quot;%d/n\u0026quot;,n); } va_end(arg); return 0; } int main(void) { va_function(\u0026quot;start\u0026quot;,1,2,3,-1,-2,0); return 0; } æ³¨æ„ï¼š\nVAå‡½æ•°çš„å¯å˜å‚æ•°ç±»å‹å¿…é¡»åœ¨å‡½æ•°ä¸­è‡ªè¡Œç¡®å®šï¼Œç¼–è¯‘å™¨æ— æ³•è‡ªåŠ¨è¯†åˆ«ã€‚ å¿…é¡»åœ¨VAå‡½æ•°ä¸­å®šä¹‰å¯å˜å‚æ•°çš„ç»“æŸæ ‡å¿—ï¼Œå¦‚æœæ²¡æœ‰ç»“æŸæ ‡å¿—ï¼Œva_argä¼šä¾æ¬¡è¿”å›å†…å­˜ä¸­çš„å€¼ï¼Œç›´åˆ°è®¿é—®åˆ°éæ³•å†…å­˜è€Œå‡ºé”™é€€å‡ºã€‚ è¿™å‡ ä¸ªå®åœ¨ä¸åŒçš„ç¼–è¯‘å™¨ä¸­æœ‰ä¸åŒçš„å®šä¹‰ï¼Œä½†æ˜¯åŠŸèƒ½æ˜¯ä¸€æ ·çš„ï¼Œåœ¨linuxçš„å†…æ ¸æºç ä¸­ä¹Ÿç”¨å®šä¹‰ï¼Œå¯ä»¥å‚è€ƒã€‚åœ¨å†…æ ¸æºç çš„ /include/acpi/platform/acenv.h æ–‡ä»¶å†…ï¼š\ntypedef char *va_list; /* Storage alignment properties */ #define _AUPBND (sizeof (acpi_native_uint) - 1) #define _ADNBND (sizeof (acpi_native_uint) - 1) /* Variable argument list macro definitions */ #define _bnd(X, bnd) (((sizeof (X)) + (bnd)) \u0026amp; (~(bnd))) #define va_arg(ap, T) (*(T *)(((ap) += (_bnd (T, _AUPBND))) - (_bnd (T,_ADNBND)))) #define va_end(ap) (void) 0 #define va_start(ap, A) (void) ((ap) = (((char *) \u0026amp;(A)) + (_bnd (A,_AUPBND)))) å‚è€ƒï¼š\næ·±å…¥æµ…å‡ºVAå‡½æ•°\nlinux kernelä¸­çš„å˜é•¿å‚æ•°å®\nã€ŠThe Open Group Base Specifications Issue 6ã€‹\n","date":"2011 May 17","permalink":"/posts/2011/05/17/","section":"Posts","summary":"ç¯å¢ƒï¼šfedora12ï¼Œgcc4.4.4","title":"Cè¯­è¨€çš„å‚æ•°å¯å˜å‡½æ•°"},{"content":"**Esc **ï¼šescape\n**Tab **ï¼štable\n**Caps Lock **ï¼šCapital Lock\n**Shift **ï¼šshift\n**Ctrl **ï¼šcontrol\n**Alt **ï¼šalternative\n**Enter **ï¼š enter\n**F1~12 **ï¼šfunctions\n**~ **ï¼štilde\n**! **ï¼šexclamation\n**@ **ï¼šat\n**# **ï¼špound ï¼Œhash\n**$ **ï¼šdollar\n**% **ï¼špercent\n**^ **ï¼šcaret\n**\u0026amp; **ï¼šampersand\n*** **ï¼šstar\n**( **ï¼šopening parenthesis\n**) **ï¼šclosing parenthesis\n**_ **ï¼šunderscore\n**+ **ï¼šplus\n**- **ï¼šMinus\n**= **ï¼šequals\n**` **ï¼šbackquote\n**{ **ï¼šopening brace\n**} **ï¼šclosing brace\n**[ **ï¼šopening bracket\n**] **ï¼šclosing bracket\n**| **ï¼špipe\n**\\ **ï¼šbackslash\n**: **ï¼šcolon\n**; **ï¼šsemicolon\n**â€œ **ï¼šdouble quote\n**â€˜ **ï¼šsingle quote\n**\u0026lt; **ï¼šless than\n**, **ï¼šcomma\n**\u0026gt; **ï¼šgreat than\n**. **ï¼šdot\n**? **ï¼šquestion mark\n**/ **ï¼šslash\n","date":"2011 April 10","permalink":"/posts/2011/04/10/","section":"Posts","summary":"**Esc **ï¼šescape","title":"é”®ç›˜ä¸Šå„ä¸ªæŒ‰é”®çš„è‹±æ–‡å"},{"content":"test.sh :\n#!/bin/bash pid=`ps -ef | grep -v grep | grep -v \u0026quot;test.sh\u0026quot; | grep $1 | sed -n '1P' | awk '{print $2}'` if [ -z $pid ] ; then echo \u0026quot;no this process\u0026quot; else echo $pid fi ä¾‹ï¼š\næŸ¥è¯¢æ˜¯å¦å­˜åœ¨helloè¿›ç¨‹\n#./test.sh hello å¦‚æœå­˜åœ¨ hello è¿›ç¨‹ï¼Œä¼šè¾“å‡º PID ; ä¸å­˜åœ¨ä¼šè¾“å‡º no this process\n","date":"2011 March 4","permalink":"/posts/2011/03/04/","section":"Posts","summary":"test.sh :","title":"åˆ¤æ–­è¿›ç¨‹æ˜¯å¦å­˜åœ¨çš„è„šæœ¬"},{"content":"","date":null,"permalink":"/categories/","section":"Categories","summary":"","title":"Categories"}]